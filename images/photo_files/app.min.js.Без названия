window.__OCTAVIUS_READY__=!0;(function(a){"use strict";if(typeof window=="object"&&window.wallaby){wallaby.delayStart();a("./",require,wallaby)}else if(typeof define==="function"&&define.amd){define("jssdk",function(){var b=require.toUrl("jssdk");return a(/^..?\//.test(b)?"./":b.split("/").slice(0,-1).join("/"),require)})}else{var b=a(__dirname,{config:function(){}});delete b.tests;delete b.bench;delete b.modules;module.exports={cfg:b,extend:function(a){Object.keys(this.cfg).forEach(function(b){var c=a[b],d=this[b];if(a[b]){if(c instanceof Array){a[b]=c.concat(d)}else{Object.keys(d).forEach(function(a){c[a]=d[a]})}}else{a[b]=d}},this.cfg);return a}}}})(function(a,require,b){"use strict";var c={},d;require.config(d={deps:b?b.tests:[],callback:b&&b.start,paths:function(b){b.tests=[];b.bench=[];b.paths={};b.modules=["config","logger","Emitter","request","RPC","RPC/statuses/sdc","RPC/statuses/token","RPC/statuses/processing","RPC/statuses/secure_folder","RPC/statuses/oauth_fail","Storage","TaskScheduler","Task","Model","Model.List","RPCModel","cloud/Entry","cloud/actions/AcceptLicense","cloud/actions/Space","uuid","utils/util","utils/extension","utils/url","utils/promise","mail/Folder","mail/SharedMailbox","mail/Contact","mail/User","mail/UserSecurity","mail/Phone","mail/Password","Action","Transaction","mail/actions/AddAttachToCloud","mail/actions/AddCloudStockToCloud","mail/actions/AddToCloud","mail/actions/CategoryChange","mail/actions/ContactSuggests","mail/actions/CloudFolderAdd","mail/actions/MarkAs","mail/actions/MarkAsAll","mail/actions/MoveTo","mail/actions/MoveToAll","mail/actions/Delete","mail/actions/DeleteAll","mail/actions/Spam","mail/actions/Archive","mail/actions/ArchiveAll","mail/actions/Schedule","mail/actions/PasswordGenerate","mail/actions/FolderAccessToken","mail/actions/UserAdditionalEmail","mail/actions/Toggle2StepAuth","mail/actions/Translate","mail/actions/Snooze","mail/actions/PasswordRecovery","mail/actions/PasswordStrength","mail/actions/PasswordSupport","mail/actions/PasswordChange","mail/actions/UserSignup","mail/actions/UserSignatureAttachesAdd","mail/actions/UserSignatureAttachesAdd/SignUploadTask","mail/actions/UserSignatureAttachesAdd/Transport","mail/actions/ConfirmReceipt","mail/actions/PromoplatesManage","mail/actions/UserEditMetathreads","mail/actions/CleanmasterUnreadManage","mail/actions/MessagesMeta","mail/Message","mail/Thread","calendar/Event","calendar/Calendar","calendar/actions/EventAction","mail/Attachment","mail/MessageFormData","mail/MessageFormData/Preprocessor","mail/MessageFormData/Transport","mail/MessageFormData/Reattach","mail/MessageFormData/Attachment/AddAttachment","mail/MessageFormData/Attachment/RemoveAttachments","mail/MessageFormData/Template","mail/MessageFormData/Translate","mail/MessageFormData/ConstructFormData","mail/MessageFormData/PrototypeHelpers","mail/MessageFormData/tasks/CloudStockUploadTask","mail/MessageFormData/tasks/MailUploadTask","mail/MessageFormData/tasks/OversizeCloudUploadTask","mail/MessageFormData/tasks/ReattachTask","mail/MessageFormData/Utils","mail/MessageFormData/MainActions/Send","mail/MessageFormData/MainActions/Save","mail/MessageFormData/MainActions/CancelDelivery","mail/MessageFormData/MainActions/ForceDelivery","mail/MessageFormData/MainActions/Destroy","mail/MessageFormData/MainActions/ToJSON","mail/MessageFormData/ModelHelpers","mail/User/TOTPCode","mail/RestoreEmail","oauth/Application","mail/User/Error","help/Content","mail/actions/PhoneCheck","mail/SmartReply","mail/actions/PushToRebus","mail/AttachSearch","mail/Collector","mail/Alias","mail/mixins/Translator","mail/TransactionMetadata","mail/PromoDomain","mail/actions/Redirect","filters/actions/ChangeOrder","filters/actions/ConfirmForward","filters/actions/Edit","filters/actions/ResendConfirm","filters/actions/SaveSeveral","filters/actions/SwitchEnabled","filters/Filter","mail/getters/MessageMeta","jssdk/next/action/global","jssdk/next/action","jssdk/next/action/set","jssdk/next/logger","jssdk/next/logger/logger","jssdk/next/model/attrs","jssdk/next/model","jssdk/next/model/model","jssdk/next/model/ref","jssdk/next/model/source","jssdk/next/react/action","jssdk/next/react","jssdk/next/react/model","jssdk/next/react/selector","jssdk/next/react/source","jssdk/next/react/state","jssdk/next/react/util","jssdk/next/request","jssdk/next/rpc/addons/event-emitter","jssdk/next/rpc/addons/recorder","jssdk/next/rpc/backend","jssdk/next/rpc/files","jssdk/next/rpc/hook","jssdk/next/rpc/hooks/default","jssdk/next/rpc/hooks/mailapi-token","jssdk/next/rpc/hooks/no-sdc","jssdk/next/rpc/hooks/noop","jssdk/next/rpc/hooks/oauth-token","jssdk/next/rpc/hooks/processing","jssdk/next/rpc/http","jssdk/next/rpc","jssdk/next/rpc/legacy-bridge","jssdk/next/rpc/mailapi","jssdk/next/rpc/qs","jssdk/next/rpc/request","jssdk/next/rpc/response","jssdk/next/rpc/rest","jssdk/next/rpc/rpc","jssdk/next/rpc/swa","jssdk/next/rpc/test.util","jssdk/next/rpc/typing.openapi.fixture","jssdk/next/rpc/typing","jssdk/next/rpc/utils","jssdk/next/state/global","jssdk/next/state","jssdk/next/state/selector","jssdk/next/subject","jssdk/next/subject/subject","jssdk/next/types","jssdk/next/util/abort-ctrl","jssdk/next/util/define","jssdk/next/util/lazy","jssdk/next/util/object","jssdk/next/util/pause","jssdk/next/util/url"];b.modules.forEach(function(a){var c=a.split("/");if(/^@?jssdk(\/|$)/.test(a)){var d=[].concat(c.slice(1),c.length==2?"index":[]).join("/");b.paths[a]=d;return}c.push(c.slice().pop());c=c.join("/");b.tests.push(a+".test");b.bench.push(a+".bench");b.paths[a+".test"]=c+".test";b.paths[a+".bench"]=c+".bench";b.paths[a]=c});b.paths["mail/Spam/old-api-adapter"]="mail/actions/Spam/old-api-adapter";var c={filter:"vendor/filter","jquery.mockjax":"vendor/jquery.mockjax",inherit:"vendor/inherit",performance:"vendor/performance",apidoc:"tests/apidoc",uuid:"vendor/uuid"};function d(){var c=b.paths;[].forEach.call(arguments,function(b){Object.keys(b).forEach(function(d,e){e=b[d];c[d]=(/^(\/\/|http)/.test(e)?"":a+"/")+e})});return c}return d(b.paths,c)}(typeof c==="undefined"?{}:c)});Object.keys(d).forEach(function(a){c[a]=d[a]});return c});define("node_modules/@mail/jssdk/boot",["jssdk"],function(a){return a});"use strict";var MODULES_PATH="node_modules";var paths={trackJS:"empty:","mrg-xray":"empty:","@mail/xray":"empty:",timingNow:"empty:","xray-config":"empty:","filters.mail.ru":"empty:",blitz:"empty:",themesConfig:"empty:","socket.io":"https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io","io-socket":"service/socket-io",AuthGateLoader:"service/authgate","modernizr-custom":"bundles/vendor/modernizr-custom",dompurify:"../node_modules/dompurify/dist/purify.min","@mail-core/dashboard/keeper":"../node_modules/@mail-core/dashboard/keeper","@mail/radars-decorator":"../node_modules/@mail/radars-decorator/dist/index-feast","@mail/radars-decorator/dist/index-react":"../node_modules/@mail/radars-decorator/dist/index-react","@mail/features":"../node_modules/@mail/features/dist/features",mqmatch:"../node_modules/mqmatch/dist/mqMatch.min","cross.project.dnd":"../node_modules/cross.project.dnd/dist/lib","ui-react":"bundles/react/ui-react.bundle","vk-messenger":"bundles/react/vk-messenger.bundle","react.env":"empty:",react:"empty:","react-dom":"empty:","react-intl":"empty:","@mail/operands":"../node_modules/@mail/operands/dist/@mail/operands.umd","@octo/smart-input":"../node_modules/@octo/smart-input/dist/@octo/smart-input.umd","@mail/adman":"../node_modules/@mail/adman/dist/adman","@mail/adman-logger":"../node_modules/@mail/adman-logger/dist/adman-logger","@mail/amp-viewer":"../node_modules/@mail/amp-viewer/amp-viewer","@mail/contact-validation":"../node_modules/@mail/contact-validation/dist/contact-validation","@mail/smokescreen":"../node_modules/@mail/smokescreen/dist/mrg-smokescreen","@mail/nano-xhr":"empty:","mrg-nano-xhr":"empty:","@mail/honeypot":"../node_modules/@mail/honeypot/dist/main","@mail/mimic/dist/types/src/projects/octavius":"../node_modules/@mail/mimic/dist/octavius.bundle","ductus-loader":"../node_modules/@mail/ductus/.build/loader","@mail/darkosha":"../node_modules/@mail/darkosha/dist/darkosha","@mail/calls-api":"../node_modules/@mail/calls-api/dist/calls-api","@mail-core/logger":"../node_modules/@mail-core/logger","@mail/release-detect":"../node_modules/@mail/release-detect/release-detect","@mail/notifier-client":"../node_modules/@mail/notifier-client/dist/notifier-client.min","@mail/sw-box":"../node_modules/@mail/sw-box/dist/sw-box.client",axios:"../node_modules/axios/dist/axios","axios-jsonp":"../node_modules/axios-jsonp/dist/index","axios-mock-adapter":"../node_modules/axios-mock-adapter/dist/axios-mock-adapter","service/addressbook/addressbook":"service/addressbook/addressbook-impl","@mail/vkui":"empty:","@mail/vkui/2kit":"empty:","suggests/group":MODULES_PATH+"/suggests/src/group","suggests/suggests":MODULES_PATH+"/suggests/src/suggests","suggests/data-source":MODULES_PATH+"/suggests/src/data-source","suggests/labels":MODULES_PATH+"/suggests/src/labels","suggests/search-index":MODULES_PATH+"/suggests/src/search-index","suggests/template":MODULES_PATH+"/suggests/src/template","suggests/punto":MODULES_PATH+"/suggests/src/punto",mobx:"../node_modules/mobx/lib/mobx.umd","mobx-react":"../node_modules/mobx-react/index","prop-types":"../node_modules/prop-types/prop-types.min",classnames:"../node_modules/classnames/index","mobx-state-tree":"../node_modules/mobx-state-tree/dist/mobx-state-tree.umd","regenerator-runtime":"../node_modules/regenerator-runtime/runtime","page-lifecycle":"../node_modules/page-lifecycle/dist/lifecycle.es5","feast-css":MODULES_PATH+"/feast/src/require-css","feast-tpl":MODULES_PATH+"/feast/src/require-feast","svgson-loader":"../build-helpers/svgson-plugin.js","mailru-toolkit-bundle":"bundles/mailru-toolkit/mailru-toolkit","mailru-toolkit-lego-bundle":"bundles/mailru-toolkit/mailru-toolkit.lego","mrg-message-broker/Subscription/Subscription":MODULES_PATH+"/mrg-message-broker/dist/main","@mail/oauth":"../node_modules/@mail/oauth/oauth-client","left-pad":MODULES_PATH+"/left-pad/index","@mail/keymaster":"../node_modules/@mail/keymaster/main",twemoji:"../node_modules/twemoji/dist/twemoji.amd","@mail/cross-url-sharing":"../node_modules/@mail/cross-url-sharing/.build/index","@mail/feedback-loader":"../node_modules/@mail/feedback-loader","@vkontakte/vk-bridge":"../node_modules/@vkontakte/vk-bridge/dist/index.umd","core-js":"helpers/nullExport2","ui-react/containers/DatasetLetters/DatasetLetters":"helpers/nullExport","ui-react/containers/SearchPanel/SearchPanel":"helpers/nullExport","ui-react/components/ListLetterHeaderActions/ListLetterHeaderActions":"helpers/nullExport","ui-react/components/WidgetColumn/WidgetColumn":"helpers/nullExport","ui-react/components/LetterHeaderActions/LetterHeaderActions":"helpers/nullExport","ui-react/components/VkMessengerProvider/VkMessengerProvider":"helpers/nullExport","ui-react/containers/SettingsDock/SettingsDock":"helpers/nullExport"};var noOverwritePaths={"mailru-toolkit-lego-bundle":true,"mailru-toolkit-bundle":true,"vk-messenger":true,mimic:true};if(typeof window!=="undefined"){var requirePaths=require.s.contexts._.config.paths;for(var pathsKey in paths){if(paths[pathsKey]==="empty:"){delete paths[pathsKey]}if(!window.skipRequireClear&&noOverwritePaths[pathsKey]&&requirePaths[pathsKey]){delete paths[pathsKey]}}delete paths["toolkit-common/keymaster/keymaster"]}require.config({waitSeconds:0,config:{feast:{debug:typeof window!=="undefined"&&!window.BUILD,socket:typeof window!=="undefined"&&!window.BUILD,useTryCatch:typeof location!=="undefined"&&/ui-block/.test(location.pathname)}},bundles:{"react.env":["react","react-dom","react-intl"]},packages:[{name:"feast-app",location:"@mail/feast-dev/app",main:"app.js"}],shim:{"mailru-toolkit-lego-bundle":{},themesConfig:{deps:["mrg-i18n-utils"]},"FileAPI/plugins/FileAPI.exif":{deps:["FileAPI"]}},paths:paths});if(typeof window!=="undefined"){window.define("feast-mailru-toolkit/toolkit-updater",["node_modules/feast-mailru-toolkit/toolkit-updater"],function(a){return a});if(!window.skipRequireClear){window.define("features",["@mail/features"],function(a){return a})}window.define("@mail/blitz",["blitz"],function(a){return a});window.define("@mail/share-folder",["share-folder"],function(a){return a});window.define("@mail/vkid-components",["vkid-components"],function(a){return a})}define("require.config",[],function(){});define("init/i18n",["require","exports","mrg-i18n-utils"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("cfg",["require","exports","config"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);var b=(0,a.default)(window.__cfgOptions);var c=window.sotaConfig.cfg;b.set(c);b.set("bundles-paths",window.bundlesPaths);b.set("themesPath",window.getThemesPath());exports.default=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("cfgUser",["require","exports","config"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);var b=window.sotaConfig.userConfig;var c=(0,a.default)(b);b.api.forEach(function(a){if(a.method==="/api/v1/user/short"){c.set("initialUser",a.data.body);c.set("initialUser.email",a.data.email)}});exports.default=c});define("helpers/base64",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.objFromBase64=exports.objToBase64=exports.fromBase64=exports.toBase64=void 0;var a=function(a){return window.btoa(unescape(encodeURIComponent(a)))};exports.toBase64=a;var b=function(a){return decodeURIComponent(escape(window.atob(a)))};exports.fromBase64=b;var c=function(a){return(0,exports.toBase64)(JSON.stringify(a))};exports.objToBase64=c;var d=function(a){return JSON.parse((0,exports.fromBase64)(a))};exports.objFromBase64=d});define("helpers/aboutAd",["require","exports","helpers/base64"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createAboutAdLink=exports.isAdInfo=exports.AdDescriptionKeys=void 0;var b;(function(a){a["Subject"]="Объект рекламы";a["Advertiser"]="Рекламодатель";a["INN"]="ИНН";a["INN_KPP"]="ИНН/КПП";a["OGRN"]="ОГРН"})(b=exports.AdDescriptionKeys||(exports.AdDescriptionKeys={}));function c(a){if(!a||typeof a!=="object"){return false}return typeof a[b.Advertiser]==="string"&&(typeof a[b.INN]==="string"||typeof a[b.INN_KPP]==="string")}exports.isAdInfo=c;var d=function(b){return"https://ads.vk.com/adv_info?data=".concat((0,a.objToBase64)({fields:Object.keys(b).map(function(a){return{name:a,value:b[a]}})}))};exports.createAboutAdLink=d});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/browser",["require","exports","modernizr-custom","mrg-device-tools"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);var c=b.default.matchUserAgent(navigator.userAgent);function d(){return a.default.touchevents||c.msie&&a.default.pointerevents}function e(){var b;if(a.default.hovermq){b=a.default.mq("(hover:hover)")}else{b=!a.default.mq("screen and (max-width: 760px)")||!a.default.touchevents}return b}c.capabilities={"hover-support":e(),"touch-support":d(),"sticky-support":a.default.csspositionsticky};c.mac=!!navigator.userAgent.match(/\bMac\b/);var f={};c.prefixedCSS=function(b){if(!f[b]){f[b]=a.default.prefixedCSS(b)}return f[b]};var g=window.navigator.userAgent.toLowerCase();c.isIE=!!g.match(/msie/);c.isSafari=/safari/.test(g)&&!/chrome/.test(g);c.isTouchDevice=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints||typeof window.orientation!=="undefined"||/(iphone|ipod|ipad|android|iemobile|blackberry|bada)/.test(g)};c.cssPositionValueSupported=function(a){var b=document.createElement("div");try{for(var c=0,d=a;c<d.length;c++){var e=d[c];b.style.position=e;if(b.style.position===e){return e}}}catch(a){return""}return""};c.hasTouchPointer=function(){var a=false;try{a=window.matchMedia("(pointer:coarse)").matches}catch(a){}return a};c.supportedSticky=c.cssPositionValueSupported(["sticky","-webkit-sticky"]);exports.default=c});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("temporary/force-3pane-exp",["require","exports","@mail/features","@mail/flags","@mail/xray"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.perform=exports.needForce3Pane=exports.getExpStatus=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=function(){var a=new URLSearchParams(window.location.search);return a.has("newreg")};var e=function(){if(!a.default.has("force-3pane-exp")||b.default.get("use-3pane").isExist()||!d()){return"noexp"}return a.default.getAsBoolean("force-3pane-exp",false)?"3pane":"2pane"};exports.getExpStatus=e;var f=function(){return(0,exports.getExpStatus)()==="3pane"};exports.needForce3Pane=f;var g=function(){var a=(0,exports.getExpStatus)();if(a==="noexp"){return}b.default.get("use-3pane").save({state:a==="3pane",close:a==="3pane",time:true}).then(function(){c.default.send("force_3pane_experiment",{dwh:{state:a==="3pane"}})})};exports.perform=g});define("helpers/querystring",["exports","pilotjs"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var c=b;if(typeof b!=="string"){return{}}if(b.includes("?")){c=b.split("?")[1]}return a.queryString.parse(c)}});define("RPC/statuses/processing",["RPC","logger"],function(a,b){"use strict";var c={status:"processing",process:function(a){var c=a.get("body.retry_after");b.add("processing.retry_after",c);a.options.retries++;return function(a){setTimeout(function(){b.add("processing.retry_after.resolve",c);a()},c)}}};a.attachBaseErrorHandler(c);return c});define("RPC/statuses/sdc",["RPC","request","utils/util"],function(a,b,c){"use strict";var d;var e={status:"denied:nosdc",process:function(e,f){if(!d){var g=c.urlToAbsolute(e.get("url"));var h=(f||a).setup("sdcUrl");d=b.get(h,{from:g},window.IS_TESTS?{}:{jsonp:"JSONP_call",dataType:"jsonp",force:true}).then(function(a){return a}).catch(function(a){return a}).then(function(a){d=null;return a}).then(function(a){return a.body?true:Promise.reject()})}return d}};a.attachBaseErrorHandler(e);return e});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("RPC/statuses/secure_folder",["require","exports","RPC","logger","Action","mail/Folder"],function(require,exports,a,b,c,d){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);var e=function(a){return(a===null||a===void 0?void 0:a.error)==="not_open"};function f(a){var b=a.body,c=b===void 0?{}:b;var d;var f;for(var g=0,h=Object.keys(c);g<h.length;g++){var i=h[g];if(e(c[i])){f=i;d=c[i];break}}if(!d){return{}}return{errorField:d,errorKey:f}}var g={status:"invalid",process:function(a){var e=f(a);if("errorField"in e){b.default.add("invalid.folder.error",e);return d.default.findOne(e.errorField.value).then(function(a){return c.default.waitFor("folderSecure",[a])})}}};a.default.attachBaseErrorHandler(g);exports.default=g;return g});define("RPC/statuses/token",["logger","RPC","utils/promise"],function(a,b,c){"use strict";var d;var e={status:"denied:token",process:function(e,f){if(!d){var g=function(){d=null;a.add("remove persistent promise")};d=(f||b).call("tokens",{},{force:true}).then(c.done(g),c.fail(g))}return d.then(c.done(function(c){var d=c.get("body.token");a.add("RPC.newToken",d);e.data.token=d;(f||b).setup("token",d)}))}};b.attachBaseErrorHandler(e);return e});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("AuthGateLoader",["require","exports","cfg","Emitter","logger"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.default=Promise.resolve(b.default.apply({show:function(){var b=this;var d=c.default.scope("service/authgate",{auth:a.default.auth});new Promise(function(a,b){require(["service/auth/account"],a,b)}).then(__importStar).then(function(a){var c=a.default;d.call(function(){return Promise.resolve(c.relogin()).then(function(a){d.add("email",{email:a});c.keepalive();b.emit("auth",a)})})})}}))});define("mail/Phone",["RPCModel"],function(a){"use strict";var b=a.extend({findUrl:"user",bindUrl:"user/phones/bind",saveUrl:"user/phones/edit",removeUrl:"user/phones/remove",enable2FactorUrl:"user/2-step-auth/enable",disable2FactorUrl:"user/2-step-auth/disable",defaults:{id:null,temporaryId:null,phone:"",visibility:"visible",country:"",mobile:true,status:"nonverified",noticeable:"",two_factor:false},prepareSendData:function(a,b){switch(a){case"add":b={phones:JSON.stringify([{id:b.id,phone:b.phone,visibility:b.visibility,mobile:b.mobile,status:b.status}])};break}return b},getFormattedNumber:function(){var a=/^(7|8)(9..|499|495|812)(...)(..)(..)$/,b=/\d{5}(\d{2})/,c=this.get("phone");if(a.test(c)){c=c.replace(a,"+$1 ($2) $3-**-**")}else{c=c.replace(b,"*****$1")}return c},parse:function(a,b){var c={};if(/user$/.test(b.url)){c=a.phones}else if(/user\/phones\/add/.test(b.url)){c={id:a[0]}}return c},_call2FactorsMethod:function(a,b,c,d){d=Object(d);return this.queue(function(e){var f=e.constructor.url(a);if(c){d.password=c}if(b){d.reg_token=b}return e.request.post(f,d)}.bind(this))},bind:function(a,b){var c={phone:{phone:this.get("phone"),visibility:this.get("visibility"),mobile:true}};return this._call2FactorsMethod("bind",a,b,c)}});b.filterPotentialSecondFactor=function(a){if(!(a instanceof b.List)){a=b.map(a)}var c=a.filter({status:"ok",two_factor:false});var d=a.filter({status:"too_young",two_factor:false});var e=a.filter({status:"in_remove_queue"});if(c.length){return c}if(d.length&&!e.length){return d}return new b.List};b.getPotentialSecondFactor=function(){return b.find().then(function(a){return b.filterPotentialSecondFactor(a)})};b.version="0.4.1";return b});define("mail/User/TOTPCode",["Model"],function(a){"use strict";var b=a.extend({defaults:{enabled:false,application:"",platform:""}});b.version="0.1.1";return b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/User",["require","exports","RPC","RPCModel","mail/Phone","mail/User/TOTPCode","utils/util"],function(require,exports,a,b,c,d,e){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);var f=b.default.extend({className:"mail.User",loginUrl:"user/short",findUrl:"user",removeUrl:"user/remove",saveUrl:"user/edit",findBillsCountUrl:"user/paymentdata",editMetathreadsSettingsUrl:"golang/user/edit/metathreads",defaults:{signs:[],addressbook:{sort:{}},phones:null,notifications:{},security:{},messages:{},name:{},birthday:{},restore:{},totp:{enabled:false},agent:{visible:{},history:{}}},isNew:function(){return!this.is("common_purpose_flags")},isDataFully:function(){return this.is("phones")},getEmail:function(){return this.get("login")+"@"+this.get("domain")},getFullName:function(a){var b=a===void 0?{}:a,c=b.strict,d=c===void 0?false:c;var f=this.get("nick");if(f){return f}var g=this.get("name")||{},h=g.first,i=g.middle,j=g.last;if(h||i||j){return e.default.calculateFullName({first:h,middle:i,last:j})}if(!d){return this.getEmail()}},isTwoFactorEnable:function(){var a=(this.get("phones")||[]).some(function(a){return!!a.two_factor});if(!a){a=this.get("totp").enabled}return!!a},isPDD:function(){return this.get("account_type")==="pdd"},getMainPhone:function(){if(!this.isDataFully()){return null}var a=this.get("phones").find(function(a){return!!a.main_phone});return new c.default(a)},getTwoFactor:function(){var a;if(!this.isTwoFactorEnable()){return null}a=(this.get("phones")||[]).filter(function(a){return a.two_factor});if(a.length){return new c.default(a[0])}return f.TOTPCode.map(this.get("totp"))}});f.TOTPCode=d.default;f.login=function(){var a=this.url("login"),b=this.fn.request;return b.post(a).then(function(a){b.setup("token",a.get("body.token"));b.setup("email",a.get("email"));return a.map(f)})};f.findBillsCount=function(){return a.default.get(f.url("findBillsCount")).then(function(a){var b=a.body.unpaid_fines;var c=a.body.unpaid_bills;var d=(b||0)+(c||0);return{unpaidFines:b,unpaidBills:c,total:d}})};f.getMetathreadsSettingsFromVisibility=function(a){if(!Array.isArray(a)){return{}}var b={};a.forEach(function(a){var c=a.folder_id,d=a.state;b[c]=d});return b};f.METATHREADS_STATES={ON:0,HIDDEN:1,OFF:2};f.version="0.3.0";exports.default=f;return f});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/auth",["require","exports","AuthGateLoader","Emitter","mail/User","RPC"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);var e;var f;d.default.errorHandler.push({status:"denied:user",process:function(b){if(!f){f=new Promise(function(c){a.default.then(function(a){a.show();a.one("auth",function(a){f=null;b.data.email=a;c()})})})}return f}});exports.default=b.default.apply({version:"0.1.0",user:null,isAuth:function(){return!!this.user},setUser:function(a){this.user=c.default.map(a);this.trigger("login",this.user);return a},login:function(){e=e||this.loadUser().then(function(a){new Promise(function(a,b){require(["service/auth/account"],a,b)}).then(__importStar).then(function(a){var b=a.default;return b.keepalive()});return a});return e},loadUser:function(){var a=this;return c.default.login().then(function(b){a.setUser(b);return b}).catch(function(){return a.user})}})});define("service/radars/defaults",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={events:[],broadcast:true,prop:"radar-id"}});define("helpers/define-utils",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.defineExternalForSyncUse=exports.defineExternal=void 0;var define=window.define;function a(a,b){define(a,function(){return b})}exports.defineExternal=a;function b(b,c){a(b,c);window.require([b],function(){})}exports.defineExternalForSyncUse=b});define("service/getModule",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a={};function b(b){if(!a[b]){a[b]=new Promise(function(a,c){window.require([b],function(d){if(d){a(d);return}c(new Error('Module "'.concat(b,'" is undefined')))})})}return a[b]}exports.default=b});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("init/features",["require","exports","@mail/features","@mail-core/logger","cfg"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importStar(a);c=__importDefault(c);function d(a,c){(0,b.coreLoggerDispatchSelfError)("features_err",a,{featureName:c})}a.default.setFeaturesToSalt(["adv-list-default-config"]);a.default.config({onParseFail:d});a.default.import(c.default.get("sotaFeatures")||{},a.Source.Onlineconf);a.default.importFromString(c.default.get("sotaMigrationConfigFeatures")||"",a.Source.Slot);a.default.import(c.default&&c.default.omicron&&c.default.omicron.Config,a.Source.Omicron);if(c.default.get("isFtrsConfigurable")){var e=window.location.search.match(/[?&]ftrs=([^&]*)/);if(e){try{var f=window.decodeURIComponent(e[1]);a.default.importFromString(f,a.Source.GetParam)}catch(a){console.log(a)}}}});define("service/radars/ductus",["exports","@mail/features","helpers/define-utils","logger","request","cfg","cfgUser","service/auth","service/getModule","../../init/features"],function(exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var i=q(a);var j=q(c);var k=q(d);var l=q(e);var m=q(f);var n=p(g);var o=q(h);function p(a){if(a&&a.__esModule){return a}else{var b={};if(a!=null){for(var c in a){if(Object.prototype.hasOwnProperty.call(a,c))b[c]=a[c]}}b.default=a;return b}}function q(a){return a&&a.__esModule?a:{default:a}}var r=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};function s(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var t=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var u="octavius";var v=1e3;var w=v*60;var x=w*60;var y=24*x;(0,b.defineExternalForSyncUse)("features",i.default);(0,b.defineExternalForSyncUse)("request",k.default);(0,b.defineExternalForSyncUse)("cfg",l.default);(0,b.defineExternalForSyncUse)("cfgUser",m.default);(0,b.defineExternalForSyncUse)("service/auth",n);var z=function(){function a(){var b=this;s(this,a);this.handlePerformanceLogReady=this.handlePerformanceLogReady.bind(this);var c=null;this.ductusPromise=new Promise(function(a){c=a});(0,o.default)("ductus/ductus-octavius").then(function(a){b.ductusDispatch=a.standalone({project:u,config:{traffic:{timings:[{"1m":w},{"5m":5*w},{"10m":10*w},{"1h":x},{"1d":y},{"2d":2*y}]},performanceLog:{sessionStorage:i.default.has("perflog_session_storage"),chunkLength:parseInt((i.default.get("perflog_chunk_length")||{}).data,10),chunks:parseInt((i.default.get("perflog_chunks")||{}).data,10),onReady:b.handlePerformanceLogReady}}});c()})}t(a,[{key:"dispatch",value:function a(b){var c=this;try{if(typeof this.ductusDispatch!=="function"){this.ductusPromise.then(function(){c.dispatch(b)});return}this.ductusDispatch({type:b.type,payload:r({},b)})}catch(a){console.error(a);j.default.add(a)}}},{key:"loadPerformanceLog",value:function a(){try{if(this.ductusLoadPerformanceLog){return this.ductusLoadPerformanceLog()}}catch(a){console.error(a);j.default.add(a)}return{ductusError:"no performance log"}}},{key:"handlePerformanceLogReady",value:function a(b){this.ductusLoadPerformanceLog=b}}]);return a}();exports.default=z});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/radars/index",["require","exports","@mail/radars-decorator","@mail/xray","mail/Folder","service/auth","service/radars/defaults","service/radars/ductus"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createConfiguredRadar=exports.radarService=void 0;a=__importStar(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);var g=/:/g;var h="_";function i(a){return a.replace(g,h)}function j(a){return i(a.filter(function(a){return a}).join(h))}function k(a,b){var c;if(Array.isArray(a)){c=j(a);return{chain:c.split(h),type:c,value:b}}if(typeof a==="object"){if(Array.isArray(a.chain)){c=j(a.chain)}else{c=i(a.type)}return __assign(__assign({},a),{chain:c.split(h),type:c})}c=i(String(a));return{chain:c.split(h),type:c,value:b}}var l=function(){function g(){var b=this;this.send=this.send.bind(this);this.ductus=new f.default;this.RadarDecorator=a.default;a.default.addAdapter(a.FeastAdapter);a.default.defaults=e.default;a.default.register(function(a,c){b.send(k(c))})}g.prototype.init=function(a){this.layout=a};g.prototype.sendLoadInfo=function(a,b){this.send({type:"hit",meta:{socialBind:d.default.user.get("social_bind")}});this.send({type:"send_timings",data:{loadTime:a,timers:b}});var c=d.default.user.get("parental_control_mode");if(c&&c!=="off"){this.send({type:"hit_pcm",intervals:[[c,1]]})}};g.prototype.sendArchiveFoldersInfo=function(){var a=c.default.all;a===null||a===void 0?void 0:a.forEach(function(a){if(a.isArchive()&&!a.isSystem()){b.default.send("user-have-archive-folder",{dwh:{id:a.id}})}})};g.prototype.send=function(a,b,e){if(b===void 0){b=1}var f=k(a,b);f.value=f.value==null?1:f.value;f.meta=f.meta&&typeof f.meta==="object"?f.meta:{};if(this.layout){f.meta.layoutSize=this.layout.size;f.meta.layoutType=this.layout.getType()==="2pane"?"2":"3";f.meta.layoutSettingsType=this.layout.getUiLayout().type==="2pane"?"2":"3"}var g=d.default.user;f.meta.email=g&&g.getEmail();f.meta.themeId=g&&g.get("theme");f.meta.folders=c.default.all;if(e){f.data={};Object.keys(e).forEach(function(a){f.data[a]=e[a]})}this.ductus.dispatch(f)};g.prototype.loadPerformanceLog=function(){return this.ductus.loadPerformanceLog()};return g}();exports.radarService=new l;function m(a){var b=a.prefix,c=a.radar,d=c===void 0?exports.radarService.send:c,e=a.data,f=e===void 0?null:e;var g=b!==undefined;return function a(c,e){if(!g&&!f){return d(c,e)}if(Array.isArray(c)){c=__spreadArray([b],c,true);return d({chain:c,data:f},e)}if(typeof c==="object"){var h=c.chain||c.type.split("_");return d(__assign(__assign({},c),{chain:__spreadArray([b],h,true),data:f}))}return d({type:"".concat(b,"_").concat(c),data:f},e)}}exports.createConfiguredRadar=m;exports.default=exports.radarService.send});define("polyfills/closest/closest",[],function(){"use strict";if(!Element.prototype.matches){Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector}if(!Element.prototype.closest){Element.prototype.closest=function a(b){var c=this;if(!document.documentElement.contains(c)){return null}do{if(c.matches(b)){return c}c=c.parentElement||c.parentNode}while(c!==null&&c.nodeType===1);return null}}});define("polyfills/contains-node/contains-node",[],function(){"use strict";if(!Selection.prototype.containsNode||/Edg/.test(navigator.userAgent)){Selection.prototype.containsNode=function a(b){var c=document.getSelection();if(c.isCollapsed){return false}var d=c.anchorNode;var e=c.focusNode;if(d.nodeType===Node.TEXT_NODE&&d===b){return true}if(d.nodeType===Node.ELEMENT_NODE&&d.contains(b)){return true}if(e.nodeType===Node.TEXT_NODE&&e===b){return true}if(e.nodeType===Node.ELEMENT_NODE&&e.contains(b)){return true}var f=c.getRangeAt(0);var g=document.createRange();g.selectNode(b);var h=f.compareBoundaryPoints(Range.END_TO_END,g)!==-1;var i=f.compareBoundaryPoints(Range.START_TO_START,g)!==1;if(h&&i){return true}return false}}});define("polyfills/matchMedia/macthMedia",[],function(){"use strict";if(!Object.getPrototypeOf(matchMedia("")).addEventListener){Object.getPrototypeOf(matchMedia("")).addEventListener=function(a,b){this.addListener(b)}}if(!Object.getPrototypeOf(matchMedia("")).removeEventListener){Object.getPrototypeOf(matchMedia("")).removeEventListener=function(a,b){this.removeListener(b)}}});define("polyfills/index",["./closest/closest","./contains-node/contains-node","./matchMedia/macthMedia"],function(){"use strict"});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/shortcut",["require","exports","feast"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);var b={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"+":107,"[":219,"]":221,"\\":220,"|":220,"?":191,"&":55};var c={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91,cmd:91};var d={Up:"↑",Down:"↓",Left:"←",Right:"→"};var e=/Up|Down|Left|Right/;function f(a){return b[a]||a.toUpperCase().charCodeAt(0)}function g(a){var b,d,e,g,h,i,j,k,l;var m=[];b=a.replace(/\s/g,"");if(!b){return m}var n=b.split("',");for(h=0;h<n.length;h++){l="";d=n[h].split(":");if(d[d.length-1]==""){d[d.length-2]+=":";d.pop()}if(d.length==2){d[1]=d[1].replace(/'/g,"");if(d[1]&&d[1]!="true"){l=d[1]}}d=d[0];d=d.split("|");if(d[d.length-1]==""){d[d.length-2]+="|";d.pop()}for(i=0;i<d.length;i++){b=d[i];e=b.split(",");if(e[e.length-1]==""){e[e.length-2]+=",";e.pop()}k={shortcut:b};b=e[0].split("+");if(b[b.length-1]==""){b[b.length-2]+="+";b.pop()}g=[];if(b.length>1){g=b.slice(0,b.length-1);for(j=0;j<g.length;j++){g[j]=c[g[j]]}b=[b[b.length-1]]}b=b[0];k.code=f(b);k.mods=g;if(e.length==2){k.sequence=f(e[1])}if(l){k.uiname=l}m.push(k)}}return m}function h(a){var b=a.target||a.srcElement,c=b.tagName;return!(c=="INPUT"||c=="SELECT"||c=="TEXTAREA"||b.isContentEditable)}function i(a,b){for(var c=0;c<b.length;c++){if(b[c]==a){return true}}return false}var j=function(){function f(){this.el=document;this._handlers={};this.service=true;this._collection=this.el.getElementsByClassName("js-shortcut");this._stopSequence=this._stopSequence.bind(this);this._keydownHandler=this._keydownHandler.bind(this);document.addEventListener("keydown",this._keydownHandler)}f.prototype._keydownHandler=function(a){var c=window.key;if(!h(a)||a.isDefaultPrevented()||a.keyCode==b["esc"]&&(!c||c.getScope()!="all")){return}var d=a.keyCode;var e=this._collection;var f=this._getPressedModes(a);var g,i=0,j;for(i;i<e.length;i++){g=e[i];j=this._compareKey(d,this.getShortcuts(g),f);if(j){a.preventDefault();if(j.sequence&&!this._isSequence()){this._startSequence(d);break}else{if(this._doAction(g,j)){if(typeof Event==="function"){var k=new Event("ui-abstract-action");g.dispatchEvent(k)}else{var k=document.createEvent("CustomEvent");k.initCustomEvent("ui-abstract-action",false,false,undefined);g.dispatchEvent(k)}break}}}}};f.prototype.getShortcuts=function(a){var b=this.getShortcutAttribute(a);var c=this._handlers;if(!c[b]){c[b]=g(b)}return c[b]};f.prototype._getPressedModes=function(a){var b=[];if(a.shiftKey){b.push(c["shift"])}if(a.altKey){b.push(c["alt"])}if(a.ctrlKey){b.push(c["ctrl"])}if(a.metaKey){b.push(c["cmd"])}return b};f.prototype._compareKey=function(a,b,c){var d=false,e,f,g,h;for(f=0;f<b.length;f++){e=b[f];if(this._isSequence()){d=a==e.sequence}else if(a==e.code){d=true;h=e.mods;for(g=0;g<h.length;g++){if(!i(h[g],c)){d=false;break}}if(c.length>h.length){d=false}}if(d){d=e;break}}return d};f.prototype._startSequence=function(a){if(!this._isSequence()){this._sequenceCode=a;this._sequence=setTimeout(this._stopSequence,1e3)}};f.prototype._stopSequence=function(){clearTimeout(this._sequence);this._sequence=-1;this._sequenceCode=-1};f.prototype._isSequence=function(){return this._sequence>0};f.prototype.getShortcutAttribute=function(b){var c=a.default.Block.get(b);var d=c?c.get("shortcut"):b.getAttribute("data-shortcut");return d||""};f.prototype.getShortcutItems=function(){return this._collection};f.getShortcutTitle=function(a,b){if(b===void 0){b=false}if(!a){return""}if(b===undefined){b=!!navigator.userAgent.match(/\bMac\b/)}a=a.replace(/\s/g,"").replace(/command/g,"cmd");if(a!="|"&&a.includes("|")){if(b&&a.includes("cmd")){a=a.split("|");for(var c=0;c<a.length;c++){if(a[c].includes("cmd")){a=a[c];break}}}else{a=a.split("|")[0]}}if(a.includes(":'true'")){a=a.split(":'true'")[0];a=a.split("',");a=a[a.length-1]}if(a.includes(":'")){return""}return f.formatShortcutHint(a)};f.formatShortcutHint=function(a){var b="";var c=[];if(a){if(a!=","&&a.includes(",")){c=a.split(",");b=c.map(f.formatShortcutHint).join(", ")}else{c=a.split("+");b=c.map(function(a){return a.slice(0,1).toUpperCase()+a.slice(1).toLowerCase()}).join("+")}}if(b.match(e)){for(var g in d){b=b.replace(g,d[g])}}return b};return f}();exports.default=j});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mixins/shortcut-title",["require","exports","feast","helpers/browser","service/shortcut"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.onlyMixin=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.onlyMixin="shortcut-title";a.default.tags.$mixins[exports.onlyMixin]=function(a,d){if(b.default.mac&&d["shortcut-mac"]){d.shortcut=d["shortcut-mac"]}var e=d.shortcut||d["dropdown-shortcut"];if(e){var f=c.default.getShortcutTitle(e);if(f){d["title-shortcut"]="".concat(f)}}}});define("setup",["exports","@mail/features","Action","cfg","feast","helpers/querystring","mail/Folder","mail/MessageFormData/Transport","request","RPC","RPC/statuses/processing","RPC/statuses/sdc","RPC/statuses/secure_folder","RPC/statuses/token","service/radars/index","./polyfills/index","setimmediate","mixins/shortcut-title","feast-extension/qa","feast-extension/a11y","feast-extension/promo","./init/features"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.RPC=undefined;var o=C(a);var p=C(b);var q=C(c);var r=C(d);var s=C(e);var t=C(f);var u=C(g);var v=C(h);var w=C(i);var x=C(j);var y=C(k);var z=C(l);var A=C(m);var B=C(n);function C(a){return a&&a.__esModule?a:{default:a}}var D=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var E=(0,s.default)(location.href);var F=/Array|Object/;var G=new u.default;v.default.setup({safeMode:true});w.default.setup({safeMode:true,email:E["x-email"],timeout:0,baseUrl:"/api/",sdcUrl:q.default.get("urls.authUrl")+"/sdc",errorHandlers:[y.default,A.default,x.default,z.default]});w.default.serialize=function(a){for(var b in a){if(a.hasOwnProperty(b)){var c=a[b];if(F.test(a.toString.call(c))){a[b]=JSON.stringify(c)}}}return a};var H=w.default.Request.prototype.end;w.default.Request.prototype.end=function a(b,c){if(Array.isArray(c)&&c[0]==="AjaxResponse"){c={status:c[1]==="OK"?"200":"400",body:c[2]};var d=void 0;for(var e=0;e<c.body.list.length;e++){d=c.body.list[e];if(!Array.isArray(d.n)){continue}d.id=[d.id].concat(d.n).join(";")}}if(!o.default.has("disable-uploader-replace")&&this.url.includes(G.getUrl("createCloudAttachment"))){var f=c,g=f.body;var h=g.loader_url;if(h&&/octavius/.test(location.host)){g.loader_url=h.replace(/\.e\./,".octavius.")}if(h&&/vk/.test(location.host)){g.loader_url=h.replace(/\.e\./,".vk.")}}return H.call(this,b,c)};if(typeof coreKeeper!=="undefined"){w.default.request.on("end",function(a,b){window.coreKeeper.api(b,{log5XX:o.default.has("log_5xx")})})}w.default.url=function(a){var b={};var c=o.default.getAsTypedArray("rpc-url",o.default.String,[],",");if(c){c.forEach(function(a){a=a.split(":");b[a[0]]=a[1]})}return function c(d,e){var f=d.split("?",2),g=D(f,2),h=g[0],i=g[1];var j=d;if(typeof b[h]==="string"){j=b[h]+(i===undefined?"":"?"+i)}return a.call(this,j,e)}}(w.default.url);p.default.on("folderSecure",function(){return Promise.reject()});p.default.on("complete",function(){return t.default.prototype.storage.clear()});var I=o.default.getAsInt("folder-max-level",0);if(I!==0){t.default.MAX_CHILD_LEVEL=I-1}r.default.PerformanceTrace.on("data",function(a){(0,B.default)({type:"feast_performance_trace",data:a.entries});a.clear()});exports.RPC=w.default;exports.default={}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("default-values",["require","exports","@mail/features","cfg","cfgUser","helpers/aboutAd","helpers/browser","temporary/force-3pane-exp","setup"],function(require,exports,a,b,c,d,e,f){"use strict";var g,h,i;var j,k,l;Object.defineProperty(exports,"__esModule",{value:true});exports.DARKOSHA_TABLE_BORDER_FIX_ENABLED=exports.LAZY_NONCRIT_TASKS_TIMEOUT=exports.PREINIT_ALL_MEDIATORS=exports.SHOW_ATTACH_SAFETY_STATUS_TOOLTIP=exports.EXTENSIONS_WHITE_LIST=exports.TIMEOUT_NEXT_ANIMATION=exports.TIMEOUT_FIRST_ANIMATION=exports.COUNT_REPLAY_ANIMATION=exports.ADV_3PANE_REDESIGN_V3=exports.SHOW_SENDER_EMAIL_IN_SPAM_FOLDER=exports.ADV_SIDEBAR_160_ON_WIDTH_1420=exports.ADV_SIDEBAR_160_ON_WIDTH_1800=exports.ADV_SIDEBAR_160_ALWAYS=exports.DELAY_CATEGORY_FEEDBACK_PLATE=exports.MAX_COUNT_SHOW_CATEGORY_FEEDBACK_PLATE=exports.USE_QUEUE_CATEGORY_FEEDBACK_PLATE=exports.COUNT_SHOW_PROMO_PUSH_PLATE_BEFORE_DELAY=exports.DELAY_PROMO_PUSH_PLATE=exports.USE_QUEUE_PROMO_PUSH_PLATE=exports.VIEWER_ATTACH_TEMP_CLOUD=exports.VIEWER_ATTACH_TEMP_CLOUDSTOCK=exports.NOTES_URL=exports.CREATE_NOTE_FROM_COMPOSE=exports.ENABLE_MOBILE_SEARCH_BUTTON=exports.BUTTON_MOVE_TO_SPAM_CANCEL_LEFT_POSITION=exports.BUTTON_MOVE_TO_SPAM_CANCEL_PRIMARY=exports.USE_NEW_MOBILE_FOLDERS_MODAL=exports.ENABLE_LETTER_FAST_ACTION_SWIPE=exports.DISABLE_LETTER_SWIPE=exports.SHOW_SIDEBAR_UNSUBSCRIBE_BUTTON_MOBILE=exports.SHOW_SIDEBAR_UNSUBSCRIBE_BUTTON=exports.SHOW_FD_CALENDAR_EXP_LETTER_LIST=exports.CHANGE_ICON_REMOVE_BUTTON_METATHREAD=exports.CHANGE_TEXT_REMOVE_BUTTON_METATHREAD_EMPTY=exports.CHANGE_TEXT_REMOVE_BUTTON_METATHREAD_DELETE=exports.CHANGE_TEXT_REMOVE_BUTTON_SIDEBAR=exports.THEMES_PATHS_V4=exports.LIGHT_DEFAULT_MODE_THEMES=exports.DARK_DEFAULT_MODE_THEMES=exports.DARK_MODE_THEMES=exports.SUPPORT_WIDGET_THEME_IDS=exports.APPLY_THEME_TIMEOUT=exports.USE_CUSTOM_THEME_PREVIEW_NAME=exports.WIDGET_QUOTA_TYPE=exports.QUOTA_URL=exports.DEFAULT_TODO_TASKS=exports.TODO_PING=exports.CALENDAR_PING=exports.WEATHER_PING=exports.IFRAME_MARUSIA_URL=exports.HAS_WIDGET_HEADER_TYPE=exports.WIDGET_HEADER_TYPE=exports.TODO_API_URL=exports.CALENDAR_GRAPHQL_API_URL=exports.CSAT_ANIMATION=exports.HIDE_DELIMITER=exports.WIDGET_COLUMN_DEFAULT_OPEN=exports.WIDGET_CALENDAR=exports.CALENDAR_URL=exports.SECURITY_CHECKUP_URL=exports.ACCOUNT_HOSTNAME=exports.SHOW_SECURITY_CHECKUP_LINK_IN_SETTINGS=exports.SHOW_PLATE_NEWSLETTER_MAILING_SUBCRIBE=exports.URL_OPEN_PROJECTS_NOTES=exports.NEW_TOOLBAR_PROJECTS_NOTES=exports.MOBILE_CSAT=exports.ENABLE_MOBILE_CSAT=exports.LOG_EMPTY_COLLECTORS=exports.WIDGET_COLUMN=exports.HIDE_CLEAR_BUTTON_ON_SPAM_FOLDER=exports.LETTER_SEND_CANCEL_TIMER_DISPLAY_TIME_AT_THE_END=exports.PROMO_NEW_TOOLBAR=exports.THEMES_PROJECT_NAME=exports.NEW_FEATURES_LANDING_HREF=exports.NEW_FEATURES_SHOW_COUNT=exports.NEW_FEATURES_MEGAFON_ICON=exports.NEW_FEATURES_BELL=exports.OAUTH_HOST=exports.ATTACH_SAFETY_STATUS_POSITION=exports.HAS_ATTACH_SAFETY_STATUS_BACKGROUND=exports.SHOW_ATTACH_SAFETY_STATUS=exports.ADS_MOVE_TOP_LINE_3PANE=exports.ADS_MOVE_TOP_LINE_2PANE=exports.ADS_MOVE_TOP_LINE=exports.THREAD_UPDATE_TIMEOUT=exports.SYNC_THREAD_UPDATES=exports.PROMO_DEBOUNCE_UPDATE=exports.PROMO_MANUAL_LOAD=exports.SMART_CARD_ML=exports.G_SELENT_OFF=exports.DISABLE_MOBILE_CONTACTS=exports.DISABLE_MOBILE_ACCOUNT_LOGOUT_ALERT=exports.DISABLE_MOBILE_ACCOUNT_CHANGE_AND_ADD=exports.DISABLE_MOBILE_ACCOUNT_SECURITY=exports.DISABLE_MOBILE_ACCOUNT_PROFILE=exports.CAN_SHOW_FOOTER_APP_TOOLBAR=exports.DISABLE_FOOTER_APP_TOOLBAR=exports.TRACKING_STATUS_PLATE=exports.SETTINGS_DROPDOWN_HIDE_SECURITY=exports.HREF_THEME_WIDGET_NEW_YEAR_2023=exports.CALENDAR_EMAIL_LIST=exports.SHOW_ICS_ATTACH_CALENDAR_LETTER=exports.HIDE_ICS_ATTACH=exports.VK_HELP_CHAT_ID=exports.SHOW_VK_HELP=exports.ENABLE_LETTERS_LIST_DIVIDER_SWITCHER=exports.DISABLE_LETTER_ITEM_FOLDER=exports.ENABLE_ADD_TAGS_TOUCH=exports.ORDER_BUTTONS=exports.SEARCH_CLEAR=exports.FAKE_GOS_TEMPLATE_SUGGESTION=exports.ACCENT_DISABLED_METATHREAD_SETTINGS_ITEM=exports.SPACE_AFTER_MORE=exports.FAKE_BUTTON_SIGNING=exports.ENABLE_LATEST_WITH_MONTHS_LETTERS_DIVIDERS=exports.ENABLE_SUBJECT_LETTERS_DIVIDERS=exports.ENABLE_AUTHOR_LETTERS_DIVIDERS=exports.ENABLE_AUTHOR_SEND_LETTERS_DIVIDERS=exports.ENABLE_LETTERS_DIVIDERS=exports.DISABLE_IMAGE_EXPANDER=exports.LOG_FISHING_DEINIT_ERROR=exports.ENABLE_METATHREAD_FILTERS_SHORTCUT=exports.TRANSLATE_ABOUT_AD=exports.PROMT_ABOUT_AD_RAW=exports.PROMT_ABOUT_AD_DEFAULT=exports.PROMT_LOGO_WITH_AD_DROPDOWN=exports.KASPERSKY_ABOUT_AD_RAW=exports.KASPERSKY_ABOUT_AD_DEFAULT=exports.KASPERSKY_LOGO_WITH_AD_DROPDOWN=exports.KASPERSKY_LOGO_HREF=exports.FAKE_BUTTON_DISCUSS_DOCUMENT=exports.TAGS_ORDER=exports.TAGS_COLORS=exports.ENABLE_TAGS=exports.FAKE_BUTTON_TYPE=exports.ENABLE_BACK_TO_LETTERS_SHORTCUT_3PANE=exports.DISABLE_METATHREAD_CAPS=exports.LETTER_META_SKELETON_WAIT_TIMEOUT=exports.LETTER_META_SKELETON_ENABLE=exports.CUSTOM_THEMES_PREVIEWS_PATHS=exports.SEARCH_PANEL_SIZE=exports.NEW_TOOLBAR=exports.SEARCH_PANEL_PORTAL=exports.SEARCH_PANEL_REACT=exports.ENABLE_HIDE_TRANSLATOR=exports.DISABLE_OCTOPUS_CREATE_FILTER=exports.SHOW_PROMO_PUSH_PLATE=exports.FAKE_CREATE_TODO=exports.WIDGET_ICONS_VARIANT=exports.HIDE_RECEIPTS_METATHREAD=exports.SMART_CARD_ICS=exports.B2B_INNER_ATTACHMENTS_NOTIFY=exports.GO_TO_ACTION_BUTTOM=exports.BACK_TO_PARENT_AT_EMPTY_LETTERS=exports.DESELECT_ALL_LABEL_STYLE=exports.PORTAL_MENU_CLEAR_METATHREAD=exports.PORTAL_MENU_MORE_FOLDER_ACTIONS=exports.BACK_TO_PARENT_SHORTCUT=exports.BACK_TO_PARENT_AT_LETTERS=exports.BACK_TO_PARENT_AT_LOGO=exports.BACK_TO_PARENT_POS=exports.METATHREAD_BACK_TO_INBOX=exports.LIGHT_COLOR_THEMES=exports.EMPTY_FOLDER_PLACEHOLDER=exports.EMPTY_FOLDER_PLACEHOLDER_ENUM=exports.SEARCH_SUGGESTS_DELAY_TIME=exports.SEARCH_SUGGESTS_DELAY=exports.ENABLE_COLOR_TAGS_SEARCH=exports.COLOR_TAGS=exports.FOLDERS_SORT_VARIATION=exports.HIDE_EMOJI_IN_SNIPPET_NEWSLETTER=exports.HIDE_EMOJI_IN_CORRESPONDENT_NEWSLETTER=exports.HIDE_EMOJI_IN_SUBJECT_NEWSLETTER=exports.HIDE_EMOJI_IN_METATHREAD=exports.HIDE_EMOJI_IN_SNIPPET=exports.HIDE_EMOJI_IN_CORRESPONDENT=exports.HIDE_EMOJI_IN_SUBJECT=exports.METATHREAD_REDIRECT=exports.VIEW_URL_IDS_VALIDATE_DISABLE=exports.MESSAGES_ID_REG_EXP=exports.ATTACHES_ID_REG_EXPS=exports.SHOW_CATEGORY_FEEDBACK_PLATE=exports.SETTINGS_DOCK_BROWSERSETTINGS_ENABLED=exports.MENTIONS_MARK=exports.ENABLE_MENTIONS=exports.R7_EXTENSIONS_FORMATS=exports.R7_VIEW_ENABLED=exports.UNSUBSCRIBE_IN_MORE_DROPDOWN=exports.UNSUBSCRIBE_INSTEAD_SPAM=exports.SEARCH_CATEGORIES=exports.USE_NEW_SEARCH_CATEGORY_FORMAT=exports.ENABLE_OFFICIAL_LETTERS=exports.CKE_QUOTE_PARSE_FIX_DISABLE=exports.HIDE_GAMES_METATHREAD=exports.HIDE_SCHOOL_METATHREAD=exports.HIDE_OFFICIAL_METATHREAD=exports.ENABLE_LIST_LETTER_ACTION_BUTTONS=exports.ATTACH_ANALYTICS_EXT_DISABLED=exports.THREAD_SWITCH_RACE_FIX=exports.HIDE_DISABLE_TO_MYSELF_METATHREAD=exports.HIDE_WEBVIEW_TITLE=exports.ASYNC_RENDER_REACT_IN_WP_BUILD=exports.USE_WEBPACK_BUILD=exports.HIDE_MESSAGE_SMART_REPLY_BY_ONLY_WIDTH=exports.HIDE_MESSAGE_SMART_REPLY=exports.HIDE_MESSAGE_FOOTER=exports.CSAT_TICK_TIMEOUT=exports.CSAT_THEME=exports.CSAT_TRIGGERS=exports.CSAT_AFTER_REG_DELAY_IN_SECONDS=exports.CSAT_SUCCESS_HIDE_TIMEOUT=exports.CSAT_FORCE_SHOW_SURVEY_ID=exports.CSAT_SURVEYS=exports.CSAT_DOMAIN=exports.CSAT_DRY_RUN=exports.CSAT_DISABLED=exports.AUTOMATED_SHOW_TRANSLATOR=exports.DISABLE_AUTOMATED_TRANSLATE=exports.DARK_MODE_ROLLBACK_ON_COPY=exports.DISABLE_GREEN_OFFICIAL_ON_LETTER_LIST=exports.SHOW_OFFICIAL_ON_LETTER_LIST=exports.SHOW_OFFICIAL_SENDER_PROMO=exports.DISABLE_GREEN_RELIABLE_ON_LETTER_LIST=exports.SHOW_RELIABLE_ON_LETTER_LIST=exports.SHOW_RELIABLE_SENDER_PROMO=exports.COMPOSE_FETCH_AUTOREPLY=exports.ADDRESSBOOK_ICO=exports.MOBILE_ADDRESSBOOK_URL=exports.DISABLE_COMPOSE_ATTACHMENT_CLICK=exports.HIDE_CHANGE_SIGNATURE=exports.HIDE_SETTINGS_BUTTON=exports.HIDE_CONTEXTMENU_SEARCH_BUTTON=exports.HIDE_CONTEXTMENU_ADD_CONTACT_BUTTON=exports.COMPOSE_ENABLE_TABLES=exports.COMPOSE_SHORT_ATTACH_PANEL=exports.COMPOSE_DISABLE_TOOLBAR=exports.COMPOSE_DISABLE_CLICKABLE_LABELS=exports.COMPOSE_HIDE_AVATAR=exports.COMPOSE_FOOTER_DROPDOWN=exports.HIDE_COMPOSE_WIDGETS=exports.HIDE_COMPOSE_CANCEL_BUTTON=exports.HIDE_NOTIFY_CLOSE_BUTTON=exports.DISABLE_DROPDOWN_ACTIONS_SHORTCUTS=exports.XXS_BREAKPOINT=exports.ENABLE_XXS_BREAKPOINT=exports.DISABLE_LEFT_COLUMN=exports.LASTSEEN_COMPOSE_ALLOW_GARAGE=exports.LASTSEEN_SHOW_TIME_STATUS=exports.LASTSEEN_ONLINE_STATUS=exports.LASTSEEN_DISABLE_PLATFORM=exports.LETTER_LASTSEEN_REQUEST=exports.LAST_SEEN_V2_ENABLE=exports.POLLING_ONLY_VISIBLE=exports.PROMT_LOGO_HREF=exports.PARENTAL_CONTROL_APPROVE_FOLDER_ID=exports.PARENTAL_CONTROL_DENY_FOLDER_ID=exports.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID=exports.PARENTAL_CONTROL_PRIVATE_FOLDER_IDS=exports.FORBID_EXCLUDED_FOLDERS_SEARCH=exports.FORBID_SPAM=exports.FORBID_FILTERS=exports.DISABLE_DELETE_FROM_TRASH=exports.TRASH_FOLDER_ID=exports.FORCE_PARENTAL_CONTROL_DIE=exports.ENABLE_MULTIPLE_FILTERS=exports.ENABLE_SORTING=exports.NOADS_BUTTON_SHOW_FORCE=exports.DEFAULT_AVATAR_SRC=exports.COMPOSE_TEMPLATES_URL=exports.COMPOSE_TEMPLATES_SUBJECTS=exports.COMPOSE_ALLOWED_TEMPLATES=exports.DISABLE_LETTER_HEADERS_BUTTON=exports.SHORTCUT_LEFT_COLUMN_LIMIT=exports.SHOW_RELOAD_BUTTON=exports.DISABLE_MARUSIA_IN_PORTAL=exports.URL_EXTRA_PARAMS=exports.VK_MAIL_OLD_MINI_APP_URL=exports.SWA_HOST=exports.JSAPI_BASE_URL=exports.MINI_APP_X_MOBILE=exports.MINI_APP_ID=exports.IS_VK_MINI_APP=exports.HIDE_HEADLINE=exports.USE_SINGLE_TAB_BLACKLIST_REGEXP=exports.USE_SINGLE_TAB_WHITELIST_REGEXP=exports.USE_SINGLE_TAB=exports.HIDE_LOGO=exports.METATHREAD_MOVE_TO_SPAN_NOTIFY_DURATION=exports.METATHREAD_MOVE_TO_SPAN_NOTIFY=exports.RESTORE_EXPIRED_ATTACHMENTS_TIME=exports.RESTORE_EXPIRED_ATTACHMENTS=exports.COMPOSE_EMOJI_FILTER=exports.QUOTA_SPACE_URL=exports.QUOTA_AD_URL=exports.QUOTA_GROUP=exports.USE_X_CALENDAR=exports.RENDER_COMPOSE_TO_BODY_START=exports.SHOW_UNSUBSCRIBE_AFTER_MOVE_TO_SPAM=exports.SHOW_UNSUBSCRIBE_AFTER_SPAM=exports.EMOJI_FALLBACK=exports.COMPOSE_EMOJI_RECENTLY_COUNT=exports.COMPOSE_EMOJI=exports.MESSAGES_ATTACHES_BLOBCLOUD_PATH=exports.MESSAGES_ATTACHES_BLOBCLOUD=exports.CLEANMASTER_MODAL_ACTIONS_DISABLED=exports.CKE_AUTOCORRECT_AFTER_DELETE_CONTENTS_DISABLED=exports.MARUSIA_READ_ALL_LETTERS=exports.CKE_CLIPBOARD_FIX=exports.RESIZER_DRAG_ICON_SHOWN=exports.LAZY_SMOKE_SCREEN_INIT=exports.PRELOAD_RELEASE_BUNDLES_FILTER=exports.CONTRAST_LOGO_THEMES=exports.SWBOX_TOKEN_UPDATE_INTERVAL=exports.EXPIRED_ATTACHES_TOOLTIP=exports.LIST_ADVERT_ANIMATION=exports.RADAR_PROJECT=exports.DND_IMAGES_PATH=exports.DND_CLOUD_FOLDER_CHOICE=exports.THEME_SOUZMULTFILM_MARUSIA=exports.DISABLE_DOMAIN_AUTHCHECK=exports.VK_DOMAIN=exports.VK_THEMES_LIST=exports.OCTAVIUS_PLACEHOLDERS_PATH=exports.IS_VK_HOST=exports.VK=exports.SENT_PAGE_NOTIFY=exports.ATTACH_WARNING_TOOLTIP=exports.EXPIRED_ATTACHES_DIE=exports.VK_MESSENGER_APP_ID=exports.VK_CONNECT_DOMAIN=exports.VK_OAUTH_DOMAIN=exports.VK_LOGIN_DOMAIN=exports.SWA_SUPERAPP_SILENT_URL=exports.VK_MESSENGER_LOGOUT=exports.VK_MESSENGER_SHOW_AUTH_NOTIFY=exports.VK_MESSENGER_DISABLE_SILENT_AUTH=exports.VK_MESSENGER_AUTH_THROTTLE=exports.VK_MESSENGER_ACTIVE_CHAT_STORAGE_KEY=exports.VK_MESSENGER_RESTORE_ON_REFRESH_DISABLED=exports.VK_MESSENGER_CHAT_HREF_BASE=exports.VK_MESSENGER_CHAT_ID_BY_EMAIL=exports.VK_MESSENGER_EXTERNAL=exports.VK_MESSENGER_CHECK_VK_AUTH=exports.DISABLE_VK_MESSENGER=exports.SWBOX_ANALYTICS_REQUEST=exports.ADVERT_FEEDBACK_TEXTS=exports.ADVERT_FEEDBACK_CONFIG2=exports.ADVERT_FEEDBACK=exports.NOTIFY_CLOSE_DELAY=exports.MONETA_PAYMENT_LETTER_URL_REGEXP=exports.LETTER_CONTENT_ADV_ENABLE=exports.WEBPUSH_METRIC_DISABLE=exports.HEADLESS_COUNTER=exports.CLOUD_HOST=exports.CLOUD_VIEWER_HOST=exports.CLOUD_VIEWER_TEMPORARY=exports.CLOUD_VIEWER_ENABLE_TYPE=exports.CLOUD_VIEWER_FILE_EXTS=exports.CLOUD_VIEWER_ATTACH_TYPES=exports.CLOUD_VIEWER_FILE_TYPES=exports.CLOUD_VIEWER_FORCE=exports.CLOUD_VIEWER_GROUP=exports.CloudViewerEnableType=exports.CLOUD_VIEWER_GROUPS=exports.FLAGS_AUTOSYNC_DEBOUNCE=exports.FLAGS_AUTOSYNC=exports.CANCELLATION_RESERVE_TIME=exports.SETTINGS_DOCK_CLEANMAILBOX_TITLE=exports.SETTINGS_DOCK_APPEARANCE_TITLE=exports.SETTINGS_DOCK_BROWSER_SETTINGS_TITLE=exports.SETTINGS_DOCK_CLEANMASTER_USE_UNSUBSCRIBE_TITLE=exports.SETTINGS_DOCK_CLEANMASTER_NOTIFY_DURATION=exports.SETTINGS_DOCK_CLEANMASTER_INLINE_DISABLED=exports.SETTINGS_DOCK_HIDE_CLEANMAILBOX=exports.SETTINGS_DOCK_START_FULL_SCREEN=exports.SETTINGS_DOCK_DISABLE_AUTO_EXPAND=exports.SETTINGS_DOCK_DISABLE_EXPAND_BUTTON=exports.SETTINGS_DOCK_30_50_MODE=exports.AMP_SENDER_METRICS=exports.DELAY_NO_DISCOUNTS_BLOCK=exports.DELAY_FOR_NEW_DISCOUNT=exports.PROMO_DISCOUNTS_COLORS=exports.SWBOX_LOG_SILENT_ERRORS=exports.SWBOX=exports.NEW_LETTER_LIST_3PANE=exports.NEW_LETTER_LIST=exports.NEW_LETTER_LIST_TOUCH_MODE=exports.THREAD_WITH_RELIABLE_MARK=exports.NEW_THREAD=exports.FORCE_DISABLE_NEW_THREAD=exports.NTFR_EXP_BACKOFF=exports.NTFR_RECONNECT_ON_FOCUS=exports.NTFR_INTERVALS=exports.WIDGET_PAYMENT_URL=exports.WIDGET_CALLS_URL=exports.WIDGET_TODO_URL=exports.WIDGET_X_CALENDAR_URL=exports.WIDGET_CALENDAR_URL=exports.WIDGET_ADDRESSBOOK_URL=exports.WIDGET_CLOUD_URL=exports.MARUSIA_SKILLSERVER_TEST=exports.MARUSIA_READ_LETTER=exports.LL_UNSUBSCRIBE_NEWSLETTERS_SHOW_LIMIT=exports.LL_UNSUBSCRIBE_NEWSLETTERS_SENDERS_LIMIT=exports.DISCOUNT_DESCRIPTION_FROM_SUBJECT=exports.ADV_NO_ADS_POSTMSG_URL=exports.ADV_NO_ADS_PROMO_URL=exports.ADV_OFF_MONTH_GROUP=exports.ADV_OFF_QUERY_GROUP=exports.ADV_OFF_CONTROL_GROUP=exports.ADV_OFF_NOTIFY_GROUP=exports.ADV_OFF_CLOUD_GROUP=exports.ADV_EXP_ID_SEND=exports.ADV_TARIFF_FEATURE=exports.ADV_DIRECT_READY_TIMEOUT=exports.ADV_WEB_PERF_EXP_ID=exports.ADV_EXP_ID=exports.SHOW_DEFINITELY_SPAM=exports.LOG_DATASOURCE_PROBLEMS=exports.FORCE_HIDE_PRIORITY_MESSAGES_SETTINGS=exports.FORCE_SHOW_PRIORITY_MESSAGES_READ_LETTER=exports.FORCE_SHOW_PRIORITY_MESSAGES_LIST_LETTERS=exports.ACTUAL_LETTERS_DEFAULT_NEWSLETTERS=exports.ACTUAL_LETTERS_DEFAULT_INBOX=exports.HAS_PRIORITY_MESSAGES=exports.CLOUD_TARIFFS_IFRAME_URL=exports.OVERSIZE_CLOUD_ATTACHES_MOCK_CLOUD=exports.OVERSIZE_CLOUD_ATTACHES_FOLDER=exports.OVERSIZE_CLOUD_ATTACHES=exports.ACTUAL_REASON_FEEDBACK=exports.CHANGE_EXPIRED_PASSWORD_URL=exports.COMPOSE_USER_LOADING_DISABLED=exports.DELAY_FOR_CANCELLATION=exports.COMPOSE_INIT_ADDRESSBOOK=exports.MIN_LETTER_HEIGHT_STICKY=exports.METATHREADS_SETTINGS_ORDER=exports.HIDE_NEWS_METATHREAD=exports.AUTOSAVE_DRAFT_TIMEOUT_SECONDS=exports.CALL_TITLE_BLINK_INTERVAL=exports.IS_COMPOSE_NATIVE_ATTACH_THUMB_ROTATION=exports.OK_RELOAD_SHADOW=exports.TWO_STEP_ENABLE_URL=exports.LL_UNSUBSCRIBE_NEWSLETTERS_TIMEOUT=exports.LL_UNSUBSCRIBE_NEWSLETTERS_INTERVAL=exports.LL_UNSUBSCRIBE_NEWSLETTERS=exports.PAYMENT_LETTER_UNIVERSAL=exports.DISCOUNTS_MOUSE_SCROLL=exports.PROMO_LOGO_MIN_WIDTH=exports.RESIZE_UPDATE_DEBOUNCE_TIME=exports.OK_RELOAD=exports.OK_RELOAD_TIMEOUT=exports.RELOAD_TIMEOUT=exports.IS_RESEND_DROPDOWN_DISABLED=exports.CSS_VARS_FALLBACK=exports.P2P_PROMO_SHOWN_RECENTLY=exports.DISCOUNTS_BLOCK_LIMIT=exports.DISCOUNTS_FLAG_NAME=exports.DISCOUNTS_BLOCK_DEFAULT=exports.DISCOUNTS_BLOCK=exports.USER_LAYOUT_ENABLE_METRICS=exports.USER_LAYOUT_SAVE_TO_STORAGE=exports.USER_LAYOUT_RESIZE_3PANE=exports.USER_LAYOUT_RESIZE=exports.WHITE_PORTAL_THEME=exports.WHITE_PORTAL_HAS_FLAG=exports.WHITE_PORTAL_AVAILABLE=exports.WHITE_PORTAL_NEWREG=exports.WHITE_PORTAL_FORCED=exports.SKIP_DWH=exports.ENABLE_ACTION_OVER_SELECTED=exports.FORGOT_PASSWORD_URL=exports.VISIBILITY_WATCHER_CONFIG=exports.NO_CSS_GRID_LOG_KAKTAM=exports.LAYER_METATHREAD_DISABLE=exports.SETTINGS_DROPDOWN_HIDE_SETTINGS=exports.SETTINGS_DROPDOWN_HIDE_CLEANMASTER=exports.SETTINGS_DROPDOWN_HIDE_NOTIFICATIONS=exports.FILTER_SETTINGS_DEFAULT_TEXT_VAR=exports.PORTAL_MENU_HEIGHT=exports.HEADLINE_HEIGHT=exports.LAST_SEEN_OMICRON=exports.LAST_SEEN_ENABLE=exports.MARUSIA_URL=exports.MARUSIA_LOGO=exports.SELECT_GEO_URL=exports.WEATHER_URL=exports.WELCOME_BLOCK_SNOOZE_INTERVAL=exports.WELCOME_BLOCK_SHOW_INTERVAL=exports.WELCOME_BLOCK_HIDE_GREETING_TIMEOUT=exports.WELCOME_BLOCK_UPDATE_WEATHER_INTERVAL=exports.WELCOME_BLOCK_SCROLL_HIDE_THRESHOLD=exports.WELCOME_BLOCK_DISABLED=exports.DARK_MODE_BACKGROUND_ASYNC=exports.KASPERSKY_ENG_LOGO_LANGS=exports.MAX_CLOUD_STOCK_SIZE_LIMIT=exports.DARK_MODE_SNEAKY=exports.DARK_MODE_FRAME_BUDGET=exports.DARK_MODE_ASYNC_THRESHOLD=exports.DARK_MODE_ASYNC=exports.DARK_MODE_MEDIA_QUERY=exports.DARK_MODE_BASE_COLOR=exports.CALLS_P2P_OUTGOING=exports.CALLS_BASE_URL=exports.CALLS_P2P=exports.OAUTH_CLIENT_ID=exports.CLOUD_LOAD_DIRECTORY=exports.CLOUD_HOME_URL=exports.CLOUD_OPEN_API_URL=exports.DND_NOTIFY_DURATION=exports.DND_CLOUD_SHARE=exports.DND_CLOUD_ENABLED=exports.DND_CLOUD_FILES_LIMIT=exports.LAYER_CONFIRM_FOLDER_CLEAR=exports.RENOVATOR_DISABLED=exports.SIDEBAR_MENU_LIST_CONFIG=exports.CKE_ATTACH_BASE64=exports.LAYER_UNSAFE_ATTACH=exports.DATES_METADATA=exports.BILLS_COUNTER_MAX=exports.BILLS_COUNTER_UPDATE_INTERVAL=exports.SIDEBAR_PAY_NOTIFICATION_BADGE_SMART=exports.LETTER_PREVIEW_RADAR=exports.LETTER_PREVIEWS_CONFIG=exports.LETTER_PREVIEWS=exports.MATCH_MEDIA_LOG=exports.COMPOSE_SLIDER_LAST_STEP_DELTA=exports.WORD_BREAK_IN_TOOLTIP=exports.SEARCH_SIDEBARS_SWAP=exports.ADV_SEARCH_SEND_QUERY=exports.ADV_SEARCH_EXP_ID=exports.SUGGEST_SEARCH_INTERNET_URL=exports.SUGGEST_SEARCH_INTERNET=exports.NAV_MY_FOLDERS_CONTAINER_ID=exports.SETTINGS_AUTOREPLY_LINK=exports.MESSAGE_SUGGESTS=exports.LETTER_DATA_WHITE_LIST=exports.LETTER_LIST_HIGHLIGHT_PHISHING=exports.PHISHING_ALERT=exports.FOLDER_MAX_CHILD_LEVEL_UI=exports.THEMES_WIDGET_CLOUDY_ENABLED=exports.PROMO_DOMAIN_CROSS_ENABLED=exports.PROMO_DOMAIN_HEADER=exports.SHOW_TODO_TOGGLE=exports.SIDEBAR_PAY_NOTIFICATION_BADGE=exports.ADV_SEND_MULTI_ACCOUNT_DISABLE=exports.ADV_SPECLINE_ENABLED=exports.ADV_SPECLINE_SLOTS=exports.DOMPURIFY=exports.THEMES_AVAILABLE=exports.FORCE_METATHREADS_EXP=exports.FORCE_METATHREADS_LETTER=exports.FORCE_METATHREADS=exports.METATHREADS_FORCED_EXP=exports.METATHREAD_TOMYSELF_SNIPPET_ITEMS_MAX_COUNT=exports.TODO_URL=exports.KASPERSKY=exports.MIMIC_IGNORE_HAS_WLIST=exports.NO_MIMIC_ON_ADBLOCK=exports.NO_MIMIC_ON_WLIST=exports.ADVERT_VIS_LOG=exports.ADVERT_VIS_CHECK=exports.RB_REGION_ID=exports.RB_PROVINCE_ID=exports.RB_COUNTRY_ID=exports.ADVERT_CPM_VALUES=exports.ADVERT_CPM_EXP=exports.ADVERT_CPM_RELOAD_CONF=exports.ADVERT_CPM_RELOAD=exports.ADVERT_XHR_RESTORE=exports.ADVERT_SCROLL_CONF=exports.ADVERT_SIDEBAR_SLEEP=exports.ADVERT_SCROLL=exports.IS_CHROME=exports.SUGGEST_FROM=exports.SMART_THREAD_FETCHING=exports.ARCHIVE_DISABLED=exports.OCTAVIUS_PREFETCH=exports.DEBUG_SERVER_TIMESTAMP=exports.DISABLE_TIME_CORRECTION=exports.IGNORE_LOCAL_TIME=exports.LETTER_FROM_FUTURE_LOG_KAKTAM=exports.LETTER_FROM_FUTURE_LOG_DATES=exports.LETTER_FROM_FUTURE_THRESHOLD_TIMESTAMP=exports.MAX_ATTACHES_SIZE_LIMIT=exports.PACKAGES_URL=exports.USER_LANG=exports.WIDGETS_SHOW_LIMIT_MAP=exports.WIDGETS_WITH_SHOW_LIMIT_THEME_IDS=exports.SETTINGS_DROPDOWN_HIDE_TO_MYSELF=exports.SUPPORTED_CUSTOM_METATHREADS=exports.SIGNATURE_URL=exports.SETTINGS_URL=exports.FILTERS_URL=exports.NOTIFICATIONS_URL=exports.CLEANMASTER_URL=exports.HELP_PAGINATOR=exports.HELP_TO_MYSELF=exports.HELP_METATHREADS=exports.HELP_THREADS=exports.HELP_3PANE=exports.HELP_URL=exports.IS_READLETTER_NATIVE_STICKY_DISABLED=exports.ENABLE_OPEN_TOUCH=exports.TOUCH_URL=exports.LOGIN_URL=exports.LOGIN_REDIRECT_URL=exports.LOGOUT_REDIRECT_URL=exports.ACCOUNT_CHANGE_URL=exports.LOGOUT_URL=exports.SECURITY_URL=exports.PROFILE_URL=exports.PORTAL_NAVI_DATA_URL=exports.SERVER_TIME=exports.BUILD=exports.PREFETCH_CORRESPONDENTS_DISABLE=exports.ADMAN_SEND_HAS_VK=exports.ADMAN_SEND_SYNC_IDS=exports.ADMAN_REINIT_ON_DETECT=exports.ADMAN_REINIT_ON_DIRECT_LOAD_ERROR=exports.ADMAN_USE_MIMIC_ON_DIRECT_LOAD_ERROR=exports.ADMAN_USE_DIRECT_LOAD_ERROR_CALLBACK_FOR_BLOCKER=exports.ADMAN_USE_DIRECT_LOAD_ERROR_CALLBACK=exports.EXTRA_SUGGEST_SEARCH=exports.COMPOSE_SEND_USER_TRACK_CONF=exports.COMPOSE_SEND_USER_TRACK=exports.FORCE_EXPANDED_ATTACHES_MAX_TEXT_LENGTH=exports.FORCE_EXPANDED_ATTACH_LIST=exports.COMPOSE_SEND_STAT=exports.DISABLE_FROM_MAIL_ATTACHES=exports.LIMIT_OF_THEME_RETRY=exports.CONFIRM_RECEIPT_HELP_URL=exports.CONFIRM_RECEIPT_HELP=exports.FORCE_CUSTOM_THREAD=exports.SPAM_HELP_DISABLED=exports.SETTINGS_DROPDOWN_HIDE_HELP=exports.HIDE_METATHREADS=exports.TRANSACTION_HEADER=exports.LIST_LETTER_ORDER=exports.ALL_ATTACHES_MAX_COUNT=exports.SEARCH_ALL_ATTACHES=exports.FAKE_NOTE_IN_CONTACTS=exports.LETTER_TO_YOURSELF=exports.DISABLE_HEAD_PRINT=exports.DISABLE_LETTER_FOOTER_CALENDAR=exports.DISABLE_LETTER_HEAD_CALENDAR=exports.DISABLE_LETTER_CALENDAR_NEWSLETTERS=exports.DISABLE_CALLS_ON_SENT_PAGE=exports.DISABLE_CALLS_TIP=exports.DISABLE_CALLS_COMPOSE_TIP=exports.CALLS_DISABLE_COMPOSE_BTN=exports.CALLS_DISABLE_LETTER_FOOTER_CALL=exports.CALLS_DISABLE_LETTER_HEAD_CALL=exports.CALLS_DISABLE_LETTER_CALL_NEWSLETTERS=exports.CALLS_DISABLE_LETTER_CALL=exports.CALLS_DISABLE_COMPOSE_DROPDOWN_CALENDAR=exports.CALLS_DISABLE_COMPOSE_DROPDOWN_CALL=exports.CALLS_DISABLE_COMPOSE_DROPDOWN_TOMYSELF=exports.CALLS_DISABLE_COMPOSE_DROPDOWN=exports.CALLS_CREATE_ROOM_TIMEOUT=exports.CALLS_CREATE_ROOM_URL=exports.CALLS=exports.DISABLE_PASSWORD_FOLDER_INFO=exports.DISABLE_CREATE_EVENT=exports.DISABLE_SAVE_IN_ARCHIVE=exports.SPECIAL_THIRD_SEPTEMBER=exports.PAY_IMAGE_VARIANT=exports.NEW_AB_COMPOSE_VIEW=exports.NEW_AB_SUGGEST=exports.DEFAULT_THEME_ID=exports.UNIQUE_THEME_ID_LIST=exports.HAS_UNIQUE_THEME_ID_LIST=exports.UNIQUE_THEME_ID=exports.HAS_UNIQUE_THEME_ID=exports.COMPOSE_SUBJECT_AUTOCOMPLETE=exports.RELEVANT_SEARCH=exports.RELEVANT_SEARCH_FTRS=exports.ADMAN_MIMIC_ON_FAIL_RETRY_COUNT=exports.ADV_FAST_AUTOUPDATE_TIMEOUT=exports.ADMAN_BROKER_IMMEDIATE_FETCH_TIMEOUT=exports.ADMAN_BROKER_DELAYED_FETCH_TIMEOUT=exports.ADV_IDLE_TIMEOUT=exports.ADV_FAST_UPDATE_TIMEOUT=exports.ADV_160_ON_SMALL_WIDTH=exports.DISABLE_TOOLTIPS=exports.ENABLE_WYSIWYG_STICKY=exports.WEBVIEW_DARK_THEME=exports.WEBVIEW=exports.IS_TOUCH_DEVICE=exports.TOUCH_MODE=exports.isVkTeamsWebview=exports.OCTAVIUS_MOBILE=exports.IS_TABLET=exports.WEBVIEW_MOBILE_MODE_ENABLED=exports.CATEGORY_FEEDBACK_SUBMENU_NOTIFY_DURATION=exports.CATEGORY_FEEDBACK_SUBMENU=exports.CATEGORY_FEEDBACK=exports.MAX_LAYOUT_WIDTH=exports.ENABLE_NAV_UP=exports.CAN_ENABLE_PAGINATOR=exports.LAYER_IFRAME_PARAMS=exports.LETTER_BODY_POPUP_ALLOWED=exports.VIEWERS_AVAILABLE=exports.VIEWER_EDITORS=exports.DISABLE_DOCS_PREVIEWS=exports.DISABLE_DOCUMENTS_EDIT=exports.VIEWER_OPEN_DOWNLOAD_IN_NEW_WINDOW=exports.DISABLE_DOCUMENTS_VIEW=exports.INACTIVE_TAB_RELOAD_DURATION=exports.STATUS_AUTO_CALL=exports.SAFE_URL_LETTERS=exports.MONETA_SANDBOX=exports.MONETA_BASE_URL=exports.MONETA_POST_MESSAGE_URL_REG_EXP=exports.PAYMENT_CENTER_KAKTAM=exports.PAYMENT_CENTER_NOT_HIDDEN=exports.ADDRESS_HEADER_CALENDAR=exports.ADDRESS_HEADER=exports.LIST_LETTER_PAYMENT_DIES_CLOSEABLE=exports.LIST_LETTER_PAYMENT_DIES_GMAP=exports.SHOW_LIST_LETTER_PAYMENT_DIES=exports.COMPOSE_WINDOW_ANIMATION=exports.SERVER_ERROR_URL=exports.ADV_SLOTS=exports.FOLDERS_SHARE_ENABLED=exports.DYNAMIC_FAVICON=exports.THREAD_LETTERS_LOAD_MORE_COUNT=exports.SEARCH_HIDE_CATEGORIES=exports.DISABLE_TRANSLATE=exports.IS_NEW_ADDRESSBOOK=exports.FILTER_SAVE_UPDATE_TIMEOUT=exports.PROGRESS_FACTOR_DOWNLOAD=exports.PROGRESS_FACTOR_UPLOAD=exports.PROGRESS_FACTOR_LOAD_START=exports.PROGRESS_FAKE_LOAD_FACTOR=exports.APPROX_REQUEST_DOWNLOAD=exports.APPROX_REQUEST_UPLOAD=exports.ENABLE_SEARCH_POLLING_2PANE_READMSG=exports.ENABLE_SEARCH_POLLING=exports.ADVERT_EASY_ADV_EXP=exports.ADVERT_EASY_ADV_DISABLED=exports.ADVERT_SIDEBAR_ROUNDED=exports.ADMAN_CUSTOM_LABEL=exports.ADV_LIST_UPDATE_CACHE=exports.ADV_LIST_METATHREAD_SPECIFIC_CONFIG=exports.ADV_LIST_METATHREAD_CONFIG=exports.ADV_LIST_DEFAULT_CONFIG=exports.ADV_LIST_FOLDER_CONFIG=exports.ADV_LIST_PREFETCH_COUNT=exports.USE_3PANE=exports.SETTINGS_CLEANMASTER_BUILTIN=exports.ALL_READ_BUTTON=exports.ALL_READ_METATHREADS_ONLY=exports.UNSUBSCRIBE_COUNT_ALL=exports.FEATURE_UNSUBSCRIBE=exports.MIMIC_ENDPOINT=exports.MIMIC_FORCE=exports.MIMIC_PARTNER_ID=exports.MIMIC_EXP_ID=exports.ADMAN_BLOCKER_IDS=exports.ADMAN_EXP_ID=exports.ENABLE_XRAY_ENCRYPTOR=exports.API_ENCRYPTOR_MIMIC_LIMIT=exports.API_ENCRYPTOR_CONFIG=exports.HONEYPOT_INTERVALS=exports.HONEYPOT=exports.SMOKESCREEN_LOCATORS=exports.ENABLE_WELTER=exports.ENABLE_SMOKESCREEN=exports.HIDE_TOYS=exports.BL_PROP_NAME=exports.TABLES_EXPANDER_POPUP=exports.IMAGES_EXPANDER_POPUP=exports.TABLES_EXPANDER=exports.IMAGES_EXPANDER=exports.FULL_ATTACH_THUMB_LIMIT=exports.CORRESPONDENTS_LIMIT=exports.CKE_AUTOCORRECT_ALPHABET_LIST=exports.CKE_DEFAULT_STYLES=exports.CKE_ENABLE_TAB=exports.COMPOSE_TRANSLATOR=exports.DISABLE_SAVE_TO_CLOUD=exports.COMPOSE_DISABLE_CLOUD_ATTACHES=exports.TRANSLATOR_REQUEST_TIMEOUT=exports.LETTER_CYRILLIC_PERCENT=exports.QUOTES_VERSION=exports.AMP_TIMEOUT=exports.AMP_REDIRECT_URL=exports.AMP_PROXY_HOST=exports.AMP_IFRAME_PATH=exports.ENABLE_AMP=exports.ENABLE_LOGGING=exports.IS_NATIVE_STICKY_DISABLED=exports.LAYER_SENT_PAGE_CONFIG=exports.STATUS_DEBOUNCE_TIMEOUT=exports.IS_DEBUG=exports.METATHREAD_LOAD_MORE_COUNT_MAX=exports.METATHREAD_LIMIT=exports.LIST_LIMIT=exports.IS_IOS=exports.IS_ANDROID=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);if(a.default.has("octavius-iframe-themes")&&(JSON.parse.name!=="parse"||JSON.parse.length!==2)){try{var m=document.createElement("iframe");document.body.appendChild(m);var n=m.contentWindow;var o=n.JSON.parse;m.remove();var p=function a(b,c){var d=[];for(var e=2;e<arguments.length;e++){d[e-2]=arguments[e]}try{return o.call.apply(o,__spreadArray([JSON,b,function(a,b){if(b instanceof n.Array){Object.setPrototypeOf(b,Array.prototype)}else if(b instanceof n.Object){Object.setPrototypeOf(b,Object.prototype)}if(c){return c(a,b)}return b}],d,false))}catch(a){if(a instanceof n.SyntaxError){Object.setPrototypeOf(a,SyntaxError.prototype)}throw a}};p.toString=o.toString.bind(o);JSON.parse=p}catch(a){}}a.default.setURLConfig({vars:{topLevelHost:b.default.urls.singleDomainName}});function q(a,b){if(!c.default||!c.default[a]){return b}return c.default[a]}exports.IS_ANDROID=a.default.getAsString("mobile-os")==="Android";exports.IS_IOS=a.default.getAsString("mobile-os")==="iPhone OS";exports.LIST_LIMIT=a.default.getAsInt("dataset_list_limit",100);exports.METATHREAD_LIMIT=a.default.getAsInt("metathreads-limit",10);exports.METATHREAD_LOAD_MORE_COUNT_MAX=a.default.getAsInt("metathreads-more",5);exports.IS_DEBUG=!!a.default.getAsInt("debug",0);exports.STATUS_DEBOUNCE_TIMEOUT=a.default.getAsInt("status-debounce-timeout",10);exports.LAYER_SENT_PAGE_CONFIG={delayVisible:a.default.getAsInt("layer_sent_page_delay_visible",30*1e3)};exports.IS_NATIVE_STICKY_DISABLED=a.default.has("is-native-sticky-disabled");exports.ENABLE_LOGGING=a.default.has("enable-logging");exports.ENABLE_AMP=a.default.has("enable-amp");exports.AMP_IFRAME_PATH=a.default.getAsURL("amp-iframe-path-v2",b.default.urls.ampIframePath||"about:blank");exports.AMP_PROXY_HOST=a.default.getAsURL("amp-proxy-host","");exports.AMP_REDIRECT_URL=b.default.urls.ampRedirectUrl||"about:blank";exports.AMP_TIMEOUT=a.default.getAsInt("amp-timeout",1e4);exports.QUOTES_VERSION=a.default.getAsInt("quotes-version",1);exports.LETTER_CYRILLIC_PERCENT=a.default.getAsInt("letter-cyrillic-percent",60);exports.TRANSLATOR_REQUEST_TIMEOUT=a.default.getAsInt("translation-request-timeout",6e3);exports.COMPOSE_DISABLE_CLOUD_ATTACHES=a.default.has("compose-disable-cloud-attaches");exports.DISABLE_SAVE_TO_CLOUD=a.default.has("disable-save-to-cloud");exports.COMPOSE_TRANSLATOR=a.default.has("compose-translator");exports.CKE_ENABLE_TAB=a.default.has("cke-enable-tab");exports.CKE_DEFAULT_STYLES=a.default.getAsString("cke-default-style");exports.CKE_AUTOCORRECT_ALPHABET_LIST=a.default.has("cke-autocorrect-alphabet-list");exports.CORRESPONDENTS_LIMIT=a.default.getAsInt("correspondents-limit",100);exports.FULL_ATTACH_THUMB_LIMIT=a.default.getAsInt("full-attach-thumb-limit",2);exports.IMAGES_EXPANDER=a.default.has("images-expander");exports.TABLES_EXPANDER=a.default.has("tables-expander");exports.IMAGES_EXPANDER_POPUP=a.default.has("images-expander-popup");exports.TABLES_EXPANDER_POPUP=a.default.has("tables-expander-popup");exports.BL_PROP_NAME=a.default.getAsString("bl-property-name");var r=a.default.has("hide-ads")||b.default[exports.BL_PROP_NAME]===false?exports.BL_PROP_NAME:false;exports.HIDE_TOYS=r;exports.ENABLE_SMOKESCREEN=a.default.has("smokescreen")&&!r;exports.ENABLE_WELTER=a.default.has("mimic-welter-enable");exports.SMOKESCREEN_LOCATORS=a.default.getAsTypedArray("smokescreen-locators",a.default.String,["dataset","draggable","scrollable","letter-list","list-letter-bait","layout","ll","nav","metathread","mt","slot","layer","notify-stack","js-letter-list-item","js-tooltip-direction_letter-bottom","js-tooltip-direction_right","js-tooltip-direction_left","js-tooltip-direction_top"]);exports.HONEYPOT=q("honeypot",[]);exports.HONEYPOT_INTERVALS=a.default.getAsTypedArray("honeypot-async",a.default.Int,[1e3,2e3,3e5],"|");exports.API_ENCRYPTOR_CONFIG=a.default.getAsArray("mimic-crypto-api",["plain","8192"],"|");exports.API_ENCRYPTOR_MIMIC_LIMIT=a.default.getAsInt("mimic-api-encryptor-limit",7e3);exports.ENABLE_XRAY_ENCRYPTOR=a.default.has("mimic-crypto-xray");exports.ADMAN_EXP_ID=a.default.getAsInt("adv-exp-id",null);exports.ADMAN_BLOCKER_IDS=a.default.getAsJSON("adv-blocker-ids",{default:null});exports.MIMIC_EXP_ID=a.default.getAsInt("mimic-exp-id");exports.MIMIC_PARTNER_ID=a.default.getAsInt("adman-mimic-partner-id");exports.MIMIC_FORCE=a.default.has("mimic-force");exports.MIMIC_ENDPOINT=a.default.getAsURL("mimic-endpoint","");exports.FEATURE_UNSUBSCRIBE=a.default.has("feature-unsubscribe");exports.UNSUBSCRIBE_COUNT_ALL=a.default.has("unsubscribe-count-all");exports.ALL_READ_METATHREADS_ONLY=a.default.has("all-read-metathreads-only");exports.ALL_READ_BUTTON=a.default.has("all-read-button");exports.SETTINGS_CLEANMASTER_BUILTIN=a.default.has("settings_cleanmaster_builtin");exports.USE_3PANE=a.default.has("use-3pane")||(0,f.needForce3Pane)();exports.ADV_LIST_PREFETCH_COUNT=a.default.getAsInt("adv-list-prefetch-count",1);exports.ADV_LIST_FOLDER_CONFIG=a.default.getAsJSON("adv-list-folder-config",{500015:{enable:"false"}});exports.ADV_LIST_DEFAULT_CONFIG=a.default.getAsJSON("adv-list-default-config",{enable:"true","3pane":{start:"0"},"2pane":{start:"0"}});exports.ADV_LIST_METATHREAD_CONFIG=a.default.getAsJSON("adv-list-metathread-config",{"3pane":{interval:"10",start:"4",enable:"true"},"2pane":{interval:"10",start:"4",enable:"true"}});exports.ADV_LIST_METATHREAD_SPECIFIC_CONFIG=a.default.getAsJSON("adv-list-metathread-specific-config",{});exports.ADV_LIST_UPDATE_CACHE=a.default.getAsInt("adv-list-update-cache",1e3*60*60);exports.ADMAN_CUSTOM_LABEL=a.default.has("adman-custom-label");exports.ADVERT_SIDEBAR_ROUNDED=a.default.has("advert-sidebar-rounded");exports.ADVERT_EASY_ADV_DISABLED=a.default.has("advert-easy-adv-disabled");exports.ADVERT_EASY_ADV_EXP=a.default.has("advert-easy-adv-exp");exports.ENABLE_SEARCH_POLLING=a.default.has("search-polling");exports.ENABLE_SEARCH_POLLING_2PANE_READMSG=a.default.has("search-polling-2pane-readmsg");exports.APPROX_REQUEST_UPLOAD=(g=a.default.getAsTypedArray("progress-bar",[a.default.Int,a.default.Int,a.default.Float,a.default.Float,a.default.Float,a.default.Float],[100,1e5,.6,.1,.4,.4],"|"),g[0]),exports.APPROX_REQUEST_DOWNLOAD=g[1],exports.PROGRESS_FAKE_LOAD_FACTOR=g[2],exports.PROGRESS_FACTOR_LOAD_START=g[3],exports.PROGRESS_FACTOR_UPLOAD=g[4],exports.PROGRESS_FACTOR_DOWNLOAD=g[5];exports.FILTER_SAVE_UPDATE_TIMEOUT=a.default.getAsInt("filter-save-update-timeout",200);exports.IS_NEW_ADDRESSBOOK=a.default.has("new-octavius-addressbook");exports.DISABLE_TRANSLATE=a.default.has("disable-translate");exports.SEARCH_HIDE_CATEGORIES=a.default.has("search-hide-categories");exports.THREAD_LETTERS_LOAD_MORE_COUNT=a.default.getAsInt("thread-letters-load-more-count",50);exports.DYNAMIC_FAVICON=a.default.has("dynamic-favicon");exports.FOLDERS_SHARE_ENABLED=a.default.has("share-folders");exports.ADV_SLOTS=r?Object.entries(a.default.getAsJSON("adv-new",{})).reduce(function(a,b){var c=b[0],d=b[1];if(d.counter){a[c]=d}return a},{}):a.default.getAsJSON("adv-new",{});exports.SERVER_ERROR_URL=a.default.getAsURL("server-error-page","/error-pages/500.html");exports.COMPOSE_WINDOW_ANIMATION=a.default.has("compose-window-animation");exports.SHOW_LIST_LETTER_PAYMENT_DIES=a.default.has("show-list-letter-payment-dies");exports.LIST_LETTER_PAYMENT_DIES_GMAP=a.default.getAsJSON("list-letter-payment-dies-gmap");exports.LIST_LETTER_PAYMENT_DIES_CLOSEABLE=a.default.has("list-letter-payment-dies-closeable");exports.ADDRESS_HEADER=a.default.has("address-header");exports.ADDRESS_HEADER_CALENDAR=a.default.has("address-header-calendar");exports.PAYMENT_CENTER_NOT_HIDDEN=a.default.has("payment-center-not-hidden");exports.PAYMENT_CENTER_KAKTAM=a.default.has("payment-center-kaktam");exports.MONETA_POST_MESSAGE_URL_REG_EXP=new RegExp(b.default.urls.monetaPostMessageUrlRegExp);exports.MONETA_BASE_URL="".concat(b.default.urls.monetaBaseUrl,"?region_id=").concat(c.default.regionId);exports.MONETA_SANDBOX=b.default.urls.monetaSandBox;exports.SAFE_URL_LETTERS=new RegExp(b.default.urls.safeUrlLetters.replace(/,/g,"|"));exports.STATUS_AUTO_CALL=a.default.getDuration("status-auto-call",120);exports.INACTIVE_TAB_RELOAD_DURATION=a.default.getDuration("inactive-tab-reload-duration",120);exports.DISABLE_DOCUMENTS_VIEW=a.default.has("disable-documents-view");exports.VIEWER_OPEN_DOWNLOAD_IN_NEW_WINDOW=exports.IS_IOS;exports.DISABLE_DOCUMENTS_EDIT=a.default.has("disable-documents-edit");exports.DISABLE_DOCS_PREVIEWS=a.default.has("disable-docs-previews");exports.VIEWER_EDITORS=a.default.getAsJSON("viewer-editors",{});exports.VIEWERS_AVAILABLE=a.default.getAsTypedArray("viewers-available",a.default.String,["ms","docs"]);exports.LETTER_BODY_POPUP_ALLOWED=b.default.urls["payment-popup-list-params"]||{};exports.LAYER_IFRAME_PARAMS=((k=(j=c.default.config)===null||j===void 0?void 0:j.payments)===null||k===void 0?void 0:k["layer-iframe-params"])||{};exports.CAN_ENABLE_PAGINATOR=a.default.has("paginator");exports.ENABLE_NAV_UP=a.default.has("nav-up");exports.MAX_LAYOUT_WIDTH=a.default.getAsInt("max-layout-width",2150);exports.CATEGORY_FEEDBACK=a.default.has("category-feedback");exports.CATEGORY_FEEDBACK_SUBMENU=a.default.has("category-feedback-submenu");exports.CATEGORY_FEEDBACK_SUBMENU_NOTIFY_DURATION=a.default.getAsInt("category-feedback-submenu",6);exports.WEBVIEW_MOBILE_MODE_ENABLED=a.default.has("enable-webview-mobile-mode");exports.IS_TABLET=a.default.has("is-tablet")||e.default.hasTouchPointer()&&e.default.mac;exports.OCTAVIUS_MOBILE=a.default.has("octavius-mobile");exports.isVkTeamsWebview=exports.WEBVIEW_MOBILE_MODE_ENABLED&&(a.default.has("is-mobile-webview")||e.default.isTouchDevice());exports.TOUCH_MODE=exports.IS_TABLET||exports.isVkTeamsWebview||exports.OCTAVIUS_MOBILE;exports.IS_TOUCH_DEVICE=exports.IS_TABLET||exports.OCTAVIUS_MOBILE;exports.WEBVIEW=a.default.has("is-webview");exports.WEBVIEW_DARK_THEME=a.default.has("is-webview-dark-theme");exports.ENABLE_WYSIWYG_STICKY=!exports.IS_ANDROID;exports.DISABLE_TOOLTIPS=exports.IS_IOS;exports.ADV_160_ON_SMALL_WIDTH=a.default.has("adv-160");exports.ADV_FAST_UPDATE_TIMEOUT=a.default.getAsDuration("adv-fast-update-timeout",1e4);exports.ADV_IDLE_TIMEOUT=a.default.getAsDuration("adv-idle-timeout",3e5);exports.ADMAN_BROKER_DELAYED_FETCH_TIMEOUT=a.default.getAsDuration("adv-delayed-fetch-timeout",2e3);exports.ADMAN_BROKER_IMMEDIATE_FETCH_TIMEOUT=a.default.getAsDuration("adv-immediate-fetch-timeout",100);exports.ADV_FAST_AUTOUPDATE_TIMEOUT=a.default.getAsDuration("adv-fast-autoupdate-timeout",3e4);exports.ADMAN_MIMIC_ON_FAIL_RETRY_COUNT=a.default.getAsInt("adman-mimic-on-fail-retry-count",2);exports.RELEVANT_SEARCH_FTRS=a.default.getAsJSON("relevant-search",null);exports.RELEVANT_SEARCH=exports.RELEVANT_SEARCH_FTRS||{};exports.COMPOSE_SUBJECT_AUTOCOMPLETE=a.default.has("compose-subject-autocomplete");exports.HAS_UNIQUE_THEME_ID=a.default.has("user-unique-themeId");exports.UNIQUE_THEME_ID=a.default.getAsString("user-unique-themeId","default");exports.HAS_UNIQUE_THEME_ID_LIST=a.default.has("user-unique-themeId-list");exports.UNIQUE_THEME_ID_LIST=a.default.getAsString("user-unique-themeId-list","default");exports.DEFAULT_THEME_ID=a.default.getAsString("default-themeId",exports.UNIQUE_THEME_ID);exports.NEW_AB_SUGGEST=a.default.has("new-ab-suggests");exports.NEW_AB_COMPOSE_VIEW=a.default.has("new-ab-compose-view");exports.PAY_IMAGE_VARIANT=a.default.getAsString("pay-image-variant","1");exports.SPECIAL_THIRD_SEPTEMBER=a.default.has("special-third-september");exports.DISABLE_SAVE_IN_ARCHIVE=a.default.has("disable-save-in-archive");exports.DISABLE_CREATE_EVENT=a.default.has("disable-create-event");exports.DISABLE_PASSWORD_FOLDER_INFO=a.default.has("disable-password-folder-info");exports.CALLS=a.default.has("calls");exports.CALLS_CREATE_ROOM_URL=a.default.getAsString("calls-create-room-url","https://corsapi-test.imgsmail.ru/calls/api/v1/room");exports.CALLS_CREATE_ROOM_TIMEOUT=a.default.getAsInt("calls-create-room-timeout",3e3);exports.CALLS_DISABLE_COMPOSE_DROPDOWN=a.default.has("calls-disable-compose-dropdown");exports.CALLS_DISABLE_COMPOSE_DROPDOWN_TOMYSELF=a.default.has("calls-disable-compose-dropdown-tomyself");exports.CALLS_DISABLE_COMPOSE_DROPDOWN_CALL=a.default.has("calls-disable-compose-dropdown-call");exports.CALLS_DISABLE_COMPOSE_DROPDOWN_CALENDAR=a.default.has("calls-disable-compose-dropdown-calendar");exports.CALLS_DISABLE_LETTER_CALL=a.default.has("calls-disable-letter-call");exports.CALLS_DISABLE_LETTER_CALL_NEWSLETTERS=a.default.has("calls-disable-letter-call-newsletters");exports.CALLS_DISABLE_LETTER_HEAD_CALL=a.default.has("calls-disable-letter-head-call");exports.CALLS_DISABLE_LETTER_FOOTER_CALL=a.default.has("calls-disable-letter-footer-call");exports.CALLS_DISABLE_COMPOSE_BTN=a.default.has("calls-disable-compose_btn");exports.DISABLE_CALLS_COMPOSE_TIP=a.default.has("disable-calls-compose-tip");exports.DISABLE_CALLS_TIP=a.default.has("disable-calls-tip");exports.DISABLE_CALLS_ON_SENT_PAGE=a.default.has("disable-calls-on-sent-page");exports.DISABLE_LETTER_CALENDAR_NEWSLETTERS=a.default.has("disable-letter-calendar-newsletters");exports.DISABLE_LETTER_HEAD_CALENDAR=a.default.has("disable-letter-head-calendar");exports.DISABLE_LETTER_FOOTER_CALENDAR=a.default.has("disable-letter-footer-calendar");exports.DISABLE_HEAD_PRINT=a.default.has("disable-head-print");exports.LETTER_TO_YOURSELF=a.default.getAsString("letter-to-yourself");exports.FAKE_NOTE_IN_CONTACTS=a.default.getAsString("fake-note-in-contacts","");exports.SEARCH_ALL_ATTACHES=a.default.has("search-all-attaches");exports.ALL_ATTACHES_MAX_COUNT=a.default.getAsInt("search-all-attaches-max-count",5);exports.LIST_LETTER_ORDER=a.default.has("list-letter-order");exports.TRANSACTION_HEADER=a.default.getAsJSON("transaction-header",null);exports.HIDE_METATHREADS=a.default.has("hide-metathreads");exports.SETTINGS_DROPDOWN_HIDE_HELP=a.default.has("settings-dropdown-hide-help");exports.SPAM_HELP_DISABLED=a.default.has("confirm-receipt-help");exports.FORCE_CUSTOM_THREAD=a.default.has("force-custom-thread");exports.CONFIRM_RECEIPT_HELP=a.default.has("confirm-receipt-help");exports.CONFIRM_RECEIPT_HELP_URL=b.default.urls.confirmReceiptHelp||"https://help.mail.ru/mail-help/letters/write/helpful";exports.LIMIT_OF_THEME_RETRY=a.default.getAsInt("limit_of_theme_retry",3);exports.DISABLE_FROM_MAIL_ATTACHES=a.default.has("disable-from-mail-attaches");exports.COMPOSE_SEND_STAT=a.default.has("send-compose-stats");exports.FORCE_EXPANDED_ATTACH_LIST=a.default.has("force-expanded-attach-list");exports.FORCE_EXPANDED_ATTACHES_MAX_TEXT_LENGTH=a.default.getAsInt("force-expanded-attach-list",200);exports.COMPOSE_SEND_USER_TRACK=a.default.has("compose-send-user-track");exports.COMPOSE_SEND_USER_TRACK_CONF=a.default.getAsTypedArray("compose-send-user-track",a.default.Int,[100,200],"|");exports.EXTRA_SUGGEST_SEARCH=a.default.has("extra-suggest-search");exports.ADMAN_USE_DIRECT_LOAD_ERROR_CALLBACK=a.default.has("adman-direct-error-handle");exports.ADMAN_USE_DIRECT_LOAD_ERROR_CALLBACK_FOR_BLOCKER=a.default.has("adman-direct-error-blocker");exports.ADMAN_USE_MIMIC_ON_DIRECT_LOAD_ERROR=a.default.has("adman-direct-error-mimic");exports.ADMAN_REINIT_ON_DIRECT_LOAD_ERROR=a.default.has("adman-direct-error-reinit");exports.ADMAN_REINIT_ON_DETECT=a.default.has("adman-reinit-on-detect");exports.ADMAN_SEND_SYNC_IDS=!a.default.has("adman-disable-send-sync-ids");exports.ADMAN_SEND_HAS_VK=!a.default.has("adman-disable-send-has-vk");exports.PREFETCH_CORRESPONDENTS_DISABLE=a.default.has("prefetch-correspondents-disable");exports.BUILD=b.default.build;exports.SERVER_TIME=b.default.serverTime;exports.PORTAL_NAVI_DATA_URL=a.default.getAsURL("portal-navi-data-url","https://portal.${topLevelHost}/NaviData");exports.PROFILE_URL=a.default.getAsURL("profile-url","https://id.${topLevelHost}/profile");exports.SECURITY_URL=a.default.getAsURL("security-url","https://id.${topLevelHost}/security");exports.LOGOUT_URL=a.default.getAsURL("logout-url","https://auth.${topLevelHost}/cgi-bin/logout?next=1");exports.ACCOUNT_CHANGE_URL=a.default.getAsURL("account-change-url","https://auth.${topLevelHost}/cgi-bin/auth?Login=");exports.LOGOUT_REDIRECT_URL=b.default.urls.logoutRedirectUrl;exports.LOGIN_REDIRECT_URL=b.default.urls.loginRedirectUrl;exports.LOGIN_URL=a.default.getAsURL("login-url","https://account.${topLevelHost}/login");exports.TOUCH_URL=a.default.getAsURL("touch-url","https://touch.${topLevelHost}");exports.ENABLE_OPEN_TOUCH=a.default.has("enable-open-touch");exports.IS_READLETTER_NATIVE_STICKY_DISABLED=exports.IS_NATIVE_STICKY_DISABLED||a.default.has("is-readletter-native-sticky-disabled")||!e.default.supportedSticky;exports.HELP_URL=a.default.getAsURL("help-mail-url",b.default.urls.helpMailUrl||"https://help.mail.ru/mail");exports.HELP_3PANE=b.default.urls.help3PaneUrl;exports.HELP_THREADS=b.default.urls.helpThreadsUrl;exports.HELP_METATHREADS=b.default.urls.helpMetathreadsUrl;exports.HELP_TO_MYSELF=b.default.urls.helpToMyselfUrl;exports.HELP_PAGINATOR=b.default.urls.helpPaginatorUrl;exports.CLEANMASTER_URL=b.default.urls.cleanmasterUrl||"https://e.mail.ru/settings/cleanmaster?octaviusMode=1";exports.NOTIFICATIONS_URL=b.default.urls.notificationsUrl||"https://e.mail.ru/settings/general#notifications";exports.FILTERS_URL=b.default.urls.filtersUrl||"https://e.mail.ru/settings/filters";exports.SETTINGS_URL=a.default.getAsString("settings-url","https://e.mail.ru/settings/?octaviusMode=1");exports.SIGNATURE_URL=b.default.get("urls.signatureUrl")||"https://e.mail.ru/settings/general#signature";exports.SUPPORTED_CUSTOM_METATHREADS=a.default.getAsArray("supported_custom_metathreads",["tomyself"]);exports.SETTINGS_DROPDOWN_HIDE_TO_MYSELF=a.default.has("settings-dropdown-hide-to-myself");exports.WIDGETS_WITH_SHOW_LIMIT_THEME_IDS=a.default.getAsArray("widgets-with-show-limit-theme-ids",["t5001","t5003","t5004","t1169","t5002","t5005"]);exports.WIDGETS_SHOW_LIMIT_MAP={};exports.WIDGETS_WITH_SHOW_LIMIT_THEME_IDS.forEach(function(b){exports.WIDGETS_SHOW_LIMIT_MAP[b]=a.default.getAsInt("widget-show-limit-".concat(b),5)});exports.USER_LANG=c.default.LANG;exports.PACKAGES_URL=b.default.urls.packagesUrl;exports.MAX_ATTACHES_SIZE_LIMIT=a.default.has("max-attaches-size-limit")?a.default.getAsInt("max-attaches-size-limit",26214400):null;exports.LETTER_FROM_FUTURE_THRESHOLD_TIMESTAMP=a.default.getAsInt("letter-from-future-threshold-timestamp",0);exports.LETTER_FROM_FUTURE_LOG_DATES=a.default.getAsTypedArray("letter-from-future-log-dates",a.default.String,[],"|").map(function(a){return a.replace(/_/g," ")});exports.LETTER_FROM_FUTURE_LOG_KAKTAM=a.default.has("letter-from-future-log-kaktam");exports.IGNORE_LOCAL_TIME=a.default.has("ignore-local-time");exports.DISABLE_TIME_CORRECTION=a.default.has("disable-time-correction");exports.DEBUG_SERVER_TIMESTAMP=a.default.getAsInt("debug-server-timestamp",0);exports.OCTAVIUS_PREFETCH=a.default.has("octavius-prefetch");exports.ARCHIVE_DISABLED=a.default.has("archive-disabled");exports.SMART_THREAD_FETCHING=a.default.has("smart-thread-fetching");exports.SUGGEST_FROM=a.default.getAsJSON("suggest-from",null);exports.IS_CHROME=a.default.has("is_chrome");exports.ADVERT_SCROLL=a.default.has("advert-scroll");exports.ADVERT_SIDEBAR_SLEEP=a.default.has("advert-sidebar-sleep");exports.ADVERT_SCROLL_CONF=a.default.getAsTypedArray("advert-scroll",a.default.Int,[2,1,1],"|");exports.ADVERT_XHR_RESTORE=a.default.has("advert-xhr-restore");exports.ADVERT_CPM_RELOAD=a.default.has("advert-cpm-reload");exports.ADVERT_CPM_RELOAD_CONF=a.default.getAsTypedArray("advert-cpm-reload",a.default.Int,[1e3,0,1e3,0]);exports.ADVERT_CPM_EXP=a.default.getAsString("advert-cpm-exp","0");exports.ADVERT_CPM_VALUES=a.default.getAsTypedArray("advert-cpm-values",a.default.Int,[]);exports.RB_COUNTRY_ID=a.default.getAsString("rb-country-id");exports.RB_PROVINCE_ID=a.default.getAsString("rb-province-id");exports.RB_REGION_ID=a.default.getAsString("rb-region-id");exports.ADVERT_VIS_CHECK=a.default.getAsInt("advert-vis-check",3e3);exports.ADVERT_VIS_LOG=a.default.has("advert-vis-log");exports.NO_MIMIC_ON_WLIST=a.default.has("adv-no-mimic-on-wlist");exports.NO_MIMIC_ON_ADBLOCK=a.default.has("adv-no-mimic-on-adblock");exports.MIMIC_IGNORE_HAS_WLIST=!a.default.has("mimic-ignore-has-white-list-disabled");exports.KASPERSKY=a.default.has("kaspersky");exports.TODO_URL=a.default.getAsString("todo-url","https://todo.mail.ru");exports.METATHREAD_TOMYSELF_SNIPPET_ITEMS_MAX_COUNT=a.default.getAsInt("metathread_tomyself_snippet_items_max_count",3);exports.METATHREADS_FORCED_EXP=a.default.getAsString("octavius-notify-metathreads-forced",null);exports.FORCE_METATHREADS=a.default.has("force-metathreads");exports.FORCE_METATHREADS_LETTER=a.default.has("force-metathreads-letter");exports.FORCE_METATHREADS_EXP=a.default.has("force-metathreads-exp");var s=a.default.getAsJSON("themes-available",{});if(s.whitelist===undefined){s.whitelist=[]}var t=a.default.has("disable-default-theme");if(!t){s.whitelist.unshift("default")}if(s.colorized===undefined){s.colorized=true}exports.THEMES_AVAILABLE=s;exports.DOMPURIFY=a.default.has("dompurify");exports.ADV_SPECLINE_SLOTS=r?{}:a.default.getAsJSON("adv-specline",{});exports.ADV_SPECLINE_ENABLED=r?false:a.default.has("adv-specline-enabled");exports.ADV_SEND_MULTI_ACCOUNT_DISABLE=a.default.has("adv-send-multi-account-disabled");exports.SIDEBAR_PAY_NOTIFICATION_BADGE=a.default.has("sidebar-pay-notification-badge");exports.SHOW_TODO_TOGGLE=a.default.has("todo-toggle");exports.PROMO_DOMAIN_HEADER=a.default.getAsJSON("promo-domain-header",[]);exports.PROMO_DOMAIN_CROSS_ENABLED=a.default.has("promo-domain-cross-enabled");exports.THEMES_WIDGET_CLOUDY_ENABLED=a.default.has("themes-widget-cloudy-enabled");exports.FOLDER_MAX_CHILD_LEVEL_UI=4;exports.PHISHING_ALERT=a.default.getAsJSON("phishing-alert",{}).show==="true";exports.LETTER_LIST_HIGHLIGHT_PHISHING=!a.default.has("disable-letter-list-highlight-phishing");exports.LETTER_DATA_WHITE_LIST=a.default.getAsJSON("letter-data-white-list",{});exports.MESSAGE_SUGGESTS=a.default.has("message-suggests");exports.SETTINGS_AUTOREPLY_LINK=b.default.urls.settingsAutoReply||"/settings/autoreply";exports.NAV_MY_FOLDERS_CONTAINER_ID=a.default.getAsString("nav-my-folders-container-id","myFoldersContainer");exports.SUGGEST_SEARCH_INTERNET=a.default.has("suggest-search-internet");exports.SUGGEST_SEARCH_INTERNET_URL=a.default.getAsString("suggest-search-internet-url","https://go.mail.ru/search?gp=990009&frm=search_mail_sg");exports.ADV_SEARCH_EXP_ID=a.default.getAsString("adv-search-exp-id");exports.ADV_SEARCH_SEND_QUERY=a.default.has("adv-search-send-query");exports.SEARCH_SIDEBARS_SWAP=a.default.has("search-sidebars");exports.WORD_BREAK_IN_TOOLTIP=!a.default.has("disable-word-break-in-tooltip");exports.COMPOSE_SLIDER_LAST_STEP_DELTA=a.default.getAsInt("compose-slider-last-step-delta",10);exports.MATCH_MEDIA_LOG=a.default.has("match_media_log");exports.LETTER_PREVIEWS=a.default.has("letter-previews-config");exports.LETTER_PREVIEWS_CONFIG=a.default.getAsJSON("letter-previews-config",{"folders-list":[],"stubs-count":0,"show-previews":false,"go-on-server":false});exports.LETTER_PREVIEW_RADAR=a.default.has("letter-previews-radar");exports.SIDEBAR_PAY_NOTIFICATION_BADGE_SMART=a.default.has("sidebar-pay-notification-badge-smart");exports.BILLS_COUNTER_UPDATE_INTERVAL=a.default.getAsInt("bills-counter-update-interval",5*60);exports.BILLS_COUNTER_MAX=a.default.getAsInt("bills-counter-max",99);exports.DATES_METADATA=a.default.has("dates-metadata");exports.LAYER_UNSAFE_ATTACH=a.default.has("layer-unsafe-attach");exports.CKE_ATTACH_BASE64=a.default.has("cke-attach-base64");exports.SIDEBAR_MENU_LIST_CONFIG=a.default.getAsJSON("sidebar-menu-list-config",[{hidden:false,type:"calls"},{hidden:false,type:"cloud"},{hidden:false,type:"contacts"},{hidden:false,type:"calendar"},{hidden:false,type:"pay"},{hidden:false,type:"bonus"},{hidden:false,type:"todo"}]);exports.RENOVATOR_DISABLED=a.default.has("renovator-disabled");exports.LAYER_CONFIRM_FOLDER_CLEAR=a.default.getAsJSON("confirm-folder-clear-config",{inbox:true,tomyself:true,trash:true,child_trash:true,deleted:true});exports.DND_CLOUD_FILES_LIMIT=a.default.getAsInt("dnd-cloud-files-limit",100);exports.DND_CLOUD_ENABLED=a.default.has("dnd-cloud-enabled");exports.DND_CLOUD_SHARE=a.default.has("dnd-cloud-share");exports.DND_NOTIFY_DURATION=a.default.getAsInt("dnd-notify-duration",6);exports.CLOUD_OPEN_API_URL=b.default.urls.cloudOpenApiUrl||"https://openapi.cloud.mail.ru/api/v1/";exports.CLOUD_HOME_URL=b.default.urls.cloudHomeUrl||"https://cloud.mail.ru/home";exports.CLOUD_LOAD_DIRECTORY=b.default.urls.cloudLoadDirectory||"/Загрузки";exports.OAUTH_CLIENT_ID=a.default.getAsString("oauth-client-id","b4c073bb6c5a4b1b84d2c7d2a1bceb9b");exports.CALLS_P2P=a.default.has("calls_p2p");exports.CALLS_BASE_URL=b.default.urls.callsBaseUrl||"https://calls.mail.ru";exports.CALLS_P2P_OUTGOING=a.default.has("calls_p2p_outgoing");exports.DARK_MODE_BASE_COLOR=a.default.getAsJSON("dark_mode_base_color",{r:35,g:35,b:36});exports.DARK_MODE_MEDIA_QUERY=a.default.has("dark_mode_media_query");exports.DARK_MODE_ASYNC=a.default.getAsEnum("dark_mode_async",["true","false","auto"],"false");exports.DARK_MODE_ASYNC_THRESHOLD=a.default.getAsInt("dark_mode_async_threshold",100);exports.DARK_MODE_FRAME_BUDGET=a.default.getAsInt("dark_mode_frame_budget",20);exports.DARK_MODE_SNEAKY=a.default.has("dark_mode_sneaky");exports.MAX_CLOUD_STOCK_SIZE_LIMIT=a.default.getAsInt("max-cloud-stock-size",2*1024*1024*1024);exports.KASPERSKY_ENG_LOGO_LANGS=a.default.getAsTypedArray("kaspersky_eng_logo_langs",a.default.String,["en_US","es_ES"]);exports.DARK_MODE_BACKGROUND_ASYNC=a.default.has("dark_mode_background_async");exports.WELCOME_BLOCK_DISABLED=a.default.has("welcome-block-disabled");exports.WELCOME_BLOCK_SCROLL_HIDE_THRESHOLD=a.default.getAsInt("welcome-block-scroll-hide-threshold",1);exports.WELCOME_BLOCK_UPDATE_WEATHER_INTERVAL=a.default.getAsInt("welcome-block-update-weather-interval",10*60);exports.WELCOME_BLOCK_HIDE_GREETING_TIMEOUT=a.default.getAsInt("welcome-block-hide-greeting-timeout",5*60);exports.WELCOME_BLOCK_SHOW_INTERVAL=a.default.getAsInt("welcome-block-show-interval",60*60);exports.WELCOME_BLOCK_SNOOZE_INTERVAL=a.default.getAsInt("welcome-block-snooze-interval",24*60*60);exports.WEATHER_URL=b.default.urls.weatherUrl||"https://img.imgsmail.ru/static.promo/octavius/weather/";exports.SELECT_GEO_URL=b.default.urls.selectGeoUrl||"https://mail.ru/region";exports.MARUSIA_LOGO=b.default.urls.marusiaLogo||"https://img.imgsmail.ru/static.promo/octavius/welcome/marusia.png";exports.MARUSIA_URL=b.default.urls.marusiaUrl||"https://marusia.mail.ru/";exports.LAST_SEEN_ENABLE=a.default.has("ab-lastseen-octavius");exports.LAST_SEEN_OMICRON=a.default.getDataOrDefault("ab-lastseen-addressbook",null);exports.HEADLINE_HEIGHT="var(--vkui--octavius_size_headline_height--regular, 36px)";exports.PORTAL_MENU_HEIGHT="var(--vkui--octavius_size_portal-menu_height--regular, 56px)";if(((l=b.default.headline)===null||l===void 0?void 0:l.headlinePromoHeight)!==0){window.addEventListener("message",function(a){var c;if(a.origin.includes("https://limg.imgsmail.ru")&&a.data.close){document.documentElement.style.setProperty("--vkui--octavius_size_headline_height--regular","".concat((c=b.default.headline)===null||c===void 0?void 0:c.headlineHeight,"px"),"important")}})}exports.FILTER_SETTINGS_DEFAULT_TEXT_VAR=a.default.getDataOrDefault("filter-settings-default-text-var","0");exports.SETTINGS_DROPDOWN_HIDE_NOTIFICATIONS=a.default.has("settings-dropdown-hide-notifications");exports.SETTINGS_DROPDOWN_HIDE_CLEANMASTER=a.default.has("settings-dropdown-hide-cleanmaster");exports.SETTINGS_DROPDOWN_HIDE_SETTINGS=a.default.has("settings-dropdown-hide-settings");exports.LAYER_METATHREAD_DISABLE=a.default.has("layer-metathread-disable");exports.NO_CSS_GRID_LOG_KAKTAM=a.default.has("no-css-grid-log-kaktam");exports.VISIBILITY_WATCHER_CONFIG=a.default.getAsJSON("visibility-watcher-config",{errThreshold:4,checkTimeout:2e3,disabled:false});exports.FORGOT_PASSWORD_URL=a.default.getAsString("forgot-password-url","https://e.mail.ru/settings/folders");exports.ENABLE_ACTION_OVER_SELECTED=a.default.has("enable_action_over_selected");exports.SKIP_DWH=a.default.has("radar-skipdwh");exports.WHITE_PORTAL_FORCED=a.default.has("white_portal_forced");exports.WHITE_PORTAL_NEWREG=a.default.has("white_portal_newreg");exports.WHITE_PORTAL_AVAILABLE=a.default.has("white_portal_available");exports.WHITE_PORTAL_HAS_FLAG=a.default.has("white_portal_has_flag");exports.WHITE_PORTAL_THEME=a.default.getAsString("white_portal_theme","t6000");if(exports.WHITE_PORTAL_FORCED||exports.WHITE_PORTAL_NEWREG||exports.WHITE_PORTAL_AVAILABLE){exports.THEMES_AVAILABLE.whitelist.push(exports.WHITE_PORTAL_THEME)}exports.USER_LAYOUT_RESIZE=a.default.has("user-layout-resize")&&!exports.TOUCH_MODE;exports.USER_LAYOUT_RESIZE_3PANE=exports.USER_LAYOUT_RESIZE&&a.default.has("user-layout-resize-3pane");exports.USER_LAYOUT_SAVE_TO_STORAGE=exports.USER_LAYOUT_RESIZE&&!a.default.has("user-layout-disable-save-to-storage");exports.USER_LAYOUT_ENABLE_METRICS=!a.default.has("user-layout-disable-metrics");exports.DISCOUNTS_BLOCK=a.default.has("discounts-block");exports.DISCOUNTS_BLOCK_DEFAULT=a.default.has("discounts-block_default");exports.DISCOUNTS_FLAG_NAME=a.default.getAsString("discounts-flag-name","discounts-v2");exports.DISCOUNTS_BLOCK_LIMIT=a.default.getAsInt("discounts-block-limit",50);exports.P2P_PROMO_SHOWN_RECENTLY=a.default.getAsDuration("p2p_promo_show_recently_duration",7*24*60*60);exports.CSS_VARS_FALLBACK=a.default.has("css-vars-fallback");exports.IS_RESEND_DROPDOWN_DISABLED=a.default.has("resend-dropdown-disabled");exports.RELOAD_TIMEOUT=a.default.getAsTypedArray("deploy_switch_reload_timeout",a.default.Int,[1,60],",");exports.OK_RELOAD_TIMEOUT=a.default.getAsTypedArray("deploy_ok_reload_timeout",a.default.Int,exports.RELOAD_TIMEOUT,",");exports.OK_RELOAD=a.default.has("deploy_ok_reload");exports.RESIZE_UPDATE_DEBOUNCE_TIME=a.default.getAsDuration("resize-update-debounce-time",300);exports.PROMO_LOGO_MIN_WIDTH=a.default.getAsInt("promo-logo-min-width",210);exports.DISCOUNTS_MOUSE_SCROLL=a.default.getAsString("discounts_mouse_scroll","2pane");exports.PAYMENT_LETTER_UNIVERSAL=a.default.has("payment-letter-universal");exports.LL_UNSUBSCRIBE_NEWSLETTERS=a.default.has("ll-unsubscribe-newsletters");exports.LL_UNSUBSCRIBE_NEWSLETTERS_INTERVAL=a.default.getAsInt("ll-unsubscribe-newsletters-interval",60*60);exports.LL_UNSUBSCRIBE_NEWSLETTERS_TIMEOUT=a.default.getAsInt("ll-unsubscribe-newsletters-timeout",5);exports.TWO_STEP_ENABLE_URL=a.default.getAsURL("2fa_enable_url","https://account.mail.ru/user/2-step-auth/enable");exports.OK_RELOAD_SHADOW=a.default.has("deploy_ok_shadow");exports.IS_COMPOSE_NATIVE_ATTACH_THUMB_ROTATION=a.default.has("compose-native-thumb-rotation");exports.CALL_TITLE_BLINK_INTERVAL=a.default.getAsInt("call_title_blink_interval",0);exports.AUTOSAVE_DRAFT_TIMEOUT_SECONDS=a.default.getAsInt("autosave-draft-timeout-seconds",60);exports.HIDE_NEWS_METATHREAD=a.default.has("hide_news_metathread");exports.METATHREADS_SETTINGS_ORDER=a.default.getAsArray("metathreads-settings-order",["games","school","newsLetters","social","toMyself","receipts","news","official","inbox"]);exports.MIN_LETTER_HEIGHT_STICKY=a.default.getAsInt("min-letter-height-sticky",400);exports.COMPOSE_INIT_ADDRESSBOOK=a.default.has("compose-init-addressbook");exports.DELAY_FOR_CANCELLATION=a.default.has("delay-for-cancellation");exports.COMPOSE_USER_LOADING_DISABLED=a.default.has("compose-user-loading-disabled");exports.CHANGE_EXPIRED_PASSWORD_URL=a.default.getAsURL("change-expired-password-url","https://id.mail.ru/security");exports.ACTUAL_REASON_FEEDBACK=a.default.has("actual-reason-feedback");exports.OVERSIZE_CLOUD_ATTACHES=a.default.has("oversize-cloud-attaches");exports.OVERSIZE_CLOUD_ATTACHES_FOLDER=a.default.getAsString("oversize-cloud-attaches-folder",exports.CLOUD_LOAD_DIRECTORY);exports.OVERSIZE_CLOUD_ATTACHES_MOCK_CLOUD=a.default.has("oversize-cloud-attaches-mock-cloud");exports.CLOUD_TARIFFS_IFRAME_URL=b.default.urls.cloudTariffsIframeUrl||"https://cloud.mail.ru/uploader";exports.HAS_PRIORITY_MESSAGES=a.default.has("priority-messages");exports.ACTUAL_LETTERS_DEFAULT_INBOX=a.default.has("priority-messages_default");exports.ACTUAL_LETTERS_DEFAULT_NEWSLETTERS=a.default.has("priority-messages-default-newsletters");exports.FORCE_SHOW_PRIORITY_MESSAGES_LIST_LETTERS=a.default.has("force-show-priority-messages-list-letters");exports.FORCE_SHOW_PRIORITY_MESSAGES_READ_LETTER=a.default.has("force-show-priority-messages-read-letter");exports.FORCE_HIDE_PRIORITY_MESSAGES_SETTINGS=a.default.has("force-hide-priority-messages-settings");exports.LOG_DATASOURCE_PROBLEMS=a.default.has("log-datasource-problems");exports.SHOW_DEFINITELY_SPAM=a.default.has("show-definitely-spam");exports.ADV_EXP_ID=a.default.getAsString("adv-exp-id");exports.ADV_WEB_PERF_EXP_ID=a.default.getAsString("adv-web-perf-exp-id");exports.ADV_DIRECT_READY_TIMEOUT=a.default.getAsInt("adman-insert-context-timeout",1800);exports.ADV_TARIFF_FEATURE=a.default.getAsString("noadsPromoTariff");exports.ADV_EXP_ID_SEND=a.default.has("adv-exp-id-send");exports.ADV_OFF_CLOUD_GROUP=a.default.getAsArray("adv-off-cloud-group",["769"]);exports.ADV_OFF_NOTIFY_GROUP=a.default.getAsArray("adv-off-notify-group",["773"]);exports.ADV_OFF_CONTROL_GROUP=a.default.getAsArray("adv-off-control-group",["787"]);exports.ADV_OFF_QUERY_GROUP=a.default.getAsArray("adv-off-query-group",["789"]);exports.ADV_OFF_MONTH_GROUP=a.default.getAsArray("adv-off-month-group",["791"]);exports.ADV_NO_ADS_PROMO_URL=a.default.getAsString("no-ads-promo-url","https://cloud.mail.ru/promo/quota?feature=ad&utm_source=mail_disable_ad&utm_medium=cross-promo&utm_campaign=ed.quota#start");exports.ADV_NO_ADS_POSTMSG_URL=a.default.getAsString("no-ads-postmsg-url","https://promo.mail.ru");exports.DISCOUNT_DESCRIPTION_FROM_SUBJECT=a.default.has("discount-description-from-subject");exports.LL_UNSUBSCRIBE_NEWSLETTERS_SENDERS_LIMIT=a.default.getAsInt("ll-unsubscribe-newsletters-senders-limit",3);exports.LL_UNSUBSCRIBE_NEWSLETTERS_SHOW_LIMIT=a.default.getAsInt("ll-unsubscribe-newsletters-show-limit",3);exports.MARUSIA_READ_LETTER=a.default.has("marusia-read-letter");exports.MARUSIA_SKILLSERVER_TEST=a.default.has("marusia-skill-server-test");exports.WIDGET_CLOUD_URL=b.default.get("urls.widgetCloudUrl")||"https://cloud.mail.ru/?utm_source=octavius&utm_medium=widget_desk&utm_campaign=link_cloud";exports.WIDGET_ADDRESSBOOK_URL=exports.IS_NEW_ADDRESSBOOK?b.default.get("urls.octaviusAddressbookUrl"):b.default.get("urls.septimaAddressbookUrl")||"https://e.mail.ru/addressbook?from=mail&utm_source=octavius&utm_medium=widget_desk&utm_campaign=link_addressbook";exports.WIDGET_CALENDAR_URL=b.default.get("urls.widgetCalendarUrl")||"https://calendar.mail.ru/?utm_source=octavius&utm_medium=widget_desk&utm_campaign=link_calendar";exports.WIDGET_X_CALENDAR_URL=b.default.get("urls.widgetXCalendarUrl")||"https://x.calendar.mail.ru/?utm_source=octavius&utm_medium=widget_desk&utm_campaign=link_calendar";exports.WIDGET_TODO_URL=b.default.get("urls.widgetTodoUrl")||"https://todo.mail.ru/?from=mail&utm_source=octavius&utm_medium=widget_desk&utm_campaign=link_todo";exports.WIDGET_CALLS_URL=b.default.get("urls.widgetCallsUrl")||"https://calls.mail.ru/?utm_source=octavius&utm_medium=widget_desk&utm_campaign=link_calls";exports.WIDGET_PAYMENT_URL=b.default.get("urls.payMenuUrl")||"https://e.mail.ru/payment/center?from=mail&utm_source=octavius&utm_medium=widget_desk&utm_campaign=link_payment";exports.NTFR_INTERVALS=a.default.getAsJSON("ntfr_intervals",{keepalive:4*60*1e3,successConnect:4*60*1e3});exports.NTFR_RECONNECT_ON_FOCUS=a.default.has("ntfr_reconnect_on_focus");exports.NTFR_EXP_BACKOFF=a.default.getAsJSON("ntfr_exp-backoff",{minDelay:2*60*1e3,maxDelay:60*60*1e3,jitter:.4,factor:2});exports.FORCE_DISABLE_NEW_THREAD=a.default.has("force-disable-new-thread");exports.NEW_THREAD=a.default.has("use-new-thread")&&!exports.FORCE_DISABLE_NEW_THREAD;exports.THREAD_WITH_RELIABLE_MARK=a.default.has("thread-with-reliable-mark")&&!exports.TOUCH_MODE;exports.NEW_LETTER_LIST_TOUCH_MODE=a.default.has("new-letter-list-touch-mode");exports.NEW_LETTER_LIST=exports.NEW_LETTER_LIST_TOUCH_MODE?true:!exports.IS_TOUCH_DEVICE;exports.NEW_LETTER_LIST_3PANE=exports.NEW_LETTER_LIST&&!a.default.has("disable-new-letter-list-3pane");exports.SWBOX=a.default.has("swbox");exports.SWBOX_LOG_SILENT_ERRORS=a.default.has("swbox_log-silent-errors");exports.PROMO_DISCOUNTS_COLORS=a.default.getAsJSON("promo-discounts-colors",{});exports.DELAY_FOR_NEW_DISCOUNT=a.default.getAsDuration("delay-for-new-discounts",2*7*24*60*60);exports.DELAY_NO_DISCOUNTS_BLOCK=a.default.getAsInt("empty-discounts-block-delay",604800);exports.AMP_SENDER_METRICS=a.default.has("amp_fallback_sender_metric");exports.SETTINGS_DOCK_30_50_MODE=a.default.has("settings_dock_30_50_mode");exports.SETTINGS_DOCK_DISABLE_EXPAND_BUTTON=a.default.has("settings_dock_disable_expand_button");exports.SETTINGS_DOCK_DISABLE_AUTO_EXPAND=a.default.has("settings_dock_disable_auto_expand");exports.SETTINGS_DOCK_START_FULL_SCREEN=a.default.has("settings_dock_start_full_screen");exports.SETTINGS_DOCK_HIDE_CLEANMAILBOX=a.default.has("settings_dock_hide_cleanmailbox");exports.SETTINGS_DOCK_CLEANMASTER_INLINE_DISABLED=a.default.has("settings_dock_cleanmaster_inline_disabled");exports.SETTINGS_DOCK_CLEANMASTER_NOTIFY_DURATION=a.default.getAsInt("settings_dock_cleanmaster_notify_duration",5);exports.SETTINGS_DOCK_CLEANMASTER_USE_UNSUBSCRIBE_TITLE=a.default.has("settings_dock_cleanmaster_use_unsubscribe_title");exports.SETTINGS_DOCK_BROWSER_SETTINGS_TITLE=a.default.has("settings_dock_browser_settings_title");exports.SETTINGS_DOCK_APPEARANCE_TITLE=a.default.has("settings_dock_appearance_title");exports.SETTINGS_DOCK_CLEANMAILBOX_TITLE=a.default.has("settings_dock_cleanmailbox_title");exports.CANCELLATION_RESERVE_TIME=a.default.getAsInt("cancellation-reserve-time",10);exports.FLAGS_AUTOSYNC=a.default.has("flags_autosync");exports.FLAGS_AUTOSYNC_DEBOUNCE=a.default.getAsInt("flags_autosync_debounce",2e3);exports.CLOUD_VIEWER_GROUPS={CONTROL:0,MAIL:1,CLOUD:2};var u;(function(a){a["fileType"]="file_type";a["fileExt"]="file_ext"})(u=exports.CloudViewerEnableType||(exports.CloudViewerEnableType={}));exports.CLOUD_VIEWER_GROUP=a.default.getAsInt("exp-cloud-viewer-group",exports.CLOUD_VIEWER_GROUPS.CONTROL);exports.CLOUD_VIEWER_FORCE=a.default.has("exp-cloud-viewer-force");exports.CLOUD_VIEWER_FILE_TYPES=a.default.getAsArray("exp-cloud-viewer-file-types",[]);exports.CLOUD_VIEWER_ATTACH_TYPES=a.default.getAsArray("exp-cloud-viewer-attach-types",[]);exports.CLOUD_VIEWER_FILE_EXTS=a.default.getAsArray("exp-cloud-viewer-file-exts",[]);exports.CLOUD_VIEWER_ENABLE_TYPE=a.default.getAsString("exp-cloud-viewer-enable-type",u.fileType);exports.CLOUD_VIEWER_TEMPORARY=a.default.has("exp-cloud-viewer-temporary");exports.CLOUD_VIEWER_HOST=a.default.getAsString("exp-cloud-viewer-host","cloud.mail.ru");exports.CLOUD_HOST=a.default.getAsString("cloud-host","cloud.mail.ru");exports.HEADLESS_COUNTER=a.default.has("headless_counter");exports.WEBPUSH_METRIC_DISABLE=a.default.has("webpush_metric_disable");exports.LETTER_CONTENT_ADV_ENABLE=a.default.has("letter-content-native-advert-enable");exports.MONETA_PAYMENT_LETTER_URL_REGEXP=new RegExp(b.default.urls.monetaPaymentLetterUrlRegExp||"^https:\\/\\/e\\.mail\\.ru\\/");exports.NOTIFY_CLOSE_DELAY=a.default.getAsInt("notify_close_delay",4);exports.ADVERT_FEEDBACK=a.default.has("advert-feedback-config2");exports.ADVERT_FEEDBACK_CONFIG2=a.default.getAsJSON("advert-feedback-config2",{});exports.ADVERT_FEEDBACK_TEXTS=a.default.getAsJSON("advert-feedback-text",{title:i18n("Вам интересны похожие предложения?"),positiveButtonText:i18n("Интересны"),negativeButtonText:i18n("Не моё"),chance:5e3});exports.SWBOX_ANALYTICS_REQUEST=a.default.getAsJSON("swbox-analytics-request",{mail:false,promo:false});exports.DISABLE_VK_MESSENGER=a.default.has("disable-vk-messenger");exports.VK_MESSENGER_CHECK_VK_AUTH=a.default.has("vk-messenger-check-vk-auth");exports.VK_MESSENGER_EXTERNAL=a.default.has("vk-messenger-external");exports.VK_MESSENGER_CHAT_ID_BY_EMAIL=a.default.getAsJSON("vk-messenger-chat-id-by-email",{});exports.VK_MESSENGER_CHAT_HREF_BASE=a.default.getAsString("vk-messenger-chat-href-base","https://vk.com/im?sel=-");exports.VK_MESSENGER_RESTORE_ON_REFRESH_DISABLED=a.default.has("vk-messenger-restore-on-refresh-disabled");exports.VK_MESSENGER_ACTIVE_CHAT_STORAGE_KEY="vk-messenger-active-chat";exports.VK_MESSENGER_AUTH_THROTTLE=a.default.getAsInt("vk-messenger-auth-throttle",1e3);exports.VK_MESSENGER_DISABLE_SILENT_AUTH=a.default.has("vk-messenger-disable-silent-auth");exports.VK_MESSENGER_SHOW_AUTH_NOTIFY=a.default.has("vk-messenger-show-auth-notify");exports.VK_MESSENGER_LOGOUT=a.default.has("vk-messenger-logout");exports.SWA_SUPERAPP_SILENT_URL=a.default.getAsString("swa-superapp-silent-url","https://account.mail.ru/jsapi/vk/superapp/silent");exports.VK_LOGIN_DOMAIN=a.default.getAsString("vk-login-domain","login.vk.com");exports.VK_OAUTH_DOMAIN=a.default.getAsString("vk-oauth-domain","oauth.vk.com");exports.VK_CONNECT_DOMAIN=a.default.getAsString("vk-connect-domain","id.vk.com");exports.VK_MESSENGER_APP_ID=a.default.getAsInt("vk-messenger-app-id",7965175);exports.EXPIRED_ATTACHES_DIE=a.default.has("expired-attaches-die");exports.ATTACH_WARNING_TOOLTIP=a.default.has("attach-warning-tooltip");exports.SENT_PAGE_NOTIFY=a.default.has("sent-page-notify");exports.VK=a.default.has("vk");exports.IS_VK_HOST=a.default.has("is-vk-host");exports.OCTAVIUS_PLACEHOLDERS_PATH=exports.VK?"".concat(exports.PACKAGES_URL,"/static.promo/octavius/placeholders/vk/"):"".concat(exports.PACKAGES_URL,"/static.promo/octavius/placeholders/mail/");exports.VK_THEMES_LIST=a.default.has("vk-themes-list");exports.VK_DOMAIN=a.default.getAsString("vk-domain","vk.com");exports.DISABLE_DOMAIN_AUTHCHECK=a.default.has("disable-domain-authcheck");exports.THEME_SOUZMULTFILM_MARUSIA=a.default.getAsJSON("theme-souzmultfilm-marusia",{});exports.DND_CLOUD_FOLDER_CHOICE=a.default.has("dnd-cloud-folder-choice");exports.DND_IMAGES_PATH=a.default.getAsString("dnd-images-path","static.promo/cross.project.dnd/");exports.RADAR_PROJECT=a.default.getAsString("radar-project","octavius");exports.LIST_ADVERT_ANIMATION=a.default.has("list-advert-animation");exports.EXPIRED_ATTACHES_TOOLTIP=a.default.has("expired-attaches-tooltip");exports.SWBOX_TOKEN_UPDATE_INTERVAL=a.default.getAsInt("swbox-token-update-interval",0);exports.CONTRAST_LOGO_THEMES=a.default.getAsArray("contrast-logo-themes",["t6000"]);exports.PRELOAD_RELEASE_BUNDLES_FILTER=a.default.getAsArray("preload-release-bundles-filter");exports.LAZY_SMOKE_SCREEN_INIT=a.default.getAsBoolean("lazy-smoke-screen-init");exports.RESIZER_DRAG_ICON_SHOWN=a.default.has("resizer-drag-icon-shown");exports.CKE_CLIPBOARD_FIX=a.default.has("cke-clipboard-fix");exports.MARUSIA_READ_ALL_LETTERS=a.default.has("marusia-read-all-letters");exports.CKE_AUTOCORRECT_AFTER_DELETE_CONTENTS_DISABLED=a.default.has("cke_autocorrect_afterDeleteContents_disabled");exports.CLEANMASTER_MODAL_ACTIONS_DISABLED=a.default.has("cleanmaster-modal-actions-disabled");exports.MESSAGES_ATTACHES_BLOBCLOUD=a.default.has("messages-attaches-blobcloud");exports.MESSAGES_ATTACHES_BLOBCLOUD_PATH=a.default.getAsString("messages-attaches-blobcloud-path","//blobcloud.e.mail.ru/upload/");exports.COMPOSE_EMOJI=a.default.has("compose-emoji");exports.COMPOSE_EMOJI_RECENTLY_COUNT=a.default.getAsInt("compose-emoji-recently-count",30);exports.EMOJI_FALLBACK=a.default.has("emoji-fallback");exports.SHOW_UNSUBSCRIBE_AFTER_SPAM=a.default.has("show-unsubscribe-after-spam");exports.SHOW_UNSUBSCRIBE_AFTER_MOVE_TO_SPAM=a.default.has("show-unsubscribe-after-move-to-spam");exports.RENDER_COMPOSE_TO_BODY_START=!a.default.has("render-compose-to-body-end");exports.USE_X_CALENDAR=a.default.has("use-x-calendar");exports.QUOTA_GROUP=a.default.getAsArray("quota-adv-exp-ids",["500","501","502","503"]);exports.QUOTA_AD_URL="https://cloud.mail.ru/promo/quota?feature=ad&utm_source=mail_disable_ad&utm_medium=cross-promo&utm_campaign=ed.quota#start";exports.QUOTA_SPACE_URL="https://cloud.mail.ru/promo/quota?feature=space&utm_source=mail_2GB&utm_medium=cross-promo&utm_campaign=ed.quota#start";exports.COMPOSE_EMOJI_FILTER=a.default.has("compose-emoji-filter");exports.RESTORE_EXPIRED_ATTACHMENTS=a.default.has("restore-expired-attachments");exports.RESTORE_EXPIRED_ATTACHMENTS_TIME=a.default.getAsInt("restore-expired-attachments",8e4);exports.METATHREAD_MOVE_TO_SPAN_NOTIFY=a.default.has("metathread-move-to-spam-notify");exports.METATHREAD_MOVE_TO_SPAN_NOTIFY_DURATION=a.default.getAsInt("metathread-move-to-spam-notify-duration",4);exports.HIDE_LOGO=a.default.has("hide-logo");exports.USE_SINGLE_TAB=a.default.has("use-single-tab");exports.USE_SINGLE_TAB_WHITELIST_REGEXP=a.default.getAsRegExp("use-single-tab-whitelist-regexp","");exports.USE_SINGLE_TAB_BLACKLIST_REGEXP=a.default.getAsRegExp("use-single-tab-blacklist-regexp","");exports.HIDE_HEADLINE=a.default.has("hide-headline");exports.IS_VK_MINI_APP=a.default.has("is-vk-mini-app");exports.MINI_APP_ID=a.default.getAsString("mini-app-id","51438180");exports.MINI_APP_X_MOBILE=a.default.getAsString("mini-app-x-mobile","e552fda2e6c711eaadc10242ac120002");exports.JSAPI_BASE_URL=a.default.getAsString("jsapi-base-url","https://account.mail.ru/jsapi");exports.SWA_HOST=a.default.getAsString("swa-host","auth.mail.ru");exports.VK_MAIL_OLD_MINI_APP_URL=a.default.getAsString("vk-mail-old-mini-app-url","https://vk.com/vkmail");var v=exports.OCTAVIUS_MOBILE?{mv:1}:{};exports.URL_EXTRA_PARAMS=__assign(__assign({},exports.WEBVIEW?{wv:1,"wv-dark":exports.WEBVIEW_DARK_THEME?1:0}:v),exports.IS_VK_MINI_APP?{miniapp:"vk"}:{});exports.DISABLE_MARUSIA_IN_PORTAL=a.default.has("disable-marusia-in-portal");exports.SHOW_RELOAD_BUTTON=a.default.has("show-reload-button");exports.SHORTCUT_LEFT_COLUMN_LIMIT=a.default.getAsInt("shortcut-left-column-limit",36);exports.DISABLE_LETTER_HEADERS_BUTTON=a.default.has("disable-letter-headers-button");exports.COMPOSE_ALLOWED_TEMPLATES=a.default.getAsArray("compose_allowed_templates",[]);exports.COMPOSE_TEMPLATES_SUBJECTS=a.default.getAsJSON("compose_templates_subjects",{});exports.COMPOSE_TEMPLATES_URL=a.default.getAsString("compose_templates_url","https://e-mail-ru.mrgcdn.ru/static/cards/");exports.DEFAULT_AVATAR_SRC=b.default.get("urls.avatarUrl")+"/pic?width=96&height=96";exports.NOADS_BUTTON_SHOW_FORCE=a.default.has("noads-button-show-force");exports.ENABLE_SORTING=a.default.has("enable-sorting");exports.ENABLE_MULTIPLE_FILTERS=a.default.has("enable-multiple-filters");exports.FORCE_PARENTAL_CONTROL_DIE=a.default.has("force-parental-control-die");exports.TRASH_FOLDER_ID=a.default.getAsInt("trash-folder-id",500002);exports.DISABLE_DELETE_FROM_TRASH=a.default.has("disable-delete-from-trash");exports.FORBID_FILTERS=a.default.has("forbid-filters");exports.FORBID_SPAM=a.default.has("forbid-spam");exports.FORBID_EXCLUDED_FOLDERS_SEARCH=a.default.has("forbid-excluded-folders-search");exports.PARENTAL_CONTROL_PRIVATE_FOLDER_IDS=a.default.getAsArray("parental-control-private-folder-ids",[]);exports.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID=a.default.getAsString("nav-parent-private-folders-container-id","parentPrivateFoldersContainer");exports.PARENTAL_CONTROL_DENY_FOLDER_ID=a.default.getAsInt("parental-control-deny-folder-id",950);exports.PARENTAL_CONTROL_APPROVE_FOLDER_ID=a.default.getAsInt("parental-control-approve-folder-id",0);exports.PROMT_LOGO_HREF=a.default.getAsURL("promt-logo-href","https://www.translate.ru/?utm_source=mail.ru&utm_medium=link&utm_campaign=brand");exports.POLLING_ONLY_VISIBLE=a.default.has("polling_only_visible");exports.LAST_SEEN_V2_ENABLE=a.default.has("lastseen-v2");exports.LETTER_LASTSEEN_REQUEST=exports.LAST_SEEN_V2_ENABLE&&a.default.has("lastseen-letter-request");exports.LASTSEEN_DISABLE_PLATFORM=a.default.has("lastseen-platform-disable");exports.LASTSEEN_ONLINE_STATUS=a.default.getAsString("lastseen-online-status","ONLINE");exports.LASTSEEN_SHOW_TIME_STATUS=a.default.getAsString("lastseen-show-time-status","OFFLINE");exports.LASTSEEN_COMPOSE_ALLOW_GARAGE=a.default.has("lastseen-compose-allow-garage");exports.DISABLE_LEFT_COLUMN=a.default.has("disable-left-column");exports.ENABLE_XXS_BREAKPOINT=a.default.has("enable-xxs-breakpoint");exports.XXS_BREAKPOINT=a.default.getAsInt("xxs-breakpoint",760);exports.DISABLE_DROPDOWN_ACTIONS_SHORTCUTS=a.default.has("disable-dropdown-actions-shortcuts");exports.HIDE_NOTIFY_CLOSE_BUTTON=a.default.has("hide-notify-close-button");exports.HIDE_COMPOSE_CANCEL_BUTTON=a.default.has("hide-compose-cancel-button");exports.HIDE_COMPOSE_WIDGETS=a.default.has("hide-compose-widgets");exports.COMPOSE_FOOTER_DROPDOWN=a.default.has("compose-footer-dropdown");exports.COMPOSE_HIDE_AVATAR=a.default.has("compose-hide-avatar");exports.COMPOSE_DISABLE_CLICKABLE_LABELS=a.default.has("compose-disable-clickable-labels");exports.COMPOSE_DISABLE_TOOLBAR=a.default.has("compose-disable-toolbar");exports.COMPOSE_SHORT_ATTACH_PANEL=a.default.has("compose-short-attach-panel");exports.COMPOSE_ENABLE_TABLES=a.default.has("compose-enable-tables")&&!exports.TOUCH_MODE;exports.HIDE_CONTEXTMENU_ADD_CONTACT_BUTTON=a.default.has("hide-contextmenu-add-contact-button");exports.HIDE_CONTEXTMENU_SEARCH_BUTTON=a.default.has("hide-contextmenu-search-button");exports.HIDE_SETTINGS_BUTTON=a.default.has("hide-settings-button");exports.HIDE_CHANGE_SIGNATURE=a.default.has("hide-change-signature");exports.DISABLE_COMPOSE_ATTACHMENT_CLICK=a.default.has("disable-compose-attachment-click");exports.MOBILE_ADDRESSBOOK_URL=a.default.getAsString("mobile-addressbook-url",exports.WIDGET_ADDRESSBOOK_URL);exports.ADDRESSBOOK_ICO=a.default.getAsString("addressbook-ico","");exports.COMPOSE_FETCH_AUTOREPLY=a.default.has("compose-fetch-autoreply");exports.SHOW_RELIABLE_SENDER_PROMO=a.default.has("show-reliable-sender-promo");exports.SHOW_RELIABLE_ON_LETTER_LIST=a.default.has("show-reliable-on-list-letters");exports.DISABLE_GREEN_RELIABLE_ON_LETTER_LIST=a.default.has("disable-green-reliable-on-letter-list");exports.SHOW_OFFICIAL_SENDER_PROMO=a.default.has("show-official-sender-promo");exports.SHOW_OFFICIAL_ON_LETTER_LIST=a.default.has("show-official-on-list-letters");exports.DISABLE_GREEN_OFFICIAL_ON_LETTER_LIST=a.default.has("disable-green-official-on-letter-list");exports.DARK_MODE_ROLLBACK_ON_COPY=a.default.has("dark_mode-rollback_on_copy");exports.DISABLE_AUTOMATED_TRANSLATE=a.default.has("disable-automated-translate");exports.AUTOMATED_SHOW_TRANSLATOR=a.default.has("automated-show-translator");exports.CSAT_DISABLED=a.default.has("csat_disabled");exports.CSAT_DRY_RUN=a.default.has("csat_dry_run");exports.CSAT_DOMAIN=a.default.getAsString("csat_domain","");exports.CSAT_SURVEYS=a.default.getAsJSON("csat_surveys",{surveys:[]});exports.CSAT_FORCE_SHOW_SURVEY_ID=a.default.getAsString("csat_force_show_survey_id");exports.CSAT_SUCCESS_HIDE_TIMEOUT=a.default.getAsInt("csat_success_hide_timeout",0);exports.CSAT_AFTER_REG_DELAY_IN_SECONDS=a.default.getAsInt("csat_after_reg_delay_in_days",7)*24*60*60;exports.CSAT_TRIGGERS=a.default.getAsJSON("csat_triggers",[]);exports.CSAT_THEME=a.default.getAsString("csat_theme","paradigm");exports.CSAT_TICK_TIMEOUT=a.default.getAsInt("csat_tick_timeout",5e3);exports.HIDE_MESSAGE_FOOTER=a.default.has("hide-message-footer");exports.HIDE_MESSAGE_SMART_REPLY=a.default.has("hide-message-smart-reply");exports.HIDE_MESSAGE_SMART_REPLY_BY_ONLY_WIDTH=a.default.has("hide-message-smart-reply-by-only-width");exports.USE_WEBPACK_BUILD=a.default.getAsBoolean("use-webpack-build");exports.ASYNC_RENDER_REACT_IN_WP_BUILD=a.default.getAsBoolean("async-render-react-in-wp-build");exports.HIDE_WEBVIEW_TITLE=a.default.has("hide-webview-title");exports.HIDE_DISABLE_TO_MYSELF_METATHREAD=a.default.has("hide-disable-to-myself-metathread");exports.THREAD_SWITCH_RACE_FIX=a.default.has("thread-switch-race-fix");exports.ATTACH_ANALYTICS_EXT_DISABLED=a.default.has("attach-analytics-ext-disabled");exports.ENABLE_LIST_LETTER_ACTION_BUTTONS=a.default.has("enable-list-letter-action-buttons");exports.HIDE_OFFICIAL_METATHREAD=a.default.has("hide_official_metathread");exports.HIDE_SCHOOL_METATHREAD=a.default.has("hide-school-metathread");exports.HIDE_GAMES_METATHREAD=a.default.has("hide-games-metathread");exports.CKE_QUOTE_PARSE_FIX_DISABLE=a.default.has("cke-quote-parse-fix-disable");exports.ENABLE_OFFICIAL_LETTERS=a.default.has("enable-official-letters");exports.USE_NEW_SEARCH_CATEGORY_FORMAT=exports.ENABLE_OFFICIAL_LETTERS||a.default.has("use-new-search-category-format");exports.SEARCH_CATEGORIES=["document_scans","order","finance","registration","travel","event",exports.ENABLE_OFFICIAL_LETTERS?"official":"fees"].filter(function(b){return!a.default.has("disable-".concat(b))});exports.UNSUBSCRIBE_INSTEAD_SPAM=a.default.has("unsubscribe-instead-spam");exports.UNSUBSCRIBE_IN_MORE_DROPDOWN=a.default.has("unsubscribe-in-more-dropdown");exports.R7_VIEW_ENABLED=a.default.has("r7-cloud-view");exports.R7_EXTENSIONS_FORMATS=a.default.getAsArray("r7-extensions",["doc","docm","docx","dot","dotm","dotx","epub","fodt","htm","html","mht","odt","ott","rtf","djvu","xps","csv","fods","ods","ots","xls","xlsm","xlsx","xlt","xltm","xltx","fodp","odp","otp","pot","potm","potx","pps","ppsm","ppsx","ppt","pptm","pptx"]);exports.ENABLE_MENTIONS=a.default.has("enable-mentions");exports.MENTIONS_MARK=a.default.getAsString("mentions-mark","@");exports.SETTINGS_DOCK_BROWSERSETTINGS_ENABLED=a.default.has("settings_dock_browsersettings_enabled")&&(a.default.has("browser-settings-mailto")||a.default.has("browser-settings-notifications-push")||a.default.has("browser-settings-notifications-web"));exports.SHOW_CATEGORY_FEEDBACK_PLATE=a.default.has("show-category-feedback-plate");exports.ATTACHES_ID_REG_EXPS=a.default.getAsJSON("viewer-attaches-id-reg-exps",{});exports.MESSAGES_ID_REG_EXP=a.default.getAsJSON("viewer-message-id-reg-exps",{});exports.VIEW_URL_IDS_VALIDATE_DISABLE=a.default.has("view-url-ids-validate-disable");exports.METATHREAD_REDIRECT=a.default.has("metathread_redirect");exports.HIDE_EMOJI_IN_SUBJECT=a.default.has("hide-emoji-in-subject");exports.HIDE_EMOJI_IN_CORRESPONDENT=a.default.has("hide-emoji-in-correspondent");exports.HIDE_EMOJI_IN_SNIPPET=a.default.has("hide-emoji-in-snippet");exports.HIDE_EMOJI_IN_METATHREAD=a.default.has("hide-emoji-in-metathread");exports.HIDE_EMOJI_IN_SUBJECT_NEWSLETTER=a.default.has("hide-emoji-in-subject-newsletter");exports.HIDE_EMOJI_IN_CORRESPONDENT_NEWSLETTER=a.default.has("hide-emoji-in-correspondent-newsletter");exports.HIDE_EMOJI_IN_SNIPPET_NEWSLETTER=a.default.has("hide-emoji-in-snippet-newsletter");exports.FOLDERS_SORT_VARIATION=a.default.getAsString("folders_sort_variation");exports.COLOR_TAGS=["tagged_personal","tagged_documents","tagged_needs_reply","tagged_important","tagged_urgent"].filter(function(b){return!a.default.has("disable-".concat(b))});exports.ENABLE_COLOR_TAGS_SEARCH=a.default.has("enable-color-tags-search");exports.SEARCH_SUGGESTS_DELAY=a.default.has("search-suggests-delay");exports.SEARCH_SUGGESTS_DELAY_TIME=a.default.getAsInt("search-suggests-delay-time",500);var w;(function(a){a["old"]="old";a["oldTwoBtn"]="oldTwoBtn";a["new"]="new";a["newTwoBtn"]="newTwoBtn"})(w=exports.EMPTY_FOLDER_PLACEHOLDER_ENUM||(exports.EMPTY_FOLDER_PLACEHOLDER_ENUM={}));exports.EMPTY_FOLDER_PLACEHOLDER=a.default.getAsString("empty-folder-placeholder",w.old);exports.LIGHT_COLOR_THEMES=a.default.getAsArray("light-color-themes",["t4009","t4010","t4011","t4012","t4013","t4014","t4015","t4000","t2014","t2018","t1075","t2054"]);exports.METATHREAD_BACK_TO_INBOX=a.default.has("metathread-back-to-inbox");exports.BACK_TO_PARENT_POS=a.default.getAsArray("back-to-parent-pos",[]);exports.BACK_TO_PARENT_AT_LOGO=exports.BACK_TO_PARENT_POS.includes("logo");exports.BACK_TO_PARENT_AT_LETTERS=exports.BACK_TO_PARENT_POS.includes("letters");exports.BACK_TO_PARENT_SHORTCUT=a.default.has("back-to-parent-shortcut");exports.PORTAL_MENU_MORE_FOLDER_ACTIONS=a.default.has("portal-menu-more-folder-actions");exports.PORTAL_MENU_CLEAR_METATHREAD=a.default.has("portal-menu-clear-metathread");exports.DESELECT_ALL_LABEL_STYLE=a.default.getAsString("deselect-all-label-style","back");exports.BACK_TO_PARENT_AT_EMPTY_LETTERS=a.default.has("back-to-parent-at-empty-letters");exports.GO_TO_ACTION_BUTTOM=a.default.has("go-to-action-button");exports.B2B_INNER_ATTACHMENTS_NOTIFY=a.default.has("b2b-inner-attachments-notify");exports.SMART_CARD_ICS=a.default.has("smart-card-ics");exports.HIDE_RECEIPTS_METATHREAD=a.default.has("hide-receipts-metathread");exports.WIDGET_ICONS_VARIANT=a.default.getAsString("widget-icons-variant","");exports.FAKE_CREATE_TODO=a.default.has("fake-create-todo");exports.SHOW_PROMO_PUSH_PLATE=a.default.has("show-promo-push-plate");exports.DISABLE_OCTOPUS_CREATE_FILTER=a.default.has("disable-octopus-create-filter");exports.ENABLE_HIDE_TRANSLATOR=a.default.has("enable-hide-translator");exports.SEARCH_PANEL_REACT=a.default.has("new-toolbar")&&!exports.HIDE_HEADLINE;exports.SEARCH_PANEL_PORTAL=a.default.has("new-toolbar")&&!exports.HIDE_HEADLINE;exports.NEW_TOOLBAR=a.default.has("new-toolbar")&&!exports.HIDE_HEADLINE;exports.SEARCH_PANEL_SIZE=a.default.getAsInt("search-panel-size",336);exports.CUSTOM_THEMES_PREVIEWS_PATHS=a.default.getAsJSON("custom-themes-previews-paths")||{};exports.LETTER_META_SKELETON_ENABLE=a.default.has("letter-meta-skeleton-enable");exports.LETTER_META_SKELETON_WAIT_TIMEOUT=a.default.getAsInt("letter-meta-skeleton-timeout",3e4);exports.DISABLE_METATHREAD_CAPS=a.default.has("disable-metathread-caps");exports.ENABLE_BACK_TO_LETTERS_SHORTCUT_3PANE=a.default.has("enable-back-to-letters-shortcut-3pane");exports.FAKE_BUTTON_TYPE=a.default.getAsString("fake-button-type");exports.ENABLE_TAGS=a.default.has("enable-tags");exports.TAGS_COLORS=a.default.getAsJSON("tags-colors",{tagged_personal:"orange",tagged_documents:"purple",tagged_important:"mint",tagged_urgent:"pink",tagged_needs_reply:"sky"});exports.TAGS_ORDER=a.default.getAsArray("tags-order",["tagged_personal","tagged_documents","tagged_needs_reply","tagged_important","tagged_urgent"],"|");exports.FAKE_BUTTON_DISCUSS_DOCUMENT=a.default.has("fake-button-discuss-document");exports.KASPERSKY_LOGO_HREF=a.default.getAsURL("kaspersky-logo-href","http://www.kaspersky.ru/advert/home-security?campaign=kl_mailgroup&redef=1&THRU&referer1=kl_mailgroup_pochta&referer2=kl_mailgroup_pochta");exports.KASPERSKY_LOGO_WITH_AD_DROPDOWN=!a.default.has("kaspersky-logo-with-ad-dropdown-disabled");exports.KASPERSKY_ABOUT_AD_DEFAULT=(h={},h[d.AdDescriptionKeys.Advertiser]="АО «Лаборатория Касперского»",h[d.AdDescriptionKeys.INN_KPP]="7713140469/997750001",h[d.AdDescriptionKeys.OGRN]="1027739867473",h);exports.KASPERSKY_ABOUT_AD_RAW=a.default.getAsJSON("kaspersky-about-ad",exports.KASPERSKY_ABOUT_AD_DEFAULT);exports.PROMT_LOGO_WITH_AD_DROPDOWN=!a.default.has("promt-logo-with-ad-dropdown-disabled");exports.PROMT_ABOUT_AD_DEFAULT=(i={},i[d.AdDescriptionKeys.Advertiser]="ООО «ПРОМТ»",i[d.AdDescriptionKeys.INN_KPP]="7804146852/780101001",i[d.AdDescriptionKeys.OGRN]="1027802484160",i);exports.PROMT_ABOUT_AD_RAW=a.default.getAsJSON("promt-about-ad",exports.PROMT_ABOUT_AD_DEFAULT);exports.TRANSLATE_ABOUT_AD=a.default.has("translate-about-ad");exports.ENABLE_METATHREAD_FILTERS_SHORTCUT=a.default.has("enable-metathread-filters-shortcut");exports.LOG_FISHING_DEINIT_ERROR=a.default.has("log_fishing_deinit_error");exports.DISABLE_IMAGE_EXPANDER=a.default.has("disable-image-expander");exports.ENABLE_LETTERS_DIVIDERS=a.default.has("enable-letter-dividers")&&exports.NEW_LETTER_LIST&&exports.NEW_LETTER_LIST_3PANE&&!exports.IS_TABLET;exports.ENABLE_AUTHOR_SEND_LETTERS_DIVIDERS=a.default.has("enable-author-sent-letter-dividers");exports.ENABLE_AUTHOR_LETTERS_DIVIDERS=a.default.has("enable-author-letter-dividers");exports.ENABLE_SUBJECT_LETTERS_DIVIDERS=a.default.has("enable-subject-letter-dividers");exports.ENABLE_LATEST_WITH_MONTHS_LETTERS_DIVIDERS=a.default.has("enable-latest-with-months-letter-dividers");exports.FAKE_BUTTON_SIGNING=a.default.has("fake-button-signing");exports.SPACE_AFTER_MORE=a.default.has("space-after-more");exports.ACCENT_DISABLED_METATHREAD_SETTINGS_ITEM=a.default.has("accent-disabled-metathread-settings-item");exports.FAKE_GOS_TEMPLATE_SUGGESTION=a.default.getAsArray("fake-gos-template-suggestion",[]);exports.SEARCH_CLEAR=a.default.has("search-clear");exports.ORDER_BUTTONS=a.default.getAsArray("order-buttons",[]);exports.ENABLE_ADD_TAGS_TOUCH=exports.ENABLE_TAGS&&a.default.has("enable-add-tags-touch");exports.DISABLE_LETTER_ITEM_FOLDER=a.default.has("disable-letter-item-folder");exports.ENABLE_LETTERS_LIST_DIVIDER_SWITCHER=a.default.has("enable-letters-list-dividers-switcher");exports.SHOW_VK_HELP=a.default.has("show-vk-help-plate");exports.VK_HELP_CHAT_ID=a.default.getAsString("vk-help-chat-id","217777387");exports.HIDE_ICS_ATTACH=a.default.has("smart-card-toggle-ics-enabled");exports.SHOW_ICS_ATTACH_CALENDAR_LETTER=a.default.has("smart-card-toggle-ics-calendar-letter");exports.CALENDAR_EMAIL_LIST=a.default.getAsArray("calendar-email-list",["calendar@corp.mail.ru","calendar@mini-mail.ru"]);exports.HREF_THEME_WIDGET_NEW_YEAR_2023=a.default.getAsURL("href-theme-widget-new-year-2023","https://newyear.mail.ru/2023/?utm_source=mailtheme&utm_medium=cta&utm_campaign=newyear");exports.SETTINGS_DROPDOWN_HIDE_SECURITY=a.default.has("settings-dropdown-hide-security");exports.TRACKING_STATUS_PLATE=a.default.has("tracking-status-plate");exports.DISABLE_FOOTER_APP_TOOLBAR=a.default.has("disable-footer-app-toolbar");exports.CAN_SHOW_FOOTER_APP_TOOLBAR=(exports.isVkTeamsWebview||exports.OCTAVIUS_MOBILE)&&!exports.DISABLE_FOOTER_APP_TOOLBAR;exports.DISABLE_MOBILE_ACCOUNT_PROFILE=a.default.has("disable-mobile-account-profile");exports.DISABLE_MOBILE_ACCOUNT_SECURITY=a.default.has("disable-mobile-account-security");exports.DISABLE_MOBILE_ACCOUNT_CHANGE_AND_ADD=a.default.has("disable-mobile-account-change-and-add");exports.DISABLE_MOBILE_ACCOUNT_LOGOUT_ALERT=a.default.has("disable-mobile-account-logout-alert");exports.DISABLE_MOBILE_CONTACTS=a.default.has("disable-mobile-contacts");exports.G_SELENT_OFF=a.default.has("g-silent-off");exports.SMART_CARD_ML=a.default.has("smart-card-ml");exports.PROMO_MANUAL_LOAD=a.default.has("promo-manual-load");exports.PROMO_DEBOUNCE_UPDATE=a.default.has("promo-debounce-update");exports.SYNC_THREAD_UPDATES=a.default.has("sync-thread-updates");exports.THREAD_UPDATE_TIMEOUT=a.default.getAsInt("thread-update-timeout",60*1e3);exports.ADS_MOVE_TOP_LINE=a.default.has("adv-move-top-line");var x=a.default.getAsInt("adv-move-top-line");exports.ADS_MOVE_TOP_LINE_2PANE=!x||x===2;exports.ADS_MOVE_TOP_LINE_3PANE=!x||x===3;exports.SHOW_ATTACH_SAFETY_STATUS=a.default.getAsBoolean("show-attach-safety-status",false);exports.HAS_ATTACH_SAFETY_STATUS_BACKGROUND=a.default.getAsBoolean("has-attach-safety-status-background",false);exports.ATTACH_SAFETY_STATUS_POSITION=a.default.getAsString("attach-safety-status-position","start");exports.OAUTH_HOST=a.default.getAsURL("oauth_host","https://o2.mail.ru");exports.NEW_FEATURES_BELL=a.default.has("new-features-bell");exports.NEW_FEATURES_MEGAFON_ICON=a.default.has("new-features-megafon-icon");exports.NEW_FEATURES_SHOW_COUNT=a.default.getAsInt("new-features-count",3);exports.NEW_FEATURES_LANDING_HREF=a.default.getAsURL("new-features-landing-href","https://whatsnew.mail.ru");exports.THEMES_PROJECT_NAME=a.default.getAsString("themes-project-name","octavius");exports.PROMO_NEW_TOOLBAR=a.default.has("show-promo-new-toolbar");exports.LETTER_SEND_CANCEL_TIMER_DISPLAY_TIME_AT_THE_END=a.default.getAsInt("letter-send-cancel-timer-display-time-at-the-end",Number.MAX_SAFE_INTEGER);exports.HIDE_CLEAR_BUTTON_ON_SPAM_FOLDER=a.default.has("hide-clear-button-on-spam-folder");exports.WIDGET_COLUMN=a.default.has("widget-column");exports.LOG_EMPTY_COLLECTORS=a.default.has("log-empty-collectors");exports.ENABLE_MOBILE_CSAT=a.default.has("enable-mobile-csat");exports.MOBILE_CSAT=a.default.getAsString("mobile-csat","31");exports.NEW_TOOLBAR_PROJECTS_NOTES=a.default.has("new-toolbar-projects-notes");exports.URL_OPEN_PROJECTS_NOTES=a.default.getAsString("url-open-projects-notes","https://notes.mail.ru/create-new-note");exports.SHOW_PLATE_NEWSLETTER_MAILING_SUBCRIBE=a.default.has("show-plate-newsletter-mailing-subscribe");exports.SHOW_SECURITY_CHECKUP_LINK_IN_SETTINGS=a.default.has("show-security-checkup-link-in-settings")&&!Object.values(c.default.get("initialUser.social_bind")).includes(true)&&c.default.get("initialUser.account_type")!=="external";exports.ACCOUNT_HOSTNAME=a.default.getAsURL("account-hostname","https://account.${topLevelHost}");exports.SECURITY_CHECKUP_URL=a.default.getAsString("security-checkup-url","".concat(exports.ACCOUNT_HOSTNAME,"/security"));exports.CALENDAR_URL=a.default.getAsString("calendar-url","https://touch.calendar.mail.ru");exports.WIDGET_CALENDAR=a.default.has("widget-calendar");exports.WIDGET_COLUMN_DEFAULT_OPEN=a.default.has("widget-column-default-open");exports.HIDE_DELIMITER=a.default.has("hide-delimiter");exports.CSAT_ANIMATION=a.default.has("enable-csat-animation");exports.CALENDAR_GRAPHQL_API_URL=a.default.getAsURL("calendar-graphql-api-url","https://corsapi.imgsmail.ru/calendar/graphql");exports.TODO_API_URL=a.default.getAsURL("todo-api-url","https://corsapi.imgsmail.ru/todo");exports.WIDGET_HEADER_TYPE=a.default.getAsString("widget-header-type","none");exports.HAS_WIDGET_HEADER_TYPE=exports.WIDGET_HEADER_TYPE!=="none";exports.IFRAME_MARUSIA_URL=a.default.getAsString("iframe-marusia-url","https://marusia-web.go.mail.ru");exports.WEATHER_PING=a.default.getAsDuration("weather-ping","10m")*1e3||false;exports.CALENDAR_PING=a.default.getAsDuration("calendar-ping")*1e3||false;exports.TODO_PING=a.default.getAsDuration("todo-ping")*1e3||false;exports.DEFAULT_TODO_TASKS=a.default.getAsInt("default-todo-tasks")||false;exports.QUOTA_URL=a.default.getAsString("quota-url","https://cloud.mail.ru/promo/quota/");exports.WIDGET_QUOTA_TYPE=a.default.getAsString("widget-quota-type","none");exports.USE_CUSTOM_THEME_PREVIEW_NAME=a.default.has("use-custom-theme-preview-name");exports.APPLY_THEME_TIMEOUT=a.default.getAsInt("theme-apply-small-timeout",30*1e3);exports.SUPPORT_WIDGET_THEME_IDS=a.default.getAsArray("support-widget-theme-ids",["t1154","t1155","t1189","t1190","t1168","t3002","t3015","t5001","t1169","t5003","t5004","t5002","t5005","t5007"]);exports.DARK_MODE_THEMES=a.default.getAsArray("dark-mode-themes",["t5000","t5001"]);exports.DARK_DEFAULT_MODE_THEMES=a.default.getAsArray("dark-default-mode-themes",["t5000"]);exports.LIGHT_DEFAULT_MODE_THEMES=a.default.getAsArray("light-default-mode-themes",["t6000","default"]);exports.THEMES_PATHS_V4=a.default.getAsJSON("themes-paths-v4",{});exports.CHANGE_TEXT_REMOVE_BUTTON_SIDEBAR=a.default.has("change-text-remove-button-sidebar");exports.CHANGE_TEXT_REMOVE_BUTTON_METATHREAD_DELETE=a.default.has("change-text-remove-button-metathread-delete");exports.CHANGE_TEXT_REMOVE_BUTTON_METATHREAD_EMPTY=a.default.has("change-text-remove-button-metathread-empty");exports.CHANGE_ICON_REMOVE_BUTTON_METATHREAD=a.default.has("change-icon-remove-button-metathread");exports.SHOW_FD_CALENDAR_EXP_LETTER_LIST=a.default.has("show-fd-calendar-exp-letter-list");exports.SHOW_SIDEBAR_UNSUBSCRIBE_BUTTON=a.default.has("show-sidebar-unsubscribe-button");exports.SHOW_SIDEBAR_UNSUBSCRIBE_BUTTON_MOBILE=a.default.has("show-sidebar-unsubscribe-button-mobile");exports.DISABLE_LETTER_SWIPE=a.default.has("disable-letter-swipe");exports.ENABLE_LETTER_FAST_ACTION_SWIPE=a.default.has("enable-letter-fast-action-swipe");exports.USE_NEW_MOBILE_FOLDERS_MODAL=a.default.has("use-new-mobile-folders-modal");exports.BUTTON_MOVE_TO_SPAM_CANCEL_PRIMARY=a.default.has("button-move-to-spam-cancel-primary");exports.BUTTON_MOVE_TO_SPAM_CANCEL_LEFT_POSITION=a.default.has("button-move-to-spam-cancel-left-position");exports.ENABLE_MOBILE_SEARCH_BUTTON=a.default.has("enable-mobile-search-button");exports.CREATE_NOTE_FROM_COMPOSE=a.default.getAsString("create-note-from-compose","");exports.NOTES_URL=a.default.getAsURL("notes-url","https://notes.mail.ru");exports.VIEWER_ATTACH_TEMP_CLOUDSTOCK=a.default.has("viewer-attach-temp-cloudstock");exports.VIEWER_ATTACH_TEMP_CLOUD=a.default.has("viewer-attach-temp-cloud");exports.USE_QUEUE_PROMO_PUSH_PLATE=a.default.has("use-queue-promo-push-plate");exports.DELAY_PROMO_PUSH_PLATE=a.default.getAsInt("delay-promo-push-plate",15552e3);exports.COUNT_SHOW_PROMO_PUSH_PLATE_BEFORE_DELAY=a.default.getAsInt("count-show-promo-push-plate-before-delay",2);exports.USE_QUEUE_CATEGORY_FEEDBACK_PLATE=a.default.has("use-queue-category-feedback-plate");exports.MAX_COUNT_SHOW_CATEGORY_FEEDBACK_PLATE=a.default.getAsInt("max-count-show-category-feedback-plate");exports.DELAY_CATEGORY_FEEDBACK_PLATE=a.default.getAsInt("delay-category-feedback-plate",1209600);exports.ADV_SIDEBAR_160_ALWAYS=a.default.has("adv-sidebar-160-always");exports.ADV_SIDEBAR_160_ON_WIDTH_1800=a.default.has("adv-sidebar-160-on-width-1800");exports.ADV_SIDEBAR_160_ON_WIDTH_1420=a.default.has("adv-sidebar-160-on-width-1420");exports.SHOW_SENDER_EMAIL_IN_SPAM_FOLDER=a.default.has("show-sender-email-in-spam-folder");exports.ADV_3PANE_REDESIGN_V3=a.default.has("adv-3pane-redesign-v3");exports.COUNT_REPLAY_ANIMATION=a.default.getAsInt("count-replay-animation",4);exports.TIMEOUT_FIRST_ANIMATION=a.default.getAsDuration("timeout-first-animation",3e4);exports.TIMEOUT_NEXT_ANIMATION=a.default.getAsDuration("timeout-next-animation",3*24*60*60*1e3);exports.EXTENSIONS_WHITE_LIST=a.default.getAsArray("extensions-white-list",["3gp","amr","avi","bak","bmp","cat","cfg","config","cr2","css","csv","dat","db","dng","ds_store","epub","fb2","flv","gif","heic","ico","ics","ini","jpeg","jpg","json","key","log","lst","m3u","m4a","m4v","manifest","mkv","mov","mp3","mp4","mts","ne","nfo","ogg","opus","otf","p12","png","sig","svg","tif","tmp","ttf","txt","vcf","vob","wav","webm","webp","wma","wmv","xml"]);exports.SHOW_ATTACH_SAFETY_STATUS_TOOLTIP=a.default.has("show-attach-safety-status-tooltip");exports.PREINIT_ALL_MEDIATORS=!a.default.has("disable-mediators-preinit");exports.LAZY_NONCRIT_TASKS_TIMEOUT=a.default.getAsDuration("lazy-noncrit-tasks-timeout",1e4);exports.DARKOSHA_TABLE_BORDER_FIX_ENABLED=a.default.has("darkosha_table_border_fix_enabled")});define("router",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getAppRouter=void 0;var a=function(){return window["app"]};exports.getAppRouter=a});define("helpers/metrics/performance",["require","exports","@mail-core/dashboard","default-values","router"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.sendAfterUpdateLetterMetric=exports.sendAfterMountMetric=void 0;var d=new Set;var e=false;var f={readletter_3pane:["letters","readletter"],letters_3pane:["letters"],letters_2pane:["letters"],readletter_2pane:["readletter"]};function g(b,c,g){d.add(c);var h="".concat(g,"_").concat(b);var i=f[h];for(var j=0,k=i;j<k.length;j++){var l=k[j];if(!d.has(l)){return}}a.userKeeper.timeEnd("app-full-mount",{appendix:h,score:"app:ready",dwh:{}});e=true}function h(d){var f=(0,c.getAppRouter)().route.id;var h=f.replace(/[#-]/g,"");if(h==="readletter"){a.userKeeper.timeEnd("letter-open",{appendix:b.USE_3PANE?"3pane":"2pane",score:"route"})}if(e||h!=="letters"&&h!=="readletter"){return}g(b.USE_3PANE?"3pane":"2pane",d,h)}exports.sendAfterMountMetric=h;var i=null;function j(c){if(!c||i===c){return}i=c;a.userKeeper.timeEnd("letter-update",{appendix:b.USE_3PANE?"3pane":"2pane",score:"route"})}exports.sendAfterUpdateLetterMetric=j});var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/lazy",["require","exports","@mail/xray","@mail-core/logger","default-values","helpers/metrics/performance","router"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.uniqCallback=exports.lazyInitPromise=exports.lazyInit=exports.afterMountCallback=exports.createAppBundlePreloader=exports.executeAllLazyAfterReadyTask=exports.addLazyNoncriticalTask=exports.addLazyAfterReadyTask=exports.nextFrame=exports.lazyNoncriticalAfterReady=void 0;a=__importDefault(a);var f=[];exports.lazyNoncriticalAfterReady=[];var g=function(a){return requestAnimationFrame(a)};exports.nextFrame=g;function h(a){f.push(a)}exports.addLazyAfterReadyTask=h;function i(a){exports.lazyNoncriticalAfterReady.push(a)}exports.addLazyNoncriticalTask=i;function j(a,b){if(b===void 0){b=f}(0,exports.nextFrame)(function c(){var d=b.shift();if(d){d(a);(0,exports.nextFrame)(c)}})}exports.executeAllLazyAfterReadyTask=j;function k(d){var e=d.jsMap,f=d.staticHost,g=d.filter;var h=Object.assign({},e===null||e===void 0?void 0:e.paths);return function(d){var e=d.jsMap;var i=(c.USE_WEBPACK_BUILD?e===null||e===void 0?void 0:e.wpPaths:e===null||e===void 0?void 0:e.paths)||{};Object.entries(i).forEach(function(c){var d=c[0],e=c[1];if(!Array.isArray(g)||!(g.includes("ALL")||g.includes(d))){return}var i={};var j=false;if(h[d]!==e){var k=document.createElement("link");k.as="script";k.rel="preload";k.crossOrigin="anonymous";k.href="".concat(f).concat(e,".js");k.addEventListener("error",function(a){var c;(c=window.coreLogger)===null||c===void 0?void 0:c.dispatchError(a,{bundleName:d},{category:"nxt-preload",tag:b.Tag.Known})});k.addEventListener("load",function(){var b;a.default.send("next-bundle-preload-success",{i:(b={},b[d]=1,b),skipdwh:true})});document.head.appendChild(k);h[d]=e;j=true;i[d]=1}if(j){a.default.send("app-bdl-preload",{i:i})}})}}exports.createAppBundlePreloader=k;function l(){var a=[];for(var b=0;b<arguments.length;b++){a[b]=arguments[b]}j((0,e.getAppRouter)(),exports.lazyNoncriticalAfterReady);d.sendAfterMountMetric.apply(void 0,a)}exports.afterMountCallback=l;function m(a){var b=null;return function(){if(b===null){b=a()}return b}}exports.lazyInit=m;function n(a,b){var c=this;if(b===void 0){b={}}var d=null;return function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,b.holdUntil];case 1:c.sent();if(d===null){d=a()}return[2,d]}})})}}exports.lazyInitPromise=n;var o=new WeakMap;var p=new WeakMap;function q(a,b){o.set(a,b);if(!p.has(a)){p.set(a,function(){var b=[];for(var c=0;c<arguments.length;c++){b[c]=arguments[c]}return o.get(a).apply(void 0,b)})}return p.get(a)}exports.uniqCallback=q});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};define("lazy.modules",["require","exports","./helpers/lazy"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.lazyUIThemesWidget=exports.lazyUIWidgetCalendar=exports.lazyUIThemesWidgetWeather=exports.lazyUIThemesWidgetWarface=exports.lazyUIThemesWidgetStarWars=exports.lazyUIThemesWidgetSpartakFC=exports.lazyUIThemesWidgetSouzmultfilm=exports.lazyUIThemesWidgetSerenity=exports.lazyUIThemesWidgetRickMorty=exports.lazyUIThemesWidgetOlympiad2021=exports.lazyUIThemesWidgetNewYear2023=exports.lazyUIThemesWidgetNewYear=exports.lazyUIThemesWidgetLostArk=exports.lazyUIThemesWidgetLetter=exports.lazyUIThemesWidgetItem=exports.lazyUIThemesWidgetIIHF=exports.lazyUIThemesWidgetHoroscope=exports.lazyUIThemesWidgetFootball=exports.lazyUIThemesWidgetEuro2020=exports.lazyUIThemesWidgetEpicenter=exports.lazyUIThemesWidgetCloudyRemake=exports.lazyUIThemesWidgetCloudy=exports.lazyUIThemesWidgetVK=exports.lazyUIThemesWidgetOK=exports.lazyUILayerMetathreadsSettings=exports.lazyUILayerConfirmDeleteFolder=exports.lazyUILayerCreateFolder=exports.lazyUILayerEditSettingsFilter=exports.lazyUILayerCleanmasterModal=exports.lazyUILayerSentPage=exports.lazyUIUnsubscribe=exports.lazyUIGallery=exports.lazyUILetter=exports.lazyUIComposeWindows=exports.lazyUIComposeApp=exports.lazyUIDragAndDrop=exports.lazyHelpersLogger=exports.lazyMediatorWelcomeBlockManager=exports.lazyMediatorSettingsManager=exports.lazyMediatorMarusiaManager=exports.lazyMediatorTodoManager=exports.lazyMediatorCallsManager=exports.lazyMediatorCalendarManager=exports.lazyMediatorPageTitle=exports.lazyServiceDarkosha=exports.lazyTemporaryFixSignature=exports.lazyMailReleaseDetect=exports.lazyMailKeymaster=exports.lazyIframeAmpViewer=exports.lazyHammerJS=exports.lazyMailTextAnalyzer=exports.lazyClipboard=exports.lazyFileAPI=exports.lazyDomPurify=exports.uniqCallback=void 0;Object.defineProperty(exports,"uniqCallback",{enumerable:true,get:function(){return a.uniqCallback}});function b(a){return a.default}exports.lazyDomPurify=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["dompurify"],a,b)}).then(__importStar).then(function(a){var b=a.default;return b()})});exports.lazyFileAPI=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["FileAPI"],a,b)}).then(__importStar)});exports.lazyClipboard=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["clipboard"],a,b)}).then(__importStar).then(function(a){return a.default})});exports.lazyMailTextAnalyzer=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["@mail/text-analyzer"],a,b)}).then(__importStar)});exports.lazyHammerJS=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["hammerjs"],a,b)}).then(__importStar).then(b)});exports.lazyIframeAmpViewer=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["@iframe/amp-viewer"],a,b)}).then(__importStar)});exports.lazyMailKeymaster=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["@mail/keymaster"],a,b)}).then(__importStar).then(function(){return window.key})});exports.lazyMailReleaseDetect=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["@mail/release-detect"],a,b)}).then(__importStar)});exports.lazyTemporaryFixSignature=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["temporary/fix-signature"],a,b)}).then(__importStar)});exports.lazyServiceDarkosha=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["service/darkosha"],a,b)}).then(__importStar)});exports.lazyMediatorPageTitle=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["mediator/page-title"],a,b)}).then(__importStar)});exports.lazyMediatorCalendarManager=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["mediator/calendar-manager"],a,b)}).then(__importStar)});exports.lazyMediatorCallsManager=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["mediator/calls-manager"],a,b)}).then(__importStar)});exports.lazyMediatorTodoManager=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["mediator/todo-manager/todo-manager"],a,b)}).then(__importStar)});exports.lazyMediatorMarusiaManager=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["mediator/marusia-manager"],a,b)}).then(__importStar)});exports.lazyMediatorSettingsManager=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["mediator/settings-manager"],a,b)}).then(__importStar).then(b)});exports.lazyMediatorWelcomeBlockManager=(0,a.lazyInitPromise)(function(){return new Promise(function(a,b){require(["mediator/welcome-block-manager"],a,b)}).then(__importStar)});exports.lazyHelpersLogger=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["helpers/logger"],a,b)}).then(__importStar)});exports.lazyUIDragAndDrop=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/drag-and-drop/drag-and-drop"],a,b)}).then(__importStar).then(b)});exports.lazyUIComposeApp=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/compose-app/compose-app"],a,b)}).then(__importStar).then(b)});exports.lazyUIComposeWindows=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/compose-windows/compose-windows"],a,b)}).then(__importStar).then(b)});exports.lazyUILetter=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/letter/letter"],a,b)}).then(__importStar).then(b)});exports.lazyUIGallery=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/gallery/gallery"],a,b)}).then(__importStar).then(b)});exports.lazyUIUnsubscribe=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/unsubscribe/unsubscribe"],a,b)}).then(__importStar).then(b)});exports.lazyUILayerSentPage=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/layer-sent-page/layer-sent-page"],a,b)}).then(__importStar).then(b)});exports.lazyUILayerCleanmasterModal=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal"],a,b)}).then(__importStar).then(b)});exports.lazyUILayerEditSettingsFilter=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/layer-edit-settings-filter/layer-edit-settings-filter"],a,b)}).then(__importStar).then(b)});exports.lazyUILayerCreateFolder=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/layer-create-folder/layer-create-folder"],a,b)}).then(__importStar).then(b)});exports.lazyUILayerConfirmDeleteFolder=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder"],a,b)}).then(__importStar).then(b)});exports.lazyUILayerMetathreadsSettings=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/layer-metathreads-settings/layer-metathreads-settings"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetOK=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-ok/themes-widget-ok"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetVK=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-vk/themes-widget-vk"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetCloudy=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-cloudy/themes-widget-cloudy"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetCloudyRemake=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-cloudy-remake/themes-widget-cloudy-remake"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetEpicenter=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-epicenter/themes-widget-epicenter"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetEuro2020=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-euro-2020/themes-widget-euro-2020"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetFootball=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-football/themes-widget-football"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetHoroscope=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-horoscope/themes-widget-horoscope"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetIIHF=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-iihf/themes-widget-iihf"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetItem=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-item/themes-widget-item"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetLetter=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-letter/themes-widget-letter"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetLostArk=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-lost-ark/themes-widget-lost-ark"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetNewYear=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-new-year/themes-widget-new-year"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetNewYear2023=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-new-year-2023/themes-widget-new-year-2023"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetOlympiad2021=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-olympiad-2021/themes-widget-olympiad-2021"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetRickMorty=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-rick-morty/themes-widget-rick-morty"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetSerenity=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-serenity/themes-widget-serenity"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetSouzmultfilm=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-souzmultfilm/themes-widget-souzmultfilm"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetSpartakFC=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-spartak-fc/themes-widget-spartak-fc"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetStarWars=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-star-wars/themes-widget-star-wars"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetWarface=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-warface/themes-widget-warface"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidgetWeather=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget-weather/themes-widget-weather"],a,b)}).then(__importStar).then(b)});exports.lazyUIWidgetCalendar=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/widget-calendar/widget-calendar"],a,b)}).then(__importStar).then(b)});exports.lazyUIThemesWidget=(0,a.lazyInit)(function(){return new Promise(function(a,b){require(["ui-block/themes-widget/themes-widget"],a,b)}).then(__importStar).then(b)})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/swBox",["require","exports","@mail/sw-box","@mail/xray","cfgUser","default-values","RPC","service/auth"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isSWBoxEnabled=exports.getFirebaseConfig=void 0;b=__importDefault(b);c=__importDefault(c);e=__importStar(e);f=__importDefault(f);function g(){return{template:"default",defaultTitle:i18n("Почта Mail.ru"),defaultBody:i18n("Вам пришло новое письмо"),defaultIcon:"https://img.imgsmail.ru/r/default/ico/icon-192.png",emptySubjectText:i18n("Без темы")}}function h(a){return{title:"${config.defaultTitle}",titlePlural:[i18n("{count} новых писем",{count:"{count}"}),i18n("{count} новое письмо",{count:"{count}"}),i18n("{count} новых письма",{count:"{count}"})],icon:"${config.defaultIcon}",tag:"mail.notification.${email}",description:"${config.defaultBody}",body:"${config.defaultBody}",defaultAction:{action:"octavius.open",url:a}}}function i(a){return{title:"${fetchedData.title}",titlePlural:[i18n("{count} новых писем",{count:"{count}"}),i18n("{count} новое письмо",{count:"{count}"}),i18n("{count} новых письма",{count:"{count}"})],icon:"${fetchedData.icon}",tag:"mail.notification.${email}",description:"${fetchedData.description}",body:"${fetchedData.body}",actions:[{action:"mailapi.message.markRead",title:i18n("Прочитано"),url:a+"/${fetchedData.folderId}/${fetchedData.threadId}/?x-email=${email_encoded}"},{action:"mailapi.message.remove",title:i18n("Удалить"),url:a+"/${fetchedData.folderId}/${fetchedData.threadId}/?x-email=${email_encoded}"}],defaultAction:{action:"message.open",url:a+"/${fetchedData.folderId}/${fetchedData.threadId}/?x-email=${email_encoded}"}}}function j(){return{api:{mode:a.PushAPIMode.Firebase,apiKey:"AIzaSyCXIiICr-x1z94Uw-0nk0qyFkQHcFjk7X0",authDomain:"fluorcorpmailru.firebaseapp.com",databaseURL:"https://fluorcorpmailru.firebaseio.com",projectId:"fluorcorpmailru",storageBucket:"fluorcorpmailru.appspot.com",messagingSenderId:"61247752867",appId:"1:61247752867:web:f3f93e07c1c8e47fb84d16",vapidKey:"BNplt3Du3_Pmt1EEEWG6ly2NA_agH5GSTx5k4ySgmye-Qt9HohZJ8FS7Otk2LumQuZ3VVLXnNxbDsruQFwsFbCo"},applicationName:"mail_octavius",clientName:"ru.mail.e",locale:c.default.LANG,platform:"webpush"}}exports.getFirebaseConfig=j;var k="firebase-v1";function l(){return(d.SWBOX||(0,a.hasServiceWorkerTag)(k))&&a.SWBoxImpl.isSupported()}exports.isSWBoxEnabled=l;function m(c){var k=f.default.user.getEmail();var m="https://".concat(location.host);var n=(0,a.createServiceWorker)(k);var o=function(){var a=g();var c=h(m);var f=i(m);var k=j();n.config({project:"octavius",logSilentErrors:d.SWBOX_LOG_SILENT_ERRORS,analyticsRequest:d.SWBOX_ANALYTICS_REQUEST,tokenUpdateInterval:d.SWBOX_TOKEN_UPDATE_INTERVAL,rpc:{enabled:true,config:{urls:{project:m,token:"".concat(e.setup("baseUrl"),"v1/tokens"),sdc:e.setup("sdcUrl")}}},xray:b.default.getConfig(),pushHandler:{enabled:true,config:k,templates:{default:c,mail:f},pushes:{default:a,mail:__assign(__assign({},a),{template:"mail",dataFetcher:"mailMessageData"}),promo:{}}}})};if(!l()){return n}n.register().then(function(){o();if(!n.pushManager){return}n.pushManager.on("message.open",function(a){c.go("#read-letter",{folder:a.fetchedData.folderId,letter:a.fetchedData.threadId,id:a.fetchedData.messageId})})}).catch(function(a){if(typeof a==="string"&&a==="The operation is insecure."){b.default.send("push_security_error",{i:"octavius"})}});return n}var n;exports.default={fetch:function(a){n=n!==null&&n!==void 0?n:m(a.router);return Promise.resolve(l()?n:undefined)},getInstance:function(){return n}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("push-metrics.setup",["require","exports","@mail/sw-box","@mail/xray","data-source/source/swBox"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.pushMetricsSetup=void 0;b=__importDefault(b);function d(){var d,e;var f=(e=(d=window.navigator)===null||d===void 0?void 0:d.serviceWorker)===null||e===void 0?void 0:e.ready;if(!f){b.default.send("webpush_serviceworker_absence");return}f.then(function(a){var b;return(b=a===null||a===void 0?void 0:a.pushManager)===null||b===void 0?void 0:b.getSubscription()}).then(function(b){if(!b){return"none"}return(0,a.describeSubscription)(b).then(function(a){if(a.applicationServerKey===(0,c.getFirebaseConfig)().api.vapidKey){return"swbox"}else{return"pushmanager"}})}).catch(function(){return"none"}).then(function(a){var c;var d=((c=window.Notification)===null||c===void 0?void 0:c.permission)||"error";b.default.send("webpush",{dwh:{push_type:a,push_permission:d}})})}exports.pushMetricsSetup=d});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/calls",["require","exports","@mail/calls-api","@mail/flags","@mail/xray","cfgUser","default-values","Emitter"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CallsService=void 0;b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);var g;var h=null;var i=function(f){__extends(i,f);function i(){return f!==null&&f.apply(this,arguments)||this}i.prototype.loadTools=function(){!g&&(g=new Promise(function(a,b){require(["@mail/oauth"],a,b)}).then(__importStar).then(function(a){a.init({clientId:"b4c073bb6c5a4b1b84d2c7d2a1bceb9b",scopes:["calls.api"]});return{oauth:a}}));return g};i.prototype.createRoom=function(){var a=this;return new Promise(function(d,f){if(typeof window.fetch!=="function"){c.default.send("calls_create_error_fetch-unsupported");f("fetch-unsupported")}var g=setTimeout(function(){c.default.send("calls_create_error_timeout");f("timeout")},e.CALLS_CREATE_ROOM_TIMEOUT);a.loadTools().then(function(a){var h=a.oauth;h.auth(function(a){var i=a.status,j=a.access_token;if(i!==h.AUTH_CONNECTED){c.default.send("calls_create_error_oauth",{rlog:"calls_error_oauth",rlog_message:JSON.stringify(i)});f("oauth")}fetch(e.CALLS_CREATE_ROOM_URL,{method:"POST",headers:{Authorization:"Bearer "+j}}).then(function(a){clearTimeout(g);if(a.ok){a.json().then(function(a){if(!a.url){c.default.send("calls_create_error_invalid-body");f("invalid-body")}c.default.send("calls_create_success");d(a.url);var e=b.default.get("used-calls");if(!(e&&e.state)){e===null||e===void 0?void 0:e.save({state:true,time:true})}})}else if(a.status===429){c.default.send("calls_create_error_ratelimit");f("ratelimit")}else{c.default.send("calls_create_error_api_"+a.status);f("api")}}).catch(function(a){clearTimeout(g);c.default.send("calls_create_error_network",{rlog:"calls_error_api",rlog_message:JSON.stringify(a)});f("network")})})}).catch(function(a){c.default.send("calls_create_error_load",{rlog:"calls_error",rlog_message:JSON.stringify(a)});f("load")})})};i.prototype.getTemplate=function(a){var b=i18n("Перейдите по ссылке, чтобы подключиться к звонку:");return"".concat(b,' <a href="').concat(a,'" data-call-url="').concat(a,'">').concat(a,"</a><br/>\x3c!--focus--\x3e")};i.prototype.getPlannedTime=function(a){var b=(a||new Date).getHours();var c=(a||new Date).getMinutes()>49?2:1;var d=(b+c)%24;return(d<10?"0":"")+d+":00"};i.prototype.getSubject=function(){return i18n("Приглашение на звонок")};i.prototype.getCallsAPIClient=function(){var b=this;if(!h){h=(0,a.createCallsAPIClient)({callBaseUrl:e.CALLS_BASE_URL,email:d.default.initialUser.email,incomingCalls:e.CALLS_P2P,xraySend:c.default.send.bind(c.default),onShow:function(a){return b.emit("update",__assign({action:"start"},a))},onHide:function(){return b.emit("update",{action:"end"})}})}return h};return i}(f.default);exports.CallsService=i;exports.default=new i});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("boot/after-ready",["require","exports","@instant-messengers/vk-teams-bridge","default-values","temporary/force-3pane-exp","../lazy.modules","../push-metrics.setup","../service/calls"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.setupClientLogSend=exports.initAfterReady=exports.vkTeamSendSuccessEvent=exports.initDND=void 0;a=__importDefault(a);f=__importDefault(f);function g(a){(0,d.lazyUIDragAndDrop)().then(function(b){new b({router:a}).renderTo(document.getElementById("drag-and-drop"))})}exports.initDND=g;function h(){a.default.send("LoadingCompleted",{ok:true}).then(function(a){return console.log("VKTeamsBridge init: ",a)}).catch(function(a){return console.error("VKTeamsBridge init error: ",a)})}exports.vkTeamSendSuccessEvent=h;var i=function(a){if(!b.WEBPUSH_METRIC_DISABLE){(0,e.pushMetricsSetup)()}f.default.getCallsAPIClient();(0,c.perform)()};exports.initAfterReady=i;function j(){Promise.all([(0,d.lazyMailKeymaster)(),(0,d.lazyHelpersLogger)()]).then(function(a){var b=a[0],c=a[1];b("ctrl+alt+l",c.sendLogs)})}exports.setupClientLogSend=j});define("feast-tpl!app/feast-tpl!ui-block/headline/headline.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="hidden" test="!attrs.enabled || !attrs.visible"/>\n</div>\n',"app/feast-tpl!ui-block/headline/headline.html")});define("feast-tpl!ui-block/headline/headline.html",["feast-tpl!app/feast-tpl!ui-block/headline/headline.html"],function(a){return a});define("helpers/dom-utils",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.insertHTML=exports.getPreviousSibling=exports.getNextSibling=exports.parentsUntil=void 0;function a(a,b,c){var d=[];var e=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector;a=a.parentElement;while(a&&!e.call(a,b)){if(!c){d.push(a)}else if(e.call(a,c)){d.push(a)}a=a.parentElement}return d}exports.parentsUntil=a;function b(a,b){var c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector;var d=a.nextElementSibling;if(!b){return d}while(d){if(c.call(d,b)){return d}d=d.nextElementSibling}}exports.getNextSibling=b;function c(a,b){var c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector;var d=a.previousElementSibling;if(!b){return d}while(d){if(c.call(d,b)){return d}d=d.previousElementSibling}}exports.getPreviousSibling=c;function d(a,b){a.innerHTML=b;var c=a.querySelectorAll("script");for(var d=0;d<c.length;d++){var e=c[d];var f=document.createElement("SCRIPT");if(e.innerText.length){f.appendChild(document.createTextNode(e.innerText))}for(var g=0;g<e.attributes.length;g++){var h=e.attributes[g];f.setAttribute(h.name,h.value)}if(e.parentNode){e.parentNode.replaceChild(f,e)}}}exports.insertHTML=d});define("helpers/parse",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.parseStringToBoolean=b;var a={false:false,true:true,0:false,1:true};function b(b){return a[b]}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/adv/encryptor",["require","exports","@mail/xray","default-values","request","utils/util"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);var e="^(("+window.location.protocol+")?//"+window.location.host+")?/";var f=new RegExp(e+"api-proxy");var g=new RegExp(e+"api/v1(.*)$");var h=new RegExp(e+"api/v1/(messages/attaches/add|user/signature/attaches/add|ab/import)");var i=b.API_ENCRYPTOR_CONFIG[0],j=b.API_ENCRYPTOR_CONFIG[1],k=b.API_ENCRYPTOR_CONFIG[2];var l={endpoint:"/api/v1",type:i,key:k,limit:j,getUrl:function(a){if(a.match(g)&&!a.match(h)){return g.exec(a)[3]}if(a.match(f)){return a}}};function m(a,b){if(a.length<b){return a}}function n(a,c){var e=c.settings;var f=a.getUrl(e.url);if(f){var g=e.params||e.data;if(!g||typeof g==="string"||d.default.isPlainObject(g)){var h=void 0;var i=f.indexOf("/api-proxy/rb-mimic/v1/")===0?b.API_ENCRYPTOR_MIMIC_LIMIT:j;if(g){f+=f.includes("?")?"&":"?";if(typeof g==="string"){h=m(d.default.param({__urlp:f+g}),i)}else{h=m(f+d.default.param(g),i);if(h){h={__urlp:h}}}}else{h=m(d.default.param({__urlp:f}),i)}if(h){e.url=a.endpoint;e.method="POST";e.type="POST";e.data=h;delete e.params;if(e.headers){e.headers["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8"}}}}}var o={encryptorOptions:l,enable:function(){c.default.on("start",function(a,b){b.on("beforesend",function(a){n(l,{settings:a})})});if(b.ENABLE_XRAY_ENCRYPTOR){a.default.setConfig({beforeSend:function(a,b){n(l,{settings:b});return true}})}},initXHR:function(a,b){return n(a,b)}};exports.default=o});define("service/adv/locator",["exports","@mail/smokescreen","cfgUser","default-values"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.locator=undefined;var d=f(a);var e=f(b);function f(a){return a&&a.__esModule?a:{default:a}}var g=exports.locator=new d.default({match:c.SMOKESCREEN_LOCATORS,styleSheetsOptions:{stylesAlwaysInHead:true,substituteRelative:true,justOneSelectorArr:e.default.oneSelectorRules}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/storage",["require","exports","@mail/xray","cfgUser"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createSessionStorage=exports.createScopeStorage=void 0;a=__importDefault(a);b=__importDefault(b);var c=function(a,c){if(c===void 0){c=true}return c?"".concat(b.default.get("initialUser.email")||"",":").concat(a):a};var d=function(){function b(c){if(c===void 0){c="localStorage"}if(c===b.LOCAL_STORAGE){try{this.storage=window.localStorage}catch(b){a.default.send("localstorage_access_error",{rlog:"octavius_app_jserror",rlog_message:JSON.stringify(b)});this.storage={}}}else if(c===b.SESSION_STORAGE){try{this.storage=window.sessionStorage}catch(b){a.default.send("sessionstorage_access_error",{rlog:"octavius_app_jserror",rlog_message:JSON.stringify(b)});this.storage={}}}else{this.storage={}}}Object.defineProperty(b,"LOCAL_STORAGE",{get:function(){return"LOCAL_STORAGE"},enumerable:false,configurable:true});Object.defineProperty(b,"SCOPE_STORAGE",{get:function(){return"SCOPE_STORAGE"},enumerable:false,configurable:true});Object.defineProperty(b,"SESSION_STORAGE",{get:function(){return"SESSION_STORAGE"},enumerable:false,configurable:true});b.prototype.set=function(a,b,d){if(d===void 0){d={}}var e=c(a,d.email);try{this.storage[e]=JSON.stringify(b)}catch(a){}};b.prototype.get=function(a,b){if(b===void 0){b={}}var d=c(a,b.email);try{return JSON.parse(this.storage[d])}catch(a){return null}};b.prototype.remove=function(a,b){if(b===void 0){b={}}var d=c(a,b.email);try{if(typeof this.storage.removeItem==="function"){this.storage.removeItem(d)}else{this.storage[d]=undefined}}catch(a){}};return b}();exports.default=new d(d.LOCAL_STORAGE);function e(){return new d(d.SCOPE_STORAGE)}exports.createScopeStorage=e;function f(){return new d(d.SESSION_STORAGE)}exports.createSessionStorage=f});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/actions",["require","exports","pilotjs"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TOGGLE_LETTERS_LIST_DIVIDERS=exports.HIDE_UNSUBSCRIBE_SENDER=exports.COUNT_UNSUBSCRIBE_VIEW=exports.DELETE_SENDER_FROM_UNSUBSCRIBE_LIST=exports.HIDE_SIDEBAR_FOOTER_PAY_NOTIFY_BADGE=exports.UPDATE_LAYOUT_SUPPORT_TODO=exports.SET_WIDGET=exports.TOGGLE_TODO=exports.TOGGLE_PAGINATOR=exports.TOGGLE_TO_MYSELF_METATHREAD=exports.HIDE_PAYMENT_DIE=exports.LOAD_PAGE=exports.THREAD_LOAD_MORE=exports.UPDATE_LAYOUT_SUPPORT_3_PANE=exports.TOGGLE_FOLDER_SHORTCUTS=exports.TOGGLE_COMPOSE_EXTEND_MODE=exports.ENABLE_ACTUAL_MESSAGES=exports.TOGGLE_ACTUAL_MESSAGES_IN_NEWSLETTERS=exports.TOGGLE_ACTUAL_MESSAGES_IN_INBOX=exports.TOGGLE_PONY_MODE=exports.UPDATE_LAYOUT_TYPE=exports.UPDATE_SEARCH=exports.TOGGLE_DISCOUNTS=exports.TOGGLE_THREADS_SETTING=exports.TOGGLE_METATHREADS_SETTINGS=exports.EDIT_METATHREADS_SETTINGS=exports.CHANGE_METATHREADS_SETTING=exports.TOGGLE_METATHREADS_SETTING=exports.LOAD_MORE_METATHREAD=exports.UPDATE_METATHREAD_FILTERS=exports.TOGGLE_METATHREAD=exports.EXECUTE_JSSDK_ACTION=exports.DESTROY_THREADS_AND_MESSAGES=exports.UPDATE_ALL=exports.LOAD_MORE=exports.NAVIGATE=void 0;a=__importDefault(a);exports.NAVIGATE=a.default.Loader.ACTION_NAVIGATE;exports.LOAD_MORE="LOAD_MORE";exports.UPDATE_ALL="UPDATE_ALL";exports.DESTROY_THREADS_AND_MESSAGES="DESTROY_THREADS_AND_MESSAGES";exports.EXECUTE_JSSDK_ACTION="EXECUTE_JSSDK_ACTION";exports.TOGGLE_METATHREAD="TOGGLE_METATHREAD";exports.UPDATE_METATHREAD_FILTERS="UPDATE_METATHREAD_FILTERS";exports.LOAD_MORE_METATHREAD="LOAD_MORE_METATHREAD";exports.TOGGLE_METATHREADS_SETTING="TOGGLE_METATHREADS_SETTING";exports.CHANGE_METATHREADS_SETTING="CHANGE_METATHREADS_SETTING";exports.EDIT_METATHREADS_SETTINGS="EDIT_METATHREADS_SETTINGS";exports.TOGGLE_METATHREADS_SETTINGS="TOGGLE_METATHREADS_SETTINGS";exports.TOGGLE_THREADS_SETTING="TOGGLE_THREADS_SETTING";exports.TOGGLE_DISCOUNTS="TOGGLE_DISCOUNTS";exports.UPDATE_SEARCH="UPDATE_SEARCH";exports.UPDATE_LAYOUT_TYPE="UPDATE_LAYOUT_TYPE";exports.TOGGLE_PONY_MODE="TOGGLE_PONY_MODE";exports.TOGGLE_ACTUAL_MESSAGES_IN_INBOX="TOGGLE_ACTUAL_MESSAGES_IN_INBOX";exports.TOGGLE_ACTUAL_MESSAGES_IN_NEWSLETTERS="TOGGLE_ACTUAL_MESSAGES_IN_NEWSLETTERS";exports.ENABLE_ACTUAL_MESSAGES="ENABLE_ACTUAL_MESSAGES";exports.TOGGLE_COMPOSE_EXTEND_MODE="TOGGLE_COMPOSE_EXTEND_MODE";exports.TOGGLE_FOLDER_SHORTCUTS="TOGGLE_FOLDER_SHORTCUTS";exports.UPDATE_LAYOUT_SUPPORT_3_PANE="UPDATE_LAYOUT_SUPPORT_3_PANE";exports.THREAD_LOAD_MORE="THREAD_LOAD_MORE";exports.LOAD_PAGE="LOAD_PAGE";exports.HIDE_PAYMENT_DIE="HIDE_PAYMENT_DIE";exports.TOGGLE_TO_MYSELF_METATHREAD="TOGGLE_TO_MYSELF_METATHREAD";exports.TOGGLE_PAGINATOR="TOGGLE_PAGINATOR";exports.TOGGLE_TODO="TOGGLE_TODO";exports.SET_WIDGET="SET_WIDGET";exports.UPDATE_LAYOUT_SUPPORT_TODO="UPDATE_LAYOUT_SUPPORT_TODO";exports.HIDE_SIDEBAR_FOOTER_PAY_NOTIFY_BADGE="HIDE_SIDEBAR_FOOTER_PAY_NOTIFY_BADGE";exports.DELETE_SENDER_FROM_UNSUBSCRIBE_LIST="DELETE_SENDER_FROM_UNSUBSCRIBE_LIST";exports.COUNT_UNSUBSCRIBE_VIEW="COUNT_UNSUBSCRIBE_VIEW";exports.HIDE_UNSUBSCRIBE_SENDER="HIDE_UNSUBSCRIBE_SENDER";exports.TOGGLE_LETTERS_LIST_DIVIDERS="TOGGLE_LETTERS_LIST_DIVIDERS"});define("data-source/match/match",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function a(a){if(this.length){return this.includes(a)}return true}function b(a){return!this.includes(a)}exports.default=function(c){var d=a.bind(c);d.exclude=b.bind(c);return d}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/ui-layout",["require","exports","@mail/flags","data-source/actions","data-source/match/match","default-values","service/adv/config","service/radars/index","service/storage"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.changeSupportTodo=exports.changeSupport3Pane=exports.defaults=void 0;a=__importDefault(a);c=__importDefault(c);f=__importDefault(f);g=__importDefault(g);var h="octavius-disable-air-mode";var i="octavius-folder-shortcuts";var j="compose:extended";var k="todo";var l="widget-calendar";var m=function(){var a=g.default.get(j);return a||false};var n=function(){var b=a.default.get(h);return!d.TOUCH_MODE&&b&&b.state};var o=function(){var b=a.default.get(i);return b&&b.state};var p={"widget-todo":a.default.get(k),"widget-calendar":a.default.get(l)};var q=function(a){var b=p[a];return(r(a)?1e3:1)*((b===null||b===void 0?void 0:b.getTime())||Date.now()/1e3)};var r=function(a){var b=p[a];return!!(b===null||b===void 0?void 0:b.state)||d.WIDGET_COLUMN_DEFAULT_OPEN&&!(b===null||b===void 0?void 0:b.isExist())};var s=function(a,b){var c=p[a];if(c&&r(a)===b){return}c.state=b;c.save({state:b,time:true})};var t=function(){if(!d.WIDGET_CALENDAR||!d.WIDGET_COLUMN){return"widget-todo"}if(!d.SHOW_TODO_TOGGLE){return"widget-calendar"}var a=q("widget-todo");var b=q("widget-calendar");if(a>b){return"widget-todo"}return"widget-calendar"};exports.defaults={type:d.USE_3PANE?"3pane":"2pane",support3pane:true,ponyMode:n(),manualShortcuts:o(),composeExtended:m(),supportWidget:true,widget:t(),widgetIsOpen:r(t())};var u=function(a){exports.defaults.support3pane=a};exports.changeSupport3Pane=u;var v=function(a){exports.defaults.supportWidget=a};exports.changeSupportTodo=v;exports.default={match:(0,c.default)(["#attachment","#attachment-editor"]).exclude,fetch:function(c,d,k,l){var m=k&&k.type;var n=k.value;var o=l&&l.uiLayout||exports.defaults;switch(m){case b.UPDATE_LAYOUT_SUPPORT_3_PANE:{return __assign(__assign({},o),{support3pane:n})}case b.UPDATE_LAYOUT_SUPPORT_TODO:{return __assign(__assign({},o),{supportWidget:n})}case b.UPDATE_LAYOUT_TYPE:{a.default.get("use-3pane").save({state:n==="3pane"});return __assign(__assign({},o),{type:n})}case b.TOGGLE_PONY_MODE:{var p=!o.ponyMode;a.default.get(h).save({state:p});(0,e.setRBParam)("ponymode",p?1:0);return __assign(__assign({},o),{ponyMode:p})}case b.TOGGLE_TODO:{s("widget-todo",o.widget!=="widget-todo"||!o.widgetIsOpen);return __assign(__assign({},o),{widget:"widget-todo",widgetIsOpen:r("widget-todo")})}case b.SET_WIDGET:{var q=n.widget,t=n.open;if(o.widget!==q){s(o.widget,false)}s(q,t);return __assign(__assign({},o),{widget:q,widgetIsOpen:t})}case b.TOGGLE_FOLDER_SHORTCUTS:{var p=!o.manualShortcuts;(0,f.default)(["on_shortcuts_change",p?"on":"off"]);a.default.get(i).save({state:p});return __assign(__assign({},o),{manualShortcuts:p})}case b.TOGGLE_COMPOSE_EXTEND_MODE:{var p=!o.composeExtended;(0,f.default)(["on_compose_extend_change",p?"on":"off"]);g.default.set(j,p);return __assign(__assign({},o),{composeExtended:p})}}return o}}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/adv/config",["require","exports","@mail/adman-logger","@mail/features","@mail/flags","@mail/xray","cfg","cfgUser","default-values","helpers/parse","logger","service/adv/encryptor","service/adv/locator","service/radars/index","service/smokescreen","service/storage","../../data-source/source/ui-layout"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getAdvTheme=exports.defaultViewerTheme=exports.getSize=exports.defaultTheme=exports.placementsConfig=exports.slotsConfig=exports.deleteRBParam=exports.setRBParam=exports.getRBParams=exports.siteParams=exports.getExpId=exports.hasWhiteList=exports.hasAdBlock=exports.hasBlocker=exports.options=exports.getSiteZone=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);i=__importDefault(i);j=__importDefault(j);l=__importDefault(l);m=__importDefault(m);n=__importStar(n);var p=function(){return 10};exports.getSiteZone=p;exports.options={immediateFetchTimeout:g.ADMAN_BROKER_IMMEDIATE_FETCH_TIMEOUT,delayedFetchTimeout:g.ADMAN_BROKER_DELAYED_FETCH_TIMEOUT};var q=function(){return a.default.hasBlocker()};exports.hasBlocker=q;var r=function(){return a.default.hasAdBlock()};exports.hasAdBlock=r;var s=function(){var b;return(b=a.default.hasAdBlockWhiteList)===null||b===void 0?void 0:b.call(a.default)};exports.hasWhiteList=s;var t=function(){return a.default.getExpId()};exports.getExpId=t;if(a.default.injector){a.default.injector.set("onClickWithBlockerWhitelistHosts",e.default.urls.mimicWhitelistUrls)}exports.siteParams={preview:location.search.match(/[?&]preview=(\d+)/)&&RegExp.$1,siteId:105,version:"octavius"};function u(a){var b=a.origin,c=a.data;if(b==="https://ad.mail.ru"&&c){window.removeEventListener("message",u);var d=c==="connected"||c==="not_authorized"?1:0;n.default.set("trgVkAuth",d,{email:false})}}function v(){window.addEventListener("message",u);var a=document.createElement("iframe");a.style.display="none";a.src="//ad.mail.ru/dist/vkAuth.html";document.body.appendChild(a)}if(g.ADMAN_SEND_HAS_VK){v()}var w=function(){var a={};if(g.ADMAN_USE_DIRECT_LOAD_ERROR_CALLBACK&&(!g.ADMAN_USE_DIRECT_LOAD_ERROR_CALLBACK_FOR_BLOCKER||(0,exports.hasBlocker)())){var b="direct"+Math.random().toString(36).slice(2);window[b]=function(a){if(g.ADMAN_USE_MIMIC_ON_DIRECT_LOAD_ERROR&&g.ENABLE_SMOKESCREEN){delete window[b];k.locator.setup({enable:true});j.default.enable();m.default.default.subscribeToggleOn("routeend");if(g.ADMAN_REINIT_ON_DIRECT_LOAD_ERROR&&g.ADMAN_REINIT_ON_DETECT){m.default.default.router.reload()}(0,l.default)("adman_direct_error_reinit")}else{a();(0,l.default)("adman_direct_error_target")}i.default.add("ADMAN.DIRECT_LOAD_ERROR");(0,l.default)("adman_direct_error")};a.directLoadErrorCallback=b}var d=new URLSearchParams(window.location.search);if(d.has("newreg")){a.mail_event="registration"}else if(d.has("authid")||d.has("back")){a.mail_event="login"}a.ponymode=o.defaults.ponyMode?1:0;a.in3paneMetathread=0;a.userid=f.default.get("initialUser.email");a.rounded=g.ADVERT_SIDEBAR_ROUNDED?1:0;var e=c.default.get("octavius-easy-ads");var h=(e===null||e===void 0?void 0:e.isExist())?e===null||e===void 0?void 0:e.isActive():g.ADVERT_EASY_ADV_EXP;if(!g.ADVERT_EASY_ADV_DISABLED&&h){a.easyadv=1}if(g.ADMAN_SEND_SYNC_IDS){var p=n.default.get("rb_sync_id",{email:false});if(p){Object.assign(a,p)}var q=(0,n.createSessionStorage)().get("rb_sync_id",{email:false});if(q){Object.assign(a,q)}}if(g.ADMAN_SEND_HAS_VK){var r=n.default.get("trgVkAuth",{email:false});if(r==1){a.vk=1}}if(g.ADV_WEB_PERF_EXP_ID){a.web_perf_exp_id=g.ADV_WEB_PERF_EXP_ID}return a};var x=w();var y=function(){return x};exports.getRBParams=y;var z=function(a,b){x[a]=b};exports.setRBParam=z;var A=function(a){return delete x[a]};exports.deleteRBParam=A;exports.slotsConfig={};exports.placementsConfig={};g.ADV_SPECLINE_ENABLED&&Object.assign(g.ADV_SLOTS,g.ADV_SPECLINE_SLOTS);Object.entries(g.ADV_SLOTS).forEach(function(a){var b=a[0],c=a[1];var d=c.slot,e=c.limit,f=c.autoUpdate,i=c.onAutoUpdate,j=c.renderThrottling,k=c.handlePageVisibility,l=c.counter,m=c.urlChangeOnly,n=c.statId,o=c.mimicId,p=c.mimicLimit,q=p===void 0?e:p,r=c.width;exports.slotsConfig[b]={id:d,name:b,counter:(0,h.parseStringToBoolean)(l),urlChangeOnly:(0,h.parseStringToBoolean)(m),limit:parseInt(e,10),statId:n,mimicId:o,mimicLimit:parseInt(q,10),onAutoUpdate:(0,h.parseStringToBoolean)(i)};exports.placementsConfig[b]={siteZone:exports.getSiteZone,name:b,slot:d,autoUpdate:parseInt(f,10),renderThrottling:parseInt(j,10),handlePageVisibility:(0,h.parseStringToBoolean)(k),calculateHeight:b==="sidebar"||b==="sidebar-small",width:parseInt(r,10),heightCoef:g.ADVERT_SCROLL_CONF[1],rbParams:exports.getRBParams,renderOnCreate:false,bannerEvents:["banner:started","banner:finished"]}});exports.defaultTheme={isDarkTheme:false,siteBgColor:"ffffff",urlColor:"999999",hoverColor:"000000",bg:"ffffff",bgHover:"ffffff",borderColor:"ffffff",textColor:"000000",titleColor:"005bd1",titleHoverColor:"000000",listBg:"f0f5ff",listBgHover:"f0f5ff",listBorderColor:"ffffff",listTitleColor:"005bd1",listTitleHoverColor:"005bd1",listTextColor:"333333",listButtonBgColor:"ffffff",listButtonTextColor:"333333",listButtonBorderColor:"e2e2e1",listButtonBorderHoverColor:"005BD1",listButtonTextHoverColor:"005BD1",listButtonBgHoverColor:"ffffff",sentMsgOkBg:"ffffff",sentMsgOkBgHover:"ffffff",sentMsgOkBorderColor:"e0e0e0",sentMsgOkTextColor:"000000",sentMsgOkTitleColor:"005bd1",sentMsgOkTitleHoverColor:"000000"};var B={isDarkTheme:true,siteBgColor:"000000",urlColor:"9C9C9C",hoverColor:"ffffff",bg:"000000",bgHover:"000000",borderColor:"000000",textColor:"ffffff",titleColor:"0667FF",titleHoverColor:"ffffff",listBg:"151515",listBgHover:"151515",listBorderColor:"1F1F1F",listTitleColor:"589BFF",listTitleHoverColor:"589BFF",listTextColor:"333333",listButtonBgColor:"313131",listButtonTextColor:"D7D7D7",listButtonBorderColor:"313131",listButtonBorderHoverColor:"414141",listButtonTextHoverColor:"D7D7D7",listButtonBgHoverColor:"414141",sentMsgOkBg:"313131",sentMsgOkBgHover:"313131",sentMsgOkBorderColor:"1D1D1D",sentMsgOkTextColor:"ffffff",sentMsgOkTitleColor:"0667FF",sentMsgOkTitleHoverColor:"ffffff"};var C={"2pane":{ponymode:{isPonymode:true,advHeight:40,imgWrapperHeight:36,imgWrapperWidth:95,imgHeight:95,imgWidth:95,titleLineHeight:20,titleFontSize:13,infoLineHeight:17,infoFontSize:13,infoMarginTop:0,infoWidth:670,descriptionLineHeight:20,descriptionFontSize:13},notPonymode:{isPonymode:false,advHeight:48,imgWrapperHeight:42,imgWrapperWidth:110,imgHeight:110,imgWidth:110,titleLineHeight:20,titleFontSize:15,infoLineHeight:17,infoFontSize:13,infoMarginTop:0,infoWidth:670,descriptionLineHeight:20,descriptionFontSize:13}},"3pane":{ponymode:{isPonymode:true,advHeight:81,imgWrapperHeight:56,imgWrapperWidth:90,imgHeight:90,imgWidth:90,titleLineHeight:20,titleFontSize:15,infoLineHeight:16,infoFontSize:11,infoMarginTop:2,descriptionLineHeight:18,descriptionFontSize:12},notPonymode:{isPonymode:false,advHeight:101,imgWrapperHeight:56,imgWrapperWidth:100,imgHeight:100,imgWidth:100,titleLineHeight:20,titleFontSize:15,infoLineHeight:16,infoFontSize:11,infoMarginTop:10,descriptionLineHeight:18,descriptionFontSize:13}}};var D=function(a){var b=(0,exports.getRBParams)(),c=b.in3paneMetathread,d=b.ponymode;var e=d||c?"ponymode":"notPonymode";return C[a][e]};exports.getSize=D;exports.defaultViewerTheme={top:"dcdcdc",topHover:"ffffff",bg:"333333"};var E=b.default.getAsJSON("adv-theme-new",{});var F=b.default.getAsJSON("adv-theme-viewer",{});var G=b.default.getAsJSON("adv-theme-dark",{});Object.assign(exports.defaultTheme,E);Object.assign(B,G);Object.assign(exports.defaultViewerTheme,F);function H(a){return __assign(__assign({},exports.defaultTheme),a.isDarkMode()?B:null)}exports.getAdvTheme=H;var I=function(){if("_timers"in window){delete window._timers.ready_app}document.removeEventListener("visibilitychange",I)};document.addEventListener("visibilitychange",I);if(window.__PH&&!g.ADV_SEND_MULTI_ACCOUNT_DISABLE){window.__PH.loadAccountsList(function(a){if(a&&a.accounts){var b=a.accounts.filter(function(a){return!a.active}).map(function(a){return a.email});if(b.length){(0,exports.setRBParam)("email",b.join(","))}}})}if(g.ADVERT_XHR_RESTORE){var J=["init"];try{XMLHttpRequest.prototype.send()}catch(a){try{if(a.stack.includes("Object.sendWrapper")){J.push("detect");var K=document.createElement("iframe");K.style.display="none";K.src="about:blank";document.body.appendChild(K);XMLHttpRequest.prototype.send=K.contentWindow.XMLHttpRequest.prototype.send;J.push("restore");document.body.removeChild(K)}}catch(a){}}d.default.send("adman-xhr-fix",{i:J})}});(function(a,b){typeof exports==="object"&&typeof module!=="undefined"?b(exports):typeof define==="function"&&define.amd?define("@mail/theme-tool/dist/index.umd",["exports"],b):(a=typeof globalThis!=="undefined"?globalThis:a||self,b(a["@mail/theme-model"]={}))})(this,function(exports){"use strict";var a=function(){a=Object.assign||function a(b){for(var c,d=1,e=arguments.length;d<e;d++){c=arguments[d];for(var f in c)if(Object.prototype.hasOwnProperty.call(c,f))b[f]=c[f]}return b};return a.apply(this,arguments)};function b(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})}function c(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}}function d(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a["default"]:a}function e(a,b){return b={exports:{}},a(b,b.exports),b.exports}var f=e(function(a,exports){Object.defineProperty(exports,"__esModule",{value:true});var b=typeof window==="object"&&window||{};var c=null;var d=[];function e(){if(c===null){try{c=b.xray&&b.xray.send?b.xray:b.require("@mail/xray")}catch(a){try{c=b.require("mrg-xray")}catch(a){}}}return c||null}exports.getGlobalXRaySync=e;function f(a){if(c===null){d.push(a)}else{a(c)}}exports.getGlobalXRay=f;function g(a){var b=[];f(function(c){c=a?a(c,b):c;b.push=function(a){c.send.apply(c,a)};b.forEach(b.push);b.length=0});return{send:function(){var a=[];for(var c=0;c<arguments.length;c++){a[c]=arguments[c]}b.push(a)}}}exports.createXRayQueue=g;(function a(){if(e()===null){setTimeout(a,100)}else{d.forEach(f);d.length=0}})()});d(f);f.getGlobalXRaySync;var g=f.getGlobalXRay;f.createXRayQueue;var h=function(a){var b=a.id;return"/widgets/".concat(b,"/")};var i=function(a){return a};var j={getSlot:function(a){var b=a.id,c=a.slotNumber,d=a.getWidgetDataTransport,e=d===void 0?fetch:d,f=a.getRequestURL,g=f===void 0?h:f,j=a.parseWidgetData,k=j===void 0?i:j;var l=g({id:b,slotNumber:c});return e(l).then(function(a){return k({data:a,slotNumber:c,themeId:b})})}};var k=.5*1e3;var l=1e3;var m=[[1050,656],[1280,800],[1440,900],[1680,1050],[1920,1200],[2560,1600]].map(function(a,b,c){return a.concat(b?c[b-1].map(function(a){return++a}):[0,0])});var n={container:document.querySelector("#css-bundle-theme"),createStyle:function(a){var b=document.createElement("style");b.type="text/css";b.innerHTML=a;return b},createLink:function(a){var b=document.createElement("link");b.crossOrigin="anonymous";b.rel="stylesheet";b.type="text/css";b.href=a;return b},append:function(a){var b;(b=this.container)===null||b===void 0?void 0:b.appendChild(a)},remove:function(a){var b=a.parentNode;if(b){b.removeChild(a)}},link:null,style:null};var o=function(){function b(c,d,e,f){if(c===void 0){c="default"}if(d===void 0){d="octavius"}if(!b.SETTINGS_SETUPED){throw new Error("Setup ThemeModel settings calling ThemeModel.setupSettings before create instances")}var g=b.settings,h=g.USE_CUSTOM_THEME_PREVIEW_NAME,i=g.CUSTOM_THEMES_PREVIEWS_PATHS;var j="settings__preview";var k="vertical__preview";if(h&&e&&e.custom_preview_name){j=e.custom_preview_name()}var l=(i===null||i===void 0?void 0:i[c])||"".concat(f,"/").concat(c,"/images/").concat(j);var m=window.devicePixelRatio>1?"".concat(l,".HiDPi.jpg"):"".concat(l,".jpg");var n={};if(e===null||e===void 0?void 0:e.verticalPreview){var o=window.devicePixelRatio>1?"".concat(k,".HiDPi.jpg"):"".concat(k,".jpg");n.verticalPreview="".concat(f,"/").concat(c,"/images/").concat(o)}Object.assign(this,{widget:{}},e,a({id:c,path:f,rootProject:d,preview:m},n));this.id=c}b.setupSettings=function(c){b.settings=a(a({},b.settings),c);b.SETTINGS_SETUPED=true};b.prototype.getActualVariant=function(){var a="all";if(this.randomVariant){a=this.randomVariant}else if(this.select_variant){a=this.select_variant(this)}return a};b.prototype.getStyle=function(a){return n.createStyle(this.createAdaptiveBackgroundCSS(a))};b.prototype.getLink=function(a){if(this.select_css_alias){a=this.select_css_alias(a)}return n.createLink("".concat(this.path,"/").concat(this.id,"/").concat(this.rootProject,"/").concat(a,".css"))};b.prototype.getImagesPath=function(a){var b=this.variants?"/v1":"";return"".concat(this.path,"/").concat(this.id,"/images/bg").concat(a==="all"?b:"/".concat(a))};b.prototype.selectRandomVariant=function(){var a=this.variants;if(a){this.randomVariant=a[Math.floor(Math.random()*a.length)]}};b.prototype.loadWidgetData=function(){var a=this;var c=b.settings,d=c.getWidgetDataRequestURL,e=c.getWidgetDataTransport,f=c.parseWidgetData;var g=this.isNeedLoadData()?j.getSlot({id:this.id,getWidgetDataTransport:e,parseWidgetData:f,getRequestURL:d,slotNumber:this.widget.slot}):Promise.resolve({});g.then(function(b){delete b.background;a.widget.data=b},function(){return undefined});return g};b.prototype.preloadAdaptiveImage=function(a){var b=this.getAdaptiveImages(a);return Object.keys(b).length?new Promise(function(a){var c=new Image;c.onload=a;c.onerror=a;c.src=b["default"];setTimeout(a,l)}):Promise.resolve()};b.prototype.preload=function(a){return this.preloadAdaptiveImage(a)};b.prototype.createAdaptiveBackgroundCSS=function(a){var b=this.getAdaptiveImages(a);var c=this.id;function d(a,d,e,f){return"@media (min-width: ".concat(e,"px), (min-height: ").concat(f,"px) {")+"body.theme-".concat(c," .application-mail {")+"background-image:"+"url(".concat(b["".concat(a,"x").concat(d)],"),")+"url(".concat(b["default"],");")+"background-size: ".concat(a,"px ").concat(d,"px;")+"}"+"}"}return Object.keys(b).length?m.reduce(function(a,b){return a+d(b[0],b[1],b[2],b[3])},""):""};b.prototype.getAdaptiveImages=function(a){var b={};if(this.adaptive_background){var c=m.filter(function(a){return a[2]<=window.innerWidth||a[3]<=window.innerHeight}).pop();if(!this.randomVariant&&this.widget.data.background){Object.assign(b,this.widget.data.background)}else{var d=this.getImagesPath(a);m.forEach(function(a){b["".concat(a[0],"x").concat(a[1])]="".concat(d,"/").concat(a[0],"x").concat(a[1],".jpg")})}if(c){b["default"]=b["".concat(c[0],"x").concat(c[1])]}}return b};b.prototype.checkVariant=function(){var a=this;var b=this.getActualVariant();if(b!==this.variant){this.preload(b).then(function(){a.applyVariant(b)})}};b.prototype.apply=function(a){var b=this;return new Promise(function(c,d){b.loadWidgetData().then(function(){b.selectRandomVariant();var e=b.getActualVariant();if(b.isApplyed()&&e===b.variant){c(undefined)}else if(a){b.preload(e).then(function(){b.applyVariant(e).then(c,d)},c)}else{b.applyVariant(e).then(c,d)}},d)})};b.prototype.applyVariant=function(a){var b=this;return new Promise(function(c,d){var e=b.getLink(a);var f=b.getStyle(a);var g=b.isApplyed()?b.waitApplyVariant(n.link,n.style,e,f):b.waitApplyTheme(n.link,n.style,e,f);g.then(c,d);n.append(e);n.append(f)}).then(function(c){var d=c[0],e=c[1],f=c[2],g=c[3];b.variant=a;if(e){n.remove(e)}if(d){n.remove(d)}n.link=f;n.style=g;return b},function(c){return Promise.reject("Error applying ".concat(b.id,"/").concat(a,". Error: ").concat(c))})};b.prototype.waitApplyTheme=function(a,c,d,e){var f=this;var h=b.settings.APPLY_THEME_TIMEOUT;return new Promise(function(b,i){var j;var k=function(){g(function(a){return a.send("theme_wait_apply_error")});clearTimeout(j);i([d,e])};var l=setTimeout(k,h);var m=function(){clearTimeout(l);b([a,c,d,e])};var n=function(){if(f.isApplyed()){m()}else{j=setTimeout(n,10)}};n()})};b.prototype.waitApplyVariant=function(a,b,c,d){return new Promise(function(e){setTimeout(function(){e([a,b,c,d])},k)})};b.prototype.isSupportWidget=function(){return b.settings.SUPPORT_WIDGET_THEME_IDS.includes(this.id)};b.prototype.isNeedLoadData=function(){return!!this.widget.slot};b.prototype.isNeedAutoUpdate=function(){return!!this.auto_update};b.prototype.isApplyed=function(){var a=window.getComputedStyle(n.container);return a.content.includes(this.id)||a.fontFamily.includes(this.id)};b.prototype.isDarkMode=function(){return b.settings.DARK_MODE_THEMES.includes(this.id)};b.prototype.isWhiteTheme=function(){return this.id===b.settings.WHITE_PORTAL_THEME};b.prototype.isDarkDefaultMode=function(){return b.settings.DARK_DEFAULT_MODE_THEMES.includes(this.id)};b.prototype.isLightDefaultMode=function(){return b.settings.LIGHT_DEFAULT_MODE_THEMES.includes(this.id)};b.settings={APPLY_THEME_TIMEOUT:3e3,CUSTOM_THEMES_PREVIEWS_PATHS:{},DARK_DEFAULT_MODE_THEMES:["t5000"],DARK_MODE_THEMES:["t5000","t5001"],LIGHT_DEFAULT_MODE_THEMES:["t6000","default"],SUPPORT_WIDGET_THEME_IDS:["t1154","t1155","t1189","t1190","t1168","t3002","t3015","t5001","t1169","t5003","t5004","t5002","t5005","t5007"],USE_CUSTOM_THEME_PREVIEW_NAME:false,WHITE_PORTAL_THEME:"t6000"};b.SETTINGS_SETUPED=false;return b}();function p(a,b){return new Promise(function(c,d){if(!b){d("themesConfigLink is empty. You probably want to use 'themes-paths-v4' feature for this parameter")}window.require([b],function(b){var e=b.themes[a];if(!e){d("Theme config not found (themeId=".concat(a,")"))}c(e)},function(a){d(a)})})}function q(a,d,e,f){return b(this,void 0,void 0,function(){var b,g;return c(this,function(c){switch(c.label){case 0:if(!f){return[2,Promise.reject("themesStylesBaseLink is empty. You probably want to use 'themes-paths-v4' feature for this parameter")]}c.label=1;case 1:c.trys.push([1,3,,4]);return[4,p(a,e)];case 2:b=c.sent();return[3,4];case 3:g=c.sent();return[2,Promise.reject(g)];case 4:return[2,new o(a,d,b,f).apply(true)]}})})}exports.ThemeModel=o;exports.applyTheme=q;Object.defineProperty(exports,"__esModule",{value:true})});define("@mail/theme-tool",["@mail/theme-tool/dist/index.umd"],function(a){return a});define("helpers/date-alias",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.day=exports.hour=exports.minute=exports.second=void 0;var a=function(a){return a*1e3};exports.second=a;var b=function(a){return(0,exports.second)(a*60)};exports.minute=b;var c=function(a){return(0,exports.minute)(a*60)};exports.hour=c;var d=function(a){return(0,exports.hour)(a*24)};exports.day=d});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/themes",["require","exports","@mail/theme-tool","@mail/xray","default-values","Emitter","helpers/date-alias","service/auth"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ThemeModel=void 0;b=__importDefault(b);d=__importDefault(d);f=__importDefault(f);var g=(0,e.minute)(10);var h=(0,e.minute)(1);var i=function(a){__extends(b,a);function b(){return a!==null&&a.apply(this,arguments)||this}b.prototype.store=function(){return f.default.user.save("theme",this.id)};return b}(a.ThemeModel);exports.ThemeModel=i;i.setupSettings({DARK_DEFAULT_MODE_THEMES:c.DARK_DEFAULT_MODE_THEMES,DARK_MODE_THEMES:c.DARK_MODE_THEMES,LIGHT_DEFAULT_MODE_THEMES:c.LIGHT_DEFAULT_MODE_THEMES,SUPPORT_WIDGET_THEME_IDS:c.SUPPORT_WIDGET_THEME_IDS,WHITE_PORTAL_THEME:c.WHITE_PORTAL_THEME,APPLY_THEME_TIMEOUT:c.APPLY_THEME_TIMEOUT,USE_CUSTOM_THEME_PREVIEW_NAME:c.USE_CUSTOM_THEME_PREVIEW_NAME,CUSTOM_THEMES_PREVIEWS_PATHS:c.CUSTOM_THEMES_PREVIEWS_PATHS,getWidgetDataTransport:function(a){return fetch(a)},getWidgetDataRequestURL:function(a){var b=a.id;return"/widgets/themes/".concat(b,"/")},parseWidgetData:function(a){var b=a.data;return b.json()}});var j=function(){function a(){d.default.apply(this);this.retryCount=0;this.model=new i;this.models=[]}a.prototype.setup=function(a){Object.assign(this,a)};a.prototype.import=function(a){var b=this;var d=a.split(",");if(c.HAS_UNIQUE_THEME_ID){d=[c.UNIQUE_THEME_ID]}if(c.HAS_UNIQUE_THEME_ID_LIST){d=c.UNIQUE_THEME_ID_LIST.split(",")}this.models=d.filter(function(a){return b.config[a]}).map(function(a){return new i(a,c.THEMES_PROJECT_NAME,b.config[a],b.path)})};a.prototype.getDefaultModel=function(){return this.getModel(c.DEFAULT_THEME_ID)};a.prototype.getModel=function(a){return this.getModels().find(function(b){return b.id===a})};a.prototype.getModels=function(){return this.models};a.prototype.setThemeInterval=function(a){var b=this;clearInterval(this.timer);if(a.isNeedLoadData()){this.timer=setInterval(function(){a.apply(true).then(function(){b.emit("themes:reload",a)},function(){})},g)}else if(a.isNeedAutoUpdate()){this.timer=setInterval(function(){a.checkVariant()},h)}};a.prototype.setDefaultTheme=function(){var a=this;var b=this.getDefaultModel();this.model=b;b.apply(false).then(function(){a.setThemeInterval(b);a.emit("themes:apply",b)},function(){})};a.prototype.setTheme=function(a,d){var e=this;var f=this.model.id;var g=a.id===this.model.id?Promise.resolve():a.apply(!!this.model.id);if(!this.model.id){this.model=a}var h=new Promise(function(d,f){g.then(function(){e.model=a;e.setThemeInterval(a);e.emit("themes:apply",a);d(void 0)},function(){var g=function(){if(e.retryCount<c.LIMIT_OF_THEME_RETRY){a.apply(false).then(function(){e.model=a;e.setThemeInterval(a);e.emit("themes:apply",a);b.default.send("theme_retry_ok");d(void 0)},function(){e.retryCount++;g()})}else{e.retryCount=0;if(a.id===e.model.id){e.setDefaultTheme();b.default.send("failed_retry_page_load")}else{b.default.send("failed_retry_theme_change")}f()}};if(a.id){g()}else{e.setDefaultTheme();b.default.send("unknown_theme")}})});Promise.all([h,new Promise(function(a,b){require(["service/portal"],a,b)}).then(__importStar)]).then(function(b){var c=b[0],d=b[1];d.default.setColorTheme(a.isDarkMode()?"dark":"default")});if(d){h.then(function(){a.store()}).then(function(){b.default.send("themes_select",{dwh:{theme_from:f,theme_to:a.id}})}).catch(function(){})}return h};return a}();exports.default=j});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/themes.setup",["require","exports","@mail/features","cfg","cfgUser","default-values","helpers/define-utils","service/getModule","service/themes"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);f=__importDefault(f);g=__importStar(g);var h=new g.default;var i;var j={themes:h,load:function(){if(!i){i=(0,f.default)("themes.outsource/all.config");i.then(function(a){var b;if(d.VK_THEMES_LIST){b=c.default.get("config.themes.vklist")||"default"}else{b=c.default.get("config.themes.list")||"default"}h.setup({config:a.themes,path:window.require.s.contexts._.config.paths["themes.outsource"].replace("/".concat(c.default.BUILD_LANG),"")});h.import(b)})}return i},getColorizedModels:function(){return this.getAllModels().filter(function(a){return a.colorized})},getModels:function(){return this.getAllModels().filter(function(a){return!a.colorized})},getAllModels:function(){var a=h.getModels();var b=d.THEMES_AVAILABLE.whitelist,c=d.THEMES_AVAILABLE.colorized;return a.filter(function(a){return a.colorized&&c||b.includes(a.id)})},getDefaultModel:function(){return h.getDefaultModel()},getModel:function(a){return h.getModel(a)},getSelectedModel:function(){return h.model},setTheme:function(a,b){return h.setTheme(a,b)},setThemeById:function(a){var b=this.getModel(a);this.setTheme(b,true).catch(function(){})},getCurrentThemeId:function(){return b.default.themeId},applyUserTheme:function(){var c=this;var d=a.default.getAsString("user-unique-themeId")||a.default.getAsString("themeId")||b.default.themeId;if(d==="default"){d=a.default.getAsString("default-themeId")||"default"}var e=a.default.getAsString("user-unique-themeId-list");if(!!e&&!e.includes(d)){d=e.split(",")[0]}var f=a.default.getAsString("themeVariant");h.emit("usertheme:apply",new g.ThemeModel(d));this.load().then(function(){var a=c.getModel(d);if(a&&f){a.variants=[f]}var b=c.getDefaultModel();var e=a||b;h.setTheme(e,false).then(function(){return e},function(){return Promise.reject()}).catch(function(){h.setTheme(b).catch(function(){})})})}};(0,e.defineExternalForSyncUse)("service/themes.setup",j);exports.default=j});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/adv/mimic",["require","exports","@mail/features","@mail/mimic/dist/types/src/projects/octavius","@mail/xray","cfg","cfgUser","default-values","logger","service/adv/config","service/adv/encryptor","service/adv/locator","service/radars/index","service/themes.setup"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);g=__importDefault(g);i=__importDefault(i);k=__importDefault(k);l=__importDefault(l);var m;var n={lazyInit:function(){m=(0,b.default)({previewId:location.search.match(/[?&]preview=(\d+)/)&&RegExp.$1,pageId:String(f.MIMIC_PARTNER_ID),expId:f.MIMIC_EXP_ID,ignoreTimeout:true,project:"octavius",features:a.default,locator:j.locator,logger:g.default,xray:c.default,email:e.default.get("initialUser").email,broker:{getUrl:function(a){return f.MIMIC_ENDPOINT+"/"+a},handleResponse:function(a,b){var d=b.json&&b.json.result||{};var e=b.ajaxOptions||{};e.url="/api/v1/rb-mimic/"+a;g.default.add("mimic response",{ajax:e,status:b.status,result:d});var f=e.__ts;var h=(new Date).getTime();var i=h-f;var j={};j[a+"-hit"]=i;if(b.xhr){j[a+"-h_"+b.xhr.status]=i}if(d.status){j[a+"-a_"+d.status]=i}c.default.send("mimic-api",{i:j})},APIEncryptor:{encryptorOptions:i.default.encryptorOptions,initXHR:i.default.initXHR}}});if((0,h.hasWhiteList)()){(0,k.default)("adman_mimic_on_wl")}},setLayoutManager:function(a){this.layoutManager=a},insert:function(a,b,c,e){if(e===void 0){e=0}if(!m){this.lazyInit()}var g=h.slotsConfig[b.name];var i=this.layoutManager.getType();l.default.load().then(function(){var a=l.default.getModel(d.default.themeId)||l.default.getSelectedModel();var j={index:e,type:b.name,limit:g.mimicLimit,statId:g.statId,slotId:g.mimicId,originalSlotId:g.id,sidebarSmall:b._width===160,theme:(0,h.getAdvTheme)(a),sizes:(0,h.getSize)(i),pane:i};var k=b._container;if(k&&b.active&&!g.counter&&(!f.NO_MIMIC_ON_WLIST||!(0,h.hasWhiteList)()||f.MIMIC_IGNORE_HAS_WLIST)){m.insert(k,j).then(function(a){b.setLastRenderTS();if(c){c(a)}}).catch(function(a){if(f.IS_DEBUG){console.error(a)}})}})}};exports.default=n});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/adv/index",["require","exports","@mail/adman","@mail/xray","default-values","Emitter","router","service/adv/config","service/adv/mimic","service/radars/index","service/themes.setup","utils/util","./config"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Adman=exports.sidebarPlacementsList=exports.SLOTS_EXCEPT_SENT=void 0;a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);exports.Adman=a.default;var l={sidebar:c.ADV_FAST_UPDATE_TIMEOUT,list2pane:c.ADV_FAST_UPDATE_TIMEOUT,list3pane:c.ADV_FAST_UPDATE_TIMEOUT,"sidebar-small":c.ADV_FAST_UPDATE_TIMEOUT};exports.SLOTS_EXCEPT_SENT=["sidebar","list2pane","list3pane"];if((0,k.hasBlocker)()){try{var m=CSSStyleDeclaration.prototype.setProperty;CSSStyleDeclaration.prototype.setProperty=function a(b,c,d){try{if(b==="display"&&c==="none"&&d==="important"){try{throw new Error}catch(a){if(!a.stack.toString().includes("hideViaDisplayProperty")){return m.apply(this,arguments)}else{return m.call(this,"display","")}}}else{return m.apply(this,arguments)}}catch(a){}}}catch(a){}}var n=new a.default.Broker(f.options,f.siteParams);var o=[];var p=[];var q=function(){function a(){var a=this;this.check=function(b,c){var d=f.slotsConfig[b];if(!d.onAutoUpdate&&c){return false}if(d.urlChangeOnly){return a.checkUrlChanged()}return true}}a.prototype.checkUrlChanged=function(){var a=(0,e.getAppRouter)();var b=a.request;if(a.isReady&&b!==this.lastRequest){this.lastRequest=b;return true}return false};return a}();var r=160;var s={sidebar:true,"sidebar-small":true};exports.sidebarPlacementsList=Object.keys(s);var t="sidebar";var u=null;var v=function(b){var c=Object.keys(a.default.placements());return b.reduce(function(a,b){a=a.concat(c.filter(function(a){return a.match(b)}));return a},[])};function w(a){function b(){(0,k.deleteRBParam)("mail_event");a.removeListener("adv-render-fail",b);a.removeListener("adv-render-success",b)}a.addListener("adv-render-fail",b);a.addListener("adv-render-success",b)}function x(a){if(a===void 0){a=0}if(c.ADVERT_CPM_VALUES[a]){return c.ADVERT_CPM_VALUES[a]}return c.ADVERT_CPM_RELOAD_CONF[2]}function y(){var a=c.ADVERT_CPM_VALUES.length;if(a>0){return a-1}return c.ADVERT_CPM_RELOAD_CONF[1]}var z=[];function A(){(0,f.setRBParam)("min_cpm",x());z.forEach(C)}var B=j.default.debounce(A,1e3,null);function C(a){a.removeListener("adv-render-success",B);function b(b){var c=a.getExcludeFromAllPlacements();a.setExcludeFromAllPlacements(true);a.render(true,b).then(G.onPlacementRender.bind(G,a),function(){return null});a.setExcludeFromAllPlacements(c)}var d=null;var e=0;var g=false;a.addListener("adv-render-success",function(a){var i=a.name,j=a.banner,l=a.isAutoUpdate;clearTimeout(d);(0,f.setRBParam)("min_cpm",x());if(g){g=false}else if(j){(0,h.default)(["adman_cpm",c.ADVERT_CPM_EXP,i,"success_try",String(e)]);e=0}else if(e++<y()){(0,f.setRBParam)("min_cpm",x(e));d=setTimeout(function(){b(l)},c.ADVERT_CPM_RELOAD_CONF[0])}else{e=0;if(c.ADVERT_CPM_RELOAD_CONF[3]){g=true;(0,k.deleteRBParam)("min_cpm");b(l)}(0,h.default)(["adman_cpm",c.ADVERT_CPM_EXP,i,"not_found"])}})}function D(a){z.push(a);a.once("adv-render-success",B)}var E=null;var F=null;var G={_slotsState:{},dwhData:E,_listAdvertCurrent:F,_listAdvertNext:F,_isFeedback2step:false,_isFirstRender:true,_isFeedbackActive:c.ADVERT_FEEDBACK,activeListPlacement:"list2pane",visibleAdv:{"spec-project-letter":false},setVisibleAdv:function(a,b){this.visibleAdv[a]=b},isAdvVisible:function(a){return this.visibleAdv[a]},init:function(){var b=this;this.successSlotHandler=this.handleSlotSuccess.bind(this);this.failSlotHandler=this.handleSlotFail.bind(this);Object.keys(f.slotsConfig).forEach(function(d){var e=null;var g=f.slotsConfig[d];if(g.counter){e=(new q).check}var h=__assign(__assign({},f.placementsConfig[d]),{needRenderTogether:e,excludeFromAllPlacements:g.urlChangeOnly,expId:(0,k.getExpId)()});var i=new a.default.Slot(g,n);var j=new a.default.Placement(h,i);j.setExpIdGetter(function(){return(0,k.getExpId)()});if(j.name==="sidebar"){j.setBannerEventListener(function(a){switch(a.type){case"banner:started":j.sleep(true,true);break;case"banner:finished":j.wakeUp(true,true);break}})}if(j.name==="counter-top"){w(j)}if(c.ADVERT_CPM_RELOAD&&!g.counter){D(j)}i.on("adv-fetch-success",function(){return b.successSlotHandler(i,j)});i.on("adv-fetch-fail",function(){return b.failSlotHandler(i,j,false)});i.on("adv-fetch-force-fail",function(){return b.failSlotHandler(i,j,true)});o.push(i);p.push(j);b._slotsState[d]={status:null,retry:c.ADMAN_MIMIC_ON_FAIL_RETRY_COUNT}});this._updateBrokerTheme(i.default.getSelectedModel());a.default.attachBroker(n);a.default.addSlots(o);a.default.addPlacements(p);a.default.on("adv-render-fail",this.handleRenderFail.bind(this))},update:function(b){var d=this;if(b===void 0){b={}}var e=b.ignoreThrottling,g=e===void 0?false:e,h=b.forceThrottlingTS,i=h===void 0?{}:h,j=b.isForced,k=j===void 0?false:j,m=b.isAutoUpdate,n=m===void 0?false:m;var o=Date.now();Object.values(a.default.placements()).filter(function(a){var b=a.name;var c=f.slotsConfig[b];if(c.counter&&!c.urlChangeOnly){return false}if(k){return true}if(b==="sent"){return false}return!/list/.test(b)}).forEach(function(a){var b=a.name;var c=f.slotsConfig[b];var e=f.placementsConfig[b];var h=i[b]||e.renderThrottling;if(c.counter&&c.urlChangeOnly){a.renderTogether(true)}else if(g){a.render(true,n).then(d.onPlacementRender.bind(d,a),function(){return null})}else if(o-a.getLastRenderTS()>h){a.render(false,n).then(d.onPlacementRender.bind(d,a),function(){return null})}});if(this._fastAutoUpdate){this._scheduleAutoUpdate(c.ADV_FAST_AUTOUPDATE_TIMEOUT,l)}},updateOnAction:function(){var a=this;window.clearTimeout(this._idleTimer);this._enableFastAutoUpdate();this._idleTimer=window.setTimeout(function(){a._disableFastAutoUpdate();(0,h.default)("adv_user-idle")},c.ADV_IDLE_TIMEOUT);(0,h.default)("adv_update-on-action");this.update({forceThrottlingTS:l})},_enableFastAutoUpdate:function(){this._fastAutoUpdate=true},_disableFastAutoUpdate:function(){this._fastAutoUpdate=false},_scheduleAutoUpdate:function(a,b){var c=this;(0,h.default)("adv_schedule-autoupdate");window.clearTimeout(this._scheduleUpdateTimer);this._scheduleUpdateTimer=window.setTimeout(function(){c.update({forceThrottlingTS:b,isAutoUpdate:true})},a)},sleep:function(){var b=[];for(var c=0;c<arguments.length;c++){b[c]=arguments[c]}var d=v(b);d.forEach(function(b){if(a.default.placement(b)){a.default.sleep(b,true)}})},wakeUp:function(){var b=[];for(var c=0;c<arguments.length;c++){b[c]=arguments[c]}var d=v(b);d.forEach(function(b){if(a.default.placement(b)){a.default.wakeUp(b)}})},_activeSidebarPlacementFromWidth:function(a){return a===r?"sidebar-small":"sidebar"},toggleActiveSidebarPlacement:function(b){var c=this._activeSidebarPlacementFromWidth(b);if(c===t){return null}var d=a.default.placement(t);if(d){d.sleep();d.detachFromContainer()}t=c;var e=a.default.placement(c);if(e){e.wakeUp(false,true)}return e},getActiveSidebarPlacement:function(){return t},toggleMimic:function(a){o.forEach(function(b){b.forceFail=a});n.clearBatches();p.forEach(function(a){a.clearPendingRender()});(0,h.default)(["adman_mimic_toggle",a]);if(a){b.default.setConfig({defaultParams:{dwh:{mimic:1}}})}},hasRequest:function(){return Object.values(this._slotsState).some(function(a){return a.status})},handleSlotSuccess:function(a){var b=this._slotsState[a.name];if(b.status==="fail"||b.status==="pending"){(0,h.default)({type:"adman_was_fail",intervals:[[a.name,1]]})}b.status="success";b.retry=c.ADMAN_MIMIC_ON_FAIL_RETRY_COUNT;(0,h.default)(["adman_slot_success"]);if(!this._successOnWLRadarSent&&(0,k.hasWhiteList)()){(0,h.default)("adman_success_on_WL");this._successOnWLRadarSent=true}},handleSlotFail:function(a,b,c,d){var e=f.slotsConfig[a.name].mimicId;var i=this._slotsState[a.name];if(c){(0,h.default)(["adman_slot","force-fail"]);i.status="fail";if(e){if(b.name.includes("list2pane")){b.name="list2pane"}else if(b.name.includes("list3pane")){b.name="list3pane"}g.default.insert(a,b,this.onPlacementRender.bind(this,b),d)}}else if(i.status==="success"||i.status==="pending"){if(i.status==="success"){(0,h.default)({type:"adman_was_success",intervals:[[a.name,1]]})}i.status="pending";if(i.retry--<=0){(0,h.default)({type:"adman_after_retry",intervals:[[a.name,1]]});(0,h.default)(["adman_slot","fail"]);this.emit("slot:fail",a,b);i.status="fail";g.default.insert(a,b,this.onPlacementRender.bind(this,b),d)}}else{(0,h.default)(["adman_slot","fail"]);this.emit("slot:fail",a,b);i.status="fail"}},handleRenderFail:function(a){window.require(["trackJS"],function(b){b.sendRadar("banners",{adman:true,error:a.error,params:{slot:a.banner.slot,banner:a.banner.banner,test_id:a.testId,site_id:a.siteId,sz:a.siteZone}},"octavius_banners")})},handleThemeApply:function(b){var c=this;if(u===b.id){return}a.default.clearCache();new Promise(function(a,b){require(["ui-react"],a,b)}).then(__importStar).then(function(a){a.default.FeastBlock.clearLetterListItemAdvCache();c._updateBrokerTheme(b);c.update({ignoreThrottling:true,isForced:true})})},_updateBrokerTheme:function(b){u=b.id;(0,f.setRBParam)("isDarkTheme",b.isDarkMode()?1:0);n.setTheme(new a.default.Theme((0,f.getAdvTheme)(b)))},onPlacementRender:function(a,b){var d=this;var e=a.name;if((e==="sidebar"||e==="sidebar-small")&&b&&this._isFeedbackActive){var f=b.dwhChain,g=b.processed;if(f&&!g){b.processed=true;setTimeout(function(){for(var a=0,b=f;a<b.length;a++){var c=b[a];d.sidebarVisibleCallback(c)}},c.ADV_DIRECT_READY_TIMEOUT)}}},sidebarVisibleCallback:function(a){this.emit("sidebar:visible");this.dwhData=a;var c=this._isFeedback2step?"ad-feedback-2-upd":"ad-feedback-upd";var d={dwh:__assign({state:c},a)};if(!this._isFirstRender){b.default.send(c,d)}this._isFirstRender=false},showAdFeedback:function(){var a=c.ADVERT_FEEDBACK_CONFIG2.chance;if(!a){return false}return c.ADVERT_FEEDBACK&&Math.random()<1/a},setFeedback2Step:function(){this._isFeedback2step=true},setFeedbackUnactive:function(){this._isFeedbackActive=false},on:function(a,b){this.emitter.addListener(a,b)},off:function(a,b){this.emitter.removeListener(a,b)},setActiveListPlacement:function(a){this.activeListPlacement=a}};d.default.apply(G);G.init();i.default.themes.one("usertheme:apply",function(a){G._updateBrokerTheme(a)});i.default.themes.on("themes:apply",G.handleThemeApply.bind(G));exports.default=G});define("service/smokescreen",["exports","@mail/honeypot","@mail/smokescreen","default-values","feast","logger","router","service/adv/config","service/adv/encryptor","service/adv/index","service/adv/locator","service/radars/index","service/themes.setup"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.selector=exports.withWelter=undefined;var m=u(a);var n=u(b);var o=u(d);var p=u(e);var q=u(h);var r=u(i);var s=u(k);var t=u(l);function u(a){return a&&a.__esModule?a:{default:a}}var v=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var w=false;var x=false;var y=false;var z=false;var A=new m.default(c.HONEYPOT);var B=exports.withWelter=n.default.createWelterDecorator(function(a){return v({},a,{attrs:{className:50,"data-id":30,"data-draggable-id":30},deps:{feast:o.default},minSize:1})});var C=j.locator.transform.bind(j.locator);var D=void 0;var E=true;var F=[];var G=c.HONEYPOT_INTERVALS.reverse();var H={init:function a(b,d){var e=this;this.router=b;this.checkHoneypot=this.checkHoneypot.bind(this);this.handleSlotFail=this.handleSlotFail.bind(this);this.handleRouteEndEvent=this.handleRouteEndEvent.bind(this);F.push.apply(F,this.getMainStyles());var f=function a(){if(c.ENABLE_SMOKESCREEN&&(!c.NO_MIMIC_ON_WLIST||!(0,g.hasWhiteList)())&&(!c.NO_MIMIC_ON_ADBLOCK||!(0,g.hasAdBlock)())){e.sendHoneypotDetectRadar(true)}};var h=function a(){r.default.on("slot:fail",function(){return e.handleSlotFail()});t.default.themes.on("themes:apply",function(){return e.update()});t.default.themes.one("themes:apply",function(){F.push.apply(F,e.getThemeStyles())})};if(d){setTimeout(f,50);setTimeout(h,1)}else{f();h()}},handleSlotFail:function a(){if(c.ENABLE_SMOKESCREEN){this.toggle(true,true)}},sendHoneypotDetectRadar:function a(b){z=true;if(this.checkHoneypot()){if(!E&&A){A.destroy();A=null}(0,s.default)(["honeypot_detect"]);if(b){(0,s.default)(["honeypot_detect_sync"])}else{(0,s.default)(["honeypot_detect_async"])}}},scheduleHoneypotChecking:function a(){var b=this;if((!E||!G.length||D)&&A){A.destroy();A=null}var c=void 0;if(G.length===1){c=G[0]}else{c=G.pop()}if(!c){return}D=setTimeout(function(){b.sendHoneypotDetectRadar()},c)},getStyles:function a(b){return Array.from(document.querySelectorAll(b)).map(function(a){return a.href})},getThemeStyles:function a(){return this.getStyles("#css-bundle-theme > link")},getMainStyles:function a(){return this.getStyles("#css-bundle > link")},setupLocatorStyles:function a(){if(F.length){j.locator.setup({links:F},function(a){console.error(a);window.require(["trackJS"],function(b){b.sendRadar("mimic",{enabled:w,error:a,params:{type:"locator"}},"octavius_mimic")})});F.length=0}},checkHoneypot:function a(){var b=A.check(c.IS_DEBUG);D=undefined;c.IS_DEBUG&&console.warn("[Honeypot] check",b);if(b||c.MIMIC_FORCE){if(c.IS_DEBUG&&c.MIMIC_FORCE){console.warn("mimic-force")}E=false;this.toggle(true)}else{this.scheduleHoneypotChecking()}return b},update:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(w&&b){q.default.enable()}var e=w&&(!d||!r.default.hasRequest());if(e){j.locator.setup({enable:w},function(a){console.error(a);window.require(["trackJS"],function(b){b.sendRadar("mimic",{enabled:w,error:a,params:{type:"switch"}},"octavius_mimic")})});this.setupLocatorStyles()}if(b){if(c.ENABLE_WELTER){n.default.toggleWelterGlobal(e)}o.default.set("classNameBuilder",e?C:undefined);r.default.toggleMimic(w);var g=(0,f.getAppRouter)();if(e&&g&&g.view){this.router.reload();p.default.add("APP.REINIT");(0,s.default)("app_reinit")}}},toggle:function a(b,d){if(!c.NO_MIMIC_ON_WLIST||!(0,g.hasWhiteList)()||(0,g.hasWhiteList)()&&d&&c.MIMIC_IGNORE_HAS_WLIST){if(!z&&(0,g.hasWhiteList)()){this.sendHoneypotDetectRadar()}var e=w!==b;w=b;if(x&&y){this.router.off("routeend",this.handleRouteEndEvent);x=false;y=false}this.update(e,d)}},lookup:function a(b){return w?j.locator.transform(b):b},isEnabled:function a(){return w},getLocator:function a(){return j.locator},isValidURL:function a(b){var c=window.location.host.replace(/\//g,"\\/");var d=new RegExp("^https:\\/\\/"+c+"\\/inbox\\/1:(.*):0\\/\\?$").exec(b);if(d&&j.locator.isWelter(d[1])){return false}return true},handleRouteEndEvent:function a(){y=true;this.toggle(true)},subscribeToggleOn:function a(b){if(!x){x=true;this.router.one(b,this.handleRouteEndEvent)}}};c.IS_DEBUG&&(window.boom=function(){return H.toggle(!w)});exports.default=H;var I=exports.selector=j.locator.selector.bind(j.locator)});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/portal",["require","exports","cfgUser","feast-mod/letters-count","helpers/dom-utils","mail/Folder","service/smokescreen","utils/util"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);d=__importDefault(d);f=__importDefault(f);var g;var h=100;var i=f.default.debounce(function(){window.__PH&&window.__PH.updateCounter({mail:(0,b.countUnreadTotalMod)()})},h,null);exports.default={load:function(){if(!g){g=Promise.resolve(a.default.get("headline")).then(function(a){var b=document.querySelector("#headline");if(b.childNodes.length&&window.__PH){b.style.visibility="visible";d.default.all.on("change reset",i);return}try{var f=document.querySelector((0,e.selector)("#headline .headline"));(0,c.insertHTML)(f,a)}catch(a){}d.default.all.on("change reset",i)})}return g},setColorTheme:function(a){var b,c;(c=(b=window.__PH)===null||b===void 0?void 0:b.setColorTheme)===null||c===void 0?void 0:c.call(b,a)}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/headline/headline",["require","exports","default-values","feast","feast-tpl!./headline.html","service/portal"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);function e(){var b=document.querySelector("#headline");if(b&&!a.HIDE_HEADLINE){b.style.display="block"}}function f(){var a=document.querySelector("#headline");if(a){a.style.display="none"}}var g=b.default.Block.extend({name:"headline",template:c.default,blocks:{},defaults:{visible:true,enabled:true},attrChanged:{enabled:function(a){a?e():f()}},didMount:function(){d.default.load()}});var h=g;h.hide=f;h.show=e;exports.default=h});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("boot/headline",["require","exports","ui-block/headline/headline","../helpers/lazy"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getHeadline=void 0;a=__importDefault(a);exports.getHeadline=(0,b.lazyInit)(function(){var b=document.getElementById("headline");var c=new a.default({visible:false});if(b.childNodes.length){c.renderTo(b)}else{c.didMount()}return c})});var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("actions/checkContactsPossessing",["require","exports","@mail/jssdk/next/action/global","RPC"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.checkContactsPossessing=exports.url=void 0;b=__importDefault(b);exports.url="ab/smart";function c(a){var c=a.emails;var d=a.fields||[];if(!c){return Promise.reject({emails:"required"})}if(!Array.isArray(c)){return Promise.reject({emails:"invalid"})}d.push("last_seen");d.push("flags");return b.default.call(exports.url,{by_email:c,simple:true,fields:d})}exports.checkContactsPossessing=(0,a.createGlobalAction)("ab/smart",function(a){return __awaiter(void 0,void 0,Promise,function(){var b,d,e;return __generator(this,function(f){switch(f.label){case 0:return[4,c(a)];case 1:b=f.sent();d=b.body||{};e=d.contacts||[];return[2,a.emails.reduce(function(a,b){if(!a.contacts){a.contacts={}}a[b]=e.some(function(a){if(!Array.isArray(a.emails)){return false}return a.emails.includes(b)});e.forEach(function(c){if(c&&Array.isArray(c.emails)&&c.emails.includes(b)){var d=c.last_seen?Object.assign({},c.last_seen):{status:"",client_type:""};a.contacts&&(a.contacts[b]=d)}});return a},{})]}})})})});var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("actions/lastSeen",["require","exports","@mail/jssdk/next/action/global","RPC"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fetchLastSeen=exports.url=void 0;b=__importDefault(b);exports.url="ab/lastseen";function c(a){var c=a.emails,d=a.only_memcache,e=d===void 0?true:d;if(!c){return Promise.reject({emails:"required"})}if(!Array.isArray(c)){return Promise.reject({emails:"invalid"})}return b.default.call(exports.url,{emails:c,only_memcache:e})}exports.fetchLastSeen=(0,a.createGlobalAction)("ab/lastseen",function(a){return __awaiter(void 0,void 0,Promise,function(){var b,d,e;return __generator(this,function(f){switch(f.label){case 0:return[4,c(a)];case 1:b=f.sent();d=b.body||[];e=new Map(d.map(function(a){return[a.email,a.last_seen]}));return[2,a.emails.reduce(function(a,b){var c=e.get(b);if(!c){return a}a[b]=c;return a},{})]}})})})});define("data-source/data-source",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isDataSourceEvent=void 0;var a=window.requestAnimationFrame||function(a){return window.setTimeout(a,12)};var b=window.cancelAnimationFrame||function(a){return window.clearTimeout(a)};function c(a){return Boolean("type"in a&&"details"in a&&a.details)}exports.isDataSourceEvent=c;var d=function(){function c(){this._emissionPid=null;this._changesBatch=[];this._handleBatchEmission=this._handleBatchEmission.bind(this)}c.prototype._handleBatchEmission=function(){var a=this;var b=this._changesBatch;this._changesBatch=[];b.forEach(function(b){a.emit("action",{type:"action",details:b})});this.emit("change",{type:"change",details:{changes:b}});b.forEach(function(b){a.emit("actionend",{type:"actionend",details:b})});this.emit("afterchange",{type:"afterchange"})};c.prototype.dispatch=function(a){this.emit("beforeaction",{type:"beforeaction",details:{action:a}})};c.prototype.updateAll=function(){throw new Error("Not implemented")};c.prototype.getData=function(){throw new Error("Not implemented")};c.prototype.getLoader=function(){throw new Error("Not implemented")};c.prototype.notifyNextData=function(c,d,e){this._changesBatch.push({request:c,action:d,data:e});if(this._emissionPid){b(this._emissionPid)}this._emissionPid=a(this._handleBatchEmission)};return c}();exports.default=d});define("service/layer-load",["exports","./getModule"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.loadLayer=d;var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}function d(a){var c=this.loaded;!c[a]&&(c[a]=new Promise(function(c){(0,b.default)("ui-block/layer-"+a+"/layer-"+a).then(function(a){var b=a.default;if(b.prototype.needToolkit){require(["ajs","feast-mailru-toolkit"],function(a,d){var e=d.loadToolkit;e(function(){c(b)})})}else{c(b)}})}));return c[a]}});var __rest=this&&this.__rest||function(a,b){var c={};for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0)c[d]=a[d];if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++){if(b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e]))c[d[e]]=a[d[e]]}return c};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/get-avatar-path",["require","exports","cfg"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);function b(b){var c=b.email,d=b.name,e=__rest(b,["email","name"]);var f=a.default.get("urls.avatarUrl");var g;if("size"in e){var h=e.size;g="width=".concat(h,"&height=").concat(h)}else{var i=e.width,j=e.height;g="width=".concat(i,"&height=").concat(j)}var k="&email=".concat(encodeURIComponent(c)).concat(d?"&name=".concat(encodeURIComponent(d)):"");return"".concat(f,"/pic?").concat(g).concat(k)}exports.default=b});define("mail/UserSecurity",["RPCModel","mail/Phone"],function(a,b){"use strict";var c=a.extend({className:"mail.UserSecurity",url:"golang/user/security",defaults:{id:null,password_changed:0,password_required:false,need_change_password:false,restore:null,phones:null},isDataFully:function(){return this.is("restore")},okPhones:function(){var a=this.get("phones");return new b.List(a?a.filter(function(a){return a.status==="ok"}):[])}});return c});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/actions/PasswordStrength",["require","exports","Action","RPC"],function(require,exports,a,b){"use strict";a=__importDefault(a);b=__importDefault(b);var c=a.default.extend({url:{signup:"utils/password/strength",change:"user/password/strength",restore:"user/password/restore/strength"},reasons:["like_current_password","like_dictionary_word","like_username","like_firstname","like_lastname","like_nickname","like_birthdate","like_city","like_phone","like_secret_question","weak","invalid","only_digits"],grades:4,gradesName:{INITIAL:1,LOW:2,MIDDLE:3,HIGH:4},operation:function a(c){var d=c.password;if(!d){return Promise.reject({password:"required"})}var e=c.type;var f=this.url[e];if(!f){f=this.url.signup}return b.default.call(f,c).then(this._processResponse.bind(this))},_processResponse:function(a){var b=a.body||{};var c=b.reasons||[];var d=b.warning_reasons||[];return{reasons:c,warningReasons:d}}});a.default.register("mail.PasswordStrength",c);c.version="0.4.0";exports.default=c;return c});define("mail/actions/PasswordChange",function(require){"use strict";var a=require("Action"),b=require("RPC");var c=a.extend({urls:{change:"user/password/change"},required:{change:["password","redirect_uri"]},_processResponse:function(a){return a.body},operation:function a(c){var d="change";var e=this.required[d];var f={};var g=false;e.forEach(function(a){if(typeof c[a]==="undefined"){f[a]="required";g=true}});if(g){return Promise.reject(f)}if(c.more_password_strength){c.more_password_strength="1"}var h=this.urls[d];return b.call(h,c).then(this._processResponse.bind(this))}});a.register("mail.PasswordChange",c);return c});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/promo",["require","exports","@mail-core/logger","cfg","default-values","feast-extension/promo","helpers/get-avatar-path","helpers/lazy","service/getModule","service/radars/index","service/smokescreen","mail/UserSecurity","mail/actions/PasswordStrength","mail/actions/PasswordChange"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);e=__importDefault(e);g=__importDefault(g);h=__importDefault(h);function j(a){return document.querySelector((0,i.selector)(".".concat(d.promoClassPrefix).concat(a)))}var k;var l;var m="octavius";function n(){return m}function o(){return document.querySelector((0,i.selector)(".renovator"))}var p=function(){function d(){var a=this;if(c.PROMO_DEBOUNCE_UPDATE){var b=this.update;var d=false;var e=false;this.update=function(c){e=e||c;if(!d){d=true;(0,f.nextFrame)(function(){b.call(a,e);d=false})}}}}d.prototype.load=function(){if(!k){k=Promise.all([(0,g.default)("2promo"),new Promise(function(a,b){require(["mediator/layout-manager"],a,b)}).then(__importStar)]).then(function(a){var c=a[0],d=a[1];return[new c({radar:h.default,selector:i.selector,getElementByPromoId:j,getThemeId:n,omicron:b.default.get("omicron"),getAvatarPath:e.default}),d]}).catch(function(b){(0,a.coreLoggerDispatchError)(b,{location:"promo-load"});return[]})}return k};d.prototype.update=function(a){if(a===void 0){a=!c.PROMO_MANUAL_LOAD}var b=k||a&&this.load();if(!b){return}var d=new Promise(function(a,b){require(["service/feedback"],a,b)}).then(__importStar).then(function(a){return a.default}).then(function(a){return a.instanceDeferred.promise}).then(function(a){return a.isVisible()}).catch(function(){return false});Promise.all([b,d]).then((0,f.uniqCallback)(this,function(a){var b=a[0],c=b[0],d=b[1],e=a[1];if(!c||(d===null||d===void 0?void 0:d.default.isLessThen("xs"))||e){return}c.update()}));this.updateRenovator()};d.prototype.applyTheme=function(a){if(a&&a.isDarkMode){var b=a.isDarkMode()?"octaviusBlack":"octavius";if(m!==b){m=b;this.update()}}};d.prototype.updateRenovator=function(){if(!c.RENOVATOR_DISABLED){this.loadRenovator().then(function(a){a===null||a===void 0?void 0:a.update()})}};d.prototype.hideRenovator=function(){if(!c.RENOVATOR_DISABLED){this.loadRenovator().then(function(a){a===null||a===void 0?void 0:a.hide()})}};d.prototype.loadRenovator=function(){if(!l){l=(0,g.default)("renovator").then(function(a){return new a({getThemeId:n,getContainer:o})}).catch(function(b){(0,a.coreLoggerDispatchSelfError)("renovator-load",b)})}return l};d.prototype.isNotifyVisible=function(){return this.load().then(function(a){var b=a[0];return b.isNotifyVisible()})};return d}();exports.default=new p});define("service/layer",["exports","default-values","service/layer-load","service/promo"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=e(c);function e(a){return a&&a.__esModule?a:{default:a}}var f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function h(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var i=function a(b,c,d,e){h(this,a);this.view=b;this.data=c;this.Block=d;this.container=e};var j=function(){function a(c){h(this,a);this.UILayerWindow=c;this.loaded={};this.load=b.loadLayer.bind(this)}g(a,[{key:"create",value:function a(b,c,d){var e=document.createElement("DIV");var f=new this.UILayerWindow;f.renderTo(e);f.set(d);return new i(f,c,b,e)}}]);return a}();var k=function(){function b(){h(this,b)}g(b,[{key:"setup",value:function a(b){this._stack=[];this.rootEl=document.createElement("DIV");this.layerFactory=new j(b);document.body.appendChild(this.rootEl)}},{key:"open",value:function a(b,c){var e=this;var f=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return this.layerFactory.load(b).then(function(a){var b=e.layerFactory.create(a,c,f);b.view.on("window:close",function(){e._pop();d.default.update()});e._push(b);d.default.update();return b.view.setLayer(a,c)})}},{key:"openIframeLayer",value:function b(c){var d=c.paramsKey,e=c.additionalParams,g=e===undefined?{}:e,h=c.factoryParams,i=h===undefined?{}:h,j=c.onPostMessage;var k=d&&a.LAYER_IFRAME_PARAMS[d]||{};return this.open("iframe",f({},k,g,{router:app}),f({dimmer:true},i)).then(function(a){if(typeof j==="function"){a.on("layer-iframe:post-message",j)}return a})}},{key:"getInstance",value:function a(){var b=this._getCurrentLayer();if(!b){return null}return b.view}},{key:"_push",value:function a(b){this._hideLayer(this._getCurrentLayer());this._stack.push(b);this._showLayer(b)}},{key:"_pop",value:function a(){this._hideLayer(this._getCurrentLayer());this._stack.pop();this._showLayer(this._getCurrentLayer())}},{key:"_getCurrentLayer",value:function a(){if(!this._stack){return}return this._stack[this._stack.length-1]}},{key:"_hideLayer",value:function a(b){if(!b){return}this.rootEl.removeChild(b.container);b.view.set("active",false)}},{key:"_showLayer",value:function a(b){if(!b){return}this.rootEl.appendChild(b.container);b.view.set("active",true)}}]);return b}();exports.default=new k});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/notify",["require","exports","default-values","service/radars/index"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);var c=i18n("Что-то пошло не так");var d={type:"",text:"",qa:"notify-item",actions:[],duration:a.NOTIFY_CLOSE_DELAY,inline:true,className:"",unique:false};var e={};exports.default={isReady:function(a){if(a===void 0){a="default"}return!!e[a]},setup:function(a,b){if(b===void 0){b="default"}e[b]=a},add:function(a,f){if(f===void 0){f="default"}var g=e[f];var h=__assign(__assign({},d),a);if(!g){console.warn("Нет очереди ошибок для отображения в нотификациях");return}if(h.type===this.types.error){(0,b.default)("notify_error");if(h.text.includes(c)){(0,b.default)("notify_error_unknown")}}return g.add(h)},error:function(a,b){if(b===void 0){b="default"}this.add(__assign({type:this.types.error,text:c+"!"},a),b)},setData:function(a,b,c){if(c===void 0){c="default"}var d=e[c];d.setData(a.idx,b)},getContainer:function(a){var b;if(a===void 0){a="default"}return(b=e[a])===null||b===void 0?void 0:b.el},types:{error:"error",success:"success",default:""},MAX_LENGTH:44,MAX_LENGTH_SMALL:32}});define("feast-mod/avatar",["exports","cfg"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.avatarUrl=d;var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}function d(a,c,d){return b.default.get("urls.avatarUrl")+"/pic"+("?width="+d)+("&height="+d)+("&email="+encodeURIComponent(a))+("&name="+encodeURIComponent(c))}});define("feast-tpl!app/feast-tpl!ui-block/contextmenu-correspondent/contextmenu-correspondent.html",["feast"],function(a){return a.smartParse('<div qa:id="contextmenu-correspondent">\n\t<fn:var name="contact" value="{attrs.model}"/>\n\t<fn:var name="username" value="{_this.getUserName(contact)}" />\n\t<fn:var name="mobile" value="{attrs.extraDetails.mobile}"/>\n\n\t<b:list>\n\t\t<b:list-item\n\t\t\tbem:mod="pure"\n\t\t\tremit:click.prevent.stop="dummy:click"\n\t\t>\n\t\t\t<div bem:elem="avatar">\n\t\t\t\t<b:notification-badge\n\t\t\t\t\t\tshow="{attrs.isOnline}"\n\t\t\t\t\t\tcolorMode="success"\n\t\t\t\t\t\tsize="l"\n\t\t\t\t\t\tbottom="-8"\n\t\t\t\t\t\tright="8"\n\t\t\t\t\t\ttest-id="{attrs.isOnline && \'online-badge\'}"\n\t\t\t\t>\n\t\t\t\t\t<fn:match name="content" bem:block="widget">\n\t\t\t\t\t\t<b:avatar\n\t\t\t\t\t\t\tqa:id="avatar"\n\t\t\t\t\t\t\tsize="l"\n\t\t\t\t\t\t\temail="{contact.email}"\n\t\t\t\t\t\t\tname="{contact.name}"\n\t\t\t\t\t\t\tsrc="{_this.getHighResolutionAvatar(contact)}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:match>\n\t\t\t\t</b:notification-badge>\n\t\t\t</div>\n\t\t\t<div bem:elem="userdata" title="{username}">\n\t\t\t\t<div qa:id="username" bem:elem="name">{username}</div>\n\t\t\t\t<div qa:id="email" bem:elem="email">{contact.email}</div>\n\t\t\t\t<fn:if test="_this.isLastSeenPossible()">\n\t\t\t\t\t<b:lastseen\n\t\t\t\t\t\tloading="{attrs.checkingPossession}"\n\t\t\t\t\t\ttext="{attrs.lastSeen.status}"\n\t\t\t\t\t\tclient="{attrs.lastSeen.client_type}"\n\t\t\t\t\t\tsuccess="{attrs.isOnline}"\n\t\t\t\t\t/>\n\t\t\t\t</fn:if>\n\t\t\t</div>\n\t\t</b:list-item>\n\n\t\t<div bem:elem="hr"/>\n\n\t\t<b:list-item qa:id="copy" radar-id="copy" remit:click="copy">\n\t\t\t<span bem:elem="ico" bem:mod="copy">\n\t\t\t\t<b:ico name="actions:copy" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Копировать адрес\')}</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\tqa:id="compose"\n\t\t\tremit:click="compose:to"\n\t\t\tevent:details="contact"\n\t\t\tradar-id="compose"\n\t\t>\n\t\t\t<span bem:elem="ico" bem:mod="compose">\n\t\t\t\t<b:ico name="compose" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Написать письмо\')}</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\tqa:id="call"\n\t\t\tfn:if="_this.canCallTo(contact)"\n\t\t\tremit:click="call:to"\n\t\t\tevent:details="contact"\n\t\t\tradar-id="call"\n\t\t>\n\t\t\t<span bem:elem="ico" bem:mod="call">\n\t\t\t\t<b:ico name="categories:camera" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Позвонить\')}</span>\n\t\t</b:list-item>\n\n\t\t<fn:if test="!(attrs.hideSearchButton && mobile)">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="correspondent"\n\t\t\t\tremit:click="correspondent:search"\n\t\t\t\tevent:details="{email:contact.email,model:contact.messageModel}"\n\t\t\t\tradar-id="search"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="search">\n\t\t\t\t\t<b:ico name="search" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Найти все письма\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\n\t\t<fn:if test="attrs.isShouldCheckPossession && attrs.checkingPossession">\n\t\t\t<b:list-item\n\t\t\t\tbem:mod="centering"\n\t\t\t\tqa:id="add-contact-spinner"\n\t\t\t>\n\t\t\t\t<b:spinner inline size="xs" color="additional"/>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="attrs.isShouldCheckPossession && !attrs.checkingPossession && !attrs.isInAddressbook">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="add-contact"\n\t\t\t\tremit:click="addressbook:addcontact"\n\t\t\t\tevent:details="contact"\n\t\t\t\tradar-id="add-contact"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="navigation_add_user">\n\t\t\t\t\t<b:ico name="navigation_add_user" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Добавить в контакты\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="attrs.isShouldCheckPossession && !attrs.checkingPossession && attrs.isInAddressbook && !(attrs.hideAddContactButton && mobile)">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="open-contact"\n\t\t\t\tremit:click="addressbook:opencontact"\n\t\t\t\tevent:details="contact"\n\t\t\t\tradar-id="open-contact"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="navigation_users">\n\t\t\t\t\t<b:ico name="navigation_users" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'В контактах\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/contextmenu-correspondent/contextmenu-correspondent.html")});define("feast-tpl!ui-block/contextmenu-correspondent/contextmenu-correspondent.html",["feast-tpl!app/feast-tpl!ui-block/contextmenu-correspondent/contextmenu-correspondent.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/copyToClipboard",["require","exports","service/radars/index"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isCopySupported=void 0;a=__importDefault(a);var b=function(){var a;return typeof((a=navigator===null||navigator===void 0?void 0:navigator.clipboard)===null||a===void 0?void 0:a.writeText)==="function"};exports.isCopySupported=b;exports.default=function(b){if(!(0,exports.isCopySupported)()){(0,a.default)("no-clipboard");return Promise.reject()}return navigator.clipboard.writeText(b)}});define("data-source/discounts/types",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.parseDiscount=exports.isDiscount=exports.isSaleArray=exports.parseSale=exports.isSale=exports.parseSaleDate=exports.isSaleDate=exports.isShortDateString=exports.isSaleValue=void 0;function a(a){return a&&typeof a==="object"&&typeof a["size"]==="number"&&!Number.isNaN(a["size"])&&a["size"]>0&&typeof a["currency"]==="string"&&a["currency"].length>0}exports.isSaleValue=a;function b(a){if(typeof a!=="string"){return false}var b=new Date(a);return!Number.isNaN(b.getTime())}exports.isShortDateString=b;function c(a){return a&&typeof a==="object"&&b(a["date"])&&typeof a["is_default"]==="boolean"}exports.isSaleDate=c;function d(a){return{is_default:a.is_default,date:new Date(a.date)}}exports.parseSaleDate=d;function e(b){return b&&typeof b==="object"&&typeof b["category"]==="string"&&a(b["discount"])&&c(b["start_date"])&&c(b["end_date"])}exports.isSale=e;function f(a){return{category:a.category,discount:a.discount,start_date:d(a.start_date),end_date:d(a.end_date)}}exports.parseSale=f;function g(a){return Array.isArray(a)&&a.length>0&&a.every(function(a){return e(a)})}exports.isSaleArray=g;function h(a){return a&&typeof a==="object"&&typeof a["description"]==="string"&&typeof a["from"]==="string"&&typeof a["max_discount_index"]==="number"&&(typeof a["from_jsonld"]==="boolean"||typeof a["from_jsonld"]==="undefined")&&(Array.isArray(a["promocodes"])||typeof a["promocodes"]==="undefined")&&b(a["received_date"])&&g(a["sale"])&&a["max_discount_index"]>=0&&a["max_discount_index"]<a["sale"].length}exports.isDiscount=h;function i(a){return{description:a.description,from:a.from,is_promo:a.from_jsonld,promocodes:a.promocodes,received_date:new Date(a.received_date),sale:a.sale.map(function(a){return f(a)}),max_discount_index:a.max_discount_index}}exports.parseDiscount=i});define("helpers/getCurrentTimestamp",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getCurrentTimestamp=void 0;function a(){return Math.floor(Date.now()/1e3)}exports.getCurrentTimestamp=a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/discounts/index",["require","exports","@mail/flags","@mail/xray","data-source/discounts/types","data-source/match/match","default-values","helpers/getCurrentTimestamp","mail/Folder","utils/util"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);g=__importDefault(g);function i(a,b){return a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate()}var j=(0,h.debounce)(function(a){return b.default.send("discounts_count",{v:a,dwh:{discounts_viewed:a}})},2e3,null);var k=false;var l=function(){k=false};var m=function(b){var c=a.default.get(e.DISCOUNTS_FLAG_NAME);var d=c.getCount("close")%2===0;var f=n();if(b.length&&d){c.save({close:true})}if(b.length){return b}if(!d&&f){c.save({close:true,time:true});k=true;return b}if(k){return b}return undefined};var n=function(){var b=a.default.get(e.DISCOUNTS_FLAG_NAME);var c=b.getTime();if(c===0){return true}var d=(0,f.getCurrentTimestamp)();return d>c+e.DELAY_NO_DISCOUNTS_BLOCK};exports.default={match:(0,d.default)(["#attachment","#attachment-editor"]).exclude,fetch:function(a,d){var f=a.route;var h=f&&f.is("#search #search-letter");if(h){return Promise.resolve()}return Promise.all([d("status"),d("uiThreadsSettings")]).then(function(a){var d;var f=a[0],h=a[1];var k=[];var n=new Date;if(!e.DISCOUNTS_BLOCK||!h.discounts||f.folder!==g.default.NEWSLETTERS){l();return undefined}for(var o=0;o<Math.min(f.discounts.length,e.LIST_LIMIT);o++){var p=f.discounts[o];var q=p.get("discount");if(!(0,c.isDiscount)(q)){if(q!==undefined){b.default.send("discounts_invalid")}continue}var r=(0,c.parseDiscount)(q);var s=r.sale[r.max_discount_index];if(e.DISCOUNT_DESCRIPTION_FROM_SUBJECT){r.description=p.get("subject")}if(s.end_date.date>n||i(s.end_date.date,n)){k.push(__assign(__assign({},r),{sale:s,message_id:p.id,shop:(d=p.get("correspondents.from.0.name"))!==null&&d!==void 0?d:""}))}else{b.default.send("discounts_stale")}}j(k.length);return m(k)})}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/server-error",["require","exports","@mail/xray","default-values","service/smokescreen"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);var d=function(){return new Promise(function(a,c){var d=new XMLHttpRequest;d.open("GET",b.SERVER_ERROR_URL,false);d.onreadystatechange=function(){if(d.readyState!==4){return}if(d.status===200){a(d.responseText)}else{c(d)}};d.send()})};function e(){var b=window.app;if(b.view){b.view.destroy()}b.isDead=true;var e=document.createElement("STYLE");e.innerText="".concat((0,c.selector)(".dimmer")," {display: none !important;}");document.head.appendChild(e);var f=window["app-canvas"][0]||window["app-canvas"];d().then(function(c){f.style.height="100vh";f.innerHTML=c;if(!b.isErrorPageShown){a.default.send("error-page-show");b.isErrorPageShown=true}}).catch(function(c){f.style.height="100vh";f.style["text-align"]="center";f.innerHTML=i18n("Произошла ошибка сервера №")+(c.status?c.status:"500")+".<br/>"+i18n("Наши специалисты уже разбираются с проблемой.");if(!b.isErrorPageShown){a.default.send("error-page-fallback-show");b.isErrorPageShown=true}})}exports.default=e});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/utils/logger",["require","exports","@mail/xray"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DataSourceLogger=void 0;a=__importDefault(a);var b=function(){function b(){this.isLogging=true;this.entries=[]}b.prototype.addEntry=function(a){if(!this.isLogging){return}this.entries.push({action:a})};b.prototype.stopLogging=function(){if(!this.isLogging){return}this.isLogging=false;if(!this.entries.length){return}b.sendLog(this.entries)};b.sendLog=function(b){a.default.send("datasource_log",{rlog:"octavius_datasource_log",rlog_message:b})};return b}();exports.DataSourceLogger=b});define("helpers/delete-emoji-in-string",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.hasEmoji=exports.deleteEmoji=void 0;var a=/[^-\s](\u00A9|\u00AE|[\u2000-\u3300]|\uD83C[\uD000-\uDFFF]|\uD83D[\uD000-\uDFFF]|\uD83E[\uD000-\uDFFF])[^-\s][^&]/;var b=/\s(\u00A9|\u00AE|[\u2000-\u3300]|\uD83C[\uD000-\uDFFF]|\uD83D[\uD000-\uDFFF]|\uD83E[\uD000-\uDFFF])\s/g;var c=/(\u00A9|\u00AE|[\u2000-\u3300]|\uD83C[\uD000-\uDFFF]|\uD83D[\uD000-\uDFFF]|\uD83E[\uD000-\uDFFF])/g;var d=/[^\s]/;function e(e){var f=e.match(a);while(f){var g=f[0],h=f[1];e=e.replace(g,g.replace(h," "));f=e.match(a)}e=e.replace(b," ");e=e.replace(c,"");var i=String.fromCharCode(65039);while(e.includes(i)){e=e.replace(i,"")}return d.test(e)?e:""}exports.deleteEmoji=e;function f(a){return c.test(a)}exports.hasEmoji=f});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/mailbox/loader",["require","exports","default-values","Emitter","mail/Folder","RPC"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isJSSDKCompliantObject=exports.SecureFolderNotOpenError=void 0;b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);function e(a){Error.call(this);this.name="Secure Folder Not Open Error";this.folderId=a;if(Error.captureStackTrace){Error.captureStackTrace(this,e)}else{this.stack=new Error("empty").stack}}exports.SecureFolderNotOpenError=e;e.prototype=Object.assign(Object.create(Error.prototype),{constructor:e,getFolderId:function(){return this.folderId}});function f(a){return!!(a&&typeof a==="object"&&typeof a.is==="function"&&typeof a.get==="function")}exports.isJSSDKCompliantObject=f;var g=function(b){__extends(g,b);function g(){var a=b.call(this)||this;a.rpcRequestResults={};a.foldersLastModified={};a.latestFoldersList=null;return a}g.getCacheKey=function(a){var b,c;var d=Object.keys(a.filters||{});d.sort();return""+a.folder+":"+a.offset+":"+a.limit+":"+d.join("")+":"+"".concat((b=a.sort)===null||b===void 0?void 0:b.type,"-").concat((c=a.sort)===null||c===void 0?void 0:c.order)};g.getTimestamp=function(){return Math.floor(Date.now()*.001)};g.prototype.load=function(b){var h=this;b.folder=parseInt(b.folder||0,10);b.offset=b.offset||0;b.limit=b.limit||a.LIST_LIMIT;b.filters=b.filters||{};b.sort=b.sort||{};var i=c.default.all.get(b.folder);if(i&&!i.isSecureOpen()){return Promise.reject(new e(i.get("id")))}var j=g.getCacheKey(b);var k=g.getTimestamp();var l=this.foldersLastModified[j];if(k===l){l--}var m=!i||i.isNewsletters();var n=__assign(__assign({folder:b.folder,limit:b.limit,filters:b.filters,sort:b.sort,last_modified:b.time||l||1,force_custom_thread:a.FORCE_CUSTOM_THREAD,supported_custom_metathreads:a.SUPPORTED_CUSTOM_METATHREADS},m&&{pinned_limit:a.DISCOUNTS_BLOCK?a.DISCOUNTS_BLOCK_LIMIT:0}),a.FOLDERS_SORT_VARIATION&&{folders_sort_variation:a.FOLDERS_SORT_VARIATION});if(b.offset_id){n.offset_id=b.offset_id;delete n.last_modified}else{n.offset=b.offset}return d.default.get("threads/status/smart",n).catch(function(b){var c=h.rpcRequestResults[j];var e=b.get("status");var g=b.get("body");if(e===403&&g==="twostep_required"){window.location.href=a.TWO_STEP_ENABLE_URL}if(e===403&&g==="password_expired"){window.location.href=a.CHANGE_EXPIRED_PASSWORD_URL}if(!f(b)||e!==304&&e!==500){throw b}if(h.latestFoldersList&&c){return __assign(__assign({},c),{folders:h.latestFoldersList})}if(e===500){throw b}return d.default.get("threads/status/smart",__assign(__assign({},n),{last_modified:1}))}).catch(function(a){if(f(a)&&a.is("invalid")&&a.get("body.folder.error")==="not_open"){throw new e(n.folder)}throw a}).then(function(a){if(f(a)){a={folders:a.body.folders,userGrants:a.body.user_grants,threads:a.body.threads,threadsTotal:a.body.threads_total,mboxSize:a.body.mbox_size,collectors:a.body.collectors,lastModified:a.get("lastModified"),discounts:a.body.discounts}}h.rpcRequestResults[j]=a;h.latestFoldersList=a.folders;h.foldersLastModified[j]=a.lastModified;return a})};g.prototype.invalidateCache=function(){this.rpcRequestResults={};this.foldersLastModified={}};return g}(b.default);var h=new g;exports.default=h});define("service/page-lifecycle",["exports","default-values","Emitter","page-lifecycle"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(b);var e=f(c);function f(a){return a&&a.__esModule?a:{default:a}}function g(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function i(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function j(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var k=function(b){j(c,b);function c(){g(this,c);var a=i(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));e.default.addEventListener("statechange",a.stateChange.bind(a));return a}h(c,[{key:"init",value:function a(b){this.router=b}},{key:"stateChange",value:function b(c){var d=c.oldState,e=c.newState;if(!this.router){return}var f=d==="passive"&&e==="active";var g=this.router.model.status&&this.router.model.status.lastUpdateTime;var h=g&&Date.now()-g>a.INACTIVE_TAB_RELOAD_DURATION*1e3;if(f&&h){this.emit("pagelifecycle:reload")}}}]);return c}(d.default);var l=new k;exports.default=l});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/api/Accounts",["require","exports","@mail/xray","@mail-core/logger","axios","cfgUser","default-values"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getEmailAccounts=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);var f=function(a){var b=a.first_name,c=a.last_name;return[b||"",c||""].join(" ")};var g=function(a){return Object.entries(a).map(function(a){var b=a[0],c=a[1];return{email:b,count:c.mail_cnt,fullName:f(c),children:c.children?g(c.children):[]}})};var h=function(){var f;return c.default.get(e.PORTAL_NAVI_DATA_URL,{params:{mac:1,ldata:1,Login:(f=d.default.get("initialUser"))===null||f===void 0?void 0:f.email},withCredentials:true}).then(function(c){var d,e;if(c.data.status!=="ok"||!((d=c.data.data)===null||d===void 0?void 0:d.ldata)){a.default.send("get_accounts_error",{i:"request"});(0,b.coreLoggerDispatchError)(new Error("Fetch accounts error"),b.Tag.API);return}var f=(e=c.data.data)===null||e===void 0?void 0:e.ldata;var h=g(f);return{accounts:h,email:c.data.data.email}}).catch(function(){a.default.send("get_accounts_error",{i:"network"});(0,b.coreLoggerDispatchError)(new Error("Fetch accounts network error"),b.Tag.API)})};exports.getEmailAccounts=h});define("@mail/jssdk/next/util/object",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isPlainObject=void 0;var a=function(a){if(a===null||typeof a!=="object"){return false}var b=Object.getPrototypeOf(a);return b===null||b===Object.prototype||Object.getPrototypeOf(b)===null};exports.isPlainObject=a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("@mail/jssdk/next/model/model",["require","exports","Model","@mail/jssdk/next/util/object"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.updateModel=exports.isModelFactory=exports.describeModel=exports.ModelFactory=void 0;a=__importDefault(a);var c=function(){function b(b,c,d){if(d===void 0){d={}}this.name=b;this.scheme=c;this.idKey=d.idKey||"undefined_idKey",this.internal=a.default.extend({idAttr:this.idKey,className:b,defaults:c,getters:true,factory:this});this.get=this.get.bind(this);this.map=this.map.bind(this);this.create=this.create.bind(this);this.dispose=this.dispose.bind(this)}Object.defineProperty(b.prototype,"internal_runtimeList",{get:function(){return this.internal.all},enumerable:false,configurable:true});b.prototype.get=function(a){if(!this.idKey){throw new Error("[".concat(this.name||JSON.stringify(this.scheme),"]: 'idKey' not defined"))}return this.internal.all.get(a)};b.prototype.map=function(a){return this.internal.map(a)};b.prototype.create=function(a){return this.internal.create(a||{})};b.prototype.dispose=function(a){return this.internal.all.remove(a)};b.prototype.update=function(a,b){var c=b(a);this.legacySyncSet(a,c,false)};b.prototype.legacySyncSet=function(a,b,c){var d=[];if(a!==b){a.set(b,{clean:true,sync:true,silent:c,changes:d})}return d.slice(0)};return b}();exports.ModelFactory=c;function d(a,d,e){if(e===void 0){e={}}if(Array.isArray(d)||!(0,b.isPlainObject)(d)){throw new Error('describeModel "'.concat(a,'" incorrect, schema must be object'))}return new c(a,d,e)}exports.describeModel=d;function e(a){return"map"in a}exports.isModelFactory=e;function f(a,b){a.__factory__.update(a,b)}exports.updateModel=f});define("@mail/jssdk/next/state/global",["require","exports","@mail/jssdk/next/model/model","@mail/jssdk/next/subject/subject"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createGlobalState=void 0;function c(c,d){var e=(0,b.createSubject)();var f=[];var g=(0,a.describeModel)("globalState/".concat(c),d);var h=g.create();var i=false;var j=0;return{name:c,get:function(){return h},set:function(a){var b=this;if(i){f.push(a);return}i=true;j++;var c=a(h);if(c){var d=g.legacySyncSet(h,c,true);if(d.length){e.dispatch(h)}}i=false;if(j>100){j=0;f.length=0;console.error("Infinite loop detected");return}if(f.length===0){j=0;return}var k=f.slice(0);f.length=0;k.forEach(function(a){b.set(a)})},subscribe:function(a){return e.subscribe(a)},on:function(a,b){return e.on(a,b)}}}exports.createGlobalState=c});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/store/user/account/state",["require","exports","@mail/jssdk/next/state/global","cfgUser"],function(require,exports,a,b){"use strict";var c;Object.defineProperty(exports,"__esModule",{value:true});exports.accountUserState=void 0;b=__importDefault(b);exports.accountUserState=(0,a.createGlobalState)("user/account",{accounts:[],email:(c=b.default.get("initialUser"))===null||c===void 0?void 0:c.email})});define("data-source/store/user/account/actions",["require","exports","@mail/jssdk/next/action/global","data-source/api/Accounts","./state"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.updateAccounts=void 0;exports.updateAccounts=(0,a.createGlobalAction)("user/account/updateAccount",b.getEmailAccounts);c.accountUserState.on(exports.updateAccounts.fulfilled,function(a){var b=a.payload;if(!b.accounts||!b.email){return}c.accountUserState.set(function(){return{accounts:b.accounts,email:b.email}})})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/account",["require","exports","data-source/match/match","data-source/store/user/account/actions","default-values"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);exports.default={match:(0,a.default)(["#attachment","#attachment-editor"]).exclude,fetch:function(){if(!c.DISABLE_FOOTER_APP_TOOLBAR){(0,b.updateAccounts)();return Promise.resolve()}}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/Alias",["require","exports","RPCModel"],function(require,exports,a){"use strict";a=__importDefault(a);var b=a.default.extend({className:"mail.Alias",defaults:{alias:""},findUrl:"aliases",addUrl:"aliases/add",removeUrl:"aliases/remove",saveUrl:"aliases/edit",alwaysSendAllAttributes:true,canSendLetters:function(){return true},getEmail:function(){return this.get("alias")},getOwnerFullName:function(){return null},isShared:function(){return false},isAnonymous:function(){return!this.meta("isPDD")&&!this.is("permanent")},isPermanent:function(){return this.is("permanent")}});b.version="0.2.0";exports.default=b;return b});define("data-source/source/aliases",["exports","data-source/match/match","mail/Alias","service/radars/index","@mail-core/dashboard"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=h(a);var f=h(b);var g=h(c);function h(a){return a&&a.__esModule?a:{default:a}}var i=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();exports.default={match:(0,e.default)(["#attachment","#attachment-editor"]).exclude,fetch:function a(b,c,e,h){if(h&&h.aliases){return h.aliases}return d.userKeeper.group("app-fetch-alias",function(){return Promise.all([c("authUser"),f.default.find()]).then(function(a){var b=i(a,2),c=b[0],d=b[1];var e=d.toArray();e.forEach(function(a){a.meta("isPDD",c.isPDD())});return e}).catch(function(){(0,g.default)(["aliases","load","failed"]);return[]})},{score:"fetch"})}}});define("helpers/decode-uri-component",["exports","logger","service/radars/index"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(a){try{return decodeURIComponent(a)}catch(b){c.default.add("decodeURIComponent.error",{error:b,url:a});(0,d.default)(["decode-uri-component","error"]);return null}};var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}});define("data-source/source/attachment",["exports","helpers/decode-uri-component"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}exports.default={match:["#attachment"],defaults:null,fetch:function a(c,d){return d("message").then(function(a){var d=(0,b.default)(c.params.id);var e=a.get("attaches.list");return e.getSafe(d)})}}});define("data-source/source/attachment-temporary",["exports","helpers/decode-uri-component","mail/Attachment"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default={match:["#attachment-temporary"],fetch:function a(b){var e=b.params.message;var f=(0,c.default)(b.params.id);return d.default.findTemporary({message_id:e}).then(function(a){return{list:a,attachment:a.get(f)}})}}});define("data-source/source/authUser",["exports","service/auth"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}exports.default={fetch:function a(){return b.default.user}}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/bills-counter",["require","exports","service/storage"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.STORAGE_KEY=void 0;a=__importDefault(a);exports.STORAGE_KEY="bills-counter";var b={handleLoad:function(a,b,c){if(c){return __assign(__assign({},a),{hasNewPayments:!!a.total,hasPaidPaymentsWithNoNew:false})}var d=a.unpaidFines>b.unpaidFines;var e=a.unpaidBills>b.unpaidBills;var f=d||e;var g=a.unpaidFines<b.unpaidFines;var h=a.unpaidBills<b.unpaidBills;var i=!f&&(h||g);return __assign(__assign({},a),{hasNewPayments:f,hasPaidPaymentsWithNoNew:i})},set:function(b){a.default.set(exports.STORAGE_KEY,b)},get:function(){return a.default.get(exports.STORAGE_KEY)}};exports.default=b});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/bills-count",["require","exports","@mail/flags","data-source/actions","data-source/match/match","default-values","mail/User","service/bills-counter","service/radars/index"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.default={match:(0,c.default)(["#attachment","#attachment-editor"]).exclude,fetch:function(c,h,i,j){var k;if(!d.SIDEBAR_PAY_NOTIFICATION_BADGE_SMART){return Promise.resolve({})}var l=(k=j===null||j===void 0?void 0:j.billsCount)!==null&&k!==void 0?k:f.default.get();var m=i.type,n=i.state;if(m===b.HIDE_SIDEBAR_FOOTER_PAY_NOTIFY_BADGE){f.default.set(n);return Promise.resolve(n)}var o=!(l===null||l===void 0?void 0:l.timestamp);var p=Math.floor(Date.now()/1e3);var q=o||p-l.timestamp>d.BILLS_COUNTER_UPDATE_INTERVAL;if(!q){return Promise.resolve(l)}return e.default.findBillsCount().then(function(b){var c;var d=f.default.handleLoad(b,l,o);var e=d.hasNewPayments,g=d.hasPaidPaymentsWithNoNew;var h=e?false:!!g;if(e||g){(c=a.default.get("octavius-sidebar-pay-notification-badge-smart"))===null||c===void 0?void 0:c.save({state:h})}var i=__assign(__assign({},d),{timestamp:p});f.default.set(i);return i}).catch(function(){(0,g.default)("user-paymentdata-err");return{}})}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/Collector",["require","exports","Model","utils/util"],function(require,exports,a,b){"use strict";a=__importDefault(a);b=__importDefault(b);var c=/^(extra_auth|pause|auth_error)$/;var d=a.default.extend({className:"mail.Collector",defaults:{email:"",state:"",type:"",owner:null},canSendLetters:function(){return!c.test(this.get("state"))},getEmail:function(){return this.get("email")},getOwnerFullName:function(){var a=this.get("owner");if(!a){return null}return b.default.calculateFullName({first:a.first_name,last:a.last_name})},isShared:function(){return this.get("type")==="shared"},isAnonymous:function(){return false},isPermanent:function(){return false}});d.version="0.2.0";exports.default=d;return d});define("data-source/source/collectors",["exports","data-source/match/match","mail/Collector"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default={match:(0,c.default)(["#attachment","#attachment-editor"]).exclude,fetch:function a(b,c){return c("status").then(function(a){return(a.collectors||[]).map(function(a){return new d.default(a)})})}}});define("data-source/source/folder",["exports","data-source/match/match","mail/Folder"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default={match:(0,c.default)(["#attachment","#attachment-editor"]).exclude,fetch:function a(b,c){return c("folders").then(function(a){if(a){return d.default.all.get(b.params.folder)}return d.default.findOne({id:b.params.folder})})}}});define("data-source/source/folders",["exports","data-source/match/match","mail/Folder"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default={match:(0,c.default)(["#attachment","#attachment-editor"]).exclude,fetch:function a(b,c){return c("status").then(function(a){return a.folders||d.default.find()})}}});define("data-source/source/hidden-payment-dies",["exports","data-source/match/match","../../service/storage","../actions"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(a);var e=f(b);function f(a){return a&&a.__esModule?a:{default:a}}function g(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:true,configurable:true,writable:true})}else{a[b]=c}return a}var h=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var i="hidden-payment-dies";exports.default={match:(0,d.default)(["#letters","#read-letter"]),fetch:function a(b,d,f,j){var k=j&&j.hiddenPaymentDies||e.default.get(i)||{};if(f.type===c.HIDE_PAYMENT_DIE){var l=h({},k,g({},f.uidl,""));e.default.set(i,l);return l}return k}}});define("data-source/source/jssdk-action",["exports","data-source/actions","data-source/match/match"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=d(b);function d(a){return a&&a.__esModule?a:{default:a}}exports.default={match:(0,c.default)(["#attachment","#attachment-editor"]).exclude,fetch:function b(c,d,e){if(!e||e.type!==a.EXECUTE_JSSDK_ACTION){return Promise.resolve()}var f=e.action;return f.execute(e.params)}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/SharedMailbox",["require","exports","utils/util","RPCModel"],function(require,exports,a,b){"use strict";a=__importDefault(a);b=__importDefault(b);var c=b.default.extend({className:"mail.SharedMailbox",findUrl:"user/shared-mailboxes",defaults:{owner:{},permissions:{},system_folders:{}},checkGrant:function(a){return Boolean(this.get("permissions")[a])},getRootFolder:function(){var a=this.get("system_folders").root;return a?String(a):null},getOwnerEmail:function(){return this.get("owner").email}});c.List.fn.getMailboxesByGrant=function(a){var b=[];var c=this.length;while(c--){if(this[c].checkGrant(a)){b.push(this[c])}}return b};c.List.fn.getMailboxByEmail=function(a){var b=this.length;while(b--){if(this[b].get("owner").email===a){return this[b]}}return null};a.default.extend(c,{GRANTS:{create_toplvl_flds:"create_toplvl_flds",write:"write"}});c.version="1.0.0";exports.default=c;return c});define("models/metathread/metathread",["exports","default-values","mail/Thread","Model"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(b);var e=f(c);function f(a){return a&&a.__esModule?a:{default:a}}var g=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};var h=d.default.extend({className:"models.Metathread",constructor:function b(){d.default.prototype.constructor.apply(this,arguments);this.set({_metathreadExpanded:false,_metathreadLimit:a.METATHREAD_LIMIT,_metathreadIsLimitReached:true})},isExpanded:function a(){return this.get("_metathreadExpanded")},setExpanded:function a(b){var c=b!==this.get("_metathreadExpanded");if(c&&b&&this.get("metathread_data.new_cnt")){this.set("metathread_data.new_cnt",0)}this.set("_metathreadExpanded",b)},getMetathreadFolder:function a(){return this.get("metathread_data.folder")},getMetathreadFolderName:function a(){return this.get("metathread_data.folder_name")},setLimit:function b(){var c=arguments.length>0&&arguments[0]!==undefined?arguments[0]:a.METATHREAD_LIMIT;this.set("_metathreadLimit",c)},getLimit:function a(){return this.get("_metathreadLimit")},isLimitReached:function a(){return this.is("_metathreadIsLimitReached")},setLimitReached:function a(b){this.set("_metathreadIsLimitReached",b)},getFooterModel:function a(){if(this._footer){return this._footer}this._footer=new e.default;this._footer.set({metathreadFooter:true,metathread:this,id:"footerId"+this.id});return this._footer},isToMyself:function a(){return this.get("metathread_data.category")==="tomyself"}});h.isMetathread=function a(b){if(!b||(typeof b==="undefined"?"undefined":g(b))!=="object"){return}if(typeof b.get==="function"){var c=b;return c.is("flags.metathread")&&c.is("metathread_data.folder")}var d=b;return!!(d.flags&&d.flags.metathread&&d.metathread_data&&d.metathread_data.folder)};h.isMetathreadFooter=function a(b){return!!(b&&b.get("metathreadFooter"))};h.patchThreadId=function a(b){if(typeof b.get!=="function"){b.id="multithreadFixId"+b.metathread_data.folder}};exports.default=h});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("route/utils/filter-query",["require","exports","cfgUser","default-values"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ESortingTypes=void 0;a=__importDefault(a);var c="filter_";var d="all";var e="sort";var f="D";var g;(function(a){a["DateAsc"]="d";a["DateDesc"]="D";a["SubjectAsc"]="s";a["SubjectDesc"]="S";a["FromAsc"]="f";a["FromDesc"]="F"})(g=exports.ESortingTypes||(exports.ESortingTypes={}));var h={D:{type:"date",order:"desc"},F:{type:"from",order:"desc"},S:{type:"subject",order:"desc"},d:{type:"date",order:"asc"},f:{type:"from",order:"asc"},s:{type:"subject",order:"asc"}};var i={all:true,unread:false,flagged:false,with_attachments:false};var j=a.default.get("initialUser.messages.sort")||h[f];var k=Object.keys(h).find(function(a){return h[a].type===j.type&&h[a].order===j.order})||f;var l=b.ENABLE_SORTING?k:undefined;exports.default={getQuery:function(a){var b={};Object.entries(i).forEach(function(a){var e=a[0],f=a[1];if(e!==d&&f){b["".concat(c).concat(e)]=1}});if(a){b[e]=l}return b},getFilterConfig:function(){return i},getSortingType:function(){return l},toggleFilter:function(a){if(i.hasOwnProperty(a)){i[a]=!i[a]}},applyFilter:function(a){if(!b.ENABLE_MULTIPLE_FILTERS){Object.keys(i).forEach(function(a){i[a]=false});this.toggleFilter(a)}else{this.toggleFilter(a);var c=Object.entries(i).filter(function(a){var b=a[0],c=a[1];return b!==d&&c});if(c.length){i.all=false}else{i.all=true}}},applySorting:function(a){l=a||f},resetFilters:function(){Object.keys(i).forEach(function(a){i[a]=false});i.all=true},resetSorting:function(){this.applySorting(f)},set:function(a){var f=Object.keys(a).filter(function(a){return a.startsWith(c)});if(f.length){if(b.ENABLE_MULTIPLE_FILTERS){var g=false;f.forEach(function(a){var b=a.replace(c,"");if(i.hasOwnProperty(b)&&b!==d){i[b]=true;g=true}});if(g){i.all=false}}else{var j=f[0].replace(c,"");if(i.hasOwnProperty(j)&&j!==d){this.applyFilter(j)}}}else{this.resetFilters()}if(b.ENABLE_SORTING&&a[e]&&h[a[e]]){this.applySorting(a[e])}},has:function(){return!!Object.entries(i).filter(function(a){var b=a[0],c=a[1];return b!==d&&c}).length},isFilter:function(a){return i[a]},get:function(){if(i.all){return{}}var a={};Object.entries(i).forEach(function(b){var c=b[0],e=b[1];if(c!==d&&e){a[c]=e}});return a},getSorting:function(){return h[l]||{}},isLetterInFilter:function(a){return!this.has()||this.isFilter("flagged")&&a.is("flags.flagged")||this.isFilter("unread")&&a.is("flags.unread")||this.isFilter("with_attachments")}}});define("helpers/data-source-dispatch",["require","exports","data-source/actions"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.dispatchAndWait=exports.dataSourceDispatchUpdateAll=void 0;function b(){return c({type:a.UPDATE_ALL,uid:undefined})}exports.dataSourceDispatchUpdateAll=b;function c(b,c){if(b===void 0){b={type:a.UPDATE_ALL,uid:undefined}}var d=c===void 0?{}:c,e=d.waitForAppLoad,f=e===void 0?false:e;return new Promise(function(a){require(["data-source/index"],function(c){if(c.default){c=c.default}if(f){c.loadPromise().then(function(){a(c.dispatch(b))})}else{a(c.dispatch(b))}})})}exports.default=c;function d(a){return new Promise(function(b,c){require(["data-source/index"],function(d){if(d.default){d=d.default}d.dispatch(a).then(function(a){d.one("afterchange",function(){b(a)})}).catch(c)})})}exports.dispatchAndWait=d});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("feast-mod/utils",["require","exports","@mail/xray","@mail-core/logger","cfgUser"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.formatDate=exports.isValidDate=exports.isToday=exports.getLocale=exports.TRANSLATE_STRINGS_TO_MOMENT=exports.NAMED_DAYS=exports.capitalize=void 0;a=__importDefault(a);c=__importDefault(c);var d=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};exports.capitalize=d;exports.NAMED_DAYS={TODAY:i18n("сегодня"),YESTERDAY:i18n("вчера")};exports.TRANSLATE_STRINGS_TO_MOMENT={today:i18n("сегодня"),tomorrow:i18n("завтра"),yesterday:i18n("вчера")};var e=function(a){if(a===void 0){a=c.default.LANG||"ru-RU"}return a.replace(/_/g,"-")};exports.getLocale=e;try{(new Date).toLocaleString((0,exports.getLocale)(),{day:"numeric",month:"short"})}catch(b){a.default.send("date-tolocalestring-err");Date.prototype.toLocaleString=function(a,b){var c=!!(b&&b.day);var d=!!(b&&b.hour);var e=c===d;return(e||c?[this.getDate().toString().padStart(2,"0"),(this.getMonth()+1).toString().padStart(2,"0"),this.getFullYear().toString().slice(2)].join("."):"")+(e?", ":"")+(e||d?this.getHours()+":"+this.getMinutes().toString().padStart(2,"0"):"")}}function f(a){var b=new Date;return b.getFullYear()===a.getFullYear()&&b.getMonth()===a.getMonth()&&b.getDate()===a.getDate()}exports.isToday=f;var g=function(a,b,c){var d;var e=a.findIndex(function(a){var c=a.type;return b===c});var f=a.findIndex(function(a){var b=a.type;return c===b});if(e>f){d=[f,e],e=d[0],f=d[1]}if(e===-1||e===f){return undefined}return a[e+1].type==="literal"&&a.slice(e+2,f).every(function(b){var c=b.type,d=b.value;return c!=="literal"||d===a[e+1].value})?a[e+1].value:undefined};var h=false;function i(a){return[{type:"weekday",value:"#"+(a.getDay()+1)},{type:"literal",value:", "},{type:"day",value:a.getDate().toString().padStart(2,"0")},{type:"literal",value:"."},{type:"month",value:(a.getMonth()+1).toString().padStart(2,"0")},{type:"literal",value:"."},{type:"year",value:a.getFullYear().toString().slice(-2)},{type:"literal",value:", "},{type:"hour",value:a.getHours().toString().padStart(2,"0")},{type:"literal",value:":"},{type:"minute",value:a.getMinutes().toString().padStart(2,"0")},{type:"literal",value:":"},{type:"second",value:a.getSeconds().toString().padStart(2,"0")}]}function j(){var a=[];for(var b=0;b<arguments.length;b++){a[b]=arguments[b]}return h?{formatToParts:i}:Intl.DateTimeFormat.apply(Intl,a)}function k(b,c){var d;if(c===void 0){c=true}a.default.send("intl-datetimeformat-err-".concat(b),{i:(d={},d["fb-".concat(h)]=1,d),skipdwh:true});if(c){h=true}}var l=function(a,b){try{return a()}catch(a){return b(a)}};var m=function(){return{locale:l(exports.getLocale,function(){return false}),timeZone:l(function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},function(){return false})}};try{j((0,exports.getLocale)(),{day:"numeric",month:"numeric",year:"numeric",hour12:false}).formatToParts(new Date)}catch(a){k("c1")}try{j((0,exports.getLocale)(),{day:"numeric",month:"long",year:"numeric",hour12:false}).formatToParts(new Date)}catch(a){k("c2")}var n=m();var o=function(a){return a instanceof Date&&isFinite(+a)};exports.isValidDate=o;var p=false;var q=function(b,c){return a.default.send(b,{rlog:b,rlog_message:c})};var r=function(a,c,d){if(d===void 0){d={}}var e=a instanceof Date?a:new Date(a);if(!(0,exports.isValidDate)(e)){(0,b.coreLoggerDispatchKnownError)("formatdate-invalid",new RangeError("formatdate-invalid"),e);return""}c=c.filter(function(a){var b=a[1];return b!==undefined});var f=l(function(){var a;return j((a=d.locale)!==null&&a!==void 0?a:(0,exports.getLocale)(),__assign(__assign(__assign({},Object.fromEntries(c)),{hour12:false}),d.intlOptions)).formatToParts(e)},function(b){var c={e:b,isFallbackDateTimeFormat:h,originDate:a,cLogs:n,nowLogs:m()};var d=b instanceof RangeError&&b.message==="Unsupported time zone specified undefined";if(!d||!p){q("formatdate-err",c)}if(d){q("formatdate-uns-timezone",c)}p||(p=d);return i(e)});var k=Object.fromEntries(f.filter(function(a){var b=a.type;return b!=="literal"}).map(function(a){var b=a.type,c=a.value;return[b,c]}));return c.flatMap(function(a,b){var e,h,i,j;var l=a[0],m=a[1];var n=(h=(e=d.literalAfter)===null||e===void 0?void 0:e[l])!==null&&h!==void 0?h:b+1<c.length?(j=(i=d.literalBefore)===null||i===void 0?void 0:i[c[b+1][0]])!==null&&j!==void 0?j:g(f,l,c[b+1][0]):undefined;return[l==="hour"&&k[l]==="24"?m==="2-digit"?"00":"0":k[l],n&&(!d.maxLengthLiteral||d.maxLengthLiteral>=n.length)?n:" "]}).join("").trim()};exports.formatDate=r});define("helpers/date-range",["exports","../feast-mod/utils"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DateRangeValue=exports.DateRangeKeysMap=exports.QueryKeysMap=exports.DateRangeRole=undefined;exports.dateToSeconds=k;exports.secondsToDate=l;var b=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var c=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};function d(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var f;function g(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:true,configurable:true,writable:true})}else{a[b]=c}return a}var h=86400*1e3;var i=1e3;var j=10*1e3;function k(a){return Math.round(a.getTime()/i)}function l(a){return a*i}var m=exports.DateRangeRole={FROM:"from",TO:"to"};var n=exports.QueryKeysMap={QUERY:"q_query",SUBJECT:"q_subj",FOLDER:"q_folder",CATEGORY:"q_tcategory",COLOR_TAG:"q_colortag",CC_FROM:"q_from",CC_TO:"q_to",FLAG_UNREAD:"q_read",FLAG_FLAGGED:"q_flag",FLAG_ATTACH:"q_attach",INTERVAL_DATE:"q_date",INTERVAL_DATE_LAPSE:"q_date_lapse"};var o=exports.DateRangeKeysMap=(f={},g(f,m.FROM,{year:"dyb",month:"dmb",day:"ddb"}),g(f,m.TO,{year:"dye",month:"dme",day:"dde"}),f);function p(a,b){var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:j;return Math.abs(a-b)<c}var q=exports.DateRangeValue=function(){function a(b,c){d(this,a);this.date=b;this.role=c;if(typeof b==="number"){this.date=new Date(b)}}e(a,[{key:"toQuery",value:function a(){var b;var c=this.date,d=this.role;return b={},g(b,o[d].year,c.getFullYear()),g(b,o[d].month,c.getMonth()+1),g(b,o[d].day,c.getDate()),b}},{key:"normalize",value:function a(){switch(this.role){case m.FROM:{this.date.setHours(0);this.date.setMinutes(0);this.date.setSeconds(0);break}case m.TO:{this.date.setHours(23);this.date.setMinutes(59);this.date.setSeconds(59)}}return this}},{key:"equals",value:function a(b){return this.role===b.role&&this.date.getTime()===b.date.getTime()}},{key:"equalsEpsilon",value:function a(b){return this.role===b.role&&p(this.date.getTime(),b.date.getTime())}}],[{key:"fromQuery",value:function b(c,d){var e=o[d],f=e.year,g=e.month,h=e.day;if(c[f]==null||c[g]==null||c[h]==null){return null}var i=new Date;i.setFullYear(parseInt(c[f],10),parseInt(c[g],10)-1,parseInt(c[h],10));return new a(i,d)}}]);return a}();var r=function(){function f(a,b){d(this,f);this.from=a;this.to=b}e(f,[{key:"normalize",value:function a(){this.from.normalize();this.to.normalize();return this}},{key:"toDateAndLapse",value:function a(){var b=this.from.date.getTime();var c=this.to.date.getTime();var d=Math.round(.5*(b+c));var e=d-b;var f=new Date(d);var g=Math.floor(e/h)||0;return{date:f,lapse:g}}},{key:"toDateAndDateEnd",value:function a(){var b=this.from.date.getTime();var c=this.to.date.getTime();var d=0;var e=new Date(b);var f=new Date(c);if(p(b,c,h)){f=null}return{date:e,dateEnd:f,lapse:d}}},{key:"toQuery",value:function b(){var d;var e=this.toDateAndLapse(),f=e.date,h=e.lapse;return c({},this.from.toQuery(),this.to.toQuery(),(d={},g(d,n.INTERVAL_DATE,(0,a.formatDate)(f,[["day","2-digit"],["month","2-digit"],["year","numeric"]],{literalAfter:{day:".",month:"."}})),g(d,n.INTERVAL_DATE_LAPSE,h),d))}},{key:"toRPCInterval",value:function a(){return{from:k(this.from.date),to:k(this.to.date)}}},{key:"equals",value:function a(b){return this.from.equals(b.from)&&this.to.equals(b.to)}},{key:"equalsEpsilon",value:function a(b){return this.from.equalsEpsilon(b.from)&&this.to.equalsEpsilon(b.to)}}],[{key:"fromDateAndLapse",value:function a(c){var d=c.date,e=c.dateEnd,g=c.lapse;if(typeof d==="string"){var i=d.split("."),j=b(i,3),k=j[0],l=j[1],n=j[2];d=new Date(parseInt(n,10),parseInt(l,10)-1,parseInt(k,10),12,0,0,0)}var o=d.getTime();var p=g*h;var r=o-p;var s=o+p;if(e){var t=e.getTime();r=o;s=t}return new f(new q(r,m.FROM).normalize(),new q(s,m.TO).normalize())}},{key:"fromQuery",value:function a(b){var c=b[n.INTERVAL_DATE];var d=parseInt(b[n.INTERVAL_DATE_LAPSE],10)||0;if(c){return f.fromDateAndLapse({date:c,lapse:d})}var e=new f(q.fromQuery(b,m.FROM),q.fromQuery(b,m.TO));if(e.from!==null&&e.to!==null){return e.normalize()}return null}},{key:"fromRPCInterval",value:function a(b){return new f(new q(l(b.from),m.FROM),new q(l(b.to),m.TO))}}]);return f}();exports.default=r});define("state-tree/search-operand/utils",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SearchOperandType=void 0;exports.SearchOperandType={FILTER:"filter",CATEGORY:"category",QUERY:"query",FOLDER:"folder",DATE:"date",MESSAGE:"message",MAILBOX:"mailbox",ADDRESSEE:"addressee"}});var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("state-tree/search/utils",["require","exports","@mail/operands","@octo/smart-input","helpers/date-range","mail/Folder","state-tree/search-operand/utils"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.findOperandIndex=exports.findOperand=exports.reconcileOperandsList=exports.isInMailbox=exports.searchQueriesEqual=exports.deriveFlagsFromOperand=exports.deriveSearchQueryFromOperand=void 0;c=__importDefault(c);d=__importDefault(d);function f(b,c){switch(c.subtype){case a.OperandQueryTypes.FROM:{b.correspondents=b.correspondents||{};b.correspondents.from=c.value;break}case a.OperandQueryTypes.TO:{b.correspondents=b.correspondents||{};b.correspondents.to=c.value;break}case a.OperandQueryTypes.SUBJECT:{b.subject=c.value;break}case a.OperandQueryTypes.QUERY:{b.query=c.value;break}}}exports.deriveSearchQueryFromOperand=f;function g(b,c){switch(c.subtype){case a.OperandFilterTypes.UNREAD:{b.flags=b.flags||{};b.flags.unread=true;break}case a.OperandFilterTypes.FLAGGED:{b.flags=b.flags||{};b.flags.flagged=true;break}case a.OperandFilterTypes.ATTACH:{b.flags=b.flags||{};b.flags.attach=true;break}}}exports.deriveFlagsFromOperand=g;function h(a,b){return Object.keys(a).every(function(d){if(a[d]===b[d]){return true}if(d==="flags"&&b.flags){var e=a.flags;var f=b.flags;return e.unread===f.unread&&e.flagged===f.flagged&&e.attach===f.attach}if(d==="correspondents"&&b.correspondents){var g=a.correspondents;var h=b.correspondents;return g.from===h.from&&g.to===h.to}if(d==="interval"&&b.interval){var i=c.default.fromRPCInterval(a.interval).normalize();var j=c.default.fromRPCInterval(b.interval).normalize();return i.equals(j)}return false})}function i(a,b){return h(a,b)&&h(b,a)}exports.searchQueriesEqual=i;function j(b,f,g,h){switch(g.type){case e.SearchOperandType.FILTER:{var i=b.flags&&(g.subtype===a.OperandFilterTypes.UNREAD&&b.flags.unread||g.subtype===a.OperandFilterTypes.FLAGGED&&b.flags.flagged||g.subtype===a.OperandFilterTypes.ATTACH&&b.flags.attach);if(!i){h.push(g)}return"flags.".concat(g.subtype)}case e.SearchOperandType.CATEGORY:{if(!b.transaction_category){h.push(g)}return"transaction_category"}case e.SearchOperandType.QUERY:{var i=g.subtype===a.OperandQueryTypes.SUBJECT&&b.subject!==void 0||g.subtype===a.OperandQueryTypes.QUERY&&b.query!==void 0||b.correspondents&&(g.subtype===a.OperandQueryTypes.FROM&&b.correspondents.from!==void 0||g.subtype===a.OperandQueryTypes.TO&&b.correspondents.to!==void 0);var j=g.subtype===a.OperandQueryTypes.FROM||g.subtype===a.OperandQueryTypes.TO;if(!i){return h.push(g)}if(j){g.setValue(b.correspondents[g.subtype])}else{g.setValue(b[g.subtype])}if(j){return"correspondents.".concat(g.subtype)}return g.subtype}case e.SearchOperandType.FOLDER:{var k=d.default.all.get(b.folder);if(!k){h.push(g);return e.SearchOperandType.FOLDER}if(k.isServiceShared()){h.push(g);return e.SearchOperandType.FOLDER}if(g.value!==b.folder){g.setValue(b.folder)}return e.SearchOperandType.FOLDER}case e.SearchOperandType.DATE:{var i=b.interval!==void 0;if(!i){h.push(g)}else{var l=c.default.fromDateAndLapse(g.value).normalize();var m=c.default.fromRPCInterval(b.interval).normalize();if(!l.equals(m)){g.setValue(m.toDateAndLapse())}}return"interval"}case e.SearchOperandType.MAILBOX:{var k=d.default.all.get(b.folder);if(!k){h.push(g)}if(k.isServiceShared()&&g.value.id.toString()!==k.get("id").toString()){g.setValue({id:k.get("id"),name:k.get("owner").name,email:k.get("owner").email})}return e.SearchOperandType.FOLDER}}}function k(a,b){if(!a||!b||!b.isServiceShared()){return false}if(!a.get("owner")||!b.get("owner")){return false}return a.get("owner").email===b.get("owner").email}exports.isInMailbox=k;function l(a,c){var d=c.type,e=c.subtype,f=c.value;a[b.SmartInputActions.PUSH]({current:{type:d,subtype:e,value:f}})}function m(a,f){var g={};var h=[];__spreadArray([],a.operands,true).forEach(function(b){var c=j(f,a,b,h);g[c]=true});h.forEach(function(c){var d=a.operands.findIndex(function(a){return a===c});if(d>=0){a[b.SmartInputActions.SPLICE](d,1)}});function i(b,f){if(g[b]||f===void 0){return}g[b]=true;switch(b){case"folder":{var h=d.default.all.get(f);if(h.isShareTake()){var i=d.default.all.find(function(a){return k(h,a)});l(a,{type:e.SearchOperandType.MAILBOX,value:{id:i.get("id"),name:h.get("owner").name,email:h.get("owner").email}})}if(!h.isServiceShared()){l(a,{type:e.SearchOperandType.FOLDER,value:f})}break}case"transaction_category":{return l(a,{type:e.SearchOperandType.CATEGORY,subtype:f})}case"interval":{return l(a,{type:e.SearchOperandType.DATE,value:c.default.fromRPCInterval(f).toDateAndLapse()})}case"subject":case"query":{return l(a,{type:e.SearchOperandType.QUERY,subtype:b,value:f})}case"flags.unread":case"flags.flagged":case"flags.attach":{return f&&l(a,{type:e.SearchOperandType.FILTER,subtype:b.split(".")[1]})}case"correspondents.from":case"correspondents.to":{return l(a,{type:e.SearchOperandType.QUERY,subtype:b.split(".")[1],value:f})}}}Object.keys(f).forEach(function(a){if(a==="flags"||a==="correspondents"){Object.keys(f[a]||{}).forEach(function(b){return i("".concat(a,".").concat(b),f[a][b])})}else{i(a,f[a])}})}exports.reconcileOperandsList=m;function n(a,b,c){return a.operands.find(function(a){return a.type===b&&a.subtype===c})}exports.findOperand=n;function o(a,b,c){return a.operands.findIndex(function(a){return a.type===b&&a.subtype===c})}exports.findOperandIndex=o});define("state-tree/search-operand/search-operand",["exports","@mail/operands","mobx-state-tree","./utils"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SearchMailboxOperand=exports.SearchDateOperand=undefined;var d=exports.SearchDateOperand=b.types.model("SearchDateOperand",{date:b.types.Date,dateEnd:b.types.maybe(b.types.union(b.types.Date,b.types.null)),lapse:b.types.optional(b.types.number,0)});var e=exports.SearchMailboxOperand=b.types.model("SearchMailboxOperand",{id:b.types.union(b.types.number,b.types.string),email:b.types.string});var f=b.types.model("SearchOperandState",{type:b.types.enumeration(Object.values(c.SearchOperandType)),subtype:b.types.maybe(b.types.union(b.types.enumeration(Object.values(a.OperandFilterTypes)),b.types.enumeration(Object.values(a.ColorTagTypes)),b.types.enumeration(Object.values(a.CategoryTypes)),b.types.enumeration(Object.values(a.OperandQueryTypes)))),value:b.types.maybe(b.types.union(b.types.string,b.types.number,d,e,b.types.undefined))}).actions(function(a){return{setType:function b(c){a.type=c},setSubtype:function b(c){a.subtype=c},setValue:function b(c){a.value=c}}});var g=b.types.model("SearchOperand",{current:f,next:b.types.maybe(f)}).views(function(a){return{get type(){return a.current.type},get subtype(){return a.current.subtype},get value(){return a.current.value},get editing(){return!!a.next}}}).actions(function(a){return{applyChanges:function c(){var d=a.next;if(!a.editing){return}a.current.type=d.type;a.current.subtype=d.subtype;a.current.value=(0,b.isStateTreeNode)(d.value)?(0,b.getSnapshot)(d.value):d.value;a.next=void 0},setType:function b(c){a.applyChanges();a.current.type=c},setSubtype:function b(c){a.applyChanges();a.current.subtype=c},setValue:function c(d){if(d===a.value){return}a.next=a.next||(0,b.getSnapshot)(a.current);a.next.value=d}}});exports.default=g});define("state-tree/search-interval/search-interval",["exports","helpers/date-range","mobx-state-tree"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=d(a);function d(a){return a&&a.__esModule?a:{default:a}}var e=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var f=b.types.model("SearchInterval",{from:b.types.number,to:b.types.maybe(b.types.number)}).preProcessSnapshot(function(b){if(!b){return b}var d=e({},b,{to:b.to||(0,a.dateToSeconds)(new Date)});return c.default.fromRPCInterval(d).normalize().toRPCInterval()});exports.default=f});define("state-tree/search-response/search-response",["exports","mail/Folder","mobx-state-tree","state-tree/search-interval/search-interval"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SearchFolder=exports.SearchDatesTypes=undefined;var d=f(a);var e=f(c);function f(a){return a&&a.__esModule?a:{default:a}}var g=exports.SearchDatesTypes={TODAY:"today",YESTERDAY:"yesterday",WEEK:"week",MONTH:"month",MONTHS:"months",YEARS:"years"};var h=b.types.model("SearchDate",{found:b.types.number,interval:e.default});var i=b.types.model("SearchDates",{today:b.types.maybe(h),yesterday:b.types.maybe(h),week:b.types.maybe(h),month:b.types.maybe(h),months:b.types.optional(b.types.array(h),[]),years:b.types.optional(b.types.array(h),[])}).views(function(a){return{get all(){var b=[];Object.values(g).forEach(function(c){var d=a[c];if(!d){return}if(c===g.MONTHS||c===g.YEARS){d.forEach(function(a){if(!a.found){return}b.push({type:c,found:a.found,from:a.interval.from,to:a.interval.to})});return}if(!d.found){return}b.push({type:c,found:d.found,from:d.interval.from,to:d.interval.to})});return b}}});var j=exports.SearchFolder=b.types.model("SearchFolder",{found:b.types.optional(b.types.number,0),id:b.types.string,name:b.types.optional(b.types.string,"")}).views(function(a){return{get folderName(){return a.name||a.folderModel.get("name")},get isShareTake(){return a.folderModel.isShareTake()},get idNumber(){return+this.id},get folderModel(){return d.default.get(this.id)}}}).actions(function(a){return{updateFromModel:function b(){var c=a.folderModel;a.name=c.get("name")}}});var k=b.types.model("SearchResponse",{count:b.types.optional(b.types.number,0),folders:b.types.optional(b.types.array(j),[]),dates:b.types.optional(i,{})});exports.default=k});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/actions/ContactSuggests",["require","exports","Action","RPC"],function(require,exports,a,b){"use strict";a=__importDefault(a);b=__importDefault(b);var c=a.default.extend({urls:{suggest:"ab/smart/suggest",default:"ab/smart"},fields:["id","emails","display_name","priority","nick","name"],operation:function(a){var c=a.search;if(typeof c==="undefined"){return Promise.reject({search:"required"})}var d={search:c};var e=this.urls.suggest;if(c===""){d={fields:this.fields,simple:true};e=this.urls.default}if(a.limit){d.limit=a.limit}return b.default.get(e,d).then(this._processResponse.bind(this,e))},_processResponse:function(a,b){var c=b.body||{};var d=c.contacts||[];if(a===this.urls.default){d=d.reduce(function(a,b){if(!b.emails){return a}b.emails.forEach(function(c){var d=Object.assign({},b);d.email=c;a.push(d)});return a},[])}var e=c.labels||[];return{contacts:d,labels:e}}});a.default.register("mail.ContactSuggests",c);c.version="1.0.0";exports.default=c;return c});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/addressbook/addressbook",["require","exports","@mail/features","RPC","service/auth"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isInAddressbook=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=function(a,b){b=b.toLowerCase();return a.some(function(a){return Array.isArray(a[1])&&!a[4]&&a[1].some(function(a){return a&&b===a.toLowerCase()})})};exports.isInAddressbook=d;var e;var f=function(){function d(){this.dataSource=null;this._promise=null;this._contacts=null}d.prototype.lazyInit=function(){var a=this;if(!e){e=new Promise(function(d){require(["suggests/data-source"],function(e){var f=a;a.dataSource=new e({getCommonContacts:function(a){var b=this;f.getCommonAddressBook(function(a){if(a){b.resolve(a)}else{b.reject()}},a,["id","emails","nick","name","display_name","priority"])},getContacts:function(){var a=this;if(!f._promise){f._promise=b.default.call("ab/fast",{need_id:true,need_labels:true}).then(function(b){var c=b.body;f._contacts=c;a.resolve({body:c})})}return f._promise},getGroups:function(){var a=this;return b.default.call("ab/labels").then(function(b){return a.resolve({body:b.body})})}},{prefix:c.default.user.getEmail()});a.dataSource.get().then(d)})})}return e};d.prototype.all=function(){return this.lazyInit().then(function(a){return a.all()})};d.prototype.getCachedAll=function(){return this._contacts};d.prototype.find=function(a,b){if(b===void 0){b={}}var c=b.limit;return this.lazyInit().then(function(b){return b.find(a)}).then(function(a){if(c){return a.slice(0,c)}return a})};d.prototype.getGroup=function(a){return this.lazyInit().then(function(b){return b.getGroup(a)})};d.prototype.getCommonAddressBook=function(c,d,e){if(a.default.has("load-common-contacts")){var f="ab/contacts/common"+(d?"/diff":"");b.default.get(f,{last_modified:d,fields:e}).then(function(a){c({body:a.body,last_modified:a.lastModified})},function(){c(null)})}else{c(false)}};return d}();exports.default=new f});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("state-tree/search-query/search-query",["require","exports","@mail/operands","mobx-state-tree","state-tree/search-interval/search-interval"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});c=__importDefault(c);var d=b.types.model("SearchCorrespondents",{from:b.types.maybe(b.types.string),to:b.types.maybe(b.types.string)});var e=b.types.model("SearchFlags",{unread:b.types.boolean,flagged:b.types.boolean,attach:b.types.boolean});var f=b.types.model("SearchQuery",{query:b.types.maybe(b.types.string),subject:b.types.maybe(b.types.string),folder:b.types.maybe(b.types.number),transaction_category:b.types.maybe(b.types.union(b.types.enumeration(Object.values(a.ColorTagTypes)),b.types.enumeration(Object.values(a.CategoryTypes)))),correspondents:b.types.maybe(d),flags:b.types.maybe(e),interval:b.types.maybe(c.default),all_attaches:b.types.maybe(b.types.boolean),in_excluded_folders:b.types.maybe(b.types.boolean)});exports.default=f});define("state-tree/suggest-operand/suggest-operand",["exports","@mail/operands","mobx-state-tree","../../default-values"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SuggestOperandsValidator=exports.SuggestOperand=undefined;var d;function e(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:true,configurable:true,writable:true})}else{a[b]=c}return a}var f=exports.SuggestOperand=b.types.model("SuggestOperand",{value:b.types.string,type:b.types.enumeration(Object.values(a.OperandSuggestAddTypes))});var g=exports.SuggestOperandsValidator=(d={},e(d,a.OperandSuggestAddTypes.FROM,function(a){var b=a.trim();if(!b||b.split(" ").length>1){return false}if(!c.SUGGEST_FROM){return false}if(c.SUGGEST_FROM.all){return true}if(c.SUGGEST_FROM.keywords&&c.SUGGEST_FROM.keywords.length){return c.SUGGEST_FROM.keywords.some(function(a){if(a&&a[0]==="R"&&a[1]==="_"){try{return new RegExp(a.slice(2)).test(b)}catch(a){return false}}return b.toLowerCase()===a.toLowerCase()})}return false}),e(d,a.OperandSuggestAddTypes.SEARCH_INTERNET,function(a){var b=a.trim();if(!c.SUGGEST_SEARCH_INTERNET){return false}return b.split(" ").length>1}),d)});define("state-tree/search-suggests/utils",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.findSuggestOperandIndex=a;function a(a,b){return a.findIndex(function(a){return a.type===b})}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("state-tree/search-suggests/search-suggests",["require","exports","@mail/operands","default-values","mail/actions/ContactSuggests","mobx-state-tree","service/addressbook/addressbook","state-tree/search-query/search-query","state-tree/suggest-operand/suggest-operand","./utils"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.searchSuggestsDefaults=exports.mapMessagesSuggest=exports.SearchQueryRequestSuggest=exports.SearchQueryMessageSuggest=exports.SearchQueryAddressbookSuggest=exports.SearchQueryWordSuggest=void 0;c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);var i="messages/search/requests";var j="messages/search/suggest";var k=1e3;var l;var m;var n;var o=0;function p(a){return typeof a==="string"&&!!a.length}exports.SearchQueryWordSuggest=d.types.model("SearchQueryWordSuggest",{word:d.types.string});exports.SearchQueryAddressbookSuggest=d.types.model("SearchQueryAddressbookSuggest",{name:d.types.string,email:d.types.string});exports.SearchQueryMessageSuggest=d.types.model("SearchQueryMessageSuggest",{email:d.types.string,name:d.types.string,subject:d.types.string,messageId:d.types.string,threadId:d.types.string,folder:d.types.string});exports.SearchQueryRequestSuggest=d.types.model("SearchQueryRequestSuggest",{query:f.default,overall_count:0,two_weeks_count:0,timestamp:d.types.optional(d.types.Date,new Date),empty:false}).actions(function(a){return{fromRPC:function(b){a.overall_count=b.overall_count;a.two_weeks_count=b.two_weeks_count;a.timestamp=new Date(b.timestamp*k);b=__assign({},b);delete b.overall_count;delete b.two_weeks_count;delete b.timestamp;if(b.correspondents){if(!p(b.correspondents.from)){delete b.correspondents.from}if(!p(b.correspondents.to)){delete b.correspondents.to}}if(Object.keys(b).length){a.query=b}else{a.empty=true}}}});function q(a){return(a.body.requests||[]).map(function(a){var b=exports.SearchQueryRequestSuggest.create({query:{}});b.fromRPC(a);return b}).filter(function(a){return!a.empty})}function r(a,d){if(b.NEW_AB_SUGGEST){return c.default.execute({search:a||"",limit:d.limit}).then(function(a){return a.result.contacts.map(function(a){a.name=a.display_name;return a})})}return e.default.find(a,d).then(function(a){return a.map(function(a){return a.data})})}function s(a){return a.map(function(a){if(a.correspondents&&a.correspondents.from&&a.correspondents.from.length!==0){a.email=a.correspondents.from[0].email;a.name=a.correspondents.from[0].name}else{a.email="";a.name=""}a.messageId=a.id;a.threadId=a.thread_id;return a})}exports.mapMessagesSuggest=s;function t(a,c,d){var e="".concat(c,"::").concat(d.query,"::").concat(d.limit);if(e===m){return Promise.resolve(l)}if(b.SEARCH_SUGGESTS_DELAY&&c.includes("messages/search/suggest")){window.clearTimeout(n);return new Promise(function(f){n=window.setTimeout(function(){return a.get(c,d).then(function(a){m=e;l=a;f(a)})},b.SEARCH_SUGGESTS_DELAY_TIME)})}return a.get(c,d).then(function(a){m=e;l=a;return a})}var u=d.types.model("SearchQuerySuggests",{requests:d.types.optional(d.types.array(exports.SearchQueryRequestSuggest),[]),words:d.types.optional(d.types.array(exports.SearchQueryWordSuggest),[]),contacts:d.types.optional(d.types.array(exports.SearchQueryAddressbookSuggest),[]),messages:d.types.optional(d.types.array(exports.SearchQueryMessageSuggest),[]),operands:d.types.optional(d.types.array(g.SuggestOperand),[])}).actions(function(a){return{fetch:(0,d.flow)(function c(e){var f,g,h,k,l,n,p,u,v,w;var x=e.query,y=e.limit,z=y===void 0?5:y,A=e.force,B=A===void 0?false:A;return __generator(this,function(c){switch(c.label){case 0:f=++o;g=(0,d.getEnv)(a);h=g.getRPC&&g.getRPC();if(!h){console.warn("No RPC in ENV");return[2]}k=x?j:i;if(B){m=null}l={query:x,limit:z};if(b.MESSAGE_SUGGESTS){l.instant_search=1}return[4,Promise.all([t(h,k,l),x?r(x,{limit:z}):Promise.resolve()])];case 1:n=c.sent(),p=n[0],u=n[1];if(f!==o){return[2]}a.requests=q(p);a.words=(p.body.suggests||[]).slice(0,z).map(function(a){return{word:a}});a.contacts=u||[];v=p.body.instant_search_response?p.body.instant_search_response.messages:[];w=s(v);a.messages=(w||[]).slice(0,z);return[2]}})})}}).actions(function(a){return{addOrUpdateSuggestOperand:function(b,c){if(c===void 0){c=void 0}var d=(0,h.findSuggestOperandIndex)(a.operands,b);if(d>=0){var e=a.operands[d];e.value=c;return}a.operands.push(g.SuggestOperand.create({type:b,value:c}))},clearSuggestOperands:function(){a.operands.clear()},removeSuggestOperand:function(b){var c=(0,h.findSuggestOperandIndex)(a.operands,b);if(c===-1){return}a.operands.splice(c,1)}}}).actions(function(b){return{computeOperands:function(c,d){if(!c||d){b.clearSuggestOperands()}Object.values(a.OperandSuggestAddTypes).forEach(function(a){if(g.SuggestOperandsValidator[a](c)){b.addOrUpdateSuggestOperand(a,c)}else{b.removeSuggestOperand(a)}})}}});exports.default=u;function v(){return{}}exports.searchSuggestsDefaults=v});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("state-tree/search/search",["require","exports","@mail/operands","@octo/smart-input","helpers/date-range","mail/Folder","mobx","mobx-state-tree","service/auth","state-tree/search/utils","state-tree/search-operand/search-operand","state-tree/search-operand/utils","state-tree/search-response/search-response","state-tree/search-suggests/search-suggests","../../default-values","../search-response/search-response"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.searchDefaults=exports.asBoolean=exports.asNumber=exports.asString=exports.QueryKeysMap=void 0;c=__importDefault(c);d=__importDefault(d);g=__importDefault(g);i=__importDefault(i);k=__importDefault(k);l=__importStar(l);exports.QueryKeysMap={QUERY:"q_query",SUBJECT:"q_subj",FOLDER:"q_folder",CATEGORY:"q_tcategory",CC_FROM:"q_from",CC_TO:"q_to",FLAG_UNREAD:"q_read",FLAG_FLAGGED:"q_flag",FLAG_ATTACH:"q_attach",INTERVAL_DATE:"q_date",INTERVAL_DATE_LAPSE:"q_date_lapse",IN_EXCLUDED_FOLDERS:"q_trash"};function o(a){if(a===undefined){return undefined}return String(a)}exports.asString=o;function p(a){if(a===undefined){return a}return parseInt(a,10)}exports.asNumber=p;function q(a){a=String(a);return a==="true"||a==="1"}exports.asBoolean=q;var r=[].concat(Object.values(a.OperandFilterTypes)).concat(m.SEARCH_CATEGORIES).concat(m.ENABLE_COLOR_TAGS_SEARCH?m.COLOR_TAGS:null).concat(Object.values(a.OperandQueryTypes)).reduce(function(a,b){a[b]=true;return a},{});var s={unread:a.OperandFilterTypes.UNREAD,flagged:a.OperandFilterTypes.FLAGGED,attach:a.OperandFilterTypes.ATTACH};var t;var u;var v;var w="-1024";var x=f.types.model("Search",{response:f.types.optional(k.default,{}),smartInput:(0,b.createModel)(i.default),value:f.types.string,displayedFilter:f.types.optional(f.types.string,""),suggests:l.default,totalSuggests:0,selectedSuggest:-1,progress:false,loading:false,in_excluded_folders:false}).views(function(a){return{get hasOperands(){return!!(a.smartInput.operands&&a.smartInput.operands.length)},get allMailboxes(){var a=d.default.all.toArray().filter(function(a){return a.isServiceShared()}).map(function(a){return{email:a.get("owner").email,name:a.get("owner").name,id:a.get("id")}});var b=g.default.user;var c={email:b.getEmail(),name:b.getFullName(),id:w};return __spreadArray([c],a,true)}}}).views(function(a){return{get query(){var b={};a.smartInput.operands.forEach(function(a){switch(a.type){case j.SearchOperandType.FOLDER:{b.folder=a.value;break}case j.SearchOperandType.QUERY:{(0,h.deriveSearchQueryFromOperand)(b,a);break}case j.SearchOperandType.CATEGORY:{b.transaction_category=a.subtype;break}case j.SearchOperandType.FILTER:{(0,h.deriveFlagsFromOperand)(b,a);break}case j.SearchOperandType.DATE:{b.interval=c.default.fromDateAndLapse(a.value).normalize().toRPCInterval();break}case j.SearchOperandType.MAILBOX:{b.mailbox=a.value.id}}});if(b.mailbox){b.folder=b.folder||b.mailbox;delete b.mailbox}if(a.hasOperands){b.in_excluded_folders=a.in_excluded_folders}return b}}}).views(function(a){return{get empty(){return!Object.keys(a.query).length},get currentMailbox(){var b=a.query;return this.getMailboxByFolder(b.folder)}}}).views(function(a){return{get isMyMailboxSelected(){return a.currentMailbox.id===w},get folders(){var b=a.response,c=a.query,d=a.currentMailbox;var e=b.folders||[];var f=c.folder!==undefined;if(f){e=__spreadArray([n.SearchFolder.create({id:c.folder.toString(),found:0})],e,true)}var g=function(a){var b=a.folderModel;if(!b){return false}if(d.id===w){return!b.isShareTake()}return b.isShareTake()&&!b.isServiceShared()&&b.get("owner").email===d.email};var h={};e.forEach(function(a,b){if(b===0&&f||g(a)){h[a.idNumber]=a}});return Object.values(h)}}}).views(function(b){return{get hiddenSuggestMap(){var c=b.query,e=b.currentMailbox,f=b.isMyMailboxSelected,g=b.folders,i=b.displayedFilter;var k=__assign({},r);var l=function(a){return!i||i===a};k[j.SearchOperandType.CATEGORY]=l(j.SearchOperandType.CATEGORY);k[j.SearchOperandType.FILTER]=l(j.SearchOperandType.FILTER);k[j.SearchOperandType.FOLDER]=true;k[j.SearchOperandType.DATE]=l(j.SearchOperandType.DATE);k[a.OperandQueryTypes.FROM]=true;k[a.OperandQueryTypes.TO]=true;k[a.OperandQueryTypes.SUBJECT]=true;k[a.OperandQueryTypes.QUERY]=true;if(m.ENABLE_COLOR_TAGS_SEARCH){k["COLOR_TAG_CUSTOM"]=true}if(d.default.all.hasSharedTake()){var n=b.allMailboxes;var o=d.default.all.get(c.folder);var p=n.filter(function(a){var b=a.id;if(b===w){return false}var c=d.default.all.get(b);return c&&!(0,h.isInMailbox)(o,c)});k[j.SearchOperandType.MAILBOX]=p.length&&l(j.SearchOperandType.MAILBOX)?p:false}if(c.transaction_category&&!i){k[j.SearchOperandType.CATEGORY]=false;Object.values(a.CategoryTypes).forEach(function(a){k[a]=false});k["COLOR_TAG_CUSTOM"]=false}if(!i){if(c.flags){Object.keys(s).forEach(function(a){if(c.flags[a]){k[s[a]]=false}});if(c.flags.attach&&c.flags.flagged&&c.flags.unread){k[j.SearchOperandType.FILTER]=false}}if(c.correspondents){if(c.correspondents.from){k[a.OperandQueryTypes.FROM]=false}if(c.correspondents.to){k[a.OperandQueryTypes.TO]=false}}if(c.interval){k[j.SearchOperandType.DATE]=false}if(c.subject!==undefined){k[a.OperandQueryTypes.SUBJECT]=false}if(c.query!==undefined){k[a.OperandQueryTypes.QUERY]=false}}var q=e.id!==c.folder;var t=c.folder!==undefined;var u=!g.length;if(t&&(f||q||u)||b.empty){k[j.SearchOperandType.FOLDER]=false}if(m.SEARCH_HIDE_CATEGORIES){k[j.SearchOperandType.CATEGORY]=false}if(!m.ENABLE_COLOR_TAGS_SEARCH){k["COLOR_TAG_CUSTOM"]=false}return k}}}).views(function(b){return{get enabledQueryOptions(){var c=b.hiddenSuggestMap;return Object.values(a.OperandQueryTypes).reduce(function(b,d){if(c[d]){return b|a.OperandQueryOptions[d]}return b},0)},get countedMailboxes(){var a=b.allMailboxes,c=b.response,d=c.count,e=c.folders,f=e===void 0?[]:e;var g=a[0],h=a.slice(1);var i=0;var j=h.map(function(a){var b=f.find(function(b){return b.id.toString()===a.id.toString()});var c=b?b.found:0;i+=c;return __assign(__assign({},a),{found:c})});var k=d-i;var l=__assign(__assign({},g),{found:k});return __spreadArray([l],j,true)}}}).views(function(a){return{get routerQuery(){var b;var d=(b={},b[exports.QueryKeysMap.QUERY]=a.query.query,b[exports.QueryKeysMap.SUBJECT]=a.query.subject,b[exports.QueryKeysMap.FOLDER]=a.query.folder,b[exports.QueryKeysMap.CATEGORY]=a.query.transaction_category,b[exports.QueryKeysMap.CC_FROM]=a.query.correspondents&&a.query.correspondents.from,b[exports.QueryKeysMap.CC_TO]=a.query.correspondents&&a.query.correspondents.to,b[exports.QueryKeysMap.FLAG_UNREAD]=a.query.flags&&a.query.flags.unread?1:undefined,b[exports.QueryKeysMap.FLAG_FLAGGED]=a.query.flags&&a.query.flags.flagged?1:undefined,b[exports.QueryKeysMap.FLAG_ATTACH]=a.query.flags&&a.query.flags.attach?1:undefined,b[exports.QueryKeysMap.IN_EXCLUDED_FOLDERS]=a.query.in_excluded_folders?1:undefined,b);var e=a.query.interval;if(e){d=__assign(__assign({},d),c.default.fromRPCInterval(e).toQuery())}Object.keys(d).forEach(function(a){if(d[a]===undefined){delete d[a]}});return d}}}).actions(function(a){return{setProgress:function(b){a.progress=!!b;if(!b){clearTimeout(v)}},setResponse:function(b){a.response.count=b.found.count;a.response.folders=b.found.folders;a.response.dates=b.found.dates}}}).actions(function(a){return{setValue:function(b){a.value=b},setSuggestsInfo:function(b){var c=b.totalSuggests,d=c===void 0?a.totalSuggests:c,e=b.selectedSuggest,f=e===void 0?a.selectedSuggest:e;a.totalSuggests=d;a.selectedSuggest=f},setLoading:function(b){a.loading=!!b;if(!b){a.setProgress(false)}},reloadLetters:function(){var b=(0,f.getEnv)(a);var c=b.getDataSource&&b.getDataSource();if(!c){return}c.dispatch({type:c.UPDATE_ALL})},setInExcludedFolders:function(b){a.in_excluded_folders=!!b}}}).actions(function(c){return{setQuery:function(a){var b=!!p(a.in_excluded_folders);c.setInExcludedFolders(b);var e=d.default.all.get(a.folder);var f=c.currentMailbox,g=c.isMyMailboxSelected;if(b&&e&&!(e.isSpam()||e.isTrash())){if(g){delete a.folder}if(!g){a.folder=f.id}}(0,h.reconcileOperandsList)(c.smartInput,a)},setResponseAndProgress:function(a,b){c.setResponse(a);c.setProgress(b)},appendSearchQuery:function(d){if(!d){return}c.setValue("");var e=c.smartInput.operands.find(function(b){return b.subtype===a.OperandQueryTypes.QUERY});if(e){e.setValue(e.value+" "+d);return e.applyChanges()}c.smartInput[b.SmartInputActions.PUSH]({current:{type:j.SearchOperandType.QUERY,subtype:a.OperandQueryTypes.QUERY,value:d}})}}}).actions(function(a){return{syncWithRouteQuery:function(b){var d={query:o(b[exports.QueryKeysMap.QUERY]),subject:o(b[exports.QueryKeysMap.SUBJECT]),folder:p(b[exports.QueryKeysMap.FOLDER]),transaction_category:o(b[exports.QueryKeysMap.CATEGORY]),in_excluded_folders:p(b[exports.QueryKeysMap.IN_EXCLUDED_FOLDERS])};if(b[exports.QueryKeysMap.CC_FROM]!==undefined||b[exports.QueryKeysMap.CC_TO]!==undefined){d.correspondents={from:o(b[exports.QueryKeysMap.CC_FROM]),to:o(b[exports.QueryKeysMap.CC_TO])}}if(b[exports.QueryKeysMap.FLAG_UNREAD]!==undefined||b[exports.QueryKeysMap.FLAG_FLAGGED]!==undefined||b[exports.QueryKeysMap.FLAG_ATTACH]!==undefined){d.flags={unread:q(b[exports.QueryKeysMap.FLAG_UNREAD]),flagged:q(b[exports.QueryKeysMap.FLAG_FLAGGED]),attach:q(b[exports.QueryKeysMap.FLAG_ATTACH])}}var e=c.default.fromQuery(b);if(e){d.interval=e.normalize().toRPCInterval()}if(!m.ENABLE_COLOR_TAGS_SEARCH&&m.COLOR_TAGS.includes(b[exports.QueryKeysMap.CATEGORY])){delete d.transaction_category}a.setQuery(d)},getLetterHref:function(b){var c=(0,f.getEnv)(a);var d=c.getRouter&&c.getRouter();var e="#read-letter";var g=d[e];return g.getUrl({letter:b.threadId,folder:b.folder,id:b.messageId},"inherit")},goToLetter:function(b){if(b===void 0){b=undefined}var c=(0,f.getEnv)(a);var d=c.getRouter&&c.getRouter();var e=this.getLetterHref(b);d.nav(e,{initiator:"popstate"})},goToLetterAndClear:function(a){if(a===void 0){a=undefined}this.goToLetter(a);this.clear()},getMailboxByFolder:function(b){var c=a.allMailboxes;var e=d.default.all.get(b);if(!b||!e||!e.isShareTake()){return c.find(function(a){var b=a.id;return b===w})}return c.find(function(a){var b=a.email;return b===e.get("owner").email})},applyMailboxOperand:function(c){if(!c||c.id===a.currentMailbox.id){return}this.removeOperand(j.SearchOperandType.FOLDER);this.removeOperand(j.SearchOperandType.MAILBOX);if(c.id===w){return}(0,f.applyAction)(a.smartInput,{name:b.SmartInputActions.PUSH,args:[{current:{type:j.SearchOperandType.MAILBOX,value:c}}]})},applyFolderOperand:function(c){if(d.default.all.hasSharedTake()){var e=this.getMailboxByFolder(c);this.applyMailboxOperand(e)}(0,f.applyAction)(a.smartInput,{name:b.SmartInputActions.PUSH,args:[{current:{type:j.SearchOperandType.FOLDER,value:c}}]})},applyOperand:function(c,d,e){if(e===void 0){e=undefined}if(c!==j.SearchOperandType.QUERY&&!!a.value){a.appendSearchQuery(a.value)}a.value="";if(c===j.SearchOperandType.MAILBOX){this.applyMailboxOperand(e);return}if(c===j.SearchOperandType.FOLDER){this.applyFolderOperand(e);return}(0,f.applyAction)(a.smartInput,{name:b.SmartInputActions.PUSH,args:[{current:{type:c,subtype:d,value:e}}]})},setOperandActive:function(c,d,e){if(d===void 0){d=undefined}if(e===void 0){e=undefined}var g=a.smartInput;var i=(0,h.findOperandIndex)(g,c,d);if(i<0){this.applyOperand(c,d,e);i=(0,h.findOperandIndex)(g,c,d)}if(i>=0){(0,f.applyAction)(a.smartInput,{name:b.SmartInputActions.SET_OPERAND_FLAGS,args:[i,{active:true,editing:true}]})}},setInputActive:function(){var c=a.smartInput.operands;var d=c.length;var e=c[c.length-1];if(e&&(e.type===j.SearchOperandType.DATE||e.type===j.SearchOperandType.FOLDER)){d--}(0,f.applyAction)(a.smartInput,{name:b.SmartInputActions.SET_OPERAND_FLAGS,args:[d,{active:true,editing:true}]})},applyOperandAndFocus:function(a,b,c){if(c===void 0){c=undefined}this.applyOperand(a,b,c);this.setInputActive()},setDisplayedFilters:function(b){a.displayedFilter=b||""},removeOperand:function(c,d){var e=a.smartInput;var f=(0,h.findOperandIndex)(e,c,d);if(f>=0){e[b.SmartInputActions.SPLICE](f,1)}},clear:function(){a.value="";a.displayedFilter="";a.selectedSuggest=-1;a.in_excluded_folders=false;(0,f.applyAction)(a.smartInput,{name:b.SmartInputActions.CLEAR});t=undefined;clearTimeout(u);u=undefined},updateOperand:function(b,c,d,e){var f=(0,h.findOperand)(a.smartInput,b,c);if(f&&d!==undefined){f.setSubtype(d)}if(f&&e!==undefined){f.setValue(e);f.applyChanges()}},updateOperandSubtypeAndFocus:function(c,d){c.setSubtype(d);var e=a.smartInput.operands.findIndex(function(a){return c===a});(0,f.applyAction)(a.smartInput,{name:b.SmartInputActions.SET_OPERAND_FLAGS,args:[e,{active:true,editing:false}]})},updateOperandSubtypeAndBlur:function(c,d){c.setSubtype(d);(0,f.applyAction)(a.smartInput,{name:b.SmartInputActions.DEACTIVATE_ALL})}}}).extend(function(a){(0,e.reaction)(function(){return a.value},function(){a.suggests.computeOperands(a.value,a.hasOperands)});(0,e.reaction)(function(){return a.query},function(){a.setLoading(true);if(u!==undefined){return}u=setTimeout(function(){u=undefined;var b=!t;if(b||!(0,h.searchQueriesEqual)(a.query,t)){t=a.query;var c=(0,f.getEnv)(a);var d=c.getRouter&&c.getRouter();if(!d||!d.activeRoute.is("#search")&&!d.activeRoute.is("#search-letter")&&a.empty){a.setLoading(false);return}if(d.route.is("#search-letter")&&b){return}d.go("#search",{},a.routerQuery).then(function(){a.setLoading(false)});v=setTimeout(function(){a.setProgress(true)},100)}},100)});return{}});exports.default=x;function y(){return{smartInput:{},value:"",suggests:(0,l.searchSuggestsDefaults)()}}exports.searchDefaults=y});define("state-tree/application/application",["exports","router","data-source/actions","helpers/data-source-dispatch","mobx-state-tree","RPC","../search/search"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.store=undefined;var g=j(c);var h=j(e);var i=j(f);function j(a){return a&&a.__esModule?a:{default:a}}var k=d.types.model({search:i.default});var l=exports.store=k.create({search:(0,f.searchDefaults)()},{getRouter:a.getAppRouter,getRPC:function a(){return h.default},getDataSource:function a(){return{dispatch:g.default,UPDATE_ALL:b.UPDATE_ALL}}})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/utils",["require","exports","@mail/xray","Action","default-values","mail/Folder","mail/Message","mail/SharedMailbox","mail/Thread","Model","models/metathread/metathread","route/utils/filter-query","service/mailbox/loader","state-tree/application/application"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.lettersLoaderIntegrationService=exports.getStore=exports.destroyExcessThreads=exports.destroyThreadOrMessage=exports.requestQueryEquals=exports.handleSecureOpenError=exports.prevStatusIfActionLocked=exports.prevDataIfActionLocked=exports.isActionLocked=exports.prevStatus=exports.concatThreadLists=exports.mergeThreadLists=exports.mapThreadIds=exports.mapMessages=exports.mapThreads=exports.mapSharedMailboxes=exports.mapFolders=void 0;a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importStar(k);var m=["search_attaches","search_subject","search_snippet","thread_id"];function n(a){var b={};var c=a.map(function(a){var c=d.default.all.get(a.id);if(c){c.set(a);c.meta("level",undefined)}else{c=new d.default(a);d.default.all.set([c])}b[a.id.toString()]=true;return c});d.default.all.forEach(function(a){if(!b[a===null||a===void 0?void 0:a.get("id").toString()]){d.default.all.remove(a)}});return c}exports.mapFolders=n;function o(a){if(a===void 0){a=[]}var b={};var c=a.map(function(a){var c,d,e;var g=f.default.all.get((c=a.owner)===null||c===void 0?void 0:c.email);if(g){g.set(a)}else{g=new f.default(__assign(__assign({},a),{id:(d=a.owner)===null||d===void 0?void 0:d.email}));f.default.all.set([g])}b[(e=a.owner)===null||e===void 0?void 0:e.email]=true;return g});f.default.all.forEach(function(a){if(!b[a===null||a===void 0?void 0:a.get("owner.email")]){f.default.all.remove(a)}});return c}exports.mapSharedMailboxes=o;function p(a,b,c){if(b===void 0){b={}}if(c===void 0){c=0}var d=[];var e;var f;for(var h=0;h<a.length;h++){e=a[h];if(i.default.isMetathread(e)){i.default.patchThreadId(e);f=i.default.map(e)}else{f=g.default.all.get(e.id);if(f){f.set(e,{sync:true,clean:true,resetChanged:true});if(Object.keys(f.changed).length){f.meta("changed",(f.meta("changed")||0)+1)}if(b.currentId===e.id){b.changed=!!Object.keys(f.changed).length}}else{f=new g.default(e);g.default.all.set([f])}f.setContainingMetathread(null);f.meta("_ui-index",c+h)}d.push(f)}return d}exports.mapThreads=p;function q(a){if(!a){return[]}var b=[];var c;var d;var f;for(var g=0;g<a.length;g++){c=a[g];d=e.default.all.get(c.id);if(d){d.set(c)}else{d=new e.default(c);e.default.all.set([d])}for(var h=0;h<m.length;h++){f=m[h];d.meta(f,c[f])}d.meta("_ui-priority-index",g);b.push(d)}return b}exports.mapMessages=q;function r(a){var b={};var c=a.length;var d;while(c--){d=a[c];b[d.id]=d}return b}exports.mapThreadIds=r;function s(a,b){var c;for(var d=0;d<a.length;d++){c=a[d];if(!c){return false}if(c.id===b){return true}}return false}function t(a,b){var c=b.get("date");var d;for(var e=0;e<a.length;e++){d=a[e];if(d.get("date")<c){a.splice(e,0,b);return}}a.push(b)}function u(a){var b={};var c=[];var d;for(var e=0;e<a.length;e++){d=a[e];if(!b[d.id]){b[d.id]=true;c.push(d)}}return c}function v(a){var b=a.getFolder();if(!b.isMetathread()){return false}var c=+b.get("id");var d=i.default.all.find(function(a){return a.getMetathreadFolder()===c});return d.isExpanded()}function w(a,b,c){var d=c.offset,e=c.limit,f=c.persistThread;var i=a.slice(0,d);var j=a.slice(d,d+e);var k=a.slice(d+e,a.length);var l=f instanceof h.default;var m=l?f.id:f;var n=l?f:g.default.all.get(f);var o=f&&s(j,m);var p=o&&!s(b,m);if(p&&n&&!v(n)){t(b,n)}var q=[].concat(i).concat(b).concat(k);return u(q)}exports.mergeThreadLists=w;function x(a,b){var c=r(b);var d=[];var e;for(var f=0;f<a.length;f++){e=a[f];if(!c[e.id]){d.push(e)}}return d.concat(b)}exports.concatThreadLists=x;function y(a){return __assign({},a&&a.status||{})}exports.prevStatus=y;function z(){return b.default.active>0}exports.isActionLocked=z;function A(a){if(z()){if(c.IS_DEBUG){console.warn("[data-source] Изменения не были внесены в state, поскольку выполняется ".concat(b.default.active," действий."))}return a}return null}exports.prevDataIfActionLocked=A;function B(a){return A(y(a))}exports.prevStatusIfActionLocked=B;function C(a,b,c){if(a instanceof k.SecureFolderNotOpenError){var d=y(c);return __assign(__assign({},d),{folders:d.folders,letters:[]})}throw a}exports.handleSecureOpenError=C;function D(a,b){return a.filter_flagged==b.filter_flagged&&a.filter_unread==b.filter_unread&&a.filter_with_attachments==b.filter_with_attachments}exports.requestQueryEquals=D;function E(a){if(typeof a.destroy==="function"){a.destroy()}var b=g.default.all.get(a.id);var c=e.default.all.get(a.id);if(b){b.destroy()}if(c){c.destroy()}}exports.destroyThreadOrMessage=E;function F(a,b){return a.filter(function(a){if(!b(a)){return true}E(a);return false})}exports.destroyExcessThreads=F;function G(){return l.store}exports.getStore=G;exports.lettersLoaderIntegrationService={doRequest:function(a,b){return k.default.load(b)},concatThreadLists:x,mergeThreadLists:w,mapThreads:p,mapMessages:q,mapFolders:n,mapSharedMailboxes:o,isActionLocked:z,mapCollectors:function(b){if(c.LOG_EMPTY_COLLECTORS&&!b){a.default.send("empty-cltrs-status",{rlog:"empty-collectors",rlog_message:{collectors:typeof b,place:"mapCollectors"}})}return b||[]},getListLimit:function(){return c.LIST_LIMIT},getFilterQuery:function(){return j.default.get()},getSortingQuery:function(){return j.default.getSorting()},getCurrentTS:function(){return Date.now()},unreadMessagesNotificationsFix:function(a){k.default.emit("data",[a])},isSecureFolderNotOpenError:function(a){return a instanceof k.SecureFolderNotOpenError},getAllFolders:function(){return d.default.all.toArray()}}});define("service/threadUpdater",["require","exports","default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=Symbol("cancel");var c;var d=f();var e=new Set;exports.default={scheduleThreadUpdate:function(b){if(!a.SYNC_THREAD_UPDATES){return}var g=c;var h=f();var i=new Promise(function(b){return setTimeout(function(){b(0)},a.THREAD_UPDATE_TIMEOUT)});d=Promise.race([b,h,i]);if(e.size>0){g();this._updateSubscriptions()}},subscribe:function(b){var d=this;if(!a.SYNC_THREAD_UPDATES){b();return function(){}}var f=function(){e.delete(b);c();d._updateSubscriptions()};e.add(b);this._subscribe(b);return f},_subscribe:function(a){d.then(function(){e.delete(a);a()}).catch(function(a){if(a!==b){throw a}})},_updateSubscriptions:function(){var a=this;e.forEach(function(b){a._subscribe(b)})}};function f(){return new Promise(function(a,d){c=function(){return d(b)}})}});define("data-source/source/letter",["exports","@mail/xray","@mail-core/dashboard","data-source/actions","data-source/utils","data-source/utils/logger","default-values","logger","mail/Message","mail/Thread","service/threadUpdater"],function(exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var k=p(a);var l=p(g);var m=p(h);var n=p(i);var o=p(j);function p(a){return a&&a.__esModule?a:{default:a}}var q=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var r=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var s=0;function t(a,b){l.default.add(a,b);e.DataSourceLogger.sendLog(r({label:a},b))}function u(a){return a===s}function v(a,b,c){var d=c.params.letter;if(c.is("#read-letter")&&d!==a.id){var e=a.getFolder();c.redirectTo(c.router.getUrl("#read-letter",{letter:a.id,folder:e.id}));if(b){b.destroy()}}return a}function w(a,b){if(!a){return}var c=a.get("messages").toArray();var e=(0,d.mapThreadIds)(b);a.set("messages",c.filter(function(a){if(e[a.id]){a.destroy();a=m.default.all.get(a.id);if(a){a.destroy()}return false}return true}));return a}function x(a,b,c){var e={id:a.id,offset:0,last_modified:1,force_custom_thread:f.FORCE_CUSTOM_THREAD,use_color_scheme:f.DARK_MODE_MEDIA_QUERY?1:0};var g=r({},e,b);var h=n.default.fetchData(g,true).then(function(b){if(!(0,d.prevDataIfActionLocked)(a)){var e=b.messages;var f=a.get("messages").toArray();if(c){b.messages=(0,d.concatThreadLists)(f,e)}else{b.messages=(0,d.mergeThreadLists)(f,e,{offset:g.offset,limit:e.length})}a.set(b)}else{t("letter.fetchThread.then",{query:g,prevDataIfActionLocked:true});k.default.send("ltr-ftch-trd-lckd")}return a});o.default.scheduleThreadUpdate(h);return h}function y(a,b,c){if(!f.SMART_THREAD_FETCHING||!a.isDataFully()){return x(a)}t("letter.tryFetchThread.prevThreadMetaChanged",{changed:a.meta("changed")});if(a.meta("changed")){a.meta("changed",0);return x(a)}var d=b.threadMeta||{changed:true};var e=Object.values(c).some(function(b){var c=b.threadMeta;return c.currentId===a.id&&c.changed});var g=d.currentId===a.id&&d.changed;t("letter.tryFetchThread.checkChanged",{changedCurrent:g,changedInMetathreads:e});if(!g&&!e){return Promise.resolve(a)}return x(a)}exports.default={match:["#read-letter","#search-letter"],defaults:null,fetch:function a(e,g,h,i){var j=e.params,k=j.folder,l=j.letter,p=j.part;var z=h&&h.type;var A=void 0;if(i&&i.letter){A=i.letter}var B=n.default.get(l);if((0,d.prevDataIfActionLocked)(B)){t("letter.fetch",{actionType:z,prevDataIfActionLocked:true});return B}return b.userKeeper.group("app-fetch-thread",function(){switch(z){case c.THREAD_LOAD_MORE:{var a=B;var b=a.get("messages.length");return x(a,{offset:b,limit:f.THREAD_LETTERS_LOAD_MORE_COUNT},true)}case c.DESTROY_THREADS_AND_MESSAGES:{return w(B,h.models.messages)}case c.NAVIGATE:case c.UPDATE_ALL:{if(p){var d=l.replace(/\d+:(\d+):\d+/,"$1;"+p);return m.default.findOne({id:d,folder_id:k,use_color_scheme:f.DARK_MODE_MEDIA_QUERY?1:0}).then(function(a){var b=a.get("folder");if(k==b){return new n.default(r({},a.attributes,{expand:d,messages:[a]}))}else{return e.redirectTo(e.router.getUrl("#read-letter",{folder:b,letter:l,part:p}))}})}if(B&&B.isDataFully()){var i=++s;return Promise.all([g("status"),g("metathreads")]).then(function(a){var b=q(a,2),d=b[0],f=b[1];setImmediate(function(){y(B,d,f).then(function(a){if(!u(i)){return a}var b=v(a,B,e);if(z===c.NAVIGATE){b.emit("loaded-changes")}return b})});return Promise.resolve(B)})}else if(B){return x(B).then(function(a){return v(a,B,e)})}else{var j={id:l,force_custom_thread:f.FORCE_CUSTOM_THREAD,use_color_scheme:f.DARK_MODE_MEDIA_QUERY?1:0};var t=n.default.findOne(j).then(function(a){return v(a,B,e)});o.default.scheduleThreadUpdate(t);return t}}default:return B||A}},{score:"fetch",appendix:!z?"no-act":"act"})}}});define("data-source/utils/paginator",["require","exports","../../default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isPaginatorGlobalEnabled=exports.isPaginatorEnabled=exports.canPaginatorBeEnabled=exports.dropPageHeight=exports.hasMemoizedExactPageHeight=exports.getMemoizedPageHeight=exports.memoizePageHeight=exports.calcSkeletonsAtEnd=exports.calcLastLetterIndex=exports.calcSkeletonsAtStart=void 0;var b={};function c(b){var c=typeof b.page==="number";return c?Math.max((b.page-1)*a.LIST_LIMIT-1,0):0}exports.calcSkeletonsAtStart=c;function d(a){return a.letters.length+c(a)}exports.calcLastLetterIndex=d;function e(a){var b=d(a);return Math.max(a.lettersTotal-b-1,0)}exports.calcSkeletonsAtEnd=e;function f(a,c,d){if(d===void 0){d=false}b[a]={height:c,exact:d}}exports.memoizePageHeight=f;function g(a){return b[a]?b[a].height:undefined}exports.getMemoizedPageHeight=g;function h(a){return!!(b[a]&&b[a].exact)}exports.hasMemoizedExactPageHeight=h;function i(a){delete b[a]}exports.dropPageHeight=i;function j(b){var c=b&&b.model&&b.model.uiLayout;var d=b&&b.activeRoute&&b.activeRoute.is("#search #search-letter");var e=c&&c.type==="3pane"&&c.support3pane;return a.CAN_ENABLE_PAGINATOR&&!d&&!e}exports.canPaginatorBeEnabled=j;function k(a,b){var c=b&&b.paginator;return j(a)&&c}exports.isPaginatorEnabled=k;function l(a){var b=a&&a.model&&a.model.uiThreadsSettings;return k(a,b)}exports.isPaginatorGlobalEnabled=l});define("data-source/source/letter-neighbours",["exports","data-source/actions","data-source/utils/paginator","helpers/data-source-dispatch","mail/Message","models/metathread/metathread","pilotjs"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=k(c);var h=k(d);var i=k(e);var j=k(f);function k(a){return a&&a.__esModule?a:{default:a}}var l=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var m=-1;function n(a,b){if(b||a.meta("thread_id")){return a.meta("thread_id")||a.id}if(/:/.test(a.id)){return a.id}if(a instanceof h.default){return"0:"+a.get("id")+":"+a.get("folder")}return"0:"+a.id+":0"}function o(a,b,c){var d=void 0;var e=void 0;while(b>0){d=a[b];e=d&&n(d,c);b--;d=a[b];if(d&&n(d,c)!==e&&!i.default.isMetathread(d)){return d}}}function p(a,b,c){var d=void 0;var e=void 0;while(b<a.length-1){d=a[b];e=d&&n(d,c);b++;d=a[b];if(d&&n(d,c)!==e&&!i.default.isMetathread(d)){return d}}}exports.default={match:["#read-letter","#search-letter"],defaults:null,fetch:function c(d,e,f,h){var i=f&&f.type;var k=h&&h.letterNeighbours||{};var q=d.route.is("#search-letter");if(i!==a.NAVIGATE&&i!==a.UPDATE_ALL&&i!==a.LOAD_MORE&&i!==a.LOAD_PAGE&&k){return k}var r=Promise.all([q?e("search"):e("status"),e("letter"),e("uiThreadsSettings")]);return r.then(function(c){var e=l(c,3),f=e[0],h=e[1],i=e[2];var k=i.threads;var r=f.letters;var s=d.params.id||d.params.letter;var t=r.findIndex(function(a){return a.id===s});var u=t===1;var v=t>=r.length-2;if(t===m){if(q){return{}}return{prev:{threadId:h.get("prev")},next:{threadId:h.get("next")}}}var w=o(r,t,k);var x=p(r,t,k);if((0,b.isPaginatorEnabled)(d.router,i)&&u&&!q&&f.page>1){(0,g.default)({type:a.LOAD_MORE,prev:true,priority:j.default.Loader.PRIORITY_LOW})}if(v&&!f.isLastPage){(0,g.default)({type:a.LOAD_MORE,priority:j.default.Loader.PRIORITY_LOW})}return{prev:w&&{threadId:n(w,k),id:w.id},next:x&&{threadId:n(x,k),id:x.id}}})}}});define("data-source/source/letters",["exports","mail/Thread"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}var d=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();exports.default={match:["#letters","#read-letter"],defaults:new b.default.List,fetch:function a(b,c){var e=[c("status"),c("folder"),c("letter")];return Promise.all(e).then(function(a){var b=d(a,1),c=b[0];return c.letters||[]})}}});define("data-source/source/message",["exports","default-values","mail/Message"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=d(b);function d(a){return a&&a.__esModule?a:{default:a}}exports.default={match:["#attachment"],defaults:null,fetch:function b(d){var e=d.params.message;var f=d.query["folder-id"];return c.default.findOne({id:e,folder_id:f,use_color_scheme:a.DARK_MODE_MEDIA_QUERY?1:0})}}});define("data-source/source/metathreads",["exports","data-source/actions","data-source/utils","default-values","mail/Folder","models/metathread/metathread","route/utils/filter-query","service/mailbox/loader"],function(exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var h=l(d);var i=l(e);var j=l(f);var k=l(g);function l(a){return a&&a.__esModule?a:{default:a}}var m=function a(){return{}};function n(a,c){var d=c.metathreads[a.id];return(0,b.prevDataIfActionLocked)(d)}function o(a,b){var c=b&&b.metathreads[a.id];return c&&c.threads||[]}function p(a,b){if(!a.threads){return a}a.threads.forEach(function(a){a.setContainingMetathread(b)});return a}function q(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{offset:0},c=b.limit,d=b.offset;var e=c+1;return k.default.load({folder:a.getMetathreadFolder(),limit:e,offset:d,sort:j.default.getSorting()}).then(function(a){var b=a.threads.length===e;return{threads:b?a.threads.slice(0,e-1):a.threads,isLimitReached:!b}})}function r(a,b){b.setLimitReached(a.isLimitReached);return a}function s(){i.default.all.forEach(function(a){a.setExpanded(false);a.setLimit()});return m()}function t(a,c,d){var e=a.getLimit();var f=c.params.letter;var g={currentId:f,changed:false};return q(a,{limit:e}).then(function(c){return n(a,d)||{threads:(0,b.mapThreads)(c.threads,g),threadMeta:g,isLimitReached:c.isLimitReached}}).then(function(b){return r(b,a)}).then(function(b){return p(b,a)}).catch(function(a){return(0,b.handleSecureOpenError)(a,c,d)})}function u(a,d,e){var f=o(a,e);var g=c.LIST_LIMIT;var h=d.params.letter;var i={currentId:h,changed:false};return q(a,{limit:g}).then(function(c){return n(a,e)||{threads:(0,b.mergeThreadLists)(f,(0,b.mapThreads)(c.threads,i),{limit:g,offset:0}),isLimitReached:c.isLimitReached,threadMeta:i}}).then(function(b){return r(b,a)}).then(function(b){return p(b,a)}).catch(function(a){return(0,b.handleSecureOpenError)(a,d,e)})}function v(a,d,e){var f=o(a,e);var g=f.length;var h=d.params.letter;var i={currentId:h,changed:false};return q(a,{offset:g,limit:c.METATHREAD_LIMIT}).then(function(a){return(0,b.prevStatusIfActionLocked)(e)||{threads:(0,b.concatThreadLists)(f,(0,b.mapThreads)(a.threads,i)),isLimitReached:a.isLimitReached,threadMeta:i}}).then(function(b){return r(b,a)}).then(function(b){return p(b,a)}).catch(function(a){return(0,b.handleSecureOpenError)(a,d,e)})}function w(a,b){var d=i.default.all.filter(function(a){return a.isExpanded()});return Promise.all(d.map(function(d){if(d.getLimit()<=c.LIST_LIMIT){return t(d,a,b)}return u(d,a,b)})).then(function(a){return a.reduce(function(a,b,c){var e=d[c];a[e.id]=b;return a},{})})}exports.default={match:["#letters","#read-letter"],defaults:m(),fetch:function d(e,f,g,j){var k=g&&g.type;var l=j&&j.metathreads||m();var n=e&&e.params.folder;var o=j&&j.request&&j.request.params.folder;if((0,b.prevDataIfActionLocked)(l)){return l}switch(k){case a.LOAD_MORE_METATHREAD:{var p=g.model;return v(p,e,j).then(function(a){p.setLimit(p.getLimit()+c.METATHREAD_LIMIT);l[p.id]=a;return l})}case a.TOGGLE_METATHREAD:{var q=Date.now();var r=g.model,t=g.state;r.set({lastToggle:q});if(t===r.isExpanded()){return l}r.setExpanded(t);if(!t){delete l[r.id]}return w(e,j)}case a.TOGGLE_TO_MYSELF_METATHREAD:var u=g&&g.state;var x=i.default.all.get("multithreadFixId500015");if(x&&u===false){x.setExpanded(false);x.setLimit()}return w(e,j);case a.TOGGLE_METATHREADS_SETTING:case a.CHANGE_METATHREADS_SETTING:case a.EDIT_METATHREADS_SETTINGS:case a.TOGGLE_METATHREADS_SETTINGS:case a.NAVIGATE:case a.UPDATE_ALL:{if(k===a.NAVIGATE&&o!==n&&n!==h.default.INBOX||k===a.TOGGLE_METATHREADS_SETTING||k===a.CHANGE_METATHREADS_SETTING||k===a.EDIT_METATHREADS_SETTINGS||k===a.TOGGLE_METATHREADS_SETTINGS){if(e.is("#read-letter")||e.is("#search-letter")){return s()}return f("letters").then(s,s)}return w(e,j)}}return l}}});define("helpers/service-worker-listener",["exports","helpers/data-source-dispatch","service/auth","service/radars/index"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){if(!j){if(window.navigator.serviceWorker&&navigator.serviceWorker.addEventListener){navigator.serviceWorker.addEventListener("message",i)}j=Promise.resolve()}return j};var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}function h(a){if(a.type==="show-letter"){var b=void 0;if(a.thread){b=app.getUrl("#read-letter",{folder:a.folder,letter:a.thread})}else if(a.letter){b=app.getUrl("#read-letter",{folder:a.folder,letter:"0:"+a.letter+":"+a.folder})}if(b){app.nav(b)}else{(0,d.default)()}}}function i(a){if(a.data){var b=null;try{b=JSON.parse(a.data)}catch(a){}if(!b){return null}var c=e.default.user;var g=c.get("login")+"@"+c.get("domain");if(b.email===g){if(b.type==="focus"){if(b.action){h(b.action)}else{(0,d.default)()}(0,f.default)({type:"pushnotification",intervals:[["page_"+(b.action?"action":"focus"),"1"]]})}else if(b.type==="ping"){a.target.controller.postMessage(JSON.stringify({type:"pong",email:g}))}}}}var j=void 0});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/get-omicron-segment",["require","exports","@mail/xray"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getOmicronSegment=void 0;a=__importDefault(a);function b(){try{return a.default.getConfig().o_ss}catch(a){return""}}exports.getOmicronSegment=b});define("helpers/push-manager.config",["exports","cfg","data-source/source/swBox","helpers/service-worker-listener","push-manager","service/auth","helpers/get-omicron-segment"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){if((0,b.isSWBoxEnabled)()){return Promise.resolve()}if(!l){var a=j.default.user;var c=a.get("login")+"@"+a.get("domain");var d={push_title:i18n("Почта Mail.ru"),push_body:i18n("Вам пришло новое письмо"),push_icon:g.default.get("urls.packagesUrl")+"/r/default/ico/icon-192.png",push_body_plural:[i18n("{count} новых писем"),i18n("{count} новое письмо"),i18n("{count} новых письма")],push_empty_subject:i18n("Без темы"),push_from:i18n("От"),push_to:i18n("Кому"),locale:"ru_RU",account:c,application:"mail_e",client_name:"ru.mail.e",counter_push_click:[g.default.get("urls.imgRadarUrl")+"/update?email="+c+"&p=octavius&t=pushnotification\n\t\t\t\t\t\t&v=12&i=all:1,click:2&dwh={%22type%22:%22pushnotification%22,%22ver%22:2,%22action%22:%22click%22}\n\t\t\t\t\t\t&o_ss="+(0,f.getOmicronSegment)()],counter_push_show:[g.default.get("urls.imgRadarUrl")+"/update?email="+c+"&p=octavius&t=pushnotification\n\t\t\t\t\t\t&v=12&i=all:1,show:2&dwh={%22type%22:%22pushnotification%22,%22ver%22:2,%22action%22:%22show%22}\n\t\t\t\t\t\t&o_ss="+(0,f.getOmicronSegment)()]};setTimeout(function(){i.default.setup(d);i.default.register("/serviceworker.js",{scope:"/"}).then(h.default).catch(function(a){console.error(a)})},1);l=Promise.resolve(i.default)}return l};var g=k(a);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}var l=void 0});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/pushManager",["require","exports","helpers/push-manager.config"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);exports.default={fetch:function(){return(0,a.default)()}}});define("data-source/source/request",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={fetch:function a(b){return b}}});define("data-source/source/route",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={fetch:function a(b){return b.router.activeRoute||b.router}}});define("data-source/source/router",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={fetch:function a(b){return b.router}}});define("data-source/utils/searchResponseHelpers",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getSuggestSearchLetters=a;exports.getSuggestFound=b;function a(a){if(!a){return[]}if(!a.extra_suggest_search_results){return[]}return a.extra_suggest_search_results.messages}function b(a){if(!a){return{}}if(!a.extra_suggest_search_results){return{}}return a.extra_suggest_search_results.found}});define("helpers/fast-deep-equal",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=b;var a=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function b(c,d){if(c===d){return true}if(c&&d&&(typeof c==="undefined"?"undefined":a(c))=="object"&&(typeof d==="undefined"?"undefined":a(d))=="object"){if(c.constructor!==d.constructor){return false}var e=void 0;var f=void 0;var g=void 0;if(Array.isArray(c)){e=c.length;if(e!==d.length){return false}for(f=e;f--!==0;){if(!b(c[f],d[f])){return false}}return true}if(c.constructor===RegExp){return c.source===d.source&&c.flags===d.flags}if(c.valueOf!==Object.prototype.valueOf){return c.valueOf()===d.valueOf()}if(c.toString!==Object.prototype.toString){return c.toString()===d.toString()}g=Object.keys(c);e=g.length;if(e!==Object.keys(d).length){return false}for(f=e;f--!==0;){if(!Object.prototype.hasOwnProperty.call(d,g[f])){return false}}for(f=e;f--!==0;){var h=g[f];if(!b(c[h],d[h])){return false}}return true}return c!==c&&d!==d}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/relevant-search",["require","exports","@mail/operands","mail/Folder","../default-values","../helpers/fast-deep-equal"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getRelevantQuery=exports.formRelevantQuery=void 0;b=__importDefault(b);d=__importDefault(d);function e(b,c){if(!c||Object.keys(c).length===0){return null}var e=b.query;if(!e){return null}var f={};var g=c.accurate,h=g===void 0?false:g,i=c.limit,j=i===void 0?3:i,k=c.minWords,l=k===void 0?1:k,m=c.maxWords,n=m===void 0?Infinity:m,o=c.category,p=o===void 0?null:o,q=c.queryType,r=q===void 0?null:q,s=c.filters,t=s===void 0?[]:s,u=c.folder,v=u===void 0?null:u,w=c.documents,x=w===void 0?false:w,y=c.from,z=y===void 0?false:y,A=c.to,B=A===void 0?false:A,C=c.saveFields,D=C===void 0?["all"]:C,E=c.group;var F=e.split(" ");if(!(F.length>=l&&F.length<=n)){return null}if(D.includes("all")){f=__assign({},b)}else{f=D.reduce(function(a,c){if(b[c]||b[c]===0){a[c]=b[c]}return a},{})}if(h){var G=e.length>2&&e[0]==='"'&&e[e.length-1]==='"';if(!G){f.query='"'.concat(e,'"')}}if(x&&!b.transaction_category){f.transaction_category="document_scans"}if(p&&Object.values(a.OperandCategoryTypes).includes(p)){f.transaction_category=p}if(t&&t.length>0&&t.every(function(b){return Object.values(a.OperandFilterTypes).includes(b)})){f.flags=t.reduce(function(a,b){var c;return __assign(__assign({},a),(c={},c[b]=true,c))},__assign({},b.flags))}if(r&&Object.values(a.OperandQueryTypes).includes(r)){if(r!==a.OperandQueryTypes.QUERY){delete f.query}f[r]=e}if(v||v===0){f.folder=v}if(z&&!f.correspondents){f.correspondents={from:e};delete f.query}if(B&&!z&&!f.correspondents){f.correspondents={to:e};delete f.query}if(!Object.keys(f).length||(0,d.default)(f,b)){return null}f.limit=j;f.no_history=true;if(E){f.group=E}return f}exports.formRelevantQuery=e;function f(a,c){if(!c||!a){return null}if(a.transaction_category){return null}var d=a.query,f=a.folder;if(!d){return null}if(f){var g=b.default.all.get(f);if(g&&g.isShareTake()){return null}}var h=d.split(" ");var i=c.configByKeywords&&c.configByKeywords.find(function(a){return a.keywords.some(function(a){return h.some(function(b){if(a&&a[0]==="R"&&a[1]==="_"){try{return new RegExp(a.slice(2)).test(b)}catch(a){return false}}return b.toLowerCase()===a.toLowerCase()})})});if(i){return e(a,i)}if(h.length===1){return e(a,c.oneWordConfig)}if(h.length>=2){return e(a,c.twoWordMoreConfig)}}exports.getRelevantQuery=f;exports.default=function(a){var b=__assign(__assign({},c.RELEVANT_SEARCH),{configByKeywords:__spreadArray([],(c.RELEVANT_SEARCH===null||c.RELEVANT_SEARCH===void 0?void 0:c.RELEVANT_SEARCH.configByKeywords)||[],true)});return f(a,b)}});define("data-source/utils/get-dwh-params",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getDwhParams=void 0;var a=function(a,b){var c,d,e,f;if(!a||!b){return null}var g={category:a.transaction_category,date:a.interval,folder_id:a.folder,from_email:(c=a.correspondents)===null||c===void 0?void 0:c.from,is_flag:((d=a.flags)===null||d===void 0?void 0:d.flagged)||false,is_unread:((e=a.flags)===null||e===void 0?void 0:e.unread)||false,result_count:b===null||b===void 0?void 0:b.lettersTotal,to_email:(f=a.correspondents)===null||f===void 0?void 0:f.to,with_attach:a.all_attaches||false,with_text:!!a.query};return Object.keys(g).reduce(function(a,b){if(g[b]!==undefined){a[b]=g[b]}return a},{})};exports.getDwhParams=a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __rest=this&&this.__rest||function(a,b){var c={};for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0)c[d]=a[d];if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++){if(b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e]))c[d[e]]=a[d[e]]}return c};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/search",["require","exports","@mail/flags","@mail/xray","data-source/actions","data-source/utils","data-source/utils/searchResponseHelpers","default-values","helpers/data-source-dispatch","mail/Message","pilotjs","RPC","service/mailbox/loader","service/radars/index","service/relevant-search","state-tree/search-operand/utils","uuid","../utils/get-dwh-params"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);l=__importDefault(l);m=__importDefault(m);o=__importDefault(o);function q(a){var b=a.transaction_category,c=__rest(a,["transaction_category"]);if(f.USE_NEW_SEARCH_CATEGORY_FORMAT&&b){return __assign({search_categories:[b]},c)}if(b==="document_scans"){return __assign({only_with_documents:1},c)}return a}function r(b,c){var d=c.offset,e=c.limit,g=c.search_id,h=c.extra_suggest_search;var i=q(b);var l=a.default.get("threads").state;return j.default.get("messages/search",__assign(__assign({},i),{offset:d,limit:e,search_id:g,extra_suggest_search:h,with_threads:l,all_attaches:f.SEARCH_ALL_ATTACHES})).catch(function(a){if(a&&a.is("invalid")&&a.get("body.folder.error")==="not_open"){return{error:new k.SecureFolderNotOpenError(a.get("body.folder.value")),body:{messages:[],found:{count:0}}}}throw a})}function s(a,b){var c=b===void 0?{}:b,g=c.limit,h=g===void 0?0:g,i=c.search_id;return r(a,{offset:0,limit:h||f.LIST_LIMIT,search_id:i,extra_suggest_search:f.EXTRA_SUGGEST_SEARCH}).then(function(a){var b=a.body.found;var c=(0,e.getSuggestSearchLetters)(a.body);var f=(0,e.getSuggestFound)(a.body);return{error:a.error,requestID:a.requestID,letters:(0,d.mapMessages)(a.body.messages),lettersTotal:b.count,found:b,suggestLetters:(0,d.mapMessages)(c),suggestLettersTotal:f.count,suggestFound:f,extraSuggestSearchQuery:a.body.extra_suggest_search_query}})}function t(a,b,c){if(b&&Object.keys(b).length>0){var e=b.group;delete b.group;if(!b.limit){return s(a,{search_id:c}).then(function(a){return __assign(__assign({},a),{doneRelevantSearch:{group:e}})})}var g=Promise.all([s(a,{search_id:c}),s(b,{limit:b.limit,search_id:c})]);return g.then(function(a){var c=a[0],g=a[1];return __assign(__assign({},c),{letters:(0,d.mergeThreadLists)(g.letters,c.letters,{offset:b.limit,limit:f.LIST_LIMIT,persistThread:""}),doneRelevantSearch:{group:e}})})}return s(a,{search_id:c})}function u(a,b,c){if(b===void 0){b=[]}return r(a,{offset:b.length,limit:f.LIST_LIMIT,search_id:c,extra_suggest_search:false}).then(function(a){return{error:a.error,requestID:a.requestID,letters:(0,d.concatThreadLists)(b,(0,d.mapMessages)(a.get("body.messages"))),isLastPage:a.get("body.messages").length!==f.LIST_LIMIT,lettersTotal:a.get("body.found.count")}})}var v=null;exports.default={match:["#search","#search-letter"],defaults:{letters:[],lettersTotal:0,suggestLetters:[],suggestLettersTotal:0},fetch:function(a,e,j,k){var q=(0,d.getStore)();var r=q.search;var s=k?k.search:{};if(!v){v=e("status")}s.letters=s.letters||[];var w=a.params.id;var x=(0,m.default)(r.query);switch(j.type){case c.TOGGLE_METATHREADS_SETTING:case c.UPDATE_ALL:{if(!f.ENABLE_SEARCH_POLLING&&j.type===c.UPDATE_ALL){return s}if(!Object.keys(r.query).length){return s}return e("uiLayout").then(function(b){var e=b.type==="3pane"&&b.support3pane;if(!f.ENABLE_SEARCH_POLLING_2PANE_READMSG&&j.type===c.UPDATE_ALL&&!e&&a.route.is("#search-letter")){return s}return t(r.query,x,s.search_id).then(function(a){r.setResponse(a);return __assign(__assign(__assign({},s),a),{letters:(0,d.mergeThreadLists)(s.letters,a.letters,{offset:0,limit:f.LIST_LIMIT,persistThread:h.default.all.get(w)})})}).catch(function(a){if(a&&a.is("invalid")&&a.get("body.folder.error")==="not_exists"&&r.query&&r.query.folder){r.removeOperand(n.SearchOperandType.FOLDER)}return Promise.reject(a)})})}case c.NAVIGATE:case c.UPDATE_SEARCH:{return v.then(function(){var d=__assign({},s);if(j.type===c.NAVIGATE){var e=s.query;r.syncWithRouteQuery(a.query);if(x===null&&Object.keys(r.query).length){x=(0,m.default)(r.query)}if(r.query===e){return s}d.isLastPage=false}if(!Object.keys(r.query).length){r.setResponse({found:{}});return Promise.resolve({query:{},found:{},letters:[],lettersTotal:0,suggestLetters:[],suggestLettersTotal:0,suggestFound:{}})}var f=r.query;var g=(0,o.default)();return t(f,x,g).then(function(a){return __assign(__assign(__assign({},d),{error:void 0,query:f,search_id:g}),a)}).then(function(a){r.setResponseAndProgress(a,false);var c=a&&a.query&&a.query.query;var d=a&&!a.lettersTotal&&!a.suggestLettersTotal;if(c&&d){(0,l.default)("search-query-result-empty")}b.default.send("show_search_result",{dwh:(0,p.getDwhParams)(f,a)});return a}).catch(function(a){r.setProgress(false);return Promise.reject(a)})})}case c.LOAD_MORE:{if(!Object.keys(r.query).length){return s}return u(r.query,s.letters,s.search_id).then(function(a){return __assign(__assign(__assign({},s),{error:void 0}),a)})}case c.DESTROY_THREADS_AND_MESSAGES:{var y=__spreadArray(__spreadArray([],j.models.messages,true),j.models.threads,true);var z={};y.forEach(function(a){var b=a.id;z[b]=true});var A=s.letters.filter(function(a){if(!z[a.id]){return true}(0,d.destroyThreadOrMessage)(a);return false});return __assign(__assign({},s),{letters:A,lettersTotal:A.length})}case c.UPDATE_LAYOUT_TYPE:{if(a.route.is("#search-letter")){(0,g.default)({type:c.UPDATE_ALL,priority:i.default.Loader.PRIORITY_LOW,uid:undefined})}break}}return s}}});define("helpers/encode-uri-component",["exports","logger","service/radars/index"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(a){try{return encodeURIComponent(a)}catch(b){c.default.add("encodeURIComponent.error",{error:b,url:a});(0,d.default)(["encode-uri-component","error"]);return null}};var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/object-to-query",["require","exports","helpers/encode-uri-component"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.objectToQuery=void 0;a=__importDefault(a);function b(b,c){if(c===void 0){c=false}return Object.keys(b).map(function(d){if(c){return(0,a.default)(d)+"="+(0,a.default)(b[d])}return d+"="+b[d]}).join("&")}exports.objectToQuery=b;exports.default=b});define("helpers/querystring-add",["exports","helpers/object-to-query","helpers/querystring"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var e=a.split(/(#.*)/),h=g(e,2),i=h[0],j=h[1],k=j===undefined?"":j;var l=i.split("?"),m=g(l,2),n=m[0],o=m[1],p=o===undefined?"":o;var q=(0,c.default)(f({},(0,d.default)(p),b),true);return n+"?"+q+k};var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var g=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}()});var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/ads-off",["require","exports","@mail/xray","default-values","helpers/querystring-add","RPC"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getAdsPromoUrl=exports.onComplete=exports.sendAdsOffTargetGroup=exports.isAdsOffTargetGroup=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);var e=__spreadArray(__spreadArray([],b.ADV_OFF_QUERY_GROUP,true),b.ADV_OFF_MONTH_GROUP,true);var f;(function(a){a["alreadyNoAds"]="already_noads"})(f||(f={}));function g(){var a=b.ADV_EXP_ID&&e.includes(b.ADV_EXP_ID);var c=b.ADV_TARIFF_FEATURE===f.alreadyNoAds;return a&&!c}exports.isAdsOffTargetGroup=g;function h(){if(!b.ADV_EXP_ID_SEND||!g()){return Promise.resolve(null)}return d.default.call("/api/v1/prodsubs/noads/available").catch(function(b){a.default.send("noads_req_err",{rlog:"noads_req_err",rlog_message:{error:b}})})}exports.sendAdsOffTargetGroup=h;var i=function(a){window.open(a);window.addEventListener("message",function(a){var c=a.data,d=a.origin;if(d===b.ADV_NO_ADS_POSTMSG_URL&&c==="refresh"){window.location.reload()}})};exports.onComplete=i;var j=function(a){return(0,c.default)(b.ADV_NO_ADS_PROMO_URL,{from:a})};exports.getAdsPromoUrl=j});define("helpers/audio-player",["exports","default-values","mrg-xray"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=d(b);function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var g=function(){function b(a,c){e(this,b);this.soundFileName=a;this.audioElement=this._getAudioElement(c)}f(b,[{key:"_createSoundElement",value:function a(){var b=document.createElement("div");b.style.display="none";document.body.appendChild(b);return b}},{key:"_initSoundElement",value:function a(b,c){b.innerHTML='<audio preload="auto">'+'<source src="'+c+'.mp3" type="audio/mpeg">'+'<source src="'+c+'.ogg" type="audio/ogg">'+"</audio>"}},{key:"_getAudioElement",value:function a(b){var c=this._createSoundElement();this._initSoundElement(c,this.soundFileName);if(c&&c.childNodes[0]&&b&&b.id){c.childNodes[0].id=b.id}return c&&c.childNodes[0]}},{key:"play",value:function b(){if(this.audioElement){try{var d=this.audioElement.play();if(d!==void 0){d.then(function(){c.default.send("audio_notification_started",{skipdwh:a.SKIP_DWH})}).catch(function(){c.default.send("audio_notification_failed",{skipdwh:a.SKIP_DWH})})}}catch(b){c.default.send("audio_notification_exception",{skipdwh:a.SKIP_DWH})}}}}]);return b}();exports.default=g});define("helpers/notify-sound",["exports","cfg","helpers/audio-player"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}function f(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var h=c.default.get("urls.packagesUrl")+"/static.promo/sounds/notifier/bell";var i=new d.default(h,{id:"notify-sound-player"});var j=function(){function a(){f(this,a)}g(a,[{key:"play",value:function a(){i.play()}}]);return a}();exports.default=new j});define("service/mailbox/on-status/unread-messages-notifications-utils",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.reactToChangesInUnread=exports.getNewSessionCounter=void 0;function a(a,b){var c=a-b;if(c>=0){return c}return 0}exports.getNewSessionCounter=a;function b(a,b,c){var d=a.totalUnreadGt,e=a.totalMsgGt,f=a.trackedUnreadGt,g=a.trackedMsgGt,h=a.isPageVisible,i=a.totalUnreadEq,j=a.totalMsgEq,k=a.trackedUnreadEq,l=a.trackedMsgEq;if(d&&e&&!h){if(f&&g){b()}}else if(!i||!j||!k||!l){c()}}exports.reactToChangesInUnread=b});define("service/mailbox/on-status/unread-messages-notifications",["exports","Emitter","helpers/notify-sound","service/radars/index","./unread-messages-notifications-utils"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=h(a);var f=h(b);var g=h(c);function h(a){return a&&a.__esModule?a:{default:a}}function i(a,b){var c=0;function d(d){var e=+new Date-c;if(e>b||d){c=+new Date;a()}}return d}function j(a){var b=this;e.default.apply(this);this._settings=a;this._sessionUnreadCounter=0;this._sessionStartTrackedUnreadCounter=0;this._prevTotalUnreadCounter=0;this._prevTotalMsgCounter=0;this._prevTrackedUnreadCounter=0;this._prevTrackedMsgCounter=0;this._isPageVisible=true;this._sessionFirstHandle=true;this._forceAudio=false;this._initAudioActions();document.addEventListener("visibilitychange",function(a){return b._onVisibilityChange(a)})}Object.assign(j.prototype,{_initAudioActions:function a(){this._playAudioIfTimePassed=i(function(){f.default.play();(0,g.default)({chain:["tabnotification_mail_sound_play"],intervals:[["add","1"]]})},this._settings.soundPlayingTimeout)},_playAudio:function a(){var b=this._settings.getState();if(b.sound){this._playAudioIfTimePassed(this._forceAudio);this._forceAudio=false}},_enableTitleBlinking:function a(){this._playAudio();this.emit("update",{count:this._sessionUnreadCounter,timeout:this._settings.titleBlinkingTimeout})},_disableTitleBlinking:function a(){this.emit("update")},_updTitleWithNotifications:function a(){var b=this._settings.getState();if(this._sessionUnreadCounter&&!this._isPageVisible&&b.enabled){this._enableTitleBlinking()}else{this._disableTitleBlinking()}},_resetSessionUnreadCounter:function a(){this._sessionStartTrackedUnreadCounter+=this._sessionUnreadCounter;this._sessionUnreadCounter=0;this._forceAudio=true},_onVisibilityChange:function a(b){this._isPageVisible=!b.target.hidden;if(this._isPageVisible){this._resetSessionUnreadCounter();this._disableTitleBlinking()}},_isHandledFolder:function a(b){return!(b.isTrashLike()||b.isSpam()||b.isArchive()||b.isSent()||b.isDrafts()||b.isTemplates()||b.isDeleted()||b.isOutbox())},_getFolderRoot:function a(b,c){var d=+b.get("parent");if(d===-1){return b}else{var e=void 0;for(var f=0;f<c.length;f++){if(+c[f].id===d){e=c[f]}}return this._getFolderRoot(e,c)}},_getMessagesCounter:function a(b,c,d){var e=this._settings.getState();var f=0;if(d){b.forEach(function(a){f+=a.get(c)})}else if(e.onlyInbox){var g=b.find(function(a){return a.isInbox()});if(g){return g.get(c)}return 0}else{for(var h=0;h<b.length;h++){var i=b[h];if(this._isHandledFolder(i,b)){f+=i.get(c)}}}return f},onNewMessagesInInactiveTab:function a(b){this._sessionUnreadCounter=b;this._updTitleWithNotifications(this._sessionUnreadCounter)},onChangeInMessages:function a(b){this._sessionUnreadCounter=b;this._resetSessionUnreadCounter();this._disableTitleBlinking()},handleUpdate:function a(b){var c=this;if(this._sessionFirstHandle){this._sessionFirstHandle=false;this._prevTotalUnreadCounter=this._getMessagesCounter(b.folders,"messages_unread",true);this._prevTotalMsgCounter=this._getMessagesCounter(b.folders,"messages_total",true);this._prevTrackedUnreadCounter=this._getMessagesCounter(b.folders,"messages_unread");this._prevTrackedMsgCounter=this._getMessagesCounter(b.folders,"messages_total");this._sessionStartTrackedUnreadCounter=this._prevTrackedUnreadCounter;return}var e=this._getMessagesCounter(b.folders,"messages_unread",true);var f=this._getMessagesCounter(b.folders,"messages_total",true);var g=this._getMessagesCounter(b.folders,"messages_unread");var h=this._getMessagesCounter(b.folders,"messages_total");var i=e>this._prevTotalUnreadCounter;var j=f>this._prevTotalMsgCounter;var k=g>this._prevTrackedUnreadCounter;var l=h>this._prevTrackedMsgCounter;var m=e===this._prevTotalUnreadCounter;var n=f===this._prevTotalMsgCounter;var o=g===this._prevTrackedUnreadCounter;var p=h===this._prevTrackedMsgCounter;var q=(0,d.getNewSessionCounter)(g,this._sessionStartTrackedUnreadCounter);(0,d.reactToChangesInUnread)({totalUnreadGt:i,totalMsgGt:j,trackedUnreadGt:k,trackedMsgGt:l,totalUnreadEq:m,totalMsgEq:n,trackedUnreadEq:o,trackedMsgEq:p,isPageVisible:this._isPageVisible},function(){return c.onNewMessagesInInactiveTab(q)},function(){return c.onChangeInMessages(q)});this._prevTrackedMsgCounter=h;this._prevTrackedUnreadCounter=g;this._prevTotalMsgCounter=f;this._prevTotalUnreadCounter=e}});exports.default=j});define("service/mailbox/on-status/unread-messages-notifications.setup",["exports","@mail/features","@mail/flags","../../../lazy.modules","service/mailbox/on-status/unread-messages-notifications","service/radars/index"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=j(a);var g=j(b);var h=j(d);var i=j(e);function j(a){return a&&a.__esModule?a:{default:a}}var k=void 0;function l(){var a=f.default.get("unread-messages-notification");return a&&a.state&&a.data}exports.default={test:function a(){return l()},setup:function a(){var b=l().split(":");var d=b[0]===void 0?2e3:+b[0];var e=b[1]===void 0?3e4:+b[1];var f=!!(b[2]===void 0?false:+b[2]);var j=!!(b[3]===void 0?false:+b[3]);var m=!!(b[4]===void 0?false:+b[4]);function n(){var a=g.default.get("sound-notifications");var b=!!(a.state===void 0?f:a.state);var c=!!(a.state===void 0?m:a.getCount("close")%2);var d=!!(a.state===void 0?j:a.getCount("show")%2);return{enabled:b,sound:c,onlyInbox:d}}k=new h.default({titleBlinkingTimeout:d,soundPlayingTimeout:e,getState:n});var o=n();(0,c.lazyMediatorPageTitle)().then(function(a){var b=a.default;b.register(k)});(0,i.default)({chain:["tabnotification_mail_feature_"+(o.enabled?"on":"off")],intervals:[["add",1]]});(0,i.default)({chain:["tabnotification_mail_sound_"+(o.sound?"on":"off")],intervals:[["add",1]]});(0,i.default)({chain:["tabnotification_mail_inbox_"+(o.onlyInbox?"on":"off")],intervals:[["add",1]]})},handle:function a(){if(k){k.handleUpdate.apply(k,arguments)}}}});define("service/mailbox/listeners",["exports","service/mailbox/loader","service/mailbox/on-status/unread-messages-notifications.setup"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){f.filter(function(a){var b=!a.test||a.test();if(b&&a.setup){a.setup()}return b});f.forEach(function(a){c.default.on("data",a.handle)})};var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=[d.default]});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/subscriptions/mailbox",["require","exports","@mail/features","helpers/object-to-query","logger","mrg-message-broker/Subscription/Subscription","RPC"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);function f(a){var d=e.default.setup("email");var f=e.default.setup("token");var g={};a=a||{};if(!a.logScope){a.logScope="mailboxSubscription"}if(a.endpoint){a.endpoint+="?"}else{a.endpoint=location.host+"/api-proxy/notifier/v1/ws?"}if(!a.system){this.system="storage"}this.event=a.event;if(d){g.email=d}if(f){g.token=f}a.endpoint+=(0,b.default)(g,true);this.options=a;this.log=c.default.getScope("subscription/Mailbox")}Object.assign(f.prototype,{_rev:null,_sub:null,subscribe:function(){var a=this;var b=this.options;if(this._sub){this.log.add("destroy old subscription");this._sub.destroy();this._sub=null}if(!this.isSupport()){this.log.add("subscription is not supported by client");return false}var c=new URL(b.endpoint,window.location.origin);c.searchParams.delete("token");this.log.add("connect to",c.toString());this._sub=new d.default("wss://"+b.endpoint,b);this._sub.onActivate=function(){return a.onActivate()};this._sub.onDeactivate=function(){return a.onDeactivate()};return true},isSupport:function(){if(!this._rev||!this._rev.revision||!this._rev.checksum){this.log.add("client revision is empty");return false}return d.default.isSupport()},onActivate:function(){var a=this;this.log.add("create subscription",this.system);this._sub.create(this.system,this.event)["catch"](function(b){return a.onError(b)});this._sub.on("storage.change",function(b){return a._handle(b)}).on("sync",function(){return a._handle("sync")}).on("attached",function(){return a._handle("attached")}).on("detached",function(){return a._handle("detached")})},onDeactivate:function(){},onDetached:function(){},onAttached:function(){},onError:function(a){this.log.add("mailbox fetch revision error",a)},onMailbox:function(a){this.log.add("get new notification",a)},setRevision:function(b){var c=a.default.get("test_threads_revision");var d=null;var e;if(c){if(typeof c.data!=="string"){c.data=c.data[0]}if(typeof c.data==="string"){e=c.data.split(",")}d={revision:e[0],checksum:e[1]}}if(b&&b.revisions&&b.revisions[this.system]){d=b.revisions[this.system];this.log.add("set new revision",d)}this._rev=d},_handle:function(a){if(a==="sync"){this.onMailbox()}else if(a==="detached"){this.onDetached()}else if(a==="attached"){this.onAttached()}else if(a.revision_last!==this._rev.revision&&a.checksum_last!==this._rev.checksum){this.onMailbox()}else{this.log.add("client has actual data")}}});exports.default=f});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/subscriptions/mailbox.setup",["require","exports","@mail/features","default-values","helpers/date-alias","logger","service/mailbox/loader","service/radars/index","service/subscriptions/mailbox","utils/util"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);var i=function(){return document.visibilityState==="visible"};function j(){var j=a.default.has("threads_polling_disabled");var k=a.default.getAsArray("async_notify",[],"|");var l=a.default.getAsInt("keepalive_timeout_min_config_value",1e4);var m=a.default.get("async_notify_throttle");var n=a.default.has("async_notify_v2");var o={};var p=1e3;if(k.length>0){var q="//"+k[0];if(k.length>=2&&q){o.endpoint=q;var r=+k[1];if(r===0||r>=l){o.keepalive={timeout:r}}var s=+k[3];var t=+k[4];if(isNaN(s)||isNaN(t)||s<1e3){s=(0,c.second)(10);t=(0,c.minute)(5)}if(s>t){t=s}var u=Math.ceil(s+(t-s)*Math.random());o.retry={number:+k[2],timeout:u}}o.event="change";o.version=n?2:1}if(m&&m.data){var v=parseInt(m.data,10);p=isNaN(v)||v<500?500:v}var w=new g.default(o);var x=Date.now();function y(){x=Date.now();e.default.emit("websocket:reload")}var z=h.default.throttle(y,p);var A=function(){var a=null;var c=false;return{start:function(){if(a!==null){return}c=true;if(b.POLLING_ONLY_VISIBLE&&!i()){return}d.default.add("start polling");var e=b.STATUS_AUTO_CALL*1e3;a=window.setInterval(y,e);if(Date.now()-x>e){y()}},stop:function(b,e){if(b===void 0){b="stop polling"}if(e===void 0){e=false}c=e;if(a===null){return}d.default.add(b);window.clearInterval(a);a=null},get isActive(){return a!==null},get waitStartAfterVisible(){return c}}}();if(b.POLLING_ONLY_VISIBLE){var B=function(){if(!i()){A.stop(undefined,A.isActive)}else if(A.waitStartAfterVisible){A.start()}};B();document.addEventListener("visibilitychange",B)}function C(){if(w.connected||!w.isSupport()||!a.default.has("async_notify")){return}if(j){A.stop()}w.subscribe();w.connected=true}Object.assign(w,{onDeactivate:function(){w.connected=false;A.start()},onMailbox:function(){if(A.isActive){A.stop("update polling timeout");A.start()}z()},onDetached:function(){if(j){A.start()}},onAttached:function(){if(j){A.stop()}z()},onError:function(a){e.default.emit("websocket:disconnected");if(a&&a.code){(0,f.default)({chain:["notifier","error"],intervals:[[String(Math.abs(a.code)),"1"]]})}}});if(!j){A.start()}e.default.on("data",function(a){w.setRevision(a);C()});w.setRevision(e.default.revision||{});C()}exports.default=j});define("service/mailbox/setup",["exports","@mail-core/dashboard","service/ads-off","service/mailbox/listeners","service/subscriptions/mailbox.setup"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(c){if(!h){h=a.userKeeper.group("app-source-setup",function(){(0,e.default)(c);(0,f.default)(c);(0,b.sendAdsOffTargetGroup)();return Promise.resolve()})}return h};var e=g(c);var f=g(d);function g(a){return a&&a.__esModule?a:{default:a}}var h=void 0});define("data-source/source/setup",["exports","service/mailbox/setup"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}exports.default={fetch:function a(c){return(0,b.default)(c.router)}}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/letters-loader/index",["require","exports","@mail/xray","../../helpers/fast-deep-equal"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LettersLoader=void 0;a=__importDefault(a);b=__importDefault(b);var c=function(){function c(a,b){this.context=a;this.service=b;this._updateNeeded=false;this.promise=Promise.resolve({context:__assign({},this.context)});this.tryHandleSecureOpenError=this.tryHandleSecureOpenError.bind(this)}c.prototype.doRequest=function(a){var b=this;this.promise=this.promise.then(function(c){var d=c.context;return b.service.doRequest(b.context,a).then(function(a){return{context:d,response:a}}).catch(function(a){throw{error:a,context:d}})})};c.prototype.deriveContext=function(a){this.promise=this.promise.then(function(b){var c=b.response,d=b.context;return{response:c,context:a(c,d)}})};c.prototype.catchError=function(a){this.promise=this.promise.catch(function(b){var c=b.error,d=b.context;return{response:undefined,context:a(c,d)}})};c.prototype.getSecureFolderNotOpenResponse=function(a){return __assign(__assign({},a),{folder:a.folder||0,letters:[],lettersTotal:0,lastUpdateTime:this.service.getCurrentTS()})};c.prototype.tryHandleSecureOpenError=function(a,b){if(this.service.isSecureFolderNotOpenError(a)){return this.getSecureFolderNotOpenResponse(b)}throw a};c.prototype.setUpdateNeeded=function(a){this._updateNeeded=a};c.prototype.isUpdateNeeded=function(a){return!!(this._updateNeeded||a.folder!==this.context.folder||!(0,b.default)(a.filters,this.context.filters)||!(0,b.default)(a.sort,this.context.sort))};c.prototype.run=function(){return this.promise.then(function(a){var b=a.context;return b})};c.prototype.immediateContext=function(){return this.context};c.prototype.waitFor=function(a){this.promise=this.promise.then(function(b){return a.then(function(){return b})})};c.prototype.remove=function(a,b){var c=this;this.deriveContext(function(d,e){var f=[];var g={};for(var h=0,i=a;h<i.length;h++){var j=i[h];g[j]=true}for(var k=0,l=c.context.letters;k<l.length;k++){var m=l[k];if(g[m.id]){b(m)}else{f.push(m)}}return __assign(__assign({},e),{letters:f})})};c.prototype._sendThreadsStatusSmartRadar=function(b){if(!b){return}var c=b.length;var d=0;var e=0;var f=0;b.forEach(function(a){var b,c;var g=(b=a===null||a===void 0?void 0:a.flags)===null||b===void 0?void 0:b.unread;var h=(c=a===null||a===void 0?void 0:a.flags)===null||c===void 0?void 0:c.is_relevant;if(g){d++}if(h){e++}if(g&&h){f++}});a.default.send("threads_status_smart",{dwh:{count:c,priority_count:e,has_priority_letters:e>0,unread_count:d,priority_unread_count:f,has_priority_unread_letters:f>0}})};return c}();exports.LettersLoader=c});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("data-source/letters-loader/paginator",["require","exports","./index"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PaginatorLoader=void 0;var b=function(a){__extends(b,a);function b(b,c){var d=this;var e=false;if(b.page===undefined){b.page=1;b.letters=[];e=true}d=a.call(this,b,c)||this;d.setUpdateNeeded(e);return d}b.prototype.empty=function(a){this.context={folder:a.folder,folders:this.service.getAllFolders(),filters:a.filters,sort:a.sort,letters:[],discounts:[],collectors:[],lastUpdateTime:this.service.getCurrentTS(),lettersTotal:0,persistThreadId:undefined,isLastPage:false,threadMeta:{currentId:undefined,changed:true},page:1}};b.prototype.navigate=function(a){var b=this;var c=a.folder,d=a.filters,e=a.sort;if(!this.isUpdateNeeded(a)){this.update(a);return}var f=this.service.getListLimit()*2+1;this.doRequest({folder:c,offset:0,limit:f,filters:d,sort:e});this.deriveContext(function(g,h){var i;if(b.service.isActionLocked()){return h}var j={currentId:a.thread,changed:false};return __assign(__assign({},h),{folder:c,filters:d,sort:e,folders:b.service.mapFolders(g.folders),collectors:b.service.mapCollectors(g.collectors),letters:b.service.mapThreads(g.threads,j,0),lettersTotal:g.threadsTotal,mboxSize:g.mboxSize,lastUpdateTime:b.service.getCurrentTS(),discounts:b.service.mapMessages((i=g.discounts)===null||i===void 0?void 0:i.messages),threadMeta:j,page:1,isLastPage:g.threads.length!==f})});this.deriveContext(function(a,c){b.service.unreadMessagesNotificationsFix(c);return c});this.catchError(this.tryHandleSecureOpenError)};b.prototype.update=function(a){var b=a.folder;if(this.isUpdateNeeded(a)){this.navigate(a);return}this.loadPage(__assign(__assign({},a),{page:this.context.page,folder:b}),true)};b.prototype.loadMore=function(a){var b=a.folder;if(this.isUpdateNeeded(a)){this.navigate(a);return}this.loadPage(__assign(__assign({},a),{page:this.context.page+1,folder:b}))};b.prototype.loadPage=function(a,b){var c=this;if(b===void 0){b=false}var d=a.page;var e=a.filters,f=a.sort;if(this.isUpdateNeeded(a)){this.navigate(a);return}var g=!b&&d<this.context.page?this.context.lettersTotal:undefined;var h=this.service.getListLimit();var i=Math.max((d-1)*h-1,0);var j=this.service.getListLimit()*2+1;this.doRequest({folder:this.context.folder,offset:i,limit:j,filters:e,sort:f});this.deriveContext(function(b,h){var k;if(c.service.isActionLocked()){return h}var l=!!b.threads.length;if(!l){d=c.context.page}var m={currentId:a.thread,changed:false};c._sendThreadsStatusSmartRadar(b.threads);return __assign(__assign({},h),{filters:e,sort:f,folder:c.context.folder,folders:c.service.mapFolders(b.folders),collectors:c.service.mapCollectors(b.collectors),letters:c.service.mapThreads(b.threads,m,i),lastUpdateTime:c.service.getCurrentTS(),discounts:c.service.mapMessages((k=b.discounts)===null||k===void 0?void 0:k.messages),lettersTotal:g!==undefined?g:b.threadsTotal,mboxSize:b.mboxSize,page:d,threadMeta:m,isLastPage:b.threads.length!==j})});this.deriveContext(function(a,b){c.service.unreadMessagesNotificationsFix(b);return b});this.catchError(this.tryHandleSecureOpenError)};b.prototype.getSecureFolderNotOpenResponse=function(b){return __assign(__assign({},a.prototype.getSecureFolderNotOpenResponse.call(this,b)),{page:1,isLastPage:true})};return b}(a.LettersLoader);exports.PaginatorLoader=b});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("data-source/letters-loader/status",["require","exports","./index"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.StatusLoader=void 0;var b=function(a){__extends(b,a);function b(b,c){var d=this;var e=false;if(b.page!==undefined){delete b.page;b.letters=[];e=true}d=a.call(this,b,c)||this;d.setUpdateNeeded(e);return d}b.prototype.empty=function(a){this.context={folder:a.folder,filters:a.filters,sort:a.sort,folders:this.service.getAllFolders(),letters:[],discounts:[],collectors:[],lastUpdateTime:this.service.getCurrentTS(),lettersTotal:0,persistThreadId:undefined,isLastPage:false,threadMeta:{currentId:undefined,changed:true}}};b.prototype._navigateWithoutErrorHandling=function(a){var b=this;var c=a.folder,d=a.filters,e=a.sort;if(!this.isUpdateNeeded(a)){this.update(a);return}var f=this.service.getListLimit();this.doRequest({folder:c,offset:0,limit:f,filters:d,sort:e});this.deriveContext(function(g,h){var i;if(b.service.isActionLocked()){return h}var j={currentId:a.thread,changed:false};b._sendThreadsStatusSmartRadar(g.threads);return __assign(__assign({},h),{folder:c,filters:d,sort:e,folders:b.service.mapFolders(g.folders),sharedMailboxes:b.service.mapSharedMailboxes(g.userGrants),collectors:b.service.mapCollectors(g.collectors),letters:b.service.mapThreads(g.threads,j,0),lettersTotal:g.threadsTotal,mboxSize:g.mboxSize,lastUpdateTime:b.service.getCurrentTS(),isLastPage:g.threads.length!==f,discounts:b.service.mapMessages((i=g.discounts)===null||i===void 0?void 0:i.messages),threadMeta:j})})};b.prototype.navigate=function(a){this._navigateWithoutErrorHandling(a);this.catchError(this.tryHandleSecureOpenError)};b.prototype._updateWithoutErrorHandling=function(a){var b=this;var c=a.filters,d=a.sort;if(this.isUpdateNeeded(a)){this.navigate(a);return}var e=this.service.getListLimit();this.doRequest({folder:this.context.folder,offset:0,limit:e,filters:c,sort:d});this.deriveContext(function(c,d){var f;if(b.service.isActionLocked()){return d}var g={currentId:a.thread,changed:false};b._sendThreadsStatusSmartRadar(c.threads);return __assign(__assign({},d),{folders:b.service.mapFolders(c.folders),sharedMailboxes:b.service.mapSharedMailboxes(c.userGrants),collectors:b.service.mapCollectors(c.collectors),lettersTotal:c.threadsTotal,mboxSize:c.mboxSize,lastUpdateTime:b.service.getCurrentTS(),isLastPage:c.threads.length!==e,discounts:b.service.mapMessages((f=c.discounts)===null||f===void 0?void 0:f.messages),letters:b.service.mergeThreadLists(b.context.letters,b.service.mapThreads(c.threads,g,0),{offset:0,limit:b.service.getListLimit(),persistThread:d.persistThreadId}),threadMeta:g})})};b.prototype.update=function(a){this._updateWithoutErrorHandling(a);this.catchError(this.tryHandleSecureOpenError)};b.prototype.loadMore=function(a){var b=this;var c=a.filters,d=a.sort;if(this.isUpdateNeeded(a)){this.navigate(a);return}var e=this.service.getListLimit();this.doRequest({folder:this.context.folder,offset:this.context.letters.length,limit:e,filters:c,sort:d});this.deriveContext(function(c,d){var f;if(b.service.isActionLocked()){return d}var g={currentId:a.thread,changed:false};b._sendThreadsStatusSmartRadar(c.threads);return __assign(__assign({},d),{folder:d.folder,folders:b.service.mapFolders(c.folders),sharedMailboxes:b.service.mapSharedMailboxes(c.userGrants),collectors:b.service.mapCollectors(c.collectors),letters:b.service.concatThreadLists(d.letters,b.service.mapThreads(c.threads,g,d.letters.length)),lettersTotal:c.threadsTotal,mboxSize:c.mboxSize,lastUpdateTime:b.service.getCurrentTS(),isLastPage:c.threads.length!==e,discounts:b.service.mapMessages((f=c.discounts)===null||f===void 0?void 0:f.messages),threadMeta:g})});this.catchError(this.tryHandleSecureOpenError)};return b}(a.LettersLoader);exports.StatusLoader=b});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();define("data-source/letters-loader/status-with-legacy-notify",["require","exports","./status"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.StatusWithLegacyNotifyLoader=void 0;var b=function(a){__extends(b,a);function b(){return a!==null&&a.apply(this,arguments)||this}b.prototype.navigate=function(b){var c=this;a.prototype._navigateWithoutErrorHandling.call(this,b);this.deriveContext(function(a,b){if(a){c.service.unreadMessagesNotificationsFix(b)}return b});this.catchError(this.tryHandleSecureOpenError)};b.prototype.update=function(b){var c=this;a.prototype._updateWithoutErrorHandling.call(this,b);this.deriveContext(function(a,b){c.service.unreadMessagesNotificationsFix(b);return b});this.catchError(this.tryHandleSecureOpenError)};b.prototype.loadMore=function(b){var c=this;a.prototype.loadMore.call(this,b);this.deriveContext(function(a,b){c.service.unreadMessagesNotificationsFix(b);return b})};return b}(a.StatusLoader);exports.StatusWithLegacyNotifyLoader=b});define("data-source/source/status",["exports","@mail-core/dashboard","data-source/actions","data-source/letters-loader/paginator","data-source/letters-loader/status","data-source/letters-loader/status-with-legacy-notify","data-source/match/match","data-source/utils","data-source/utils/paginator","route/utils/filter-query"],function(exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.emptyStatusFromRequest=o;var j=l(f);var k=l(i);function l(a){return a&&a.__esModule?a:{default:a}}function m(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++){c[b]=a[b]}return c}else{return Array.from(a)}}var n=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function o(a){var b=(0,h.isPaginatorGlobalEnabled)(a.router)?new c.PaginatorLoader({},g.lettersLoaderIntegrationService):new d.StatusLoader({},g.lettersLoaderIntegrationService);b.empty({thread:a.params&&a.params.letter,folder:a.folder,filters:k.default.get(),sort:k.default.getSorting()});return b.immediateContext()}exports.default={match:(0,j.default)(["#attachment","#attachment-editor"]).exclude,fetch:function d(f,i,j,l){var o=(0,g.getStore)();var p=o.search;var q=j&&j.type;var r=f&&f.route&&f.route.is("#search #search-letter");var s=l&&l.status||{};var t=Promise.all([i("setup"),i("uiThreadsSettings")]);var u=(0,g.prevStatusIfActionLocked)(l);if(u){return u}var v=k.default.get();var w=k.default.getSorting();var x=parseInt(f.params.folder,10)||0;return a.userKeeper.group("app-fetch-status",function(){return t.then(function(a){var d=n(a,2),i=d[0],k=d[1];var o=(0,h.isPaginatorEnabled)(f.router,k)?new c.PaginatorLoader(s,g.lettersLoaderIntegrationService):new e.StatusWithLegacyNotifyLoader(s,g.lettersLoaderIntegrationService);if(!l||!l.status){o.navigate({thread:f.params.letter,filters:v,sort:w,folder:r?0:x});return o.run()}switch(q){case b.LOAD_MORE:if(j.prev){o.loadPage({page:(o.immediateContext().page||1)-1,folder:x,filters:v,sort:w,thread:f.params.letter})}else{o.loadMore({folder:x,filters:v,sort:w,thread:f.params.letter})}break;case b.LOAD_PAGE:o.loadPage({page:j.page,folder:x,filters:v,sort:w,thread:f.params.letter});break;case b.TOGGLE_THREADS_SETTING:case b.TOGGLE_METATHREADS_SETTING:case b.CHANGE_METATHREADS_SETTING:case b.TOGGLE_TO_MYSELF_METATHREAD:case b.EDIT_METATHREADS_SETTINGS:case b.TOGGLE_METATHREADS_SETTINGS:case b.HIDE_PRIORITY_MESSAGES:case b.CLOSE_PRIORITY_MESSAGES:case b.UPDATE_ALL:o.update({folder:x,filters:v,sort:w,thread:f.params.letter});break;case b.NAVIGATE:if(p&&!f.is("#search")&&!f.is("#search-letter")){p.clear()}o.navigate({filters:v,sort:w,folder:r?0:x,thread:f.params.letter});break;case b.DESTROY_THREADS_AND_MESSAGES:{var t=[].concat(m(j.models.messages),m(j.models.threads));o.remove(t.map(function(a){return a.id}),function(a){(0,g.destroyThreadOrMessage)(a)});break}case b.EXECUTE_JSSDK_ACTION:{return(0,g.prevStatus)(l)}default:{var u={folder:x,filters:v,sort:w,thread:f.params.letter};if(o.isUpdateNeeded(u)){o.update(u)}break}}return o.run()})},{score:"fetch",appendix:!q?"no-act":"act"})}}});define("data-source/source/suggest-search",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={match:["#search","#search-letter"],fetch:function a(b,c){return c("search").then(function(a){if(a&&a.query){return{suggestQuery:a.extraSuggestSearchQuery,baseQuery:a.query.query}}})}}});define("data-source/utils/letter-list-virtualization",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getOneLineLetterHeight=exports.getGenericItemHeight=exports.HEIGHT_3PANE_ONELINE=exports.HEIGHT_GENERIC_3PANE_PONY=exports.HEIGHT_GENERIC_3PANE=exports.HEIGHT_GENERIC_2PANE_PONY=exports.HEIGHT_GENERIC_2PANE=void 0;exports.HEIGHT_GENERIC_2PANE=48;exports.HEIGHT_GENERIC_2PANE_PONY=40;exports.HEIGHT_GENERIC_3PANE=100;exports.HEIGHT_GENERIC_3PANE_PONY=82;exports.HEIGHT_3PANE_ONELINE=exports.HEIGHT_GENERIC_3PANE_PONY;function a(a,b){if(a){if(b){return exports.HEIGHT_GENERIC_3PANE_PONY}return exports.HEIGHT_GENERIC_3PANE}if(b){return exports.HEIGHT_GENERIC_2PANE_PONY}return exports.HEIGHT_GENERIC_2PANE}exports.getGenericItemHeight=a;function b(b,c){if(b&&!c){return exports.HEIGHT_3PANE_ONELINE}return a(b,c)}exports.getOneLineLetterHeight=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("feast-mod/letter-date",["require","exports","@mail/xray","cfg","cfgUser","default-values","helpers/date-alias","router","utils/util","./utils"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.scheduleDate=exports.getLocaleDateFull=exports.letterDate=exports.letterMonthYearDate=exports.letterMonthDate=exports.letterHours=exports.letterAttachLinkDate=exports.getCorrectedTimestampMS=exports.getCorrectedTimestamp=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var i=null;var j=null;var k=null;var l=155e10;var m=(0,e.day)(1);function n(a){a=parseInt(a,10);if(typeof i==="number"){return a+i}if(d.DISABLE_TIME_CORRECTION){return a}var e=c.default.get("initialUser")||{};j=typeof e.timezone_autodetect==="boolean"?e.timezone_autodetect:true;if(j===true){var f=b.default.clientTimestamp-(d.DEBUG_SERVER_TIMESTAMP>0?d.DEBUG_SERVER_TIMESTAMP:b.default.serverTimestamp);if(f>m||d.IGNORE_LOCAL_TIME){f=0}i=Math.round(f/1e4)*10}else{i=e.timezone_offset+(new Date).getTimezoneOffset()*60;k=e.timezone_offset}return a+i}exports.getCorrectedTimestamp=n;var o=function(a){return n(Math.round(a/1e3))*1e3};exports.getCorrectedTimestampMS=o;var p=function(a){return(0,h.formatDate)(new Date(n(a)*1e3),[["day","numeric"],["month","long"],["year","numeric"],["hour","numeric"],["minute","2-digit"]],{literalBefore:{hour:", "}})};exports.letterAttachLinkDate=p;var q=function(a){return a?(0,h.formatDate)(new Date(a),[["hour","numeric"],["minute","2-digit"]]):""};exports.letterHours=q;var r=function(a){try{if(a instanceof Date){var b=(0,exports.getCorrectedTimestampMS)(a.getTime());return new Date(b)}else if((0,g.isPositiveNumber)(a)){a=n(a)*1e3;return new Date(a)}else{return null}}catch(a){return null}};var s=function(a,b,c){var d=r(a);return d instanceof Date?(0,h.formatDate)(d,[["day","numeric"],["month","long"],["year",c?"numeric":undefined]]).replace(/([^\d\s]{3})[^\d\s]+/,b?"$&":"$1"):""};var t=function(a,b){return s(a,b,false)};exports.letterMonthDate=t;var u=function(a,b){return s(a,b,true)};exports.letterMonthYearDate=u;var v=function(a){return(new Date).getFullYear()===a.getFullYear()};function w(c,e){var g=false;var m=null;try{var o=(0,f.getAppRouter)().route.model;g=o.folder&&o.folder.isOutbox();m=o.folder&&o.folder.id}catch(a){}var p=c;c=(e?c:n(c))*1e3;var q=j?new Date:new Date((0,exports.getCorrectedTimestampMS)(Date.now()));var r=new Date(c);function s(a){return(0,h.formatDate)(a,[["day","numeric"],["month","long"]]).replace(/([^\d\s]{3})[^\d\s]+/,"$1")}var t=s(r);var u=s(q);if(!g){var w=d.LETTER_FROM_FUTURE_THRESHOLD_TIMESTAMP>l&&c>d.LETTER_FROM_FUTURE_THRESHOLD_TIMESTAMP;var x=d.LETTER_FROM_FUTURE_LOG_DATES.includes(t);if(w||x){var y={};if(w){y.dff=1}if(x){y.dill=1}var z={i:y};if(d.LETTER_FROM_FUTURE_LOG_KAKTAM){y.kaktam=1;z.rlog="octavius_future_date";z.rlog_message={isDateFromFuture:w,isDateInLogList:x,originalTimeValue:p,time:c,now:q,date:r,dateFormatted:t,nowFormatted:u,clientTimestamp:b.default.clientTimestamp,serverTimestamp:b.default.serverTimestamp,xHost:b.default.xHost,timezoneOffset:i,timezoneAutodetectSetting:j,userTimezoneOffsetFromSettings:k,getTimezoneOffset:(new Date).getTimezoneOffset()*60,folderId:m,href:window.location.href,dateNow:Date.now()}}a.default.send("future-date",z)}}if(!v(r)){return(0,h.formatDate)(r,[["day","2-digit"],["month","2-digit"],["year","2-digit"]])}if(t===u){return(0,exports.letterHours)(c)}return t}exports.letterDate=w;var x=function(a){return(0,h.isToday)(new Date(a.getFullYear(),a.getMonth(),a.getDate()+1))};function y(a){var b=(0,h.isToday)(a);if(b||x(a)){return(0,h.capitalize)(b?h.NAMED_DAYS.TODAY:h.NAMED_DAYS.YESTERDAY)+", "+(0,h.formatDate)(a,[["hour","numeric"],["minute","2-digit"]])}return(0,h.formatDate)(a,[["day","numeric"],["month","long"],["year",v(a)?undefined:"numeric"],["hour","numeric"],["minute","2-digit"]],{literalBefore:{hour:", "}})}var z=function(a,b){return y(new Date((b?a:n(a))*1e3))};exports.getLocaleDateFull=z;var A=function(a){return i18n("Письмо будет отправлено {date}",{date:(0,h.capitalize)(y(new Date(n(a)*1e3)))})};exports.scheduleDate=A});define("models/dataset-model/dataset-model",["exports","Model"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}function d(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:true,configurable:true,writable:true})}else{a[b]=c}return a}var e=b.default.extend({className:"models.DatasetModel",getPaymentMeta:function a(){return undefined}});e.createModel=function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:e;var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"datasetModel";var f=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"datasetModel";var g=b.all.get(c);if(!g){g=new b;g.set(d({id:c,datasetModel:true},f,true));b.all.set([g])}return g};e.isDatasetModel=function a(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"datasetModel";return b.is(c)};exports.default=e});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("models/letters-list-divider/letters-list-divider",["require","exports","models/dataset-model/dataset-model"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.dividerModelLabel=void 0;a=__importDefault(a);exports.dividerModelLabel="dividerModel";var b=a.default.extend({className:"models.DividerModel"});b.createDividerLetter=function c(d,e,f,g){var h=a.default.createModel(b,"divider-".concat(d),exports.dividerModelLabel);h.set("title",e);h.set("counter",f);h.set("meta",g);return h};b.isDivider=function b(c){return a.default.isDatasetModel(c,exports.dividerModelLabel)};exports.default=b});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __rest=this&&this.__rest||function(a,b){var c={};for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0)c[d]=a[d];if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++){if(b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e]))c[d[e]]=a[d[e]]}return c};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/dividerInserters",["require","exports","@mail/flags","feast-mod/letter-date","models/letters-list-divider/letters-list-divider"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.alphabetSubjectInserter=exports.alphabetFromInserter=exports.alphabetToInserter=exports.getLatestWithMonthsInserter=exports.createLatestWithMonthsInserter=exports.getMonthInserter=exports.createMonthInserter=exports.getLatestInserter=exports.createLatestInserter=exports.noopInserter=exports.insertDividers=exports.setDividersEnabled=exports.getDividersEnabled=exports.LETTERS_LIST_DIVIDERS_DISABLED_FLAG=void 0;a=__importDefault(a);c=__importStar(c);exports.LETTERS_LIST_DIVIDERS_DISABLED_FLAG="letters-list-dividers-disabled";var d=function(){var b,c;return!((c=(b=a.default.get(exports.LETTERS_LIST_DIVIDERS_DISABLED_FLAG))===null||b===void 0?void 0:b.isActive)===null||c===void 0?void 0:c.call(b))};exports.getDividersEnabled=d;var e=function(b){var c,d,e;return(e=(d=(c=a.default.get(exports.LETTERS_LIST_DIVIDERS_DISABLED_FLAG))===null||c===void 0?void 0:c.save)===null||d===void 0?void 0:d.call(c,{state:!b}))!==null&&e!==void 0?e:Promise.reject()};exports.setDividersEnabled=e;var f=function(a,b){var d=a.flatMap(b);var e=0;d.forEach(function(a){if(a.is(c.dividerModelLabel)){a.set("idx",e);e+=1}});return d};exports.insertDividers=f;var g=function(a){return a};exports.noopInserter=g;var h=function(a){var b=new Date(a);return{year:b.getFullYear(),month:b.getMonth(),day:b.getDate()}};var i=function(){var a=[];for(var b=0;b<arguments.length;b++){a[b]=arguments[b]}return(new(Date.bind.apply(Date,__spreadArray([void 0],a,false)))).getTime()};var j={today:i18n("Сегодня"),yesterday:i18n("Вчера"),week:i18n("Неделя"),aboveWeek:i18n("Старше недели")};var k={today:"today",yesterday:"yesterday",week:"week",aboveWeek:"older_week"};var l=function(a){var b=a.todayStart,c=a.yesterdayStart,d=a.weekStart;var e=function(a){if(a>=b){return"today"}if(a>=c){return"yesterday"}if(a>=d){return"week"}return"aboveWeek"};var f=function(a,b){var c=e(a);var d=e(b);if(c!==d){return d}return null};return{getTimeOf:e,getNext:f}};var m=function(a,b,c){var d=b(a(Date.now()));return{todayStart:c(d.year,d.month,d.day),yesterdayStart:c(d.year,d.month,d.day-1),weekStart:c(d.year,d.month,d.day-7)}};var n=function(a){return a*1e3};var o=function(){var a=[];for(var b=0;b<arguments.length;b++){a[b]=arguments[b]}var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=g.getTimeOf,i=g.getNext,l=a[5];var m=f(n(c.get("date")));var o=e[d-1]&&f(n(e[d-1].get("date")));var p=o==null||l!=null&&l?h(m):i(o,m);if(p){return{title:j[p],id:p,meta:{type:"latest",when:k[p]}}}return null};var p=function(a){var b=a.processTime,d=__rest(a,["processTime"]);var e=l(d);return function(a){var d=[];for(var f=1;f<arguments.length;f++){d[f-1]=arguments[f]}var g=o.apply(void 0,__spreadArray(__spreadArray([a],d,false),[b,e],false));if(!g){return a}return[c.default.createDividerLetter(g.id,g.title,null,g.meta),a]}};exports.createLatestInserter=p;var q=function(){return(0,exports.createLatestInserter)(__assign(__assign({},m(b.getCorrectedTimestamp,h,i)),{processTime:b.getCorrectedTimestamp}))};exports.getLatestInserter=q;var r=function(a,b){return a.month===b.month&&a.year===b.year};var s=[i18n("Январь"),i18n("Февраль"),i18n("Март"),i18n("Апрель"),i18n("Май"),i18n("Июнь"),i18n("Июль"),i18n("Август"),i18n("Сентябрь"),i18n("Октябрь"),i18n("Ноябрь"),i18n("Декабрь")];var t=function(){var a=[];for(var b=0;b<arguments.length;b++){a[b]=arguments[b]}var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5];var i=e[d-1];var j=i&&g(f(n(i.get("date"))));var k=i&&{month:j.month,year:j.year};var l=g(f(n(c.get("date"))));var m={month:l.month,year:l.year};var o=null;if(h!=null&&h||!k||!r(m,k)){o="".concat(s[m.month]," ").concat(m.year)}if(o!=null){return{id:"".concat(m.month,"_").concat(m.year),title:o,meta:{type:"month",date:l}}}return null};var u=function(a){var b=a.processTime,d=a.dateFromTime;return function(a){var e=[];for(var f=1;f<arguments.length;f++){e[f-1]=arguments[f]}var g=t.apply(void 0,__spreadArray(__spreadArray([a],e,false),[b,d],false));if(!g){return a}return[c.default.createDividerLetter(g.id,g.title,null,g.meta),a]}};exports.createMonthInserter=u;var v=function(){return(0,exports.createMonthInserter)({processTime:b.getCorrectedTimestamp,dateFromTime:h})};exports.getMonthInserter=v;var w=function(a){var b=a.weekStart,d=a.processTime,e=a.dateFromTime,f=__rest(a,["weekStart","processTime","dateFromTime"]);var g=l(__assign({weekStart:b},f));var h=false;var i=false;return function(a){var f=[];for(var j=1;j<arguments.length;j++){f[j-1]=arguments[j]}var k=d(n(a.get("date")));var l=null;if(k>=b){l=o.apply(void 0,__spreadArray(__spreadArray([a],f,false),[d,g,!i],false));i=true}else{l=t.apply(void 0,__spreadArray(__spreadArray([a],f,false),[d,e,!h],false));h=true}if(!l){return a}return[c.default.createDividerLetter(l.id,l.title,null,l.meta),a]}};exports.createLatestWithMonthsInserter=w;var x=function(){return(0,exports.createLatestWithMonthsInserter)(__assign(__assign({},m(b.getCorrectedTimestamp,h,i)),{processTime:b.getCorrectedTimestamp,dateFromTime:h}))};exports.getLatestWithMonthsInserter=x;var y=function(a){if(!a){return null}var b=a.name,c=a.email;return b?b:c};var z=function(a){if(!a){return null}var b=a[Symbol.iterator]().next(),c=b.value,d=b.done;if(!c||d){return null}return c.toUpperCase()};var A=function(a,b,d){if(a.is("flags.metathread")){return a}var e=d[b-1];var f=z(y(a.get("correspondents").to[0]));var g=e&&!e.is("flags.metathread")&&z(y(e.get("correspondents").to[0]));if(b===0||e.is("flags.metathread")||f!==g){return[c.default.createDividerLetter(f||"noauthor",f||i18n("Автор не указан"),null,{type:"alpha_to",alpha:f}),a]}return a};exports.alphabetToInserter=A;var B=function(a,b,d){if(a.is("flags.metathread")){return a}var e=d[b-1];var f=z(y(a.get("correspondents").from[0]));var g=e&&!e.is("flags.metathread")&&z(y(e.get("correspondents").from[0]));if(b===0||e.is("flags.metathread")||f!==g){return[c.default.createDividerLetter(f||"noauthor",f||i18n("Автор не указан"),null,{type:"alpha_from",alpha:f}),a]}return a};exports.alphabetFromInserter=B;var C=function(a,b,d){if(a.is("flags.metathread")){return a}var e=d[b-1];var f=z(a.get("subject"));var g=e&&z(e.get("subject"));if(b===0||e.is("flags.metathread")||f!==g){return[c.default.createDividerLetter(f||"nosubject",f||i18n("Без темы"),null,{type:"alpha_subj",alpha:f}),a]}return a};exports.alphabetSubjectInserter=C});define("helpers/seedable-random",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function a(){return Math.floor(Math.random()*4294967296)}var b=function(){function b(b){var c=b===void 0?[a(),a(),a(),a()]:b,d=c[0],e=c[1],f=c[2],g=c[3];this.a=d;this.b=e;this.c=f;this.d=g}b.randomSeed=function(){return[a(),a(),a(),a()]};b.prototype.random=function(){var a=this.b<<9;var b=this.a*5;b=(b<<7|b>>>25)*9;this.c^=this.a;this.d^=this.b;this.b^=this.c;this.a^=this.d;this.c^=a;this.d=this.d<<11|this.d>>>21;return(b>>>0)/4294967296};return b}();exports.default=b});define("helpers/suggest-search",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getFormattedSuggestQueries=a;exports.getSearchRadarIntervals=b;function a(a){if(!a||!a.length){return""}return a.map(function(a){return"«"+a+"»"}).join(", ")}function b(a,b){var c=a.lettersTotal,d=a.suggestLettersTotal;var e=b>c;var f=!c&&e?b-1:b;var g=[["letter_rank",f]];if(d&&e){g.push(["from_suggest",1])}return g}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/utils/actual-letters",["require","exports","default-values","mail/Folder","mail/User"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isActualLettersEnabledInFolder=void 0;b=__importDefault(b);c=__importDefault(c);function d(d,e,f){var g,h,i,j;if(!a.HAS_PRIORITY_MESSAGES){return false}var k=(h=(g=d===null||d===void 0?void 0:d.model)===null||g===void 0?void 0:g.uiThreadsSettings)!==null&&h!==void 0?h:{};if((!k.metathreads||((i=k.metathreadsSettings)===null||i===void 0?void 0:i[b.default.NEWSLETTERS])===c.default.METATHREADS_STATES.OFF)&&f){return false}var l=false;switch((j=d===null||d===void 0?void 0:d.route)===null||j===void 0?void 0:j.id){case"#read-letter":{l=a.FORCE_SHOW_PRIORITY_MESSAGES_READ_LETTER;break}case"#letters":{l=a.FORCE_SHOW_PRIORITY_MESSAGES_LIST_LETTERS;break}}return l||k.actualLettersNewsletters&&(e===null||e===void 0?void 0:e.isNewsletters())||k.actualLettersInbox&&(e===null||e===void 0?void 0:e.isInbox())}exports.isActualLettersEnabledInFolder=d});define("feast-tpl!app/feast-tpl!ui-block/dataset-letters/dataset-letters.html",["feast"],function(a){return a.smartParse('<div qa:id="dataset-letters">\n\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="realtouch" value="{_this.isTouchDevice()}"/>\n\t<fn:var name="ponymode" value="{attrs[\'pony-mode\']}"/>\n\t<fn:var name="actualLettersEnabledInInbox" value="{attrs.router.model.uiThreadsSettings.actualLettersInbox}"/>\n\t<fn:var name="actualLettersEnabledInNewsletters" value="{attrs.router.model.uiThreadsSettings.actualLettersNewsletters}"/>\n\n\t\x3c!-- Mods  --\x3e\n\t<bem:mod name="transparent" test="attrs.transparent"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\n\t<b:draggable\n\t\tenabled="{!realtouch}"\n\t\tremit:preparedragelement="preparedragelement"\n\t\tuse:mediator="todo-manager">\n\t\t\x3c!-- Content --\x3e\n\t\t\x3c!-- x-атрибуты нужны только для того, чтобы обновлять модели в кеше при их изменении --\x3e\n\t\t\x3c!-- Никакой завязки на них в коде dataset нету, x-* это просто способ показать, что атрибут не используется ни для чего кроме didUpdate --\x3e\n\t\t<b:dataset\n\t\t\tkey="{_this.isSearch() ? \'search\' : (\'folder_\' + attrs.folder.id)}"\n\t\t\tid="dataset"\n\t\t\tmodels="{attrs.models}"\n\t\t\tcompact="{attrs.compact}"\n\t\t\tdarkMode="{attrs[\'dark-mode\']}"\n\t\t\tselected="{attrs.selected}"\n\t\t\tselect-mode="{attrs[\'select-mode\']}"\n\t\t\titem-height="{_this.getItemHeight}"\n\t\t\titem-context="{_this.getItemContext}"\n\t\t\tpersist="{_this.getItemPersist}"\n\t\t\titems-update="{_this.handleItemsUpdate}"\n\t\t\thandle-new-range="{_this.onNewRange}"\n\t\t\tletter-not-found="{attrs[\'letter-not-found\']}"\n\t\t\tuse:mediator="metathreads-manager welcome-block-manager"\n\t\t\thandle-scroll="{_this.handleScroll}"\n\t\t\tx-realtouch="{realtouch}"\n\t\t\tx-ponymode="{ponymode}"\n\t\t\tx-transparent="{attrs.transparent}"\n\t\t\tx-compact="{attrs.compact}"\n\t\t\tx-thread="{attrs.thread}"\n\t\t\tx-actual-inbox="{actualLettersEnabledInInbox}"\n\t\t\tx-actual-newsletters="{actualLettersEnabledInNewsletters}"\n\t\t>\n\n\t\t\t<fn:match name="dataset-item" args="model, index, length, context">\n\t\t\t\t\x3c!-- Следующая модель --\x3e\n\t\t\t\t<fn:var name="next" value="{context.next}"/>\n\t\t\t\t\x3c!-- Модель расположена перед раскрытым метатредом --\x3e\n\t\t\t\t<fn:var name="isNextItemExpandedMetathread" value="{context.isNextItemExpandedMetathread}"/>\n\t\t\t\t\x3c!-- Модель является первой в списке писем --\x3e\n\t\t\t\t<fn:var name="isFirst" value="{context.isFirst}"/>\n\t\t\t\t\x3c!-- Модель является последней в списке писем --\x3e\n\t\t\t\t<fn:var name="isLast" value="{context.isLast}"/>\n\t\t\t\t\x3c!-- Предыдущая модель --\x3e\n\t\t\t\t<fn:var name="prev" value="{context.prev}"/>\n\t\t\t\t\x3c!-- Модель расположена после раскрытого метатреда --\x3e\n\t\t\t\t<fn:var name="isPrevItemExpandedMetathread" value="{context.isPrevItemExpandedMetathread}"/>\n\t\t\t\t<fn:var name="isPriority" value="{_this.isPriorityMessage(model)}"/>\n\t\t\t\t\x3c!-- Счетчик для остлеживания открытия метатреда --\x3e\n\t\t\t\t<fn:var name="metathreadExpandCounter" value="{context.metathreadExpandCounter}"/>\n\t\t\t\t\x3c!-- Параметр для остлеживания открытия метатреда --\x3e\n\t\t\t\t<fn:var name="metathreadLastToggle" value="{context.metathreadLastToggle}"/>\n\n\t\t\t\t\x3c!-- Распорки и скелетоны пагинатора --\x3e\n\t\t\t\t<fn:var name="skeletonIndex" value="{context.skeletonIndex}"/>\n\t\t\t\t<fn:var name="heightCompensation" value="{context.heightCompensation}"/>\n\n\t\t\t\t\x3c!-- Остальное --\x3e\n\t\t\t\t<fn:var name="sticky" value="{context.sticky}"/>\n\t\t\t\t<fn:var name="searchInExcludedFoldersUrl" value="{context.searchInExcludedFoldersUrl}"/>\n\t\t\t\t<fn:var name="suggestSearch" value="{context.suggestSearch}"/>\n\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="model.is(\'heightCompensation\')">\n\t\t\t\t\t\t\x3c!-- Распорка, компенсирующая высоту предыдущей страницы при переключении:Начало --\x3e\n\t\t\t\t\t\t<b:list-letter-height-compensation\n\t\t\t\t\t\t\tkey="{model.id}"\n\t\t\t\t\t\t\theight="{heightCompensation}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- Распорка, компенсирующая высоту предыдущей страницы при переключении:Конец --\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'skeletonLetter\')">\n\t\t\t\t\t\t\x3c!-- Письмо, которое грузится:Начало --\x3e\n\t\t\t\t\t\t<b:list-letter-skeleton\n\t\t\t\t\t\t\tkey="{model.id}"\n\t\t\t\t\t\t\tindex="{skeletonIndex}"\n\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- Письмо, которое грузится:Конец--\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'promoBlockLetter\')">\n\t\t\t\t\t\t\x3c!-- 2promo promo-block-letter:Start --\x3e\n\t\t\t\t\t\t<b:promo-block-letter\n\t\t\t\t\t\t\tkey="{_this.getKey(model)}" uid="{model.id}"\n\t\t\t\t\t\t\tno-margin-collapse\n\t\t\t\t\t\t\tuse:mediator="layout-manager advert-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- 2promo promo-block-letter:End --\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'welcomeBlockLetter\')">\n\t\t\t\t\t\t\x3c!-- list-letter-welcome:Start --\x3e\n\t\t\t\t\t\t<b:list-letter-welcome\n\t\t\t\t\t\t\tkey="{_this.getKey(model)}" uid="{model.id}"\n\t\t\t\t\t\t\tmodel="{model}"\n\t\t\t\t\t\t\tuse:mediator="layout-manager user-info welcome-block-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- list-letter-welcome:End --\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'discountsBlockLetter\')">\n\t\t\t\t\t\t\x3c!-- discounts:Start --\x3e\n\t\t\t\t\t\t<b:discounts\n\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}" uid="{model.id}"\n\t\t\t\t\t\t\t\tdiscounts="{context.discounts}"\n\t\t\t\t\t\t\t\t3pane="{attrs.compact}"\n\t\t\t\t\t\t\t\tsearch="{_this.isSearch()}"\n\t\t\t\t\t\t\t\tthreadsEnabled="{attrs.threadsEnabled}"\n\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\tfolder="{attrs.router.model.folder}"\n\t\t\t\t\t\t\t\tuse:mediator="layout-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- discounts:End --\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'specProjectLetter\')">\n\t\t\t\t\t\t\x3c!-- spec-project-letter:Start --\x3e\n\t\t\t\t\t\t<b:spec-project-letter\n\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\tuid="{model.id}"\n\t\t\t\t\t\t\tuse:mediator="letter-list-adv-optimizer advert-manager"\n\t\t\t\t\t\t\tno-delimeter\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- spec-project-letter:End --\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'advModel\')">\n\t\t\t\t\t\t\x3c!-- Advertisement:Start --\x3e\n\t\t\t\t\t\t<b:letter-list-item-adv\n\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\tfolder="{attrs.folder.id}"\n\t\t\t\t\t\t\tponymode="{ponymode}"\n\t\t\t\t\t\t\tmetathreadLastToggle="{metathreadLastToggle}"\n\t\t\t\t\t\t\tuid="{model.id}"\n\t\t\t\t\t\t\tindent="{model.is(\'inMetathread\')}"\n\t\t\t\t\t\t\tposition="{model.get(\'position\')}"\n\t\t\t\t\t\t\tindex="{model.get(\'index\')}"\n\t\t\t\t\t\t\tfull-delimiter="{isPrevItemExpandedMetathread}"\n\t\t\t\t\t\t\tuse:mediator="letter-list-adv-optimizer advert-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- Advertisement:End --\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'baitLetter\')">\n\t\t\t\t\t\t\x3c!-- AdBlock Bait:Start --\x3e\n\t\t\t\t\t\t<b:list-letter-bait key="{_this.getKey(model)}"/>\n\t\t\t\t\t\t\x3c!-- AdBlock Bait:End --\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'spinnerLetter\')">\n\t\t\t\t\t\t\x3c!-- Spinner:Start --\x3e\n\t\t\t\t\t\t<b:list-letter-spinner\n\t\t\t\t\t\t\tkey="{\'spinner\' + attrs.folder.id}"\n\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\t\t\tuse:mediator="letters-loader"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t\x3c!-- Spinner:End --\x3e\n\t\t\t\t\t<fn:when test="model.is(\'searchActionLetter\')">\n\t\t\t\t\t\t<b:list-letter-preview-action\n\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\tuse:mediator="search-manager"\n\t\t\t\t\t\t\tmodel="{model}"\n\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\thref="{searchInExcludedFoldersUrl}"\n\t\t\t\t\t\t\tqueries="{suggestSearch}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'tipLetter\')">\n\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t<fn:when test="attrs.folder.isSpam()">\n\t\t\t\t\t\t\t\t<b:list-letter-tip\n\t\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\t\tuse:mediator="folders-actions layout-manager"\n\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\t\t\t\t\ttype="spam:cleanup"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t\t<fn:when test="attrs.folder.isTrashLike()">\n\t\t\t\t\t\t\t\t<b:list-letter-tip\n\t\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\t\tuse:mediator="folders-actions layout-manager"\n\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\t\t\t\t\ttype="trash:cleanup"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.get(\'flags.metathread\')">\n\t\t\t\t\t\t\x3c!-- Metathread:Start --\x3e\n\t\t\t\t\t\t<b:metathread\n\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\tindex="{index}"\n\t\t\t\t\t\t\tmodel="{model}"\n\t\t\t\t\t\t\tponymode="{ponymode}"\n\t\t\t\t\t\t\ttouch="{realtouch}"\n\t\t\t\t\t\t\tselected="{attrs.selected[model.id]}"\n\t\t\t\t\t\t\tsticky="{sticky}"\n\t\t\t\t\t\t\tfull-delimiter="{isPrevItemExpandedMetathread}"\n\t\t\t\t\t\t\trouter="{attrs.router}"\n\n\t\t\t\t\t\t\thas-selected="{attrs.metathreadsWithSelected[model.id]}"\n\t\t\t\t\t\t\tevent:details="model"\n\t\t\t\t\t\t\tqa:id="metathread"\n\t\t\t\t\t\t\tremit:scrollintomodel="scrollintomodel"\n\t\t\t\t\t\t\tuse:mediator="metathreads-manager letters-selection layout-manager folders-navigation"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- /Metathread:End --\x3e\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:when test="model.is(\'metathreadFooter\')">\n\t\t\t\t\t\t<b:metathread-footer\n\t\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\tmodel="{model}"\n\t\t\t\t\t\t\t\tponymode="{ponymode}"\n\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\thide-footer-spacer="{isNextItemExpandedMetathread}"\n\n\t\t\t\t\t\t\t\tevent:details="model"\n\t\t\t\t\t\t\t\tremit:click-metathread-link="click:metathread-link"\n\t\t\t\t\t\t\t\tuse:mediator="layout-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\x3c!-- Thread:Start --\x3e\n\t\t\t\t\t\t\x3c!-- Показываем отступ в письмах если они относятся к метатреду  --\x3e\n\t\t\t\t\t\t\x3c!-- На 3pane они выглядят как в компактном виде --\x3e\n\t\t\t\t\t\t<fn:var name="indent" value="{model.isInMetathread()}"/>\n\t\t\t\t\t\t<fn:var name="isMetathread" value="{model.isInMetathread()}"/>\n\t\t\t\t\t\t<fn:var name="isSearch" value="{_this.isSearch()}"/>\n\n\t\t\t\t\t\t\x3c!-- Письмо выбрано? --\x3e\n\t\t\t\t\t\t<fn:var name="selected" value="{_this.isLetterSelected(model)}"/>\n\t\t\t\t\t\t\x3c!-- Письмо активно? --\x3e\n\t\t\t\t\t\t<fn:var name="active" value="{!attrs[\'select-mode\'] && _this.isLetterActive(model)}"/>\n\n\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t<fn:when test="realtouch && attrs.compact">\n\t\t\t\t\t\t\t\t\x3c!-- touch 3pane --\x3e\n\t\t\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\t\t\tcomponent="ListLetterCompactTouch"\n\t\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\t\tdisable-attach="{!_this.isEnableAttach()}"\n\t\t\t\t\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\t\t\t\t\tmodel="{model}"\n\t\t\t\t\t\t\t\t\tselected="{selected}"\n\t\t\t\t\t\t\t\t\tactive="{active}"\n\t\t\t\t\t\t\t\t\tmain-field="{_this.getMainField(model)}"\n\t\t\t\t\t\t\t\t\tindent="{isMetathread}"\n\t\t\t\t\t\t\t\t\tin-metathread="{isMetathread}"\n\t\t\t\t\t\t\t\t\tsearch="{isSearch}"\n\t\t\t\t\t\t\t\t\tshowfolder="{isSearch}"\n\t\t\t\t\t\t\t\t\tfull-delimiter="{isPrevItemExpandedMetathread}"\n\t\t\t\t\t\t\t\t\thref="{_this.getLetterHref(model, attrs.folder)}"\n\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\tremit:clickavatar="click:avatar"\n\t\t\t\t\t\t\t\t\tremit:click="click:letter"\n\t\t\t\t\t\t\t\t\tevent:details="{model: model, index: index}"\n\t\t\t\t\t\t\t\t\tremit:contextmenu="rightclick"\n\t\t\t\t\t\t\t\t\tuse:mediator="letters-actions"\n\t\t\t\t\t\t\t\t\tqa:index="{model.meta(\'_ui-index\')}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t\t<fn:when test="realtouch">\n\t\t\t\t\t\t\t\t\x3c!-- touch 2pane --\x3e\n\t\t\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\t\t\tcomponent="ListLetterCommonTouch"\n\t\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\t\tdisable-attach="{!_this.isEnableAttach()}"\n\t\t\t\t\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\t\t\t\t\tmodel="{model}"\n\t\t\t\t\t\t\t\t\tselected="{selected}"\n\t\t\t\t\t\t\t\t\tactive="{active}"\n\t\t\t\t\t\t\t\t\tmain-field="{_this.getMainField(model)}"\n\t\t\t\t\t\t\t\t\tindent="{isMetathread}"\n\t\t\t\t\t\t\t\t\tin-metathread="{isMetathread}"\n\t\t\t\t\t\t\t\t\tsearch="{isSearch}"\n\t\t\t\t\t\t\t\t\tshowfolder="{isSearch}"\n\t\t\t\t\t\t\t\t\tfull-delimiter="{isPrevItemExpandedMetathread}"\n\t\t\t\t\t\t\t\t\thref="{_this.getLetterHref(model, attrs.folder)}"\n\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\tremit:clickavatar="click:avatar"\n\t\t\t\t\t\t\t\t\tremit:click="click:letter"\n\t\t\t\t\t\t\t\t\tevent:details="{model: model, index: index}"\n\t\t\t\t\t\t\t\t\tremit:contextmenu="rightclick"\n\t\t\t\t\t\t\t\t\tuse:mediator="letters-actions"\n\t\t\t\t\t\t\t\t\tqa:index="{model.meta(\'_ui-index\')}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t\t<fn:when test="attrs.compact">\n\t\t\t\t\t\t\t\t\x3c!-- desktop 3pane --\x3e\n\t\t\t\t\t\t\t\t<b:list-letter-compact\n\t\t\t\t\t\t\t\t\tpriority="{isPriority}"\n\t\t\t\t\t\t\t\t\tdisable-attach="{!_this.isEnableAttach()}"\n\t\t\t\t\t\t\t\t\tpony-mode="{ponymode || isMetathread}"\n\t\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\t\t\t\t\tmodel="{model}"\n\t\t\t\t\t\t\t\t\tselected="{selected}"\n\t\t\t\t\t\t\t\t\tactive="{active}"\n\t\t\t\t\t\t\t\t\tmain-field="{_this.getMainField(model)}"\n\t\t\t\t\t\t\t\t\tindent="{isMetathread}"\n\t\t\t\t\t\t\t\t\tin-metathread="{isMetathread}"\n\t\t\t\t\t\t\t\t\tsearch="{isSearch}"\n\t\t\t\t\t\t\t\t\tshowfolder="{isSearch}"\n\t\t\t\t\t\t\t\t\tfull-delimiter="{isPrevItemExpandedMetathread}"\n\t\t\t\t\t\t\t\t\thref="{_this.getLetterHref(model, attrs.folder)}"\n\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\tshow-attaches="{_this.shouldShowLetterPreview(model)}"\n\t\t\t\t\t\t\t\t\tremit:clickavatar="click:avatar"\n\t\t\t\t\t\t\t\t\tremit:click="click:letter"\n\t\t\t\t\t\t\t\t\tevent:details="{model: model, index: index}"\n\t\t\t\t\t\t\t\t\tremit:contextmenu="rightclick"\n\t\t\t\t\t\t\t\t\tuse:mediator="letters-actions layout-manager letter-attaches-preview unsubscribe-actions"\n\t\t\t\t\t\t\t\t\tlayout-mode="3pane"\n\t\t\t\t\t\t\t\t\thidden-payment-dies="{attrs[\'hidden-payment-dies\']}"\n\t\t\t\t\t\t\t\t\tqa:index="{model.meta(\'_ui-index\')}"\n\t\t\t\t\t\t\t\t\tunsubscribeList="{attrs.unsubscribeList}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t\x3c!-- desktop 2pane  --\x3e\n\t\t\t\t\t\t\t\t<b:list-letter-common\n\t\t\t\t\t\t\t\t\tpriority="{isPriority}"\n\t\t\t\t\t\t\t\t\tdisable-attach="{!_this.isEnableAttach()}"\n\t\t\t\t\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\t\t\t\t\tmodel="{model}"\n\t\t\t\t\t\t\t\t\tselected="{selected}"\n\t\t\t\t\t\t\t\t\tmain-field="{_this.getMainField(model)}"\n\t\t\t\t\t\t\t\t\tindent="{isMetathread}"\n\t\t\t\t\t\t\t\t\tin-metathread="{isMetathread}"\n\t\t\t\t\t\t\t\t\tsearch="{isSearch}"\n\t\t\t\t\t\t\t\t\tshowfolder="{isSearch}"\n\t\t\t\t\t\t\t\t\tfull-delimiter="{isPrevItemExpandedMetathread}"\n\t\t\t\t\t\t\t\t\thref="{_this.getLetterHref(model, attrs.folder)}"\n\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\tshow-attaches="{_this.shouldShowLetterPreview(model)}"\n\t\t\t\t\t\t\t\t\tremit:clickavatar="click:avatar"\n\t\t\t\t\t\t\t\t\tremit:click="click:letter"\n\t\t\t\t\t\t\t\t\tremit:openletter="click:letter"\n\t\t\t\t\t\t\t\t\tevent:details="{model: model, index: index}"\n\t\t\t\t\t\t\t\t\tremit:contextmenu="rightclick"\n\t\t\t\t\t\t\t\t\tremit:previewattach="click:previewattach"\n\t\t\t\t\t\t\t\t\tuse:mediator="letters-actions letter-attaches-preview layout-manager unsubscribe-actions"\n\t\t\t\t\t\t\t\t\tlayout-mode="2pane"\n\t\t\t\t\t\t\t\t\thidden-payment-dies="{attrs[\'hidden-payment-dies\']}"\n\t\t\t\t\t\t\t\t\tqa:index="{model.meta(\'_ui-index\')}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t\t\x3c!-- Thread:End --\x3e\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</fn:match>\n\n\t\t\t<fn:match name="dataset-empty">\n\t\t\t\t<div bem:elem="empty">\n\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t<fn:when test="attrs.search && !attrs[\'search-letter\']">\n\t\t\t\t\t\t\t<b:octopus\n\t\t\t\t\t\t\t\t\ttype="no-search"\n\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\tuse:mediator="layout-manager folders-navigation filter-manager settings-filters-manager compose-manager search-manager themes-manager pony-mode"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t<fn:when test="attrs[\'letter-not-found\']">\n\t\t\t\t\t\t\t<b:octopus\n\t\t\t\t\t\t\t\t\ttype="no-letter"\n\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\tuse:mediator="layout-manager folders-navigation filter-manager settings-filters-manager compose-manager themes-manager pony-mode"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t<b:octopus\n\t\t\t\t\t\t\t\t\ttype="empty-folder"\n\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\tuse:mediator="layout-manager folders-navigation filter-manager settings-filters-manager compose-manager themes-manager pony-mode"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t</fn:choose>\n\t\t\t\t</div>\n\t\t\t</fn:match>\n\n\t\t\t<fn:match name="navigator" args="range">\n\t\t\t\t<b:paginator-container\n\t\t\t\t\tvisible="{attrs.paginator || attrs[\'nav-up\']}"\n\t\t\t\t\tpaginator="{attrs.paginator}"\n\t\t\t\t\tnav-up="{attrs.paginator || attrs[\'nav-up-enabled\']}"\n\n\t\t\t\t\tuse:mediator="layout-manager compose-manager"\n\t\t\t\t>\n\t\t\t\t\t<fn:match name="paginator">\n\t\t\t\t\t\t<b:paginator\n\t\t\t\t\t\t\tlength="{attrs.status.lettersTotal}"\n\t\t\t\t\t\t\tcurrent="{_this.getPaginatorPage(range, true)}"\n\t\t\t\t\t\t\tremit:navigate="paginator:navigate"\n\t\t\t\t\t\t\tuse:mediator="progress-bar-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:match>\n\n\t\t\t\t\t<fn:match name="nav-up">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\tico="navigation:arrow_up"\n\t\t\t\t\t\t\ttitle="{i18n(\'Наверх\')}"\n\t\t\t\t\t\t\tpure\n\t\t\t\t\t\t\tshort\n\t\t\t\t\t\t\tdisabled="{!attrs[\'nav-up\']}"\n\t\t\t\t\t\t\tqa:id="paginator-button-up"\n\t\t\t\t\t\t\tremit:click="paginator:up"\n\t\t\t\t\t\t\tcentered\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:match>\n\t\t\t\t</b:paginator-container>\n\t\t\t</fn:match>\n\n\t\t</b:dataset>\n\t</b:draggable>\n</div>\n',"app/feast-tpl!ui-block/dataset-letters/dataset-letters.html")});define("feast-tpl!ui-block/dataset-letters/dataset-letters.html",["feast-tpl!app/feast-tpl!ui-block/dataset-letters/dataset-letters.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/advert-vis-check",["require","exports","@mail/xray","default-values","service/adv/config"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.checkAdvertVisibility=void 0;a=__importDefault(a);var d=false;function e(a){a=a.replace(/(\r\n|\n|\r)/gm,"");a=a.slice(0,500);return a}function f(){if(d){return}d=true;setTimeout(function(){require(["mediator/layout-manager","service/adv/locator"],function(d,f){var g=d.default;var h=f.locator;function i(){var a=null;if(document.hidden){a="tab_hidden"}else if(h.isEnabled()){a="mimic"}else if(b.HIDE_TOYS===b.BL_PROP_NAME){a="profile"}else if(!g.isMoreThen("xs")){a="layout"}return a}var j=i();if(j){a.default.send("adman-check",{i:"disable_".concat(j)});return}a.default.send("adman-check",{i:"start"});setTimeout(function(){var d=i();if(d){a.default.send("adman-check",{i:"a_disable_".concat(d)});return}var f=document.querySelector("#app-canvas .advert-column > .slot");try{var g=null;if(f){if(!f.firstChild){g="no_fchild"}else if(!f.firstChild.firstChild){g="no_fchild2"}else{var h=f.getBoundingClientRect().top;if(h<-1e4){g="no_relative"}}}else{g="no_node"}if(g){var j=null;if(f){j=e(f.innerHTML)}if(b.ADVERT_VIS_LOG){a.default.send("adman-check",{i:["hidden",g],rlog:"octavius_adman_check_reason",rlog_message:{reason:g,html:j,blocker:(0,c.hasBlocker)()}})}else{a.default.send("adman-check",{i:["hidden",g]})}}}catch(b){a.default.send("adman-check",{i:"catch"})}},b.ADVERT_VIS_CHECK)})},1e3)}exports.checkAdvertVisibility=f});define("helpers/get-go-to-action-display-mode",["require","exports","default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getGoToActionHeight=exports.getGoToActionDisplayMode=void 0;function b(b,c,d){if(b===void 0){b=this.get("model")}if(c===void 0){c=this.get("search")}if(d===void 0){d=this.is("in-thread")}if(c||d||!a.GO_TO_ACTION_BUTTOM){return"none"}try{var e=b.getGoToActionMeta();if(!e){return"none"}return e.description?"full":"compact"}catch(a){return"none"}}exports.getGoToActionDisplayMode=b;function c(a,c,d,e,f){var g=b(a,d,false);if(g==="none"){return 0}if(!e){return 32}var h=g==="compact"?-20:0;if(c||f){return 20+h}return h}exports.getGoToActionHeight=c});define("helpers/keys",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isNewTabClick=b;var a=1;function b(b){return b.metaKey||b.ctrlKey||b.button===a}});define("helpers/letter",["require","exports","default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.hasLetterReplyAll=exports.checkReliable=exports.checkImportantReliable=exports.checkOfficial=exports.checkOfficialGreen=exports.isListLetterActionButtonsEnabled=exports.getLetterHref=exports.getLetterIdAndFolder=void 0;function b(a,b,c){var d=c.threadsEnabled,e=c.isSearch;var f=a.meta("thread_id")||a.get("thread_id")||a.id;var g=null;if(e&&!d&&!a.meta("thread_id")){g=a.get("folder");f="0:".concat(a.id,":").concat(g||"0")}return{threadId:f,letterId:a.id,folderId:g||b.id}}exports.getLetterIdAndFolder=b;function c(a,c,d){var e=d.search?"#search-letter":"#read-letter";var f=d.router[e];var g=b(a,c,{threadsEnabled:d.threads,isSearch:d.search}),h=g.threadId,i=g.letterId,j=g.folderId;return f.getUrl({letter:h,folder:j,id:i},"inherit")}exports.getLetterHref=c;function d(b,c){var d;if(!b||typeof b.getFolder!=="function"||typeof((d=b.getFolder())===null||d===void 0?void 0:d.isParentalControl)!=="function"){return false}return a.ENABLE_LIST_LETTER_ACTION_BUTTONS&&!c&&b.getFolder().isParentalControl()}exports.isListLetterActionButtonsEnabled=d;function e(b){return a.SHOW_OFFICIAL_ON_LETTER_LIST&&!a.DISABLE_GREEN_OFFICIAL_ON_LETTER_LIST&&b.is("flags.official")}exports.checkOfficialGreen=e;function f(b){return a.SHOW_OFFICIAL_ON_LETTER_LIST&&(b.is("flags.official")||b.is("flags.official_newsletter"))}exports.checkOfficial=f;function g(b){return a.SHOW_RELIABLE_ON_LETTER_LIST&&!a.DISABLE_GREEN_RELIABLE_ON_LETTER_LIST&&b.is("flags.bimi_important_msg")}exports.checkImportantReliable=g;function h(b){return a.SHOW_RELIABLE_ON_LETTER_LIST&&(b.is("flags.bimi_important_msg")||b.is("flags.bimi_msg"))}exports.checkReliable=h;function i(a){if(!a){return false}return a.get("correspondents.to.length")+a.get("correspondents.cc.length")>1}exports.hasLetterReplyAll=i});define("feast-mod/brackets",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=exports.brackets=function a(b){return"«"+b+"»"}});define("feast-mod/folder-name",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getFolderName=b;exports.getMetathreadName=c;var a={500011:i18n("Соц. сети")};function b(b){var c=b.get("name");var d=a[b.get("id")];return d||c||""}function c(b){var c=b.get("metathread_data.folder");var d=b.get("metathread_data.folder_name");var e=a[c];return e||d||""}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/metathreads",["require","exports","@mail/features","feast-mod/brackets","feast-mod/folder-name","mail/User","RPC"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isMetathreadOnFromState=exports.getMetathreadSettingsFromState=exports.getModelCurrentFolder=exports.getRemoveButtonText=exports.getMarkAllReadText=exports.getShortname=exports.metathreadsToggle=void 0;a=__importDefault(a);d=__importDefault(d);e=__importDefault(e);function f(b){return e.default.post("user/edit",{common_purpose_flags:{metathreads_on:b}}).then(function(){a.default.import({metathreads:{state:b}})})}exports.metathreadsToggle=f;function g(a){return(0,b.brackets)((0,c.getMetathreadName)(a))}exports.getShortname=g;function h(){return i18n("Отметить всё прочитанным")}exports.getMarkAllReadText=h;function i(a,b){if(b===void 0){b=false}var c=g(a);return i18n("Удалить")+(b?"":" ".concat(c))}exports.getRemoveButtonText=i;function j(a){var b;var c=a.isInMetathread&&a.isInMetathread();return c?a.getContainingMetathread().getFolder():(b=a.getFolder)===null||b===void 0?void 0:b.call(a)}exports.getModelCurrentFolder=j;function k(a){switch(a){case d.default.METATHREADS_STATES.ON:return{isOn:true,isHiddenOnLetterList:false};case d.default.METATHREADS_STATES.HIDDEN:return{isOn:true,isHiddenOnLetterList:true};case d.default.METATHREADS_STATES.OFF:return{isOn:false,isHiddenOnLetterList:false};default:return{isOn:false,isHiddenOnLetterList:false}}}exports.getMetathreadSettingsFromState=k;function l(a){switch(a){case d.default.METATHREADS_STATES.ON:case d.default.METATHREADS_STATES.HIDDEN:return true;case d.default.METATHREADS_STATES.OFF:return false;default:return false}}exports.isMetathreadOnFromState=l});define("helpers/new-letter-list",["require","exports","default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isNewLetterListEnabled=void 0;function b(b){return b?a.NEW_LETTER_LIST_3PANE:a.NEW_LETTER_LIST}exports.isNewLetterListEnabled=b});define("models/bait-letter/bait-letter",["exports","models/dataset-model/dataset-model"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}var d="baitLetter";var e=b.default.extend({className:"models.BaitLetter"});e.createBaitLetter=function a(c){return b.default.createModel(e,"bait::"+c,d)};e.isBait=function a(c){return b.default.isDatasetModel(c,d)};exports.default=e});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("models/discounts-block-letter/discounts-block-letter",["require","exports","models/dataset-model/dataset-model"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);var b="discountsBlockLetter";var c=a.default.extend({className:"models.DiscountsBlockLetter"});c.createDiscountsBlock=function d(){var e="discountsBlockLetter";return a.default.createModel(c,e,b)};c.isDiscountsBlock=function c(d){return a.default.isDatasetModel(d,b)};exports.default=c});define("models/height-compensation-model/height-compensation-model",["exports","models/dataset-model/dataset-model"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}var d="heightCompensation";var e=b.default.extend({className:"models.HeightCompensation"});e.createHeightCompensation=function a(c){var f=b.default.createModel(e,e.constructId(),d);f.set({height:c},{silent:true});return f};e.isHeightCompensation=function a(c){return b.default.isDatasetModel(c,d)};e.constructId=function a(){return"heightCompensation"};e.getCurrentHeightCompensation=function a(){return b.default.createModel(e,e.constructId(),d)};exports.default=e});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("models/promo-block-letter/promo-block-letter",["require","exports","models/dataset-model/dataset-model"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.promoBlockLabel=void 0;a=__importDefault(a);exports.promoBlockLabel="promoBlockLetter";var b=a.default.extend({className:"models.PromoBlockLetter"});b.createPromoBlock=function c(){var d="promoBlockLetter";return a.default.createModel(b,d,exports.promoBlockLabel)};b.isPromoBlock=function b(c){return a.default.isDatasetModel(c,exports.promoBlockLabel)};exports.default=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("models/search-action-letter/search-action-letter",["require","exports","Model"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.searchActionLetterLabel=void 0;a=__importDefault(a);var b=a.default.extend({className:"models.SearchActionLetter"});exports.searchActionLetterLabel="searchActionLetter";b.createSearchActionLetter=function a(c){var d;var e=c.withSuggestHeader,f=c.type;var g="searchActionLetter::".concat(f);var h=b.all.getSafe(g);h.set((d={id:g,withSuggestHeader:e,type:f},d[exports.searchActionLetterLabel]=true,d));if(!h){b.all.set([h])}return h};b.isSearchAction=function a(b){return b.is(exports.searchActionLetterLabel)};exports.default=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("models/spec-project-letter/spec-project-letter",["require","exports","models/dataset-model/dataset-model"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.specProjectLetterLabel=void 0;a=__importDefault(a);exports.specProjectLetterLabel="specProjectLetter";var b=a.default.extend({className:"models.SpecProjectLetter"});b.createSpecProjectLetter=function c(d){var e="specProjectLetter::".concat(d);return a.default.createModel(b,e,exports.specProjectLetterLabel)};b.isSpecProjectLetter=function b(c){return a.default.isDatasetModel(c,exports.specProjectLetterLabel)};exports.default=b});define("models/spinner-letter/spinner-letter",["exports","models/dataset-model/dataset-model"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}var d="spinnerLetter";var e=b.default.extend({className:"models.SpinnerLetter"});e.createSpinnerLetter=function a(){return b.default.createModel(e,"spinner",d)};e.isSpinner=function a(c){return b.default.isDatasetModel(c,d)};exports.default=e});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("models/tip-letter/tip-letter",["require","exports","models/dataset-model/dataset-model"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.tipLetterLabel=void 0;a=__importDefault(a);exports.tipLetterLabel="tipLetter";var b=a.default.extend({className:"models.TipLetter"});b.createTipLetter=function c(d){var e=a.default.createModel(b,"tip:".concat(d),exports.tipLetterLabel);e.set("folder",d);return e};b.isTip=function b(c){return a.default.isDatasetModel(c,exports.tipLetterLabel)};exports.default=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("models/welcome-block-letter/welcome-block-letter",["require","exports","models/dataset-model/dataset-model"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);var b="welcomeBlockLetter";var c=a.default.extend({className:"models.WelcomeBlockLetter",constructor:function(){a.default.prototype.constructor.apply(this,arguments);this.set({withGreeting:true,height:0})}});c.createWelcomeBlock=function d(){var e="welcomeBlockLetter";return a.default.createModel(c,e,b)};c.isWelcomeBlock=function c(d){return a.default.isDatasetModel(d,b)};exports.default=c});define("service/contextmenu",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a;exports.default={setup:function(b){var c=new b({router:app});c.renderTo(document.body);a=c},teardown:function(){a.destroy();a=null},show:function(a,b){var c=this.getInstance();c.onContextmenu(a,b)},getInstance:function(){return a}}});define("service/radars/decorator",["require","exports","./index"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=a.radarService.RadarDecorator});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("service/search-attaches/attachesList",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getAttaches=exports.excludeAttaches=exports.normalizeAttaches=exports.validateAttachFromSearch=void 0;function a(a,b){if(!a){return false}var c=a.formName,d=a.partId,e=a.snippet;var f=(c===null||c===void 0?void 0:c.value)&&d;if(b){return!!(f&&(e===null||e===void 0?void 0:e.value))}return!!f}exports.validateAttachFromSearch=a;function b(a){if(!a){return null}return a.map(function(a){var b=__assign({},a.toJSON());b.partId=b.part_id;return b})}exports.normalizeAttaches=b;function c(a,b){return b.filter(function(b){return!a.some(function(a){return a.partId===b.partId})})}exports.excludeAttaches=c;function d(b,d,e){if(!b){return}var f=b.attachesCount,g=b.vertical;var h=null;if(e&&e.length){h=e}else{h=d}if(!h){return}var i=0;var j=h.filter(function(b){if(a(b,g)&&i<f){i++;return true}return false});var k=c(j,d);return{attachesList:j.length?j:null,moreAttachesList:k.length?k:null}}exports.getAttaches=d});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/search-attaches/getAttaches",["require","exports","@mail/xray","default-values","mail/Message","./attachesList"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fetchMessagesAttaches=exports.shouldShowLetterPreview=exports.getAllAttaches=exports.getSearchAttaches=void 0;a=__importDefault(a);c=__importDefault(c);var e=function(a){return a===null||a===void 0?void 0:a.map(function(a){var b=a;var c=a.name;if(typeof c==="string"){return b}b.formName=c;b.name=c===null||c===void 0?void 0:c.value;return b})};function f(a,b){if(a===void 0){a=this.get("model")}if(b===void 0){b=this.get("search")}if(b){var c=a.meta("search_attaches");if(c){return e(c)}}}exports.getSearchAttaches=f;function g(a,b){if(a===void 0){a=this.get("model")}if(b===void 0){b=this.get("search")}if(b){var c=a.get("all_attaches")||[];var f=e(c);return f.filter(function(a){return(0,d.validateAttachFromSearch)(a,false)})}if(h(a)){return a.get("attaches.list")}}exports.getAllAttaches=g;function h(a){if(a===void 0){a=this.get("model")}if(!(b.LETTER_PREVIEWS&&b.LETTER_PREVIEWS_CONFIG["show-previews"]&&a.get("attachments_count"))){return false}var c=Number(a.get("folder"));var d=b.LETTER_PREVIEWS_CONFIG["folders-list"]||[];return d.includes(c)}exports.shouldShowLetterPreview=h;function i(c){if(!b.LETTER_PREVIEW_RADAR){return}c.forEach(function(b){var c=b.thumbnails.image;var d=Object.values(c)[0];if(d.length>0){var e=new URL(d).hostname;e=e.replace(/\./g,"-");a.default.send("lp-host-".concat(e))}})}function j(e){if(e===void 0){e=this.get("model")}if(b.LETTER_PREVIEW_RADAR){a.default.send("lp-msg-attch-req")}if(!b.LETTER_PREVIEWS_CONFIG["go-on-server"]){return Promise.resolve(null)}var f=e.get("attaches.list");if(f.length>0){return Promise.resolve((0,d.normalizeAttaches)(f))}else{var g=e.get("expand");return c.default.findAttaches(g).then(function(b){i(b.body);var c=e.setFormAttaches(g,b);a.default.send("previews_req_success");return(0,d.normalizeAttaches)(c)}).catch(function(b){a.default.send("previews_req_error",{rlog:"previews_req_error",rlog_message:JSON.stringify(b)})})}}exports.fetchMessagesAttaches=j});define("service/search-attaches/viewModes",["require","exports","default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getSearchAttachesHeight=exports.getAttachesModes=void 0;var b=a.ALL_ATTACHES_MAX_COUNT;var c;(function(a){a[a["incompact"]=2]="incompact";a[a["compact"]=1]="compact"})(c||(c={}));function d(a){var b=0;var c=0;var d=0;a.forEach(function(a){var e;var f=a.snippet,g=a.formName;if(f.color.length){c++;return}if(((e=g===null||g===void 0?void 0:g.color)===null||e===void 0?void 0:e.length)&&f.value){b++;return}d++});return{nameMatches:b,snippetMatches:c,hasNoSnippet:d}}function e(a,d,e,f,g){if(a===void 0){a=false}if(d===void 0){d=0}if(e===void 0){e=0}if(f===void 0){f=0}if(g===void 0){g=0}if(e){var h=e+f;return h<b?h:b}var i=a?c.compact:c.incompact;if(f||g){var j=f+g;return j<i?j:i}return d<i?d:i}function f(a,b,c){if(!b||!b.length){return}if(!c||!c.length){var f=e(a,b.length);return{vertical:false,attachesCount:f}}var g=d(c),h=g.nameMatches,i=g.snippetMatches,j=g.hasNoSnippet;var k=e(a,b.length,i,h,j);return{vertical:Boolean(i),attachesCount:k}}exports.getAttachesModes=f;function g(a){var b=a.vertical,c=a.attachesCount;if(!b){return 36}return c*48+(c-1)*8}exports.getSearchAttachesHeight=g});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/secure-folder",["require","exports","service/layer"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);var b={};function c(c){if(!c){return Promise.reject()}var d=c.get("id");return new Promise(function(a,b){require(["mediator/layout-manager"],a,b)}).then(__importStar).then(function(b){var d;var e=(d=b===null||b===void 0?void 0:b.default)===null||d===void 0?void 0:d.isLessThen("xs");return a.default.open("secure-folder",{model:c},{dimmer:true,compact:true,"close-on-esc":true,mobile:e})}).then(function(a){return new Promise(function(c){a.on("cancel",function(){delete b[d];c(false)});a.on("success",function(){delete b[d];c(true)})})})}exports.default=c});define("feast-tpl!app/feast-tpl!ui-block/button2/button2.html",["feast"],function(a){return a.smartParse('<span\n\tqa:id="button:{attrs.ico || attrs.title || attrs.text}"\n\tqa:state="{attrs.pressed ? \'pressed\' : (attrs.disabled ? \'disabled\' : \'normal\')}"\n\tpromo:id="{attrs.promoId}"\n\tdata-highlighted-class="button2_highlighted"\n>\n\t<fn:var name="title" value="{_this.getAvailableTitle()}"/>\n\t<fn:attr name="title" value="{title}" test="!!title"/>\n\n\t<fn:attr name="data-title-shortcut" value="{attrs[\'title-shortcut\']}" test="!attrs.disabled && attrs[\'title-shortcut\']"/>\n\n\t<fn:var name="size" value="{attrs.size || \'m\'}"/>\n\n\t<bem:mod name="has-ico" test="attrs.ico" />\n\t<bem:mod name="has-ico-hover" test="attrs[\'ico-hover\']" />\n\t<bem:mod name="has-ico-{attrs.icoSize}" test="attrs.ico" />\n\t<bem:mod name="{String(attrs.ico).replace(/:/, \'_\')}" test="attrs.ico" />\n\t<bem:mod name="rotate-ico" test="attrs[\'rotate-ico\']" />\n\n\t\x3c!-- Тип кнопки --\x3e\n\t<bem:mod name="base" test="!attrs.badge && !attrs.pure && !attrs.clean" />\n\t<bem:mod name="badge" test="attrs.badge" />\n\t<bem:mod name="pure" test="attrs.pure" />\n\t<bem:mod name="clean" test="attrs.clean" />\n\t<bem:mod name="invert" test="attrs.invert" />\n\n\t\x3c!-- Подвид типа кнопки --\x3e\n\t<bem:mod name="primary" test="attrs.primary" />\n\t<bem:mod name="primary-clean" test="attrs[\'primary-clean\']" />\n\t<bem:mod name="secondary" test="attrs.secondary" />\n\t<bem:mod name="in-dropmenu" test="attrs.dropmenu" />\n\t<bem:mod name="only-explanation" test="!attrs.text && attrs.explanation" />\n\n\t<bem:mod name="always-bright" test="attrs[\'always-bright\']" />\n\n\t\x3c!-- Размер --\x3e\n\t<bem:mod name="short" test="attrs.short || (!attrs.text && !attrs.explanation)" />\n\t<bem:mod name="touch" test="attrs.touch" />\n\t<bem:mod name="compact" test="attrs.compact" />\n\t<bem:mod name="small" test="attrs.small" />\n\t<bem:mod name="medium" test="attrs.medium" />\n\t<bem:mod name="shadowless" test="attrs.shadowless" />\n\t<bem:mod name="fill" test="attrs.fill" />\n\n\t\x3c!-- Выравнивание --\x3e\n\t<bem:mod name="ico-text-top" test="attrs[\'ico-text-top\']" />\n\t<bem:mod name="ico-arrow-down" test="attrs[\'ico-arrow-down\']" />\n\n\t<bem:mod name="nowrap" test="attrs[\'nowrap\']" />\n\n\t\x3c!-- Форма --\x3e\n\t<bem:mod name="round" test="attrs.round" />\n\t<bem:mod name="square" test="attrs.square" />\n\t<bem:mod name="fluid" test="attrs.fluid" />\n\t<bem:mod name="rounded" test="attrs.rounded" />\n\n\t\x3c!-- Шрифт --\x3e\n\t<bem:mod name="font-size-pony" test="attrs[\'font-size-pony\']" />\n\t<bem:mod name="text-overflow" test="attrs[\'text-overflow\']" />\n\n\t\x3c!-- Состояния --\x3e\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']" />\n\t<bem:mod name="pressed" test="attrs.pressed" />\n\t<bem:mod name="disabled" test="attrs.disabled" />\n\t<bem:mod name="highlighted" test="attrs.highlighted" />\n\n\t<bem:mod name="safari" test="attrs.safari" />\n\n\t<fn:add-class name="js-shortcut" test="!attrs.disabled && attrs.shortcut" />\n\n\t<span bem:elem="highlighter" />\n\n\t<span\n\t\t\tbem:elem="wrapper"\n\t\t\tqa:id="button:wrapper"\n\t\t\tremit:click="click-radar"\n\t\t\tremit:keydown.enter.prevent.stop="keydown:enter"\n\t\t\tref="wrapper"\n\t>\n\t\t<bem:mod name="centered" test="attrs.centered || attrs.short" />\n\n\t\t<fn:attr\n\t\t\t\tname="tabindex"\n\t\t\t\tvalue="{attrs.disabled ? -1 : attrs[\'tab-index\']}"\n\t\t\t\ttest="attrs[\'tab-index\'] !== void 0"\n\t\t/>\n\n\t\t<span bem:elem="ico" fn:if="attrs.ico" qa:id="button-icon">\n\n\t\t\t\x3c!-- "Красный прыщик" на иконке кнопки --\x3e\n\t\t\t<b:notification-badge\n\t\t\t\tfn:if="attrs[\'notification-badge\'] && attrs.ico"\n\t\t\t\tshow="{true}"\n\t\t\t\tponymode="{attrs.compact}"\n\t\t\t\ttop="-1"\n\t\t\t\tright="-2"\n\t\t\t\tpony-top="2"\n\t\t\t\tpony-right="1"\n\t\t\t\tradar-id="{attrs[\'notification-badge\']}"\n\t\t\t\tsize="{attrs[\'notification-badge-size\']}"\n\t\t\t\tcolorMode="{attrs[\'notification-badge-color\']}"\n\t\t\t>\n\t\t\t\t<fn:match name="content">\n\t\t\t\t\t<b:ico name="{attrs.ico}" fn:if="attrs.ico"/>\n\t\t\t\t</fn:match>\n\t\t\t</b:notification-badge>\n\t\t\t<b:ico name="{attrs.ico}" size="{attrs.icoSize}" fn:if="attrs.ico && !attrs[\'notification-badge\']"/>\n\n\t\t\t<b:ico name="{attrs[\'ico-hover\']}" size="{size}" fn:if="attrs[\'ico-hover\']"/>\n\t\t</span>\n\n\t\t\x3c!-- Контент кнопки: текст или match --\x3e\n\t\t<fn:choose>\n\t\t\t<fn:when test="__vmatches[\'default\']">\n\t\t\t\t<fn:apply-match name="default"/>\n\t\t\t</fn:when>\n\n\t\t\t<fn:otherwise>\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="txt"\n\t\t\t\t\tfn:if="!attrs.short && attrs.text"\n\t\t\t\t\tqa:id="button-text"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="center" test="attrs.center" />\n\t\t\t\t\t{attrs.text}\n\t\t\t\t</div>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\n\t\t\x3c!-- Элемент "Пояснение" --\x3e\n\t\t<span\n\t\t\tbem:elem="explanation"\n\t\t\tfn:if="!attrs.short && attrs.explanation"\n\t\t\tqa:id="button-explanation"\n\t\t>\n\t\t\t<bem:mod name="ellipsis"/>\n\t\t\t{attrs.explanation}\n\t\t</span>\n\t</span>\n</span>\n',"app/feast-tpl!ui-block/button2/button2.html")});define("feast-tpl!ui-block/button2/button2.html",["feast-tpl!app/feast-tpl!ui-block/button2/button2.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/ico/ico.html",["feast"],function(a){return a.smartParse('<svg\n\tqa:id="ico:{_this.getSvgName()}">\n\t<bem:mod name="{_this.getSvgName()}"/>\n\t<bem:mod name="{attrs.mod}"/>\n\t<bem:mod name="secondary" test="attrs.secondary"/>\n\t<bem:mod name="size" value="{attrs.size}" test="attrs.size"/>\n\n\t\x3c!--<use xlink:href="#{_this.getSvgURI()}"></use>--\x3e\n\n\t<fn:var name="vdom" value="{_this.getSvgVDom()}"/>\n\n\t<fn:vdom data="vdom && vdom.children"/>\n\n\t<fn:for data="_this.getVDomAttrPairs(vdom)" as="pair" key="key">\n\t\t<fn:attr name="{pair.key}" value="{pair.value}"/>\n\t</fn:for>\n</svg>\n',"app/feast-tpl!ui-block/ico/ico.html")});define("feast-tpl!ui-block/ico/ico.html",["feast-tpl!app/feast-tpl!ui-block/ico/ico.html"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};define("icons",["require","exports","default-values","./icons-pack/icons-mail","./icons-pack/icons-vk"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importStar(b);c=__importStar(c);if(a.VK){Object.assign(exports,b,c)}else{Object.assign(exports,b)}});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/ico/ico",["require","exports","feast","feast-tpl!./ico.html","icons"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.svgson2vdom=void 0;a=__importDefault(a);b=__importDefault(b);c=__importStar(c);var d={"16-archive":"navigation:archive","16-arrow-back":"navigation:drop_previous_big","16-arrow-down-small":"navigation:drop_down_small","16-arrow-down":"navigation:drop_down_big","16-arrow-up-small":"navigation:drop_up_small","16-arrow-up":"navigation:drop_up_big","16-attach":"status:attach","16-auth":"categories:access","16-burger":"navigation:menu","16-calendar-month":"navigation:calendar_month","16-check-read":"wysiwyg:mail_read","16-checked":"status:done","16-clock":"status:time","16-close":"actions:close_big","16-cloud":"categories:cloud","16-compose":"actions:compose","16-currency-ruble":"categories:currency_rouble","16-delete":"actions:delete","16-download":"actions:download","16-draft":"categories:drafts","16-fees":"categories:fees","16-flag":"actions:favorite_on","16-filter":"actions:filter","16-folder":"navigation:folder","16-folder-move":"action:folder_move","16-forward-small":"actions:forward_small","16-forward":"actions:forward","16-government":"categories:government","16-receipts":"categories:receipts","16-important-round":"status:warning_round","16-important-triangle":"status:warning_triangle","16-important":"status:error","16-inbox":"categories:mail","16-link":"status:link","16-lock-off":"status:lock_off_small","16-lock-on":"status:lock_on_small","16-minimize":"actions:window_minimize","16-more-hor":"navigation:more","16-more-vert":"navigation:more_vertical","16-orders":"navigation:cart","16-pin":"actions:pin","16-point":"status:unread","16-reminder":"navigation:notification","16-reply-all":"actions:reply_all","16-reply-forward-small":"actions:forward_reply_small","16-reply-small":"actions:reply_small","16-reply":"actions:reply","16-search":"navigation:search","16-select-all":"actions:select_all","16-setting":"navigation:settings","16-spam-off":"actions:like","16-spam-on":"actions:dislike","16-tickets":"categories:ticket","16-travel":"categories:flight","16-school":"categories:school","16-games":"categories:games","20-checked":"status:done_big"};var e={xs:3*4,s:5*4,m:5*4,l:5*4,xl:6*4,xxl:8*4};var f=function(a,b){var c=[];var d=[{node:a,siblings:c}];var e=function(){var a=d.pop(),c=a.node,e=c.name,f=c.attrs,g=c.childs,h=a.siblings;var i={};f&&Object.keys(f).forEach(function(a){if(b&&a==="fill"){return}i[a]=f[a]});var j=[];g&&g.forEach(function(a){d.push({node:a,siblings:j})});h.unshift({tag:e||"",attrs:i,children:j})};while(d.length>0){e()}return c[0]};exports.svgson2vdom=f;var g=/:/g;function h(a){return a.toUpperCase().replace(g,"_")}exports.default=a.default.Block.extend({name:"ico",template:b.default,blocks:{},immutable:true,defaults:{size:"s",secondary:false,"remove-fill":true},getSvgName:function(){var a={xs:12,s:16,m:16,l:20,xl:20,xxl:20};var b=this.get("name");var c=this.get("size");var d=a[c||"s"];return d!=null?"".concat(d,"-").concat(b):b},getByOldName:function(){return this.getByName(d[this.getSvgName()])},getByName:function(a){if(a===void 0){a=null}a=h(a||this.get("name"));var b=c[a];var d=this.get("size");if(e[d]){b.attrs.width=e[d];b.attrs.height=e[d]}return b},getSvgVDom:function(){var a=this.getByOldName()||this.getByName();var b=this.get("name");var c=this.get("remove-fill");if(!a&&b){console.error("Icon not found: ".concat(b));return undefined}return(0,exports.svgson2vdom)(a||{},c)},getVDomAttrPairs:function(a){return a&&a.attrs&&Object.keys(a.attrs).map(function(b){return{key:b,value:a.attrs[b]}})||[]}})});define("feast-tpl!app/feast-tpl!ui-block/notification-badge/notification-badge.html",["feast"],function(a){return a.smartParse('<div>\n\t<div bem:elem="badge" fn:if="attrs.show" qa:id="{attrs[\'test-id\']}" style="{attrs.placementStyles}">\n\t\t<bem:mod name="color_{attrs[\'colorMode\']}" test="attrs[\'colorMode\']"/>\n\t\t<bem:mod name="size_{attrs.size}" test="attrs.size"/>\n\t</div>\n\t<fn:apply-match name="content"/>\n</div>\n',"app/feast-tpl!ui-block/notification-badge/notification-badge.html")});define("feast-tpl!ui-block/notification-badge/notification-badge.html",["feast-tpl!app/feast-tpl!ui-block/notification-badge/notification-badge.html"],function(a){return a});define("ui-block/notification-badge/notification-badge",["exports","feast","feast-tpl!./notification-badge.html","service/radars/index"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockSpec=undefined;var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}var h=exports.blockSpec={name:"notification-badge",template:e.default,isolateEvents:false,defaults:{"test-id":"notification-badge"},attrChanged:{ponymode:function a(){this.setInlineStyles()},show:function a(b){if(b){this.setInlineStyles()}}},didMount:function a(){if(this.get("show")){this.setInlineStyles();var b=this.get("radar-id");if(b&&typeof b==="string"){(0,f.default)({type:b})}}},getCssRule:function a(b){var c=this.get(b);var d=this.get("pony-"+b);if(this.get("ponymode")&&typeof d!=="undefined"){return b+": "+d+"px;"}if(typeof c!=="undefined"){return b+": "+c+"px;"}return""},setInlineStyles:function a(){var b=this;this.set({placementStyles:["top","bottom","left","right"].reduce(function(a,c){return a+b.getCssRule(c)},"")})}};exports.default=d.default.Block.extend(h)});define("ui-block/button2/button2",["exports","feast","feast-tpl!./button2.html","helpers/browser","service/radars/decorator","ui-block/ico/ico","ui-block/notification-badge/notification-badge"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=m(a);var h=m(b);var i=m(c);var j=m(d);var k=m(e);var l=m(f);function m(a){return a&&a.__esModule?a:{default:a}}exports.default=g.default.Block.extend((0,j.default)({events:[{name:"click-radar",rename:"click"}]})({name:"button2",template:h.default,defaults:{safari:i.default.safari,"hover-support":i.default.capabilities["hover-support"],icoSize:"s",centered:false,highlighted:false},blocks:{ico:k.default,"notification-badge":l.default},events:{"keydown:enter":"onKeydownEnter"},onKeydownEnter:function a(){var b=$(this.el);b.click()},focus:function a(){this.refs.wrapper.focus()},getAvailableTitle:function a(){if(this.is("shortcut")||this.is("short")||!this.is("text")){return this.get("title")||this.get("text")}else{return this.get("annotation")}}}))});define("feast-tpl!app/feast-tpl!ui-block/dataset/dataset.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="letterNotFound" value="{attrs[\'letter-not-found\']}"/>\n\t<bem:mod name="select-mode" value="{attrs[\'select-mode\'] ? \'on\' : \'off\'}"/>\n\n\t<fn:if test="!letterNotFound">\n\t\t<fn:var name="range" value="{_this.recalculateVisibleRange()}"/>\n\n\t\t<div bem:elem="items" qa:id="dataset-items" ref="items"></div>\n\n\t\t<fn:if test="__vmatches[\'navigator\']">\n\t\t\t<fn:apply-match name="navigator" args="range"/>\n\t\t</fn:if>\n\t</fn:if>\n\n\t<fn:if test="letterNotFound || !attrs.models.length">\n\t\t<fn:apply-match name="dataset-empty" />\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/dataset/dataset.html")});define("feast-tpl!ui-block/dataset/dataset.html",["feast-tpl!app/feast-tpl!ui-block/dataset/dataset.html"],function(a){return a});define("helpers/shallow-compare",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.shallowCompare=a;function a(a,b){var c=Object.keys(a);var d=Object.keys(b);if(c.length!==d.length){return false}var e=void 0;for(var f=0;f<c.length;f++){e=c[f];if(a[e]!==b[e]){return false}}return true}});define("feast-tpl!app/feast-tpl!ui-block/scrollable/scrollable.html",["feast"],function(a){return a.smartParse('<div qa:id="scrollable">\n\t\x3c!-- Костыль, конечно.. Но верстка сайдбара не оставляет большого выбора. Используется в sidebar-folders --\x3e\n\t<bem:mod name="id" test="attrs.id" value="{attrs.id}"/>\n\n\t<bem:mod name="opaque" test="attrs.opaque"/>\n\t<bem:mod name="substrated" test="attrs.substrated"/>\n\t<bem:mod name="footer" test="attrs.footer"/>\n\t<bem:mod name="bright" test="attrs.bright"/>\n\t<bem:mod name="content" test="attrs.content"/>\n\t<bem:mod name="sidebar" test="attrs.sidebar"/>\n\t<bem:mod name="ponymode" test="attrs.ponymode"/>\n\t<bem:mod name="full-height" test="attrs[\'full-height\']" />\n\t<bem:mod name="styled" />\n\t<bem:mod name="background-transparent" test="attrs[\'background-transparent\']" />\n\n\t<bem:mod name="disable-horizontal-scroll" test="attrs[\'disable-horizontal-scroll\']"/>\n\n\t<bem:mod name="scroll-style" value="{attrs[\'scroll-style\']}"/>\n\n\t<div bem:elem="container" ref="container">\n\t\t<bem:mod name="left-gap" test="attrs[\'left-gap\']" />\n\t\t<fn:apply-match name="default"/>\n\n\t\t<div bem:elem="footer" fn:if="attrs.footer"/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/scrollable/scrollable.html")});define("feast-tpl!ui-block/scrollable/scrollable.html",["feast-tpl!app/feast-tpl!ui-block/scrollable/scrollable.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/g-silent",["require","exports","@mail-core/dashboard","cfg","default-values","helpers/lazy","modernizr-custom"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.gSilent=void 0;b=__importDefault(b);e=__importDefault(e);var f=function(){};var g=function(g){var h=g.el,i=g.holder,j=g.timeout,k=j===void 0?50:j;if(!b.default.build&&(!h||!i)){console.warn("gSilent function requires target elements as arguments");return f}if(b.default.build&&(!h||!i)){return f}if(!e.default.pointerevents){return f}var l=false;var m=function(a){if(l!==a){l=a;if(!c.G_SELENT_OFF){h.classList.toggle("g-silent",l)}}};var n=0;var o=function(){var b=Date.now();var c=b-n;if(c<k&&c>0){setTimeout(o,k-c)}else{n=0;var e=l;if(e){a.userKeeper.time("g-silent-latency-off")}m(false);if(e){(0,d.nextFrame)(function(){a.userKeeper.timeEnd("g-silent-latency-off",{score:"latency",dwh:true})})}}};var p=function(){if(n===0){setTimeout(o,k)}n=Date.now()};var q=function(){var b=!l;if(b){a.userKeeper.time("g-silent-latency-on")}m(true);p();if(b){(0,d.nextFrame)(function(){a.userKeeper.timeEnd("g-silent-latency-on",{score:"latency",dwh:true})})}};i.addEventListener("scroll",q,e.default.passiveeventlisteners?{passive:true}:false);i.addEventListener("resize",q);return function(){i.removeEventListener("scroll",q);i.removeEventListener("resize",q)}};exports.gSilent=g;exports.default=exports.gSilent});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/scrollable/scrollable",["require","exports","@mail/xray","cfg","default-values","feast","feast-tpl!./scrollable.html","helpers/browser","helpers/g-silent","modernizr-custom","service/radars/index","utils/util"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);var k=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.webkitRequestAnimationFrame;var l=200;var m=!!(window.performance&&typeof performance.now==="function"&&typeof k==="function");var n={name:"scrollable",template:e.default,isolate:false,gSilentUnsubscribe:null,scrollUnsubscribe:null,wasPopstate:false,blocks:{},defaults:{name:"default",substrated:false,"measure-fps":false,silent:false,"scroll-style":"traditional","full-height":false},_scrollingPid:void 0,_scrollingFrames:0,_scrollingStartTs:0,didMount:function(){var b=this;this._lastScrollTop=0;this._scrollDirection=null;this.emitOnTop=parseInt(this.attrs["emit-ontop"],10)||null;this.emitOnBottom=parseInt(this.attrs["emit-onbottom"],10)||null;this.handleScrollChange=j.default.debounce(this.handleScrollChange,250,this);this.sendOnBottomAnalytics=j.default.debounce(function(){if(typeof b.isMounted==="function"&&typeof b.get==="function"&&b.isMounted()&&b.attrs){a.default.send("".concat(b.get("name"),"_scroll-onbottom"))}},250,this);if(this.emitOnTop||this.emitOnBottom){var c=this.handleScroll.bind(this);this.el.addEventListener("scroll",c,h.default.passiveeventlisteners?{passive:true}:false);this.scrollUnsubscribe=function(){return b.el.removeEventListener("scroll",c)}}if(!f.default.isIE){this.gSilentUnsubscribe=(0,g.default)({el:this.refs.container||this.el.firstChild,holder:this.el})}this.handleScrollEnd=this.handleScrollEnd.bind(this);this.handleAnimationFrame=this.handleAnimationFrame.bind(this);this.broadcast("scrollable:mount",{scrollableElement:this.el,name:this.attrs.name})},didUnmount:function(){this.gSilentUnsubscribe&&this.gSilentUnsubscribe();this.scrollUnsubscribe&&this.scrollUnsubscribe();this.broadcast("scrollable:unmount",{scrollableElement:this.el,name:this.attrs.name})},getScrollDir:function(){return this._scrollDirection},getScrollPos:function(){var a={x:0,y:0};if(this.el&&typeof this.el.scrollLeft!="undefined"){a={x:this.el.scrollLeft,y:this.el.scrollTop}}return a},scrollTo:function(a,b){if(this.isMounted()){a=!a&&a!==0?false:parseInt(a,10);b=!b&&b!==0?false:parseInt(b,10);b!==false&&(this.el.scrollTop=b);a!==false&&(this.el.scrollLeft=a)}},reset:function(){this.scrollTo(0,0)},handleScroll:function(a){var b=a.target;var c=b.scrollTop;var d=b.scrollHeight;var e=b.offsetHeight;var f=c+e;var g=c-this._lastScrollTop>0;this._lastScrollTop=c;this._scrollDirection=g?"down":"up";if(!this.is("silent")){if(this.emitOnBottom&&g&&f+this.emitOnBottom>=d){this.broadcast("scroll:onbottom");this.sendOnBottomAnalytics()}if(this.emitOnTop&&!g&&c<this.emitOnTop){this.broadcast("scroll:ontop")}this.broadcast("scroll:change",c)}this.handleScrollChange();if(!m||!this.is("measure-fps")){return}if(!this._scrollingPid){this._scrollingFrames=0;this._scrollingStartTs=performance.now();k(this.handleAnimationFrame)}window.clearTimeout(this._scrollingPid);this._scrollingPid=window.setTimeout(this.handleScrollEnd,l)},handleScrollChange:function(){var a=!!b.default.qa;if(a&&this.isMounted()&&this.el){this.el.setAttribute("data-qa-value",this._lastScrollTop)}},handleScrollEnd:function(){delete this._scrollingPid;if(this.destroyed||this.zombie){return}var a=(performance.now()-this._scrollingStartTs)/1e3;var b=Math.round(this._scrollingFrames/a);(0,i.default)({type:"fps_scroll_".concat(this.get("name")),value:b,intervals:[["old",b]]});if(c.IS_DEBUG){console.log("FPS",this.get("name"),b)}if(this.el.scrollTop===0&&this.wasPopstate){this.broadcast("scrollable:advontop");this.wasPopstate=false}this.broadcast("scroll:end")},handleAnimationFrame:function(){if(this._scrollingPid){this._scrollingFrames++;k(this.handleAnimationFrame)}}};var o=d.default.Block.extend(n);o.getScrollableBlock=function(a){var b=o.getInstances();return b.find(function(b){return b.contains(a)})};o.getScrollableElem=function(a){var b=o.getInstances().map(function(a){return a.el});return b.find(function(b){return b.contains(a)})};exports.default=o});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/dataset/dataset",["require","exports","@mail/xray","default-values","feast","feast-tpl!./dataset.html","helpers/shallow-compare","mail/Folder","service/adv/config","service/smokescreen","ui-block/scrollable/scrollable"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.sendAttachesRadar=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);i=__importDefault(i);var j=10;var k=16;var l=typeof window.requestAnimationFrame==="function";var m="scrollBehavior"in document.documentElement.style;function n(a){if(l){window.requestAnimationFrame(a);return}window.setTimeout(a,k)}function o(c){if(b.LETTER_PREVIEW_RADAR){var d=0;var e=c.find(function(a){return a.get("folder")});if(e){var g=Number(e.get("folder"));c.forEach(function(a){var b=a.get("attachments_count");var c=a.meta("previews");if(b&&!c){d+=b;a.meta("previews",true)}});if(g!==f.default.TOMYSELF&&g!==f.default.INBOX){g="oth"}if(d>0){a.default.send("lp-count-".concat(g),{v:d})}}}}exports.sendAttachesRadar=o;exports.default=c.default.Block.extend((0,h.withWelter)({name:"dataset",template:d.default,performanceTrace:"track",isolateEvents:false,blocks:{},defaults:{models:[],"item-height":0,persist:false,"select-mode":false},attrChanged:{models:function(){delete this.scrollTop;this.handleScroll()},"x-ponymode":function(a){(0,g.setRBParam)("ponymode",a?1:0)}},handleSelected:function(a){var b=a.details;b.invert("selected")},handlePrepareDragElement:function(a,b,c){console.warn("".concat(this.block,"#handlePrepareDragElement — not implemented"),c)},constructor:function(){c.default.Block.apply(this,arguments);this.handleScroll=this.handleScroll.bind(this);this.handleAnimationFrame=this.handleAnimationFrame.bind(this);this._visibleBlockMeasures={};this._itemsCached={};this.height=0;this._blockMeasures={};this._animation=undefined},didMount:function(){var a=this.el;var b=i.default.getScrollableBlock(this);if(b.el){a=b.el}this._scrollable=a||document.body;this.$on(this._scrollable,"scroll","handleScroll");this.handleScroll(true);if(window.addEventListener){window.addEventListener("resize",this.handleScroll)}},didUpdate:function(a){var b=this.is("select-mode");if(!b){for(var c in this.attrs){if(c==="key"||c==="models"){continue}if(a[c]!=this.attrs[c]){b=true;break}}}this.updateItems(b)},didUnmount:function(){window.removeEventListener("resize",this.handleScroll);for(var a in this._itemsCached){this.removeItemInstance(this._itemsCached[a])}this._itemsCached=undefined},handleScroll:function(a,b){if(a===void 0){a=null}if(b===void 0){b=false}if(!this._scrollable){return}var c=!a;var d=this._scrollable.scrollTop;var e=this.scrollTop;if(d<0){d=0}if(!b&&d===e){return}var f=this,g=f.visibleElementTop,h=f.visibleElementBottom;var i=this._scrollable.clientHeight;if(this._animation){return}if(g!==null&&h!==null&&g<d&&h>d+i){c=true}this.scrollTop=d;this.viewHeight=i;if(!c){this.updateItems()}this.callScrollEventHandler({scrollTop:d,dataset:this})},updateScroll:function(){this.handleScroll(null,true)},getHeightForItem:function(a){var b=this.get("item-height");if(typeof b==="function"){return b(a)}return b},getItemPersist:function(a){var b=this.get("persist");if(typeof b==="function"){return b(a)}return b===true},recalculateVisibleRange:function(){var a;var b=this.get("models");var c=parseInt(this.get("bottom-spacer"),10)||300;var d=parseInt(this.get("top-spacer"),10)||300;this._blockMeasures={};var e=this,f=e.visibleElementTop,g=e.visibleElementBottom;var h=this,i=h.viewHeight,j=h.scrollTop;var k=Math.max(j-d,0);var l=j+i+c;var m={models:[],offset:0,placeholder:{top:0,height:0}};f=null;g=null;var n;var o;var p=0;var q;for(var r=0;r<b.length;r++){q=b[r];n=this.getHeightForItem(q);o=this.getItemPersist(q);p+=n;m.placeholder.height+=n;this._blockMeasures[q.id]={offset:p,height:n};if(!o&&p<k){m.placeholder.top+=n}else if(o||p-n<=l){m.models.push({model:q,index:r});if(!o){if(f===null){f=p-n;m.offset=r}else{g=p}}}}this.visibleElementTop=f;this.visibleElementBottom=g;this.height=p;this._lastCalculatedRange=m;(a=this.get("handle-new-range"))===null||a===void 0?void 0:a(m);return m},updateItems:function(a){if(a===void 0){a=false}var b=this.recalculateVisibleRange();var d=this.refs.items;if(!d){return}d.style.height=b.placeholder.height+"px";d.style.paddingTop=b.placeholder.top+"px";var e={mounts:[],updates:[],partialUpdates:{}};var f;o(b.models.map(function(a){var b=a.model;return b}));for(var g=0;g<b.models.length;g++){f=this.createItemElement(a,e,b.models[g].model,b.models[g].index,b.models.length);if(f&&f!==d.children[g]){d.insertBefore(f,d.children[g])}}var h=d.children.length;var i=b.models.length;for(var g=i;g<h;g++){d.removeChild(d.children[i])}var j={};var k=Math.max(e.mounts.length,e.updates.length);var l;for(var g=0;g<k;g++){if(g<e.mounts.length){l=e.mounts[g];l.$handleEvent({type:"$mount"})}if(g<e.updates.length){c.default.Block.__callDidUpdate(e,g,j)}}this.collectGarbageFromCache(a);var m=this.get("items-update");if(m){m(!this._itemsUpdated);this._itemsUpdated=true}},collectGarbageFromCache:function(a){if(a===void 0){a=false}var b;for(var c in this._itemsCached){b=this._itemsCached[c];if(a&&b.hits===0){this.removeItemInstance(b);delete this._itemsCached[c]}if(b.hits>0){b.hits--}}},removeItemInstance:function(a,b){if(b===void 0){b=false}if(a.onRemove){a.onRemove()}c.default.vdom.destroy(a.virtualNode);if(b&&a.element&&a.element.parentNode){a.element.parentNode.removeChild(a.element)}},createItemElement:function(a,b,d,f,g){var h=this;var i="".concat(d.id,"__").concat(d.cid);var j=this.get("item-context")(d,f,g);var k=this._itemsCached[i];if(k){k.hits++;if(!a){a=!(0,e.shallowCompare)(j,k.context)}k.context=j;if(a){this.updateItemFragment(k,b,d,f,g)}return k.element}var l={tag:"MAIN",attrs:{},events:{},children:[],dom:{firstElementChild:null}};var m=this.getTemplateMatch("dataset-item");m(l,"".concat(this.key,"::createItemElement::").concat(i),function(a){return a},b,d,f,g,j);if(!l.children.length){return undefined}l=c.default.vdom.create(l);k={key:i,context:j,element:l.dom.firstElementChild,virtualNode:l,hits:1};this._itemsCached[i]=k;if(d.on){var n=function(){if(h.isMounted()){h.removeItemInstance(k,true);delete h._itemsCached[i]}};d.on("destroy",n);k.onRemove=function a(){d.off("destroy",n)};d.on("destroy",n)}return k.element},updateItemFragment:function(a,b,d,e,f){var g={tag:"MAIN",attrs:{},events:{},children:[]};var h=this.getTemplateMatch("dataset-item");h(g,"".concat(this.key,"::createItemElement::").concat(a.key),function(a){return a},b,d,e,f,a.context);a.virtualNode=c.default.vdom.update(a.virtualNode,g)},getLastCalculatedRange:function(){return this._lastCalculatedRange||this.recalculateVisibleRange()},callScrollEventHandler:function(a){var b=this.get("handle-scroll");if(typeof b==="function"){b(a)}},getBlockMeasuresByModelId:function(a){return this._blockMeasures[a]},getScrollTop:function(){return this.scrollTop||this._scrollable&&this._scrollable.scrollTop},getViewHeight:function(){return this.viewHeight},isScrolledToBottom:function(){var a=this.get("models");if(!a){return false}if(!a.length){return true}var b=a[a.length-1].id;var c=this.getBlockMeasuresByModelId(b);if(!c){return false}return this.getScrollTop()+this.getViewHeight()>=c.offset},scrollTo:function(a,b){var c=this._scrollable;if(!c){return}var d="smooth";var e="auto";if(b&&b.behavior!==undefined){d=b.behavior}if(b&&b.duration!==undefined){e=b.duration}var f=m&&d==="smooth"&&e==="auto";if(f){c.scrollTo({top:a,behavior:d});return Promise.resolve()}if(d==="instant"){c.scrollTop=a;return Promise.resolve()}if(e==="auto"){e=1e3}var g;var h=new Promise(function(a){g=a});var i=Date.now();var j={start:c.scrollTop,end:a,duration:e,promise:h,resolve:g,startTs:i,lastTs:i};if(!this._animation){n(this.handleAnimationFrame)}this._animation=j;return h},handleAnimationFrame:function(){var a=this,b=a._animation,c=a._scrollable,d=a.height;if(!b){return}var e=Date.now();var f=b.startTs+b.duration;if(Math.abs(e-f)<j||e>f){c.scrollTop=b.end;this._animation=undefined;this.handleScroll({},true);b.resolve();return}var g=e-b.lastTs;var h=b.end-b.start;var i=h*(g/b.duration);var k=c.scrollTop+i;k=Math.max(k,0);k=Math.min(k,d);c.scrollTop=k;b.lastTs=e;n(this.handleAnimationFrame)}}))});define("feast-tpl!app/feast-tpl!ui-block/discounts/discounts.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="3pane" test="attrs[\'3pane\']"/>\n\n\t<b:gallery\n\t\tcontrols="{_this.getGalleryControls()}"\n\t\tremit:scroll-end="gallery:scroll:end"\n\t\tremit:all-blocks-visible="all:blocks:visible"\n\t\tremit:all-blocks-rendered="gallery:blocks:rendered"\n\t>\n\t\t<fn:for data="attrs.discounts" as="discount" key="i">\n\t\t\t<b:discounts-item\n\t\t\t\t\tkey="{i}"\n\t\t\t\t\tdefaultVisible="{i < attrs.visibleItemsCount}"\n\t\t\t\t\ttitle="{discount.shop}"\n\t\t\t\t\tvalue="{discount.sale.discount}"\n\t\t\t\t\ttext="{discount.description}"\n\t\t\t\t\tendDate="{discount.sale.end_date}"\n\t\t\t\t\timage="{_this.getThreadImage(discount.message_id)}"\n\t\t\t\t\tcolors="{_this.getDiscountColors(discount.from)}"\n\t\t\t\t\tpromocodes="{discount.promocodes}"\n\t\t\t\t\tpromoDiscount="{discount.is_promo}"\n\t\t\t\t\tnew="{_this.isNewDiscount(discount.message_id)}"\n\t\t\t\t\thref="{_this.getThreadHref(discount.message_id)}"\n\t\t\t\t\t3pane="{attrs[\'3pane\']}"\n\t\t\t\t\twidth="{attrs[\'width\']}"\n\t\t\t\t\tmodel="{_this.getModel(discount.message_id)}"\n\t\t\t\t\tuse:mediator="letters-actions themes-manager"\n\t\t\t/>\n\t\t</fn:for>\n\n\t\t<fn:if test="attrs.discounts.length && !attrs.disableDiscountsBlock">\n\t\t\t<b:discounts-item\n\t\t\t\t\tkey="settings"\n\t\t\t\t\ttitle="{i18n(\'Скидки\')}"\n\t\t\t\t\ttext="{i18n(\'Почта находит скидки в рассылках и показывает здесь, чтобы вы их не потеряли.\')}"\n\t\t\t\t\t3pane="{attrs[\'3pane\']}"\n\t\t\t\t\tswitch="{!!attrs.router.model.uiThreadsSettings.discounts}"\n\t\t\t\t\tremit:switch="discounts:switch"\n\t\t\t\t\tdisabled="{attrs[\'_progress\']}"\n\t\t\t\t\twidth="{attrs[\'width\']}"\n\t\t\t\t\tsystem\n\t\t\t/>\n\t\t</fn:if>\n\n\t\t<fn:if test="!attrs.discounts.length">\n\t\t\t<b:discounts-item\n\t\t\t\t\tkey="settings"\n\t\t\t\t\ttitle="{i18n(\'Нет скидок\')}"\n\t\t\t\t\ttext="{i18n(\'Возможно, вам не приходили письма со скидками, или скидки перестали действовать\')}"\n\t\t\t\t\t3pane="{attrs[\'3pane\']}"\n\t\t\t\t\twidth="{attrs[\'width\']}"\n\t\t\t\t\tsystem\n\t\t\t/>\n\t\t</fn:if>\n\t</b:gallery>\n</div>\n',"app/feast-tpl!ui-block/discounts/discounts.html")});define("feast-tpl!ui-block/discounts/discounts.html",["feast-tpl!app/feast-tpl!ui-block/discounts/discounts.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/discounts-item/discounts-item.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="width-small" test="attrs[\'width\'] === \'small\'" />\n\t<bem:mod name="3pane" test="attrs[\'3pane\']" />\n\t<div bem:elem="wrap">\n\t\t<bem:mod name="has-hover" test="attrs.href" />\n\t\t<a remit:click="discounts-click" bem:elem="inner">\n\t\t\t<fn:var name="hasTagBlock" value="{attrs.value || attrs.endDate}" />\n\t\t\t<fn:var name="promocode" value="{_this.getLastPromocode()}" />\n\t\t\t<fn:var name="salesValue" value="{String(attrs.value.size) + \' \' + attrs.value.currency}" />\n\t\t\t\x3c!-- Цвета для промо-скидок --\x3e\n\t\t\t<fn:var name="promoColors" value="{attrs.promoDiscount && attrs.colors}" />\n\t\t\t<fn:var name="promoColorsThemed"\n\t\t\t\tvalue="{attrs[\'dark-mode\'] ? promoColors && promoColors.dark : promoColors && promoColors.light}" />\n\t\t\t<fn:var name="discountBackground" value="{promoColorsThemed && promoColorsThemed.background}" />\n\t\t\t<fn:var name="tagBackground" value="{promoColorsThemed && promoColorsThemed.tag_background}" />\n\t\t\t<fn:var name="tagText" value="{promoColorsThemed && promoColorsThemed.tag_text}" />\n\n\t\t\t<fn:attr name="href" value="{attrs.href}" fn:if="attrs.href" />\n\n\t\t\t<bem:mod name="no-text-clamp" test="!hasTagBlock" />\n\n\t\t\t<fn:attr name="style" value="background-color: {discountBackground};" fn:if="discountBackground" />\n\n\t\t\t<div bem:elem="cross-container" fn:if="!attrs.system">\n\t\t\t\t<b:ico name="actions:close_big" size="xs" secondary remit:click.prevent.stop="mark:unpinned"\n\t\t\t\t\tevent:details="{model:attrs.model}" />\n\t\t\t</div>\n\n\t\t\t<div bem:elem="header">\n\t\t\t\t<b:avatar src="{(attrs.system ? _this.getBrandLogo() : attrs.image) || attrs.defaultImage}" size="s"\n\t\t\t\t\twith-border="{false}" />\n\n\t\t\t\t<div bem:elem="title" data-title-mode="overflow">\n\t\t\t\t\t<fn:attr name="title" value="{attrs.title}" />\n\n\t\t\t\t\t{attrs.title}\n\t\t\t\t</div>\n\n\t\t\t\t<div bem:elem="new" fn:if="attrs.new">\n\t\t\t\t\t{i18n(\'Новая\')}\n\t\t\t\t</div>\n\n\t\t\t\t<div bem:elem="switch" fn:if="attrs.switch !== undefined">\n\t\t\t\t\t<b:react-2kit-async component="Switch" compact checked="{!!attrs.switch}"\n\t\t\t\t\t\tdisabled="{!!attrs.disabled}" onChange="{_this.handleSwitch}" use:mediator="themes-manager" />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="tag-block" fn:if="hasTagBlock">\n\t\t\t\t<span bem:elem="tag" fn:if="attrs.value" ref="tag">\n\t\t\t\t\t<fn:attr name="style" value="background-color: {tagBackground};" fn:if="tagBackground" />\n\n\t\t\t\t\t<span bem:elem="value" data-title-mode="overflow">\n\t\t\t\t\t\t<fn:attr name="style" value="color: {tagText};" fn:if="tagText" />\n\t\t\t\t\t\t<fn:attr name="title" value="{salesValue}" />\n\t\t\t\t\t\t{salesValue}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\n\t\t\t\t<div bem:elem="promocode" remit:click.prevent.stop="promocode-click">\n\t\t\t\t\t<bem:mod name="hidden" test="!attrs.promocodes || !attrs.promocodes.length" />\n\t\t\t\t\t<bem:mod name="copy-hidden" test="!_this.isCopySupported()" />\n\t\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t\t{i18n(\'Промокод\')}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="promocode-value">\n\t\t\t\t\t\t{promocode}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="copy" ref="copy-promocode">\n\t\t\t\t\t\t<fn:attr name="style" value="background-color: {tagBackground};" fn:if="tagText" />\n\t\t\t\t\t\t{i18n(\'Копировать промокод\')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\n\t\t\t\t<span bem:elem="end-date" ref="end-date" fn:if="!attrs.promocodes || !attrs.promocodes.length">\n\t\t\t\t\t<bem:mod name="hidden" test="attrs.endDate.is_default" />\n\t\t\t\t\t{attrs.endDate | formatDate}\n\t\t\t\t</span>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="text" data-title-mode="overflow">\n\t\t\t\t<bem:mod name="line-clamp" test="hasTagBlock" />\n\t\t\t\t<bem:mod name="system" test="attrs.system" />\n\t\t\t\t<fn:attr name="title" value="{attrs.text}" />\n\n\t\t\t\t{attrs.text}\n\t\t\t</div>\n\t\t</a>\n\t</div>\n</div>',"app/feast-tpl!ui-block/discounts-item/discounts-item.html")});define("feast-tpl!ui-block/discounts-item/discounts-item.html",["feast-tpl!app/feast-tpl!ui-block/discounts-item/discounts-item.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/avatar/avatar.html",["feast"],function(a){return a.smartParse('<div qa:id="selected:{!!attrs.selected}">\n\t<bem:mod name="rounded"/>\n\t<bem:mod name="selectable" test="attrs.selectable"/>\n\t<bem:mod name="selected" test="attrs.selected"/>\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="size_{attrs.size}" test="attrs.size"/>\n\t<bem:mod name="ico" test="!attrs.src" />\n\t<bem:mod name="anonymous" test="attrs.anonymous" />\n\n\t<span bem:elem="img">\n\t\t<bem:mod name="ico" test="!attrs.src" />\n\t\t<bem:mod name="with-border" test="attrs[\'with-border\']" />\n\t\t<fn:if test="attrs.src">\n\t\t\t<fn:attr name="style" value="{_this.getImage()} {_this.getBgColor()} {_this.getIcoColor()}"/>\n\t\t</fn:if>\n\t\t<fn:if test="!attrs.src">\n\t\t\t<fn:attr name="style" value="{_this.getBgColor()} {_this.getIcoColor()}" />\n\t\t\t<fn:if test="attrs.ico">\n\t\t\t\t<b:ico name="{attrs.ico}" size="{attrs[\'ico-size\']}" />\n\t\t\t</fn:if>\n\t\t</fn:if>\n\t</span>\n</div>\n',"app/feast-tpl!ui-block/avatar/avatar.html")});define("feast-tpl!ui-block/avatar/avatar.html",["feast-tpl!app/feast-tpl!ui-block/avatar/avatar.html"],function(a){return a});define("ui-block/avatar/avatar",["exports","feast","feast-tpl!./avatar.html","ui-block/ico/ico"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"avatar",template:e.default,immutable:true,blocks:{ico:f.default},defaults:{"with-border":true},getImage:function a(){return'background-image: url("'+this.get("src")+'");'},getBgColor:function a(){return"background-color: "+(this.get("bg-color")||"transparent")+";"},getIcoColor:function a(){var b="";if(this.get("ico-color")){b="fill: "+this.get("ico-color")+";"}return b},didMount:function a(){this.el.classList.add("stop-animate")}})});define("feast-tpl!app/feast-tpl!ui-block/react-2kit-async/react-2kit-async.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:attr name="class" value="{attrs[\'class-name\']}" test="!!attrs[\'class-name\']"/>\n</div>\n',"app/feast-tpl!ui-block/react-2kit-async/react-2kit-async.html")});define("feast-tpl!ui-block/react-2kit-async/react-2kit-async.html",["feast-tpl!app/feast-tpl!ui-block/react-2kit-async/react-2kit-async.html"],function(a){return a});define("ui-block/react-async/react-async-deps",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/react-async/react-async-core",["require","exports","default-values","service/getModule","ui-block/react-async/react-async-deps"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ReactAsyncCore=void 0;b=__importDefault(b);var d=function(){function d(e,f,g){if(f===void 0){f=[]}if(g===void 0){g={}}var h=this;this._options=g;this._loadPromise=Promise.resolve();this._depsLoaded=true;this._props={};this._mounted=false;this._componentGetter=e;if(a.USE_WEBPACK_BUILD&&!a.ASYNC_RENDER_REACT_IN_WP_BUILD){d._depsMap.react=c.React;d._depsMap["react-dom"]=c.ReactDOM;d._depsMap["@mail/vkui/2kit"]=c.MailVKUI2kit}else{f.push(["react",new Promise(function(a,b){require(["react"],a,b)}).then(__importStar)],["react-dom",new Promise(function(a,b){require(["react-dom"],a,b)}).then(__importStar)],["@mail/vkui/2kit",(0,b.default)("@mail/vkui/2kit")])}if(this._options.useErrorBoundary&&!c.ErrorBoundary){f.push(["ui-react",new Promise(function(a,b){require(["ui-react"],a,b)}).then(__importStar)])}if(this._options.customNode){f.push(["",Promise.resolve(this._options.customNode).then(function(a){h._customNode=a})])}var i=f.filter(function(a){var b=a[0];return!b||!(b in d._depsMap)});if(i.length){this._depsLoaded=false;this._loadPromise=Promise.all(i.map(function(a){var b=a[1];return b})).then(function(a){h._depsLoaded=true;a.forEach(function(a,b){var c=i[b][0];if(c){d._depsMap[c]=a}})})}}d.prototype.loadPromise=function(){return this._loadPromise};d.prototype.depsLoaded=function(){return this._depsLoaded};d.prototype.getDep=function(a){return d._depsMap[a]};d.prototype.setProps=function(a){this._props=a;if(this._mounted){this._renderReact()}};d.prototype._mountWhenDepsLoaded=function(a){this._node=this._customNode||a;this._renderReact()};d.prototype.mount=function(a){var b=this;this._mounted=true;if(this.depsLoaded()){this._mountWhenDepsLoaded(a);return}this.loadPromise().then(function(){b._mountWhenDepsLoaded(a)})};d.prototype.umount=function(){var a=this._node;this._mounted=false;if(a&&this._depsLoaded){this.getDep("react-dom").unmountComponentAtNode(a)}};d.prototype.getComponent=function(){var a;return(a=this._componentRef)===null||a===void 0?void 0:a.current};d.prototype._renderReact=function(){var a;if(!this._depsLoaded||!this._mounted){return}var b=this.getDep("react");var d=this.getDep("react-dom");this._componentRef=b.createRef();var e=b.createElement(this._componentGetter(this),__assign(__assign({},this._props),{_node:this._node,ref:this._componentRef}),null);var f=e;if(this._options.useErrorBoundary){f=b.createElement(c.ErrorBoundary!==null&&c.ErrorBoundary!==void 0?c.ErrorBoundary:this.getDep("ui-react").default.ErrorBoundary,{id:(a=this._options.blockRadarId)!==null&&a!==void 0?a:"react"},e)}d.render(f,this._node)};d._depsMap={};return d}();exports.ReactAsyncCore=d});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/react-2kit-async/react-2kit-async",["require","exports","feast","feast-tpl!./react-2kit-async.html","ui-block/react-async/react-async-core"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);exports.default=a.default.Block.extend({name:"react-2kit-async",template:b.default,defaults:{component:null},constructor:function(){var b=this;a.default.Block.apply(this,arguments);this._reactAsyncCore=new c.ReactAsyncCore(function(a){return a.getDep("@mail/vkui/2kit")[b.get("component")]},[],{provideTheme:true})},didMount:function(){this._setProps();this._reactAsyncCore.mount(this.el)},didUnmount:function(){this._reactAsyncCore.umount()},set:function(){a.default.Block.prototype.set.apply(this,arguments);this._setProps()},getComponent:function(){return this._reactAsyncCore.getComponent()},_setProps:function(){if(this.isMounted()){var a=__assign({},this.getAttrsSnapshot());this._reactAsyncCore.setProps(a)}}})});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/discounts-item/discounts-item",["require","exports","@mail/xray","cfg","feast","feast-mod/letter-date","feast-tpl!./discounts-item.html","helpers/copyToClipboard","mail/Message","service/notify","service/radars/index","ui-block/avatar/avatar","ui-block/ico/ico","ui-block/react-2kit-async/react-2kit-async"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importStar(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);var m=c.default.Block.extend({name:"discounts-item",template:e.default,blocks:{avatar:j.default,ico:k.default,"react-2kit-async":l.default},notVisualAttributes:{defaultVisible:true},mods:{formatDate:function(a){if(a.is_default){return""}return i18n("до {date}",{date:(0,d.letterMonthDate)(a.date,true)})}},defaults:{title:i18n("Название скидки"),text:i18n("Краткое описание скидки с условиями, при которых она действительна."),image:undefined,colors:{},defaultImage:b.default.get("urls.avatarUrl")+"/pic?width=90&height=90",disabled:false,width:"default",endDateNewLine:false},events:{"discounts-click":"handleClick","promocode-click":"handlePromocodeClick"},isCopySupported:f.isCopySupported,constructor:function(){c.default.Block.apply(this,arguments);this.handleSwitch=this.handleSwitch.bind(this)},didMount:function(){var a=this.refs["tag"];var b=this.refs["end-date"];if(!a||!b){return}if(a.getBoundingClientRect().top!==b.getBoundingClientRect().top){this.set({endDateNewLine:true})}},handlePromocodeClick:function(){var a=this;if((0,f.isCopySupported)()){(0,f.default)(this.get("promocodes")[0]).then(function(){h.default.add({qa:"discount-copy-promocode",text:i18n("Промокод скопирован")});var b=g.default.all.get(a.get("model").id);(0,i.default)({type:"discount_promocode_copy",dwh:{letterId:b===null||b===void 0?void 0:b.get("id"),jsonld:b===null||b===void 0?void 0:b.get("discount.from_jsonld")}})}).catch(function(){(0,i.default)("discount_promocode_copy_error")})}},handleSwitch:function(b){a.default.send("discounts_switch_".concat(b),{i:{"from-item":1}});this.broadcast("switch",b)},getBrandLogo:function(){return b.default.get("urls.logoLetterUrl")},handleClick:function(){if(!this.is("href")||!this.is("model")){return}var b=g.default.all.get(this.get("model").id);var c=b.get("thread_id");var d=b.get("flags.unread");a.default.send("open_discount_thread",{dwh:{from:"discount_block",threadId:c,letterId:b.get("id"),unread:d,defaultVisible:this.get("defaultVisible"),jsonld:b.get("discount.from_jsonld"),relevant:b.get("flags.is_relevant")}})},getLastPromocode:function(){var a=this.get("promocodes");return a&&a[0]&&a[0].toUpperCase()}});exports.default=m});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/discounts/discounts",["require","exports","@mail/flags","data-source/actions","default-values","feast","feast-tpl!./discounts.html","helpers/data-source-dispatch","helpers/getCurrentTimestamp","helpers/letter","mail/Message","ui-block/discounts-item/discounts-item","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);i=__importDefault(i);j=__importDefault(j);var l=d.default.Block.extend({name:"discounts",template:e.default,blocks:{"discounts-item":j.default},lazyBlocks:{gallery:k.lazyUIGallery},defaults:{_progress:false,discounts:[],disableDiscountsBlock:true,visibleItemsCount:0},events:{"discounts:switch":"handleDiscountsSwitch","gallery:scroll:end":"handleGalleryScrollEnd","all:blocks:visible":"handleGalleryScrollEnd","gallery:blocks:rendered":"handleGalleryBlocksRendered"},getDiscountColors:function(a){return c.PROMO_DISCOUNTS_COLORS[a]},getThreadImage:function(a){var b=i.default.all.get(a);return b===null||b===void 0?void 0:b.get("correspondents.from.0.avatars.default")},getThreadHref:function(a){var b=i.default.all.get(a);var c=this.get("folder");return(0,h.getLetterHref)(b,c,{router:this.get("router"),threads:this.is("threadsEnabled"),search:this.is("search")})},getModel:function(a){return i.default.all.get(a)},handleDiscountsSwitch:function(a){var c=this;this.set("_progress",true);(0,f.default)({type:b.TOGGLE_DISCOUNTS,state:!!a.details,uid:undefined}).then(function(){c.set("_progress",false)})},getGalleryControls:function(){var a=["touch"];if(this.is("3pane")){a.push("arrows_bottom","pages");if(c.DISCOUNTS_MOUSE_SCROLL=="all"){a.push("mouse")}}else{a.push("arrows_middle");if(c.DISCOUNTS_MOUSE_SCROLL=="all"||c.DISCOUNTS_MOUSE_SCROLL=="2pane"){a.push("mouse")}}return a.join(",")},handleGalleryScrollEnd:function(){var b=a.default.get(c.DISCOUNTS_FLAG_NAME);if(!b.getCount("show")){b.save({hit:true})}},handleGalleryBlocksRendered:function(a){if(this.isMounted()){this.set({visibleItemsCount:a.details.visibleItemsCount})}},isNewDiscount:function(a){var b=i.default.all.get(a);var d=b===null||b===void 0?void 0:b.get("date");var e=(0,g.getCurrentTimestamp)();return(b===null||b===void 0?void 0:b.get("flags.unread"))&&d&&e<d+c.DELAY_FOR_NEW_DISCOUNT},didMount:function(){this.set({disableDiscountsBlock:!!a.default.get(c.DISCOUNTS_FLAG_NAME).getCount("show")})}});exports.default=l});define("feast-tpl!app/feast-tpl!ui-block/draggable/draggable.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:apply-match name="default"/>\n</div>\n',"app/feast-tpl!ui-block/draggable/draggable.html")});define("feast-tpl!ui-block/draggable/draggable.html",["feast-tpl!app/feast-tpl!ui-block/draggable/draggable.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/draggable/draggable",["require","exports","feast","feast-tpl!./draggable.html"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);var c=Math.abs;var d=Math.max;var e="draggable";function f(a){a.preventDefault();a.stopPropagation()}function g(a,b,c){a&&a.dragHandleEvent&&a.dragHandleEvent({type:b,target:c,currentTarget:a})}exports.default=a.default.Block.extend({name:"draggable",template:b.default,defaults:{tolerance:10,enabled:true},notVisualAttributes:{tolerance:true,enabled:true},attrChanged:{enabled:function(a){this.toggleDraggable(a)}},didMount:function(){if(this.is("enabled")){this.toggleDraggable(true)}},toggleDraggable:function(a){var b=this;if(a){this._drag=null;this._handleDragAwaiting=function(a){return b.handleDragAwaiting(a)};this._handleDragMove=function(a){return b.handleDragMove(a)};this._handleDragEnd=function(a){return b.handleDragEnd(a)};this.$on(this.el,"mousedown",this._handleDragAwaiting)}if(!a){this.cancelDrag(true);this.$off(this.el,"mousedown",this._handleDragAwaiting)}},handleDragAwaiting:function(a){if(a.button!==0){return}var b=this.getIdByEl(a.target);if(typeof b==="undefined"){return}this._drag={active:false,clientX:a.clientX,clientY:a.clientY,target:a.target};this.$on(document,"mousemove",this._handleDragMove);this.$on(document,"mouseup",this._handleDragEnd)},handleDragMove:function(a){var b=this._drag;var h=a.target;var i=a.clientX;var j=a.clientY;var k=5;if(!b.active&&d(c(b.clientX-i),c(b.clientY-j))<this.get("tolerance")){return}f(a);if(!b.active){b.active=true;b.el=document.createElement("div");b.el.style.position="fixed";b.el.style.zIndex="10000";this.prepareDragElement(b.el,a);document.body.appendChild(b.el);document.body.classList.add(e);this.broadcast("drag:start");this.el.addEventListener("click",f,true)}b.el.style.left=i+k+"px";b.el.style.top=j+k+"px";var l=document.elementFromPoint(i,j);do{if(l===null||l===void 0?void 0:l.dragHandleEvent){break}}while(l&&(l=l.parentNode));if(b.overEl!==l){g(b.overEl,"dragleave",h);b.overEl=l;g(b.overEl,"dragenter",h)}g(l,"dragmove",h)},handleDragEnd:function(a){if(!this._drag||!this._drag.active){this.cancelDrag(true)}if(this._drag){f(a);g(this._drag.overEl,"drop",a.target);this.cancelDrag(false)}},cancelDrag:function(a){var b=this;var c;this.$off(document,"mousemove",this._handleDragMove);this.$off(document,"mouseup",this._handleDragEnd);if(a){(c=this.el)===null||c===void 0?void 0:c.removeEventListener("click",f,true)}if(!a){this.timerId=setTimeout(function(){var a;(a=b.el)===null||a===void 0?void 0:a.removeEventListener("click",f,true)},0)}if(this._drag){this._drag.el&&this._drag.el.parentNode&&this._drag.el.parentNode.removeChild(this._drag.el);this._drag=null;document.body.classList.remove(e);this.broadcast("drag:end")}},getIdByEl:function(a){a=a.closest("[data-draggable-id]");var b;if(a){b=a.dataset.draggableId}return b},prepareDragElement:function(a,b){var c=this.getIdByEl(this._drag.target);if(typeof c!=="undefined"){this.broadcast("preparedragelement",{el:a,id:c},b)}},didUnmount:function(){if(this.is("enabled")){this.toggleDraggable(false)}clearTimeout(this.timerId)}})});define("feast-tpl!app/feast-tpl!ui-block/letter-list-item-adv/letter-list-item-adv.html",["feast"],function(a){return a.smartParse('<div qa:id="native-adv">\n\t<bem:mod name="rounded" test="attrs.rounded"/>\n\t<bem:mod name="topline" test="attrs.topline"/>\n\n\t<fn:choose>\n\n\t\t\t<fn:when test="attrs.compact">\n\t\t\t\t\x3c!-- 3pane --\x3e\n\t\t\t\t<bem:mod name="compact-indent" test="attrs.indent"/>\n\t\t\t\t<fn:choose>\n\n\t\t\t\t\t<fn:when test="attrs.ponymode || attrs.indent">\n\t\t\t\t\t\t\x3c!-- 3pane && (ponymode || inMetathread) --\x3e\n\t\t\t\t\t\t<div bem:elem="container" bem:mod="compact_compressed">\n\t\t\t\t\t\t\t<b:letter-list-item-adv-placeholder compact="{attrs.compact}" ponymode="{attrs.ponymode}"></b:letter-list-item-adv-placeholder>\n\t\t\t\t\t\t\t<div bem:elem="adv-content" ref="adv-content"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\x3c!-- 3pane && !(ponymode || inMetathread) --\x3e\n\t\t\t\t\t\t<div bem:elem="container" bem:mod="compact">\n\t\t\t\t\t\t\t<b:letter-list-item-adv-placeholder compact="{attrs.compact}" ponymode="{attrs.ponymode}"></b:letter-list-item-adv-placeholder>\n\t\t\t\t\t\t\t<div bem:elem="adv-content" ref="adv-content"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:otherwise>\n\n\t\t\t\t</fn:choose>\n\n\t\t\t</fn:when>\n\n\t\t\t<fn:otherwise>\n\t\t\t\t\x3c!-- 2pane --\x3e\n\t\t\t\t<bem:mod name="indent" test="attrs.indent"/>\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="attrs.ponymode">\n\t\t\t\t\t\t\x3c!-- 2pane && ponymode --\x3e\n\t\t\t\t\t\t<div bem:elem="container" bem:mod="compressed">\n\t\t\t\t\t\t\t<b:letter-list-item-adv-placeholder compact="{attrs.compact}" ponymode="{attrs.ponymode}"></b:letter-list-item-adv-placeholder>\n\t\t\t\t\t\t\t<div bem:elem="adv-content" ref="adv-content"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\x3c!-- 2pane && !ponymode --\x3e\n\t\t\t\t\t\t<div bem:elem="container">\n\t\t\t\t\t\t\t<b:letter-list-item-adv-placeholder compact="{attrs.compact}" ponymode="{attrs.ponymode}"></b:letter-list-item-adv-placeholder>\n\t\t\t\t\t\t\t<div bem:elem="adv-content" ref="adv-content"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</fn:otherwise>\n\n\t</fn:choose>\n\n\t<fn:if test="!attrs[\'no-delimeter\']">\n\t\t<b:delimeter full/>\n\t\t<b:delimeter last/>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/letter-list-item-adv/letter-list-item-adv.html")});define("feast-tpl!ui-block/letter-list-item-adv/letter-list-item-adv.html",["feast-tpl!app/feast-tpl!ui-block/letter-list-item-adv/letter-list-item-adv.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/delimeter/delimeter.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="last" test="attrs.last"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\t<bem:mod name="ponymode" test="attrs.ponymode"/>\n\t<bem:mod name="indent" test="attrs.indent"/>\n\t<bem:mod name="indentRight" test="attrs.indentRight"/>\n\t<bem:mod name="full" test="attrs.full"/>\n</div>\n',"app/feast-tpl!ui-block/delimeter/delimeter.html")});define("feast-tpl!ui-block/delimeter/delimeter.html",["feast-tpl!app/feast-tpl!ui-block/delimeter/delimeter.html"],function(a){return a});define("ui-block/delimeter/delimeter",["exports","feast","feast-tpl!./delimeter.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default=c.default.Block.extend({name:"delimeter",template:d.default,blocks:{}})});define("feast-tpl!app/feast-tpl!ui-block/letter-list-item-adv-placeholder/letter-list-item-adv-placeholder.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:if test="!_this.needAnimate()">\n\t\t<bem:mod name="compact" test="attrs.compact" />\n\n\t\t<fn:choose>\n\t\t\t<fn:when test="attrs.compact">\n\t\t\t\t<div bem:elem="avatar-container">\n\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t<fn:when test="_this.is3PaneRedesignV3()">\n\t\t\t\t\t\t\t<div bem:elem="avatar-3pane-v3">\n\t\t\t\t\t\t\t\t<bem:mod name="compact" test="attrs.ponymode" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t<div bem:elem="avatar-3pane">\n\t\t\t\t\t\t\t\t<bem:mod name="compact" test="attrs.ponymode" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t</fn:choose>\n\t\t\t\t</div>\n\t\t\t\t<div bem:elem="text">\n\t\t\t\t\t<div bem:elem="string" bem:mod="1"></div>\n\t\t\t\t\t<div bem:elem="string" bem:mod="2"></div>\n\t\t\t\t\t<div bem:elem="string" bem:mod="3"></div>\n\t\t\t\t</div>\n\t\t\t</fn:when>\n\t\t\t<fn:otherwise>\n\t\t\t\t<div bem:elem="avatar-container">\n\t\t\t\t\t<div bem:elem="avatar-2pane">\n                        <bem:mod name="compact" test="attrs.ponymode" />\n                    </div>\n\t\t\t\t</div>\n\t\t\t\t<div bem:elem="text">\n\t\t\t\t\t<div bem:elem="string" bem:mod="1"></div>\n\t\t\t\t\t<div bem:elem="string" bem:mod="2"></div>\n\t\t\t\t</div>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/letter-list-item-adv-placeholder/letter-list-item-adv-placeholder.html")});define("feast-tpl!ui-block/letter-list-item-adv-placeholder/letter-list-item-adv-placeholder.html",["feast-tpl!app/feast-tpl!ui-block/letter-list-item-adv-placeholder/letter-list-item-adv-placeholder.html"],function(a){return a});define("ui-block/letter-list-item-adv-placeholder/letter-list-item-adv-placeholder",["exports","default-values","feast","feast-tpl!./letter-list-item-adv-placeholder.html"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(b);var e=f(c);function f(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"letter-list-item-adv-placeholder",template:e.default,needAnimate:function b(){return a.LIST_ADVERT_ANIMATION},is3PaneRedesignV3:function b(){return a.ADV_3PANE_REDESIGN_V3}})});define("ui-block/letter-list-item-adv/letter-list-item-adv",["exports","default-values","feast","feast-tpl!./letter-list-item-adv.html","mrg-xray","service/adv/config","service/adv/index","utils/util","service/radars/decorator","service/smokescreen","ui-block/delimeter/delimeter","ui-block/letter-list-item-adv-placeholder/letter-list-item-adv-placeholder"],function(exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var l=s(b);var m=s(c);var n=s(d);var o=s(f);var p=s(h);var q=s(j);var r=s(k);function s(a){return a&&a.__esModule?a:{default:a}}var t=0;var u={};function v(a){try{if(a&&a!==document.body&&a!==document.activeElement){a.focus()}}catch(a){}}exports.default=l.default.Block.extend((0,p.default)({id:"adv",explicit:"radar"})((0,i.withWelter)({name:"letter-list-item-adv",template:m.default,immutable:true,mods:{},blocks:{delimeter:q.default,"letter-list-item-adv-placeholder":r.default},defaults:{},events:{},delayHandler:null,shouldPrefetch:true,attrChanged:{hidden:function a(b){if(b){this.el.style.display="none"}else{this.el.style.display=""}}},isCompact:function a(){return this.is("compact")||this.is("touch")},getAdvName:function a(){return this.isCompact()?"list3pane":"list2pane"},didUpdate:function a(){var b=this;var c=this.currentState,d=c.name,e=c.complexName;if(this.getAdvName()===d){(0,g.debounce)(function(){return b.broadcast("render:adv",{advRender:b._updatePlacementBound,advName:e})},0)}else{this.didUnmount();this.didMount()}},didMount:function a(){var b=this;var c=this.isCompact();var d=this.getAdvName();var g=this.get("router");var h=this.get("index");var i=this.refs["adv-content"];var j=f.Adman.placement(d);this.radar(["try-render",c?"3pane":"2pane"]);if(!j){return}var k=u[d];this.needAnimate()&&k&&i.appendChild(k);var l=j._slot.id,m=j._throttling,p=j._handlePageVisibility,q=j.autoUpdate._timeout,r=j._expId;var s=l.split(".")[0];var v=s+"."+t++;var w=d+v;var x=Object.assign({},e.slotsConfig[d],{id:v,forceFail:f.Adman.slot(s).forceFail});e.slotsConfig[w]=x;this._slotId=v;this.currentState={name:d,isCompact:c,complexName:w};var y=f.Adman.addSlots(x);var z=y[v];this._slot=z;if(this.get("indent")){f.Adman.clearCache();(0,e.setRBParam)("in3paneMetathread",c?1:0);this.shouldPrefetch=false}else{(0,e.setRBParam)("in3paneMetathread",0);this.shouldPrefetch=true}var A=f.Adman.addPlacements({siteZone:e.getSiteZone,name:w,radarName:d,slot:v,autoUpdate:q,renderThrottling:m,handlePageVisibility:p,renderOnCreate:false,expId:r,rbParams:e.getRBParams,renderOptions:{customInsert:this.needAnimate()&&this.customInsert.bind(this)}});var B=A[w];e.placementsConfig[w]=B;z.on("adv-fetch-success",function(){o.default.successSlotHandler(z,B);b.radar(["adman-fetch","success",c?"3pane":"2pane"])});z.on("adv-fetch-fail",function(){o.default.failSlotHandler(z,B,false,h);b.radar(["adman-fetch","fail",c?"3pane":"2pane"])});z.on("adv-fetch-force-fail",function(){o.default.failSlotHandler(z,B,true,h);b.radar(["adman-fetch-force","fail",c?"3pane":"2pane"])});g.on("beforeroute",function(){return z.removeAllListeners()});B.on("adv-render-fail",function(a){a=a||{};a.banner=a.banner||{};a.error=a.error||{message:"no error object"};var d={slotId:a.id,bannerId:a.banner.banner,stack:a.error.stack,error:a.error.message};(0,n.default)("adman-render_fail_"+(c?"3pane":"2pane")+"&v=1&rlog=octavius_js_banner_errors&rlog_message="+JSON.stringify(d));b.radar(["adman-render","fail",c?"3pane":"2pane"])});this._renderPlacementBinded=this.renderPlacement.bind(this,w);this._updatePlacementBound=this.renderPlacement.bind(this,w,true);this.broadcast("render:adv",{advRender:this._renderPlacementBinded,advName:w})},didUnmount:function a(){var b=this.currentState,c=b.name,d=b.isCompact,e=b.complexName;var g=f.Adman.placement(c);g.autoUpdate.stop();var h=this.refs["adv-content"];h.innerHTML="";this.radar(["unmount",d?"3pane":"2pane"]);this.broadcast("render:remove",e);if(this._slotId){f.Adman.removePlacements([e])}},customInsert:function a(b,c){if(!b||!c){return}var d=this.getAdvName();var e=u[d];var f=function a(){try{b.removeChild(e)}catch(a){b.innerHTML=""}b.classList.remove("advert-appearence");u[d]=c};if(e){if(e.offsetParent){e.addEventListener("animationend",f);setTimeout(function a(){if(c.offsetHeight){e.classList.add("advert-removing");b.classList.add("advert-appearence")}else{setTimeout(a,100)}},100)}}else{u[d]=c}},renderPlacement:function a(b){var c=this;var d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var e=this.isCompact();this.radar(["render-adv",e?"3pane":"2pane"]);var g=f.Adman.placement(b);var h=document.activeElement;var i=this.refs["adv-content"];g.attachToContainer(i);g.wakeUp();var j=function a(b){g.renderToContainer(i,b,!d).then(function(a){c.radar(["get-banner","success",e?"3pane":"2pane"]);if(a){c.radar(["get-banner","has",e?"3pane":"2pane"])}else{c.radar(["get-banner","has-not",e?"3pane":"2pane"])}}).catch(function(a){if(!a.forceFail){c.radar(["get-banner","fail",e?"3pane":"2pane"]);console.error(a)}}).then(function(){v(h)})};this.broadcast("native:render",{placement:g,placementRender:j})},needAnimate:function b(){var c=this.get("position");return c===0&&a.LIST_ADVERT_ANIMATION}})))});define("feast-mod/file-size",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fileSize=d;exports.fileSizeRange=e;var a={B:i18n("байт"),KB:i18n("КБ"),MB:i18n("МБ"),GB:i18n("ГБ"),TB:i18n("TБ")};var b=Object.freeze({KB:1024,MB:Math.pow(1024,2),GB:Math.pow(1024,3),TB:Math.pow(1024,4)});var c=function a(b,c,d,e){var f=(Math.round(b*Math.pow(10,c))/Math.pow(10,c)).toString().split(".");if(e){for(var g=f[0].length-3;g>=0;g-=3){f[0]=f[0].slice(0,Math.max(0,g))+e+f[0].slice(g)}}return f[0]+(f[1]?d+f[1]:"")};function d(d){if(d>=b.TB){d=c(d/b.TB,2,".","")+" "+a.TB}else if(d>=b.GB){d=c(d/b.GB,2,".","")+" "+a.GB}else if(d>=b.MB){d=c(d/b.MB,2,".","")+" "+a.MB}else if(d>=b.KB){d=c(d/b.KB,0)+" "+a.KB}else{d=c(d,0)+" "+a.B}return d}function e(a){switch(true){case a<=b.KB:return"1kb";case a<=b.MB:return"1mb";case a<=25*b.MB:return"25mb";case a<=b.GB:return"1gb";case a<=2*b.GB:return"2gb";default:return"over"}}});define("feast-tpl!app/feast-tpl!ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview.html",["feast"],function(a){return a.smartParse('<span\n\ttitle="{_this.getAttachTitle()}"\n\tqa:id="attach:true"\n>\n\t<fn:choose>\n\t\t\t\t<fn:when test="attrs.model.isAttachmentsLoaded()">\n\t\t\t\t\t<fn:var name="attachments"\n\t\t\t\t\t\t\tvalue="{attrs.model.getAttachmentsList()}"/>\n\n\n\t\t\t\t\t<b:react-async\n\t\t\t\t\t\tremit:contextmenu.stop\n\t\t\t\t\t\tremit:click.prevent\n\n\t\t\t\t\t\tcomponent="AttachmentDropdown"\n\n\t\t\t\t\t\tonChange="{_this.attachmentDropdownChange.bind(_this)}"\n\t\t\t\t\t\toverlayContainer="{document.getElementById(\'portal-overlay\')}"\n\t\t\t\t\t\titems="{_this.getAttachmentItems()}"\n\t\t\t\t\t\topen="{attrs[\'expand-attachment-dropdown\']}"\n\t\t\t\t\t\tbuttonSize="{attrs.small ? \'small\' : null}"\n\t\t\t\t\t\tponyMode="{attrs.ponymode}"\n\t\t\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\t\t/>\n\n\t\t\t\t</fn:when>\n\n\t\t\t\t<fn:otherwise>\n\t\t\t\t\t<b:react-async\n\t\t\t\t\t\tremit:contextmenu.stop\n\t\t\t\t\t\tremit:click="attachment-button:expanded"\n\t\t\t\t\t\tcomponent="AttachmentButton"\n\t\t\t\t\t\tponyMode="{attrs.ponymode}"\n\t\t\t\t\t\tsmall="{attrs.small}"\n\t\t\t\t\t/>\n\t\t\t\t</fn:otherwise>\n\t\t\t</fn:choose>\n</span>\n\n',"app/feast-tpl!ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview.html")});define("feast-tpl!ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/attach-icon/attach-icon.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="{attrs.name}"/>\n\t<b:react-async\n\t\tcomponent="AttachIcon"\n\t\ticonType="{_this.getIconType()}"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/attach-icon/attach-icon.html")});define("feast-tpl!ui-block/attach-icon/attach-icon.html",["feast-tpl!app/feast-tpl!ui-block/attach-icon/attach-icon.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/react-async/react-async.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:attr name="class" value="{attrs[\'class-name\']}" test="!!attrs[\'class-name\']"/>\n</div>\n',"app/feast-tpl!ui-block/react-async/react-async.html")});define("feast-tpl!ui-block/react-async/react-async.html",["feast-tpl!app/feast-tpl!ui-block/react-async/react-async.html"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/react-async/react-async",["require","exports","cfg","default-values","feast","feast-tpl!./react-async.html","service/getModule","ui-block/react-async/react-async-core"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);var g=b.USE_WEBPACK_BUILD;exports.default=c.default.Block.extend({name:"react-async",template:d.default,defaults:{component:null,themeId:"default"},constructor:function(){c.default.Block.apply(this,arguments);var a=g?this.get("componentClass"):null;var d=a instanceof Promise;var h=this.get("component");var i="component-".concat(h);this._reactAsyncCore=new f.ReactAsyncCore(function(b){var c;if(a&&!d){return a}if(a&&d){var e=b.getDep(i);return(e===null||e===void 0?void 0:e.default)||e}var f=b.getDep("ui-react");return(c=f[h])!==null&&c!==void 0?c:f===null||f===void 0?void 0:f.default[h]},a?d?[[i,a]]:[]:[["ui-react",b.USE_WEBPACK_BUILD?new Promise(function(a,b){require(["ui-react"],a,b)}).then(__importStar):(0,e.default)("ui-react")]],{useErrorBoundary:this.get("useErrorBoundary"),blockRadarId:this.get("blockRadarId"),customNode:this.get("customNode")})},didMount:function(){this._setProps();this._reactAsyncCore.mount(this.el)},didUnmount:function(){this._reactAsyncCore.umount()},set:function(){c.default.Block.prototype.set.apply(this,arguments);this._setProps()},getComponent:function(){return this._reactAsyncCore.getComponent()},_setProps:function(){if(this.isMounted()){var b=this.getAttrsSnapshot();b.qaEnabled=!!a.default.get("qa");b.darkMode=this.get("darkMode");this._reactAsyncCore.setProps(b)}}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/attach-icon/attach-icon",["require","exports","feast","feast-tpl!./attach-icon.html","ui-block/react-async/react-async"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.default=a.default.Block.extend({name:"attach-icon",template:b.default,blocks:{"react-async":c.default},getParams:function(){return{type:"image"}},getIconType:function(){if(this.attrs.name){return this.attrs.name}return""}})});define("feast-tpl!app/feast-tpl!ui-block/dropdown/dropdown.html",["feast"],function(a){return a.smartParse('<div qa:state="{attrs.ponymode && \'pony-mode\'}">\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="touch-nav" test="attrs[\'touch-nav\']"/>\n\t<bem:mod name="expanded" test="attrs.expanded"/>\n\t<bem:mod name="collapsed" test="!attrs.expanded"/>\n\t<bem:mod name="expand-top" test="attrs[\'expand-top\']"/>\n\t<bem:mod name="expand-left" test="attrs[\'calculated-expand-left\']"/>\n\t<bem:mod name="expand-center" test="attrs[\'expand-center\']"/>\n\t<bem:mod name="no-relative" test="attrs[\'no-relative\']"/>\n\t<bem:mod name="nav-folders" test="attrs[\'nav-folders\']"/>\n\t<bem:mod name="{attrs.name}" test="attrs.name"/>\n\n\t<bem:mod name="scroll-style" value="{attrs[\'scroll-style\']}"/>\n\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']"/>\n\t<bem:mod name="pony-mode" test="attrs.ponymode"/>\n\n\t<fn:match name="ctrl" args="attrs">\n\t\t<b:button2\n\t\t\tqa:id="dropdown-button"\n\t\t\tremit:click="ctrl-click"\n\t\t\tpromoId="{attrs.promoId}"\n\t\t\tshortcut="{attrs.shortcut}"\n\t\t\ttitle-shortcut="{attrs[\'title-shortcut\']}"\n\t\t\ttitle="{attrs.title}"\n\t\t\tannotation="{attrs.annotation}"\n\t\t\ttext="{attrs.text}"\n\t\t\tico="{attrs.ico}"\n\t\t\trotate-ico="{attrs[\'rotate-ico\']}"\n\t\t\ttouch="{attrs.touch}"\n\t\t\tshort="{attrs.short}"\n\t\t\tico-text-top="{attrs[\'ico-text-top\']}"\n\t\t\tpure="{attrs.pure}"\n\t\t\tpressed="{attrs.expanded}"\n\t\t\tsecondary="{attrs.secondary}"\n\t\t\tsize="{attrs.size}"\n\t\t\tdisabled="{attrs.disabled}"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tclean="{attrs.clean}"\n\t\t\tfont-size-pony="{attrs[\'font-size-pony\']}"\n\t\t\tnotification-badge="{attrs[\'notification-badge\']}"\n\t\t\talways-bright="{attrs[\'always-bright\']}"\n\t\t\tcentered\n\t\t\thighlighted="{attrs.highlighted}"\n\t\t/>\n\t</fn:match>\n\n\t<fn:match name="items">\n\t\t<div bem:elem="item">Item 1</div>\n\t\t<div bem:elem="item">Item 2</div>\n\t\t<div bem:elem="hr"/>\n\t\t<div bem:elem="item">Item 3</div>\n\t</fn:match>\n\n\t<fn:apply-match name="ctrl" args="attrs"/>\n\n\t<div qa:id="dropdown-list" bem:elem="menu" remit:click="list-click" ref="list">\n\t\t<fn:apply-match name="items" args="_this"/>\n\t</div>\n\n\t<fn:apply-match name="footer"/>\n</div>\n',"app/feast-tpl!ui-block/dropdown/dropdown.html")});define("feast-tpl!ui-block/dropdown/dropdown.html",["feast-tpl!app/feast-tpl!ui-block/dropdown/dropdown.html"],function(a){return a});define("service/submenu",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=void 0;exports.default={setup:function b(c){var d=new c({router:app});d.renderTo(document.body);a=d},teardown:function b(){a.destroy();a=null},open:function a(b,c,d){var e=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var f=this.getInstance();f.set(e);return f.setSubmenu(b,c,d)},close:function a(){var b=this.getInstance();if(b){b.hide()}},destroy:function a(){var b=this.getInstance();if(b){b.destroyBlock()}},getInstance:function b(){return a}}});define("feast-tpl!app/feast-tpl!ui-block/layout/layout.html",["feast"],function(a){return a.smartParse('<span qa:state="{attrs.type}" xmlns:fn="http://www.w3.org/1999/html">\n\t<fn:var name="isDragIconShown" value="{attrs.isDragIconShown}"/>\n\t<fn:var name="ponyMode" value="{attrs.ponymode}"/>\n\n\t<bem:mod name="size" value="{attrs.size}"/>\n\t<bem:mod name="type" value="{attrs.type}"/>\n\t<bem:mod name="vertical-fit" test="attrs[\'vertical-fit\']"/>\n\t<bem:mod name="bordered" test="attrs.bordered"/>\n\t<bem:mod name="letter" test="attrs.letter"/>\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\t<bem:mod name="right-padded" test="attrs[\'hide-ads\'] && !attrs.showWidget && !attrs.showWidgetColumn"/>\n\n\t\x3c!-- Костыль исключительно для IE11/Edge 14. НЕ ИСПОЛЬЗОВАТЬ ДЛЯ НОРМАЛЬНОЙ ЛОГИКИ (тк потом отпилим) --\x3e\n\t<bem:mod name="left_shortcut" test="attrs[\'is-shortcut-left\']"/>\n\t<bem:mod name="right_shortcut" test="attrs[\'right-column\'] < 60"/>\n\n\t<fn:attr name="style" value="{_this._getInlineStyle()}"/>\n\n\t<fn:match name="main-frame" args="layout">\n\t\t<div bem:elem="content-column">\n\t\t\t<fn:if test="layout.type === \'3pane\' || app.route.is(\'#letters #search\')">\n\t\t\t\t<div bem:elem="sidebar" ref="sidebar-column" bem:mod="size-{attrs[\'sidebar-column\']}">\n\t\t\t\t\t<div bem:elem="column" bem:mod="sidebar">\n\t\t\t\t\t\t<div bem:elem="column-wrapper">\n\t\t\t\t\t\t\t<fn:apply-match name="main-frame-sidebar" attrs="layout"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tfn:if="attrs[\'sidebar-resizable\'] && layout.type == \'3pane\'"\n\t\t\t\t\t\t\t\tbem:elem="resizer"\n\t\t\t\t\t\t\t\tbem:mod="sidebar"\n\t\t\t\t\t\t\t\tref="sidebar-column-resizer"\n\t\t\t\t\t\t\t\tpromo:id="{isDragIconShown ? \'sidebar-column-resizer-wrapper\' : \'sidebar-column-resizer\'}"\n\t\t\t\t\t\t\t\tqa:id="resizer-3pane"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<bem:mod name="with-icon" test="isDragIconShown"/>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tbem:elem="icon-wrapper"\n\t\t\t\t\t\t\t\tbem:mod="sidebar-column"\n\t\t\t\t\t\t\t\tfn:if="isDragIconShown"\n\t\t\t\t\t\t\t\tpromo:id="{isDragIconShown ? \'sidebar-column-resizer\' : \'\'}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<bem:mod name="compact" test="ponyMode"/>\n\n\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\tname="navigation_drag_indicator"\n\t\t\t\t\t\t\t\t\tfn:if="isDragIconShown"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="layout.type === \'3pane\' || app.route.is(\'#read-letter #search-letter\')">\n\t\t\t\t<div bem:elem="content">\n\t\t\t\t\t<fn:apply-match name="main-frame-content" args="layout"/>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:match>\n\n\t<fn:apply-match name="head"/>\n\n\t<fn:if test="attrs[\'left-column\']">\n\t\t<div bem:elem="column" bem:mod="left" qa:id="sidebar" ref="left-column">\n\t\t\t<div bem:elem="column-wrapper">\n\t\t\t\t<fn:apply-match name="left-column"/>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tbem:elem="resizer"\n\t\t\t\tbem:mod="left"\n\t\t\t\tref="left-column-resizer"\n\t\t\t\tfn:if="attrs.resizable"\n\t\t\t\tqa:id="resizer"\n\t\t\t\tpromo:id="{isDragIconShown ? \'left-column-resizer-wrapper\': \'left-column-resizer\'}"\n\t\t\t>\n\t\t\t\t<bem:mod name="with-icon" test="isDragIconShown"/>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="icon-wrapper"\n\t\t\t\t\tpromo:id="{isDragIconShown ? \'left-column-resizer\' : \'\'}"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="compact" test="ponyMode"/>\n\n\t\t\t\t\t<b:ico\n\t\t\t\t\t\tname="navigation_drag_indicator"\n\t\t\t\t\t\tfn:if="isDragIconShown"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</fn:if>\n\n\t<div bem:elem="main-frame" ref="main-frame">\n\t\t<fn:apply-match name="main-frame"/>\n\t</div>\n\n\t<fn:var name="showRightColumn" value="{!!(__vmatches[\'right-column\'] && attrs[\'right-column\'])}"/>\n\n\t<fn:if test="showRightColumn || _this.useWidgetColumn()">\n\t\t<div bem:elem="column" bem:mod="right" qa:id="advert-column">\n\t\t\t<bem:mod name="right-indented" test="attrs[\'right-column-indented\']"/>\n\t\t\t<bem:mod name="right-todo" test="attrs.showWidget"/>\n\t\t\t<bem:mod name="right-widget" test="attrs.showWidgetColumn"/>\n\t\t\t<bem:mod name="right-hidden" test="!showRightColumn && !attrs.showWidgetColumn"/>\n\t\t\t<fn:apply-match name="right-column"/>\n\t\t</div>\n\t</fn:if>\n\n\t<fn:apply-match name="foot"/>\n\t<fn:apply-match name="dimmer"/>\n</span>\n',"app/feast-tpl!ui-block/layout/layout.html")});define("feast-tpl!ui-block/layout/layout.html",["feast-tpl!app/feast-tpl!ui-block/layout/layout.html"],function(a){return a});define("helpers/column-resizer",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ResizeWatcher=void 0;var a=function(){function a(a,b,c){var d=this;this.resizeWatchMouseDown=function(a){a.preventDefault();d.dX=0;d.clientX=a.clientX;d.toggleMouseListeners(true)};this.resizeWatchMouseMove=function(a){d.dX=a.clientX-d.clientX;d.clientX=a.clientX;d.updateWidth(d.width+d.dX)};this.resizeWatchMouseUp=function(a){a.preventDefault();d.toggleMouseListeners(false);var b=d.width+d.dX;d.dX=0;d.updateWidth(b,true)};this.resizer=a;this.getWidth=b;this.clientX=0;this.width=this.getWidth();this.dX=0;this._updateWidth=c;this.resizeWatchAttach()}a.prototype.destroy=function(){this.resizer.removeEventListener("mousedown",this.resizeWatchMouseDown)};a.prototype.updateWidth=function(a,b){if(b===void 0){b=false}var c=Math.round(a);this._updateWidth(c,b)};a.prototype.setWidth=function(a){this.width=a};a.prototype.toggleMouseListeners=function(a){var b=a?document.addEventListener:document.removeEventListener;b("mousemove",this.resizeWatchMouseMove);b("mouseup",this.resizeWatchMouseUp)};a.prototype.resizeWatchAttach=function(){this.resizer.addEventListener("mousedown",this.resizeWatchMouseDown)};return a}();exports.ResizeWatcher=a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layout/layout",["require","exports","default-values","feast","feast-tpl!./layout.html","helpers/column-resizer","service/smokescreen"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockDescription=exports.LayoutEvents=void 0;b=__importDefault(b);c=__importDefault(c);var f=4;var g;(function(a){a["LayoutResize"]="layout:resize"})(g=exports.LayoutEvents||(exports.LayoutEvents={}));exports.blockDescription={name:"layout",template:c.default,isolateEvents:false,blocks:{},defaults:{"hide-ads":a.HIDE_TOYS===a.BL_PROP_NAME,"left-column":0,"right-column":0,"right-column-padding":a.NEW_LETTER_LIST?12:8,"right-column-indented":a.ADVERT_SIDEBAR_ROUNDED,"sidebar-column":0,"is-shortcut-left":false,"is-shortcut-right":false,"is-advert-scroll":false,"vertical-fit":false,resizable:false,type:"2pane",id:null,group:null},performanceTrace:true,didUpdate:function(){this.updateColumnSizes();this.registerResize3pane()},updateColumnSizes:function(a){if(a===void 0){a={}}var b=this.getLeftColumnWidth(a.left);var c=this.getRightColumnWidth();var d=this.getSidebarColumnWidth(a.sidebar);this.el.style.setProperty("--left-column-width","".concat(b,"px"));this.el.style.setProperty("--right-column-width","".concat(c,"px"));this.el.style.setProperty("--sidebar-column-width","".concat(d,"px"))},getLeftColumnWidth:function(a){return(a||this.get("left-column"))*f},getRightColumnWidth:function(){return this.get("right-column")*f+(this.get("showWidgetColumn")?0:this.get("right-column-padding"))},getSidebarColumnWidth:function(a){return(a||this.get("sidebar-column"))*f},didMount:function(){this.onResize=this.onResize.bind(this);this.updateColumnSizes();if(this.is("resizable")){this.registerResize()}},didUnmount:function(){var a,b;(a=this.resizeWatcher)===null||a===void 0?void 0:a.destroy();(b=this.resizeWatcherSidebar)===null||b===void 0?void 0:b.destroy()},registerResize:function(){var a=this;var b=this.refs["left-column"];var c=this.refs["left-column-resizer"];if(b&&c){this.resizeWatcher=new d.ResizeWatcher(c,function(){return b.getBoundingClientRect().width},function(b,c){a.broadcast(g.LayoutResize,{column:"left",width:b,id:a.get("id"),group:a.get("group"),resizeEnd:c});return false})}this.registerResize3pane()},registerResize3pane:function(){var a=this;var b;(b=this.resizeWatcherSidebar)===null||b===void 0?void 0:b.destroy();var c=this.refs["sidebar-column"];var e=this.refs["sidebar-column-resizer"];if(this.is("sidebar-resizable")&&e){this.resizeWatcherSidebar=new d.ResizeWatcher(e,function(){return c.getBoundingClientRect().width},function(b,c){a.broadcast(g.LayoutResize,{column:"sidebar",width:b,id:a.get("id"),group:a.get("group"),resizeEnd:c});return false})}},onResize:function(b,c){var d,e;if(c){this.el.classList.toggle("layout_resizing",true)}this.updateColumnSizes(b);(d=this.resizeWatcher)===null||d===void 0?void 0:d.setWidth(b.left*4);(e=this.resizeWatcherSidebar)===null||e===void 0?void 0:e.setWidth(b.sidebar*4);this.el.classList.toggle("layout_left_shortcut",b.left<a.SHORTCUT_LEFT_COLUMN_LIMIT)},onResizeEnd:function(){this.el.classList.toggle("layout_resizing",false)},_getInlineStyle:function(){var a="max-width: ".concat(this.get("max-width"),"px;");var b="--left-column-width: ".concat(this.getLeftColumnWidth(),"px;");var c="--right-column-width: ".concat(this.getRightColumnWidth(),"px;");var d="--sidebar-column-width: ".concat(this.getSidebarColumnWidth(),"px;");return"".concat(a," ").concat(b," ").concat(c," ").concat(d)},useWidgetColumn:function(){return a.WIDGET_COLUMN}};var h=b.default.Block.extend((0,e.withWelter)(exports.blockDescription));h.getLayoutById=function(a){var b=h.getInstances();return b.find(function(b){return b.get("id")===a})};exports.default=h});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/dropdown/dropdown",["require","exports","feast","feast-tpl!./dropdown.html","helpers/browser","service/radars/decorator","service/submenu","ui-block/button2/button2","ui-block/layout/layout","ui-block/scrollable/scrollable","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);exports.default=a.default.Block.extend((0,d.default)()({name:"dropdown",template:b.default,defaults:{expanded:false,"disable-expand-top":false,"disable-expand-center":false,"expand-top":false,"expand-left":false,"expand-center":false,"scroll-style":"normal","calculated-expand-left":false,"hover-support":c.default.capabilities["hover-support"],"auto-close":true},blocks:{button2:f.default},events:{"ctrl-click":"handleToggle","list-click":"handleListClick"},didMount:function(){var a=this;var b=h.default.getScrollableBlock(this);var c=g.default.getLayoutById("main");this.container=this.attrs.container||b&&b.el||c&&c.el||document.body;this.hide=this.hide.bind(this);this.onEscape=function(b){b.stopImmediatePropagation();a.hide()};window.addEventListener("resize",this.hide)},didUnmount:function(){window.removeEventListener("resize",this.hide)},getUnblockedDirections:function(a){var b=this;return a.filter(function(a){return!b.is("disable-expand-".concat(a))})},getHorizontalDirections:function(){return this.get("expand-left")?["left","right"]:["right","left"]},getPreferredHorizontalDirection:function(a,b,c){var d=this.getHorizontalDirections();var e=b.width;var f={left:c.right-a.left,right:a.right-c.left};var g=d.find(function(a){return f[a]-e>0});if(g){return g}return d[0]},attrChanged:{expanded:function(a){var b=this;this[a?"$on":"$off"](this.el.ownerDocument,"click","handleOutsideTap");this[a?"$on":"$off"](this.el.ownerDocument,"contextmenu","handleOutsideTap");this[a?"$on":"$off"](this.refs.list,"scroll","closeSubmenu");this[a?"$one":"$off"](this.el.ownerDocument.defaultView,"resize","closeSubmenu");(0,i.lazyMailKeymaster)().then((0,i.uniqCallback)(this,function(c){if(a){c("escape",b.onEscape)}else{c.unbind("escape",b.onEscape)}}));if(a&&!this.is("touch-nav")){this.set({"expand-top":false,"expand-center":false,"calculated-expand-left":false});this.refs.list.style["max-height"]=null;this.refs.list.style.left=null;this.refs.list.style.right=null;var c=["bottom","top","center"];var d=["center","bottom","top"];var e=this.refs.list.getBoundingClientRect();var f=this.refs.list.parentNode.getBoundingClientRect();var g=this.container.getBoundingClientRect();var h=e.height,j=e.width;var k=g.bottom-f.bottom-h;var l=f.top-g.top-h;var m=8;var n=2;var o=m+n;var p=this.getPreferredHorizontalDirection(g,e,f);var q=p==="left";this.set("calculated-expand-left",q);var r={bottom:{space:k-o,activate:function(a){var c=-a;var d=h-c;b.refs.list.style["max-height"]="".concat(d,"px")}},top:{space:l-o,activate:function(a){b.set("expand-top",true);var c=-a;var d=h-c;b.refs.list.style["max-height"]="".concat(d,"px")}},center:{space:g.height-h-o*2,activate:function(){b.set("expand-center",true);var a=-f.top+g.top+o;var c=q?-j:0;var d=g.height-o*2;b.refs.list.style.top="".concat(a,"px");b.refs.list.style.left="".concat(c,"px");b.refs.list.style["max-height"]="".concat(d,"px")}}};var s=this.getUnblockedDirections(c);if(s.length===0){console.warn("Нет направления, куда мог бы открыться дропдаун");return}var t=s.some(function(a){var b=r[a];if(b.space<0){return false}b.activate(b.space,true);return true});if(t){return}var u=this.getUnblockedDirections(d);var v=u[0];var w=r[v];w.activate(w.space,false)}this.broadcast("dropdown-change-state",{state:a})}},handleListClick:function(a){if(this.is("auto-close")&&this.is("expanded")){this.handleToggle(a)}},handleOutsideTap:function(a){if(!this.el.contains(a.target)){this.hide()}},handleToggle:function(a){var b=this.is("expanded");if(!a.isDefaultPrevented()||b){a.preventDefault();this.invert("expanded");this.broadcast("dropdown-change-state",{state:!b})}},hide:function(){this.set("expanded",false)},closeSubmenu:function(){e.default.close()}}))});define("feast-tpl!app/feast-tpl!ui-block/list/list.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']"/>\n\t<bem:mod name="shortcut" test="attrs.shortcut"/>\n\t<bem:mod name="touch" test="attrs.touch"/>\n\n\t<fn:match name="default">\n\t\t<div bem:elem="item">Item 1</div>\n\t\t<div bem:elem="item">Item 2</div>\n\t\t<div bem:elem="hr"/>\n\t\t<div bem:elem="item">Item 3</div>\n\t</fn:match>\n\n\t<fn:apply-match name="default"/>\n</div>\n',"app/feast-tpl!ui-block/list/list.html")});define("feast-tpl!ui-block/list/list.html",["feast-tpl!app/feast-tpl!ui-block/list/list.html"],function(a){return a});define("ui-block/list/list",["exports","feast","feast-tpl!./list.html","helpers/browser"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"list",template:e.default,events:{},defaults:{"hover-support":f.default.capabilities["hover-support"]}})});define("feast-tpl!app/feast-tpl!ui-block/list-item/list-item.html",["feast"],function(a){return a.smartParse('<div remit:click="click-radar" data-qa-id="{attrs[\'qa-id\']}">\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']"/>\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="nested" test="attrs.nested"/>\n\t<bem:mod name="selected" test="attrs.selected"/>\n\t<bem:mod name="markable" test="attrs.markable"/>\n\t<bem:mod name="shortcut" test="attrs.shortcut"/>\n\t<bem:mod name="paddingless" test="attrs.paddingless"/>\n\t<bem:mod name="pure" test="attrs.pure"/>\n\t<bem:mod name="disabled" test="attrs.disabled"/>\n\n\t<fn:attr name="title" value="{attrs.title}" test="!!attrs.title"/>\n\n\t<fn:add-class name="js-shortcut" test="!attrs.disabled && attrs.shortcut"/>\n\n\t<fn:match name="default">Item 1</fn:match>\n\n\t\x3c!-- Галочка --\x3e\n\t<fn:if test="attrs.markable">\n\t\t<div bem:elem="mark" qa:id="mark" qa:state="{attrs.marked ? \'marked\' : \'hidden\'}">\n\t\t\t<bem:mod name="hidden" test="!attrs.marked"/>\n\n\t\t\t<b:ico name="status:done"/>\n\t\t</div>\n\t</fn:if>\n\n\t<fn:apply-match name="default"/>\n</div>\n',"app/feast-tpl!ui-block/list-item/list-item.html")});define("feast-tpl!ui-block/list-item/list-item.html",["feast-tpl!app/feast-tpl!ui-block/list-item/list-item.html"],function(a){return a});define("ui-block/list-item/list-item",["exports","feast","feast-tpl!./list-item.html","helpers/browser","service/radars/decorator","ui-block/ico/ico"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=k(a);var g=k(b);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend((0,i.default)({events:[{name:"click-radar",rename:"click"}]})({name:"list-item",template:g.default,events:{},blocks:{ico:j.default},defaults:{"hover-support":h.default.capabilities["hover-support"],selected:false,markable:false,marked:false},onSubmenuShow:function a(){this.set("selected",true)},onSubmenuHide:function a(){this.set("selected",false)},onDestroy:function a(){this.onSubmenuHide()}}))});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-common/list-letter-abstract",["require","exports","@mail/smokescreen","default-values","feast-mod/correspondents","feast-mod/letter-date","mail/Folder","mail/Thread","service/smokescreen"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.withWelterLetterPart=exports.withWelterLetter=exports.handleIntersectViewport=exports.getUnsubscribeSender=exports.rootQaId=exports.getSnippetValue=exports.hasBadge=exports.isImportant=exports.getCategory=exports.getCounter=exports.getSubjectTooltip=exports.getDateTooltip=exports.getCorrespondentTooltip=exports.isCorrespondentDangerous=exports.getCorrespondent=exports.isProbablyPhishing=exports.getImageSrc=exports.getSubject=void 0;a=__importDefault(a);e=__importDefault(e);f=__importDefault(f);var h=["to","cc"];function i(){var a=this.get("model");return a.get("subject")||i18n("<Без темы>")}exports.getSubject=i;function j(a,b,c){if(c){var d=a.get("folder");switch(+d){case e.default.SENT:case e.default.DRAFTS:case e.default.OUTBOX:return"to"}}return b}function k(){var a=this.get("model");var b=j(a,this.get("main-field"),this.get("search"));return(0,c.correspondentsAvatarFromMessage)(a,b)}exports.getImageSrc=k;function l(){var a=this.get("model");return b.PHISHING_ALERT&&a.get("flags.maybe_phishing")}exports.isProbablyPhishing=l;function m(a){if(a===void 0){a=false}var d=this.get("model");var e=this.get("folder");var f=j(d,this.get("main-field"),this.get("search"));if(f==="from"){var g=this.isProbablyPhishing();var i=b.SHOW_SENDER_EMAIL_IN_SPAM_FOLDER&&e&&e.isSpam();if(g||i){return(0,c.correspondentsEmailsFromMessage)(d)}return(0,c.correspondentsFromMessage)(d,f,a)}return h.reduce(function(b,e){var f=(0,c.correspondentsFromMessage)(d,e,a);if(f){b.push(f)}return b},[]).join(", ")}exports.getCorrespondent=m;function n(){return b.LETTER_LIST_HIGHLIGHT_PHISHING&&this.isProbablyPhishing()}exports.isCorrespondentDangerous=n;function o(){var a=this.get("model");var b=j(a,this.get("main-field"),this.get("search"));var d;if(b==="from"){d=(0,c.getCorrespondentsFromMessage)(a).map(function(a){return(0,c.correspondentFull)(a)})}else{d=h.reduce(function(b,d){b=b.concat((0,c.getCorrespondentsFromMessage)(a,d).map(function(a){return(0,c.correspondentFull)(a)}));return b},[])}if(d.length===0){return i18n("Получатель не указан")}if(d.length<=3){return d.join(", ")}if(d.length>3){var e=d.length-3;d.length=3;return d.join(", ")+" "+i18n("и ещё")+" "+(0,c.correspondentsCount)(e)}}exports.getCorrespondentTooltip=o;function p(a){var b=this.get("model");return(0,d.getLocaleDateFull)(b.get("date"),a)}exports.getDateTooltip=p;function q(){var a=130;var b=this.getSubject();if(b.length>a){b=b.slice(0,a)+"…"}return b}exports.getSubjectTooltip=q;function r(){var a=this.get("model");var b=a.get("length");return b>1?b:0}exports.getCounter=r;function s(){var a=this.get("model");var b=a.get("transaction_category");var c=a.getFolder();if(b&&!c.isSpam()&&!this.shouldHideTransactionCategory()){return b}return null}exports.getCategory=s;function t(){var a=this.get("model");return a.isHigh()}exports.isImportant=t;function u(){return!this.get("disable-subject")&&(this.getCounter()||this.getCategory()||this.isImportant())}exports.hasBadge=u;function v(){var a=this.get("model");return this.get("search")?a.meta("search_snippet.value"):a.get("snippet")}exports.getSnippetValue=v;function w(){var a=this.get("model");if(!(a instanceof f.default)&&!this.is("search")){return"".concat(this.is("in-metathread")?"metathread-":"","letter-item:priority-subject:").concat(this.getSubject())}return"".concat(this.is("in-metathread")?"metathread-":"","letter-item:subject:").concat(this.getSubject())}exports.rootQaId=w;function x(a,d){var e;if(a===void 0){a=this.get("model")}try{var f=d||this.get("unsubscribeList");if(!b.LL_UNSUBSCRIBE_NEWSLETTERS||!f||!a.is("flags.unread")){return null}var g=a.get("id");var h=(e=(0,c.getCorrespondentsFromMessage)(a,"from"))===null||e===void 0?void 0:e[0];var i=f.find(function(a){return a.id===g&&a.sender===(h===null||h===void 0?void 0:h.email)});return i?h:null}catch(a){return null}}exports.getUnsubscribeSender=x;function y(a){if(a===void 0){a=this.get("model")}var b=this.getUnsubscribeSender(a);if(b){this.broadcast("letter:intersect:viewport",{uid:a.get("id"),sender:b})}}exports.handleIntersectViewport=y;exports.withWelterLetter=a.default.createWelterDecorator(function(a){return __assign(__assign({},a),{minSize:1,maxSize:3,depth:3,tags:{a:30,div:40,span:30},attrs:{className:30,id:30,"data-id":30,"data-draggable-id":30,title:30,href:[333,function(a,b){if(b.tag==="a"){return"/inbox/1:".concat(a(),":0/?")}}]},enabled:function(a){return a.get("welter")!==false}})},g.withWelter);exports.withWelterLetterPart=a.default.createWelterDecorator(function(a){return __assign(__assign({},a),{tags:{a:20,span:80}})},exports.withWelterLetter)});define("ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview",["exports","feast","feast-mod/file-size","feast-tpl!./list-letter-attach-status-preview.html","mail/Attachment","mail/Message","mail/Thread","service/radars/decorator","service/radars/index","ui-block/attach-icon/attach-icon","ui-block/button2/button2","ui-block/dropdown/dropdown","ui-block/ico/ico","ui-block/list/list","ui-block/list-item/list-item","ui-block/list-letter-common/list-letter-abstract","ui-block/react-async/react-async"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var q=E(a);var r=E(c);var s=E(d);var t=E(e);var u=E(f);var v=E(g);var w=E(h);var x=E(i);var y=E(j);var z=E(k);var A=E(l);var B=E(m);var C=E(n);var D=E(p);function E(a){return a&&a.__esModule?a:{default:a}}var F=q.default.Block.extend((0,o.withWelterLetterPart)((0,v.default)({id:"attach-preview",events:[{name:"attachment-button:expanded",rename:"btn-expanded"},{name:"attachments:openviewer",rename:"openviewer"}],explicit:true})({name:"list-letter-attach-status-preview",rootClassName:"ll-asa",template:r.default,immutable:true,isolate:true,isolateEvents:true,blocks:{ico:A.default,dropdown:z.default,"list-item":C.default,button2:y.default,list:B.default,"react-async":D.default,"attach-icon":x.default},defaults:{model:null,"expand-attachment-dropdown":false,size:null},events:{"attachment-button:expanded":"onAttachmentDropdownExpanded"},getAttachTitle:function a(){return i18n("С вложениями")},attachmentDropdownChange:function a(b){(0,w.default)(["letters_letter-item_attach-preview",b?"open":"close"]);this.set("expand-attachment-dropdown",b)},onAttachmentDropdownExpanded:function a(b){var c=this;b.preventDefault();var d=this.get("model");var e=d instanceof u.default?d.get("expand"):d.id;var f=d.get("folder");t.default.findOne({id:e,folder_id:f}).then(function(){c.set("expand-attachment-dropdown",true)})},getAttachmentSize:function a(c){return(0,b.fileSize)(c.get("size"))},getPreviewSrc:function a(b){return b.getThumbnailUrl(s.default.THUMBNAIL_SIZE_DEFAULT)},getAttachmentItems:function a(){var b=this;var c=this.get("model");var d=c.getAttachmentsList();if(d.length){return d.map(function(a){return{extension:a.getExtension(),title:a.get("name")+" "+b.getAttachmentSize(a),src:b.getPreviewSrc(a),onClick:function d(){var e=c.get("expand");var f=c instanceof u.default?t.default.get(e):c;b.broadcast("attachments:openviewer",{message:f,attachment:a,from:"ll-stst-prvw"})}}})}return[{title:i18n("Файл был удалён")}]}})));F.resetAttachmentDropdown=function(){F.getInstances().forEach(function(a){var b=a.get("expand-attachment-dropdown");if(b){(0,w.default)(["attachment-dropdown","close-expanded"]);a.set("expand-attachment-dropdown",false)}})};exports.default=F});define("feast-tpl!app/feast-tpl!ui-block/list-letter-bait/list-letter-bait.html",["feast"],function(a){return a.smartParse("<a></a>\n","app/feast-tpl!ui-block/list-letter-bait/list-letter-bait.html")});define("feast-tpl!ui-block/list-letter-bait/list-letter-bait.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-bait/list-letter-bait.html"],function(a){return a});define("ui-block/list-letter-bait/list-letter-bait",["exports","feast","feast-tpl!./list-letter-bait.html","ui-block/list-letter-common/list-letter-abstract"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(a);var e=f(b);function f(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend((0,c.withWelterLetter)({name:"list-letter-bait",template:e.default,immutable:true}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-common/list-letter-abstract-payment-die",["require","exports","default-values","mail/Message","utils/util"],function(require,exports,a,b,c){"use strict";var d;Object.defineProperty(exports,"__esModule",{value:true});exports.shouldShowUniversalPaymentDie=exports.shouldHideTransactionCategory=exports.paymentDieHasPicture=exports.getPaymentDieDisplayMode=exports.removeFolderId=exports.isExpired=exports.SKINS=exports.onceShownMap=void 0;b=__importDefault(b);exports.onceShownMap={};exports.SKINS=b.default.PAYMENT_META_SKINS;var e=function(a){return Date.now()>a*1e3};exports.isExpired=e;var f=function(a,b){return b.some(function(b){return!!a[b]})};var g=(d={},d[exports.SKINS.PROMO]=function(a){return f(a,["description","receiver"])},d[exports.SKINS.DATASET]=function(a){return f(a,["address","period","payer","description"])},d[exports.SKINS.GIBDD]=function(a){var b=f(a,["article_koap_description","violation_place"]);var d=f(a,["car_number","driver_license","CTC","date_violation","receiver"]);var e=(0,c.isPositiveNumber)(a.date_deadline);return b&&(d||e)},d[exports.SKINS.MOBILES_PAYMENT]=function(a){return!!(a.phone&&a.recharge_threshold)},d[exports.SKINS.SIMPLE]=function(a){return!!a.comment},d[exports.SKINS.MONETA]=function(a){return!!(a.receipt_data&&a.provider)},d[exports.SKINS.MOS_RU]=function(a){return!!(a.receipt_data&&a.provider)},d);function h(a){return a.replace(/:\d+$/,"")}exports.removeFolderId=h;function i(b,c,d,e,f){if(b===void 0){b=this.get("model")}if(c===void 0){c=this.get("hidden-payment-dies")}if(d===void 0){d=this.get("pony-mode")}if(e===void 0){e=this.get("search")}if(f===void 0){f=this.is("in-thread")}if(e||f||!a.SHOW_LIST_LETTER_PAYMENT_DIES||a.LIST_LETTER_PAYMENT_DIES_CLOSEABLE&&c[h(b.id)]===""){return"none"}try{var i=b.getPaymentMeta();if(!i||i.skin===exports.SKINS.UNIVERSAL){return"none"}return g[i.skin](i)&&!d?"full":"compact"}catch(a){return"none"}}exports.getPaymentDieDisplayMode=i;function j(){var b=this.get("model").getPaymentMeta();var c=this.get("layout-mode")==="2pane";var d=!!(b.skin===exports.SKINS.PROMO&&b.preview_image);var e=!!(a.LIST_LETTER_PAYMENT_DIES_GMAP&&b.skin===exports.SKINS.GIBDD&&b.latitude&&b.longitude);return c&&(d||e)}exports.paymentDieHasPicture=j;function k(){var a=this,b=a.meta,c=a["in-thread"];if(!b){return false}return c||this.getPaymentDieDisplayMode()==="full"&&!j.call(this)&&!(b.skin===exports.SKINS.MOBILES_PAYMENT&&b.provider_logo)}exports.shouldHideTransactionCategory=k;function l(b,c){if(b===void 0){b=this.get("model")}if(c===void 0){c=this.is("in-thread")}try{var d=b.getPaymentMeta();if(!d||!a.PAYMENT_LETTER_UNIVERSAL){return false}return!c&&d.skin===exports.SKINS.UNIVERSAL}catch(a){return false}}exports.shouldShowUniversalPaymentDie=l});define("feast-tpl!app/feast-tpl!ui-block/list-letter-common/list-letter-common.html",["feast"],function(a){return a.smartParse('<a\n\tqa:id="{_this.rootQaId()}"\n\tremit:dragstart.prevent\n\ta11y:tooltip-direction="letter-bottom"\n>\n\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="data" value="{attrs.model}"/>\n\t<fn:var name="subject" value="{_this.getSubject()}"/>\n\t<fn:var name="folder" value="{data.getFolder()}"/>\n\t<fn:var name="showFolderFeature" value="{attrs.showfolder && !attrs[\'disable-letter-item-folder\']}"/>\n\t<fn:var name="paymentDieDisplayMode" value="{_this.getPaymentDieDisplayMode()}" />\n\t<fn:var name="ponyMode" value="{attrs[\'pony-mode\']}"/>\n\n\t<fn:var name="metadata" value="{_this.getTransactionMetadata()}" />\n\t<fn:var name="showOrder" value="{_this.showOrder(attrs.model, metadata)}" />\n\t<fn:var name="unsubscribeSender" value="{_this.getUnsubscribeSender()}" />\n\t<fn:var name="showUniversalDie" value="{_this.shouldShowUniversalPaymentDie()}" />\n\t<fn:var name="showUnsubscribe" value="{unsubscribeSender && !showUniversalDie && !showOrder && !metadata && (paymentDieDisplayMode === \'none\')}" />\n\t<fn:var name="hasTags" value="{attrs[\'enable-tags\'] && data.is(\'flags.tags\') && !!data.get(\'flags.tags\').length}" />\n\t<fn:var name="isTaggable" value="{attrs[\'enable-tags\'] && !_this.getCounter()}"/>\n\n\t\x3c!-- Attributes --\x3e\n\t<fn:attr name="href" value="{attrs.href}" test="attrs.href"/>\n\t<fn:attr name="tabindex" value="-1"/>\n\t<fn:attr name="data-id" value="{data.get(\'id\')}"/>\n\t<fn:attr name="data-draggable-id" value="{data.get(\'id\')}"/>\n\t<fn:attr name="data-uidl-id" value="{data.get(\'last\')}"/>\n\t\x3c!-- TODO: выяснить зачем это нужно, в dom этого нет --\x3e\n\t<fn:attr name="active" test="attrs.selected"/>\n\n\t\x3c!-- Класс для переходов стрелками и общих стилей для всех элементов списка писем --\x3e\n\t<fn:add-class name="js-letter-list-item"/>\n\n\t\x3c!-- Modificators --\x3e\n\t<bem:mod\n\t\tname="enable-user-select"\n\t\ttest="attrs[\'enable-user-select\']"\n\t/>\n\n\t<bem:mod\n\t\tname="pony-mode"\n\t\ttest="ponyMode"\n\t/>\n\n\t<bem:mod\n\t\tname="has-indent"\n\t\ttest="attrs[\'indent\']"\n\t/>\n\n\t<bem:mod\n\t\tname="normal"\n\t\ttest="!attrs[\'indent\']"\n\t/>\n\n\t<bem:mod\n\t\tname="active"\n\t\ttest="attrs.selected"\n\t/>\n\n\t<bem:mod name="first" test="attrs.first"/>\n\t<bem:mod name="last" test="attrs.last"/>\n\n\t<bem:mod name="reliable" test="_this.checkOfficialGreen(attrs.model) && attrs.isThreadWithReliableMark"/>\n\t<bem:mod name="official" test="_this.checkImportantReliable(attrs.model) && attrs.isThreadWithReliableMark"/>\n\n\t<div bem:elem="background">\n\t\t<bem:mod name="active" test="attrs.selected"/>\n\t</div>\n\n\t\x3c!-- Read status:Start --\x3e\n\t<div bem:elem="read-status" qa:id="unread">\n\t\t<bem:mod name="pony-mode" test="ponyMode" />\n\n\t\t<b:read-status\n\t\t\tstate="{data.is(\'flags.unread\')}"\n\t\t\tis-forwarded="{data.is(\'flags.forward\')}"\n\t\t\tis-replied="{data.is(\'flags.reply\')}"\n\t\t\tmodel="{data}"\n\t\t\tremit:toggle.prevent="togglestatus:unread"\n\t\t/>\n\t</div>\n\t\x3c!-- Read status:End --\x3e\n\n\t\x3c!-- Avatar:Start --\x3e\n\t<div bem:elem="avatar" qa:id="avatar">\n\t\t<bem:mod name="pony-mode" test="ponyMode" />\n\t\t<bem:mod name="unread" test="data.is(\'flags.unread\')"/>\n\n\t\t<b:avatar\n\t\t\t\tcentered\n\t\t\t\timg-src="{_this.getImageSrc()}"\n\t\t\t\tdisable-hover="{attrs[\'disable-avatar-hover\']}"\n\t\t\t\tdisable-select="{attrs[\'disable-select\']}"\n\t\t\t\tmodel="{data}"\n\t\t\t\tstate="{attrs.selected}"\n\t\t\t\tremit:toggle.prevent="clickavatar"\n\t\t\t\tpriority="{attrs[\'priority\']}"\n\t\t\t\tlight-priority="{attrs[\'priority\'] && ponyMode}"\n\t\t\t\tdark-mode="{attrs[\'dark-mode\']}"\n\t\t/>\n\t</div>\n\t\x3c!-- Avatar:End --\x3e\n\n\t\x3c!-- Container:Start --\x3e\n\t<div bem:elem="container">\n\n\t\t\x3c!-- Content:Start --\x3e\n\t\t<div bem:elem="content">\n\t\t\t<bem:mod name="pony-mode" test="ponyMode" />\n\n\t\t\t\x3c!-- Correspondent:Start --\x3e\n\t\t\t<div bem:elem="item">\n\t\t\t\t<bem:mod name="correspondent"/>\n\t\t\t\t<bem:mod name="unread" test="data.is(\'flags.unread\')"/>\n\n\t\t\t\t<b:correspondent\n\t\t\t\t\tqa:id="correspondent"\n\t\t\t\t\tstate="{_this.getCorrespondent()}"\n\t\t\t\t\ttitle="{_this.getCorrespondentTooltip()}"\n\t\t\t\t\tdangerous="{_this.isCorrespondentDangerous()}"\n\t\t\t\t/>\n\n\t\t\t</div>\n\t\t\t\x3c!-- Correspondent:End --\x3e\n\n\t\t\t\x3c!-- Flag:Start --\x3e\n\t\t\t<div bem:elem="item" qa:id="flagged">\n\t\t\t\t<bem:mod name="flag"/>\n\n\t\t\t\t<b:flag-status\n\t\t\t\t\tstate="{data.is(\'flags.flagged\')}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tremit:toggle.prevent="togglestatus:flagged"\n\t\t\t\t/>\n\n\t\t\t</div>\n\t\t\t\x3c!-- Flag:End --\x3e\n\n\t\t\t\x3c!-- Badge:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="item"\n\t\t\t\tfn:if="_this.hasBadge()"\n\t\t\t\tqa:id="letter:badge"\n\t\t\t>\n\t\t\t\t<bem:mod name="badge"/>\n\n\t\t\t\t<b:badge\n\t\t\t\t\tcategory="{_this.getCategory()}"\n\t\t\t\t\tcounter="{_this.getCounter()}"\n\t\t\t\t\timportant="{_this.isImportant()}"\n\t\t\t\t\tunread="{data.is(\'flags.unread\')}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Badge:End --\x3e\n\n\t\t\t\x3c!-- Title:Start --\x3e\n\t\t\t<div bem:elem="item" ref="title">\n\t\t\t\t<bem:mod name="title"/>\n\n\t\t\t\t\x3c!-- Subject:Start --\x3e\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="subject"\n\t\t\t\t\tfn:if="!attrs[\'disable-subject\']"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="unread" test="data.is(\'flags.unread\')"/>\n\n\t\t\t\t\t<b:subject\n\t\t\t\t\t\tsubject="{subject}"\n\t\t\t\t\t\tcolor="{attrs.search ? data.meta(\'search_subject.color\') : null}"\n\t\t\t\t\t\tsearch="{attrs.search}"\n\t\t\t\t\t/>\n\n\t\t\t\t</span>\n\t\t\t\t\x3c!-- Subject:End --\x3e\n\n\t\t\t\t\x3c!-- Snippet:Start --\x3e\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="snippet"\n\t\t\t\t\tqa:id="snippet"\n\t\t\t\t>\n\n\t\t\t\t\t<b:snippet\n\t\t\t\t\t\tvalue="{_this.getSnippetValue()}"\n\t\t\t\t\t\tcolor="{attrs.search ? data.meta(\'search_snippet.color\') : null}"\n\t\t\t\t\t\tsearch="{attrs.search}"\n\t\t\t\t\t/>\n\n\t\t\t\t</span>\n\t\t\t\t\x3c!-- Snippet:End --\x3e\n\n\t\t\t\t\x3c!-- Это, чтобы не показывать тултип в Safari --\x3e\n\t\t\t\t<div></div>\n\t\t\t</div>\n\t\t\t\x3c!-- Title:End --\x3e\n\n\t\t\t\x3c!-- Tags:Start --\x3e\n\t\t\t<div bem:elem="item" fn:if="hasTags || isTaggable">\n\t\t\t\t<bem:mod name="tags"/>\n\n\t\t\t\t<b:react-async\n\t\t\t\t\tcomponent="ListLetterTags"\n\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\ttags="{attrs.model.get(\'flags.tags\')}"\n\t\t\t\t\tfolder="{showFolderFeature && folder.get(\'name\')}"\n\t\t\t\t\treadonly="{!isTaggable}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Tags:End --\x3e\n\n\t\t\t\x3c!-- PaymentButton:Start --\x3e\n\t\t\t<div bem:elem="item" fn:if="paymentDieDisplayMode === \'compact\'">\n\t\t\t\t<b:payment-button\n\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\tstandalone\n\t\t\t\t\tlayout-mode="2pane"\n\t\t\t\t\tpony-mode="{attrs[\'pony-mode\']}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- PaymentButton:End --\x3e\n\n\t\t\t\x3c!--- Unsubscribe: Start --\x3e\n\t\t\t<b:unsubscribe\n\t\t\t\tfn:if="showUnsubscribe"\n\t\t\t\tlayout-mode="2pane"\n\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\tunsubscribeSender="{unsubscribeSender}"\n\t\t\t\tmodel="{data}"\n\t\t\t\tuse:mediator="unsubscribe-actions themes-manager"\n\t\t\t/>\n\t\t\t\x3c!--- Unsubscribe: End --\x3e\n\n\t\t\t\x3c!-- Folder:Start --\x3e\n\t\t\t<div\n\t\t\t\tfn:if="showFolderFeature && !hasTags"\n\t\t\t\tbem:elem="item"\n\t\t\t\tbem:mod="folder"\n\t\t\t>\n\t\t\t\t<bem:mod name="hide-on-hover" test="isTaggable"/>\n\n\t\t\t<fn:choose>\n\t\t\t\t<fn:when test="data.isSchedule()">\n\t\t\t\t\t\x3c!-- Отложенная отправка (когда показываем имя папки) --\x3e\n\t\t\t\t\t<b:folder\n\t\t\t\t\t\ttitle="{data.get(\'send_date\') | scheduleDate}"\n\t\t\t\t\t\ttext="{folder.get(\'name\')}"\n\t\t\t\t\t\tqa:id="folder"\n\t\t\t\t\t/>\n\t\t\t\t</fn:when>\n\t\t\t\t<fn:otherwise>\n\t\t\t\t\t<b:folder\n\t\t\t\t\t\ttitle="{folder.get(\'name\')}"\n\t\t\t\t\t\ttext="{folder.get(\'name\')}"\n\t\t\t\t\t\tqa:id="folder"\n\t\t\t\t\t/>\n\t\t\t\t</fn:otherwise>\n\t\t\t</fn:choose>\n\n\t\t\t</div>\n\t\t\t\x3c!-- Folder:End --\x3e\n\n\t\t\t\x3c!-- Attach:Start --\x3e\n\t\t\t<fn:if test="!attrs[\'disable-attach\']">\n\t\t\t\t<div bem:elem="item">\n\t\t\t\t\t<bem:mod name="attach-status"/>\n\n\t\t\t\t\t<b:attach-status\n\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\tfn:if="data.is(\'flags.attach\')"\n\t\t\t\t\t\tuse:mediator="attachments-manager pony-mode"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\t\t\t\x3c!-- Attach:End --\x3e\n\n\t\t\t\x3c!-- Schedule:Start --\x3e\n\t\t\t<div bem:elem="item" fn:if="!showFolderFeature && data.isSchedule()">\n\t\t\t\t<b:schedule-status\n\t\t\t\t\t\tdate="{data.get(\'send_date\')}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Schedule:End --\x3e\n\n\t\t\t\x3c!-- Date:Start --\x3e\n\t\t\t<fn:var name="isSchedule" value="{!!data.isSchedule()}" />\n\t\t\t<fn:var name="letterDate" value="{_this.letterDate(data.get(\'date\'), isSchedule)}" />\n\t\t\t<div bem:elem="item" title="{_this.getDateTooltip(isSchedule)}" qa:id="time:{letterDate}">\n\t\t\t\t<bem:mod name="date" />\n\t\t\t\t{letterDate}\n\t\t\t</div>\n\t\t\t\x3c!-- Date:End --\x3e\n\t\t</div>\n\t\t\x3c!-- Content:End --\x3e\n\n\t\t\x3c!-- PaymentDie:Start --\x3e\n\t\t<div bem:elem="payment-die-container" fn:if="paymentDieDisplayMode === \'full\'">\n\t\t\t<b:payment-die\n\t\t\t\tmodel="{attrs.model}"\n\t\t\t\tlayout-mode="2pane"\n\t\t\t/>\n\t\t</div>\n\t\t\x3c!-- PaymentDie:End --\x3e\n\n\t\t\x3c!-- SearchAttaches:Start --\x3e\n\t\t<fn:var name="searchAttaches" value="{_this.getSearchAttaches()}"/>\n\t\t<fn:var name="allAttaches" value="{_this.getAllAttaches()}"/>\n\t\t<fn:var\n\t\t\tname="attachesModes"\n\t\t\tvalue="{_this.getAttachesModes(false, allAttaches, searchAttaches)}"\n\t\t/>\n\t\t<fn:var\n\t\t\tname="attachesList"\n\t\t\tvalue="{_this.getAttaches(attachesModes, allAttaches, searchAttaches).attachesList}"\n\t\t/>\n\n\t\t<fn:var\n\t\t\tname="moreAttachesList"\n\t\t\tvalue="{_this.getAttaches(attachesModes, allAttaches, searchAttaches).moreAttachesList}"\n\t\t/>\n\n\t\t<b:preview-attaches\n\t\t\tfn:if="attachesList && allAttaches"\n\t\t\tremit:attach="previewattach"\n\t\t\tremit:more="previewattach"\n\t\t\tremit:moreinvalid="openletter"\n\t\t\tmodel="{attrs.model}"\n\t\t\tattaches-list="{attachesList}"\n\t\t\tmore-attaches-list="{moreAttachesList}"\n\t\t\tlayout-mode="2pane"\n\t\t\tall-count="{allAttaches.length}"\n\t\t\tvertical="{attachesModes.vertical}"\n\t\t\tpony-mode="{ponyMode}"\n\t\t/>\n\t\t\x3c!-- SearchAttaches:End --\x3e\n\n\t\t\x3c!-- AttachesPreview:Start --\x3e\n\t\t<fn:var name="messagesAttaches" value="{attrs.messagesAttaches}"/>\n\t\t<fn:var name="showAttaches" value="{attrs[\'show-attaches\'] && _this.getAttachesPreviewCondition()}"/>\n\n\t\t<fn:var\n\t\t\tname="attachesModes"\n\t\t\tvalue="{_this.getAttachesModes(false, messagesAttaches)}"\n\t\t/>\n\n\t\t<fn:var\n\t\t\tname="attachesForRender"\n\t\t\tvalue="{_this.getAttaches(attachesModes, messagesAttaches)}"\n\t\t/>\n\n\t\t<fn:if test="showAttaches">\n\t\t\t<fn:choose>\n\t\t\t\t<fn:when test="messagesAttaches">\n\t\t\t\t\t<b:preview-attaches\n\t\t\t\t\t\tfn:if="messagesAttaches"\n\t\t\t\t\t\tremit:attach="previewattach"\n\t\t\t\t\t\tremit:more="previewattach"\n\t\t\t\t\t\tremit:moreinvalid="openletter"\n\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\tattaches-list="{attachesForRender.attachesList}"\n\t\t\t\t\t\tmore-attaches-list="{attachesForRender.moreAttachesList}"\n\t\t\t\t\t\tlayout-mode="2pane"\n\t\t\t\t\t\tall-count="{messagesAttaches.length}"\n\t\t\t\t\t\tvertical="{attachesModes.vertical}"\n\t\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\t/>\n\t\t\t\t</fn:when>\n\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\x3c!-- Заглушка, пока аттачи не загрузились --\x3e\n\t\t\t\t\t<b:stub\n\t\t\t\t\t\tattachesCount="{data.get(\'attachments_count\')}"\n\t\t\t\t\t\tisCompact="{false}"\n\t\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\t/>\n\t\t\t\t</fn:otherwise>\n\t\t\t</fn:choose>\n\t\t</fn:if>\n\t\t\x3c!-- AttachesPreview:End --\x3e\n\n\t\t\x3c!-- ListLetterOrder:Start --\x3e\n\t\t<b:order\n\t\t\tfn:if="metadata && showOrder"\n\t\t\tuse:mediator="orders-manager"\n\t\t\tmetadata="{metadata}"\n\t\t\tpony-mode="{ponyMode}"\n\t\t/>\n\t\t\x3c!-- ListLetterOrder:End --\x3e\n\n\t\t\x3c!-- ListLetterPaymentUniversalDie:Start --\x3e\n\t\t<b:payment-universal-die\n\t\t\tfn:if="showUniversalDie"\n\t\t\tmodel="{attrs.model}"\n\t\t\tlayout-type="{attrs[\'layout-type\']}"\n\t\t\tpony-mode="{ponyMode}"\n\t\t/>\n\t\t\x3c!-- ListLetterPaymentUniversalDie:End --\x3e\n\t</div>\n\t\x3c!-- Container:End --\x3e\n\n\t\x3c!-- Border:Start --\x3e\n\t<b:delimeter full="{attrs[\'full-delimiter\']}" ponymode="{ponyMode}" indent="{attrs.indent}"/>\n\t<b:delimeter ponymode="{ponyMode}" indent="{attrs.indent}" last/>\n\t\x3c!-- Border:End --\x3e\n</a>\n',"app/feast-tpl!ui-block/list-letter-common/list-letter-common.html")});define("feast-tpl!ui-block/list-letter-common/list-letter-common.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-common/list-letter-common.html"],function(a){return a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("helpers/radar-utils",["require","exports","data-source/utils/actual-letters"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getModelDataWithRelevant=exports.getLetterData=exports.getModelData=exports.renameRadarOnStatusToggle=void 0;function b(a,b){var c=a.get("model");var d=!c.is("flags.".concat(b));return"toggle_".concat(b,"_").concat(d)}exports.renameRadarOnStatusToggle=b;function c(a){var b=a.get("model");return{id:b&&b.id,model:b}}exports.getModelData=c;function d(a){var b=a.get("letter");return{id:a.get("letter-id")||b&&b.id,model:b}}exports.getLetterData=d;function e(b){var c;var d=b.get("router");var e=b.get("model");return __assign({id:e&&e.id,model:e,show_relevant:+(0,a.isActualLettersEnabledInFolder)(d,(c=e===null||e===void 0?void 0:e.getFolder)===null||c===void 0?void 0:c.call(e),e===null||e===void 0?void 0:e.get("flags.newsletter")),priority:+e.get("flags.is_relevant"),folder_id:e.get("folder")},e.get("actual_probability")&&{ml_model:e.get("actual_probability").split(":")[0]})}exports.getModelDataWithRelevant=e});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/emoji",["require","exports","@mail-core/dashboard","default-values","twemoji"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.emojiFallback=void 0;c=__importDefault(c);var d={base:"https://img.imgsmail.ru/hb/e.mail.ru/static/",folder:"emoji",ext:".svg",className:"emoji",attributes:function(){return{"data-type":"emoji-icon-fallback"}},callback:function(a,b){var c=b.base,d=b.size,e=b.ext;return"".concat(c).concat(d,"/").concat(a).concat(e)}};var e={parse:function(a){if(!a){return""}return c.default.parse(a,d)},selector:'[data-type="emoji-icon-fallback"]'};var f=function(c,d){if(b.EMOJI_FALLBACK&&c){a.userKeeper.time("emoji-fallback");e.parse(c);a.userKeeper.timeEnd("emoji-fallback",{appendix:d})}};exports.emojiFallback=f;exports.default=e});define("feast-tpl!app/feast-tpl!ui-block/list-letter-avatar/list-letter-avatar.html",["feast"],function(a){return a.smartParse('<button remit:click="click:btn" qa:id="selected:{!!attrs.state}">\n\t\x3c!-- не заменять button на span, он нужен чтобы фокус попадал в него и при снятии выделения с письма - фокус тоже уходил --\x3e\n\n\t<bem:mod name="is-active" test="attrs.state" />\n\t<bem:mod name="size_{attrs.size}" />\n\t<bem:mod name="disabled-hover" test="attrs[\'disable-hover\']" />\n\t<bem:mod name="disabled" test="attrs[\'disable-select\']" />\n\t<bem:mod name="centered" test="attrs.centered" />\n\t<bem:mod name="priority" test="attrs.priority" />\n\t<bem:mod name="light-priority" test="attrs[\'light-priority\']" />\n\n\t<div bem:elem="container" qa:id="touch:{!!attrs.touch}">\n\t\t\x3c!-- Чекбокс на тач устройствах --\x3e\n\t\t<bem:mod name="touch" test="attrs[\'touch\']" />\n\n\t\t<fn:var name="checked" value="{attrs.state}" />\n\t\t<span bem:elem="checkbox" fn:if="!attrs[\'touch\']">\n\t\t\t\x3c!-- disabled в чекбоксе потому что рулим его состоянием сверху --\x3e\n\t\t\t<b:checkbox checked="{checked}" disabled />\n\t\t</span>\n\n\t\t<div bem:elem="img-container">\n\t\t\t<span bem:elem="img" style="{_this.getImgSrc()}" />\n\t\t\t<fn:if test="_this.checkReliable(attrs.model) && attrs.isThreadWithReliableMark">\n\t\t\t\t<span bem:elem="reliable-icon" bem:mod="size_common">\n\t\t\t\t\t<b:ico\n\t\t\t\t\t\tname="{attrs[\'dark-mode\'] ? \'STATUS_RELIABLE_SENDER_DARK\' : \'STATUS_RELIABLE_SENDER_LIGHT\'}"\n\t\t\t\t\t\tdata-test-id="reliable-icon"\n\t\t\t\t\t\tremove-fill="{false}"\n\t\t\t\t\t\tsize="original"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t</fn:if>\n\t\t\t<fn:if test="_this.checkOfficial(attrs.model) && attrs.isThreadWithReliableMark">\n\t\t\t\t<span bem:elem="official-icon" bem:mod="size_common">\n\t\t\t\t\t<b:ico\n\t\t\t\t\t\tname="{attrs[\'dark-mode\'] ? \'STATUS_OFFICIAL_SENDER_DARK\' : \'STATUS_OFFICIAL_SENDER_LIGHT\'}"\n\t\t\t\t\t\tdata-test-id="official-icon"\n\t\t\t\t\t\tremove-fill="{false}"\n\t\t\t\t\t\tsize="original"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t</fn:if>\n\t\t</div>\n\t</div>\n</button>\n',"app/feast-tpl!ui-block/list-letter-avatar/list-letter-avatar.html")});define("feast-tpl!ui-block/list-letter-avatar/list-letter-avatar.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-avatar/list-letter-avatar.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/checkbox/checkbox.html",["feast"],function(a){return a.smartParse('<div qa:id="checkbox">\n\t<label bem:elem="label">\n\t\t<input\n\t\t\ttype="checkbox"\n\t\t\tbem:elem="input"\n\t\t\tremit:change="toggle"\n\t\t/>\n\n\t\t<fn:var name="state" value="{attrs.checked ? \'checked\' : attrs.disabled ? \'disabled\' : \'base\'}"/>\n\n\t\t<div\n\t\t\tbem:elem="box"\n\t\t\tqa:id="box:{state}"\n\t\t>\n\t\t\t<bem:mod name="checked" test="attrs.checked"/>\n\t\t\t<bem:mod name="disabled" test="attrs.disabled"/>\n\n\t\t\t<b:ico name="checked"/>\n\t\t</div>\n\t\t<div\n\t\t\tbem:elem="text"\n\t\t\tfn:if="attrs.label"\n\t\t>\n\t\t\t{attrs.label}\n\t\t</div>\n\t</label>\n</div>\n',"app/feast-tpl!ui-block/checkbox/checkbox.html")});define("feast-tpl!ui-block/checkbox/checkbox.html",["feast-tpl!app/feast-tpl!ui-block/checkbox/checkbox.html"],function(a){return a});define("ui-block/checkbox/checkbox",["exports","feast","feast-tpl!./checkbox.html","ui-block/ico/ico"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"checkbox",template:e.default,blocks:{ico:f.default},defaults:{checked:false,disabled:false,label:""},events:{toggle:"onToggle"},onToggle:function a(){if(!this.is("disabled")){this.invert("checked");this.broadcast("toggle-checkbox")}}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-avatar/list-letter-avatar",["require","exports","default-values","feast","feast-tpl!./list-letter-avatar.html","helpers/letter","ui-block/checkbox/checkbox","ui-block/list-letter-common/list-letter-abstract"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);exports.default=b.default.Block.extend((0,f.withWelterLetterPart)({name:"list-letter-avatar",rootClassName:"ll-av",template:c.default,immutable:true,isolate:true,blocks:{checkbox:e.default},events:{"click:btn":"onClick"},defaults:{"disable-select":false,"disable-hover":false,"img-src":a.DEFAULT_AVATAR_SRC,indent:false,size:"common",state:false,priority:false,"light-priority":false,isThreadWithReliableMark:a.THREAD_WITH_RELIABLE_MARK},didMount:function(){this.el.classList.add("stop-animate")},onClick:function(a){if(!this.is("disable-select")){a.stopPropagation();this.broadcast("toggle",this,a)}},getImgSrc:function(){return'background-image: url("'.concat(this.get("img-src")||a.DEFAULT_AVATAR_SRC,'");')},checkReliable:d.checkReliable,checkOfficial:d.checkOfficial}))});define("feast-mod/list-counter-format",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=a;function a(a){if(!a){return 0}return a>99?"99+":a}});define("feast-tpl!app/feast-tpl!ui-block/list-letter-badge/list-letter-badge.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="unread" test="attrs.unread"/>\n\t<fn:var\n\t\tname="text"\n\t\tvalue="{attrs.counter | formatCounter}"\n\t\ttest="attrs.counter > 1"\n\t/>\n\t<fn:choose>\n\t\t<fn:when test="attrs.compact">\n\t\t\t<fn:if test="attrs.important">\n\t\t\t\t<b:letter-category\n\t\t\t\t\tname="important"\n\t\t\t\t\tshort\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t\t<fn:if test="attrs.category || text">\n\t\t\t\t<b:letter-category\n\t\t\t\t\tname="{attrs.category}"\n\t\t\t\t\tshort="{!text}"\n\t\t\t\t\ttext="{text}"\n\t\t\t\t\tpromoid="{text ? \'thread-badge\' : \'\'}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</fn:when>\n\t\t<fn:otherwise>\n\t\t\t<fn:if test="attrs.category || text">\n\t\t\t\t<b:letter-category\n\t\t\t\t\tname="{attrs.category}"\n\t\t\t\t\tshort="{!text}"\n\t\t\t\t\ttext="{text}"\n\t\t\t\t\tpromoid="{text ? \'thread-badge\' : \'\'}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t\t<fn:if test="attrs.important">\n\t\t\t\t<b:letter-category\n\t\t\t\t\tname="important"\n\t\t\t\t\tshort\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</fn:otherwise>\n\t</fn:choose>\n</div>\n',"app/feast-tpl!ui-block/list-letter-badge/list-letter-badge.html")});define("feast-tpl!ui-block/list-letter-badge/list-letter-badge.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-badge/list-letter-badge.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/letter-category/letter-category.html",["feast"],function(a){return a.smartParse('<div\n\tqa:id="category:{attrs.name}"\n\tpromo:id="{attrs.promoid || \'\'}"\n>\n\t<bem:mod name="{attrs.name}"/>\n\n\t<b:badge\n\t\ttransparent="{attrs.flat}"\n\t\ttext="{_this.getText()}"\n\t\ttitle="{_this.getTitle()}"\n\t\tico="{_this.getIco()}"\n\t\tshort="{attrs.short}"\n\t\tsize="{attrs.size || \'l\'}"/>\n</div>\n',"app/feast-tpl!ui-block/letter-category/letter-category.html")});define("feast-tpl!ui-block/letter-category/letter-category.html",["feast-tpl!app/feast-tpl!ui-block/letter-category/letter-category.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/badge/badge.html",["feast"],function(a){return a.smartParse('<div title="{attrs.title}">\n\t<fn:var name="short" value="{!attrs.text || attrs.short}"/>\n\n\t<bem:mod name="size" value="{attrs.size || \'m\'}"/>\n\t<bem:mod name="strong" test="attrs.strong"/>\n\t<bem:mod name="ico" test="attrs.ico"/>\n\n\t<bem:mod name="secondary" test="attrs.secondary"/>\n\t<bem:mod name="short" test="!attrs.text || attrs.short"/>\n\t<bem:mod name="square" test="attrs.square === void 0 ? short : short && attrs.square"/>\n\t<bem:mod name="transparent" test="attrs.transparent"/>\n\n\t<span bem:elem="ico" fn:if="attrs.ico">\n\t\t<b:ico name="{attrs.ico}"/>\n\t</span>\n\t<fn:if test="attrs.text && !attrs.short">\n\t\t<span bem:elem="text" qa:id="badge-text">{attrs.text}</span>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/badge/badge.html")});define("feast-tpl!ui-block/badge/badge.html",["feast-tpl!app/feast-tpl!ui-block/badge/badge.html"],function(a){return a});define("ui-block/badge/badge",["exports","feast","feast-tpl!./badge.html","ui-block/ico/ico"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"badge",template:e.default,blocks:{ico:f.default},defaults:{transparent:false}})});define("feast-tpl!app/feast-tpl!ui-block/ico-map/ico-map.html",["feast"],function(a){return a.smartParse("<div />","app/feast-tpl!ui-block/ico-map/ico-map.html")});define("feast-tpl!ui-block/ico-map/ico-map.html",["feast-tpl!app/feast-tpl!ui-block/ico-map/ico-map.html"],function(a){return a});define("ui-block/ico-map/ico-map",["exports","feast","feast-tpl!./ico-map.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.transactionsMap=undefined;var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=exports.transactionsMap={order:{ico:"orders",text:i18n("Заказы")},travel:{ico:"travel",text:i18n("Путешествия")},finance:{ico:"currency-ruble",text:i18n("Финансы")},registration:{ico:"auth",text:i18n("Учётные записи")},event:{ico:"tickets",text:i18n("Билеты")},fees:{ico:"fees",text:i18n("Штрафы и налоги")},important:{ico:"important",text:i18n("Важное")},more:{ico:"more-hor",text:i18n("Ещё")},unread:{ico:"point",text:i18n("Непрочитанные")},flagged:{ico:"flag",text:i18n("Помеченные флажком")},attach:{ico:"attach",text:i18n("С вложениями")}};exports.default=c.default.Block.extend({name:"ico-map",template:d.default,blocks:{}})});define("ui-block/letter-category/letter-category",["exports","feast","feast-tpl!./letter-category.html","ui-block/badge/badge","ui-block/ico-map/ico-map"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=h(a);var f=h(b);var g=h(c);function h(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend({name:"letter-category",template:f.default,blocks:{badge:g.default},defaults:{name:"default",title:"",ico:""},getIco:function a(){var b=d.transactionsMap[this.get("name")];return b&&b.ico},getText:function a(){var b=d.transactionsMap[this.get("name")];return this.get("text")||b&&b.text},getTitle:function a(){var b=d.transactionsMap[this.get("name")];return b&&b.text}})});define("ui-block/list-letter-badge/list-letter-badge",["exports","feast","feast-mod/list-counter-format","feast-tpl!./list-letter-badge.html","ui-block/letter-category/letter-category"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend({name:"list-letter-badge",rootClassName:"ll-b",template:g.default,immutable:true,isolate:true,isolateEvents:true,blocks:{"letter-category":h.default},defaults:{category:null,important:false,counter:0,compact:false,unread:false},mods:{formatCounter:f.default}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-correspondent/list-letter-correspondent.html",["feast"],function(a){return a.smartParse('<span\n\ttitle="{attrs.title}"\n\tqa:state="{attrs.dangerous ? \'dangerous\' : \'\'}"\n\tqa:id="{attrs[\'qa-id\']}"\n>\n\t<bem:mod name="dangerous" test="attrs.dangerous"/>\n\n\t{attrs.state | correspondent}\n</span>\n',"app/feast-tpl!ui-block/list-letter-correspondent/list-letter-correspondent.html")});define("feast-tpl!ui-block/list-letter-correspondent/list-letter-correspondent.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-correspondent/list-letter-correspondent.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-correspondent/list-letter-correspondent",["require","exports","feast","feast-mod/correspondents","feast-tpl!./list-letter-correspondent.html"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);exports.default=a.default.Block.extend({name:"list-letter-correspondent",rootClassName:"ll-crpt",template:c.default,immutable:true,isolate:true,isolateEvents:true,defaults:{state:"",dangerous:false},mods:{correspondent:b.correspondent}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-flag-status/list-letter-flag-status.html",["feast"],function(a){return a.smartParse('<button\n\ttype="button"\n\tremit:click.stop="toggle"\n\tqa:id="flagged:{attrs.state}"\n\ttitle="{_this.getTitle()}"\n\tdisabled="{attrs[\'disable-hover\']}"\n>\n\t<bem:mod name="is-active" test="attrs.state"/>\n\t<bem:mod name="disabled-hover" test="attrs[\'disable-hover\']"/>\n\n\t<span bem:elem="icon">\n\t\t<b:ico name="{attrs.state ? \'actions:favorite_on\' : \'actions:favorite_off\'}"/>\n\t</span>\n</button>\n',"app/feast-tpl!ui-block/list-letter-flag-status/list-letter-flag-status.html")});define("feast-tpl!ui-block/list-letter-flag-status/list-letter-flag-status.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-flag-status/list-letter-flag-status.html"],function(a){return a});define("ui-block/list-letter-flag-status/list-letter-flag-status",["exports","feast","feast-tpl!./list-letter-flag-status.html","ui-block/ico/ico","ui-block/list-letter-common/list-letter-abstract"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=h(a);var f=h(b);var g=h(c);function h(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend((0,d.withWelterLetterPart)({name:"list-letter-flag-status",rootClassName:"ll-fs",template:f.default,immutable:true,isolate:true,blocks:{ico:g.default},defaults:{state:false,"disable-hover":false},notVisualAttributes:{model:true,"disable-hover":true},getTitle:function a(){return this.get("state")?i18n("Снять флажок"):i18n("Пометить флажком")}}))});define("feast-tpl!app/feast-tpl!ui-block/list-letter-folder/list-letter-folder.html",["feast"],function(a){return a.smartParse('<div title="{attrs.title}">\n\t{attrs.text}\n</div>\n\n',"app/feast-tpl!ui-block/list-letter-folder/list-letter-folder.html")});define("feast-tpl!ui-block/list-letter-folder/list-letter-folder.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-folder/list-letter-folder.html"],function(a){return a});define("ui-block/list-letter-folder/list-letter-folder",["exports","feast","feast-tpl!./list-letter-folder.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default=c.default.Block.extend({name:"list-letter-folder",rootClassName:"ll-f",template:d.default,isolate:true,isolateEvents:true,defaults:{title:"",text:""}})});define("ui-block/list-letter-order/list-letter-abstract-order",["require","exports","feast-mod/correspondents","../../default-values"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.showOrder=exports.getTransactionMetadata=void 0;function c(a,b){if(a===void 0){a=this.get("model")}if(b===void 0){b=this.get("search")}if(!b&&a){var c=a.get("transaction_metadata");return c?c.getAttributes():null}}exports.getTransactionMetadata=c;function d(c,d){var e,f;if(!d||!c){return false}var g=(f=(e=(0,a.getCorrespondentsFromMessage)(c))===null||e===void 0?void 0:e[0])===null||f===void 0?void 0:f.email;if(!b.TRANSACTION_HEADER||typeof g!=="string"){return false}var h=Object.values(b.TRANSACTION_HEADER).find(function(a){return a.shops.some(function(a){return new RegExp(a).test(g)})});return b.LIST_LETTER_ORDER&&h&&!!(d&&d.item_list&&d.item_list.length)}exports.showOrder=d});define("feast-tpl!app/feast-tpl!ui-block/list-letter-order/list-letter-order.html",["feast"],function(a){return a.smartParse('<div qa:id="ll-orders">\n\t<fn:var name="linkValue" value="{_this.getOrderLink()}"/>\n\t<fn:var name="linkText" value="{linkValue && _this.getLinkText()}"/>\n\n\t<bem:mod name="pony-mode" test="attrs[\'pony-mode\']"/>\n\n\t<span bem:elem="items">\n\t\t{_this.getItems()}\n\t</span>\n\n\t<b:link\n\t\tqa:id="ll-orders-link"\n\t\tfn:if="linkValue"\n\t\tremit:click.prevent="clicklink"\n\t\tevent:details="{url: linkValue}"\n\t\tuse:mediator="orders-manager"\n\t\ttext="{linkText}"\n\t\thref="{linkValue}"\n\t\ttarget="_blank"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/list-letter-order/list-letter-order.html")});define("feast-tpl!ui-block/list-letter-order/list-letter-order.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-order/list-letter-order.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/link/link.html",["feast"],function(a){return a.smartParse('<a remit:click="click-radar">\n\t<fn:attr name="href" value="{attrs.href}" test="attrs.href"/>\n\t<fn:attr name="target" value="{attrs.target}" test="attrs.target"/>\n\t<fn:attr name="rel" value="noopener noreferer" test="!attrs.unsafe"/>\n\n\t<bem:mod name="contrast" test="attrs.contrast" />\n\t<bem:mod name="hovered" test="attrs.hovered" />\n\t<bem:mod name="disabled" test="attrs.disabled" />\n\t<bem:mod name="secondary" test="attrs.secondary" />\n\t{attrs.text}</a>\n',"app/feast-tpl!ui-block/link/link.html")});define("feast-tpl!ui-block/link/link.html",["feast-tpl!app/feast-tpl!ui-block/link/link.html"],function(a){return a});define("ui-block/link/link",["exports","feast","feast-tpl!./link.html","service/radars/decorator"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend((0,f.default)({events:["click-radar"]})({name:"link",template:e.default,defaults:{disabled:false,hovered:false,href:null,target:null,text:"",unsafe:false,secondary:false},blocks:{}}))});define("ui-block/list-letter-order/list-letter-order",["exports","feast","feast-tpl!./list-letter-order.html","service/radars/index","ui-block/link/link"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}var j={orderHref:i18n("Перейти к заказу"),shopHref:i18n("Перейти в магазин")};exports.default=e.default.Block.extend({name:"list-letter-order",rootClassName:"ll-order",template:f.default,blocks:{link:h.default},didMount:function a(){(0,g.default)("list_letter_order_show")},getItems:function a(){var b=this.get("metadata"),c=b.item_list;var d=c.length;var e="";c.forEach(function(a,b){var c=a.name;if(c){e+=b<d-1?c+", ":""+c}});return e},getOrderLink:function a(){var b=this.get("metadata"),c=b.order_href,d=b.order_list_href;return c||d},getLinkText:function a(){return this.get("metadata").order_href?j.orderHref:j.shopHref}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-payment-button/list-letter-payment-button.html",["feast"],function(a){return a.smartParse('<div on-click="_this.handleClick(evt)" qa:id="{_this.getQaId()}">\n\t<fn:var name="meta" value="{attrs.model.getPaymentMeta()}" />\n\t<bem:mod name="default-size" test="attrs.standalone && (attrs[\'layout-mode\'] === \'2pane\') && !attrs[\'pony-mode\']" />\n\n\t<bem:mod name="{meta.status}" test="meta && meta.status" />\n\t<bem:mod name="oneline" test="attrs.oneline" />\n\n\t<span>\n\t\t{_this.getTitle()}\n\t</span>\n</div>\n',"app/feast-tpl!ui-block/list-letter-payment-button/list-letter-payment-button.html")});define("feast-tpl!ui-block/list-letter-payment-button/list-letter-payment-button.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-payment-button/list-letter-payment-button.html"],function(a){return a});define("helpers/add-merchant-param",["exports","@mail/xray"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=d;var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}function d(a,c){var d=void 0;try{d=new URL(a)}catch(c){b.default.send("merchant_parse_error_oct");return a}var e=d.searchParams.get("data");if(!e){e="{}"}var f=void 0;try{f=JSON.parse(e)}catch(c){b.default.send("merchant_parse_error_oct");return a}if(!f.merchant_param){f.merchant_param={}}Object.keys(c).forEach(function(a){f.merchant_param[a]=c[a]});var g=JSON.stringify(f);d.searchParams.set("data",g);return d.href}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/getFeaturesStringByPrefix",["require","exports","@mail/features"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);exports.default=function(b){return Object.keys(a.default.list).filter(function(a){return a.startsWith(b)}).map(function(b){var c=a.default.getAsString(b);var d=!a.default.has(b);if(d){return"-".concat(b)}else{return"".concat(b).concat(c?":".concat(c):"")}}).join(" ")}});define("helpers/opener",["require","exports","default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.OpenerTarget=void 0;var b;(function(a){a["blank"]="_blank";a["self"]="_self";a["parent"]="_parent";a["top"]="_top"})(b=exports.OpenerTarget||(exports.OpenerTarget={}));function c(c,d){if(d===void 0){d=b.blank}if(a.USE_SINGLE_TAB&&(a.USE_SINGLE_TAB_WHITELIST_REGEXP===null||a.USE_SINGLE_TAB_WHITELIST_REGEXP===void 0?void 0:a.USE_SINGLE_TAB_WHITELIST_REGEXP.test(c))&&!(a.USE_SINGLE_TAB_BLACKLIST_REGEXP===null||a.USE_SINGLE_TAB_BLACKLIST_REGEXP===void 0?void 0:a.USE_SINGLE_TAB_BLACKLIST_REGEXP.test(c))){d=b.self}var e=new URL(c,window.location.origin);for(var f=0,g=Object.entries(a.URL_EXTRA_PARAMS);f<g.length;f++){var h=g[f],i=h[0],j=h[1];e.searchParams.append(i,j===null||j===void 0?void 0:j.toString())}c=e.toString();if(a.IS_CHROME){window.open(c,d,"toolbar=yes, location=yes, status=yes, menubar=yes, scrollbars=yes, noopener=true")}else{var k=window.open(c,d);if(k){k.focus()}if(k){k.opener=null}}}exports.default=c});define("helpers/payment",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MERCHANT_TYPES=exports.MESSAGE_TYPES=exports.PaymentStatus=void 0;var a;(function(a){a["awaiting"]="awaiting";a["success"]="success";a["error"]="error"})(a=exports.PaymentStatus||(exports.PaymentStatus={}));exports.MESSAGE_TYPES={CHANGE_PAYMENT_STATUS:"CHANGE_PAYMENT_STATUS",PAYMENT_IN_PROGRESS:"PAYMENT_IN_PROGRESS",FINISH_GROUP_FINE_PAY:"FINISH_GROUP_FINE_PAY"};exports.MERCHANT_TYPES={MONETA:"moneta"}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-payment-button/list-letter-payment-button",["require","exports","default-values","feast","feast-tpl!./list-letter-payment-button.html","helpers/add-merchant-param","helpers/data-source-dispatch","helpers/getFeaturesStringByPrefix","helpers/object-to-query","helpers/opener","helpers/payment","helpers/querystring","service/layer","service/radars/index","service/storage","ui-block/list-letter-common/list-letter-abstract-payment-die","utils/util"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);exports.default=b.default.Block.extend({name:"list-letter-payment-button",rootClassName:"ll-pb",template:c.default,immutable:true,isolate:true,isolateEvents:true,blocks:{},defaults:{},mods:{},constructor:function(){b.default.Block.apply(this,arguments);this.onPostMessage=this.onPostMessage.bind(this)},didMount:function(){var a=this.get("model").id;if(!this.is("standalone")||n.onceShownMap.hasOwnProperty(a)){return}n.onceShownMap[a]="";var b=this.get("model").getPaymentMeta(),c=b.skin,d=b.merchant_id;(0,l.default)({type:"ll-pd-show-".concat(c),dwh:{uidl:a,displayMode:"compact",layoutMode:this.get("layout-mode"),ponyMode:this.is("pony-mode"),merchantId:d}})},getTitle:function(){var a=this.get("model").getPaymentMeta();switch(a.status){case i.PaymentStatus.awaiting:return i18n("Идёт оплата");case i.PaymentStatus.success:return i18n("Оплачено")}switch(a.skin){case n.SKINS.SIMPLE:return i18n("Помочь");case n.SKINS.MOBILES_PAYMENT:return i18n("Пополнить");case n.SKINS.GIBDD:var b=a.date_deadline_discount,c=a.amount,d=a.amount_with_discount;var e=(0,o.isNumber)(b)&&!(0,n.isExpired)(b)&&(0,o.isPositiveNumber)(d);var f=e?d:c;return i18n("Оплатить {amount} ₽",{amount:f.replace(".",",")});default:if(!a.amount){return i18n("Оплатить")}return i18n("Оплатить {amount} ₽",{amount:a.amount.replace(".",",")})}},onPostMessage:function(a){var b=a.details,c=b.message,d=b.layer;if(c.m_type==="iframeClose"){d.broadcast("layer:close")}var f=this.get("model");var g=f.getPaymentMeta();if(g.skin===n.SKINS.GIBDD){if(c.type===i.MESSAGE_TYPES.PAYMENT_IN_PROGRESS&&c.status==="loading"){m.default.set("fines_shapshot",null)}if(c.type===i.MESSAGE_TYPES.FINISH_GROUP_FINE_PAY){(0,e.dataSourceDispatchUpdateAll)()}}if(c.type!==i.MESSAGE_TYPES.CHANGE_PAYMENT_STATUS){return}f.setPaymentMeta(__assign(__assign({},g),{status:c.status}));(0,l.default)({type:"ll-pb-status-change-".concat(g.skin),dwh:{uidl:this.get("model").id}})},handleClick:function(b){var c=this.get("model").getPaymentMeta(),d=c.skin,e=c.payment_url,f=c.status,g=c.merchant_id;if([i.PaymentStatus.awaiting,i.PaymentStatus.success].includes(f)){return}b.preventDefault();var j=this.get("model").id;switch(d){case n.SKINS.MONETA:var m={dimmer:true,from:"list"};var o=a.LAYER_IFRAME_PARAMS[n.SKINS.MONETA]||{};var p=this._modifyPaymentUrl(e);k.default.open("moneta",__assign({url:p},o),m);break;case n.SKINS.MOS_RU:(0,h.default)(e);break;default:var q=d===n.SKINS.GIBDD?"gibdd_group":d;k.default.openIframeLayer({paramsKey:q,additionalParams:{url:this._modifyPaymentUrl(e)},factoryParams:{"close-on-esc":true},onPostMessage:this.onPostMessage})}var r=d===n.SKINS.GIBDD?"_gd-exp":"";(0,l.default)({type:"ll-pb-click-".concat(d).concat(r),dwh:{uidl:j,displayMode:this.is("standalone")?"compact":"full",layoutMode:this.get("layout-mode"),ponyMode:this.is("pony-mode"),merchantId:g}})},getQaId:function(){var a=this.get("model").getPaymentMeta().status;var b=this.is("standalone")?":standalone":"";var c=a&&a!=="error"?":".concat(a):"";return"payment-button".concat(b).concat(c)},_modifyPaymentUrl:function(a){var b=(0,d.default)(a,{from:"list",mp:"web"});var c=b.split("?"),e=c[0],h=c[1];var i=this.get("model").getPaymentMeta().skin;var k="";var l="die-list";if(i===n.SKINS.GIBDD){k=(0,f.default)("gibdd");l="die-list_gd-exp"}var m=__assign(__assign({},(0,j.default)(h)),{from:l,mp:"web",ftrs:k});return"".concat(e,"?").concat((0,g.default)(m))}})});define("feast-mod/text",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.lowerCase=a;function a(a){return a.toLowerCase()}});define("feast-tpl!app/feast-tpl!ui-block/list-letter-payment-die/list-letter-payment-die.html",["feast"],function(a){return a.smartParse('<div qa:id="{_this.getQaId()}">\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="titleArray" value="{_this.getTitle()}" />\n\t<fn:var name="subtitleArray" value="{_this.getSubtitle()}" />\n\t<fn:var name="iconData" value="{_this.getIconData()}" />\n\t<fn:var name="hasPicture" value="{_this.hasPicture()}" />\n\t<fn:var name="showImg" value="{attrs[\'show-img\']}" />\n\t<fn:var name="imgSrc" value="{attrs[\'img-src\']}" />\n\t<fn:var name="shouldShowCross" value="{_this.shouldShowCross()}" />\n\n\t<bem:mod name="{attrs[\'layout-mode\']}" />\n\t<bem:mod name="closeable" test="shouldShowCross" />\n\n\t\x3c!-- Image:Start --\x3e\n\t<div\n\t\tbem:elem="img-container"\n\t\tfn:if="hasPicture"\n\t>\n\t\t<bem:mod name="hidden" test="!showImg" />\n\n\t\t<img\n\t\t\tsrc="{imgSrc}"\n\t\t\tbem:elem="img"\n\t\t\tremit:load="load-img"\n\t\t\tremit:error="error-img"\n\t\t\tqa:id="img:{_this.meta.skin}"\n\t\t>\n\t\t\t<bem:mod name="{_this.meta.skin}" />\n\t\t</img>\n\t</div>\n\t\x3c!-- Image:End --\x3e\n\n\t\x3c!-- Icon:Start --\x3e\n\t<div bem:elem="icon-container" fn:if="!showImg" qa:id="icon:{iconData.name}">\n\t\t<bem:mod name="{attrs[\'icon-container-mode\']}" test="!hasPicture" />\n\t\t<bem:mod name="{iconData.category}" test="iconData.category" />\n\t\t<bem:mod name="placeholder" test="hasPicture" />\n\n\t\t<fn:choose>\n\t\t\t<fn:when test="iconData.url">\n\t\t\t\t<img bem:elem="img-icon" src="{iconData.url}" />\n\t\t\t</fn:when>\n\n\t\t\t<fn:otherwise>\n\t\t\t\t<b:ico name="{iconData.name}" />\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</div>\n\t\x3c!-- Icon:End --\x3e\n\n\t\x3c!-- Content:Start --\x3e\n\t<div bem:elem="content-container">\n\n\t\t\x3c!-- Title:Start --\x3e\n\t\t<div bem:elem="text-container" qa:id="title">\n\t\t\t<bem:mod name="title" />\n\n\t\t\t<fn:for data="titleArray" as="titleElement">\n\t\t\t\t<span bem:elem="text" key="{titleElement.text}" qa:id="{titleElement.id}">\n\t\t\t\t\t<bem:mod name="title" />\n\t\t\t\t\t{titleElement.text}\n\t\t\t\t</span>\n\t\t\t</fn:for>\n\t\t</div>\n\t\t\x3c!-- Title:End --\x3e\n\n\t\t\x3c!-- Subtitle:Start --\x3e\n\t\t<div bem:elem="text-container" fn:if="subtitleArray && subtitleArray.length" qa:id="subtitle">\n\t\t\t<bem:mod name="subtitle" />\n\n\t\t\t<fn:for data="subtitleArray" as="subtitleElement">\n\t\t\t\t<span\n\t\t\t\t\tfn:if="subtitleElement.description"\n\t\t\t\t\tbem:elem="text"\n\t\t\t\t\tkey="{subtitleElement.description}"\n\t\t\t\t\tqa:id="{subtitleElement.id}:description"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="subtitle" />\n\t\t\t\t\t<bem:mod name="description" />\n\n\t\t\t\t\t{subtitleElement.description}&nbsp;\n\t\t\t\t</span>\n\n\t\t\t\t<span bem:elem="text" key="{subtitleElement.text}" qa:id="{subtitleElement.id}">\n\t\t\t\t\t<fn:var name="isCarNumber" value="{subtitleElement.id === \'car_number\'}" />\n\n\t\t\t\t\t<bem:mod name="subtitle" />\n\t\t\t\t\t<bem:mod name="car-number" test="isCarNumber" />\n\n\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t<fn:when test="isCarNumber">\n\t\t\t\t\t\t\t<fn:value mod="lowerCase">subtitleElement.text</fn:value>\n\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t<fn:when test="subtitleElement.id === \'date_violation\'">\n\t\t\t\t\t\t\t<fn:value mod="letterMonthYearDate">subtitleElement.text</fn:value>\n\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t{subtitleElement.text}\n\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t</fn:choose>\n\t\t\t\t</span>\n\t\t\t</fn:for>\n\t\t</div>\n\t\t\x3c!-- Subtitle:End --\x3e\n\n\t\t\x3c!-- PaymentButton:Start --\x3e\n\t\t<div bem:elem="button-container">\n\t\t\t<b:payment-button\n\t\t\t\toneline\n\t\t\t\tmodel="{attrs.model}"\n\t\t\t\tlayout-mode="{attrs[\'layout-mode\']}"\n\t\t\t/>\n\t\t</div>\n\t\t\x3c!-- PaymentButton:End --\x3e\n\n\t</div>\n\t\x3c!-- Content:End --\x3e\n\n\t<div bem:elem="cross-container" fn:if="shouldShowCross">\n\t\t<b:ico\n\t\t\tname="actions:close"\n\t\t\tsecondary\n\t\t\tremit:click="cross-click"\n\t\t/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/list-letter-payment-die/list-letter-payment-die.html")});define("feast-tpl!ui-block/list-letter-payment-die/list-letter-payment-die.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-payment-die/list-letter-payment-die.html"],function(a){return a});define("ui-block/list-letter-payment-die/list-letter-payment-die",["exports","data-source/actions","default-values","feast","feast-mod/letter-date","feast-mod/text","feast-tpl!./list-letter-payment-die.html","RPC","service/radars/index","ui-block/ico/ico","ui-block/ico-map/ico-map","ui-block/list-letter-common/list-letter-abstract-payment-die","ui-block/list-letter-payment-button/list-letter-payment-button","../../helpers/data-source-dispatch"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var n=u(c);var o=u(f);var p=u(g);var q=u(h);var r=u(i);var s=u(l);var t=u(m);function u(a){return a&&a.__esModule?a:{default:a}}var v;function w(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:true,configurable:true,writable:true})}else{a[b]=c}return a}var x=(v={},w(v,k.SKINS.PROMO,"order"),w(v,k.SKINS.DATASET,"finance"),w(v,k.SKINS.GIBDD,"fees"),w(v,k.SKINS.MOBILES_PAYMENT,"finance"),w(v,k.SKINS.SIMPLE,"dobro"),w(v,k.SKINS.MONETA,"finance"),w(v,k.SKINS.MOS_RU,"finance"),v);var y="actions:favorite_alt";var z={car_number:i18n("Номер авто"),driver_license:i18n("Номер ВУ"),CTC:i18n("СТС"),date_violation:i18n("Дата нарушения"),receiver:i18n("Постановление")};exports.default=n.default.Block.extend({name:"list-letter-payment-die",rootClassName:"ll-pd",template:o.default,immutable:true,isolate:true,isolateEvents:true,blocks:{ico:r.default,"payment-button":s.default},defaults:{"layout-mode":"2pane","icon-container-mode":"narrow","img-src":"","show-img":false},events:{"load-img":"handleImgLoad","error-img":"handleImgError","cross-click":"handleCrossClick"},mods:{letterMonthYearDate:d.letterMonthYearDate,lowerCase:e.lowerCase},constructor:function a(){n.default.Block.apply(this,arguments);this.meta=this.get("model").getPaymentMeta()},getQaId:function a(){return"payment-die:"+this.meta.skin},didMount:function a(){var b=this;if(this.hasPicture()){this._getImgSrc().then(function(a){return b._initImgLoading(a)})}var c=this.meta,d=c.skin,e=c.merchant_id;var f=this.get("model"),g=f.id;if(k.onceShownMap.hasOwnProperty(g)){return}k.onceShownMap[g]="";(0,q.default)({type:"ll-pd-show-"+d,dwh:{uidl:g,displayMode:"full",layoutMode:this.get("layout-mode"),ponyMode:false,merchantId:e}})},_getFirstTruthyMetaField:function a(b){var c=this.meta;var d=b.find(function(a){return!!c[a]});return d?{id:d,text:c[d]}:null},getTitle:function a(){var b=this.meta;switch(b.skin){case k.SKINS.PROMO:var c=this._getFirstTruthyMetaField(["description","receiver"]);return[c.id==="receiver"?{id:c.id,text:i18n("Заказ № {orderNumber}",{orderNumber:c.text})}:c];case k.SKINS.DATASET:return[this._getFirstTruthyMetaField(["address","period","payer","description"])];case k.SKINS.GIBDD:return[this._getFirstTruthyMetaField(["article_koap_description","violation_place"])];case k.SKINS.MOBILES_PAYMENT:var d=b.phone,e=b.recharge_threshold;return[{id:"balance_warning",text:i18n("Баланс {phone} меньше {rechargeThreshold} руб",{phone:d,rechargeThreshold:e})}];case k.SKINS.SIMPLE:return[this._getFirstTruthyMetaField(["comment"])];case k.SKINS.MONETA:var f="";var g=b.account_number,h=b.provider_category,i=b.provider;if(i){f=i}if(h){f=f?f+", "+h:h}if(g){f=f?i18n("{monetaTitle}, л/с {accountNumber}",{"unsafe-monetaTitle":f,"unsafe-accountNumber":g}):i18n("л/с {accountNumber}",{"unsafe-accountNumber":g})}return[{id:"moneta_title",text:f}];case k.SKINS.MOS_RU:var j=b.description||"";return[{id:"mosru_title",text:j}]}},getSubtitle:function a(){var b=this.meta,c=b.skin,e=b.car_number,f=b.date_violation,g=b.date_deadline,h=b.date_deadline_discount;if(c!==k.SKINS.GIBDD){return[]}if(e&&f){return[{id:"car_number",text:e},{id:"date_violation",text:f}]}var i=this._getFirstTruthyMetaField(["car_number","driver_license","CTC","date_violation","receiver"]);if(i){var j=i.id,l=i.text;return[{id:j,description:z[j]+":",text:l}]}return(0,k.isExpired)(h)?[{id:"no-discount",description:i18n("Оплатить до")+":",text:(0,d.letterMonthDate)(g*1e3,true)}]:[{id:"discount",description:i18n("Оплатить со скидкой до")+":",text:(0,d.letterMonthDate)(h*1e3,true)}]},getIconData:function a(){var b=this.get("model");var c=this.meta,d=c.skin,e=c.provider_logo;if(d===k.SKINS.MOBILES_PAYMENT&&e){return{name:"provider-logo",url:e}}var f=b.get("transaction_category")||x[d];return{category:f,name:d===k.SKINS.SIMPLE&&!j.transactionsMap.hasOwnProperty(f)?y:j.transactionsMap[f].ico}},hasPicture:k.paymentDieHasPicture,_getImgSrc:function a(){var c=this.meta;switch(c.skin){case k.SKINS.PROMO:return Promise.resolve(c.preview_image);case k.SKINS.GIBDD:if(!b.LIST_LETTER_PAYMENT_DIES_GMAP){return Promise.reject()}var d=b.LIST_LETTER_PAYMENT_DIES_GMAP.mapSize,e=b.LIST_LETTER_PAYMENT_DIES_GMAP.zoom;return p.default.get("gibdd/gmap/base64",{latitude:'"'+c.latitude+'"',longitude:'"'+c.longitude+'"',map_size:'"'+d+'"',zoom:'"'+e+'"'},{cache:true}).then(function(a){var b=a.body;return"data:image/png;base64,"+b.base64_map}).catch(function(a){(0,q.default)({type:"ll-pd-gmap-err"});throw a})}},_initImgLoading:function a(b){this.set("img-src",b)},handleImgLoad:function a(){this.set("show-img",true)},handleImgError:function a(){var b=this.meta.skin;(0,q.default)({type:"ll-pd-img-err-"+b})},shouldShowCross:function a(){return b.LIST_LETTER_PAYMENT_DIES_CLOSEABLE},handleCrossClick:function b(c){c.preventDefault();var d=(0,k.removeFolderId)(this.get("model").id);var e=this.meta,f=e.skin,g=e.status,h=e.merchant_id;(0,q.default)({type:"ll-pd-close",intervals:[[f,1]],dwh:{uidl:d,displayMode:"full",layoutMode:this.get("layout-mode"),ponyMode:false,status:g||"new",merchantId:h}});(0,t.default)({type:a.HIDE_PAYMENT_DIE,uidl:d})}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-payment-universal-die/list-letter-payment-universal-die.html",["feast"],function(a){return a.smartParse('<div qa:id="{_this.getTestId()}">\n\t<fn:var name="description" value="{_this.getDescription()}" />\n\t<fn:var name="ponyMode" value="{attrs[\'pony-mode\']}" />\n\t<fn:var name="hideDescription" value="{attrs[\'hide-description\']}" />\n\n\t<bem:mod name="column" test="attrs[\'layout-type\'] === \'3pane\'" />\n\t<bem:mod name="row" test="attrs[\'layout-type\'] === \'2pane\'" />\n\t<bem:mod name="fluid" test="attrs[\'pud-fluid\']" />\n\n\t<span\n\t\tfn:if="!(hideDescription || (ponyMode && attrs[\'layout-type\'] === \'3pane\'))"\n\t\tbem:elem="description"\n\t\tqa:id="description"\n\t>\n\t\t{description}\n\t</span>\n\t<b:payment-button\n\t\tmodel="{attrs.model}"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/list-letter-payment-universal-die/list-letter-payment-universal-die.html")});define("feast-tpl!ui-block/list-letter-payment-universal-die/list-letter-payment-universal-die.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-payment-universal-die/list-letter-payment-universal-die.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/list-letter-payment-universal-button/list-letter-payment-universal-button.html",["feast"],function(a){return a.smartParse('<div\n\tremit:click="payment-button:click"\n\tqa:id="{_this.getTestId()}"\n>\n\t<fn:var name="meta" value="{attrs.model.getPaymentMeta()}" />\n\t<fn:var name="status" value="{meta.status}" />\n\t<fn:var name="shouldShowButton" value="{_this.shouldShowButton()}" />\n\n\t<bem:mod name="{status}" test="!shouldShowButton" />\n\t<bem:mod name="default" test="shouldShowButton" />\n\n\t<span>\n\t\t{_this.getTitle()}\n\t</span>\n</div>\n',"app/feast-tpl!ui-block/list-letter-payment-universal-button/list-letter-payment-universal-button.html")});define("feast-tpl!ui-block/list-letter-payment-universal-button/list-letter-payment-universal-button.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-payment-universal-button/list-letter-payment-universal-button.html"],function(a){return a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-payment-universal-button/list-letter-payment-universal-button",["require","exports","feast","feast-tpl!./list-letter-payment-universal-button.html","helpers/opener","helpers/payment","helpers/querystring-add","service/layer","service/radars/index"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.default=a.default.Block.extend({name:"list-letter-payment-universal-button",rootClassName:"ll-pub",template:b.default,events:{"payment-button:click":"onClick"},constructor:function(){a.default.Block.apply(this,arguments);this.onPostMessage=this.onPostMessage.bind(this)},getTitle:function(){var a,b,c,e;var f=(a=this.get("model"))===null||a===void 0?void 0:a.getPaymentMeta();if(!f){return""}var g=f.status,h=f.amount,i=f.buttons,j=f.status_texts;var k=j===null||j===void 0?void 0:j[g];switch(g){case d.PaymentStatus.awaiting:return k||i18n("Идёт оплата");case d.PaymentStatus.success:return k||i18n("Оплачено")}var l=(b=i===null||i===void 0?void 0:i.payment)===null||b===void 0?void 0:b.text_on_list;if(l){return l}var m=(e=(c=i===null||i===void 0?void 0:i.payment)===null||c===void 0?void 0:c.text)!==null&&e!==void 0?e:i18n("Оплатить");return"".concat(m).concat(h?" ".concat(h," ₽"):"")},shouldShowButton:function(){var a=this.get("model").getPaymentMeta();if(!a){return true}return!a.status||a.status===d.PaymentStatus.error},onPostMessage:function(a){var b=a.details,c=b.message,e=b.layer;var f=this.get("model");var h=f.getPaymentMeta();if(typeof h!=="object"||typeof c!=="object"){return}var i=h.skin,j=h.merchant_id,k=h.merchant_type,l=h.amount,m=h.version;var n=c.status,o=c.type,p=c.m_type;if(p==="iframeClose"){e.broadcast("layer:close")}if(o===d.MESSAGE_TYPES.CHANGE_PAYMENT_STATUS){f.setPaymentMeta(__assign(__assign({},h),{status:n}));return(0,g.default)({type:"ll-pub_stts_chng_".concat(j,"_").concat(n),dwh:{uidl:f.id,skin:i,amount:l,status:n,merchant_id:j,merchant_type:k,version:m}})}},onClick:function(a){var b=this.get("model");var e=b.getPaymentMeta();if(typeof e!=="object"){return}var h=e.skin,i=e.amount,j=e.status,k=e.buttons.payment,l=k.url,m=k.iframe_size,n=e.version,o=e.merchant_id,p=e.merchant_type;if(j===d.PaymentStatus.awaiting||j===d.PaymentStatus.success){return}a.preventDefault();if(!m){(0,c.default)(l);return}var q=m.split("x"),r=q[0],s=q[1];var t={uidl:b.id,skin:h,amount:i,status:j,merchant_id:o,merchant_type:p,version:n};var u={url:this._modifyPaymentUrl(l,n),width:r,height:s};if(p===d.MERCHANT_TYPES.MONETA){f.default.open("moneta",__assign(__assign({},u),{"close-on-esc":true,dwhMetrics:t}),{dimmer:true})}else{f.default.openIframeLayer({additionalParams:u,factoryParams:{"close-on-esc":true},onPostMessage:this.onPostMessage})}(0,g.default)({type:"ll-pub_clck_".concat(o),dwh:t})},_modifyPaymentUrl:function(a,b){return(0,e.default)(a,{from:"die_oct_ll_".concat(b),mp:"web"})},getTestId:function(){var a,b;var c=(b=(a=this.get("model"))===null||a===void 0?void 0:a.getPaymentMeta())===null||b===void 0?void 0:b.status;return"ll-pay-uni-btn:".concat(c!==null&&c!==void 0?c:"btn")}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-payment-universal-die/list-letter-payment-universal-die",["require","exports","feast","feast-tpl!./list-letter-payment-universal-die.html","service/radars/index","ui-block/list-letter-payment-universal-button/list-letter-payment-universal-button"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);exports.default=a.default.Block.extend({name:"list-letter-payment-universal-die",template:b.default,rootClassName:"ll-pud",constructor:function(){a.default.Block.apply(this,arguments);this.meta=this.get("model").getPaymentMeta()},blocks:{"payment-button":d.default},didMount:function(){var a=this.meta,b=a.skin,d=a.merchant_id,e=a.merchant_type,f=a.amount,g=a.status,h=a.version;var i=this.get("model").id;(0,c.default)({type:"ll-pud_shw_".concat(d),dwh:{uidl:i,skin:b,amount:f,status:g,merchant_id:d,merchant_type:e,version:h}})},getDescription:function(){var a,b,c,d,e;var f=(c=(b=(a=this.meta)===null||a===void 0?void 0:a.description)===null||b===void 0?void 0:b.map(function(a){return a===null||a===void 0?void 0:a.value}))===null||c===void 0?void 0:c.filter(function(a){return a});var g=f===null||f===void 0?void 0:f.join(", ");var h=(d=this===null||this===void 0?void 0:this.meta)===null||d===void 0?void 0:d.header;return(e=g||h)!==null&&e!==void 0?e:""},getTestId:function(){var a;var b=(a=this.meta)===null||a===void 0?void 0:a.merchant_type;return"ll-pay-uni-die:".concat(b)}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-preview-attaches/list-letter-preview-attaches.html",["feast"],function(a){return a.smartParse('<div qa:id="ll-preview-attaches">\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="allCount" value="{attrs[\'all-count\']}"/>\n\t<fn:var name="model" value="{attrs[\'model\']}"/>\n\t<fn:var name="attachesList" value="{attrs[\'attaches-list\']}"/>\n\t<fn:var name="moreAttachesList" value="{attrs[\'more-attaches-list\']}"/>\n\t<fn:var name="isCompact" value="{attrs[\'layout-mode\'] === \'3pane\'}"/>\n\t<fn:var name="compactMode" value="{isCompact ? \'compact\' : \'incompact\'}"/>\n\t<fn:var name="pony" value="{attrs[\'pony-mode\'] ? \'pony\' : \'normal\'}"/>\n\t<fn:var name="location" value="{attrs[\'metathread\'] ? \'meta\' : \'folder\'}"/>\n\n\t<fn:var name="vertical" value="{attrs.vertical}"/>\n\n\t<bem:mod name="vertical" test="vertical"/>\n\t<bem:mod name="horizontal" test="!vertical"/>\n\t<bem:mod name="pony-mode" test="attrs[\'pony-mode\']"/>\n\t<bem:mod name="mode" value="{compactMode + \'_\' + pony + \'_\' + location}"/>\n\n\t\x3c!-- Аттач с кнопкой ЕЩЕ --\x3e\n\t<fn:match name="attachWithMore" args="moreCount">\n\t\t<fn:var name="attach" value="{attachesList[attachesList.length - 1]}"/>\n\t\t<fn:var name="extension" value="{_this.getAttachmentExtension(attach.name.value)}"/>\n\n\t\t<b:preview-attaches-item\n\t\t\t\tmodel="{model}"\n\t\t\t\tlast-attach="true"\n\t\t\t\tattach="{attach}"\n\t\t\t\tvertical="{vertical}"\n\t\t\t\thasMore="{moreCount}"\n\t\t\t\tisCompact="{isCompact}"\n\t\t\t\tremit:click="attach"\n\t\t\t\tevent:details="{hasSnippet: vertical, ext: extension}"\n\t\t\t\tuse:mediator="attachments-manager"\n\t\t/>\n\n\t\t<b:preview-attaches-more\n\t\t\t\tfn:if="moreCount"\n\t\t\t\tmodel="{model}"\n\t\t\t\tmore-count="{moreCount}"\n\t\t\t\titems="{moreAttachesList}"\n\t\t\t\tvertical="{vertical}"\n\t\t\t\tpony-mode="{attrs[\'pony-mode\']}"\n\t\t\t\tremit:click="more"\n\t\t\t\tremit:moreinvalid="moreinvalid"\n\t\t\t\tuse:mediator="attachments-manager"\n\t\t\t\tevent:details="{hasSnippet: vertical}"\n\t\t/>\n\t</fn:match>\n\n\t<fn:if test="attachesList && attachesList.length">\n\t\t<fn:var name="moreCount" value="{allCount - attachesList.length}"/>\n\n\t\t\x3c!-- Если аттачей > 1, то сначала в цикле рисуем n-1 аттач --\x3e\n\t\t<fn:for data="attachesList" as="attach" key="key">\n\t\t\t<fn:var name="lastItem" value="{(attachesList.length - 1) === key}"/>\n\n\t\t\t<b:preview-attaches-item\n\t\t\t\tfn:if="!lastItem"\n\t\t\t\tkey="{key}"\n\t\t\t\tmodel="{model}"\n\t\t\t\tattach="{attach}"\n\t\t\t\tvertical="{vertical}"\n\t\t\t\tisCompact="{isCompact}"\n\t\t\t\tremit:click="attach"\n\t\t\t\tevent:details="{hasSnippet: vertical, ext: extension}"\n\t\t\t\tuse:mediator="attachments-manager"\n\t\t\t/>\n\t\t</fn:for>\n\n\t\t<fn:choose>\n\t\t\t<fn:when test="vertical && moreCount">\n\t\t\t\t\x3c!-- Если последний (или единственный) аттач - это большой аттач с ЕЩЕ, --\x3e\n\t\t\t\t\x3c!-- то рисуем его в контейнере для flex-direction: raw --\x3e\n\t\t\t\t<div bem:elem="container">\n\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\tname="attachWithMore"\n\t\t\t\t\t\t\targs="moreCount"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</fn:when>\n\n\t\t\t<fn:otherwise>\n\t\t\t\t<fn:apply-match\n\t\t\t\t\t\tname="attachWithMore"\n\t\t\t\t\t\targs="moreCount"\n\t\t\t\t/>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/list-letter-preview-attaches/list-letter-preview-attaches.html")});define("feast-tpl!ui-block/list-letter-preview-attaches/list-letter-preview-attaches.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-preview-attaches/list-letter-preview-attaches.html"],function(a){return a});define("service/search-attaches/utils",["exports","utils/extension"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getAttachmentExtension=e;exports.getAttachmentIconByExt=f;exports.getAttachmentIcon=g;exports.getAttachmentId=h;var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}var d={archive:"ATTACH_ARCHIVE","android-package":"ATTACH_ANDROID",audio:"ATTACH_AUDIO",calendar:"ATTACH_CALENDAR",chart:"ATTACH_CHART",document:"ATTACH_DOC",ebook:"ATTACH_EBOOK",email:"ATTACH_MAIL",exec:"ATTACH_EXE",html:"ATTACH_HTML",json:"ATTACH_JSON",markdown:"ATTACH_MARKDOWN",pdf:"ATTACH_PDF",picture:"ATTACH_PICTURE",playlist:"ATTACH_PLAYLIST",presentation:"ATTACH_PRESENTATION",source:"ATTACH_SOURCE",spreadsheet:"ATTACH_SPREADSHEET",text:"ATTACH_TEXT",vcard:"ATTACH_VCARD",video:"ATTACH_VIDEO","web-feed":"ATTACH_WEBFEED"};function e(a){return b.default.getExtByName(a)}function f(a){var c=b.default.extToPrimitiveKind[a];if(!c){c=b.default.extToPrimitiveKind[b.default.extensionAliases[a]]}return d[c]||"ATTACH_UNKNOWN"}function g(a){var b=e(a.value);return f(b)}function h(a){return a.slice(a.indexOf(";")+1)}});define("feast-tpl!app/feast-tpl!ui-block/list-letter-preview-attaches-item/list-letter-preview-attaches-item.html",["feast"],function(a){return a.smartParse('<span qa:id="ll-preview-attaches-item">\n\t<fn:var name="last" value="{attrs[\'last-attach\']}"/>\n\t<fn:var name="vertical" value="{attrs[\'vertical\']}"/>\n\t<fn:var name="formName" value="{attrs[\'attach\'].formName}"/>\n\t<fn:var name="snippet" value="{attrs[\'attach\'].snippet}"/>\n\t<fn:var name="showMoreButton" value="{attrs.hasMore}"/>\n\t<fn:var name="iconName" value="{_this.getAttachmentIcon(formName)}"/>\n\t<fn:var name="isCompact" value="{attrs.isCompact}"/>\n\n\t<bem:mod name="vertical" test="vertical"/>\n\t<bem:mod name="vertical-more" test="vertical && showMoreButton"/>\n\t<bem:mod name="not-last-vertical" test="!last && vertical"/>\n\t<bem:mod name="horizontal" test="!vertical"/>\n\t<bem:mod name="last-without-more" test="last && !showMoreButton"/>\n\t<bem:mod name="mode" value="{isCompact ? \'compact\' : \'incompact\'}"/>\n\n\t<div bem:elem="icon">\n\t\t<bem:mod name="grey"/>\n\t\t<bem:mod name="doc" test="iconName === \'ATTACH_DOC\'"/>\n\t\t<bem:mod name="pdf" test="iconName === \'ATTACH_PDF\'"/>\n\t\t<bem:mod name="presentation" test="iconName === \'ATTACH_PRESENTATION\'"/>\n\t\t<bem:mod name="spreadsheet" test="iconName === \'ATTACH_SPREADSHEET\'"/>\n\n\t\t<b:ico name="{iconName}"/>\n\t</div>\n\n\t<fn:if test="formName">\n\t\t<div bem:elem="content" qa:id="{_this.getQaId()}">\n\t\t\t<b:highlighter\n\t\t\t\ttext="{formName.value}"\n\t\t\t\tcolor="{formName.color}"\n\t\t\t/>\n\n\t\t\t<div\n\t\t\t\tbem:elem="snippet"\n\t\t\t\tfn:if="vertical && snippet.value"\n\t\t\t\tqa:id="ll-preview-attaches-snippet"\n\t\t\t>\n\t\t\t\t<b:highlighter\n\t\t\t\t\ttext="{snippet.value}"\n\t\t\t\t\tcolor="{snippet.color}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t</fn:if>\n</span>\n',"app/feast-tpl!ui-block/list-letter-preview-attaches-item/list-letter-preview-attaches-item.html")});define("feast-tpl!ui-block/list-letter-preview-attaches-item/list-letter-preview-attaches-item.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-preview-attaches-item/list-letter-preview-attaches-item.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/highlighter/highlighter.html",["feast"],function(a){return a.smartParse('<span>\n\t<fn:var name="splitted" value="{_this.splitter(attrs.text, attrs.color)}" />\n\n\t<fn:for data="splitted" as="part" key="index">\n\t\t<span key="{attrs.text}{part}{index}" bem:elem="item">\n\t\t\t<bem:mod name="light" test="index % 2" />\n\t\t\t<fn:value>part</fn:value>\n\t\t</span>\n\t</fn:for>\n</span>',"app/feast-tpl!ui-block/highlighter/highlighter.html")});define("feast-tpl!ui-block/highlighter/highlighter.html",["feast-tpl!app/feast-tpl!ui-block/highlighter/highlighter.html"],function(a){return a});define("ui-block/highlighter/highlighter",["exports","feast","feast-tpl!./highlighter.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=0;var g=1;exports.default=c.default.Block.extend({name:"highlighter",template:d.default,blocks:{},splitter:function a(b,c){var d=[];var e=void 0;var h=void 0;var i=true;var j=void 0;if(!b){return d}if(!c){d.push(b);return d}if(i){e=0;for(var k=0;k<c.length;k++){j=c[k];if(j[f]<e||j[g]>b.length||j[f]>j[g]){i=false}e=j[g]}}if(i){e=0;for(var l=0;l<c.length;l++){j=c[l];h=b.substring(e,j[0]);d.push(h);h=b.substring(j[0],j[1]);d.push(h);e=j[1]}if(e<b.length){h=b.substring(e,b.length);d.push(h)}}else{d.push(b)}return d}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-preview-attaches-item/list-letter-preview-attaches-item",["require","exports","feast","feast-tpl!./list-letter-preview-attaches-item.html","service/search-attaches/utils","ui-block/highlighter/highlighter","ui-block/ico/ico"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);exports.default=a.default.Block.extend({name:"list-letter-preview-attaches-item",rootClassName:"ll-sai",template:b.default,blocks:{ico:e.default,highlighter:d.default},defaults:{"layout-mode":"2pane",vertical:false,"last-attach":false},events:{click:"onAttachClick"},getAttachmentIcon:c.getAttachmentIcon,onAttachClick:function(a){a.preventDefault();var b=this.get("model");var d=this.get("attach");var e=d.partId;var f=(0,c.getAttachmentId)(e);var g=b.get("expand")||b.get("id");this.broadcast("attachments:openviewer",{message:b,attachment:d,attachmentId:f,msgId:g,from:"ll-prvw-itm"})},getQaId:function(){var a=this.get("attach").formName;return"ll-preview-attaches-item:".concat(a===null||a===void 0?void 0:a.value)}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-preview-attaches-more/list-letter-preview-attaches-more.html",["feast"],function(a){return a.smartParse('<span>\n\t<fn:var name="count" value="{attrs[\'more-count\']}"/>\n\t<fn:var name="vertical" value="{attrs[\'vertical\']}"/>\n\n\t<bem:mod name="vertical" test="vertical"/>\n\n\t<b:react-async\n\t\tremit:contextmenu.stop\n\t\tremit:click.prevent\n\t\tqa:id="ll-preview-attaches-more"\n\n\t\tcomponent="AttachmentDropdown"\n\n\t\tonChange="{_this.attachmentDropdownChange.bind(_this)}"\n\t\toverlayContainer="{document.getElementById(\'portal-overlay\')}"\n\t\titems="{_this.getAttachmentItems()}"\n\t\topen="{attrs[\'dropdown-open\']}"\n\t\tponyMode="{attrs[\'pony-mode\']}"\n\t\tmode="search"\n\t\tbuttonSize="{vertical && \'large\'}"\n\t\tmoreCount="{count}"\n\t\tuse:mediator="themes-manager"\n\t/>\n</span>\n',"app/feast-tpl!ui-block/list-letter-preview-attaches-more/list-letter-preview-attaches-more.html")});define("feast-tpl!ui-block/list-letter-preview-attaches-more/list-letter-preview-attaches-more.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-preview-attaches-more/list-letter-preview-attaches-more.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-preview-attaches-more/list-letter-preview-attaches-more",["require","exports","feast","feast-tpl!./list-letter-preview-attaches-more.html","service/search-attaches/utils"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);var d=a.default.Block.extend({name:"list-letter-preview-attaches-more",rootClassName:"ll-sam",template:b.default,attachmentDropdownChange:function(a){this.set("dropdown-open",a)},getAttachmentItems:function(){var a=this;var b=this.get("items");return b.reduce(function(b,d){var e,f;return b.concat({title:(e=d.formName)===null||e===void 0?void 0:e.value,extension:(0,c.getAttachmentExtension)((f=d.formName)===null||f===void 0?void 0:f.value),onClick:function(b){b.preventDefault();var e=a.get("model");var f=d.partId;var g=(0,c.getAttachmentId)(f);var h=e.get("expand")||e.get("id");if(g.split(";").length>2){a.broadcast("moreinvalid");return}a.broadcast("attachments:openviewer",{message:e,attachment:d,attachmentId:g,msgId:h,from:"ll-prvw-more"})}})},[])}});d.resetAttachmentDropdown=function(){d.getInstances().forEach(function(a){var b=a.get("dropdown-open");if(b){a.set("dropdown-open",false)}})};exports.default=d});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-preview-attaches/list-letter-preview-attaches",["require","exports","feast","feast-tpl!./list-letter-preview-attaches.html","service/search-attaches/utils","ui-block/list-letter-preview-attaches-item/list-letter-preview-attaches-item","ui-block/list-letter-preview-attaches-more/list-letter-preview-attaches-more"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);exports.default=a.default.Block.extend({name:"list-letter-preview-attaches",rootClassName:"ll-sa",template:b.default,blocks:{"preview-attaches-item":d.default,"preview-attaches-more":e.default},defaults:{"layout-mode":"2pane"},getAttachmentExtension:c.getAttachmentExtension})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-preview-stub/list-letter-preview-stub.html",["feast"],function(a){return a.smartParse('<div qa:id="ll-preview-stub">\n\t<fn:var name="attachesStubs" value="{_this.getArrayOfAttachesStubs()}"/>\n\t<fn:var name="compactMode" value="{attrs.isCompact ? \'compact\' : \'incompact\'}"/>\n\t<fn:var name="pony" value="{attrs[\'pony-mode\'] ? \'pony\' : \'normal\'}"/>\n\t<fn:var name="location" value="{attrs[\'metathread\'] ? \'meta\' : \'folder\'}"/>\n\n\t<bem:mod name="layoutMode" value="{compactMode + \'_\' + pony + \'_\' + location}"/>\n\n\t<fn:for data="attachesStubs" as="stub">\n\t\t<div key="{stub.key}" bem:elem="item">\n\t\t\t<bem:mod name="mode" value="{compactMode + \'_\' + stub.type}"/>\n\t\t</div>\n\t</fn:for>\n</div>\n',"app/feast-tpl!ui-block/list-letter-preview-stub/list-letter-preview-stub.html")});define("feast-tpl!ui-block/list-letter-preview-stub/list-letter-preview-stub.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-preview-stub/list-letter-preview-stub.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-preview-stub/list-letter-preview-stub",["require","exports","default-values","feast","feast-tpl!./list-letter-preview-stub.html"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);exports.default=b.default.Block.extend({name:"list-letter-preview-stub",rootClassName:"ll-preview-stub",template:c.default,getArrayOfAttachesStubs:function(){var b=this.get("attachesCount");var c=this.get("isCompact");var d=[];var e=a.LETTER_PREVIEWS_CONFIG["stubs-count"];var f=c?e-1:e;var g=Math.min(f,b);for(var h=0;h<g;h++){d.push({type:"normal",key:h})}if(b>f){d.push({type:"small",key:d.length})}return d}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-read-status/list-letter-read-status.html",["feast"],function(a){return a.smartParse('<span\n\tremit:click.stop="toggle"\n\tqa:id="unread:{attrs.state}"\n\ttitle="{_this.getTitle()}"\n\tdisabled="{attrs[\'disable-hover\']}"\n>\n\t<bem:mod name="is-active" test="attrs.state"/>\n\t<bem:mod name="disabled-hover" test="attrs[\'disable-hover\']"/>\n\t<bem:mod name="shift" test="attrs.shift"/>\n\t<bem:mod name="dotSize" value="{attrs.dotSize}" test="attrs.dotSize"/>\n\n\t<span bem:elem="ico" fn:if="_this.getIconName()">\n\t\t<b:ico name="{_this.getIconName()}"/>\n\t</span>\n</span>\n',"app/feast-tpl!ui-block/list-letter-read-status/list-letter-read-status.html")});define("feast-tpl!ui-block/list-letter-read-status/list-letter-read-status.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-read-status/list-letter-read-status.html"],function(a){return a});define("ui-block/list-letter-read-status/list-letter-read-status",["exports","feast","feast-tpl!./list-letter-read-status.html","ui-block/ico/ico"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockData=undefined;var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}var h=exports.blockData={name:"list-letter-read-status",rootClassName:"ll-rs",template:e.default,immutable:true,isolate:true,defaults:{model:null,state:false,"disable-hover":false,"is-forwarded":false,"is-replied":false},notVisualAttributes:{model:true,"disable-hover":true},blocks:{ico:f.default},getTitle:function a(){return this.get("state")?i18n("Пометить прочитанным"):i18n("Пометить непрочитанным")},getIconName:function a(){if(this.get("is-forwarded")&&this.get("is-replied")){return"mail_20:actions:forward_reply_small"}if(this.get("is-forwarded")){return"mail_20:actions:forward_small"}if(this.get("is-replied")){return"mail_20:actions:reply_small"}return false}};exports.default=d.default.Block.extend(h)});define("feast-tpl!app/feast-tpl!ui-block/list-letter-schedule-status/list-letter-schedule-status.html",["feast"],function(a){return a.smartParse('<span\n\ttitle="{_this.getFormattedDate(attrs.date)}"\n>\n\t<bem:mod name="disabled-hover" test="attrs[\'disable-hover\']"/>\n\n\t<span bem:elem="icon">\n\t\t<b:ico name="status:time"/>\n\t</span>\n</span>\n',"app/feast-tpl!ui-block/list-letter-schedule-status/list-letter-schedule-status.html")});define("feast-tpl!ui-block/list-letter-schedule-status/list-letter-schedule-status.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-schedule-status/list-letter-schedule-status.html"],function(a){return a});define("ui-block/list-letter-schedule-status/list-letter-schedule-status",["exports","feast","feast-mod/letter-date","feast-tpl!./list-letter-schedule-status.html","ui-block/ico/ico","ui-block/list-letter-common/list-letter-abstract"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=i(a);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend((0,e.withWelterLetterPart)({name:"list-letter-schedule-status",rootClassName:"ll-ss",template:g.default,immutable:true,isolate:true,blocks:{ico:h.default},defaults:{state:false,"disable-hover":false},notVisualAttributes:{model:true,"disable-hover":true},getFormattedDate:function a(c){return(0,b.scheduleDate)(c)}}))});define("feast-tpl!app/feast-tpl!ui-block/list-letter-snippet/list-letter-snippet.html",["feast"],function(a){return a.smartParse('<fn:choose>\n\t<fn:when test="!attrs.search">\n\t\t<span bem:elem="normal">\n\t\t\t{attrs.value}\n\t\t</span>\n\t</fn:when>\n\n\t<fn:otherwise>\n\t\t<span bem:elem="search">\n\t\t\t<b:highlighter\n\t\t\t\ttext="{attrs.value}"\n\t\t\t\tcolor="{attrs.color}"\n\t\t\t/>\n\t\t</span>\n\t</fn:otherwise>\n</fn:choose>\n',"app/feast-tpl!ui-block/list-letter-snippet/list-letter-snippet.html")});define("feast-tpl!ui-block/list-letter-snippet/list-letter-snippet.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-snippet/list-letter-snippet.html"],function(a){return a});define("ui-block/list-letter-snippet/list-letter-snippet",["exports","feast","feast-tpl!./list-letter-snippet.html","ui-block/highlighter/highlighter"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"list-letter-snippet",rootClassName:"ll-sp",template:e.default,immutable:true,isolate:true,isolateEvents:true,defaults:{search:false,value:"",color:null},blocks:{highlighter:f.default}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-subject/list-letter-subject.html",["feast"],function(a){return a.smartParse('<fn:choose>\n\t<fn:when test="!attrs.search">\n\t\t<span bem:elem="normal">\n\t\t\t{attrs.subject}\n\t\t</span>\n\t</fn:when>\n\n\t<fn:otherwise>\n\t\t<span bem:elem="search">\n\t\t\t<b:highlighter\n\t\t\t\ttext="{attrs.subject}"\n\t\t\t\tcolor="{attrs.color}"\n\t\t\t/>\n\t\t</span>\n\t</fn:otherwise>\n</fn:choose>\n',"app/feast-tpl!ui-block/list-letter-subject/list-letter-subject.html")});define("feast-tpl!ui-block/list-letter-subject/list-letter-subject.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-subject/list-letter-subject.html"],function(a){return a});define("ui-block/list-letter-subject/list-letter-subject",["exports","feast","feast-tpl!./list-letter-subject.html","ui-block/highlighter/highlighter"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"list-letter-subject",rootClassName:"ll-sj",template:e.default,immutable:true,isolate:true,isolateEvents:true,defaults:{search:false,subject:"",color:null},blocks:{highlighter:f.default}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-unsubscribe/list-letter-unsubscribe.html",["feast"],function(a){return a.smartParse('<div qa:id="ll-unsubscribe"\n\t bem:elem="button"\n\t remit:click.prevent.stop="unsubscribe:ll:click"\n\t event:details="{sender: attrs.unsubscribeSender}"\n>\n\t<bem:mod name="3pane" test="attrs[\'layout-mode\'] === \'3pane\'"/>\n\t<span promo:id="ll-unsubscribe">\n\t\t{i18n(\'Отписаться\')}\n\t</span>\n</div>\n',"app/feast-tpl!ui-block/list-letter-unsubscribe/list-letter-unsubscribe.html")});define("feast-tpl!ui-block/list-letter-unsubscribe/list-letter-unsubscribe.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-unsubscribe/list-letter-unsubscribe.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-unsubscribe/list-letter-unsubscribe",["require","exports","feast","feast-tpl!./list-letter-unsubscribe.html","service/radars/decorator","service/radars/index"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);exports.default=a.default.Block.extend((0,c.default)({events:[]})({name:"list-letter-unsubscribe",rootClassName:"ll-unsubscribe",template:b.default,defaults:{unsubscribeSender:null},events:{"unsubscribe:ll:click":"onClick"},blocks:{},didMount:function(){var a;(0,d.default)({type:"unsub_unread_newsl_ll_show",dwh:{sender:(a=this.get("unsubscribeSender"))===null||a===void 0?void 0:a.email}})},onClick:function(a){var b=a.details.sender;this.broadcast("unsubscribe:from:ll",{sender:b});(0,d.default)({type:"unsub_unread_newsl_ll_clck",dwh:{sender:b.email}})}}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-common/list-letter-common",["require","exports","default-values","feast","feast-mod/letter-date","feast-tpl!./list-letter-common.html","helpers/letter","helpers/radar-utils","service/emoji","service/radars/decorator","service/search-attaches/attachesList","service/search-attaches/getAttaches","service/search-attaches/viewModes","ui-block/delimeter/delimeter","ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview","ui-block/list-letter-avatar/list-letter-avatar","ui-block/list-letter-badge/list-letter-badge","ui-block/list-letter-common/list-letter-abstract","ui-block/list-letter-common/list-letter-abstract-payment-die","ui-block/list-letter-correspondent/list-letter-correspondent","ui-block/list-letter-flag-status/list-letter-flag-status","ui-block/list-letter-folder/list-letter-folder","ui-block/list-letter-order/list-letter-abstract-order","ui-block/list-letter-order/list-letter-order","ui-block/list-letter-payment-button/list-letter-payment-button","ui-block/list-letter-payment-die/list-letter-payment-die","ui-block/list-letter-payment-universal-die/list-letter-payment-universal-die","ui-block/list-letter-preview-attaches/list-letter-preview-attaches","ui-block/list-letter-preview-stub/list-letter-preview-stub","ui-block/list-letter-read-status/list-letter-read-status","ui-block/list-letter-schedule-status/list-letter-schedule-status","ui-block/list-letter-snippet/list-letter-snippet","ui-block/list-letter-subject/list-letter-subject","ui-block/list-letter-unsubscribe/list-letter-unsubscribe"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);d=__importDefault(d);h=__importDefault(h);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);exports.default=b.default.Block.extend((0,p.withWelterLetter)((0,h.default)({id:"letter-item",events:[{name:"clickavatar",rename:function(a){return a.is("selected")?"deselect":"select"}},{name:"togglestatus:unread",rename:function(a){return(0,f.renameRadarOnStatusToggle)(a,"unread")}},{name:"togglestatus:flagged",rename:function(a){return(0,f.renameRadarOnStatusToggle)(a,"flagged")}}]})({name:"list-letter-common",rootClassName:"llc",template:d.default,immutable:true,isolate:true,performanceTrace:true,blocks:{delimeter:l.default,"read-status":B.default,avatar:n.default,badge:o.default,correspondent:r.default,"flag-status":s.default,"schedule-status":C.default,subject:E.default,snippet:D.default,"attach-status":m.default,folder:t.default,"payment-die":x.default,"payment-button":w.default,"preview-attaches":z.default,order:v.default,stub:A.default,unsubscribe:F.default,"payment-universal-die":y.default},defaults:{"disable-letter-item-folder":a.DISABLE_LETTER_ITEM_FOLDER,selected:false,"disable-subject":false,search:false,indent:false,messagesAttaches:null,fetchAttaches:false,"layout-mode":"2pane",isThreadWithReliableMark:a.THREAD_WITH_RELIABLE_MARK,"enable-tags":a.ENABLE_TAGS},notVisualAttributes:{"list-index":true},mods:{letterDate:c.letterDate,scheduleDate:c.scheduleDate},constructor:function(){b.default.Block.apply(this,arguments);this.meta=this.get("model").getPaymentMeta()},didMount:function(){this.handleIntersectViewport();(0,g.emojiFallback)(this.refs.title,"ll-cmn")},didUpdate:function(){(0,g.emojiFallback)(this.refs.title,"ll-cmn")},getAttachesPreviewCondition:function(){var a=this.get("fetchAttaches")&&!this.get("messagesAttaches");return!a&&q.getPaymentDieDisplayMode.call(this)==="none"},getSubject:p.getSubject,getImageSrc:p.getImageSrc,isProbablyPhishing:p.isProbablyPhishing,isCorrespondentDangerous:p.isCorrespondentDangerous,getCorrespondent:p.getCorrespondent,getCorrespondentTooltip:p.getCorrespondentTooltip,getDateTooltip:p.getDateTooltip,getCounter:p.getCounter,getCategory:p.getCategory,getAllAttaches:j.getAllAttaches,getSearchAttaches:j.getSearchAttaches,getAttaches:i.getAttaches,getAttachesModes:k.getAttachesModes,isImportant:p.isImportant,hasBadge:p.hasBadge,getSnippetValue:p.getSnippetValue,getPaymentDieDisplayMode:q.getPaymentDieDisplayMode,shouldShowUniversalPaymentDie:q.shouldShowUniversalPaymentDie,shouldHideTransactionCategory:q.shouldHideTransactionCategory,showOrder:u.showOrder,getTransactionMetadata:u.getTransactionMetadata,rootQaId:p.rootQaId,letterDate:c.letterDate,getUnsubscribeSender:p.getUnsubscribeSender,handleIntersectViewport:p.handleIntersectViewport,checkOfficialGreen:e.checkOfficialGreen,checkImportantReliable:e.checkImportantReliable})))});define("feast-tpl!app/feast-tpl!ui-block/list-letter-common-touch/list-letter-common-touch.html",["feast"],function(a){return a.smartParse('<a\n\tqa:id="{_this.rootQaId()}"\n\tremit:dragstart.prevent\n>\n\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="data" value="{attrs.model}"/>\n\t<fn:var name="subject" value="{_this.getSubject()}"/>\n\t<fn:var name="showFolderFeature" value="{attrs.showfolder && !attrs[\'disable-letter-item-folder\']}"/>\n\n\t\x3c!-- Attributes --\x3e\n\t<fn:attr name="href" value="{attrs.href}"/>\n\t<fn:attr name="tabindex" value="-1"/>\n\t<fn:attr name="data-id" value="{data.get(\'id\')}"/>\n\t<fn:attr name="active" test="attrs.selected"/>\n\n\t\x3c!-- Класс для переходов стрелками и общих стилей для всех элементов списка писем --\x3e\n\t<fn:add-class name="js-letter-list-item"/>\n\n\t\x3c!-- Modificators --\x3e\n\t<bem:mod\n\t\t\tname="active"\n\t\t\ttest="attrs.selected || attrs.active"\n\t/>\n\t<bem:mod\n\t\tname="enable-user-select"\n\t\ttest="attrs[\'enable-user-select\']"\n\t/>\n\t<bem:mod\n\t\tname="swipe-actions-visible"\n\t\ttest="attrs[\'swipe-actions-visible\']"\n\t/>\n\n\t<bem:mod\n\t\tname="pony-mode"\n\t\ttest="attrs[\'pony-mode\']"\n\t/>\n\n\t<bem:mod\n\t\tname="swipe-actions-animated"\n\t\ttest="attrs[\'swipe-actions-animated\']"\n\t/>\n\n\t<bem:mod\n\t\tname="has-indent"\n\t\ttest="attrs[\'indent\']"\n\t/>\n\n\t<bem:mod name="first" test="attrs.first"/>\n\t<bem:mod name="last" test="attrs.last"/>\n\n\t<div bem:elem="background">\n\t\t<bem:mod name="active" test="attrs.selected || attrs.active"/>\n\t</div>\n\n\t<fn:match name="header">\n\t\t\x3c!-- Header:Start --\x3e\n\t\t<div bem:elem="header">\n\t\t\t\x3c!-- Read status:Start --\x3e\n\t\t\t<div bem:elem="read-status" qa:id="unread">\n\t\t\t\t<b:read-status\n\t\t\t\t\tstate="{data.is(\'flags.unread\')}"\n\t\t\t\t\tis-forwarded="{data.is(\'flags.forward\')}"\n\t\t\t\t\tis-replied="{data.is(\'flags.reply\')}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tdisable-hover\n\t\t\t\t\tremit:toggle.prevent="togglestatus:unread"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Read status:End --\x3e\n\n\t\t\t\x3c!-- Avatar:Start --\x3e\n\t\t\t<div bem:elem="avatar" qa:id="avatar">\n\t\t\t\t<b:avatar\n\t\t\t\t\tcentered\n\t\t\t\t\tstate="{attrs.selected}"\n\t\t\t\t\timg-src="{_this.getImageSrc()}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tdisable-hover\n\t\t\t\t\ttouch\n\t\t\t\t\tremit:toggle.prevent="clickavatar"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Avatar:End --\x3e\n\t\t</div>\n\t\t\x3c!-- Header:End --\x3e\n\t</fn:match>\n\n\t<fn:match name="content">\n\t\t\x3c!-- Content:Start --\x3e\n\t\t<div bem:elem="content">\n\n\t\t\t\x3c!-- Correspondent:Start --\x3e\n\t\t\t<div bem:elem="item">\n\t\t\t\t<bem:mod name="correspondent"/>\n\t\t\t\t<bem:mod name="unread" test="data.is(\'flags.unread\')"/>\n\n\t\t\t\t<b:correspondent\n\t\t\t\t\tqa:id="correspondent"\n\t\t\t\t\tstate="{_this.getCorrespondent()}"\n\t\t\t\t/>\n\n\t\t\t</div>\n\t\t\t\x3c!-- Correspondent:End --\x3e\n\n\t\t\t\x3c!-- Flag:Start --\x3e\n\t\t\t<div bem:elem="item" qa:id="flagged">\n\t\t\t\t<bem:mod name="flag"/>\n\n\t\t\t\t<b:flag-status\n\t\t\t\t\tstate="{data.is(\'flags.flagged\')}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tdisable-hover\n\t\t\t\t\tremit:toggle.prevent="togglestatus:flagged"\n\t\t\t\t/>\n\n\t\t\t</div>\n\t\t\t\x3c!-- Flag:End --\x3e\n\n\t\t\t\x3c!-- Badge:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="item"\n\t\t\t\tqa:id="letter:badge"\n\t\t\t\tfn:if="_this.hasBadge()"\n\t\t\t>\n\t\t\t\t<bem:mod name="badge"/>\n\n\t\t\t\t<b:badge\n\t\t\t\t\tcategory="{_this.getCategory()}"\n\t\t\t\t\tcounter="{_this.getCounter()}"\n\t\t\t\t\timportant="{_this.isImportant()}"\n\t\t\t\t\tunread="{data.is(\'flags.unread\')}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Badge:End --\x3e\n\n\t\t\t\x3c!-- Title:Start --\x3e\n\t\t\t<div bem:elem="item" ref="title">\n\t\t\t\t<bem:mod name="title"/>\n\n\t\t\t\t\x3c!-- Subject:Start --\x3e\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="subject"\n\t\t\t\t\tfn:if="!attrs[\'disable-subject\']"\n\t\t\t\t\tqa:id="subject"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="unread" test="data.is(\'flags.unread\')"/>\n\n\t\t\t\t\t<b:subject\n\t\t\t\t\t\tsubject="{subject}"\n\t\t\t\t\t\tcolor="{attrs.search ? data.meta(\'search_subject.color\') : null}"\n\t\t\t\t\t\tsearch="{attrs.search}"\n\t\t\t\t\t/>\n\n\t\t\t\t</span>\n\t\t\t\t\x3c!-- Subject:End --\x3e\n\n\t\t\t\t\x3c!-- Snippet:Start --\x3e\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="snippet"\n\t\t\t\t\tqa:id="snippet"\n\t\t\t\t>\n\n\t\t\t\t\t<b:snippet\n\t\t\t\t\t\tvalue="{_this.getSnippetValue()}"\n\t\t\t\t\t\tcolor="{attrs.search ? data.meta(\'search_snippet.color\') : null}"\n\t\t\t\t\t\tsearch="{attrs.search}"\n\t\t\t\t\t/>\n\n\t\t\t\t</span>\n\t\t\t\t\x3c!-- Snippet:End --\x3e\n\n\t\t\t</div>\n\t\t\t\x3c!-- Title:End --\x3e\n\n\t\t\t\x3c!-- Folder:Start --\x3e\n\t\t\t<div bem:elem="item" fn:if="showFolderFeature">\n\t\t\t\t<bem:mod name="folder"/>\n\t\t\t\t<fn:var name="folder" value="{data.getFolder()}"/>\n\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="data.isSchedule()">\n\t\t\t\t\t\t\x3c!-- Отложенная отправка (когда показываем имя папки) --\x3e\n\t\t\t\t\t\t<b:folder\n\t\t\t\t\t\t\ttext="{folder.get(\'name\')}"\n\t\t\t\t\t\t\tqa:id="folder"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<b:folder\n\t\t\t\t\t\t\ttext="{folder.get(\'name\')}"\n\t\t\t\t\t\t\tqa:id="folder"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\n\t\t\t</div>\n\t\t\t\x3c!-- Folder:End --\x3e\n\n\t\t\t\x3c!-- Schedule:Start --\x3e\n\t\t\t<div bem:elem="item" fn:if="!showFolderFeature && data.isSchedule()">\n\t\t\t\t<b:schedule-status\n\t\t\t\t\t\tdate="{data.get(\'send_date\')}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Schedule:End --\x3e\n\n\t\t\t\x3c!-- Attach:Start --\x3e\n\t\t\t<fn:if test="!attrs[\'disable-attach\']">\n\t\t\t\t<div bem:elem="item">\n\t\t\t\t\t<bem:mod name="attach-status"/>\n\n\t\t\t\t\t<b:attach-status\n\t\t\t\t\t\tfn:if="data.is(\'flags.attach\')"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\t\t\t\x3c!-- Attach:End --\x3e\n\n\t\t\t\x3c!-- Date:Start --\x3e\n\t\t\t<div bem:elem="item">\n\t\t\t\t<bem:mod name="date"/>\n\t\t\t\t{data.get(\'date\') | letterDate}\n\t\t\t</div>\n\t\t\t\x3c!-- Date:End --\x3e\n\t\t</div>\n\t\t\x3c!-- Content:End --\x3e\n\t</fn:match>\n\n\t<b:swipeable\n\t\tuse:mediator="swipe-manager"\n\t\tremit:underlay-changed="underlay:changed"\n\t\tremit:animation-changed="animation:changed"\n\t\tremit:pan-changed="pan:changed"\n\t\tmax-offset="170"\n\t\tid="swipeable"\n\t>\n\n\t\t<fn:match name="swipe-underlay">\n\t\t\t\x3c!-- Подложка контейнера --\x3e\n\t\t\t<b:letter-swipe-actions\n\t\t\t\tmodel="{data}"\n\t\t\t\tremit:action-unread="togglestatus:unread"\n\t\t\t\tremit:action-flagged="togglestatus:flagged"\n\t\t\t\tremit:action-move="move"\n\t\t\t\tremit:action-remove="remove"\n\t\t\t\tremit:action-spam="spam"\n\t\t\t\tremit:action-unspam="unspam"\n\t\t\t\tuse:mediator="layout-manager"\n\t\t\t/>\n\t\t</fn:match>\n\n\t\t<fn:match name="swipe-header">\n\t\t\t<fn:apply-match name="header"/>\n\t\t</fn:match>\n\t\t<fn:match name="swipe-content">\n\t\t\t<fn:apply-match name="content"/>\n\t\t</fn:match>\n\t</b:swipeable>\n\n\t\x3c!-- Border:Start --\x3e\n\t<b:delimeter full="{attrs[\'full-delimiter\']}" ponymode="{ponyMode}" indent="{attrs.indent}"/>\n\t<b:delimeter ponymode="{ponyMode}" indent="{attrs.indent}" last/>\n\t\x3c!-- Border:End --\x3e\n</a>\n',"app/feast-tpl!ui-block/list-letter-common-touch/list-letter-common-touch.html")});define("feast-tpl!ui-block/list-letter-common-touch/list-letter-common-touch.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-common-touch/list-letter-common-touch.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/letter-swipe-actions/letter-swipe-actions.html",["feast"],function(a){return a.smartParse('<div remit:click.prevent>\n\t<fn:var name="message" value="{attrs.model}" />\n\t<fn:var name="messageFolder" value="{message.getFolder()}" />\n\n\t<bem:mod name="touch" test="attrs.touch" />\n\t<bem:mod name="compact" test="attrs.compact" />\n\n\t\x3c!-- Непрочитанность --\x3e\n\t<div bem:elem="swipe-actions-element">\n\t\t<b:button2\n\t\t\tico="point"\n\t\t\ttouch\n\t\t\tpure\n\t\t\tremit:mousedown.prevent="action-unread"\n\t\t\tcentered\n\t\t/>\n\t</div>\n\n\t\x3c!-- Пометить флажком --\x3e\n\t<div bem:elem="swipe-actions-element">\n\t\t<b:button2\n\t\t\tico="flag"\n\t\t\ttouch\n\t\t\tpure\n\t\t\tremit:mousedown.prevent="action-flagged"\n\t\t\tcentered\n\t\t/>\n\t</div>\n\n\t<div bem:elem="swipe-actions-element">\n\t\t<div bem:elem="swipe-actions-element">\n\t\t\t<b:button2\n\t\t\t\tico="folder-move"\n\t\t\t\ttouch\n\t\t\t\tpure\n\t\t\t\tremit:mousedown.prevent="click:move"\n\t\t\t\tcentered\n\t\t\t/>\n\t\t</div>\n\t</div>\n\n\t\x3c!-- Удалить --\x3e\n\t<div bem:elem="swipe-actions-element">\n\t\t<b:button2\n\t\t\tico="delete"\n\t\t\ttouch\n\t\t\tpure\n\t\t\tremit:mousedown.prevent="action-remove"\n\t\t\tcentered\n\t\t/>\n\t</div>\n\n\t\x3c!-- Спам/не спам --\x3e\n\t<div bem:elem="swipe-actions-element">\n\t\t<b:button2\n\t\t\tico="spam-on"\n\t\t\ttouch\n\t\t\tpure\n\t\t\tremit:mousedown.prevent="action-spam"\n\t\t\tfn:if="!messageFolder.isSpam()"\n\t\t\tcentered\n\t\t/>\n\t\t<b:button2\n\t\t\tico="spam-off"\n\t\t\ttouch\n\t\t\tpure\n\t\t\tremit:mousedown.prevent="action-unspam"\n\t\t\tfn:if="messageFolder.isSpam()"\n\t\t\tcentered\n\t\t/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/letter-swipe-actions/letter-swipe-actions.html")});define("feast-tpl!ui-block/letter-swipe-actions/letter-swipe-actions.html",["feast-tpl!app/feast-tpl!ui-block/letter-swipe-actions/letter-swipe-actions.html"],function(a){return a});define("ui-block/letter-swipe-actions/letter-swipe-actions",["exports","feast","feast-tpl!./letter-swipe-actions.html","service/layer","ui-block/button2/button2"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend({name:"letter-swipe-actions",template:f.default,blocks:{button2:h.default},events:{"click:move":"onMove"},onMove:function a(){var b=this.get("model");g.default.open("move-to-folder",{letter:b},{dimmer:true,mobile:true,resolvable:false})}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-attach-status/list-letter-attach-status.html",["feast"],function(a){return a.smartParse('<span\n\ttitle="{_this.getAttachTitle()}"\n\tqa:id="attach:true"\n>\n\t<bem:mod name="compact" test="attrs[\'compact\']"/>\n\n\t<b:ico name="attach"/>\n</span>\n\n',"app/feast-tpl!ui-block/list-letter-attach-status/list-letter-attach-status.html")});define("feast-tpl!ui-block/list-letter-attach-status/list-letter-attach-status.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-attach-status/list-letter-attach-status.html"],function(a){return a});define("ui-block/list-letter-attach-status/list-letter-attach-status",["exports","feast","feast-tpl!./list-letter-attach-status.html","ui-block/ico/ico","ui-block/list-letter-common/list-letter-abstract"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=h(a);var f=h(b);var g=h(c);function h(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend((0,d.withWelterLetterPart)({name:"list-letter-attach-status",rootClassName:"ll-as",template:f.default,immutable:true,isolate:true,isolateEvents:true,blocks:{ico:g.default},getAttachTitle:function a(){return i18n("С вложениями")}}))});define("feast-tpl!app/feast-tpl!ui-block/swipeable/swipeable.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="animated" test="attrs.animated"/>\n\t<bem:mod name="swiped" test="attrs.underlay"/>\n\n\t<fn:if test="attrs.underlay">\n\t\t<div bem:elem="underlay" ref="underlay">\n\t\t\t<fn:apply-match name="swipe-underlay"/>\n\t\t</div>\n\t\t<div bem:elem="underlay-right" ref="underlayRight">\n\t\t\t<fn:apply-match name="swipe-underlay-right"/>\n\t\t</div>\n\t</fn:if>\n\n\t<div bem:elem="content-wrapper">\n\t\t<div bem:elem="content" ref="content">\n\t\t\t<div bem:elem="header">\n\t\t\t\t<fn:apply-match name="swipe-header"/>\n\t\t\t</div>\n\t\t\t<div bem:elem="content-element">\n\t\t\t\t<fn:apply-match name="swipe-content"/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/swipeable/swipeable.html")});define("feast-tpl!ui-block/swipeable/swipeable.html",["feast-tpl!app/feast-tpl!ui-block/swipeable/swipeable.html"],function(a){return a});define("ui-block/swipeable/swipeable",["exports","default-values","feast","feast-tpl!./swipeable.html","helpers/browser","service/radars/decorator","../../lazy.modules"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockSpec=exports.SwipeTarget=undefined;var g=k(b);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}var l=i.default.capabilities["touch-support"];var m=function a(b){return b.SUPPORT_POINTER_EVENTS?"pointerdown":"touchstart"};var n=350;var o=exports.SwipeTarget={RIGHT:"RIGHT",LEFT:"LEFT",CENTER:"CENTER",RIGHT_SMALL:"RIGHT_SMALL"};var p=exports.blockSpec={name:"swipeable",template:h.default,isolate:false,immutable:true,touchEventsReady:false,swipeWidthLessElWidth:false,elWidth:0,currentPos:o.CENTER,notVisualAttributes:{disabled:true},blocks:{},attrChanged:{disabled:function a(b){this.touchEventsReady&&this.watchSwipe(!b)},animated:function a(b){var c=this;clearTimeout(this.timeouts.animated);this.broadcast("animation-changed",{value:b});if(b){this.timeouts.animated=setTimeout(function(){return c.set("animated",false)},n)}},underlay:function a(b){this.broadcast("underlay-changed",{value:b})}},constructor:function a(){g.default.Block.prototype.constructor.apply(this,arguments);this.timeouts={}},didMount:function b(){var c=this;this._insiders=[];this._pos={x:0,y:0};this.addInsideTarget(this.el);if(l){(0,f.lazyHammerJS)().then((0,f.uniqCallback)(this,function(b){if(!c.isMounted()||a.DISABLE_LETTER_SWIPE){return}c.Hammer=b;c.handleTouchStart=function(){c.activateTouchEvents()};c.el.addEventListener(m(b),c.handleTouchStart,true)}))}},didUnmount:function a(){l&&this.Hammer&&this.el.removeEventListener(m(this.Hammer),this.handleTouchStart,true);Object.values(this.timeouts).forEach(function(a){window.clearTimeout(a)});if(this.touchEventsReady){this.watchOutsideClick(false);this.watchSwipe(false);this._insiders=[]}},activateTouchEvents:function a(){var b=this.Hammer;this.mc=new b.Manager(this.el,{recognizers:b.defaults.preset,inputClass:b.SUPPORT_POINTER_EVENTS?b.PointerEventInput:b.TouchInput});this.mc.get("pan").set({direction:b.DIRECTION_HORIZONTAL});this.mc.get("swipe").set({direction:b.DIRECTION_HORIZONTAL});this.touchEventsReady=true;this.el.removeEventListener(m(b),this.handleTouchStart,true);this.watchSwipe(!this.is("disabled"))},watchSwipe:function a(b){var c=this;b=b===void 0?true:!!b;if(b){this.mc.on("panleft panright",function(a){return c.onPan(a)});this.mc.on("panstart",function(a){return c.onPanStart(a)});this.mc.on("panend",function(a){return c.onPanEnd(a)})}else{this.mc.off("panleft panright panstart panend");this.mc.off("swiperight swipeleft")}},onPanStart:function a(b){this.swipeWidthLessElWidth=this.swipeWidthLessElWidthFunc();this.elWidth=this.el?this.el.offsetWidth:0;this.isHPanned=Math.abs(b.deltaX)>Math.abs(b.deltaY);if(this.isHPanned){this.set("animated",false);this.broadcast("pan-changed",{value:true});this._lastPanX=0}},onPan:function a(b){if(this.isHPanned){var c=b.deltaX-this._lastPanX;this._lastPanX=b.deltaX;this.moveContainerX(c)}},onPanEnd:function b(c){if(this.isHPanned){this.broadcast("pan-changed",{value:false});if(-c.deltaX>=this.getSwipeWidth()/5&&this.currentPos&&![o.RIGHT_SMALL,o.RIGHT].includes(this.currentPos)){this.swipe(o.LEFT)}else if(this.currentPos===o.LEFT&&c.deltaX>=0){this.reset()}else if(this.currentPos!==o.LEFT&&this._pos.x>0&&!!this.attrs.maxOffsetPartLeft&&a.ENABLE_LETTER_FAST_ACTION_SWIPE){if(this._pos.x>=this.attrs.maxOffsetPartLeft){if(this.attrs.onRightAction){this.attrs.onRightAction()}if(this.attrs.canFullSwipe){this.swipe(o.RIGHT)}else{this.reset()}}else if(c.deltaX>=this.attrs.maxOffsetPartLeft/2){this.swipe(o.RIGHT_SMALL)}else{this.reset()}}else{this.reset()}}},swipe:function b(c){var d=this.reactComponent?this.swipeableContentRef.current:this.refs.content;var e=d.offsetWidth;var f=e*(c===o.RIGHT?1:-1);if(c===o.RIGHT_SMALL&&this.attrs.maxOffsetPartLeft&&a.ENABLE_LETTER_FAST_ACTION_SWIPE){f=this.attrs.maxOffsetPartLeft}this.currentPos=c;this.set("animated",true);this.setContainerPos(f);this.watchOutsideClick(c!==o.CENTER)},moveContainerX:function b(c){if(c>0){if(this.attrs.maxOffsetPartLeft&&a.ENABLE_LETTER_FAST_ACTION_SWIPE){if(this._pos.x>=this.attrs.maxOffsetPartLeft){c=c/(1.5*c)}}else if(this._pos.x>=0){c=c/(6*c)}}this.setContainerPos(this._pos.x+c)},setContainerPos:function b(c,d){var e=this;var f=c>0?this.elWidth:this.getSwipeWidth();var g=c>0?1:-1;c=!c&&c!==0?this._pos.x:Math.min(Math.abs(c),f);c=c*g;this._pos.x=c;this._pos.y=d;if(c===0){this.timeouts.underlay=window.setTimeout(function(){return e.set("underlay",false)},n)}else{this.set("underlay",true)}var h=this.reactComponent?this.swipeableContentRef.current:this.refs.content;var j=this.reactComponent?this.swipeUnderlayRef.current:this.refs.underlay;var k=this.reactComponent?this.swipeUnderlayRightRef.current:this.refs.underlayRight;this.timeouts.position=requestAnimationFrame(function(){var b=Math.max(0,Math.min(1,Math.abs(1.5*c/f)));var d=!e.attrs.maxOffsetPartLeft||!a.ENABLE_LETTER_FAST_ACTION_SWIPE?1:Math.max(0,Math.min(1,c/e.attrs.maxOffsetPartLeft));var g=e.elWidth-f;if(h){h.style[i.default.prefixedCSS("transform")]="translate3d("+c+"px,0,0) scale3d(1,1,1)"}if(j){j.style.opacity=b;j.style[i.default.prefixedCSS("transform")]="translate3d("+(e.elWidth+c-g)+"px,0,0) scale3d(1,1,1)"}if(k&&a.ENABLE_LETTER_FAST_ACTION_SWIPE){e.set("rightActive",c>e.attrs.maxOffsetPartLeft&&e.currentPos!==o.LEFT);if(c>=0){k.style.opacity=d;k.style[i.default.prefixedCSS("width")]=c+"px"}else{k.style.opacity=0;k.style[i.default.prefixedCSS("width")]="0px"}}})},getSwipeWidth:function a(){var b=this.attrs["max-offset"]?parseInt(this.attrs["max-offset"],10):this.elWidth;return Math.min(b,this.elWidth)},swipeWidthLessElWidthFunc:function a(){if(!this.attrs["max-offset"]){return false}var b=this.el?this.el.offsetWidth:0;var c=parseInt(this.attrs["max-offset"],10);return c<b},watchOutsideClick:function a(b){var c=this.el;if(!c){return}b=b===void 0?true:!!b;this[b?"$on":"$off"](c.ownerDocument,"touchstart","onOutsideClick");this[b?"$on":"$off"](c.ownerDocument,"mousedown","onOutsideClick")},onOutsideClick:function a(b){var c=this._insiders.some(function(a){return a.contains(b.target)});if(!c){this.reset();this.watchOutsideClick(false)}},addInsideTarget:function a(b){this._insiders.push(b)},reset:function a(){if(!this.touchEventsReady){return}this.currentPos=o.CENTER;this.set("animated",true);this.setContainerPos(0,0);this.watchOutsideClick(false)}};exports.default=g.default.Block.extend((0,j.default)({})(p))});define("ui-block/list-letter-common-touch/list-letter-common-touch",["exports","default-values","feast","feast-mod/letter-date","feast-tpl!./list-letter-common-touch.html","helpers/radar-utils","service/emoji","service/radars/decorator","ui-block/delimeter/delimeter","ui-block/letter-swipe-actions/letter-swipe-actions","ui-block/list-letter-attach-status/list-letter-attach-status","ui-block/list-letter-avatar/list-letter-avatar","ui-block/list-letter-badge/list-letter-badge","ui-block/list-letter-common/list-letter-abstract","ui-block/list-letter-correspondent/list-letter-correspondent","ui-block/list-letter-flag-status/list-letter-flag-status","ui-block/list-letter-folder/list-letter-folder","ui-block/list-letter-read-status/list-letter-read-status","ui-block/list-letter-schedule-status/list-letter-schedule-status","ui-block/list-letter-snippet/list-letter-snippet","ui-block/list-letter-subject/list-letter-subject","ui-block/swipeable/swipeable"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockSpec=undefined;var v=L(b);var w=L(d);var x=L(g);var y=L(h);var z=L(i);var A=L(j);var B=L(k);var C=L(l);var D=L(n);var E=L(o);var F=L(p);var G=L(q);var H=L(r);var I=L(s);var J=L(t);var K=L(u);function L(a){return a&&a.__esModule?a:{default:a}}var M=exports.blockSpec={name:"list-letter-common-touch",rootClassName:"llc-t",template:w.default,immutable:true,isolate:true,performanceTrace:true,blocks:{"read-status":G.default,avatar:B.default,badge:C.default,correspondent:D.default,"flag-status":E.default,subject:J.default,snippet:I.default,"attach-status":A.default,"schedule-status":H.default,folder:F.default,"letter-swipe-actions":z.default,swipeable:K.default,delimeter:y.default},defaults:{"disable-letter-item-folder":a.DISABLE_LETTER_ITEM_FOLDER,selected:false,"disable-subject":false,search:false,"swipe-actions-visible":false,indent:false,"layout-mode":"2pane"},events:{"pan:changed":"onPanChanged","underlay:changed":"onUnderlayChanged","animation:changed":"onAnimationChanged"},mods:{letterDate:c.letterDate,scheduleDate:c.scheduleDate},didMount:function a(){(0,f.emojiFallback)(this.refs.title,"ll-cmn-t")},didUpdate:function a(){(0,f.emojiFallback)(this.refs.title,"ll-cmn-t")},getSubject:m.getSubject,getImageSrc:m.getImageSrc,isProbablyPhishing:m.isProbablyPhishing,isCorrespondentDangerous:m.isCorrespondentDangerous,getCorrespondent:m.getCorrespondent,getCorrespondentTooltip:m.getCorrespondentTooltip,getCounter:m.getCounter,getCategory:m.getCategory,isImportant:m.isImportant,hasBadge:m.hasBadge,getSnippetValue:m.getSnippetValue,rootQaId:m.rootQaId,shouldHideTransactionCategory:function a(){return false},onPanChanged:function a(b){this.set("swipe-actions-touched",b.details.value)},onAnimationChanged:function a(b){this.set("swipe-actions-animated",b.details.value)},onUnderlayChanged:function a(b){this.set("swipe-actions-visible",b.details.value)}};exports.default=v.default.Block.extend((0,m.withWelterLetter)((0,x.default)({id:"letter-item",events:[{name:"clickavatar",rename:function a(b){return b.is("selected")?"deselect":"select"}},{name:"togglestatus:unread",rename:function a(b){return(0,e.renameRadarOnStatusToggle)(b,"unread")}},{name:"togglestatus:flagged",rename:function a(b){return(0,e.renameRadarOnStatusToggle)(b,"flagged")}},{name:"remove",data:e.getModelData},{name:"spam",data:e.getModelData},{name:"unspam",data:e.getModelData}]})(M)))});define("feast-tpl!app/feast-tpl!ui-block/list-letter-compact/list-letter-compact.html",["feast"],function(a){return a.smartParse('<a\n\tqa:id="{_this.rootQaId()}"\n\tremit:dragstart.prevent\n>\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="data" value="{attrs.model}"/>\n\t<fn:var name="folder" value="{data.getFolder()}"/>\n\t<fn:var name="showFolderFeature" value="{attrs.showfolder && !attrs[\'disable-letter-item-folder\']}"/>\n\t<fn:var name="indent" value="{attrs.indent}"/>\n\t<fn:var name="ponyMode" value="{attrs[\'pony-mode\']}"/>\n\t<fn:var name="subject" value="{_this.getSubject()}"/>\n\t<fn:var name="avatarIndent" value="{_this.getAvatarIndent()}"/>\n\t<fn:var name="paymentDieDisplayMode" value="{_this.getPaymentDieDisplayMode()}" />\n\t<fn:var name="unsubscribeSender" value="{_this.getUnsubscribeSender()}" />\n\t<fn:var name="showUniversalDie" value="{_this.shouldShowUniversalPaymentDie()}" />\n\t<fn:var name="showUnsubscribe" value="{unsubscribeSender && !showUniversalDie && (paymentDieDisplayMode === \'none\')}" />\n\t<fn:var name="isTaggable" value="{attrs[\'enable-tags\'] && !_this.getCounter()}"/>\n\t<fn:var name="hasTags" value="{attrs[\'enable-tags\'] && data.is(\'flags.tags\') && data.get(\'flags.tags\').length}" />\n\t<fn:var name="showSnippet" value="{\n\t\t!hasTags &&\n\t\t!(showUnsubscribe && isTaggable)\n\t\t!((attrs.search || showUniversalDie || showUnsubscribe) && ponyMode)\n\t}" />\n\n\t<fn:if test="paymentDieDisplayMode === \'full\'">\n\t\t<fn:var name="paymentDieWithIndent" value="{attrs[\'payment-die-with-indent\']}"/>\n\t</fn:if>\n\n\t\x3c!-- Attributes --\x3e\n\t<fn:attr name="href" value="{attrs.href}"/>\n\t<fn:attr name="tabindex" value="-1"/>\n\t<fn:attr name="data-id" value="{data.get(\'id\')}"/>\n\t<fn:attr name="data-draggable-id" value="{data.get(\'id\')}"/>\n\t<fn:attr name="data-uidl-id" value="{data.get(\'last\')}"/>\n\t<fn:attr name="active" test="attrs.selected"/>\n\n\t\x3c!-- Класс для переходов стрелками и общих стилей для всех элементов списка писем --\x3e\n\t<fn:add-class name="js-letter-list-item"/>\n\n\t\x3c!-- Modificators --\x3e\n\t<bem:mod\n\t\tname="enable-user-select"\n\t\ttest="attrs[\'enable-user-select\']"\n\t/>\n\n\t<bem:mod\n\t\tname="pony-mode"\n\t\ttest="ponyMode"\n\t/>\n\n\t<bem:mod\n\t\tname="has-indent"\n\t\ttest="indent"\n\t/>\n\n\t<bem:mod\n\t\tname="active"\n\t\ttest="attrs.selected || attrs.active"\n\t/>\n\n\t<bem:mod name="first" test="attrs.first"/>\n\t<bem:mod name="last" test="attrs.last"/>\n\n\t\x3c!-- Container:Start --\x3e\n\t<div bem:elem="container">\n\n\t\t<bem:mod\n\t\t\tname="pony-mode"\n\t\t\ttest="ponyMode"\n\t\t/>\n\n\t\t<div bem:elem="background">\n\t\t\t<bem:mod name="active" test="attrs.selected || attrs.active"/>\n\t\t</div>\n\n\t\t\x3c!-- Remember: match должен быть ДО apply-match --\x3e\n\t\t<fn:match name="badge">\n\t\t\t\x3c!-- Badge:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="badge"\n\t\t\t\tqa:id="letter:badge"\n\t\t\t\tfn:if="_this.hasBadge()"\n\t\t\t>\n\t\t\t\t<b:badge\n\t\t\t\t\tcategory="{_this.getCategory()}"\n\t\t\t\t\tcounter="{_this.getCounter()}"\n\t\t\t\t\timportant="{_this.isImportant()}"\n\t\t\t\t\tcompact\n\t\t\t\t\tunread="{data.is(\'flags.unread\')}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Badge:End --\x3e\n\t\t</fn:match>\n\n\t\t\x3c!-- Header:Start --\x3e\n\t\t<div bem:elem="header">\n\t\t\t\x3c!-- Read status:Start --\x3e\n\t\t\t<div bem:elem="read-status" qa:id="unread">\n\t\t\t\t<b:read-status\n\t\t\t\t\tstate="{data.is(\'flags.unread\')}"\n\t\t\t\t\tis-forwarded="{data.is(\'flags.forward\')}"\n\t\t\t\t\tis-replied="{data.is(\'flags.reply\')}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tshift="{ponyMode}"\n\t\t\t\t\tremit:toggle.prevent="togglestatus:unread"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Read status:End --\x3e\n\n\t\t\t\x3c!-- Avatar:Start --\x3e\n\t\t\t<div bem:elem="avatar" qa:id="avatar">\n\t\t\t\t<bem:mod name="unread" test="data.is(\'flags.unread\')"/>\n\n\t\t\t\t<b:avatar\n\t\t\t\t\tstate="{attrs.selected}"\n\t\t\t\t\timg-src="{_this.getImageSrc()}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tremit:toggle.prevent="clickavatar"\n\t\t\t\t\tindent="{avatarIndent}"\n\t\t\t\t\tsize="{ponyMode ? \'common\' : \'compact\'}"\n\t\t\t\t\tpriority="{attrs[\'priority\']}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Avatar:End --\x3e\n\t\t</div>\n\t\t\x3c!-- Header:End --\x3e\n\n\t\t\x3c!-- Content:Start --\x3e\n\t\t<div bem:elem="content">\n\t\t\t<bem:mod name="unread" test="data.is(\'flags.unread\')"/>\n\n\t\t\t\x3c!-- Row:Start --\x3e\n\t\t\t<div bem:elem="row">\n\n\t\t\t\t\x3c!-- Date:Start --\x3e\n\t\t\t\t<div bem:elem="date"\n\t\t\t\t\t title="{_this.getDateTooltip()}"\n\t\t\t\t>\n\t\t\t\t\t{data.get(\'date\') | letterDate}\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Date:End --\x3e\n\n\t\t\t\t\x3c!-- Correspondent:Start --\x3e\n\t\t\t\t<div bem:elem="correspondent">\n\t\t\t\t\t<b:correspondent\n\t\t\t\t\t\tqa:id="correspondent"\n\t\t\t\t\t\tstate="{_this.getCorrespondent()}"\n\t\t\t\t\t\ttitle="{_this.getCorrespondentTooltip()}"\n\t\t\t\t\t\tdangerous="{_this.isCorrespondentDangerous()}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Correspondent:End --\x3e\n\n\t\t\t</div>\n\t\t\t\x3c!-- Row:End --\x3e\n\n\t\t\t\x3c!-- Row:Start --\x3e\n\t\t\t<div bem:elem="row" bem:mod="middle" ref="main">\n\t\t\t\t<bem:mod name="search" test="attrs.search"/>\n\n\t\t\t\t<fn:apply-match name="badge" fn:if="!ponyMode"/>\n\n\t\t\t\t\x3c!-- Subject:Start --\x3e\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="subject"\n\t\t\t\t\tfn:if="!attrs[\'disable-subject\']"\n\t\t\t\t\tqa:id="subject"\n\t\t\t\t\ttitle="{_this.getSubjectTooltip()}"\n\t\t\t\t>\n\t\t\t\t\t<b:subject\n\t\t\t\t\t\tsubject="{subject}"\n\t\t\t\t\t\tcolor="{attrs.search ? data.meta(\'search_subject.color\') : null}"\n\t\t\t\t\t\tsearch="{attrs.search}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Subject:End --\x3e\n\n\t\t\t\t\x3c!-- ListLetterPaymentUniversalDie:Start --\x3e\n\t\t\t\t<b:payment-universal-die\n\t\t\t\t\tfn:if="showUniversalDie"\n\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\tlayout-type="{attrs[\'layout-type\']}"\n\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\thide-description="{isTaggable}"\n\t\t\t\t/>\n\t\t\t\t\x3c!-- ListLetterPaymentUniversalDie:End --\x3e\n\n\t\t\t\t\x3c!-- Snippet:Start --\x3e\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="snippet"\n\t\t\t\t\tfn:if="showSnippet"\n\t\t\t\t\tqa:id="snippet"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="search" test="attrs.search"/>\n\t\t\t\t\t<bem:mod name="overflow" test="showUnsubscribe" />\n\t\t\t\t\t<bem:mod name="hide-on-hover" test="isTaggable" />\n\n\t\t\t\t\t<b:snippet\n\t\t\t\t\t\tvalue="{_this.getSnippetValue()}"\n\t\t\t\t\t\tcolor="{attrs.search ? data.meta(\'search_snippet.color\') : null}"\n\t\t\t\t\t\tsearch="{attrs.search}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Snippet:End --\x3e\n\n\t\t\t\t\x3c!-- ListLetterUnsubscribe:Start --\x3e\n\t\t\t\t<b:unsubscribe\n\t\t\t\t\tfn:if="showUnsubscribe"\n\t\t\t\t\tlayout-mode="{isTaggable ? null : \'3pane\'}"\n\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\tunsubscribeSender="{unsubscribeSender}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tuse:mediator="unsubscribe-actions themes-manager"\n\t\t\t\t/>\n\t\t\t\t\x3c!-- ListLetterUnsubscribe:End --\x3e\n\n\t\t\t\t\x3c!-- Panel:Start --\x3e\n\t\t\t\t<div bem:elem="panel">\n\t\t\t\t\t<fn:var name="hasAttach" value="{data.is(\'flags.attach\')}"/>\n\t\t\t\t\t<fn:var name="isFlagged" value="{data.is(\'flags.flagged\')}"/>\n\t\t\t\t\t<fn:var name="isSchedule" value="{data.isSchedule()}"/>\n\n\t\t\t\t\t<bem:mod name="active" test="attrs.selected || attrs.active"/>\n\t\t\t\t\t<bem:mod name="is-flagged" test="isFlagged"/>\n\t\t\t\t\t<bem:mod name="non-empty" test="hasAttach || isFlagged || isSchedule || _this.hasBadge()"/>\n\t\t\t\t\t<bem:mod name="search" test="attrs.search"/>\n\n\t\t\t\t\t\x3c!-- Schedule:Start --\x3e\n\t\t\t\t\t<div\n\t\t\t\t\t\tfn:if="isSchedule"\n\t\t\t\t\t\tbem:elem="panel-item"\n\t\t\t\t\t\tbem:mod="schedule-status"\n\t\t\t\t\t>\n\t\t\t\t\t\t<b:schedule-status\n\t\t\t\t\t\t\tdate="{data.get(\'send_date\')}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!-- Schedule:End --\x3e\n\n\t\t\t\t\t\x3c!-- Attach:Start --\x3e\n\t\t\t\t\t<fn:if test="hasAttach && !attrs[\'disable-attach\']">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tbem:elem="panel-item"\n\t\t\t\t\t\t\tbem:mod="attach-status"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<b:attach-status/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\t\t\t\t\t\x3c!-- Attach:End --\x3e\n\n\t\t\t\t\t\x3c!-- Flag:Start --\x3e\n\t\t\t\t\t<div\n\t\t\t\t\t\tbem:elem="panel-item"\n\t\t\t\t\t\tbem:mod="flag"\n\t\t\t\t\t\tqa:id="flagged"\n\t\t\t\t\t>\n\t\t\t\t\t\t<b:flag-status\n\t\t\t\t\t\t\tstate="{isFlagged}"\n\t\t\t\t\t\t\tmodel="{data}"\n\t\t\t\t\t\t\tremit:toggle.prevent="togglestatus:flagged"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!-- Flag:End --\x3e\n\n\t\t\t\t\t<fn:apply-match name="badge" fn:if="ponyMode"/>\n\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Panel:End --\x3e\n\n\t\t\t</div>\n\t\t\t\x3c!-- Row:End --\x3e\n\n\t\t\t\x3c!-- Tags:Start --\x3e\n\t\t\t<div\n\t\t\t\tfn:if="isTaggable || hasTags"\n\t\t\t\tbem:elem="tags"\n\t\t\t>\n\t\t\t\t<b:react-async\n\t\t\t\t\tcomponent="ListLetterTags"\n\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\ttags="{attrs.model.get(\'flags.tags\')}"\n\t\t\t\t\trightSideDropdown\n\t\t\t\t\tfolder="{showFolderFeature && folder.get(\'name\')}"\n\t\t\t\t\tcompact="{ponyMode}"\n\t\t\t\t\treadonly="{!isTaggable}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Tags:End --\x3e\n\n\t\t\t\x3c!-- Folder:Start --\x3e\n\t\t\t<div bem:elem="folder" fn:if="showFolderFeature && !hasTags">\n\t\t\t\t<bem:mod name="hide-on-hover" test="isTaggable"/>\n\n\t\t\t<fn:choose>\n\t\t\t\t<fn:when test="data.isSchedule()">\n\t\t\t\t\t\x3c!-- Отложенная отправка (когда показываем имя папки) --\x3e\n\t\t\t\t\t<b:folder\n\t\t\t\t\t\ttitle="{data.get(\'send_date\') | scheduleDate}"\n\t\t\t\t\t\ttext="{folder.get(\'name\')}"\n\t\t\t\t\t\tqa:id="folder"\n\t\t\t\t\t/>\n\t\t\t\t</fn:when>\n\t\t\t\t<fn:otherwise>\n\t\t\t\t\t<b:folder\n\t\t\t\t\t\ttitle="{folder.get(\'name\')}"\n\t\t\t\t\t\ttext="{folder.get(\'name\')}"\n\t\t\t\t\t\tqa:id="folder"\n\t\t\t\t\t/>\n\t\t\t\t</fn:otherwise>\n\t\t\t</fn:choose>\n\n\t\t\t</div>\n\t\t\t\x3c!-- Folder:End --\x3e\n\n\t\t</div>\n\t\t\x3c!-- Content:End --\x3e\n\n\t</div>\n\t\x3c!-- Container:End --\x3e\n\n\t\x3c!-- PaymentDie:Start --\x3e\n\t<div bem:elem="payment-die-container" fn:if="paymentDieDisplayMode && paymentDieDisplayMode !== \'none\'">\n\t\t<bem:mod name="noindent" test="paymentDieWithIndent === false" />\n\t\t<bem:mod name="pony-mode" test="ponyMode" />\n\t\t<bem:mod name="compact" test="paymentDieDisplayMode === \'compact\'" />\n\t\t<bem:mod name="metathread" test="attrs[\'in-metathread\']" />\n\n\n\t\t<fn:if test="paymentDieDisplayMode === \'compact\'">\n\t\t\t<b:payment-button\n\t\t\t\tmodel="{attrs.model}"\n\t\t\t\tstandalone\n\t\t\t\tlayout-mode="3pane"\n\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t/>\n\t\t</fn:if>\n\n\t\t<fn:if test="paymentDieDisplayMode === \'full\'">\n\t\t\t<b:payment-die\n\t\t\t\tmodel="{attrs.model}"\n\t\t\t\tlayout-mode="3pane"\n\t\t\t\ticon-container-mode="{(paymentDieWithIndent === false) ? \'wide\' : \'narrow\'}"\n\t\t\t/>\n\t\t</fn:if>\n\t</div>\n\t\x3c!-- PaymentDie:End --\x3e\n\n\t\x3c!-- AttachesPreview:Start --\x3e\n\t<fn:var name="messagesAttaches" value="{attrs.messagesAttaches}"/>\n\t<fn:var name="showAttaches" value="{attrs[\'show-attaches\'] && _this.getAttachesPreviewCondition()}"/>\n\n\t<fn:var\n\t\tname="attachesModes"\n\t\tvalue="{_this.getAttachesModes(true, messagesAttaches)}"\n\t/>\n\n\t<fn:var\n\t\tname="attachesForRender"\n\t\tvalue="{_this.getAttaches(attachesModes, messagesAttaches)}"\n\t/>\n\n\t<fn:if test="showAttaches">\n\t\t<fn:choose>\n\t\t\t<fn:when test="messagesAttaches">\n\t\t\t\t<b:preview-attaches\n\t\t\t\t\tfn:if="messagesAttaches"\n\t\t\t\t\tremit:attach="previewattach"\n\t\t\t\t\tremit:more="previewattach"\n\t\t\t\t\tremit:moreinvalid="openletter"\n\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\tattaches-list="{attachesForRender.attachesList}"\n\t\t\t\t\tmore-attaches-list="{attachesForRender.moreAttachesList}"\n\t\t\t\t\tlayout-mode="3pane"\n\t\t\t\t\tall-count="{messagesAttaches.length}"\n\t\t\t\t\tvertical="{attachesModes.vertical}"\n\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\tmetathread="{attrs[\'in-metathread\']}"\n\t\t\t\t/>\n\t\t\t</fn:when>\n\t\t\t<fn:otherwise>\n\t\t\t\t\x3c!-- Заглушка, пока аттачи не загрузились --\x3e\n\t\t\t\t<b:stub\n\t\t\t\t\tattachesCount="{data.get(\'attachments_count\')}"\n\t\t\t\t\tisCompact="{true}"\n\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\tmetathread="{attrs[\'in-metathread\']}"\n\t\t\t\t/>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</fn:if>\n\t\x3c!-- AttachesPreview:End --\x3e\n\n\t\x3c!-- Border:Start --\x3e\n\t<b:delimeter compact full="{attrs[\'full-delimiter\']}" ponymode="{ponyMode}" indent="{attrs.indent}"/>\n\t<b:delimeter last compact ponymode="{ponyMode}" indent="{attrs.indent}"/>\n\t\x3c!-- Border:End --\x3e\n</a>\n',"app/feast-tpl!ui-block/list-letter-compact/list-letter-compact.html")});define("feast-tpl!ui-block/list-letter-compact/list-letter-compact.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-compact/list-letter-compact.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-compact/list-letter-compact",["require","exports","default-values","feast","feast-mod/letter-date","feast-tpl!./list-letter-compact.html","helpers/radar-utils","service/emoji","service/radars/decorator","service/search-attaches/attachesList","service/search-attaches/viewModes","ui-block/delimeter/delimeter","ui-block/list-letter-attach-status/list-letter-attach-status","ui-block/list-letter-avatar/list-letter-avatar","ui-block/list-letter-badge/list-letter-badge","ui-block/list-letter-common/list-letter-abstract","ui-block/list-letter-common/list-letter-abstract-payment-die","ui-block/list-letter-correspondent/list-letter-correspondent","ui-block/list-letter-flag-status/list-letter-flag-status","ui-block/list-letter-folder/list-letter-folder","ui-block/list-letter-payment-button/list-letter-payment-button","ui-block/list-letter-payment-die/list-letter-payment-die","ui-block/list-letter-payment-universal-die/list-letter-payment-universal-die","ui-block/list-letter-preview-attaches/list-letter-preview-attaches","ui-block/list-letter-preview-stub/list-letter-preview-stub","ui-block/list-letter-read-status/list-letter-read-status","ui-block/list-letter-schedule-status/list-letter-schedule-status","ui-block/list-letter-snippet/list-letter-snippet","ui-block/list-letter-subject/list-letter-subject","ui-block/list-letter-unsubscribe/list-letter-unsubscribe"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);d=__importDefault(d);g=__importDefault(g);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);exports.default=b.default.Block.extend((0,n.withWelterLetter)((0,g.default)({id:"letter-item",events:[{name:"clickavatar",rename:function(a){return a.is("selected")?"deselect":"select"}},{name:"togglestatus:unread",rename:function(a){return(0,e.renameRadarOnStatusToggle)(a,"unread")}},{name:"togglestatus:flagged",rename:function(a){return(0,e.renameRadarOnStatusToggle)(a,"flagged")}}]})({name:"list-letter-compact",rootClassName:"llct",template:d.default,immutable:true,isolate:true,performanceTrace:true,blocks:{delimeter:j.default,"read-status":x.default,avatar:l.default,badge:m.default,correspondent:p.default,"flag-status":q.default,subject:A.default,snippet:z.default,"attach-status":k.default,"schedule-status":y.default,folder:r.default,"payment-die":t.default,"payment-button":s.default,"preview-attaches":v.default,stub:w.default,unsubscribe:B.default,"payment-universal-die":u.default},defaults:{"disable-letter-item-folder":a.DISABLE_LETTER_ITEM_FOLDER,selected:false,"disable-subject":false,search:false,messagesAttaches:null,fetchAttaches:false,"layout-mode":"3pane","enable-tags":a.ENABLE_TAGS},notVisualAttributes:{"list-index":true},mods:{letterDate:c.letterDate,scheduleDate:c.scheduleDate},constructor:function(){b.default.Block.apply(this,arguments);this.meta=this.get("model").getPaymentMeta()},didMount:function(){this.handleIntersectViewport();(0,f.emojiFallback)(this.refs.main,"ll-cmp")},didUpdate:function(){(0,f.emojiFallback)(this.refs.main,"ll-cmp")},getAttachesPreviewCondition:function(){var a=this.get("fetchAttaches")&&!this.get("messagesAttaches");return!a&&o.getPaymentDieDisplayMode.call(this)==="none"},getSubject:n.getSubject,getImageSrc:n.getImageSrc,isProbablyPhishing:n.isProbablyPhishing,isCorrespondentDangerous:n.isCorrespondentDangerous,getCorrespondent:n.getCorrespondent,getCorrespondentTooltip:n.getCorrespondentTooltip,getDateTooltip:n.getDateTooltip,getSubjectTooltip:n.getSubjectTooltip,getSnippetValue:n.getSnippetValue,getCounter:n.getCounter,getCategory:n.getCategory,getAttaches:h.getAttaches,getAttachesModes:i.getAttachesModes,isImportant:n.isImportant,hasBadge:n.hasBadge,getPaymentDieDisplayMode:o.getPaymentDieDisplayMode,shouldShowUniversalPaymentDie:o.shouldShowUniversalPaymentDie,shouldHideTransactionCategory:o.shouldHideTransactionCategory,getUnsubscribeSender:n.getUnsubscribeSender,handleIntersectViewport:n.handleIntersectViewport,getAvatarIndent:function(){if(this.is("pony-mode")){if(this.is("indent")){return"left"}return"right"}return false},rootQaId:n.rootQaId})))});define("feast-tpl!app/feast-tpl!ui-block/list-letter-compact-touch/list-letter-compact-touch.html",["feast"],function(a){return a.smartParse('<a\n\tqa:id="{_this.rootQaId()}"\n\tremit:dragstart.prevent\n>\n\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="data" value="{attrs.model}"/>\n\t<fn:var name="subject" value="{_this.getSubject()}"/>\n\t<fn:var name="showFolderFeature" value="{attrs.showfolder && !attrs[\'disable-letter-item-folder\']}"/>\n\n\t\x3c!-- Attributes --\x3e\n\t<fn:attr name="href" value="{attrs.href}"/>\n\t<fn:attr name="tabindex" value="-1"/>\n\t<fn:attr name="data-id" value="{data.get(\'id\')}"/>\n\t<fn:attr name="data-draggable-id" value="{data.get(\'id\')}"/>\n\t<fn:attr name="active" test="attrs.selected"/>\n\n\t\x3c!-- Класс для переходов стрелками и общих стилей для всех элементов списка писем --\x3e\n\t<fn:add-class name="js-letter-list-item"/>\n\n\t\x3c!-- Modificators --\x3e\n\t<bem:mod\n\t\tname="enable-user-select"\n\t\ttest="attrs[\'enable-user-select\']"\n\t/>\n\t<bem:mod\n\t\tname="swipe-actions-visible"\n\t\ttest="attrs[\'swipe-actions-visible\']"\n\t/>\n\t<bem:mod\n\t\tname="swipe-actions-animated"\n\t\ttest="attrs[\'swipe-actions-animated\']"\n\t/>\n\t<bem:mod\n\t\tname="active"\n\t\ttest="attrs.active"\n\t/>\n\n\t<bem:mod\n\t\tname="pony-mode"\n\t\ttest="ponyMode"\n\t/>\n\n\t<bem:mod name="first" test="attrs.first"/>\n\t<bem:mod name="last" test="attrs.last"/>\n\n\t<div bem:elem="background">\n\t\t<bem:mod name="active" test="attrs.active"/>\n\t</div>\n\n\t<fn:match name="header">\n\t\t\x3c!-- Header:Start --\x3e\n\t\t<div bem:elem="header">\n\n\t\t\t\x3c!-- Avatar:Start --\x3e\n\t\t\t<div bem:elem="avatar" qa:id="avatar">\n\t\t\t\t<b:avatar\n\t\t\t\t\tstate="{attrs.selected}"\n\t\t\t\t\timg-src="{_this.getImageSrc()}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tdisable-hover\n\t\t\t\t\ttouch\n\t\t\t\t\tremit:toggle.prevent="clickavatar"\n\t\t\t\t\tsize="compact"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Avatar:End --\x3e\n\n\t\t\t\x3c!-- Read status:Start --\x3e\n\t\t\t<div bem:elem="read-status" qa:id="unread">\n\t\t\t\t<b:read-status\n\t\t\t\t\tstate="{data.is(\'flags.unread\')}"\n\t\t\t\t\tis-forwarded="{data.is(\'flags.forward\')}"\n\t\t\t\t\tis-replied="{data.is(\'flags.reply\')}"\n\t\t\t\t\tmodel="{data}"\n\t\t\t\t\tdisable-hover\n\t\t\t\t\tremit:toggle.prevent="togglestatus:unread"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Read status:End --\x3e\n\n\t\t</div>\n\t\t\x3c!-- Header:End --\x3e\n\t</fn:match>\n\n\t<fn:match name="content">\n\t\t\x3c!-- Content:Start --\x3e\n\t\t<div bem:elem="content" ref="content">\n\t\t\t<bem:mod name="unread" test="data.is(\'flags.unread\')"/>\n\t\t\t\x3c!-- Correspondent:Start --\x3e\n\t\t\t<div bem:elem="correspondent">\n\t\t\t\t<b:correspondent\n\t\t\t\t\tqa:id="correspondent"\n\t\t\t\t\tstate="{_this.getCorrespondent()}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Correspondent:End --\x3e\n\n\t\t\t\x3c!-- Subject:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="subject"\n\t\t\t\tfn:if="!attrs[\'disable-subject\']"\n\t\t\t\tqa:id="subject"\n\t\t\t>\n\t\t\t\t<b:subject\n\t\t\t\t\tsubject="{subject}"\n\t\t\t\t\tcolor="{attrs.search ? data.meta(\'search_subject.color\') : null}"\n\t\t\t\t\tsearch="{attrs.search}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Subject:End --\x3e\n\n\t\t\t\x3c!-- Snippet:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="snippet"\n\t\t\t\tqa:id="snippet"\n\t\t\t>\n\t\t\t\t<bem:mod name="search" test="attrs.search"/>\n\n\t\t\t\t<b:snippet\n\t\t\t\t\tvalue="{_this.getSnippetValue()}"\n\t\t\t\t\tcolor="{attrs.search ? data.meta(\'search_snippet.color\') : null}"\n\t\t\t\t\tsearch="{attrs.search}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Snippet:End --\x3e\n\n\t\t\t\x3c!-- Folder:Start --\x3e\n\t\t\t<div bem:elem="folder" fn:if="showFolderFeature">\n\t\t\t\t<fn:var name="folder" value="{data.getFolder()}"/>\n\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="data.isSchedule()">\n\t\t\t\t\t\t\x3c!-- Отложенная отправка (когда показываем имя папки) --\x3e\n\t\t\t\t\t\t<b:folder\n\t\t\t\t\t\t\ttext="{folder.get(\'name\')}"\n\t\t\t\t\t\t\tqa:id="folder"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<b:folder\n\t\t\t\t\t\t\ttext="{folder.get(\'name\')}"\n\t\t\t\t\t\t\tqa:id="folder"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!-- Content:End --\x3e\n\n\t\t\x3c!-- Meta:Start --\x3e\n\t\t<div bem:elem="meta">\n\n\t\t\t\x3c!-- Date:Start --\x3e\n\t\t\t<div bem:elem="date">\n\t\t\t\t{data.get(\'date\') | letterDate}\n\t\t\t</div>\n\t\t\t\x3c!-- Date:End --\x3e\n\n\t\t\t\x3c!-- Badge:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="badge"\n\t\t\t\tqa:id="letter:badge"\n\t\t\t\tfn:if="_this.hasBadge()"\n\t\t\t>\n\t\t\t\t<b:badge\n\t\t\t\t\tcategory="{_this.getCategory()}"\n\t\t\t\t\tcounter="{_this.getCounter()}"\n\t\t\t\t\timportant="{_this.isImportant()}"\n\t\t\t\t\tcompact\n\t\t\t\t\tunread="{data.is(\'flags.unread\')}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t\x3c!-- Badge:End --\x3e\n\n\t\t\t\x3c!-- Panel:Start --\x3e\n\t\t\t<div bem:elem="panel">\n\t\t\t\t\x3c!-- Все 3 иконки одновременно не помещаются в колонку, нужно придумать решение --\x3e\n\n\t\t\t\t\x3c!-- Schedule:End --\x3e\n\t\t\t\t<div\n\t\t\t\t\tfn:if="data.isSchedule()"\n\t\t\t\t\tbem:elem="schedule-status"\n\t\t\t\t>\n\t\t\t\t\t<b:schedule-status\n\t\t\t\t\t\tdate="{data.get(\'send_date\')}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Schedule:End --\x3e\n\n\t\t\t\t\x3c!-- Attach:Start --\x3e\n\t\t\t\t<fn:if test="data.is(\'flags.attach\') && !attrs[\'disable-attach\']">\n\t\t\t\t\t<div bem:elem="attach-status">\n\t\t\t\t\t\t<b:attach-status/>\n\t\t\t\t\t</div>\n\t\t\t\t</fn:if>\n\t\t\t\t\x3c!-- Attach:End --\x3e\n\n\t\t\t\t\x3c!-- Flag:Start --\x3e\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="flag"\n\t\t\t\t\tfn:if="data.is(\'flags.flagged\')"\n\t\t\t\t\tqa:id="flagged"\n\t\t\t\t>\n\t\t\t\t\t<b:flag-status\n\t\t\t\t\t\tstate="{true}"\n\t\t\t\t\t\tmodel="{data}"\n\t\t\t\t\t\tdisable-hover\n\t\t\t\t\t\tremit:toggle.prevent="togglestatus:flagged"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Flag:End --\x3e\n\n\t\t\t</div>\n\t\t\t\x3c!-- Panel:End --\x3e\n\n\t\t</div>\n\t\t\x3c!-- Meta:End --\x3e\n\t</fn:match>\n\n\t<b:swipeable\n\t\tuse:mediator="swipe-manager"\n\t\tremit:underlay-changed="underlay:changed"\n\t\tremit:animation-changed="animation:changed"\n\t\tremit:pan-changed="pan:changed"\n\t\tmax-offset="170"\n\t\tid="swipeable"\n\t>\n\t\t<fn:match name="swipe-underlay">\n\t\t\t\x3c!-- Подложка контейнера --\x3e\n\t\t\t<b:letter-swipe-actions\n\t\t\t\tmodel="{data}"\n\t\t\t\tcompact\n\t\t\t\tremit:action-unread="togglestatus:unread"\n\t\t\t\tremit:action-flagged="togglestatus:flagged"\n\t\t\t\tremit:action-move="move"\n\t\t\t\tremit:action-remove="remove"\n\t\t\t\tremit:action-spam="spam"\n\t\t\t\tremit:action-unspam="unspam"\n\t\t\t\tuse:mediator="layout-manager"\n\t\t\t/>\n\t\t</fn:match>\n\n\t\t<fn:match name="swipe-header">\n\t\t\t<fn:apply-match name="header"/>\n\t\t</fn:match>\n\t\t<fn:match name="swipe-content">\n\t\t\t<fn:apply-match name="content"/>\n\t\t</fn:match>\n\t</b:swipeable>\n\n\t\x3c!-- Border:Start --\x3e\n\t<b:delimeter full="{attrs[\'full-delimiter\']}" ponymode="{ponyMode}" indent="{attrs.indent}"/>\n\t<b:delimeter ponymode="{ponyMode}" indent="{attrs.indent}" last/>\n\t\x3c!-- Border:End --\x3e\n</a>\n',"app/feast-tpl!ui-block/list-letter-compact-touch/list-letter-compact-touch.html")});define("feast-tpl!ui-block/list-letter-compact-touch/list-letter-compact-touch.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-compact-touch/list-letter-compact-touch.html"],function(a){return a});define("ui-block/list-letter-compact-touch/list-letter-compact-touch",["exports","default-values","feast","feast-mod/letter-date","feast-tpl!./list-letter-compact-touch.html","service/emoji","service/radars/decorator","ui-block/letter-swipe-actions/letter-swipe-actions","ui-block/list-letter-attach-status/list-letter-attach-status","ui-block/list-letter-avatar/list-letter-avatar","ui-block/list-letter-badge/list-letter-badge","ui-block/list-letter-common/list-letter-abstract","ui-block/list-letter-correspondent/list-letter-correspondent","ui-block/list-letter-flag-status/list-letter-flag-status","ui-block/list-letter-folder/list-letter-folder","ui-block/list-letter-read-status/list-letter-read-status","ui-block/list-letter-schedule-status/list-letter-schedule-status","ui-block/list-letter-snippet/list-letter-snippet","ui-block/list-letter-subject/list-letter-subject","ui-block/swipeable/swipeable"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var t=I(b);var u=I(d);var v=I(f);var w=I(g);var x=I(h);var y=I(i);var z=I(j);var A=I(l);var B=I(m);var C=I(n);var D=I(o);var E=I(p);var F=I(q);var G=I(r);var H=I(s);function I(a){return a&&a.__esModule?a:{default:a}}exports.default=t.default.Block.extend((0,k.withWelterLetter)((0,v.default)({events:["clickavatar","togglestatus:unread","togglestatus:flagged","remove","spam","unspam"]})({name:"list-letter-compact-touch",rootClassName:"llct-t",template:u.default,immutable:true,isolate:true,performanceTrace:true,blocks:{"read-status":D.default,avatar:y.default,badge:z.default,correspondent:A.default,"flag-status":B.default,subject:G.default,snippet:F.default,"attach-status":x.default,"schedule-status":E.default,folder:C.default,"letter-swipe-actions":w.default,swipeable:H.default},defaults:{"disable-letter-item-folder":a.DISABLE_LETTER_ITEM_FOLDER,selected:false,"disable-subject":false,search:false,"swipe-actions-visible":false,"layout-mode":"3pane"},events:{"pan:changed":"onPanChanged","underlay:changed":"onUnderlayChanged","animation:changed":"onAnimationChanged"},mods:{letterDate:c.letterDate,scheduleDate:c.scheduleDate},didMount:function a(){(0,e.emojiFallback)(this.refs.content,"ll-cmp-t")},didUpdate:function a(){(0,e.emojiFallback)(this.refs.content,"ll-cmp-t")},getSubject:k.getSubject,getImageSrc:k.getImageSrc,isProbablyPhishing:k.isProbablyPhishing,isCorrespondentDangerous:k.isCorrespondentDangerous,getCorrespondent:k.getCorrespondent,getCorrespondentTooltip:k.getCorrespondentTooltip,getCounter:k.getCounter,getCategory:k.getCategory,isImportant:k.isImportant,hasBadge:k.hasBadge,getSnippetValue:k.getSnippetValue,rootQaId:k.rootQaId,shouldHideTransactionCategory:function a(){return false},onPanChanged:function a(b){this.set("swipe-actions-touched",b.details.value)},onAnimationChanged:function a(b){this.set("swipe-actions-animated",b.details.value)},onUnderlayChanged:function a(b){this.set("swipe-actions-visible",b.details.value)}})))});define("feast-tpl!app/feast-tpl!ui-block/list-letter-height-compensation/list-letter-height-compensation.html",["feast"],function(a){return a.smartParse('<div style="height: {attrs.height}px;"></div>\n',"app/feast-tpl!ui-block/list-letter-height-compensation/list-letter-height-compensation.html")});define("feast-tpl!ui-block/list-letter-height-compensation/list-letter-height-compensation.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-height-compensation/list-letter-height-compensation.html"],function(a){return a});define("ui-block/list-letter-height-compensation/list-letter-height-compensation",["exports","feast","feast-tpl!./list-letter-height-compensation.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default=c.default.Block.extend({name:"list-letter-height-compensation",template:d.default,immutable:true,defaults:{height:0}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-preview-action/list-letter-preview-action.html",["feast"],function(a){return a.smartParse('<div qa:id="list-letter-preview-action">\n\t<fn:var name="compact" value="{attrs.compact}"/>\n\t<fn:var name="folder" value="{attrs.folder}"/>\n\n\t<fn:var\n\t\tname="i18nContext"\n\t\tvalue="По запросу «заказч» ничего не найдено, мы показали похожие результаты по «заказчик»"\n\t/>\n\n\t<bem:mod name="compact" test="compact"/>\n\n\t<fn:var name="queries" value="{attrs.queries}"/>\n\t<fn:var name="hasQuery" value="{queries && queries.baseQuery && queries.suggestQuery}"/>\n\n\t<fn:choose>\n\t\t<fn:when test="attrs.model.get(\'type\') === \'suggestSeparator\'">\n\t\t\t<div\n\t\t\t\t\tfn:if="hasQuery"\n\t\t\t\t\tbem:elem="item"\n\t\t\t>\n\t\t\t\t<bem:mod name="compact"/>\n\n\t\t\t\t{i18n(\'Поиск по похожим запросам\')}\n\t\t\t\t<b>\n\t\t\t\t\t{_this.getFormattedSuggestQueries(queries.suggestQuery)}\n\t\t\t\t</b>\n\t\t\t</div>\n\t\t</fn:when>\n\t\t<fn:otherwise>\n\t\t\t\x3c!-- Показываем текст саджестов в первом хедере, --\x3e\n\t\t\t\x3c!-- только если вообще нет писем в основной выдаче --\x3e\n\t\t\t<fn:if test="attrs.model.get(\'type\') === \'suggestHeader\' && hasQuery">\n\n\t\t\t\t\x3c!-- Формируем текст строки в разных i18n --\x3e\n\t\t\t\t\x3c!-- с передачей контекста вторым аргументом (пример для переводчиков) --\x3e\n\t\t\t\t\x3c!-- чтобы не использовать <fn:value output="raw"> и unsafe --\x3e\n\t\t\t\t<div>\n\t\t\t\t\t{i18n(\'По запросу\', i18nContext)}\n\n\t\t\t\t\t<b bem:elem="query">\n\t\t\t\t\t\t{queries.baseQuery}\n\t\t\t\t\t</b>\n\n\t\t\t\t\t{i18n(\'ничего не найдено, мы показали похожие результаты по\', i18nContext)}\n\n\t\t\t\t\t<b>\n\t\t\t\t\t\t{_this.getFormattedSuggestQueries(queries.suggestQuery)}\n\t\t\t\t\t</b>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\n\t\t\t<a\n\t\t\t\t\tfn:if="_this.shouldSuggestSearchInExcludedFolders()"\n\t\t\t\t\tbem:elem="message"\n\t\t\t\t\tremit:click.prevent="search:set-in-excluded-folders"\n\t\t\t\t\tevent:details="true"\n\t\t\t\t\tqa:id="search-action-enable-in-excluded-folders"\n\t\t\t\t\thref="{attrs.href}"\n\t\t\t>\n\t\t\t\t{i18n(\'Искать в папках «Спам» и «Корзина»\')}\n\t\t\t</a>\n\t\t</fn:otherwise>\n\t</fn:choose>\n\n\t<b:delimeter last full/>\n</div>\n',"app/feast-tpl!ui-block/list-letter-preview-action/list-letter-preview-action.html")});define("feast-tpl!ui-block/list-letter-preview-action/list-letter-preview-action.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-preview-action/list-letter-preview-action.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-preview-action/list-letter-preview-action",["require","exports","default-values","feast","feast-tpl!./list-letter-preview-action.html","helpers/suggest-search","service/radars/decorator","service/radars/index","ui-block/delimeter/delimeter"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.default=b.default.Block.extend((0,e.default)({events:[{name:"search:set-in-excluded-folders",rename:"search:excluded"}]})({name:"list-letter-preview-action",template:c.default,defaults:{"pony-mode":false},blocks:{delimeter:g.default},getFormattedSuggestQueries:d.getFormattedSuggestQueries,didMount:function(){var a=this.get("model");var b=a.get("type");if(b==="suggestHeader"||b==="suggestSeparator"){(0,f.default)("suggest_search_query_show")}},shouldSuggestSearchInExcludedFolders:function(){return!a.FORBID_EXCLUDED_FOLDERS_SEARCH}}))});define("feast-tpl!app/feast-tpl!ui-block/list-letter-skeleton/list-letter-skeleton.html",["feast"],function(a){return a.smartParse('<div>\n\t\x3c!-- Прикидываемся письмом на списке, чтобы заполучить сладенькие стили --\x3e\n\t<fn:add-class name="llct"/>\n\n\t<fn:var name="isCompactPonyMode" value="{attrs.compact && attrs[\'pony-mode\']}"/>\n\n\t<bem:mod name="compact" test="attrs.compact && !isCompactPonyMode"/>\n\t<bem:mod name="pony-mode" test="attrs[\'pony-mode\'] && !isCompactPonyMode"/>\n\t<bem:mod name="compact-pony-mode" test="isCompactPonyMode"/>\n\n\t<div bem:elem="row-avatar">\n\t\t<span bem:elem="avatar"/>\n\t</div>\n\n\t<div bem:elem="row-from">\n\t\t<fn:choose>\n\t\t\t\x3c!-- 2pane --\x3e\n\t\t\t<fn:when test="!attrs.compact">\n\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t<bem:mod name="width-s-{_this.getRandomSize(1)}"/>\n\t\t\t\t</span>\n\t\t\t</fn:when>\n\n\t\t\t\x3c!-- 3pane --\x3e\n\t\t\t<fn:otherwise>\n\t\t\t\t<span bem:elem="multiline">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<bem:mod name="width-s-{_this.getRandomSize(3)}"/>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<bem:mod name="width-s-{_this.getRandomSize(4)}"/>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<bem:mod name="width-s-{_this.getRandomSize(5)}"/>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</div>\n\n\t<div bem:elem="row-subject" fn:if="!attrs.compact">\n\t\t<span bem:elem="line">\n\t\t\t<bem:mod name="width-l-{_this.getRandomSize(2)}"/>\n\t\t</span>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/list-letter-skeleton/list-letter-skeleton.html")});define("feast-tpl!ui-block/list-letter-skeleton/list-letter-skeleton.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-skeleton/list-letter-skeleton.html"],function(a){return a});define("ui-block/list-letter-skeleton/list-letter-skeleton",["exports","feast","feast-tpl!./list-letter-skeleton.html","helpers/seedable-random"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}function h(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++){c[b]=a[b]}return c}else{return Array.from(a)}}var i=f.default.randomSeed();exports.default=d.default.Block.extend({name:"list-letter-skeleton",template:e.default,immutable:true,defaults:{index:0,compact:false,"pony-mode":false},getRandomSize:function a(b){var c=this.get("index");var d=[].concat(h(i));d[0]%=b*c;d[1]%=b*c;d[2]%=b*c;d[3]%=b*c;var e=new f.default(d);var g=Math.floor(e.random()*9007199);return g%3+1}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-spinner/list-letter-spinner.html",["feast"],function(a){return a.smartParse('<a qa:id="letter-spinner" qa:state="visible:{!attrs.hidden}">\n\t\x3c!-- Прикидываемся письмом на списке, чтобы заполучить вожделенные стили --\x3e\n\t<fn:add-class name="llct"/>\n\n\t\x3c!-- Стили запишем тут, чтобы перебить стили из  --\x3e\n\t<bem:mod name="default"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\t<bem:mod name="ponyMode" test="attrs[\'pony-mode\']"/>\n\t<bem:mod name="compactAndPonyMode" test="attrs.compact && attrs[\'pony-mode\']"/>\n\t<bem:mod name="hidden" test="attrs.hidden"/>\n\n\t<b:spinner small color="additional"/>\n</a>\n',"app/feast-tpl!ui-block/list-letter-spinner/list-letter-spinner.html")});define("feast-tpl!ui-block/list-letter-spinner/list-letter-spinner.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-spinner/list-letter-spinner.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/spinner/spinner.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="inline" test="attrs.inline"/>\n\t<bem:mod name="small" test="attrs.small"/>\n\n\t<div bem:elem="icon">\n\t\t<fn:if test="attrs.size">\n\t\t\t<bem:mod name="size-{attrs.size}" test="attrs.size"/>\n\t\t</fn:if>\n\t\t<fn:if test="attrs.color">\n\t\t\t<bem:mod name="color-{attrs.color}" test="attrs.color"/>\n\t\t</fn:if>\n\n\t\t<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64">\n\t\t\t<defs>\n\t\t\t\t<path id="spinner-path" d="M0 0h32v32H0z"></path>\n\t\t\t\t<mask id="spinner-mask">\n\t\t\t\t\t<path fill="#fff" d="M0 0h64v64H0z"></path>\n\t\t\t\t\t<use fill="#020202" xlink:href="#spinner-path" transform="rotate(-146 32 32)"></use>\n\t\t\t\t\t<use fill="#040404" xlink:href="#spinner-path" transform="rotate(-144 32 32)"></use>\n\t\t\t\t\t<use fill="#060606" xlink:href="#spinner-path" transform="rotate(-142 32 32)"></use>\n\t\t\t\t\t<use fill="#080808" xlink:href="#spinner-path" transform="rotate(-140 32 32)"></use>\n\t\t\t\t\t<use fill="#0A0A0A" xlink:href="#spinner-path" transform="rotate(-138 32 32)"></use>\n\t\t\t\t\t<use fill="#0C0C0C" xlink:href="#spinner-path" transform="rotate(-136 32 32)"></use>\n\t\t\t\t\t<use fill="#0E0E0E" xlink:href="#spinner-path" transform="rotate(-134 32 32)"></use>\n\t\t\t\t\t<use fill="#101010" xlink:href="#spinner-path" transform="rotate(-132 32 32)"></use>\n\t\t\t\t\t<use fill="#131313" xlink:href="#spinner-path" transform="rotate(-130 32 32)"></use>\n\t\t\t\t\t<use fill="#151515" xlink:href="#spinner-path" transform="rotate(-128 32 32)"></use>\n\t\t\t\t\t<use fill="#171717" xlink:href="#spinner-path" transform="rotate(-126 32 32)"></use>\n\t\t\t\t\t<use fill="#191919" xlink:href="#spinner-path" transform="rotate(-124 32 32)"></use>\n\t\t\t\t\t<use fill="#1B1B1B" xlink:href="#spinner-path" transform="rotate(-122 32 32)"></use>\n\t\t\t\t\t<use fill="#1D1D1D" xlink:href="#spinner-path" transform="rotate(-120 32 32)"></use>\n\t\t\t\t\t<use fill="#1F1F1F" xlink:href="#spinner-path" transform="rotate(-118 32 32)"></use>\n\t\t\t\t\t<use fill="#212121" xlink:href="#spinner-path" transform="rotate(-116 32 32)"></use>\n\t\t\t\t\t<use fill="#242424" xlink:href="#spinner-path" transform="rotate(-114 32 32)"></use>\n\t\t\t\t\t<use fill="#262626" xlink:href="#spinner-path" transform="rotate(-112 32 32)"></use>\n\t\t\t\t\t<use fill="#282828" xlink:href="#spinner-path" transform="rotate(-110 32 32)"></use>\n\t\t\t\t\t<use fill="#2A2A2A" xlink:href="#spinner-path" transform="rotate(-108 32 32)"></use>\n\t\t\t\t\t<use fill="#2C2C2C" xlink:href="#spinner-path" transform="rotate(-106 32 32)"></use>\n\t\t\t\t\t<use fill="#2E2E2E" xlink:href="#spinner-path" transform="rotate(-104 32 32)"></use>\n\t\t\t\t\t<use fill="#303030" xlink:href="#spinner-path" transform="rotate(-102 32 32)"></use>\n\t\t\t\t\t<use fill="#323232" xlink:href="#spinner-path" transform="rotate(-100 32 32)"></use>\n\t\t\t\t\t<use fill="#353535" xlink:href="#spinner-path" transform="rotate(-98 32 32)"></use>\n\t\t\t\t\t<use fill="#373737" xlink:href="#spinner-path" transform="rotate(-96 32 32)"></use>\n\t\t\t\t\t<use fill="#393939" xlink:href="#spinner-path" transform="rotate(-94 32 32)"></use>\n\t\t\t\t\t<use fill="#3B3B3B" xlink:href="#spinner-path" transform="rotate(-92 32 32)"></use>\n\t\t\t\t\t<use fill="#3D3D3D" xlink:href="#spinner-path" transform="rotate(-90 32 32)"></use>\n\t\t\t\t\t<use fill="#3F3F3F" xlink:href="#spinner-path" transform="rotate(-88 32 32)"></use>\n\t\t\t\t\t<use fill="#414141" xlink:href="#spinner-path" transform="rotate(-86 32 32)"></use>\n\t\t\t\t\t<use fill="#434343" xlink:href="#spinner-path" transform="rotate(-84 32 32)"></use>\n\t\t\t\t\t<use fill="#464646" xlink:href="#spinner-path" transform="rotate(-82 32 32)"></use>\n\t\t\t\t\t<use fill="#484848" xlink:href="#spinner-path" transform="rotate(-80 32 32)"></use>\n\t\t\t\t\t<use fill="#4A4A4A" xlink:href="#spinner-path" transform="rotate(-78 32 32)"></use>\n\t\t\t\t\t<use fill="#4C4C4C" xlink:href="#spinner-path" transform="rotate(-76 32 32)"></use>\n\t\t\t\t\t<use fill="#4E4E4E" xlink:href="#spinner-path" transform="rotate(-74 32 32)"></use>\n\t\t\t\t\t<use fill="#505050" xlink:href="#spinner-path" transform="rotate(-72 32 32)"></use>\n\t\t\t\t\t<use fill="#525252" xlink:href="#spinner-path" transform="rotate(-70 32 32)"></use>\n\t\t\t\t\t<use fill="#545454" xlink:href="#spinner-path" transform="rotate(-68 32 32)"></use>\n\t\t\t\t\t<use fill="#575757" xlink:href="#spinner-path" transform="rotate(-66 32 32)"></use>\n\t\t\t\t\t<use fill="#595959" xlink:href="#spinner-path" transform="rotate(-64 32 32)"></use>\n\t\t\t\t\t<use fill="#5B5B5B" xlink:href="#spinner-path" transform="rotate(-62 32 32)"></use>\n\t\t\t\t\t<use fill="#5D5D5D" xlink:href="#spinner-path" transform="rotate(-60 32 32)"></use>\n\t\t\t\t\t<use fill="#5F5F5F" xlink:href="#spinner-path" transform="rotate(-58 32 32)"></use>\n\t\t\t\t\t<use fill="#616161" xlink:href="#spinner-path" transform="rotate(-56 32 32)"></use>\n\t\t\t\t\t<use fill="#636363" xlink:href="#spinner-path" transform="rotate(-54 32 32)"></use>\n\t\t\t\t\t<use fill="#656565" xlink:href="#spinner-path" transform="rotate(-52 32 32)"></use>\n\t\t\t\t\t<use fill="#686868" xlink:href="#spinner-path" transform="rotate(-50 32 32)"></use>\n\t\t\t\t\t<use fill="#6A6A6A" xlink:href="#spinner-path" transform="rotate(-48 32 32)"></use>\n\t\t\t\t\t<use fill="#6C6C6C" xlink:href="#spinner-path" transform="rotate(-46 32 32)"></use>\n\t\t\t\t\t<use fill="#6E6E6E" xlink:href="#spinner-path" transform="rotate(-44 32 32)"></use>\n\t\t\t\t\t<use fill="#707070" xlink:href="#spinner-path" transform="rotate(-42 32 32)"></use>\n\t\t\t\t\t<use fill="#727272" xlink:href="#spinner-path" transform="rotate(-40 32 32)"></use>\n\t\t\t\t\t<use fill="#747474" xlink:href="#spinner-path" transform="rotate(-38 32 32)"></use>\n\t\t\t\t\t<use fill="#767676" xlink:href="#spinner-path" transform="rotate(-36 32 32)"></use>\n\t\t\t\t\t<use fill="#797979" xlink:href="#spinner-path" transform="rotate(-34 32 32)"></use>\n\t\t\t\t\t<use fill="#7B7B7B" xlink:href="#spinner-path" transform="rotate(-32 32 32)"></use>\n\t\t\t\t\t<use fill="#7D7D7D" xlink:href="#spinner-path" transform="rotate(-30 32 32)"></use>\n\t\t\t\t\t<use fill="#7F7F7F" xlink:href="#spinner-path" transform="rotate(-28 32 32)"></use>\n\t\t\t\t\t<use fill="#818181" xlink:href="#spinner-path" transform="rotate(-26 32 32)"></use>\n\t\t\t\t\t<use fill="#838383" xlink:href="#spinner-path" transform="rotate(-24 32 32)"></use>\n\t\t\t\t\t<use fill="#858585" xlink:href="#spinner-path" transform="rotate(-22 32 32)"></use>\n\t\t\t\t\t<use fill="#878787" xlink:href="#spinner-path" transform="rotate(-20 32 32)"></use>\n\t\t\t\t\t<use fill="#8A8A8A" xlink:href="#spinner-path" transform="rotate(-18 32 32)"></use>\n\t\t\t\t\t<use fill="#8C8C8C" xlink:href="#spinner-path" transform="rotate(-16 32 32)"></use>\n\t\t\t\t\t<use fill="#8E8E8E" xlink:href="#spinner-path" transform="rotate(-14 32 32)"></use>\n\t\t\t\t\t<use fill="#909090" xlink:href="#spinner-path" transform="rotate(-12 32 32)"></use>\n\t\t\t\t\t<use fill="#929292" xlink:href="#spinner-path" transform="rotate(-10 32 32)"></use>\n\t\t\t\t\t<use fill="#949494" xlink:href="#spinner-path" transform="rotate(-8 32 32)"></use>\n\t\t\t\t\t<use fill="#969696" xlink:href="#spinner-path" transform="rotate(-6 32 32)"></use>\n\t\t\t\t\t<use fill="#989898" xlink:href="#spinner-path" transform="rotate(-4 32 32)"></use>\n\t\t\t\t\t<use fill="#9B9B9B" xlink:href="#spinner-path" transform="rotate(-2 32 32)"></use>\n\t\t\t\t\t<use fill="#9D9D9D" xlink:href="#spinner-path"></use>\n\t\t\t\t\t<use fill="#9F9F9F" xlink:href="#spinner-path" transform="rotate(2 32 32)"></use>\n\t\t\t\t\t<use fill="#A1A1A1" xlink:href="#spinner-path" transform="rotate(4 32 32)"></use>\n\t\t\t\t\t<use fill="#A3A3A3" xlink:href="#spinner-path" transform="rotate(6 32 32)"></use>\n\t\t\t\t\t<use fill="#A5A5A5" xlink:href="#spinner-path" transform="rotate(8 32 32)"></use>\n\t\t\t\t\t<use fill="#A7A7A7" xlink:href="#spinner-path" transform="rotate(10 32 32)"></use>\n\t\t\t\t\t<use fill="#A9A9A9" xlink:href="#spinner-path" transform="rotate(12 32 32)"></use>\n\t\t\t\t\t<use fill="#ACACAC" xlink:href="#spinner-path" transform="rotate(14 32 32)"></use>\n\t\t\t\t\t<use fill="#AEAEAE" xlink:href="#spinner-path" transform="rotate(16 32 32)"></use>\n\t\t\t\t\t<use fill="#B0B0B0" xlink:href="#spinner-path" transform="rotate(18 32 32)"></use>\n\t\t\t\t\t<use fill="#B2B2B2" xlink:href="#spinner-path" transform="rotate(20 32 32)"></use>\n\t\t\t\t\t<use fill="#B4B4B4" xlink:href="#spinner-path" transform="rotate(22 32 32)"></use>\n\t\t\t\t\t<use fill="#B6B6B6" xlink:href="#spinner-path" transform="rotate(24 32 32)"></use>\n\t\t\t\t\t<use fill="#B8B8B8" xlink:href="#spinner-path" transform="rotate(26 32 32)"></use>\n\t\t\t\t\t<use fill="#BABABA" xlink:href="#spinner-path" transform="rotate(28 32 32)"></use>\n\t\t\t\t\t<use fill="#BDBDBD" xlink:href="#spinner-path" transform="rotate(30 32 32)"></use>\n\t\t\t\t\t<use fill="#BFBFBF" xlink:href="#spinner-path" transform="rotate(32 32 32)"></use>\n\t\t\t\t\t<use fill="#C1C1C1" xlink:href="#spinner-path" transform="rotate(34 32 32)"></use>\n\t\t\t\t\t<use fill="#C3C3C3" xlink:href="#spinner-path" transform="rotate(36 32 32)"></use>\n\t\t\t\t\t<use fill="#C5C5C5" xlink:href="#spinner-path" transform="rotate(38 32 32)"></use>\n\t\t\t\t\t<use fill="#C7C7C7" xlink:href="#spinner-path" transform="rotate(40 32 32)"></use>\n\t\t\t\t\t<use fill="#C9C9C9" xlink:href="#spinner-path" transform="rotate(42 32 32)"></use>\n\t\t\t\t\t<use fill="#CBCBCB" xlink:href="#spinner-path" transform="rotate(44 32 32)"></use>\n\t\t\t\t\t<use fill="#CECECE" xlink:href="#spinner-path" transform="rotate(46 32 32)"></use>\n\t\t\t\t\t<use fill="#D0D0D0" xlink:href="#spinner-path" transform="rotate(48 32 32)"></use>\n\t\t\t\t\t<use fill="#D2D2D2" xlink:href="#spinner-path" transform="rotate(50 32 32)"></use>\n\t\t\t\t\t<use fill="#D4D4D4" xlink:href="#spinner-path" transform="rotate(52 32 32)"></use>\n\t\t\t\t\t<use fill="#D6D6D6" xlink:href="#spinner-path" transform="rotate(54 32 32)"></use>\n\t\t\t\t\t<use fill="#D8D8D8" xlink:href="#spinner-path" transform="rotate(56 32 32)"></use>\n\t\t\t\t\t<use fill="#DADADA" xlink:href="#spinner-path" transform="rotate(58 32 32)"></use>\n\t\t\t\t\t<use fill="#DCDCDC" xlink:href="#spinner-path" transform="rotate(60 32 32)"></use>\n\t\t\t\t\t<use fill="#DFDFDF" xlink:href="#spinner-path" transform="rotate(62 32 32)"></use>\n\t\t\t\t\t<use fill="#E1E1E1" xlink:href="#spinner-path" transform="rotate(64 32 32)"></use>\n\t\t\t\t\t<use fill="#E3E3E3" xlink:href="#spinner-path" transform="rotate(66 32 32)"></use>\n\t\t\t\t\t<use fill="#E5E5E5" xlink:href="#spinner-path" transform="rotate(68 32 32)"></use>\n\t\t\t\t\t<use fill="#E7E7E7" xlink:href="#spinner-path" transform="rotate(70 32 32)"></use>\n\t\t\t\t\t<use fill="#E9E9E9" xlink:href="#spinner-path" transform="rotate(72 32 32)"></use>\n\t\t\t\t\t<use fill="#EBEBEB" xlink:href="#spinner-path" transform="rotate(74 32 32)"></use>\n\t\t\t\t\t<use fill="#EDEDED" xlink:href="#spinner-path" transform="rotate(76 32 32)"></use>\n\t\t\t\t\t<use fill="#F0F0F0" xlink:href="#spinner-path" transform="rotate(78 32 32)"></use>\n\t\t\t\t\t<use fill="#F2F2F2" xlink:href="#spinner-path" transform="rotate(80 32 32)"></use>\n\t\t\t\t\t<use fill="#F4F4F4" xlink:href="#spinner-path" transform="rotate(82 32 32)"></use>\n\t\t\t\t\t<use fill="#F6F6F6" xlink:href="#spinner-path" transform="rotate(84 32 32)"></use>\n\t\t\t\t\t<use fill="#F8F8F8" xlink:href="#spinner-path" transform="rotate(86 32 32)"></use>\n\t\t\t\t\t<use fill="#FAFAFA" xlink:href="#spinner-path" transform="rotate(88 32 32)"></use>\n\t\t\t\t\t<use fill="#FCFCFC" xlink:href="#spinner-path" transform="rotate(90 32 32)"></use>\n\t\t\t\t\t<use fill="#FEFEFE" xlink:href="#spinner-path" transform="rotate(92 32 32)"></use>\n\t\t\t\t</mask>\n\t\t\t</defs>\n\t\t\t<path d="M54.6 47.6c-1.98-1.98-5.09-1.98-7.07 0-8.56 8.56-22.6 8.56-31.1 0-8.56-8.56-8.56-22.6 0-31.1 4.54-5.58-3.25-10.7-7.07-7.07-12.4 12.4-12.4 32.8 0 45.3 12.4 12.4 32.8 12.4 45.3 0 1.98-1.98 1.98-5.09 0-7.07zM32 54c-12.1 0-22-9.9-22-22s9.9-22 22-22c2.8 0 5-2.2 5-5s-2.2-5-5-5C14.4 0 0 14.4 0 32s14.4 32 32 32c7.16-.736 5.26-9.84 0-10z" mask="url(#spinner-mask)"></path>\n\t\t</svg>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/spinner/spinner.html")});define("feast-tpl!ui-block/spinner/spinner.html",["feast-tpl!app/feast-tpl!ui-block/spinner/spinner.html"],function(a){return a});define("ui-block/spinner/spinner",["exports","feast","feast-tpl!./spinner.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default=c.default.Block.extend({name:"spinner",template:d.default,blocks:{}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-spinner/list-letter-spinner",["require","exports","feast","feast-tpl!./list-letter-spinner.html","ui-block/spinner/spinner"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.default=a.default.Block.extend({name:"list-letter-spinner",template:b.default,immutable:true,defaults:{hidden:true},attrChanged:{hidden:function(a){var b;(b=this.get("model"))===null||b===void 0?void 0:b.set("visible",!a);this.broadcast("state:toggle")}},blocks:{spinner:c.default}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-tip/list-letter-tip.html",["feast"],function(a){return a.smartParse('<div qa:id="list-letter-tip">\n\t<fn:var name="compact" value="{attrs.compact}"/>\n\t<fn:var name="folder" value="{attrs.folder}"/>\n\n\t<bem:mod name="rounded" test="attrs.rounded" />\n\t<bem:mod name="next-selected" test="attrs.isNextSelected"/>\n\t<bem:mod name="pony-mode" test="attrs[\'pony-mode\']"/>\n\t<bem:mod name="compact" test="compact"/>\n\n\t<fn:choose>\n\t\t<fn:when test="attrs.type === \'spam:cleanup\'">\n\t\t\t\x3c!-- Плашка об очистке папки Спам --\x3e\n\t\t\t<fn:var name="message"\n\t\t\t\t\tvalue="{i18n(\'Письма, перемещённые в Спам более месяца назад, будут автоматически удаляться.\')}"/>\n\t\t\t<fn:var name="primaryText" value="{i18n(\'Очистить папку\')}"/>\n\t\t\t<fn:var name="secondaryLink" value="{attrs[\'spam:cleanup:secondary-link\']}"/>\n\t\t\t<fn:var name="secondaryText" value="{i18n(\'Подробнее\')}"/>\n\n\t\t\t<fn:choose>\n\t\t\t\t<fn:when test="compact">\n\t\t\t\t\t\x3c!-- 3pane --\x3e\n\t\t\t\t\t<div bem:elem="message">{message}</div>\n\t\t\t\t\t<div bem:elem="controls">\n\t\t\t\t\t\t<b:link remit:click.prevent="clear"\n\t\t\t\t\t\t\t\tevent:details="{model:folder}"\n\t\t\t\t\t\t\t\ttext="{primaryText}"\n\t\t\t\t\t\t\t\tqa:id="controls-cleanup"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<b:link href="{secondaryLink}"\n\t\t\t\t\t\t\t\ttext="{secondaryText}"\n\t\t\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\t\t\tsecondary\n\t\t\t\t\t\t\t\tfn:if="!attrs[\'help-disabled\'] && !attrs.mobile"\n\t\t\t\t\t\t\t\tqa:id="controls-more"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</fn:when>\n\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\x3c!-- 2pane --\x3e\n\t\t\t\t\t<div bem:elem="message">\n\t\t\t\t\t\t{message}\n\t\t\t\t\t\t<b:link text="{secondaryText}"\n\t\t\t\t\t\t\t\thref="{secondaryLink}"\n\t\t\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\t\t\tsecondary\n\t\t\t\t\t\t\t\tfn:if="!attrs[\'help-disabled\'] && !attrs.mobile"\n\t\t\t\t\t\t\t\tqa:id="controls-more"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div bem:elem="controls">\n\t\t\t\t\t\t<b:link remit:click.prevent="clear"\n\t\t\t\t\t\t\t\tevent:details="{model:folder}"\n\t\t\t\t\t\t\t\ttext="{primaryText}"\n\t\t\t\t\t\t\t\tqa:id="controls-cleanup"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</fn:otherwise>\n\t\t\t</fn:choose>\n\t\t</fn:when>\n\n\t\t<fn:when test="attrs.type === \'trash:cleanup\'">\n\t\t\t\x3c!-- Плашка об очистке папки Корзина --\x3e\n\t\t\t<fn:var name="message"\n\t\t\t\t\tvalue="{i18n(\'Письма, перемещённые в Корзину более месяца назад, будут автоматически удаляться.\')}"/>\n\t\t\t<fn:var name="primaryText" value="{i18n(\'Очистить папку\')}"/>\n\n\t\t\t<fn:choose>\n\t\t\t\t\x3c!-- 3pane --\x3e\n\t\t\t\t<fn:when test="compact">\n\t\t\t\t\t<div bem:elem="message">{message}</div>\n\t\t\t\t\t<fn:if test="_this.isRemoveVisible()">\n\t\t\t\t\t\t<div bem:elem="controls">\n\t\t\t\t\t\t\t<b:link remit:click.prevent="clear"\n\t\t\t\t\t\t\t\t\tevent:details="{model:folder}"\n\t\t\t\t\t\t\t\t\ttext="{primaryText}"\n\t\t\t\t\t\t\t\t\tqa:id="controls-cleanup"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:when>\n\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\x3c!-- 2pane --\x3e\n\t\t\t\t\t<div bem:elem="message">{message}</div>\n\t\t\t\t\t<fn:if test="_this.isRemoveVisible()">\n\t\t\t\t\t\t<div bem:elem="controls">\n\t\t\t\t\t\t\t<b:link remit:click.prevent="clear"\n\t\t\t\t\t\t\t\t\tevent:details="{model:folder}"\n\t\t\t\t\t\t\t\t\ttext="{primaryText}"\n\t\t\t\t\t\t\t\t\tqa:id="controls-cleanup"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:otherwise>\n\t\t\t</fn:choose>\n\t\t</fn:when>\n\t</fn:choose>\n\n\t<b:delimeter last full fn:if="!attrs.borderless"/>\n</div>\n',"app/feast-tpl!ui-block/list-letter-tip/list-letter-tip.html")});define("feast-tpl!ui-block/list-letter-tip/list-letter-tip.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-tip/list-letter-tip.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/folder",["require","exports","default-values","mail/SharedMailbox"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isSharedMailbox=exports.virtualFolderData=exports.hasParentPrivateFolders=exports.isParentPrivateFolder=exports.isDeleteFromFolderDisabled=void 0;b=__importDefault(b);function c(b){return a.DISABLE_DELETE_FROM_TRASH&&!!(b===null||b===void 0?void 0:b.isTrashLike())}exports.isDeleteFromFolderDisabled=c;function d(b){return a.PARENTAL_CONTROL_PRIVATE_FOLDER_IDS.includes(b.id)}exports.isParentPrivateFolder=d;function e(b){return!!a.PARENTAL_CONTROL_PRIVATE_FOLDER_IDS.length&&b.some(function(a){return d(a)})}exports.hasParentPrivateFolders=e;function f(a){var b=a.type,c=a.name;return{archive:false,child:false,children:true,id:b,name:c,only_web:false,open:true,parent:"-1",security:false,system:true,type:b}}exports.virtualFolderData=f;var g=function(a){var c,d,e;var f=(c=a.get("owner"))===null||c===void 0?void 0:c.email;return f&&((e=(d=b.default.all.getMailboxByEmail(f))===null||d===void 0?void 0:d.get("shared_items"))===null||e===void 0?void 0:e.box)};exports.isSharedMailbox=g});define("ui-block/list-letter-tip/list-letter-tip",["exports","cfg","default-values","feast","feast-tpl!./list-letter-tip.html","helpers/folder","ui-block/delimeter/delimeter"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=k(a);var h=k(c);var i=k(d);var j=k(f);function k(a){return a&&a.__esModule?a:{default:a}}exports.default=h.default.Block.extend({name:"list-letter-tip",template:i.default,defaults:{"help-disabled":b.SPAM_HELP_DISABLED,"spam:cleanup:secondary-link":g.default.get("urls.helpUrl")+"/mail-help/security/spam","pony-mode":false,isNextSelected:false},blocks:{delimeter:j.default},isRemoveVisible:function a(){return!(0,e.isDeleteFromFolderDisabled)(this.get("folder"))}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-welcome/list-letter-welcome.html",["feast"],function(a){return a.smartParse('<div qa:id="list-letter-welcome">\n\t<fn:var name="is3pane" value="{attrs.type === \'3pane\'}"/>\n\t<fn:var name="weatherData" value="{_this.getWeatherData()}"/>\n\t<fn:var name="withGreeting" value="{attrs.model && attrs.model.get(\'withGreeting\')}"/>\n\n\t<bem:mod name="{attrs.type}"/>\n\t<bem:mod name="ponymode" test="attrs.ponyMode"/>\n\t<bem:mod name="hidden" test="!attrs.model || !attrs.model.is(\'visible\')"/>\n\n\t<fn:if test="!is3pane">\n\t\t<div bem:elem="mainline">\n\t\t\t<a bem:elem="logo" href="{attrs.marusiaUrl}" target="_blank" remit:click="logo" qa:id="logo">\n\t\t\t\t<fn:attr name="style" value="{_this.getImage()}"/>\n\t\t\t</a>\n\n\t\t\t<span bem:elem="header">{_this.getHeader()}</span>\n\n\t\t\t<span bem:elem="secondary">\n\t\t\t\t<span bem:elem="date" fn:if="withGreeting">\n\t\t\t\t\t{_this.getDate()}\n\t\t\t\t</span>\n\n\t\t\t\t<a\n\t\t\t\t\tfn:if="weatherData"\n\t\t\t\t\thref="{weatherData.link}"\n\t\t\t\t\ttarget="_blank"\n\t\t\t\t\tbem:elem="weather"\n\t\t\t\t\tremit:click="weather"\n\t\t\t\t\tqa:id="weather"\n\t\t\t\t>\n\t\t\t\t\t<img\n\t\t\t\t\t\tbem:elem="weather-icon"\n\t\t\t\t\t\tsrc="{attrs.weatherUrl}{weatherData.now_pict}.svg"\n\t\t\t\t\t\ttitle="{weatherData.now_description}"\n\t\t\t\t\t/>\n\t\t\t\t\t{weatherData.now_temp}°\n\t\t\t\t</a>\n\t\t\t</span>\n\n\t\t\t<span\n\t\t\t\tbem:elem="expand"\n\t\t\t\tfn:if="attrs.skillsEnabled"\n\t\t\t\tremit:click="expand"\n\t\t\t>\n\t\t\t\t{i18n(\'Подробнее\')}\n\t\t\t</span>\n\n\t\t\t<span bem:elem="more">\n\t\t\t\t<b:list-letter-welcome-dropdown-actions\n\t\t\t\t\tuse:mediator="welcome-block-manager"\n\t\t\t\t/>\n\t\t\t</span>\n\t\t</div>\n\t</fn:if>\n\n\t<fn:if test="is3pane">\n\t\t<div bem:elem="mainline">\n\t\t\t<a bem:elem="logo" href="{attrs.marusiaUrl}" target="_blank" remit:click="logo" qa:id="logo">\n\t\t\t\t<fn:attr name="style" value="{_this.getImage()}"/>\n\t\t\t</a>\n\n\t\t\t<span bem:elem="mainline-content">\n\t\t\t\t<span bem:elem="content-row">\n\t\t\t\t\t<span bem:elem="header">\n\t\t\t\t\t\t<bem:mod name="compact" test="!withGreeting"/>\n\t\t\t\t\t\t{_this.getHeader()}\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<a\n\t\t\t\t\t\tfn:if="weatherData && !withGreeting"\n\t\t\t\t\t\thref="{weatherData.link}"\n\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\tbem:elem="weather"\n\t\t\t\t\t\tbem:mod="in-header"\n\t\t\t\t\t\tremit:click="weather"\n\t\t\t\t\t\tqa:id="weather"\n\t\t\t\t\t>\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tbem:elem="weather-icon"\n\t\t\t\t\t\t\tsrc="{attrs.weatherUrl}{weatherData.now_pict}.svg"\n\t\t\t\t\t\t\ttitle="{weatherData.now_description}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{weatherData.now_temp}°\n\t\t\t\t\t</a>\n\n\t\t\t\t\t<span bem:elem="more">\n\t\t\t\t\t\t<b:list-letter-welcome-dropdown-actions\n\t\t\t\t\t\t\tuse:mediator="welcome-block-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\n\t\t\t\t<span bem:elem="secondary" fn:if="withGreeting">\n\t\t\t\t\t<span bem:elem="date">\n\t\t\t\t\t\t{_this.getDate(true)}\n\t\t\t\t\t</span>\n\t\t\t\t\t<a\n\t\t\t\t\t\tfn:if="weatherData && withGreeting"\n\t\t\t\t\t\thref="{weatherData.link}"\n\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\tbem:elem="weather"\n\t\t\t\t\t\tremit:click="weather"\n\t\t\t\t\t\tqa:id="weather"\n\t\t\t\t\t>\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tbem:elem="weather-icon"\n\t\t\t\t\t\t\tsrc="{attrs.weatherUrl}{weatherData.now_pict}.svg"\n\t\t\t\t\t\t\ttitle="{weatherData.now_description}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{weatherData.now_temp}°\n\t\t\t\t\t</a>\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t</div>\n\t</fn:if>\n\n\t<div bem:elem="suggestions">\n\t\t<bem:mod name="expanded" test="attrs.expanded"/>\n\n\t\t<b:list-letter-welcome-suggestions\n\t\t\tuse:mediator="welcome-block-manager layout-manager"\n\t\t\titems="{_this.getSuggestions()}"\n\t\t/>\n\t</div>\n\n\t<fn:if test="is3pane">\n\t\t<span\n\t\t\tbem:elem="expand"\n\t\t\tfn:if="attrs.skillsEnabled"\n\t\t\tremit:click="onExpandClick"\n\t\t>\n\t\t\t{i18n(\'Показать больше\')}\n\t\t</span>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/list-letter-welcome/list-letter-welcome.html")});define("feast-tpl!ui-block/list-letter-welcome/list-letter-welcome.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-welcome/list-letter-welcome.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/list-letter-welcome-dropdown-actions/list-letter-welcome-dropdown-actions.html",["feast"],function(a){return a.smartParse('<div>\n\t\x3c!-- Variables --\x3e\n\n\t\x3c!-- Modificators --\x3e\n\t<bem:mod name="compact" test="attrs.compact"/>\n\n\t\x3c!-- Content --\x3e\n\t<b:dropdown\n\t\tdisable-expand-center\n\t\texpand-left\n\t\tico="navigation:more_vertical"\n\t\tponymode="{attrs[\'pony-mode\']}"\n\t\tpure\n\t\tshort\n\t\tradar-id="more"\n\t\tremit:dropdown-change-state="dropdown-change"\n\t>\n\t\t<fn:match name="items" args="dropdownArgs">\n\t\t\t<b:list>\n\t\t\t\t\x3c!-- Закрепить --\x3e\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="attrs.pin"\n\t\t\t\t\tqa:id="pin"\n\t\t\t\t\tradar-id="pin"\n\t\t\t\t\tremit:click="welcomeblock:pin"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Закрепить\')}</span>\n\t\t\t\t</b:list-item>\n\n\t\t\t\t\x3c!-- Выбрать город --\x3e\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="attrs.selectGeo"\n\t\t\t\t\tqa:id="selectGeo"\n\t\t\t\t\tradar-id="geo"\n\t\t\t\t\tremit:click="welcomeblock:selectgeo"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Выбрать город\')}</span>\n\t\t\t\t</b:list-item>\n\n\t\t\t\t\x3c!-- Скрыть до завтра --\x3e\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="attrs.snooze"\n\t\t\t\t\tqa:id="snooze"\n\t\t\t\t\tradar-id="snooze"\n\t\t\t\t\tremit:click="welcomeblock:snooze"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Скрыть до завтра\')}</span>\n\t\t\t\t</b:list-item>\n\t\t\t</b:list>\n\t\t</fn:match>\n\t</b:dropdown>\n</div>\n',"app/feast-tpl!ui-block/list-letter-welcome-dropdown-actions/list-letter-welcome-dropdown-actions.html")});define("feast-tpl!ui-block/list-letter-welcome-dropdown-actions/list-letter-welcome-dropdown-actions.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-welcome-dropdown-actions/list-letter-welcome-dropdown-actions.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-welcome-dropdown-actions/list-letter-welcome-dropdown-actions",["require","exports","feast","feast-tpl!./list-letter-welcome-dropdown-actions.html","ui-block/dropdown/dropdown","ui-block/ico/ico","ui-block/list/list","ui-block/list-item/list-item"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Events=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);var g;(function(a){a["PIN"]="welcomeblock:pin";a["SELECT_GEO"]="welcomeblock:selectgeo";a["SNOOZE"]="welcomeblock:snooze"})(g=exports.Events||(exports.Events={}));exports.default=a.default.Block.extend({name:"list-letter-welcome-dropdown-actions",rootClassName:"wlcm-d-a",template:b.default,immutable:true,isolate:true,isolateEvents:true,blocks:{dropdown:c.default,ico:d.default,list:e.default,"list-item":f.default},defaults:{compact:false,pin:false,selectGeo:true,snooze:true}})});define("feast-tpl!app/feast-tpl!ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="ponymode" test="attrs.ponyMode"/>\n\n\t<fn:match name="item" args="item, index">\n\t\t<span\n\t\t\tbem:elem="item"\n\t\t\tkey="{index}"\n\t\t\tremit:click="suggestion:click"\n\t\t\tevent:details="item"\n\t\t>\n\t\t\t<span bem:elem="item-icon">\n\t\t\t\t<img src="{item.icon}"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="item-content">\n\t\t\t\t<span bem:elem="item-title">\n\t\t\t\t\t<fn:value>item.title</fn:value>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="item-text">\n\t\t\t\t\t<fn:value>item.text</fn:value>\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t</span>\n\t</fn:match>\n\n\t<div bem:elem="container">\n\t\t<fn:for data="attrs.items" as="item" key="index">\n\t\t\t<fn:apply-match name="item" args="item, index"/>\n\t\t</fn:for>\n\t</div>\n\n\t<div bem:elem="arrow" style="left: 8px;">\n\t\t<b:ico name="navigation:arrow_list_previous" size="s"/>\n\t</div>\n\n\t<div bem:elem="arrow" style="right: 8px;">\n\t\t<b:ico name="navigation:arrow_list_next" size="s"/>\n\t</div>\n\n</div>\n',"app/feast-tpl!ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions.html")});define("feast-tpl!ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions",["require","exports","feast","feast-tpl!./list-letter-welcome-suggestions.html","ui-block/ico/ico"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Events=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d;(function(a){a["SuggestionClick"]="suggestion:click"})(d=exports.Events||(exports.Events={}));exports.default=a.default.Block.extend({name:"list-letter-welcome-suggestions",template:b.default,immutable:true,defaults:{items:[],events:d,ponyMode:false},blocks:{ico:c.default},events:{}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-letter-welcome/list-letter-welcome",["require","exports","default-values","feast","feast-tpl!./list-letter-welcome.html","service/radars/decorator","ui-block/list-letter-welcome-dropdown-actions/list-letter-welcome-dropdown-actions","ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions","../../feast-mod/utils"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Events=void 0;b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);var h={night:i18n("Доброй ночи"),morning:i18n("Доброе утро"),day:i18n("Добрый день"),evening:i18n("Добрый вечер")};var i;(function(a){a["MOUNT"]="listletterwelcome:mount";a["SHOW"]="listletterwelcome:show";a["HIDE"]="listletterwelcome:hide"})(i=exports.Events||(exports.Events={}));var j=false;var k=false;exports.default=b.default.Block.extend((0,d.default)({id:"ll-wlcm",events:["weather","logo"],explicit:true})({name:"list-letter-welcome",template:c.default,immutable:true,defaults:{expanded:false,type:"2pane",ponyMode:false,marusiaLogo:a.MARUSIA_LOGO,marusiaUrl:a.MARUSIA_URL,weatherUrl:a.WEATHER_URL,skillsEnabled:false},blocks:{"list-letter-welcome-dropdown-actions":e.default,"list-letter-welcome-suggestions":f.default},events:{logo:"onLogoClick",expand:"onExpandClick"},attrChanged:{model:function(a,b){b===null||b===void 0?void 0:b.off("change",this.onModelChange);a.on("change",this.onModelChange)}},constructor:function(){b.default.Block.apply(this,arguments);this.onModelChange=this.onModelChange.bind(this)},didMount:function(){this.broadcast(i.MOUNT)},didUpdate:function(){var a=this.get("model");if(a===null||a===void 0?void 0:a.is("visible")){if(!j){j=true;this.radar("show")}}else if(!k){k=true;this.radar("hide")}},didUnmount:function(){this.broadcast(i.HIDE)},onModelChange:function(a){var b;if((b=a.changed)===null||b===void 0?void 0:b.hasOwnProperty("hidden")){this.broadcast(a.changed.hidden?i.HIDE:i.SHOW)}},onLogoClick:function(){},onExpandClick:function(){this.set("expanded",!this.get("expanded"))},getImage:function(){return'background-image: url("'.concat(this.get("marusiaLogo"),'");')},getUsername:function(){var a=this.get("current-user");if(!a){return""}return a.get("name.first")},getHeader:function(){var a=this.getUsername();var b=this.get("model");if(!(b===null||b===void 0?void 0:b.is("withGreeting"))){return this.getDate(this.get("type")==="3pane")}if(a){return i18n("{hello}, {username}",{hello:this.getGreeting(),username:a})}else{return i18n("Доброе утро")}},getGreeting:function(){var a=new Date;var b=a.getHours();switch(true){case b<6:return h.night;case b<12:return h.morning;case b<18:return h.day;default:return h.evening}},getDate:function(a){return(0,g.capitalize)((0,g.formatDate)(new Date,[["weekday","long"],["day","numeric"],["month","long"]],{literalAfter:{weekday:", ",day:" "}})).replace(/([^\d\s]{3})[^\d\s]+$/,a?"$1":"$&")},getWeatherData:function(){var a=this.get("model");return a===null||a===void 0?void 0:a.get("weatherData")},getSuggestions:function(){return[{skill:"music",icon:"https://img.imgsmail.ru/static.promo/octavius/welcome/ic_music.svg",title:"Музыка",text:"Поставь что-нибудь весёлое"},{skill:"answers",icon:"https://img.imgsmail.ru/static.promo/octavius/welcome/ic_fact.svg",title:"Ответы",text:"Где находится Эльбрус?"},{skill:"calc",icon:"https://img.imgsmail.ru/static.promo/octavius/welcome/ic_calculator.svg",title:"Калькулятор",text:"Сложи числа"},{skill:"timer",icon:"https://img.imgsmail.ru/static.promo/octavius/welcome/ic_timer.svg",title:"Таймер",text:"Установи таймер"}]}}))});define("feast-tpl!app/feast-tpl!ui-block/metathread/metathread.html",["feast"],function(a){return a.smartParse('<div>\n\t\x3c!-- Переменные --\x3e\n\t<fn:var name="model" value="{attrs.model}"/>\n\t<fn:var name="folderId" value="{model.get(\'metathread_data.folder\')}" />\n\t<fn:var name="folderName" value="{model.get(\'metathread_data.folder_name\')}" />\n\t\x3c!-- Метатред первый в списке писем --\x3e\n\t<fn:var name="isFirst" value="{attrs.first}"/>\n\t\x3c!-- Метатред без отступа? --\x3e\n\t<fn:var name="disableSpacer" value="{attrs[\'disable-spacer\']}"/>\n\t\x3c!-- Метатред последний в списке писем --\x3e\n\t<fn:var name="isLast" value="{attrs.last}"/>\n\t\x3c!-- Метатред раскрыт, если model.isExpanded --\x3e\n\t<fn:var name="isExpanded" value="{model.isExpanded()}"/>\n\t\x3c!-- 3pane --\x3e\n\t<fn:var name="isCompact" value="{attrs.compact}"/>\n\t\x3c!-- Компактный вид --\x3e\n\t<fn:var name="ponymode" value="{attrs.ponymode}"/>\n\t\x3c!-- Укороченный дропдаун --\x3e\n\t<fn:var name="isShortDropdown" value="{attrs[\'short-dropdown\']}"/>\n\t\x3c!-- Укороченный текст --\x3e\n\t<fn:var name="isShortText" value="{attrs[\'short-text\']}"/>\n\t\x3c!-- Выбран галкой --\x3e\n\t<fn:var name="isSelected" value="{attrs.selected}"/>\n\t\x3c!-- Прилип --\x3e\n\t<fn:var name="isSticky" value="{_this.isStickyEnabled() && isExpanded && attrs.sticky}"/>\n\n\t\x3c!-- Модификаторы --\x3e\n\t<bem:mod name="first" test="isFirst" />\n\t<bem:mod name="last" test="isLast" />\n\t<bem:mod name="expanded" test="isExpanded" />\n\t<bem:mod name="collapsed" test="!isExpanded" />\n\t<bem:mod name="sticky" test="isSticky" />\n\t<bem:mod name="first-sticky" test="isFirst && isSticky"/>\n\t<bem:mod name="active" test="isSelected"/>\n\t<bem:mod name="new-selection" test="attrs.newSelection"/>\n\t<bem:mod name="firstSelected" test="attrs.isFirstSelected"/>\n\t<bem:mod name="lastSelected" test="attrs.isLastSelected"/>\n\n\t\x3c!-- Содержимое --\x3e\n\t<div bem:elem="spacer" fn:if="!isFirst && !disableSpacer">\n\t\t\x3c!-- <bem:mod name="before" /> --\x3e\n\t</div>\n\n\t<div bem:elem="contain">\n\t\t<fn:choose>\n\t\t\t<fn:when test="!isCompact">\n\t\t\t\t<b:metathread-head-common\n\t\t\t\t\texpanded="{isExpanded}"\n\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\tmodel="{model}"\n\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\tselected="{isSelected}"\n\t\t\t\t\tisFirstSelected="{attrs.isFirstSelected}"\n\t\t\t\t\tisLastSelected="{attrs.isLastSelected}"\n\t\t\t\t\thas-selected="{attrs[\'has-selected\']}"\n\t\t\t\t\tshort-text="{isShortText}"\n\t\t\t\t\tsticky="{isSticky}"\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tnewSelection="{attrs.newSelection}"\n\t\t\t\t\tsmallUnreadBtn="{attrs.smallUnreadBtn}"\n\t\t\t\t\tredirectUrl="{attrs.redirectExp && _this.getUrl()}"\n\n\t\t\t\t\tevent:details="model"\n\t\t\t\t\tremit:click="click:metathread-item"\n\t\t\t\t\tremit:contextmenu="rightclick"\n\t\t\t\t\tremit:avatar="click:metathreadavatar"\n\t\t\t\t\tremit:link="click:metathread-link"\n\t\t\t\t\tremit:cleanmaster="click:cleanmaster"\n\t\t\t\t\tremit:scrollintoself="scrollintoself"\n\t\t\t\t\tremit:disable="click:disable"\n\t\t\t\t\tuse:mediator="letters-actions folders-actions"\n\t\t\t\t/>\n\t\t\t</fn:when>\n\t\t\t<fn:when test="isCompact && isExpanded">\n\t\t\t\t<b:metathread-head-compact-expanded\n\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\tmodel="{model}"\n\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\tselected="{isSelected}"\n\t\t\t\t\thas-selected="{attrs[\'has-selected\']}"\n\t\t\t\t\tshort-dropdown="{isShortDropdown}"\n\t\t\t\t\tsticky="{isSticky}"\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tredirectUrl="{attrs.redirectExp && _this.getUrl()}"\n\n\t\t\t\t\tevent:details="model"\n\t\t\t\t\tremit:click="click:metathread-item"\n\t\t\t\t\tremit:contextmenu="rightclick"\n\t\t\t\t\tremit:avatar="click:metathreadavatar"\n\t\t\t\t\tremit:link="click:metathread-link"\n\t\t\t\t\tremit:cleanmaster="click:cleanmaster"\n\t\t\t\t\tremit:scrollintoself="scrollintoself"\n\t\t\t\t\tremit:disable="click:disable"\n\t\t\t\t\tuse:mediator="letters-actions folders-actions layout-manager"\n\t\t\t\t/>\n\t\t\t</fn:when>\n\t\t\t<fn:otherwise>\n\t\t\t\t<b:metathread-head-compact\n\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\tmodel="{model}"\n\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\tselected="{isSelected}"\n\t\t\t\t\tshort-dropdown="{isShortDropdown}"\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tredirectUrl="{attrs.redirectExp && _this.getUrl()}"\n\n\t\t\t\t\tevent:details="model"\n\t\t\t\t\tremit:click="click:metathread-item"\n\t\t\t\t\tremit:contextmenu="rightclick"\n\t\t\t\t\tremit:avatar="click:metathreadavatar"\n\t\t\t\t\tremit:link="click:metathread-link"\n\t\t\t\t\tremit:cleanmaster="click:cleanmaster"\n\t\t\t\t\tremit:scrollintoself="scrollintoself"\n\t\t\t\t\tuse:mediator="letters-actions folders-actions"\n\t\t\t\t/>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\n\t\t\x3c!-- Разделители вокруг расхлопнутого метатреда --\x3e\n\t\t<b:delimeter compact="{isCompact}" ponymode="{ponymode}" qa:id="qqq1" indentRight="{attrs.newSelection}" />\n\t\t<b:delimeter last compact="{isCompact}" ponymode="{ponymode}" qa:id="qqq2" indentRight="{attrs.newSelection}" />\n\t</div>\n\n\t\x3c!-- Разделитель для предыдущего письма в открытом и закрытом состоянии --\x3e\n\t<b:delimeter full="{isExpanded}" compact="{isCompact}" ponymode="{ponymode}" qa:id="qqq3" indentRight="{attrs.newSelection}"/>\n</div>\n',"app/feast-tpl!ui-block/metathread/metathread.html")});define("feast-tpl!ui-block/metathread/metathread.html",["feast-tpl!app/feast-tpl!ui-block/metathread/metathread.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/metathread-head-common/metathread-head-common.html",["feast"],function(a){return a.smartParse('<a qa:id="{_this.rootQaId()}" qa:state="{_this.rootQaState()}">\n\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="data" value="{attrs.model}"/>\n\t<fn:var name="type" value="{_this.getType()}"/>\n\t<fn:var name="title" value="{_this.getName()}"/>\n\t<fn:var name="new_cnt" value="{_this.getNewCount()}"/>\n\t<fn:var name="isunread" value="{_this.hasUnread()}"/>\n\t<fn:var name="senders" value="{_this.getSenders()}"/>\n\t<fn:var name="ponymode" value="{attrs[\'pony-mode\']}"/>\n\t<fn:var name="sticky" value="{attrs.sticky}"/>\n\n\t\x3c!-- Класс для переходов стрелками и общих стилей для всех элементов списка писем --\x3e\n\t<fn:add-class name="js-letter-list-item"/>\n\n\t<fn:attr name="href" value="{attrs.redirectUrl}" test="attrs.redirectUrl"/>\n\n\t\x3c!-- Mods  --\x3e\n\t<bem:mod name="first" test="attrs.first"/>\n\t<bem:mod name="last" test="attrs.last"/>\n\t<bem:mod name="expanded" test="attrs.expanded"/>\n\t<bem:mod name="collapsed" test="!attrs.expanded"/>\n\t<bem:mod name="pony-mode" test="ponymode"/>\n\t<bem:mod name="sticky" test="sticky"/>\n\t<bem:mod name="not-sticky" test="!sticky"/>\n\t<bem:mod name="new-selection" test="attrs.newSelection"/>\n\t<bem:mod name="firstSelected" test="attrs.isFirstSelected"/>\n\t<bem:mod name="lastSelected" test="attrs.isLastSelected"/>\n\t<bem:mod name="active" test="attrs.selected"/>\n\n\t\x3c!-- Блок, погнали! --\x3e\n\t<div bem:elem="background">\n\t\t<bem:mod name="active" test="attrs.selected"/>\n\t</div>\n\n\t\x3c!-- Значок непрочитанности --\x3e\n\t\x3c!-- Read status:Start --\x3e\n\t<div bem:elem="read-status" qa:id="unread">\n\t\t<b:read-status\n\t\t\tstate="{isunread}"\n\t\t\tis-forwarded="{false}"\n\t\t\tis-replied="{false}"\n\t\t\tdotSize="{attrs.smallUnreadBtn ? \'small\' : \'normal\'}"\n\t\t\tmodel="{data}"\n\t\t\tremit:toggle.prevent.stop="metathreadtogglestatus:unread"\n\t\t/>\n\t</div>\n\t\x3c!-- Read status:End --\x3e\n\n\t\x3c!-- Иконка метатреда --\x3e\n\t\x3c!-- Avatar:Start --\x3e\n\t<div bem:elem="avatar" qa:id="avatar">\n\t\t<b:metathread-avatar\n\t\t\tcentered\n\t\t\tmodel="{data}"\n\t\t\tsize="common"\n\t\t\tstate="{attrs.selected}"\n\t\t\ttype="{type}"\n\t\t\ttouch="{attrs.touch}"\n\t\t\tremit:toggle="avatar"\n\t\t/>\n\t</div>\n\t\x3c!-- Avatar:End --\x3e\n\n\t\x3c!-- Содержимое элемента --\x3e\n\t\x3c!-- Content:Start --\x3e\n\t<div bem:elem="content">\n\n\t\t\x3c!-- Название папки метатреда --\x3e\n\t\t\x3c!-- Title:Start --\x3e\n\t\t<div\n\t\t\tbem:elem="item"\n\t\t\tbem:mod="title"\n\t\t\tqa:id="title">\n\t\t\t<b:metathread-title\n\t\t\t\ttitle="{title}"\n\t\t\t\ttype="{type}"\n\t\t\t\tunread="{isunread}"\n\t\t\t\tpony-mode="{ponymode}"\n\t\t\t/>\n\t\t</div>\n\n\t\t\x3c!-- Toolbar: Start --\x3e\n\t\t<fn:choose>\n\t\t\t\x3c!-- Свёрнут --\x3e\n\t\t\t\x3c!-- Collapsed:Start --\x3e\n\t\t\t<fn:when test="!attrs.expanded">\n\t\t\t\t\x3c!-- Количество новых писем в треде: NEW --\x3e\n\t\t\t\t\x3c!-- Badge:Start --\x3e\n\t\t\t\t<div\n\t\t\t\t\tfn:if="new_cnt"\n\t\t\t\t\tbem:elem="item"\n\t\t\t\t\tbem:mod="new_cnt"\n\t\t\t\t\tqa:id="new_cnt">\n\t\t\t\t\t<b:metathread-badge counter="{new_cnt}"/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Badge:End --\x3e\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="item"\n\t\t\t\t\tbem:mod="snippet"\n\t\t\t\t\tqa:id="snippet"\n\t\t\t\t>\n\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t<fn:when test="data.isToMyself()">\n\t\t\t\t\t\t\t<b:metathread-snippet-tomyself senders="{senders}" />\n\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t<b:metathread-snippet senders="{senders}" />\n\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t</fn:choose>\n\t\t\t\t</div>\n\n\t\t\t\t\x3c!-- Время отправки последнего письма в папке --\x3e\n\t\t\t\t\x3c!-- Date:Start --\x3e\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="item"\n\t\t\t\t\tbem:mod="date"\n\t\t\t\t\tqa:id="date">\n\t\t\t\t\t<b:letter-date date="{data.get(\'date\')}"/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Date:End --\x3e\n\t\t\t</fn:when>\n\t\t\t\x3c!-- Collapsed:End --\x3e\n\n\t\t\t\x3c!-- Развёрнут --\x3e\n\t\t\t\x3c!-- Expanded: Start --\x3e\n\t\t\t<fn:otherwise>\n\t\t\t\t\x3c!-- Удалить все письма из папки --\x3e\n\t\t\t\t\x3c!-- Не показываем эту кнопку для метатреда "Письма себе" --\x3e\n\t\t\t\t<div\n\t\t\t\t\tfn:if="!attrs[\'has-selected\']"\n\t\t\t\t\tbem:elem="item"\n\t\t\t\t\tbem:mod="button"\n\t\t\t\t\tqa:id="delete"\n\t\t\t\t\tfn:if="!data.isToMyself()"\n\t\t\t\t>\n\t\t\t\t\t<b:button2\n\t\t\t\t\t\tcompact="{ponymode}"\n\t\t\t\t\t\tico="actions:delete"\n\t\t\t\t\t\tpure\n\t\t\t\t\t\ttext="{_this.getRemoveButtonText()}"\n\t\t\t\t\t\tremit:click.prevent.stop="metathread:deleteall"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Пометить все письма прочитанным --\x3e\n\t\t\t\t<div\n\t\t\t\t\tfn:if="isunread && !attrs[\'has-selected\']"\n\t\t\t\t\tbem:elem="item"\n\t\t\t\t\tbem:mod="button"\n\t\t\t\t\tqa:id="read-all">\n\t\t\t\t\t<b:button2\n\t\t\t\t\t\tcompact="{ponymode}"\n\t\t\t\t\t\tico="status:read"\n\t\t\t\t\t\tpure\n\t\t\t\t\t\ttext="{_this.getMarkAllReadText()}"\n\t\t\t\t\t\tremit:click.prevent.stop="metathread:readall"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Ещё --\x3e\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="item"\n\t\t\t\t\tbem:mod="more"\n\t\t\t\t\tqa:id="more"\n\t\t\t\t\tremit:click.prevent.stop\n\t\t\t\t>\n\t\t\t\t\t<b:metathread-dropdown-actions\n\t\t\t\t\t\tmodel="{data}"\n\t\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t\t\tcleanmaster="{!data.isToMyself()}"\n\t\t\t\t\t\tdisable="{data.isToMyself() && !attrs[\'hide-disable-to-myself-metathread\']}"\n\n\t\t\t\t\t\tremit:cleanmaster="cleanmaster"\n\t\t\t\t\t\tremit:navigate="link"\n\t\t\t\t\t\tremit:disable="disable"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- Expanded: End --\x3e\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t\t\x3c!-- Toolbar: End --\x3e\n\t</div>\n\t\x3c!-- Content:End --\x3e\n</a>\n',"app/feast-tpl!ui-block/metathread-head-common/metathread-head-common.html")});define("feast-tpl!ui-block/metathread-head-common/metathread-head-common.html",["feast-tpl!app/feast-tpl!ui-block/metathread-head-common/metathread-head-common.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/list-letter-date/list-letter-date.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:value mod="letterDate">attrs.date</fn:value>\n</div>\n',"app/feast-tpl!ui-block/list-letter-date/list-letter-date.html")});define("feast-tpl!ui-block/list-letter-date/list-letter-date.html",["feast-tpl!app/feast-tpl!ui-block/list-letter-date/list-letter-date.html"],function(a){return a});define("ui-block/list-letter-date/list-letter-date",["exports","feast","feast-mod/letter-date","feast-tpl!./list-letter-date.html"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(a);var e=f(c);function f(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"list-letter-date",rootClassName:"ll-d",template:e.default,immutable:true,isolate:true,isolateEvents:true,defaults:{date:""},mods:{letterDate:b.letterDate}})});define("feast-tpl!app/feast-tpl!ui-block/metathread-avatar/metathread-avatar.html",["feast"],function(a){return a.smartParse('<button\n\ttype="button"\n\tremit:click.stop="toggle"\n\tqa:id="selected:{!!attrs.state}"\n>\n\t<bem:mod name="is-active" test="attrs.state"/>\n\t<bem:mod name="size_{attrs.size}"/>\n\t<bem:mod name="type_{attrs.type}"/>\n\t<bem:mod name="disabled-hover" test="attrs[\'disable-hover\']"/>\n\t<bem:mod name="disabled" test="attrs[\'disable-select\']"/>\n\t<bem:mod name="centered" test="attrs.centered"/>\n\n\t<div\n\t\tbem:elem="container"\n\t\ttitle="{_this.getTitle()}"\n\t\tpromo:id="{_this.getPromoIcoId()}"\n\t>\n\t\t\x3c!-- Чекбокс на тач устройствах --\x3e\n\t\t<bem:mod name="touch" test="attrs[\'touch\']"/>\n\n\t\t<span\n\t\t\tbem:elem="checkbox"\n\t\t\tfn:if="!attrs[\'touch\']"\n\t\t>\n\t\t\t<b:checkbox checked="{attrs.state}"/>\n\t\t</span>\n\n\t\t<span bem:elem="img">\n\t\t\t<b:ico\n\t\t\t\tname="{_this.getIco()}"\n\t\t\t\tsize="{_this.getIcoSize()}"/>\n\t\t</span>\n\t</div>\n</button>\n',"app/feast-tpl!ui-block/metathread-avatar/metathread-avatar.html")});define("feast-tpl!ui-block/metathread-avatar/metathread-avatar.html",["feast-tpl!app/feast-tpl!ui-block/metathread-avatar/metathread-avatar.html"],function(a){return a});define("ui-block/metathread-avatar/metathread-avatar",["exports","feast","feast-tpl!./metathread-avatar.html","ui-block/checkbox/checkbox","ui-block/ico/ico"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend({name:"metathread-avatar",rootClassName:"mt-a",template:f.default,immutable:true,isolate:true,defaults:{indent:false,model:null,state:false,size:"common",type:"social","disable-select":false,"disable-hover":false},notVisualAttributes:{indent:true,model:true,state:false,type:false,"disable-select":false,"disable-hover":true},blocks:{ico:h.default,checkbox:g.default},METATHREAD_TYPES:{social:"navigation:users",newsletters:"categories:mailings",tomyself:"categories:self_mail",news:"categories:subscriptions",official:"categories:government",receipts:"categories:receipts",school:"categories:school",games:"categories:games"},METATHREAD_PROMO_ICO_IDS:{official:"octavius-tooltip-government-metathread-ico"},didMount:function a(){this.el.classList.add("stop-animate")},getTitle:function a(){if(this.get("disable-select")){return false}return this.get("state")?i18n("Снять выделение"):i18n("Выделить")},getIco:function a(){return this.METATHREAD_TYPES[this.get("type")]},getIcoSize:function a(){if(this.get("size")==="common"){return"s"}return"xl"},getPromoIcoId:function a(){return this.METATHREAD_PROMO_ICO_IDS[this.get("type")]}})});define("feast-tpl!app/feast-tpl!ui-block/metathread-badge/metathread-badge.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var\n\t\tname="text"\n\t\tvalue="New"\n\t\ttest="attrs.counter > 0"/>\n\n\t<b:letter-category text="{text}" fn:if="text"/>\n</div>\n',"app/feast-tpl!ui-block/metathread-badge/metathread-badge.html")});define("feast-tpl!ui-block/metathread-badge/metathread-badge.html",["feast-tpl!app/feast-tpl!ui-block/metathread-badge/metathread-badge.html"],function(a){return a});define("ui-block/metathread-badge/metathread-badge",["exports","feast","feast-tpl!./metathread-badge.html","ui-block/letter-category/letter-category"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"metathread-badge",rootClassName:"mt-b",template:e.default,immutable:true,isolate:true,isolateEvents:true,blocks:{"letter-category":f.default},defaults:{counter:0},mods:{}})});define("feast-tpl!app/feast-tpl!ui-block/metathread-dropdown-actions/metathread-dropdown-actions.html",["feast"],function(a){return a.smartParse('<div>\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="data" value="{attrs.model}"/>\n\n\t\x3c!-- Modificators --\x3e\n\t<bem:mod name="compact" test="attrs.compact"/>\n\n\t\x3c!-- Content --\x3e\n\t<b:dropdown\n\t\tdisable-expand-center\n\t\texpand-left\n\t\tico="navigation:more_vertical"\n\t\tponymode="{attrs[\'pony-mode\']}"\n\t\tpure\n\t\tshort\n\t\tradar-id="ctrl"\n\t\tremit:dropdown-change-state="dropdown-change"\n\t>\n\t\t<fn:match name="items" args="dropdownArgs" remit:click.prevent>\n\t\t\t<b:list>\n\t\t\t\t\x3c!-- Удалить все письма из папки --\x3e\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="attrs.deleteall"\n\t\t\t\t\tqa:id="deleteall"\n\t\t\t\t\tremit:click="deleteall"\n\t\t\t\t\tevent:details="data"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t<b:ico name="actions:delete"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="text">{_this.getRemoveButtonText()}</span>\n\t\t\t\t</b:list-item>\n\n\t\t\t\t\x3c!-- Пометить все письма прочитанным --\x3e\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="attrs.readall"\n\t\t\t\t\tqa:id="readall"\n\t\t\t\t\tremit:click="readall"\n\t\t\t\t\tevent:details="data"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t<b:ico name="status:read"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="text">{_this.getMarkAllReadText()}</span>\n\t\t\t\t</b:list-item>\n\n\t\t\t\t\x3c!-- Настроить Рассылки --\x3e\n\t\t\t\t<b:list-item\n\t\t\t\t\tqa:id="cleanmaster"\n\t\t\t\t\tremit:click.prevent="cleanmaster"\n\t\t\t\t\tevent:details="data"\n\t\t\t\t\tfn:if="attrs.cleanmaster"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t<b:ico name="navigation:settings"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="text">{_this.getCleanmasterText()}</span>\n\t\t\t\t</b:list-item>\n\n\t\t\t\t\x3c!-- Перейти в папку метатреда --\x3e\n\t\t\t\t<b:list-item\n\t\t\t\t\tqa:id="navigate"\n\t\t\t\t\tremit:click.prevent="navigate"\n\t\t\t\t\tevent:details="data"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t<b:ico name="navigation:folder"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="text">{_this.getNavigationText()}</span>\n\t\t\t\t</b:list-item>\n\n\t\t\t\t\x3c!-- Отключить метатред --\x3e\n\t\t\t\t<b:list-item\n\t\t\t\t\tqa:id="disable"\n\t\t\t\t\tremit:click.prevent="disable"\n\t\t\t\t\tevent:details="data"\n\t\t\t\t\tfn:if="attrs.disable"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t<b:ico name="navigation:settings"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="text">{_this.getDisableText()}</span>\n\t\t\t\t</b:list-item>\n\t\t\t</b:list>\n\t\t</fn:match>\n\t</b:dropdown>\n</div>\n',"app/feast-tpl!ui-block/metathread-dropdown-actions/metathread-dropdown-actions.html")});define("feast-tpl!ui-block/metathread-dropdown-actions/metathread-dropdown-actions.html",["feast-tpl!app/feast-tpl!ui-block/metathread-dropdown-actions/metathread-dropdown-actions.html"],function(a){return a});define("ui-block/metathread-dropdown-actions/metathread-dropdown-actions",["exports","feast","feast-tpl!./metathread-dropdown-actions.html","helpers/metathreads","ui-block/dropdown/dropdown","ui-block/ico/ico","ui-block/list/list","ui-block/list-item/list-item"],function(exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var h=n(a);var i=n(b);var j=n(d);var k=n(e);var l=n(f);var m=n(g);function n(a){return a&&a.__esModule?a:{default:a}}exports.default=h.default.Block.extend({name:"metathread-dropdown-actions",rootClassName:"mt-d-a",template:i.default,immutable:true,isolate:true,isolateEvents:true,blocks:{dropdown:j.default,ico:k.default,list:l.default,"list-item":m.default},defaults:{compact:false,deleteall:false,model:null,"pony-mode":false,readall:false,cleanmaster:true,disable:false},getCleanmasterText:function a(){return i18n("Настроить рассылки")},getNavigationText:function a(){var b=this.get("model");if(b.isToMyself()){return i18n("Перейти в папку")}return i18n("Перейти в папку")+(" "+(0,c.getShortname)(b))},getRemoveButtonText:function a(){return(0,c.getRemoveButtonText)(this.get("model"))},getDisableText:function a(){var b=this.get("model");if(b.isToMyself()){return i18n("Отключить группировку")}},getMarkAllReadText:c.getMarkAllReadText})});define("ui-block/metathread-head-common/metathread-head-abstract",["exports","data-source/actions","helpers/data-source-dispatch","helpers/metathreads","mail/Folder"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getFolder=h;exports.getType=i;exports.getName=j;exports.getNewCount=k;exports.getRemoveButtonText=l;exports.getMarkAllReadText=m;exports.hasUnread=n;exports.getSenders=o;exports.onMetathreadReadAll=p;exports.onMetathreadDeleteAll=q;exports.rootQaId=r;exports.rootQaState=s;exports.sendersCount=t;exports.getSendersTooltip=u;var e=g(b);var f=g(d);function g(a){return a&&a.__esModule?a:{default:a}}function h(){var a=this.get("model");var b=a.get("metathread_data.folder");return f.default.get(b)}function i(){return this.get("model").get("metathread_data.category")}function j(){return this.get("model").get("metathread_data.folder_name")}function k(){return this.get("model").get("metathread_data.new_cnt")}function l(){return(0,c.getRemoveButtonText)(this.get("model"),this.is("short-text"))}function m(){return(0,c.getMarkAllReadText)()}function n(){return this.get("model").get("flags.unread")}function o(){var a=this.get("model").get("metathread_data.last_senders");var b=this.hasUnread();if(!b){a.forEach(function(a){a.unread=false})}return a}function p(){var b=this.get("model");if(this.is("sticky")){this.broadcast("scrollintoself")}(0,e.default)({type:a.TOGGLE_METATHREAD,state:false,model:b});this.broadcast("read",{model:this.getFolder()})}function q(){this.broadcast("clear",{model:this.getFolder()})}function r(){var a=this.get("model").get("metathread_data.folder");return"metathread-item:folder:"+a}function s(){var a=this.is("expanded");return a?"expanded":"collapsed"}function t(a){return i18n.plural(a,[i18n("{count} отправителей",{count:a}),i18n("{count} отправитель",{count:a}),i18n("{count} отправителя",{count:a})])}function u(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"name";if(a.length<=8){return a.map(function(a){return a[b]}).join(", ")}if(a.length>8){var c=a.length-8;return a.filter(function(a,b){return b<8}).map(function(a){return a[b]}).join(", ")+i18n(" и ещё")+t(c)}}});define("feast-tpl!app/feast-tpl!ui-block/metathread-snippet/metathread-snippet.html",["feast"],function(a){return a.smartParse('<div qa:id="metathread-snippet">\n\t<fn:var name="lastIdx" value="{attrs.senders.length - 1}"/>\n\n\t<fn:for\n\t\tdata="attrs.senders"\n\t\tas="sender"\n\t\tkey="idx">\n\t\t<span bem:elem="sender" key="{attrs.id + \':\' + idx}">\n\t\t\t<bem:mod name="unread" test="sender.unread"/>\n\t\t\t<fn:value>sender.name</fn:value>\n\t\t\t<fn:value>idx !== lastIdx ? \', \' : \'\'</fn:value>\n\t\t</span>\n\t</fn:for>\n</div>\n',"app/feast-tpl!ui-block/metathread-snippet/metathread-snippet.html")});define("feast-tpl!ui-block/metathread-snippet/metathread-snippet.html",["feast-tpl!app/feast-tpl!ui-block/metathread-snippet/metathread-snippet.html"],function(a){return a});define("ui-block/metathread-snippet/metathread-snippet",["exports","feast","feast-tpl!./metathread-snippet.html","service/emoji"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(a);var e=f(b);function f(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"metathread-snippet",rootClassName:"mt-snt",template:e.default,immutable:true,isolate:true,defaults:{senders:[]},didMount:function a(){(0,c.emojiFallback)(this.el,"ms")},didUpdate:function a(){(0,c.emojiFallback)(this.el,"ms")}})});define("feast-tpl!app/feast-tpl!ui-block/metathread-snippet-tomyself/metathread-snippet-tomyself.html",["feast"],function(a){return a.smartParse('<div qa:id="metathread-snippet">\n\t<fn:var name="senders" value="{_this.getSenders()}" />\n\t<fn:var name="lastIdx" value="{senders.length - 1}" />\n\n\t<bem:mod name="preview" test="attrs.preview" />\n\t<bem:mod name="compact" test="attrs.compact" />\n\n\t<fn:for data="senders" as="sender" key="idx">\n\t\t<span bem:elem="subject" key="{attrs.id + \':\' + idx}">\n\t\t\t<bem:mod name="unread" test="sender.unread" />\n\t\t\t<bem:mod name="compact" test="attrs.compact" />\n\t\t\t<bem:mod name="preview" test="attrs.preview" />\n\n\t\t\t<span bem:elem="subject-value">\n\t\t\t\t<bem:mod name="preview" test="attrs.preview" />\n\t\t\t\t<fn:value>sender.subject</fn:value>\n\t\t\t</span>\n\n\t\t\t<span fn:if="idx !== lastIdx">,&nbsp;</span>\n\t\t</span>\n\t</fn:for>\n</div>\n',"app/feast-tpl!ui-block/metathread-snippet-tomyself/metathread-snippet-tomyself.html")});define("feast-tpl!ui-block/metathread-snippet-tomyself/metathread-snippet-tomyself.html",["feast-tpl!app/feast-tpl!ui-block/metathread-snippet-tomyself/metathread-snippet-tomyself.html"],function(a){return a});define("ui-block/metathread-snippet-tomyself/metathread-snippet-tomyself",["exports","service/emoji","default-values","feast","feast-tpl!./metathread-snippet-tomyself.html"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=g(c);var f=g(d);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend({name:"metathread-snippet",rootClassName:"mt-snt-tmslf",template:f.default,immutable:true,isolate:true,defaults:{senders:[],"max-count":b.METATHREAD_TOMYSELF_SNIPPET_ITEMS_MAX_COUNT},getSenders:function a(){var b=this.get("max-count");var c=this.is("preview");var d=this.get("senders");var e=typeof b!=="undefined"&&!c;return e?d.slice(0,b):d},didMount:function b(){(0,a.emojiFallback)(this.el,"mst")},didUpdate:function b(){(0,a.emojiFallback)(this.el,"mst")}})});define("feast-tpl!app/feast-tpl!ui-block/metathread-title/metathread-title.html",["feast"],function(a){return a.smartParse('<span qa:id="metathread-title">\n\t<bem:mod name="{attrs.type}"/>\n\t<bem:mod name="unread" test="attrs.unread"/>\n\t<bem:mod name="ponymode" test="attrs[\'pony-mode\']"/>\n\t<bem:mod name="no-caps" test="attrs[\'disable-metathread-caps\']"/>\n\t{attrs.title}\n</span>\n',"app/feast-tpl!ui-block/metathread-title/metathread-title.html")});define("feast-tpl!ui-block/metathread-title/metathread-title.html",["feast-tpl!app/feast-tpl!ui-block/metathread-title/metathread-title.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/metathread-title/metathread-title",["require","exports","default-values","feast","feast-tpl!./metathread-title.html"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);exports.default=b.default.Block.extend({name:"metathread-title",rootClassName:"mt-t",template:c.default,immutable:true,isolate:true,defaults:{"pony-mode":false,title:"",type:"social",unread:false,"disable-metathread-caps":a.DISABLE_METATHREAD_CAPS}})});define("ui-block/metathread-head-common/metathread-head-common",["exports","default-values","feast","feast-tpl!./metathread-head-common.html","service/radars/decorator","ui-block/button2/button2","ui-block/list-letter-date/list-letter-date","ui-block/list-letter-read-status/list-letter-read-status","ui-block/metathread-avatar/metathread-avatar","ui-block/metathread-badge/metathread-badge","ui-block/metathread-dropdown-actions/metathread-dropdown-actions","ui-block/metathread-head-common/metathread-head-abstract","ui-block/metathread-snippet/metathread-snippet","ui-block/metathread-snippet-tomyself/metathread-snippet-tomyself","ui-block/metathread-title/metathread-title"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var o=A(b);var p=A(c);var q=A(d);var r=A(e);var s=A(f);var t=A(g);var u=A(h);var v=A(i);var w=A(j);var x=A(l);var y=A(m);var z=A(n);function A(a){return a&&a.__esModule?a:{default:a}}exports.default=o.default.Block.extend((0,q.default)({id:"head",events:[{name:"metathreadtogglestatus:unread",rename:function a(b){return(b.is("expanded")?"expanded":"collapsed")+"_"+(b.get("model").is("flags.unread")?"read":"unread")+"_"+b.get("model").getMetathreadFolder()}},"clear","read"]})({name:"metathread-head-common",rootClassName:"mt-h-c",template:p.default,immutable:true,isolate:true,performanceTrace:true,blocks:{button2:r.default,"letter-date":s.default,"metathread-avatar":u.default,"metathread-badge":v.default,"metathread-dropdown-actions":w.default,"metathread-snippet":x.default,"metathread-snippet-tomyself":y.default,"metathread-title":z.default,"read-status":t.default},defaults:{first:false,expanded:false,model:null,"pony-mode":false,selected:false,"short-text":false,"hide-disable-to-myself-metathread":a.HIDE_DISABLE_TO_MYSELF_METATHREAD},notVisualAttributes:{model:true},events:{"metathread:readall":"onMetathreadReadAll","metathread:deleteall":"onMetathreadDeleteAll"},getFolder:k.getFolder,getType:k.getType,getName:k.getName,getNewCount:k.getNewCount,getSenders:k.getSenders,getRemoveButtonText:k.getRemoveButtonText,getMarkAllReadText:k.getMarkAllReadText,hasUnread:k.hasUnread,onMetathreadReadAll:k.onMetathreadReadAll,onMetathreadDeleteAll:k.onMetathreadDeleteAll,rootQaId:k.rootQaId,rootQaState:k.rootQaState}))});define("feast-tpl!app/feast-tpl!ui-block/metathread-head-compact/metathread-head-compact.html",["feast"],function(a){return a.smartParse('<a qa:id="{_this.rootQaId()}" qa:state="collapsed">\n\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="data" value="{attrs.model}"/>\n\t<fn:var name="type" value="{_this.getType()}"/>\n\t<fn:var name="title" value="{_this.getName()}"/>\n\t<fn:var name="new_cnt" value="{_this.getNewCount()}"/>\n\t<fn:var name="isunread" value="{_this.hasUnread()}"/>\n\t<fn:var name="senders" value="{_this.getSenders()}"/>\n\t<fn:var name="ponymode" value="{attrs[\'pony-mode\']}"/>\n\t<fn:var name="avatar_size" value="{_this.getAvatarSize()}"/>\n\n\t\x3c!-- Класс для переходов стрелками и общих стилей для всех элементов списка писем --\x3e\n\t<fn:add-class name="js-letter-list-item"/>\n\n\t<fn:attr name="href" value="{attrs.redirectUrl}" test="attrs.redirectUrl"/>\n\n\t\x3c!-- Mods  --\x3e\n\t<bem:mod name="first" test="attrs.first"/>\n\t<bem:mod name="pony-mode" test="ponymode"/>\n\t<bem:mod name="pony-mode-active" test="ponymode && attrs.selected"/>\n\n\t<bem:mod name="new-selection" test="attrs.newSelection"/>\n\t<bem:mod name="firstSelected" test="attrs.isFirstSelected"/>\n\t<bem:mod name="lastSelected" test="attrs.isLastSelected"/>\n\t<bem:mod name="active" test="attrs.selected"/>\n\n\t\x3c!-- Блок, погнали! --\x3e\n\t<div bem:elem="background">\n\t\t<bem:mod name="active" test="attrs.selected"/>\n\t</div>\n\n\t\x3c!-- Левая колонка элемента --\x3e\n\t<div bem:elem="header">\n\t\t\x3c!-- Значок непрочитанности --\x3e\n\t\t\x3c!-- Read status:Start --\x3e\n\t\t<div bem:elem="read-status" qa:id="unread">\n\t\t\t<b:read-status\n\t\t\t\tdotSize="{attrs.smallUnreadBtn ? \'small\' : \'normal\'}"\n\t\t\t\tstate="{isunread}"\n\t\t\t\tis-forwarded="{false}"\n\t\t\t\tis-replied="{false}"\n\t\t\t\tmodel="{data}"\n\t\t\t\tshift="{ponymode}"\n\t\t\t\tremit:toggle.prevent.stop="metathreadtogglestatus:unread"\n\t\t\t/>\n\t\t</div>\n\t\t\x3c!-- Read status:End --\x3e\n\n\t\t\x3c!-- Иконка метатреда --\x3e\n\t\t\x3c!-- Avatar:Start --\x3e\n\t\t<div bem:elem="avatar" qa:id="avatar">\n\t\t\t<b:metathread-avatar\n\t\t\t\tmodel="{data}"\n\t\t\t\tsize="{avatar_size}"\n\t\t\t\tstate="{attrs.selected}"\n\t\t\t\ttype="{type}"\n\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\tdisable-hover="{attrs.touch}"\n\t\t\t\tremit:toggle="avatar"\n\t\t\t/>\n\t\t</div>\n\t\t\x3c!-- Avatar:End --\x3e\n\t</div>\n\n\t\x3c!-- Содержимое элемента --\x3e\n\t\x3c!-- Content:Start --\x3e\n\t<div bem:elem="content" ref="content">\n\t\t\x3c!-- Row:Start --\x3e\n\t\t<div bem:elem="row" bem:mod="1">\n\t\t\t\x3c!-- Название папки метатреда --\x3e\n\t\t\t\x3c!-- Title:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="item"\n\t\t\t\tbem:mod="title"\n\t\t\t\tqa:id="title">\n\t\t\t\t<b:metathread-title\n\t\t\t\t\ttitle="{title}"\n\t\t\t\t\ttype="{type}"\n\t\t\t\t\tunread="{isunread}"\n\t\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t\x3c!-- Время отправки последнего письма в папке --\x3e\n\t\t\t\x3c!-- Date:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="item"\n\t\t\t\tbem:mod="date"\n\t\t\t\tqa:id="date">\n\t\t\t\t<b:letter-date date="{data.get(\'date\')}"/>\n\t\t\t</div>\n\t\t\t\x3c!-- Date:End --\x3e\n\t\t</div>\n\t\t\x3c!-- Row:End --\x3e\n\n\t\t\x3c!-- Row:Start --\x3e\n\t\t<div bem:elem="row" bem:mod="2">\n\t\t\t\x3c!-- Список отправителей последних писем --\x3e\n\t\t\t\x3c!-- Snippet:Start --\x3e\n\t\t\t<div\n\t\t\t\tbem:elem="item"\n\t\t\t\tbem:mod="snippet"\n\t\t\t\tqa:id="snippet"\n\t\t\t\ttitle="{_this.getSendersTooltip(senders, data.isToMyself() ? \'subject\' : \'name\')}"\n\t\t\t>\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="data.isToMyself()">\n\t\t\t\t\t\t<b:metathread-snippet-tomyself senders="{senders}" compact />\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<b:metathread-snippet senders="{senders}" />\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</div>\n\t\t\t\x3c!-- Snippet:End --\x3e\n\n\t\t\t\x3c!-- Количество новых писем в треде: NEW --\x3e\n\t\t\t\x3c!-- Badge:Start --\x3e\n\t\t\t<div\n\t\t\t\tfn:if="new_cnt"\n\t\t\t\tbem:elem="item"\n\t\t\t\tbem:mod="new_cnt"\n\t\t\t\tqa:id="new_cnt">\n\t\t\t\t<b:metathread-badge counter="{new_cnt}"/>\n\t\t\t</div>\n\t\t\t\x3c!-- Badge:End --\x3e\n\t\t</div>\n\t\t\x3c!-- Row:End --\x3e\n\t\t\x3c!-- Toolbar: End --\x3e\n\t</div>\n\t\x3c!-- Content:End --\x3e\n</a>\n',"app/feast-tpl!ui-block/metathread-head-compact/metathread-head-compact.html")});define("feast-tpl!ui-block/metathread-head-compact/metathread-head-compact.html",["feast-tpl!app/feast-tpl!ui-block/metathread-head-compact/metathread-head-compact.html"],function(a){return a});define("ui-block/metathread-head-compact/metathread-head-compact",["exports","feast","feast-tpl!./metathread-head-compact.html","service/radars/decorator","ui-block/list-letter-date/list-letter-date","ui-block/list-letter-read-status/list-letter-read-status","ui-block/metathread-avatar/metathread-avatar","ui-block/metathread-badge/metathread-badge","ui-block/metathread-head-common/metathread-head-abstract","ui-block/metathread-snippet/metathread-snippet","ui-block/metathread-snippet-tomyself/metathread-snippet-tomyself","ui-block/metathread-title/metathread-title","service/emoji"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var m=w(a);var n=w(b);var o=w(c);var p=w(d);var q=w(e);var r=w(f);var s=w(g);var t=w(i);var u=w(j);var v=w(k);function w(a){return a&&a.__esModule?a:{default:a}}exports.default=m.default.Block.extend((0,o.default)({id:"item-metathread",events:["clickavatar","togglestatus:unread","remove"]})({name:"metathread-head-compact",rootClassName:"mt-h-compact",template:n.default,immutable:true,isolate:true,performanceTrace:true,blocks:{"letter-date":p.default,"metathread-avatar":r.default,"metathread-badge":s.default,"metathread-snippet":t.default,"metathread-snippet-tomyself":u.default,"metathread-title":v.default,"read-status":q.default},defaults:{first:false,model:null,"pony-mode":false,selected:false},notVisualAttributes:{model:true},events:{"metathread:readall":"onMetathreadReadAll","metathread:deleteall":"onMetathreadDeleteAll"},didMount:function a(){(0,l.emojiFallback)(this.refs.content,"mhc")},didUpdate:function a(){(0,l.emojiFallback)(this.refs.content,"mhc")},getFolder:h.getFolder,getType:h.getType,getName:h.getName,getNewCount:h.getNewCount,getSenders:h.getSenders,getSendersTooltip:h.getSendersTooltip,getRemoveButtonText:h.getRemoveButtonText,getMarkAllReadText:h.getMarkAllReadText,hasUnread:h.hasUnread,onMetathreadReadAll:h.onMetathreadReadAll,onMetathreadDeleteAll:h.onMetathreadDeleteAll,rootQaId:h.rootQaId,rootQaState:h.rootQaState,getAvatarSize:function a(){if(this.is("pony-mode")){return"common"}return"compact"}}))});define("feast-tpl!app/feast-tpl!ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded.html",["feast"],function(a){return a.smartParse('<a qa:id="{_this.rootQaId()}" qa:state="expanded">\n\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="data" value="{attrs.model}"/>\n\t<fn:var name="type" value="{_this.getType()}"/>\n\t<fn:var name="title" value="{_this.getName()}"/>\n\t<fn:var name="isunread" value="{_this.hasUnread()}"/>\n\t<fn:var name="ponymode" value="{attrs[\'pony-mode\']}"/>\n\t<fn:var name="sticky" value="{attrs.sticky}"/>\n\t<fn:var name="isShortDropdown" value="{attrs[\'short-dropdown\']}"/>\n\n\t\x3c!-- Класс для переходов стрелками и общих стилей для всех элементов списка писем --\x3e\n\t<fn:add-class name="js-letter-list-item"/>\n\n\t<fn:attr name="href" value="{attrs.redirectUrl}" test="attrs.redirectUrl"/>\n\n\t\x3c!-- Mods  --\x3e\n\t<bem:mod name="first" test="attrs.first"/>\n\t<bem:mod name="pony-mode" test="ponymode"/>\n\t<bem:mod name="sticky" test="sticky"/>\n\t<bem:mod name="not-sticky" test="!sticky"/>\n\n\t<bem:mod name="new-selection" test="attrs.newSelection"/>\n\t<bem:mod name="firstSelected" test="attrs.isFirstSelected"/>\n\t<bem:mod name="lastSelected" test="attrs.isLastSelected"/>\n\t<bem:mod name="active" test="attrs.selected"/>\n\n\t\x3c!-- Блок, погнали! --\x3e\n\t<div bem:elem="background">\n\t\t<bem:mod name="active" test="attrs.selected"/>\n\t</div>\n\n\t\x3c!-- Значок непрочитанности --\x3e\n\t\x3c!-- Read status:Start --\x3e\n\t<div bem:elem="read-status" qa:id="unread">\n\t\t<b:read-status\n\t\t\tdotSize="{attrs.smallUnreadBtn ? \'small\' : \'normal\'}"\n\t\t\tstate="{isunread}"\n\t\t\tis-forwarded="{false}"\n\t\t\tis-replied="{false}"\n\t\t\tmodel="{data}"\n\t\t\tshift="{ponymode}"\n\t\t\tremit:toggle.prevent.stop="metathreadtogglestatus:unread"\n\t\t/>\n\t</div>\n\t\x3c!-- Read status:End --\x3e\n\n\t\x3c!-- Иконка метатреда --\x3e\n\t\x3c!-- Avatar:Start --\x3e\n\t<div bem:elem="avatar" qa:id="avatar">\n\t\t<b:metathread-avatar\n\t\t\tcentered\n\t\t\tmodel="{data}"\n\t\t\tsize="common"\n\t\t\tstate="{attrs.selected}"\n\t\t\ttype="{type}"\n\t\t\ttouch="{attrs.touch}"\n\t\t\tremit:toggle="avatar"\n\t\t/>\n\t</div>\n\t\x3c!-- Avatar:End --\x3e\n\n\t<div bem:elem="content">\n\t\t\x3c!-- Название папки метатреда --\x3e\n\t\t\x3c!-- Title:Start --\x3e\n\t\t<div\n\t\t\tbem:elem="item"\n\t\t\tbem:mode="title"\n\t\t\tqa:id="title">\n\t\t\t<b:metathread-title\n\t\t\t\ttitle="{title}"\n\t\t\t\ttype="{type}"\n\t\t\t\tunread="{isunread}"\n\t\t\t\tpony-mode="{ponymode}"\n\t\t\t/>\n\t\t</div>\n\t\t\x3c!-- Title:End --\x3e\n\n\t\t\x3c!-- Ещё --\x3e\n\t\t\x3c!-- More:Start --\x3e\n\t\t<div\n\t\t\tbem:elem="item"\n\t\t\tbem:mod="more"\n\t\t\tqa:id="more"\n\t\t\tremit:click.prevent.stop\n\t\t>\n\n\t\t\t<b:metathread-dropdown-actions\n\t\t\t\tcompact="{isShortDropdown}"\n\t\t\t\tdeleteall="{!data.isToMyself() && !attrs[\'has-selected\']}"\n\t\t\t\tmodel="{data}"\n\t\t\t\tpony-mode="{ponymode}"\n\t\t\t\treadall="{isunread && !attrs[\'has-selected\']}"\n\t\t\t\tcleanmaster="{!data.isToMyself() && !attrs.mobile}"\n\t\t\t\tdisable="{data.isToMyself() && !attrs[\'hide-disable-to-myself-metathread\']}"\n\n\t\t\t\tremit:cleanmaster="cleanmaster"\n\t\t\t\tremit:deleteall="metathread:deleteall"\n\t\t\t\tremit:navigate="link"\n\t\t\t\tremit:readall="metathread:readall"\n\t\t\t\tremit:disable="disable"\n\t\t\t/>\n\t\t</div>\n\t\t\x3c!-- More:End --\x3e\n\t</div>\n</a>\n',"app/feast-tpl!ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded.html")});define("feast-tpl!ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded.html",["feast-tpl!app/feast-tpl!ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded.html"],function(a){return a});define("ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded",["exports","default-values","feast","feast-tpl!./metathread-head-compact-expanded.html","service/radars/decorator","ui-block/list-letter-read-status/list-letter-read-status","ui-block/metathread-avatar/metathread-avatar","ui-block/metathread-dropdown-actions/metathread-dropdown-actions","ui-block/metathread-head-common/metathread-head-abstract","ui-block/metathread-title/metathread-title"],function(exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var j=q(b);var k=q(c);var l=q(d);var m=q(e);var n=q(f);var o=q(g);var p=q(i);function q(a){return a&&a.__esModule?a:{default:a}}exports.default=j.default.Block.extend((0,l.default)({id:"item-metathread",events:["clickavatar","togglestatus:unread","remove"]})({name:"metathread-head-compact-expanded",rootClassName:"mt-h-compact-expanded",template:k.default,immutable:true,isolate:true,performanceTrace:true,blocks:{"metathread-avatar":n.default,"metathread-dropdown-actions":o.default,"metathread-title":p.default,"read-status":m.default},defaults:{first:false,model:null,"pony-mode":false,selected:false,"short-dropdown":false,"hide-disable-to-myself-metathread":a.HIDE_DISABLE_TO_MYSELF_METATHREAD},notVisualAttributes:{model:true},events:{"metathread:readall":"onMetathreadReadAll","metathread:deleteall":"onMetathreadDeleteAll"},getFolder:h.getFolder,getType:h.getType,getName:h.getName,hasUnread:h.hasUnread,onMetathreadReadAll:h.onMetathreadReadAll,onMetathreadDeleteAll:h.onMetathreadDeleteAll,rootQaId:h.rootQaId,rootQaState:h.rootQaState}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/metathread/metathread",["require","exports","@mail/xray","data-source/actions","default-values","feast","feast-tpl!./metathread.html","helpers/browser","helpers/data-source-dispatch","helpers/keys","mail/Folder","service/radars/decorator","service/secure-folder","ui-block/delimeter/delimeter","ui-block/metathread-head-common/metathread-head-common","ui-block/metathread-head-compact/metathread-head-compact","ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.block=void 0;a=__importDefault(a);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);exports.block={name:"metathread",template:e.default,performanceTrace:"track",isolateEvents:false,mods:{},blocks:{delimeter:l.default,"metathread-head-common":m.default,"metathread-head-compact":n.default,"metathread-head-compact-expanded":o.default},defaults:{compact:false,expanded:false,first:false,model:null,ponymode:false,selected:false,"short-dropdown":false,"short-text":false,sticky:false,redirectExp:c.METATHREAD_REDIRECT},events:{"click:metathread-item":"onMetathreadItemClick",scrollintoself:"scrollIntoSelf"},onMetathreadItemClick:function(d){var e=this;var f,h,i;if(d.isDefaultPrevented()||d.isPropagationStopped()){return}var j=this.get("model");var k=(f=d===null||d===void 0?void 0:d.details)===null||f===void 0?void 0:f.getMetathreadFolder();if(!j.isExpanded()&&k!=null){a.default.send("letter-metathread-open",{dwh:{folder:j.getMetathreadFolderName(),folderID:k,ponymode:((h=this.props)===null||h===void 0?void 0:h.compact)||((i=this.attrs)===null||i===void 0?void 0:i.compact)?"3pane":"2pane"}})}if(c.METATHREAD_REDIRECT){this.onMetathreadItemClickRedirect(d);return}if(this.is("sticky")){this.scrollIntoSelf();return}(0,g.default)({type:b.TOGGLE_METATHREAD,state:!j.isExpanded(),uid:undefined,model:j}).then(function(){var b,c;var d=!j.isExpanded()?"collapse":"expanded";a.default.send("letter-metathread-".concat(d),{dwh:{folder:j.getMetathreadFolderName(),folderID:k,ponymode:((b=e.props)===null||b===void 0?void 0:b.compact)||((c=e.attrs)===null||c===void 0?void 0:c.compact)?"3pane":"2pane"}})});this.broadcast("expand:toggle")},onMetathreadItemClickRedirect:function(b){var c=this;var d;var e=(d=b===null||b===void 0?void 0:b.details)===null||d===void 0?void 0:d.getMetathreadFolder();a.default.send("metathread-redirect",{dwh:{folder:e}});var f=b.originalEvent;if(f&&(0,h.isNewTabClick)(f)){return}var g=this.get("router");if(!g){return}b.preventDefault();i.default.findOne(e).then(function(a){(a.isSecureOpen()?Promise.resolve(true):(0,k.default)(a)).then(function(a){if(!a){return}g.nav(c.getUrl());c.broadcast("navigate:with:back:to:parent",{id:"#letters",params:{folder:e}})})})},getUrl:function(){var a=this.get("router");if(!a){return null}var b=this.get("model").getMetathreadFolder();return a.getUrl("#letters",{folder:b},c.METATHREAD_BACK_TO_INBOX&&{"to-parent-button":"1"})},scrollIntoSelf:function(){this.broadcast("scrollintomodel",{index:this.get("index")})},getMetathreadId:function(){return this.get("model").getMetathreadFolder()},isStickyEnabled:function(){return!c.IS_NATIVE_STICKY_DISABLED&&f.default.capabilities["sticky-support"]}};exports.default=d.default.Block.extend((0,j.default)({events:[{name:"click:metathreadavatar",rename:function(a){return(a.is("selected")?"deselect_":"select_")+a.getMetathreadId()}},{name:"click:cleanmaster",rename:function(a){return"contextmenu_cleanmaster_".concat(a.getMetathreadId())}},{name:"click:metathread-link",rename:function(a){return"contextmenu_folder_".concat(a.getMetathreadId())}},{name:"click:metathread-item",rename:function(a){return(a.is("compact")?"3pane":"2pane")+"_"+(a.get("model").isExpanded()?"collapse":"expand")+"_"+a.getMetathreadId()}},{name:"scrollintomodel",rename:"scroll-to-sticky"}]})(exports.block))});define("feast-tpl!app/feast-tpl!ui-block/metathread-footer/metathread-footer.html",["feast"],function(a){return a.smartParse('<div>\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="metathread" value="{attrs.model.get(\'metathread\')}"/>\n\t<fn:var name="folderId" value="{metathread.getMetathreadFolder()}"/>\n\t<fn:var name="folderName" value="{metathread.getMetathreadFolderName()}"/>\n\t\x3c!-- Поддержана ли "Загрузить ещё"? --\x3e\n\t<fn:var name="canLoadMore" value="{_this.canLoadMore()}"/>\n\n\t\x3c!-- Content --\x3e\n\t<div bem:elem="folder">\n\t\t<bem:mod name="ponymode" test="attrs.ponymode"/>\n\n\t\t<fn:choose>\n\t\t\t<fn:when test="canLoadMore">\n\t\t\t\t<b:link\n\t\t\t\t\t\tqa:id="more-link"\n\t\t\t\t\t\ttext="{i18n(\'Загрузить ещё\')}"\n\t\t\t\t\t\tremit:click.prevent="more-link-click"\n\t\t\t\t/>\n\t\t\t</fn:when>\n\n\t\t\t<fn:otherwise>\n\t\t\t\t<b:link\n\t\t\t\t\t\tqa:id="folder-link"\n\t\t\t\t\t\thref="{_this.getLinkHref()}"\n\t\t\t\t\t\ttext="{_this.getGoToFolderText()}"\n\t\t\t\t\t\tunsafe\n\t\t\t\t\t\tremit:click="folder-link-click"\n\t\t\t\t/>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</div>\n\n\t\x3c!-- Разделитель между футером метатреда и списком писем под ним --\x3e\n\t<div bem:elem="spacer"\n\t\t qa:id="metathread-spacer-after:folder:{folderId}"\n\t\t fn:if="!attrs[\'hide-footer-spacer\']">\n\t</div>\n\n\t\x3c!-- Верхний бордер --\x3e\n\t<b:delimeter ponymode="{ponymode}" compact="{attrs.compact}" indent/>\n</div>\n',"app/feast-tpl!ui-block/metathread-footer/metathread-footer.html")});define("feast-tpl!ui-block/metathread-footer/metathread-footer.html",["feast-tpl!app/feast-tpl!ui-block/metathread-footer/metathread-footer.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/metathread-footer/metathread-footer",["require","exports","data-source/actions","default-values","feast","feast-tpl!./metathread-footer.html","helpers/data-source-dispatch","pilotjs","service/radars/decorator","ui-block/delimeter/delimeter","ui-block/link/link"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);exports.default=c.default.Block.extend((0,g.default)({id:"metathread-footer",events:[{name:"more-link-click",rename:function(a){return"load-more_"+a.getMetathreadId()}},{name:"folder-link-click",rename:function(a){return"folder_"+a.getMetathreadId()}}]})({name:"metathread-footer",template:d.default,blocks:{delimeter:h.default,link:i.default},defaults:{model:null,ponymode:false,router:null,"short-text":false},events:{"more-link-click":"handleLoadMoreClick"},constructor:function(){c.default.Block.apply(this,arguments);this.renderFromModel=this.renderFromModel.bind(this)},renderFromModel:function(){this.render()},didMount:function(){var a;(a=this.get("model").get("metathread"))===null||a===void 0?void 0:a.on("change",this.renderFromModel)},didUnmount:function(){var a;(a=this.get("model").get("metathread"))===null||a===void 0?void 0:a.off("change",this.renderFromModel)},handleLoadMoreClick:function(){(0,e.default)({type:a.LOAD_MORE_METATHREAD,model:this.get("model").get("metathread"),priority:f.default.Loader.PRIORITY_LOW,uid:undefined})},canLoadMore:function(){var a=this.get("model").get("metathread");if(a.isLimitReached()){return false}var c=a.getLimit();var d=Math.ceil(c/b.METATHREAD_LIMIT);return d<b.METATHREAD_LOAD_MORE_COUNT_MAX},getLinkHref:function(){var a=this.get("router");return a.getUrl("#letters",{folder:this.getMetathreadId()})},getGoToFolderText:function(){var a=i18n("Перейти в папку");if(this.is("short-text")){return a}var b=this.get("model").get("metathread").getMetathreadFolderName();return a+" «".concat(b,"»")},getMetathreadId:function(){return this.get("model").get("metathread").getMetathreadFolder()}}))});define("feast-tpl!app/feast-tpl!ui-block/octopus/octopus.html",["feast"],function(a){return a.smartParse('<div qa:id="octopus">\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\t<bem:mod name="isHorizontal" test="attrs.isHorizontal"/>\n\t<fn:var name="type" value="{_this.getType()}"/>\n\t<fn:var name="messages" value="{_this.getMessages()}"/>\n\t<fn:var name="noSearchMessages" value="{_this.getNoSearchMessages()}"/>\n\t<fn:var name="placeholder" value="{_this.getCurrentPlaceholder()}" />\n\t<fn:var name="isLoadedTheme" value="{attrs.isLoadedTheme}" />\n\t<fn:var name="folderId" value="{isNoSelect ? attrs.model.folder.id : attrs.folder.id}" />\n\t<fn:var name="wasClickedSearchInExcludedFoldersButton" value="{attrs[\'show-search-in-excluded-folders\'] && attrs[\'search-has-operands\']}" />\n\n\t<fn:var name="isNewDesign" value="{_this.isNewDesign()}" />\n\t<fn:var name="is3Pane" value="{attrs.is3Pane}" />\n\t<fn:var name="isPonyMode" value="{attrs.ponymode}" />\n\t<fn:var name="isDefaultTheme" value="{_this.isDefaultTheme()}" />\n\t<fn:var name="isLightColorTheme" value="{attrs.isLightColorTheme}" />\n\t<fn:var name="isVK" value="{_this.isVK()}" />\n\n\t<fn:var name="isShareTake" value="{_this.isShareTake()}" />\n\t<fn:var name="isShareGive" value="{_this.isShareGive()}" />\n\n\t<fn:var name="emptyStateType" value="{_this.getEmptyStateType()}" />\n\t<fn:var name="isInboxFolder" value="{attrs.model.folder.id === \'0\'}" />\n\t<fn:var name="isEmptyFolder" value="{type === \'empty-folder\'}" />\n\t<fn:var name="isEmptyInboxFolder" value="{type === \'empty-inbox-folder\'}" />\n\t<fn:var name="isTrashFolder" value="{type === \'trash\'}" />\n\t<fn:var name="isSpamFolder" value="{type === \'spam\'}" />\n\t<fn:var name="isNoDraftsFolder" value="{type === \'no-drafts\'}" />\n\t<fn:var name="isNoTemplatesFolder" value="{type === \'no-templates\'}" />\n\t<fn:var name="isNoSearch" value="{type === \'no-search\'}" />\n\t<fn:var name="isNoSelect" value="{type === \'no-select\'}" />\n\t<fn:var name="isSecureFolder" value="{type === \'secure-folder\'}" />\n\t<fn:var name="isSecureSearch" value="{type === \'secure-search\'}" />\n\t<fn:var name="isNoLetter" value="{type === \'no-letter\'}" />\n\n\t<fn:var name="isOldPlaceholder" value="{placeholder === \'old\'}" />\n\t<fn:var name="isOldTwoBtnPlaceholder" value="{placeholder === \'oldTwoBtn\'}" />\n\t<fn:var name="isNewPlaceholder" value="{placeholder === \'new\'}" />\n\t<fn:var name="isNewTwoBtnPlaceholder" value="{placeholder === \'newTwoBtn\'}" />\n\n\t<fn:match name="newGoToInbox">\n\t\t<b:button2\n\t\t\ttouch="{attrs.mobile}"\n\t\t\tcenter\n\t\t\tremit:click.prevent="goToInbox"\n\t\t\tevent:details="{folderId: folderId}"\n\t\t\ttext="{i18n(\'Перейти во входящие\')}"\n\t\t\tnowrap\n\t\t\ttext-overflow\n\t\t/>\n\t</fn:match>\n\t<fn:match name="oldGoToInbox">\n\t\t<b:link\n\t\t\tcontrast\n\t\t\tremit:click.prevent="goToInbox"\n\t\t\tevent:details="{folderId: folderId}"\n\t\t\ttext="{i18n(\'Перейти во входящие\')}"\n\t\t/>\n\t</fn:match>\n\n\n\t<bem:mod name="compact" test="isNoSelect"/>\n\t<bem:mod name="full" test="!isNoSelect"/>\n\t<bem:mod name="full-height" test="attrs[\'full-height\']"/>\n\t<bem:mod name="transparent" test="attrs.transparent"/>\n\t<bem:mod name="fixed" test="attrs.fixed"/>\n\n\t<fn:if test="!attrs.mobile || !attrs.isHorizontal">\n\t\t<div bem:elem="icon" qa:id="{type}:icon">\n\t\t\t<bem:mod name="{type}"/>\n\t\t\t<bem:mod name="default-theme" test="isNewDesign && isDefaultTheme"/>\n\t\t\t<bem:mod name="color-theme" test="isNewDesign && !isDefaultTheme"/>\n\t\t\t<bem:mod name="new-design" test="isNewDesign"/>\n\t\t\t<fn:attr name="style" value="background-image: url({_this.getIcon()});"\n\t\t\t\t\t test="isLoadedTheme && !isNewDesign"/>\n\t\t\t<fn:if test="isLoadedTheme && !isVK && isNewDesign && isDefaultTheme">\n\t\t\t\t<fn:attr name="style" value="background-image: url({_this.getIcon()});"/>\n\t\t\t</fn:if>\n\t\t\t<fn:if test="isLoadedTheme && !isVK && isNewDesign && !isDefaultTheme">\n\t\t\t\t<b:react-async\n\t\t\t\t\tcomponent="OctopusLogo"\n\t\t\t\t\temptyStateType="{emptyStateType}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:if>\n\n\t<div bem:elem="text" qa:id="{type}:text">\n\t\t<bem:mod name="new-design" test="isNewDesign"/>\n\t\t<bem:mod name="color-theme" test="!isDefaultTheme"/>\n\t\t<bem:mod name="default-theme" test="isDefaultTheme"/>\n\t\t<bem:mod name="light-color-theme" test="isLightColorTheme"/>\n\t\t<bem:mod name="old-two-btn" test="isOldTwoBtnPlaceholder"/>\n\t\t<bem:mod name="3pane" test="is3Pane"/>\n\t\t<bem:mod name="pony-mode" test="isPonyMode"/>\n\t\t<bem:mod name="share-take" test="isNewDesign && isShareTake"/>\n\t\t<fn:choose>\n\t\t\t<fn:when test="isEmptyInboxFolder">\n\t\t\t\t<fn:if test="isOldPlaceholder || isOldTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'Писем нет\')}\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewPlaceholder || isNewTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t{i18n(\'Писем нет\')}\n\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="isEmptyFolder">\n\t\t\t\t<fn:if test="isOldPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t<bem:mod name="new-design" test="isNewDesign"/>\n\t\t\t\t\t\t{i18n(\'В папке нет писем\')}\n\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<b:link\n\t\t\t\t\t\t\tcontrast\n\t\t\t\t\t\t\tfn:if="_this.shouldDisplayFilter()"\n\t\t\t\t\t\t\tremit:click.prevent="settingsfilters:create"\n\t\t\t\t\t\t\tevent:details="{models: [], folder: attrs.folder.id}"\n\t\t\t\t\t\t\ttext="{i18n(\'Создать фильтр\')}"\n\t\t\t\t\t\t\tqa:id="create-filter"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isOldTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t<bem:mod name="new-design" test="isNewDesign"/>\n\t\t\t\t\t\t{i18n(\'В папке нет писем\')}\n\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<bem:mod name="old-design-two-buttons"/>\n\t\t\t\t\t\t<fn:apply-match name="oldGoToInbox"/>\n\t\t\t\t\t\t<b:link\n\t\t\t\t\t\t\tcontrast\n\t\t\t\t\t\t\tfn:if="_this.shouldDisplayFilter()"\n\t\t\t\t\t\t\tremit:click.prevent="settingsfilters:create"\n\t\t\t\t\t\t\tevent:details="{models: [], folder: attrs.folder.id}"\n\t\t\t\t\t\t\ttext="{i18n(\'Создать фильтр\')}"\n\t\t\t\t\t\t\tqa:id="create-filter"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t<bem:mod name="new-design" test="isNewDesign"/>\n\t\t\t\t\t\t{i18n(\'В папке нет писем\')}\n\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t\t\t\tcenter\n\t\t\t\t\t\t\tfn:if="_this.shouldDisplayFilter()"\n\t\t\t\t\t\t\tremit:click.prevent="settingsfilters:create"\n\t\t\t\t\t\t\tevent:details="{models: [], folder: attrs.folder.id}"\n\t\t\t\t\t\t\ttext="{i18n(\'Создать фильтр\')}"\n\t\t\t\t\t\t\tqa:id="create-filter"\n\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t\t\ttext-overflow\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t<bem:mod name="new-design" test="isNewDesign"/>\n\t\t\t\t\t\t{i18n(\'В папке нет писем\')}\n\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="multi-items-line">\n\t\t\t\t\t\t\t<bem:mod name="center" test="!_this.shouldDisplayFilter()"/>\n\t\t\t\t\t\t\t<fn:apply-match name="newGoToInbox"/>\n\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t\t\t\t\tcenter\n\t\t\t\t\t\t\t\tfn:if="_this.shouldDisplayFilter()"\n\t\t\t\t\t\t\t\tremit:click.prevent="settingsfilters:create"\n\t\t\t\t\t\t\t\tevent:details="{models: [], folder: attrs.folder.id}"\n\t\t\t\t\t\t\t\ttext="{i18n(\'Создать фильтр\')}"\n\t\t\t\t\t\t\t\tqa:id="create-filter"\n\t\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t\t\t\ttext-overflow\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="isTrashFolder">\n\t\t\t\t<fn:if test="isOldPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'В корзине пусто\')}\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isOldTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'В корзине пусто\')}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<fn:apply-match name="oldGoToInbox"/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'В корзине пусто\')}\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'В корзине пусто\')}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<fn:apply-match name="newGoToInbox"/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="isSpamFolder">\n\t\t\t\t<fn:if test="isOldPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t<fn:value output="raw">messages.noSpam</fn:value>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isOldTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t<fn:value output="raw">messages.noSpam</fn:value>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<fn:apply-match name="oldGoToInbox"/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t<fn:value output="raw">i18n(\'В почте нет спама\')</fn:value>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t<fn:value output="raw">i18n(\'В почте нет спама\')</fn:value>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<fn:apply-match name="newGoToInbox"/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="isNoDraftsFolder">\n\t\t\t\t<fn:if test="isOldPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t<fn:value output="raw">messages.noDrafts</fn:value>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isOldTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t<fn:value output="raw">messages.noDrafts</fn:value>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<fn:apply-match name="oldGoToInbox"/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t{i18n(\'Папка «Черновики» пуста\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="subtitle">\n\t\t\t\t\t\t\t{i18n(\'У вас нет незаконченных или неотправленных писем\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t<bem:mod name="with-subtitle" />\n\t\t\t\t\t\t\t{i18n(\'Папка «Черновики» пуста\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="subtitle">\n\n\t\t\t\t\t\t\t{i18n(\'У вас нет незаконченных или неотправленных писем\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<fn:apply-match name="newGoToInbox"/>\n\t\t\t\t</fn:if>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="isNoTemplatesFolder">\n\t\t\t\t<fn:if test="isOldPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t{i18n(\'У вас нет шаблонов писем\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<b:link\n\t\t\t\t\t\t\tcontrast\n\t\t\t\t\t\t\tremit:click.prevent="compose:new"\n\t\t\t\t\t\t\ttext="{i18n(\'Создать шаблон\')}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isOldTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t{i18n(\'У вас нет шаблонов писем\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<bem:mod name="old-design-two-buttons"/>\n\t\t\t\t\t\t<fn:apply-match name="oldGoToInbox"/>\n\t\t\t\t\t\t<b:link\n\t\t\t\t\t\t\tcontrast\n\t\t\t\t\t\t\tremit:click.prevent="compose:new"\n\t\t\t\t\t\t\ttext="{i18n(\'Создать шаблон\')}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t{i18n(\'У вас нет шаблонов писем\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t\t\t\tcenter\n\t\t\t\t\t\t\tremit:click.prevent="compose:new"\n\t\t\t\t\t\t\ttext="{i18n(\'Создать шаблон\')}"\n\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t\t\ttext-overflow\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t{i18n(\'У вас нет шаблонов писем\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="multi-items-line">\n\t\t\t\t\t\t\t<fn:apply-match name="newGoToInbox"/>\n\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t\t\t\t\tcenter\n\t\t\t\t\t\t\t\tremit:click.prevent="compose:new"\n\t\t\t\t\t\t\t\ttext="{i18n(\'Создать шаблон\')}"\n\t\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t\t\t\ttext-overflow\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="isNoSearch">\n\t\t\t\t<fn:if test="isOldPlaceholder || isOldTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t{i18n(\'По вашему запросу ничего не найдено\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<fn:if test="wasClickedSearchInExcludedFoldersButton">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<b:link\n\t\t\t\t\t\t\t\tcontrast\n\t\t\t\t\t\t\t\tremit:click.prevent="search:set-in-excluded-folders"\n\t\t\t\t\t\t\t\tevent:details="true"\n\t\t\t\t\t\t\t\ttext="{i18n(\'Искать в папках «Спам» и «Корзина»\')}"\n\t\t\t\t\t\t\t\tqa:id="search-octopus-enable-in-excluded-folders"\n\t\t\t\t\t\t\t\thref="{attrs[\'search-in-excluded-folders-url\']}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t<bem:mod name="with-subtitle" test="wasClickedSearchInExcludedFoldersButton"/>\n\t\t\t\t\t\t\t<fn:value output="raw">noSearchMessages.title</fn:value>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<fn:if test="wasClickedSearchInExcludedFoldersButton">\n\t\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t\t<span bem:elem="subtitle">\n\t\t\t\t\t\t\t\t<fn:value output="raw">noSearchMessages.subtitle</fn:value>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t\t\t\tcenter\n\t\t\t\t\t\t\tremit:click.prevent="search:set-in-excluded-folders"\n\t\t\t\t\t\t\tevent:details="true"\n\t\t\t\t\t\t\ttext="{i18n(\'Искать\')}"\n\t\t\t\t\t\t\tqa:id="search-octopus-enable-in-excluded-folders"\n\t\t\t\t\t\t\thref="{attrs[\'search-in-excluded-folders-url\']}"\n\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t\t\ttext-overflow\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t<bem:mod name="with-subtitle" test="wasClickedSearchInExcludedFoldersButton"/>\n\t\t\t\t\t\t\t<fn:value output="raw">noSearchMessages.title</fn:value>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<fn:if test="wasClickedSearchInExcludedFoldersButton">\n\t\t\t\t\t\t\t<span bem:elem="subtitle">\n\t\t\t\t\t\t\t\t<fn:value output="raw">noSearchMessages.subtitle</fn:value>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="multi-items-line">\n\t\t\t\t\t\t<bem:mod name="center" test="!wasClickedSearchInExcludedFoldersButton"/>\n\t\t\t\t\t\t<fn:apply-match name="newGoToInbox"/>\n\t\t\t\t\t\t<fn:if test="wasClickedSearchInExcludedFoldersButton">\n\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t\t\t\t\tcenter\n\t\t\t\t\t\t\t\tremit:click.prevent="search:set-in-excluded-folders"\n\t\t\t\t\t\t\t\tevent:details="true"\n\t\t\t\t\t\t\t\ttext="{i18n(\'Искать\')}"\n\t\t\t\t\t\t\t\tqa:id="search-octopus-enable-in-excluded-folders"\n\t\t\t\t\t\t\t\thref="{attrs[\'search-in-excluded-folders-url\']}"\n\t\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t\t\t\ttext-overflow\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="isNoSelect">\n\t\t\t\t<fn:if test="isOldPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'Письма не выбраны\')}\n\t\t\t\t\t</span>\n\t\t\t\t\t<fn:if\n\t\t\t\t\t\ttest="_this.isAllreadButtonVisible()  && !attrs[\'read-all-in-progress\']">\n\t\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t\t<b:link\n\t\t\t\t\t\t\t\tcontrast\n\t\t\t\t\t\t\t\tremit:click.prevent="mark:allreaded"\n\t\t\t\t\t\t\t\ttext="{i18n(\'Отметить все письма прочитанными\')}"\n\t\t\t\t\t\t\t\tqa:id="mark-all-readed"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isOldTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'Письма не выбраны\')}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<bem:mod name="old-design-two-buttons"/>\n\t\t\t\t\t\t<fn:if test="!isInboxFolder">\n\t\t\t\t\t\t\t<fn:apply-match name="oldGoToInbox"/>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t<fn:if\n\t\t\t\t\t\t\ttest="_this.isAllreadButtonVisible()  && !attrs[\'read-all-in-progress\']">\n\t\t\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t\t\t<b:link\n\t\t\t\t\t\t\t\t\tcontrast\n\t\t\t\t\t\t\t\t\tremit:click.prevent="mark:allreaded"\n\t\t\t\t\t\t\t\t\ttext="{i18n(\'Отметить все письма прочитанными\')}"\n\t\t\t\t\t\t\t\t\tqa:id="mark-all-readed"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'Письма не выбраны\')}\n\t\t\t\t\t</span>\n\t\t\t\t\t<fn:if\n\t\t\t\t\t\ttest="_this.isAllreadButtonVisible()  && !attrs[\'read-all-in-progress\']">\n\t\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t\t\t\t\tcenter\n\t\t\t\t\t\t\t\tremit:click.prevent="mark:allreaded"\n\t\t\t\t\t\t\t\ttext="{i18n(\'Отметить все письма прочитанными\')}"\n\t\t\t\t\t\t\t\tqa:id="mark-all-readed"\n\t\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t\t\t\ttext-overflow\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'Письма не выбраны\')}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="multi-items-line">\n\t\t\t\t\t\t\t<fn:if test="!isInboxFolder">\n\t\t\t\t\t\t\t\t<fn:apply-match name="newGoToInbox"/>\n\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t<fn:if\n\t\t\t\t\t\t\ttest="_this.isAllreadButtonVisible()  && !attrs[\'read-all-in-progress\']">\n\t\t\t\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t\t\t\t\t\t\tcenter\n\t\t\t\t\t\t\t\t\t\tremit:click.prevent="mark:allreaded"\n\t\t\t\t\t\t\t\t\t\ttext="{i18n(\'Отметить все письма прочитанными\')}"\n\t\t\t\t\t\t\t\t\t\tqa:id="mark-all-readed"\n\t\t\t\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t\t\t\t\t\ttext-overflow\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="isSecureFolder">\n\t\t\t\t<fn:if test="isOldPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t{i18n(\'Доступ в папку запрещён\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<b:link\n\t\t\t\t\t\t\tcontrast\n\t\t\t\t\t\t\tremit:click.prevent="secure:opencurrent"\n\t\t\t\t\t\t\ttext="{i18n(\'Ввести пароль\')}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isOldTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t{i18n(\'Доступ в папку запрещён\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<bem:mod name="old-design-two-buttons"/>\n\t\t\t\t\t\t<fn:apply-match name="oldGoToInbox"/>\n\t\t\t\t\t\t<b:link\n\t\t\t\t\t\t\tcontrast\n\t\t\t\t\t\t\tremit:click.prevent="secure:opencurrent"\n\t\t\t\t\t\t\ttext="{i18n(\'Ввести пароль\')}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t{i18n(\'Доступ в папку запрещён\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t\t\t\tcenter\n\t\t\t\t\t\t\tremit:click.prevent="secure:opencurrent"\n\t\t\t\t\t\t\ttext="{i18n(\'Ввести пароль\')}"\n\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t\t\ttext-overflow\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t{i18n(\'Доступ в папку запрещён\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="multi-items-line">\n\t\t\t\t\t\t\t<fn:apply-match name="newGoToInbox"/>\n\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t\t\t\t\tcenter\n\t\t\t\t\t\t\t\tremit:click.prevent="secure:opencurrent"\n\t\t\t\t\t\t\t\ttext="{i18n(\'Ввести пароль\')}"\n\t\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t\t\t\ttext-overflow\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="isSecureSearch">\n\t\t\t\t<fn:if test="isOldPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t{messages.secureSearch}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<b:link\n\t\t\t\t\t\t\t\tcontrast\n\t\t\t\t\t\t\t\tremit:click.prevent="secure:open"\n\t\t\t\t\t\t\t\tevent:details="_this.getSearchSecureTargetFolderId()"\n\t\t\t\t\t\t\t\ttext="{i18n(\'Ввести пароль\')}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isOldTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t{messages.secureSearch}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<bem:mod name="old-design-two-buttons"/>\n\t\t\t\t\t\t<fn:apply-match name="oldGoToInbox"/>\n\t\t\t\t\t\t<b:link\n\t\t\t\t\t\t\tcontrast\n\t\t\t\t\t\t\tremit:click.prevent="secure:open"\n\t\t\t\t\t\t\tevent:details="_this.getSearchSecureTargetFolderId()"\n\t\t\t\t\t\t\ttext="{i18n(\'Ввести пароль\')}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t{messages.secureSearch}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t\t\t\tcenter\n\t\t\t\t\t\t\tremit:click.prevent="secure:open"\n\t\t\t\t\t\t\tevent:details="_this.getSearchSecureTargetFolderId()"\n\t\t\t\t\t\t\ttext="{i18n(\'Ввести пароль\')}"\n\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t\t\ttext-overflow\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t\t{messages.secureSearch}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<span bem:elem="multi-items-line">\n\t\t\t\t\t\t\t<fn:apply-match name="newGoToInbox"/>\n\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t\t\t\t\tcenter\n\t\t\t\t\t\t\t\tremit:click.prevent="secure:open"\n\t\t\t\t\t\t\t\tevent:details="_this.getSearchSecureTargetFolderId()"\n\t\t\t\t\t\t\t\ttext="{i18n(\'Ввести пароль\')}"\n\t\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t\t\t\ttext-overflow\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t</fn:when>\n\n\t\t\t<fn:when test="isNoLetter">\n\t\t\t\t<fn:if test="isOldPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'Письмо не найдено\')}\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isOldTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'Письмо не найдено\')}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<fn:apply-match name="oldGoToInbox"/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'Письмо не найдено\')}\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="isNewTwoBtnPlaceholder">\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t\t{i18n(\'Письмо не найдено\')}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="line">\n\t\t\t\t\t\t<fn:apply-match name="newGoToInbox"/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:if>\n\t\t\t</fn:when>\n\t\t</fn:choose>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/octopus/octopus.html")});define("feast-tpl!ui-block/octopus/octopus.html",["feast-tpl!app/feast-tpl!ui-block/octopus/octopus.html"],function(a){return a});define("helpers/allread-button-visible",["require","exports","default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isAllreadButtonVisible=void 0;function b(b,c){if(!b.all&&!b.unread){return false}var d=c.folder;if(!d){return false}if(!d.get("messages_unread")){return false}if(a.ALL_READ_BUTTON){return true}if(d.isMetathread()&&a.ALL_READ_METATHREADS_ONLY){return true}return false}exports.isAllreadButtonVisible=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/octopus/octopus",["require","exports","@mail/xray","data-source/actions","data-source/index","default-values","feast","feast-tpl!./octopus.html","helpers/allread-button-visible","helpers/data-source-dispatch","mail/Folder","service/mailbox/loader","service/radars/decorator","service/radars/index","service/secure-folder","ui-block/button2/button2","ui-block/link/link"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);i=__importDefault(i);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);var p={"empty-inbox-folder":"ic_empty-folder","empty-folder":"ic_empty-folder","no-select":"ic_no-select","no-templates":"ic_no-templates","no-drafts":"ic_no-templates","no-search":"ic_no-search",spam:"ic_spam",trash:"ic_trash","secure-folder":"ic_lock","secure-search":"ic_lock","no-letter":"ic_no-letter"};exports.default=e.default.Block.extend((0,k.default)({events:["settingsfilters:create","compose:new","filterclick","secure:opencurrent","mark:allreaded",{name:"search:set-in-excluded-folders",rename:"search:excluded"}]})({name:"octopus",template:f.default,events:{goToInbox:"goToInbox"},defaults:{fallback:0&&!d.IS_CHROME,type:"empty-inbox-folder"},_autoShow:true,blocks:{link:o.default,button2:n.default},isSearchSecureNotOpen:function(){var a=this.get("router");var b=a&&a.model.search.error;return b instanceof j.SecureFolderNotOpenError},getSearchSecureTargetFolderId:function(){if(!this.isSearchSecureNotOpen()){return null}var a=this.get("router");var b=a.model.search.error;return b.getFolderId()},getSearchSecureTargetFolderName:function(){var a=this.getSearchSecureTargetFolderId();var b=i.default.all.get(a);if(b){return b.get("name")}return""},getMessages:function(){return{noSpam:i18n("В вашей почте{br}нет спама",{"unsafe-br":"<br />"}),noDrafts:i18n("У вас нет незаконченных{br}или неотправленных писем",{"unsafe-br":"<br />"}),secureSearch:i18n("Доступ в папку «{folderName}» запрещён",{folderName:this.getSearchSecureTargetFolderName()})}},getNoSearchMessages:function(){return{title:i18n("По вашему запросу ничего не{space}найдено",{"unsafe-space":"&nbsp;"}),subtitle:i18n("Можно поискать похожие письма в{space}папках «Спам» и{space}«Корзина»",{"unsafe-space":"&nbsp;"})}},goToInbox:function(b){var c=b.details;a.default.send("go-to-inbox",{dwh:{folder_id:c.folderId}});this.get("router").go("#letters",{folder:i.default.TYPE_INBOX})},getType:function(){var a=this.get("type");var b=this.get("folder");switch(a){case"empty-folder":{if(!b.isSecureOpen()){return"secure-folder"}if(b.isInbox()&&!b.isRoot()){return"empty-folder"}if(b.isInbox()){return"empty-inbox-folder"}if(b.isTrashLike()&&b.isRoot()){return"trash"}if(b.isSpam()&&b.isRoot()){return"spam"}if(b.isTemplates()){return"no-templates"}if(b.isDrafts()&&b.isRoot()){return"no-drafts"}break}case"no-search":{if(this.isSearchSecureNotOpen()){return"secure-search"}return a}case"no-select":case"no-letter":{return a}}return"empty-folder"},getCurrentPlaceholder:function(){return d.EMPTY_FOLDER_PLACEHOLDER},getIconType:function(){return p[this.getType()]},isShareTake:function(){return this.get("folder").isShareTake()},isShareGive:function(){return this.get("folder").isShareGive()},isNewDesign:function(){return[d.EMPTY_FOLDER_PLACEHOLDER_ENUM.new,d.EMPTY_FOLDER_PLACEHOLDER_ENUM.newTwoBtn].includes(d.EMPTY_FOLDER_PLACEHOLDER)},getIcon:function(){var a=this.getIconType();if(this.isNewDesign()){var b=this.generateIconFilename();return"".concat(d.OCTAVIUS_PLACEHOLDERS_PATH).concat(a,"/").concat(b)}else{return"".concat(d.OCTAVIUS_PLACEHOLDERS_PATH).concat(a,".svg")}},isVK:function(){return d.VK},getEmptyStateType:function(){switch(this.getType()){case"empty-folder":return"EMPTY_FOLDER";case"trash":return"TRASH";case"spam":return"SPAM";case"secure-folder":return"LOCK";case"no-search":return"NO_SEARCH";case"no-templates":return"NO_TEMPLATES";case"no-select":return"NO_SELECT";case"no-letter":return"NO_LETTER";default:return"EMPTY_FOLDER"}},isDefaultTheme:function(){return this.get("isLightDefaultMode")||this.get("isDarkDefaultMode")},generateIconFilename:function(){if(this.get("isLightDefaultMode")){return d.NEW_TOOLBAR?"light-new-nav.png":"light.png"}else if(this.get("isDarkDefaultMode")){return"dark.png"}},isAllreadButtonVisible:function(){return(0,g.isAllreadButtonVisible)(this.get("filter"),this.get("model"))},didMount:function(){var a=this;var d;var e=this.get("router");var f=this.get("folder");var g=this.getSearchSecureTargetFolderId();if(this.isSearchSecureNotOpen()||f&&!f.isSecureOpen()&&this._autoShow){this._autoShow=false;(0,m.default)(f||i.default.all.get(g)).then(function(d){if(e&&e.route.is("#search #search-letter")){return c.default.dispatch({type:b.UPDATE_SEARCH})}if(d){a.destroy();(0,h.dataSourceDispatchUpdateAll)()}})}(0,l.default)({chain:["mount","octopus"],dwh:{type:this.get("type"),folder_id:(d=this.get("folder"))===null||d===void 0?void 0:d.id}})},isInSharedMailbox:function(){var a=this.get("folder");return a===null||a===void 0?void 0:a.isShareTake()},shouldDisplayFilter:function(){return!d.DISABLE_OCTOPUS_CREATE_FILTER&&!d.FORBID_FILTERS&&!this.isInSharedMailbox()&&!this.is("mobile")}}))});define("feast-tpl!app/feast-tpl!ui-block/paginator/paginator.html",["feast"],function(a){return a.smartParse('<span qa:id="paginator">\n\t<fn:var name="pages" value="{_this.getPages()}"/>\n\n\t<b:paginator-button\n\t\tico="navigation:drop_previous"\n\t\ttitle="Предыдущая страница"\n\t\taction="prev"\n\t\tdisabled="{attrs.disabled || attrs.current == 1}"\n\t\tremit:action="button-action"\n\t\tqa:id="paginator-button-prev"\n\t/>\n\n\t<b:paginator-button\n\t\tico="navigation:drop_next"\n\t\ttitle="Следующая страница"\n\t\taction="next"\n\t\tdisabled="{attrs.disabled || attrs.current == pages[pages.length - 1] || !attrs.length}"\n\t\tremit:action="button-action"\n\t\tqa:id="paginator-button-next"\n\t/>\n\n\t<fn:for data="_this.getPages()" as="index">\n\t\t<b:paginator-button\n\t\t\tkey="{index}"\n\t\t\ttext="{index}"\n\t\t\tindex="{index}"\n\t\t\tpressed="{index == attrs.current}"\n\t\t\tdisabled="{attrs.disabled}"\n\t\t\tremit:action="button-action"\n\t\t\tqa:id="paginator-button-page_{index}"\n\t\t/>\n\t</fn:for>\n</span>\n',"app/feast-tpl!ui-block/paginator/paginator.html")});define("feast-tpl!ui-block/paginator/paginator.html",["feast-tpl!app/feast-tpl!ui-block/paginator/paginator.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/paginator-button/paginator-button.html",["feast"],function(a){return a.smartParse('<span>\n\t<fn:match name="paginator-text" args="text">\n\t\t<span bem:elem="text">\n\t\t\t{text}\n\t\t</span>\n\t</fn:match>\n\n\t<b:button2\n\t\tico="{attrs.ico}"\n\t\ttitle="{attrs.title}"\n\t\tpressed="{attrs.pressed}"\n\t\tdisabled="{attrs.disabled}"\n\t\tpure\n\t\tshort\n\t\tsmall\n\t\tremit:click="action"\n\t\tevent:details="{page: attrs.index, type: attrs.action || \'click\'}"\n\t\tcentered\n\t>\n\t\t<fn:apply-match name="paginator-text" args="attrs.text"/>\n\t</b:button2>\n</span>\n',"app/feast-tpl!ui-block/paginator-button/paginator-button.html")});define("feast-tpl!ui-block/paginator-button/paginator-button.html",["feast-tpl!app/feast-tpl!ui-block/paginator-button/paginator-button.html"],function(a){return a});define("ui-block/paginator-button/paginator-button",["exports","feast","feast-tpl!./paginator-button.html","ui-block/button2/button2"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"paginator-button",template:e.default,immutable:true,blocks:{button2:f.default}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/paginator/paginator",["require","exports","default-values","feast","feast-tpl!./paginator.html","../paginator-button/paginator-button"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);var e=5;exports.default=b.default.Block.extend({name:"paginator",template:c.default,immutable:true,blocks:{"paginator-button":d.default},defaults:{length:0,current:1},events:{"button-action":"onButtonAction"},onButtonAction:function(a){var b=a.details;var c=this.get("current");var d=b.page,e=b.type;var f=this.getPages();if(!f.length){return}var g;switch(e){case"prev":{g=c-1;if(g<1){return}break}case"next":{g=c+1;if(g>f[f.length-1]){return}break}default:{g=d;break}}this.broadcast("navigate",{page:g})},getPages:function(){var b=this.get("length");var c=this.get("current");var d=Math.ceil(b/a.LIST_LIMIT);var f=c;var g=Math.floor(e/2);var h=f-g;var i=f+g;if(i>d){h-=i-d;i-=i-d}if(h<1){i=Math.min(i-h+1,d);h=1}return Array.from({length:i-h+1},function(a,b){return h+b})}})});define("feast-tpl!app/feast-tpl!ui-block/paginator-container/paginator-container.html",["feast"],function(a){return a.smartParse('<span qa:id="paginator-container">\n\t\x3c!-- Формула для вычисления смещения блока на 2pane --\x3e\n\t<fn:var name="offset2Pane" value="{attrs[\'right-column\'] + attrs[\'right-offset\']}"/>\n\t\x3c!-- Формула для вычисления смещения блока на 3pane --\x3e\n\t<fn:var name="offset3Pane" value="var(--left-column-width) + {(attrs[\'sidebar-column\'] - 60)}px"/>\n\n\t<fn:choose>\n\t\t\x3c!-- Пагинатор, большой экран --\x3e\n\t\t<fn:when test="attrs.type === \'2pane\' && attrs[\'max-breakpoint\']">\n\t\t\t<fn:attr name="style" value="right: calc((100% - {_this.getMaxLayoutWidth()}px) / 2 + {offset2Pane}px);"/>\n\t\t</fn:when>\n\n\t\t\x3c!-- Пагинатор, все остальные брейкпоинты --\x3e\n\t\t<fn:when test="attrs.type === \'2pane\' && !attrs[\'max-breakpoint\']">\n\t\t\t<fn:attr name="style" value="right: {offset2Pane}px;"/>\n\t\t</fn:when>\n\n\t\t\x3c!-- Кнопка "Наверх", большой экран --\x3e\n\t\t<fn:when test="attrs.type === \'3pane\' && attrs[\'max-breakpoint\']">\n\t\t\t<bem:mod name="offset" value="3pane_max" />\n\t\t</fn:when>\n\n\t\t\x3c!-- Кнопка "Наверх", все остальные брейкпоинты --\x3e\n\t\t<fn:when test="attrs.type === \'3pane\' && !attrs[\'max-breakpoint\']">\n\t\t\t<bem:mod name="offset" value="3pane_common" />\n\t\t</fn:when>\n\t</fn:choose>\n\n\t<bem:mod name="visible" test="attrs.visible"/>\n\t<bem:mod name="hidden" test="!attrs.visible"/>\n\t<bem:mod name="mobile" test="attrs[\'mobile-view\']"/>\n\n\t<span\n\t\tfn:if="attrs.paginator && (attrs.type === \'2pane\')"\n\t\tbem:elem="block"\n\t>\n\t\t<fn:apply-match name="paginator"/>\n\t</span>\n\n\t<span bem:elem="block" fn:if="attrs[\'nav-up\']">\n\t\t<fn:apply-match name="nav-up"/>\n\t</span>\n</span>\n',"app/feast-tpl!ui-block/paginator-container/paginator-container.html")});define("feast-tpl!ui-block/paginator-container/paginator-container.html",["feast-tpl!app/feast-tpl!ui-block/paginator-container/paginator-container.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/paginator-container/paginator-container",["require","exports","default-values","feast","feast-tpl!./paginator-container.html"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);exports.default=b.default.Block.extend({name:"paginator-container",template:c.default,defaults:{type:"3pane","right-column":0,"left-column":0,"sidebar-column":0,"right-offset":0,"mobile-view":a.CAN_SHOW_FOOTER_APP_TOOLBAR,"max-breakpoint":false,visible:!a.NEW_TOOLBAR},broadcastVisibilityEvent:function(a){if(a){this.broadcast("show")}else{this.broadcast("hide")}},didMount:function(){this.broadcastVisibilityEvent(this.is("visible"))},didUpdate:function(a){var b=this.is("visible");if(a.visible!==b){this.broadcastVisibilityEvent(b)}},didUnmount:function(){this.broadcastVisibilityEvent(false)},getMaxLayoutWidth:function(){return a.MAX_LAYOUT_WIDTH}})});define("feast-tpl!app/feast-tpl!ui-block/paginator-debugger/paginator-debugger.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="keys" value="{Object.keys(attrs.state).sort()}"/>\n\n\t<fn:for data="keys" as="name">\n\t\t<span bem:elem="pair" key="{name}">\n\t\t\t\t<span bem:elem="name">{name}:</span>\n\t\t\t\t<span bem:elem="value">{attrs.state[name]}</span>\n\t\t</span>\n\t</fn:for>\n</div>\n',"app/feast-tpl!ui-block/paginator-debugger/paginator-debugger.html")});define("feast-tpl!ui-block/paginator-debugger/paginator-debugger.html",["feast-tpl!app/feast-tpl!ui-block/paginator-debugger/paginator-debugger.html"],function(a){return a});define("ui-block/paginator-debugger/paginator-debugger",["exports","feast","feast-tpl!./paginator-debugger.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default=c.default.Block.extend({name:"paginator-debugger",template:d.default,immutable:true})});define("feast-tpl!app/feast-tpl!ui-block/promo-block-letter/promo-block-letter.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="no-margin-collapse" test="attrs[\'no-margin-collapse\']"/>\n\n\t<div\n\t\tclass="promo-block-letter-wrapper"\n\t\tbem:elem="container"\n\t\tref="container"\n\t\tqa:id="promo-block-letter-wrapper"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/promo-block-letter/promo-block-letter.html")});define("feast-tpl!ui-block/promo-block-letter/promo-block-letter.html",["feast-tpl!app/feast-tpl!ui-block/promo-block-letter/promo-block-letter.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/promo-block-letter/promo-block-letter",["require","exports","feast","feast-tpl!./promo-block-letter.html","service/promo"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.default=a.default.Block.extend({name:"promo-block-letter",template:b.default,attrChanged:{support3pane:function(){var a=this.refs.container&&this.refs.container.children.length;if(a){this.update()}},hidden:function(a){if(a){this.el.style.display="none"}else{this.el.style.display=""}}},update:function(){c.default.update();this.mutationCallback()},didMount:function(){var a={childList:true,subtree:true};var b=this.mutationCallback.bind(this);this.observer=new MutationObserver(b);this.observer.observe(this.el,a);this.update()},didUnmount:function(){this.observer.disconnect()},mutationCallback:function(){this.broadcast("promoblockletter:render")}})});define("feast-tpl!app/feast-tpl!ui-block/spec-project-letter/spec-project-letter.html",["feast"],function(a){return a.smartParse('<div>\n\t<div\n\t\tref="spec-project-letter"\n\t\tqa:id="spec-project-letter"\n\t/>\n\t<b:delimeter last fn:if="!attrs[\'no-delimeter\']"/>\n</div>\n',"app/feast-tpl!ui-block/spec-project-letter/spec-project-letter.html")});define("feast-tpl!ui-block/spec-project-letter/spec-project-letter.html",["feast-tpl!app/feast-tpl!ui-block/spec-project-letter/spec-project-letter.html"],function(a){return a});define("ui-block/spec-project-letter/spec-project-letter",["exports","feast","feast-tpl!./spec-project-letter.html","service/adv/index","ui-block/delimeter/delimeter"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend({name:"spec-project-letter",template:f.default,blocks:{delimeter:h.default},attrChanged:{hidden:function a(b){if(b){this.el.style.display="none"}else{this.el.style.display=""}}},constructor:function a(){e.default.Block.apply(this,arguments);this._renderPlacementBound=this.renderPlacement.bind(this)},isCompact:function a(){return this.is("compact")||this.is("touch")},didUpdate:function a(){this.broadcast("render:adv",{advRender:this._renderPlacementBound,advName:this.name})},didMount:function a(){this.broadcast("render:adv",{advRender:this._renderPlacementBound,advName:this.name})},didUnmount:function a(){this.broadcast("render:remove",this.name)},renderPlacement:function a(){var b=this;var d=this.isCompact();if(d===this.isPrevIsCompact){return}this.isPrevIsCompact=d;var e=this.refs["spec-project-letter"];var f=c.Adman.placement(d?"specline3pane":"specline2pane");e.innerHTML="";g.default.setVisibleAdv(this.name,false);if(!f){return}var h=function a(c){f.renderToContainer(e,c,false).then(function(a){if(a&&a.html){g.default.setVisibleAdv(b.name,true)}else{g.default.setVisibleAdv(b.name,false)}}).catch(function(a){console.log(a);g.default.setVisibleAdv(b.name,true);b.broadcast("specline:error")})};this.broadcast("specline:render",{placement:f,placementRender:h})}})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/dataset-letters/dataset-letters",["require","exports","@mail/features","@mail/xray","data-source/actions","data-source/utils/actual-letters","data-source/utils/letter-list-virtualization","data-source/utils/paginator","default-values","feast","feast-tpl!./dataset-letters.html","helpers/advert-vis-check","helpers/data-source-dispatch","helpers/get-go-to-action-display-mode","helpers/keys","helpers/letter","helpers/metathreads","helpers/new-letter-list","mail/Folder","mail/Message","mail/Thread","models/bait-letter/bait-letter","models/dataset-model/dataset-model","models/discounts-block-letter/discounts-block-letter","models/height-compensation-model/height-compensation-model","models/metathread/metathread","models/promo-block-letter/promo-block-letter","models/search-action-letter/search-action-letter","models/spec-project-letter/spec-project-letter","models/spinner-letter/spinner-letter","models/tip-letter/tip-letter","models/welcome-block-letter/welcome-block-letter","service/contextmenu","service/radars/decorator","service/radars/index","service/search-attaches/getAttaches","service/search-attaches/viewModes","service/secure-folder","service/smokescreen","ui-block/button2/button2","ui-block/dataset/dataset","ui-block/discounts/discounts","ui-block/draggable/draggable","ui-block/letter-list-item-adv/letter-list-item-adv","ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview","ui-block/list-letter-bait/list-letter-bait","ui-block/list-letter-common/list-letter-abstract-payment-die","ui-block/list-letter-common/list-letter-common","ui-block/list-letter-common-touch/list-letter-common-touch","ui-block/list-letter-compact/list-letter-compact","ui-block/list-letter-compact-touch/list-letter-compact-touch","ui-block/list-letter-height-compensation/list-letter-height-compensation","ui-block/list-letter-order/list-letter-abstract-order","ui-block/list-letter-preview-action/list-letter-preview-action","ui-block/list-letter-skeleton/list-letter-skeleton","ui-block/list-letter-spinner/list-letter-spinner","ui-block/list-letter-tip/list-letter-tip","ui-block/list-letter-welcome/list-letter-welcome","ui-block/metathread/metathread","ui-block/metathread-footer/metathread-footer","ui-block/octopus/octopus","ui-block/paginator/paginator","ui-block/paginator-container/paginator-container","ui-block/paginator-debugger/paginator-debugger","ui-block/promo-block-letter/promo-block-letter","ui-block/react-async/react-async","ui-block/spec-project-letter/spec-project-letter","utils/util"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockDescription=exports.DatasetLettersEvents=void 0;a=__importDefault(a);b=__importDefault(b);h=__importDefault(h);i=__importDefault(i);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);J=__importDefault(J);L=__importDefault(L);M=__importDefault(M);N=__importDefault(N);O=__importDefault(O);P=__importDefault(P);Q=__importDefault(Q);R=__importDefault(R);T=__importDefault(T);U=__importDefault(U);V=__importDefault(V);W=__importDefault(W);X=__importDefault(X);Z=__importDefault(Z);_=__importDefault(_);aa=__importDefault(aa);ba=__importDefault(ba);ca=__importDefault(ca);da=__importDefault(da);ea=__importDefault(ea);fa=__importDefault(fa);ga=__importDefault(ga);ha=__importDefault(ha);ia=__importDefault(ia);ja=__importDefault(ja);ka=__importDefault(ka);la=__importDefault(la);ma=__importDefault(ma);var na=60;var oa=100;var pa={mount:"umh_mount",update:"umh_update",resize:"umh_resize"};var qa={once:"hc_once",update:"hc_update",always:"hc_always"};var ra={"list-letter-tip":{modelValidator:C.default.isTip,selector:(0,K.selector)(".list-letter-tip"),heightCalculationMode:qa.always},"list-letter-search-action":{modelValidator:z.default.isSearchAction,selector:(0,K.selector)(".list-letter-search-action"),heightCalculationMode:qa.always},"promo-block-letter":{modelValidator:y.default.isPromoBlock,selector:(0,K.selector)(".promo-block-letter"),heightCalculationMode:qa.always},"spec-project-letter":{modelValidator:A.default.isSpecProjectLetter,selector:(0,K.selector)(".spec-project-letter"),heightCalculationMode:qa.always}};var sa;(function(a){a["NewRange"]="new:range"})(sa=exports.DatasetLettersEvents||(exports.DatasetLettersEvents={}));exports.blockDescription={name:"dataset-letters",template:i.default,performanceTrace:"track",defaults:{stickyMap:{},search:false,"current-page-override":undefined,paginator:false,"nav-up":false,"nav-up-enabled":g.ENABLE_NAV_UP||g.CAN_ENABLE_PAGINATOR},blocks:{draggable:O.default,dataset:M.default,"letter-list-item-adv":P.default,metathread:da.default,"metathread-footer":ea.default,octopus:fa.default,paginator:ga.default,"paginator-container":ha.default,button2:L.default,"list-letter-common":T.default,"list-letter-common-touch":U.default,"list-letter-compact":V.default,"list-letter-compact-touch":W.default,"list-letter-bait":R.default,"list-letter-spinner":aa.default,"list-letter-tip":ba.default,"list-letter-preview-action":Z.default,"promo-block-letter":ja.default,"spec-project-letter":la.default,"list-letter-skeleton":_.default,"list-letter-height-compensation":X.default,"list-letter-welcome":ca.default,discounts:N.default,"react-async":ka.default},attrChanged:{folder:function(){var a=this;setImmediate(function(){return a.preloadThreads()})},compact:function(a){!a&&this.set("stickyMap",{})},"current-page-override":function(a){this.setPaginatorDebugState({"current-page-override":a})}},events:{preparedragelement:"onPrepareDragElement","click:letter":"onLetterClick","click:avatar":"onAvatarClick","click:metathreadavatar":"onAvatarClick","click:previewattach":"onPreviewAttachClick",rightclick:"onRightClick",scrollintomodel:"onScrollIntoModelByIndex","paginator:navigate":"onPaginatorNavigate","paginator:up":"onPaginatorUp"},constructor:function(){h.default.Block.apply(this,arguments);this.getItemHeight=this.getItemHeight.bind(this);this.getItemPersist=this.getItemPersist.bind(this);this.getItemContext=this.getItemContext.bind(this);this.handleItemsUpdate=this.handleItemsUpdate.bind(this);this.onNewRange=this.onNewRange.bind(this);this.handleScroll=this.handleScroll.bind(this);this.handleWindowResize=this.handleWindowResize.bind(this);this.updateModelHeights=this.updateModelHeights.bind(this);this._footerOffsets={};this._modelHeights={};this._specialModels=[];this._forcePaginator=false;if(g.IS_DEBUG){this._debugPaginatorState={};this._debugPaginator=new ia.default({state:this._debugPaginatorState});this._debugPaginator.renderTo(document.body)}},preloadThreads:function(){var b;if(!this.isMounted()){return}var c=a.default.get("datalist-preload-threads");var d=this.get("models");if(!d||!c){return}var e;var f;var h;b=c.data.split(","),e=b[0],f=b[1],h=b[2];e=Number(e);f=Number(f);h=Number(h);var i=function(a,b){b=d[a];if(!b){return j=b,"break"}if(f<1&&h<1){return j=b,"break"}if(b instanceof s.default&&!b.is("flags.metathread")){if(f-- >0||b.is("flags.unread")&&h-- >0){var c={force_custom_thread:g.FORCE_CUSTOM_THREAD};if(g.OCTAVIUS_PREFETCH){c.octavius_prefetch=1}setTimeout(function(){return b.fetch(c)},10)}e--}j=b};var j;for(var k=0,l=void 0;e>0;k++){var m=i(k,l);l=j;if(m==="break")break}},onPrepareDragElement:function(a){var b=a.details;var c=h.default.Mediator.get("letters-selection");var d=document.createElement("div");var e=s.default.all.get(b.id)||x.default.all.get(b.id);if(e){c.select(e);d.textContent=c.getModels().length+" items";d.style.cssText="padding: 5px 10px; background: #ccc;";b.el.appendChild(d)}return false},isPriorityMessage:function(a){var b;var c=(b=a.getFolder)===null||b===void 0?void 0:b.call(a);if(!c){return false}if(c.isSpam()){return false}var e=this.get("router");return(0,d.isActualLettersEnabledInFolder)(e,c,a.get("flags.newsletter"))&&a instanceof s.default&&a.get("flags.is_relevant")&&a.get("flags.unread")},getScrollableEl:function(){var a;return(a=this.el)===null||a===void 0?void 0:a.closest((0,K.selector)(".scrollable"))},onAvatarClick:function(a){var b=a.originalEvent&&a.originalEvent.details;var c=a.details;if(a.details.model){c=a.details.model}if(!b||b&&!b.get("swipe-actions-visible")){this.broadcast("selected:toggle",c,a.originalEvent)}a.preventDefault()},openDraft:function(a){var b=this;return r.default.fetchData({id:a.get("expand")||a.get("id"),folder_id:a.get("folder")},true,true).then(function(a){r.default.set([a]);b.broadcast("compose:draft",new r.default(a))}).catch(function(a){(0,G.default)({type:"open_draft_fail",rlog:"open_draft_fail",rlog_message:a})})},onLetterClick:function(a){var c;if(a.isDefaultPrevented()){return}var e=a.originalEvent;if(e&&(0,m.isNewTabClick)(e)){return}else{a.preventDefault()}var f=a.details.model;var h=f.getFolder();if(this.get("compact")&&this.get("select-mode")){this.broadcast("selected:toggle",f,a.originalEvent)}else if(h.isOutbox()){this.broadcast("compose:schedule",f)}else if(h.isTemplates()){this.broadcast("compose:template",f)}else if(h.isDrafts()){this.openDraft(f)}else{this.goToLetter(f)}var i=(0,o.getModelCurrentFolder)(f).id;var j=this.is("search");var k=this.get("router");var l=__assign(__assign(__assign(__assign(__assign({message_id:f.get("id"),uidl:f.get("last"),length_thread:f.get("length"),unread:f.get("flags.unread"),priority:+f.get("flags.is_relevant"),folder_id:i,need_hide_emoji_in_subject:f.get("hide_emoji_in_subject"),need_hide_emoji_in_snippet:f.get("hide_emoji_in_snippet"),need_hide_emoji_in_correspondent:f.get("hide_emoji_in_correspondent"),show_relevant:+(0,d.isActualLettersEnabledInFolder)(k,h,f.get("flags.newsletter"))},f.get("actual_probability")&&{ml_model:f.get("actual_probability").split(":")[0]}),f.get("flags.bimi_msg")&&{reliable:true}),(f.get("flags.official")||f.get("flags.official_newsletter"))&&{official:true}),f.get("flags.tags")&&{labels:(c=f.get("flags.tags"))===null||c===void 0?void 0:c.join(",")}),{maybe_phishing:f.get("flags.maybe_phishing")});var n=__assign({unread:f.get("flags.unread"),ui_index:f.meta("_ui-index"),search:j},l);if(l.priority){b.default.send("thread_letter_open_priority")}if(l.maybe_phishing){b.default.send("thread_letter_open_probable_phishing",{dwh:n})}(0,G.default)({chain:["thread","letter","open"],dwh:l,data:n});if(g.DISCOUNTS_BLOCK&&k.model.uiThreadsSettings.discounts&&k.model.folder.isNewsletters()&&f.get("flags.pinned")&&f.get("discount")){(0,G.default)({chain:["open","discount","thread"],dwh:{from:"letter_list",threadId:f.get("id"),letterId:f.get("expand")||f.get("id"),unread:f.get("flags.unread"),jsonld:f.get("discount.from_jsonld"),relevant:f.get("flags.is_relevant")}})}},getLetterHref:function(a,b){return(0,n.getLetterHref)(a,b,{router:this.get("router"),search:this.is("search"),threads:this.is("threadsEnabled")})},goToLetter:function(a){var b=this;var c=(0,o.getModelCurrentFolder)(a);if(!c.isSecureOpen()){(0,J.default)(c).then(function(c){c&&b.goToLetter(a)});return}var d=this.get("router");var e=this.getLetterHref(a,c);d.nav(e,{initiator:"popstate"})},onRightClick:function(a){Q.default.resetAttachmentDropdown();if(!this.is("touch")&&!this.is("search")){this.setDetailsForRightClick(a);E.default.show(a)}},setDetailsForRightClick:function(a){if(a.details.model){a.details=a.details.model}a.details.folders=this.get("folders");a.details.isLetterSelected=this.isLetterSelected(a.details)},onPreviewAttachClick:function(a){var b=a.details,c=a.originalEvent;if(!b||!c||!c.details||!c.originalEvent){return}var d=b.index;var e=c.details,f=e.hasSnippet,g=e.ext,h=c.originalEvent.type;var i=[["letter_position",d+1],["hasSnippet",f]];if(g){i.push(["extension",g])}var j=this.get("router");var k=j.model.search.search_id;var l=Math.floor(Date.now()/1e3);(0,G.default)({chain:["search_attaches_click_".concat(h)],intervals:i,dwh:{search_id:k,timestamp:l}})},updateSpecialModels:function(){this._specialModels.length=0;var a=this.get("models");for(var b=0;b<a.length;b++){var c=a[b];var d=Object.keys(ra);for(var e=0;e<d.length;e++){var f=d[e];var g=ra[f];if(g.modelValidator(c)){this._specialModels.push({type:f,model:c})}}}},didMount:function(){this.debouncedhandleWindowResize=ma.default.debounce(this.handleWindowResize,oa,this);b.default.send("old_letter_list");window.addEventListener("resize",this.debouncedhandleWindowResize);this.updateModelHeights(pa.mount);(0,j.checkAdvertVisibility)()},didUpdate:function(a){this.updateSpecialModels();this.updateModelHeights(pa.update);var b=this.get("current-page-override")!==undefined||a["current-page-override"]!==undefined;this.updatePaginatorVisibility(this.ids.dataset.getScrollTop(),b)},didUnmount:function(){window.removeEventListener("resize",this.debouncedhandleWindowResize);if(this._debugPaginator){this._debugPaginator.destroy()}},handleWindowResize:function(){this.updateModelHeights(pa.resize)},updateModelHeights:function(a){var b=this._specialModels;for(var c=0;c<b.length;c++){var d=b[c];var e=d.model.get("id");var f=ra[d.type];var g=document.querySelector((0,K.selector)(f.selector));if(g){var h=qa;var i=pa;var j=false;switch(f.heightCalculationMode){case h.once:if(a===i.mount){j=true}break;case h.update:if(a===i.mount||a===i.update){j=true}break;case h.always:if(a===i.mount||a===i.update||a===i.resize){j=true}break}if(j){this._modelHeights[e]=g.getBoundingClientRect().height}}}},isSearch:function(){return this.is("search")||this.is("search-letter")},getItemHeight:function(a){var b;var c=this.is("compact");var d=this.is("pony-mode")||!!(c&&((b=a.isInMetathread)===null||b===void 0?void 0:b.call(a)));var f=this.isSearch();var g=a.get("id");var h=this._modelHeights[g];if(h){return h}if(w.default.isHeightCompensation(a)){return a.get("height")}if(t.default.isBait(a)||B.default.isSpinner(a)||y.default.isPromoBlock(a)||A.default.isSpecProjectLetter(a)||D.default.isWelcomeBlock(a)&&!a.is("visible")){return 0}if(D.default.isWelcomeBlock(a)){if(!c){return 74}else{return 90}}if(v.default.isDiscountsBlock(a)){if(c){return 224}else{return 200}}if(x.default.isMetathread(a)&&a.isExpanded()&&(0,p.isNewLetterListEnabled)(c)&&c){if(d){return e.HEIGHT_GENERIC_2PANE_PONY}return e.HEIGHT_GENERIC_2PANE}if(x.default.isMetathread(a)&&a.isExpanded()&&!(0,p.isNewLetterListEnabled)(c)||x.default.isMetathreadFooter(a)){if(!c){if(d){return 52}return 60}if(c){if(d){return 52}return 60}}var i=0;var j=(0,n.isListLetterActionButtonsEnabled)(a,f);if(j){if(c){i=d?24:12}else{i=d?26:24}}var k=(0,l.getGoToActionHeight)(a,d,f,c,j);var m=(0,l.getGoToActionDisplayMode)(a,f,false)==="none";var o=f?{}:this.get("hidden-payment-dies")||{};var q=m?(0,S.getPaymentDieDisplayMode)(a,o,d,f,false):"none";var r=0;if(q==="full"&&!c){r=a.getPaymentMeta().skin===S.SKINS.GIBDD?98:70}else if(q!=="none"&&c){switch(q){case"compact":{r=34;break}case"full":{r=a.getPaymentMeta().skin===S.SKINS.GIBDD?98:70;break}}}var s=(0,H.shouldShowLetterPreview)(a)?a.get("attachments_count"):0;var u=!!s;var z=u?{length:s}:(0,H.getAllAttaches)(a,f);var C=!(f&&c);var E=0;if(z&&z.length&&C&&m){var F=(0,H.getSearchAttaches)(a,f);var G=(0,I.getAttachesModes)(c,z,F);E=(0,I.getSearchAttachesHeight)(G)}var J=(0,Y.getTransactionMetadata)(a,f);var K=0;if((0,Y.showOrder)(a,J)&&!c&&m){K=20}var L=0;if((0,S.shouldShowUniversalPaymentDie)(a,false)&&m){if(!c){L=32}else if(j&&!d){L=20}}var M=0;if((0,p.isNewLetterListEnabled)(c)&&f&&c){M=d?6:10}return(0,e.getGenericItemHeight)(c,d)+i+r+k+E+K+L+M},getItemPersist:function(a){return x.default.isMetathread(a)&&a.isExpanded()},getItemContext:function(a,b,c){var d=this.get("models");var e=d[b-1];var f=d[b+1];var g=this.get("stickyMap");return{prev:e,next:f,isFirst:b===0,isLast:b===c-1||b===c-2&&f&&f.is("spinnerLetter"),isNextItemExpandedMetathread:f&&this.isModelExpandedMetathread(f),isPrevItemExpandedMetathread:e&&e.is("metathreadFooter"),sticky:g&&g[a.id],searchInExcludedFoldersUrl:this.get("search-in-excluded-folders-url"),suggestSearch:this.get("router").model.suggestSearch,skeletonIndex:a.get("index"),heightCompensation:a.get("height"),metathreadLastToggle:a.get("metathreadLastToggle"),discounts:this.get("router").model.discounts,threadsEnabled:this.is("threadsEnabled")}},handleItemsUpdate:function(a){this.updateSpecialModels();this.updateModelHeights(a?pa.mount:pa.update)},updatePaginatorVisibility:function(a,b){if(b===void 0){b=this.get("current-page-override")!==undefined}if(!this.isMounted()){return}var c=this.get("status");var d=this.get("router");if(!c||!Object.keys(c).length){return}var e=c.page===1;var h=c.letters.length>0;var i=!e||c.letters.length>g.LIST_LIMIT;var j=!!a;var k=this._forcePaginator;if(!(0,f.isPaginatorGlobalEnabled)(d)){this.set({paginator:false,"nav-up":j});return}var l=i&&(j||b||k);var m=h&&j;this.set({paginator:l,"nav-up":m})},handleScroll:function(a){var b=a.dataset,c=a.scrollTop;if(!this.isMounted()){return}var d=this.get("router");this.updatePaginatorVisibility(c);if((0,f.isPaginatorGlobalEnabled)(d)){this.updatePaginatorPage(c);this.saveCurrentPageHeightOnScroll()}var e=b.isScrolledToBottom();if(b.isScrolledToBottom()!==!!this._scrolledToBottom){this._scrolledToBottom=e;this.render()}var g=this.get("metathreads");if(!g||!Object.keys(g).length){return}var h=this.get("stickyMap");var i=[];var j={};var k=[];var l;var m;var n;var o;var p;var q;var r;var s;var t;var u;for(var v in g){l=x.default.all.get(v);m=b.getBlockMeasuresByModelId(v);o=m!==void 0;n=o&&m.offset-m.height;q=l.getFooterModel();r=b.getBlockMeasuresByModelId(q.id);u=r!==void 0;if(u){this._footerOffsets[l.id]=r.offset-r.height}s=this._footerOffsets[l.id];p=o&&c<=n;t=!s||c<=s;j[l.id]=l.isExpanded()&&!p&&t;if(j[l.id]){k.push(l.id)}}for(var v in h){if(h[v]){i.push(v)}}if(k.join(",")!==i.join(",")){this.set("stickyMap",j)}},onScrollIntoModelByIndex:function(a){if(!a.originalEvent){return}var b=this.ids.dataset;var c=a.originalEvent.details.index;var d=this.get("models");var e=d&&d[c];var f=e&&b.getBlockMeasuresByModelId(e.id);var g=this.getItemHeight(e)+na;var h=f?f.offset-g:0;b.scrollTo(h)},getMainField:function(a){var b=q.default.get(a.get("folder"));if((b===null||b===void 0?void 0:b.isOutbox())||(b===null||b===void 0?void 0:b.isSent())||(b===null||b===void 0?void 0:b.isDrafts())){return"to"}return"from"},isTouchDevice:function(){return g.IS_TOUCH_DEVICE},isLetterSelected:function(a){var b,c,d;var e=this.get("select-folder");var f=this.get("selected");if(C.default.isTip(a)){return true}if(u.default.isDatasetModel(a)){return false}return(f===null||f===void 0?void 0:f[a.id])||!((b=a.isInMetathread)===null||b===void 0?void 0:b.call(a))&&!((c=a.is)===null||c===void 0?void 0:c.call(a,"flags.metathread"))&&e||((d=a.isInMetathread)===null||d===void 0?void 0:d.call(a))&&a.getContainingMetathread()&&f[a.getContainingMetathread().id]},isLetterActive:function(a){var b=this.get("thread");return b===a.id},isModelExpandedMetathread:function(a){return a&&x.default.isMetathread(a)&&a.isExpanded()},getKey:function(a){var b=a.id;if(a.isInMetathread&&a.isInMetathread()){return a.get("folder")+":"+b}return b},getPaginatorPage:function(a,b){return this.get("paginator-page-getter")(a,b)},getLastCalculatedRange:function(){return this.ids.dataset.getLastCalculatedRange()},getCurrentPageOverride:function(){return this.get("current-page-override")},isScrolledToBottom:function(){return this.ids.dataset.isScrolledToBottom()},getStatus:function(){return this.get("status")},getModels:function(){return this.get("models")},getScrollTop:function(){return this.ids.dataset.getScrollTop()},getRouter:function(){return this.get("router")},is3Pane:function(){return this.is("compact")},isPonyMode:function(){return this.is("pony-mode")},getBlockMeasuresByModelId:function(a){return this.ids.dataset.getBlockMeasuresByModelId(a)},onNewRange:function(a){this.broadcast(sa.NewRange,{start:a.offset})},onPaginatorNavigate:function(a,b){var d=this;var h=a.details;if(b===void 0){b=false}var i=Math.max(h.page,1);var j=this.getPaginatorPage();var l=j===i;if(!l){this.set("current-page-override",i)}if(!b){this.radar("paginator_nav");this.radar(["paginator_nav",i])}this.broadcast("save-current-page-height",{saveOnlyIfExact:false});var m=function(){return(0,k.dispatchAndWait)({type:c.LOAD_PAGE,page:i}).then(function(a){return a&&a.status})};var n=function(){var a=(0,e.getGenericItemHeight)(d.is("compact"),d.is("pony-mode"));var b=(0,f.getMemoizedPageHeight)(i-1);var c=b?b+a:(i-1)*g.LIST_LIMIT*a;return d.ids.dataset.scrollTo(c,{notify:true,behavior:"smooth",duration:200})};var o=function(){d.set("current-page-override",undefined);d._forcePaginator=true;d.ids.dataset.updateScroll();d._forcePaginator=false;return Promise.resolve()};if(l){return n()}var p=this.get("router");if(!(0,f.isPaginatorGlobalEnabled)(p)){return n().then(o)}return Promise.all([n(),m()]).then(o).catch(function(a){if(g.IS_DEBUG){console.error(a)}o()})},onPaginatorUp:function(){this.radar("nav-up");if(this.is("search")||this.is("search-letter")){return this.ids.dataset.scrollTo(0,{notify:true,behavior:"smooth",duration:200})}this.onPaginatorNavigate({details:{page:1}},true)},updatePaginatorPage:function(a){if(!this.isMounted()||this.is("search")||this.is("search-letter")){return}this.broadcast("update-on-scroll",{scrollTop:a})},saveCurrentPageHeightOnScroll:function(){if(!this.isMounted()){return}this.broadcast("save-current-page-height",{saveOnlyIfExact:true})},setPaginatorDebugState:function(a){var b=this;if(this._debugPaginator){this._debugPaginatorState=__assign(__assign({},this._debugPaginatorState),a);window.setTimeout(function(){if(b.isMounted()&&b._debugPaginator){b._debugPaginator.set("state",b._debugPaginatorState)}},16)}},highlightElementForDebug:function(a){if(!this._debugPaginator){return}var b=document.styleSheets[0];if(window.__highlightedRule){b.removeRule(b.rules.length-1)}var c='[data-id="'.concat(a.id,'"], [data-id="').concat(a.id,'"] > *');b.addRule(c,"background-color: rgba(255, 0, 0, 0.2) !important;");window.__highlightedRule=true},isEnableAttach:function(){var a=this.get("folder");return a.checkGrant(q.default.SHARE_GRANTS.view_attachment)},shouldShowLetterPreview:H.shouldShowLetterPreview};exports.default=h.default.Block.extend((0,F.default)({id:function(a){if(a.zombie||!a.attrs){(0,G.default)(["radar","decorator","zombie","error"]);return"zombie"}return a.is("search")?"search":"letters"},explicit:true})(exports.blockDescription))});define("feast-tpl!app/feast-tpl!ui-block/search-panel/search-panel.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="ponyMode" value="{attrs.ponyMode}"/>\n\t<fn:var name="columnWidth" value="{attrs.rightColumn}"/>\n\t\x3c!-- Если активная панель - во всю ширину, если у нас только кнопка - шириной с кнопку, если поле - шириной с колонку --\x3e\n\t<fn:var name="searchColumnWidth" value="{attrs.active ? \'100%\' : attrs.onlyIcon ? \'auto\' : columnWidth + \'px\'}"/>\n\n\t<bem:mod name="active" test="attrs.active" />\n\t<bem:mod name="only-icon" test="attrs.onlyIcon" />\n\t<bem:mod name="hide" test="attrs.hide" />\n\t<bem:mod name="size_{attrs.size}" />\n\t<bem:mod name="type" value="{attrs.layoutType}"/>\n\t<bem:mod name="pony-mode" test="ponyMode" />\n\t<fn:attr name="style" value="max-width:{attrs.maxWidth}px;"/>\n\n\t<div\n\t\tbem:elem="wrapper"\n\t\tqa:id="search-panel{attrs.active ? \':active\' : \'\'}"\n\t\tstyle="width: {searchColumnWidth};"\n\t>\n\t\t<bem:mod name="active" test="attrs.active" />\n\t\t<bem:mod name="inactive" test="!attrs.active" />\n\n\t\t<fn:if test="attrs.active">\n\t\t\t<div bem:elem="left-col" ref="left-col">\n\t\t\t\t<b:button2\n\t\t\t\t\t\tremit:mousedown="back"\n\t\t\t\t\t\tnowrap\n\t\t\t\t\t\tradar-id="back"\n\t\t\t\t\t\ttext="{i18n(\'Сбросить поиск\')}"\n\t\t\t\t\t\tico="arrow-back"\n\t\t\t\t\t\tcompact="{ponyMode}"\n\t\t\t\t\t\tpure\n\t\t\t\t\t\tshort="{attrs.leftColumn <= 50}"\n\t\t\t\t\t\tcentered\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</fn:if>\n\n\t\t<div bem:elem="right-col" ref="right-col">\n\t\t\t<fn:if test="!attrs.onlyIcon">\n\t\t\t\t<b:search-panel-button\n\t\t\t\t\tremit:click.stop="expandSearchPanel"\n\t\t\t\t\tshortcut="/"\n\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\tshort="{columnWidth < 240}"\n\t\t\t\t\tcompact="{ponyMode}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="attrs.onlyIcon">\n\t\t\t\t<b:button2\n\t\t\t\t\tremit:click.stop="expandSearchPanel"\n\t\t\t\t\tico="search"\n\t\t\t\t\tcompact="{ponyMode}"\n\t\t\t\t\tpure\n\t\t\t\t\tcentered\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</div>\n\n\t\t<b:react-async\n\t\t\t\tid="search-panel"\n\t\t\t\tactive="{attrs.active}"\n\t\t\t\tclass-name="search-panel__layer"\n\t\t\t\tcomponent="SearchPanelInput"\n\t\t\t\tonBlur="{_this.handleSearchPanelBlur}"\n\t\t\t\tsearch="{attrs.store.search}"\n\t\t\t\tsize="{attrs.size}"\n\t\t\t\tponyMode="{ponyMode}"\n\t\t\t\tcategories="{attrs.categories}"\n\t\t\t\tcolorTags="{attrs.colorTags}"\n\t\t\t\tuse:mediator="themes-manager"\n\t\t/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/search-panel/search-panel.html")});define("feast-tpl!ui-block/search-panel/search-panel.html",["feast-tpl!app/feast-tpl!ui-block/search-panel/search-panel.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/search-panel-button/search-panel-button.html",["feast"],function(a){return a.smartParse('<div type="button">\n\t<fn:add-class name="js-shortcut" test="attrs.shortcut" />\n\n\t<span bem:elem="text" qa:id="{attrs.short ? \'button-short-text\' : \'button-text\'}">\n\t\t<fn:if test="attrs.short">\n\t\t\t{i18n(\'Поиск\')}\n\t\t</fn:if>\n\t\t<fn:if test="!attrs.short">\n\t\t\t{i18n(\'Поиск по почте\')}\n\t\t</fn:if>\n\t</span>\n\n\t<span bem:elem="icon" qa:id="button-icon">\n    <b:ico name="{attrs.compact ? \'navigation:search:s\' : \'navigation:search\'}"/>\n\t</span>\n</div>\n\n',"app/feast-tpl!ui-block/search-panel-button/search-panel-button.html")});define("feast-tpl!ui-block/search-panel-button/search-panel-button.html",["feast-tpl!app/feast-tpl!ui-block/search-panel-button/search-panel-button.html"],function(a){return a});define("ui-block/search-panel-button/search-panel-button",["exports","feast","feast-tpl!./search-panel-button.html","ui-block/ico/ico"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"search-panel-button",template:e.default,blocks:{ico:f.default}})});define("ui-block/search-panel/consts",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SearchEventEnd=exports.SearchEventStart=exports.SearchPanelFeastName=void 0;exports.SearchPanelFeastName="search-panel";var a;(function(a){a["BLUR"]="search-panel:blur";a["FOCUS"]="search-panel:focus"})(a=exports.SearchEventStart||(exports.SearchEventStart={}));var b;(function(a){a["BLUR"]="searchpanel:blur";a["FOCUS"]="searchpanel:focus"})(b=exports.SearchEventEnd||(exports.SearchEventEnd={}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/search-panel/search-panel",["require","exports","default-values","feast","feast-tpl!./search-panel.html","service/radars/decorator","service/radars/index","ui-block/react-async/react-async","ui-block/search-panel-button/search-panel-button","./consts"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.searchPanelConfig=void 0;b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.searchPanelConfig={name:h.SearchPanelFeastName,template:c.default,blocks:{"search-panel-button":g.default,"react-async":f.default},events:{expandSearchPanel:"expandSearchPanel"},defaults:{categories:a.SEARCH_CATEGORIES,colorTags:a.COLOR_TAGS},constructor:function(){b.default.Block.apply(this,arguments);this.handleSearchPanelBlur=this.handleSearchPanelBlur.bind(this)},getSearchInput:function(){return this.ids["search-panel"].getComponent()},expandSearchPanel:function(){var a=this.is("active");this.set("active",true);var b=this.getSearchInput();if(b){if(a){b.focus()}else{b.focusAfterExpand()}(0,e.default)("srch-expand");this.broadcast(h.SearchEventStart.FOCUS)}},focus:function(){var a;this.set("active",true);(a=this.getSearchInput())===null||a===void 0?void 0:a.focus()},handleSearchPanelBlur:function(){this.broadcast(h.SearchEventStart.BLUR)},reset:function(){var a;if(!this.is("active")){return}(a=this.getSearchInput())===null||a===void 0?void 0:a.blur();this.set("active",false);this.broadcast(h.SearchEventStart.BLUR);this.get("store").search.clear()}};exports.default=b.default.Block.extend((0,d.default)()(exports.searchPanelConfig))});define("feast-tpl!app/feast-tpl!ui-block/sidebar-search/sidebar-search.html",["feast"],function(a){return a.smartParse('<div\n\tqa:id="sidebar-search"\n\ta11y:tooltip-direction="left"\n>\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="short" value="{attrs.short}" />\n\t<fn:var name="ponyMode" value="{attrs.ponymode}"/>\n\n\t<b:sidebar\n\t\tid="sidebar"\n\t\topen-left\n\t\tponymode="{ponyMode}"\n\t\tshort="{short}"\n\t>\n\t\t<fn:match name="sidebar-top-menu" args="isShort, isOpen">\n\t\t\t\x3c!-- Шапка сайдбара --\x3e\n\t\t\t<div bem:elem="header">\n\t\t\t\t\x3c!-- Бургер/Скрыть --\x3e\n\t\t\t\t<a\n\t\t\t\t\tfn:if="isShort || isOpen"\n\t\t\t\t\tbem:elem="menu-item"\n\t\t\t\t\tremit:click="sidebar:toggle"\n\t\t\t\t\tqa:id="burger-button"\n\t\t\t\t\ttitle="{!isOpen && i18n(\'Все фильтры\')}"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="menu-ico">\n\t\t\t\t\t\t<b:ico name="{attrs.ponymode ? \'navigation:menu_s\' : \'navigation:menu\'}" size="m"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="menu-text">{i18n(\'Скрыть\')}</span>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</fn:match>\n\n\t\t<fn:match name="sidebar-content" args="isShort, isOpen">\n\t\t\t<b:react-async\n\t\t\t\tclass-name="search-sidebar__layer"\n\t\t\t\tcomponent="SearchSidebar"\n\n\t\t\t\tfolders="{attrs.folders}"\n\t\t\t\tonSearchPanelFocus="{_this.handleSearchPanelFocus}"\n\t\t\t\tponyMode="{ponyMode}"\n\t\t\t\tnanoMode="{ponyMode}"\n\t\t\t\tsearch="{attrs.store.search}"\n\t\t\t\tshortcut="{isShort}"\n\t\t\t\tcategories="{attrs.categories}"\n\t\t\t\tcolorTags="{attrs.colorTags}"\n\t\t\t/>\n\t\t</fn:match>\n\t</b:sidebar>\n</div>\n\n',"app/feast-tpl!ui-block/sidebar-search/sidebar-search.html")});define("feast-tpl!ui-block/sidebar-search/sidebar-search.html",["feast-tpl!app/feast-tpl!ui-block/sidebar-search/sidebar-search.html"],function(a){return a});define("feast-mod/letter-count",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.letterCount=void 0;function a(a){return i18n.plural(a,[i18n("{count} писем",{count:a}),i18n("{count} письмо",{count:a}),i18n("{count} письма",{count:a})])}exports.letterCount=a});define("feast-tpl!app/feast-tpl!ui-block/nav-folders/nav-folders.html",["feast"],function(a){return a.smartParse('<div qa:id="folders">\n\n\t<b:nav\n\t\tmodels="{attrs.models}"\n\t\tshort="{attrs.short}"\n\t\tclean="{attrs.clean}"\n\t\ttouch="{attrs.touch}"\n\t\ttouch-nav="{attrs[\'touch-nav\']}"\n\t\tpony-mode="{attrs.ponymode}"\n\t\thas-parent-private-folders="{attrs[\'has-parent-private-folders\']}"\n\t>\n\n\t\t<fn:match name="nav-head"></fn:match>\n\n\t\t<fn:match name="nav-item" args="folder">\n\t\t\t<fn:var name="level" value="{_this.getLimitedFolderLevel(folder)}"/>\n\t\t\t<fn:var name="expanded" value="{_this.isFolderExpanded(folder)}"/>\n\t\t\t<fn:var name="url" value="{_this.getFolderUrl(folder)}"/>\n\t\t\t<fn:var name="title" value="{_this.getTitle(folder)}"/>\n\n\t\t\t<fn:var name="shortcut" value="{_this.folder2shortcutMap[folder.get(\'type\')]}" test="attrs.sidebar && _this.isShortcut(folder)"/>\n\n\t\t\t<fn:if test="this.isOtherUserFoldersContainer(folder) && !attrs.short">\n\t\t\t\t<hr bem:elem="hr"/>\n\t\t\t</fn:if>\n\n\t\t\t<b:immutable-virtual-block\n\t\t\t\tkey="{folder.id}"\n\t\t\t\tname="nav-item-folder"\n\t\t\t\tmodel="{folder}"\n\t\t\t\ttitle="{title}"\n\t\t\t\tdata-title="{_this.getFolderTitle(folder)}"\n\t\t\t\tactive="{attrs.active}"\n\t\t\t\tsystem="{attrs.system}"\n\t\t\t\tshortcut="{shortcut}"\n\t\t\t\thighlight="{attrs.highlight}"\n\t\t\t\ticomap="{_this.getFolder2IcoMap()}"\n\t\t\t\tisShortcut="{_this.isShortcut(folder)}"\n\t\t\t\tfolder-ico="{_this.getFolderIco(folder)}"\n\t\t\t\tshow-clear="{_this.isClearBtnVisible(folder)}"\n\t\t\t\tchild-level="{level}"\n\t\t\t\tis-expand-controls-visible="{_this.isFolderExpandControlsVisible(folder)}"\n\t\t\t\texpanded="{expanded}"\n\t\t\t\tis-parents-expanded="{_this.isFolderParentsExpanded(folder)}"\n\t\t\t\tnav-short="{attrs.short}"\n\t\t\t\tcounters-off="{attrs[\'counters-off\']}"\n\t\t\t\turl="{url}"\n\t\t\t\tunread="{(expanded && !attrs.short || folder.isDrafts() && attrs.short) ? _this.getUnreadCount(folder) : _this.unreadWithChild(folder)}"\n\t\t\t\ttouch-nav="{attrs[\'touch-nav\']}"\n\t\t\t\tavatarSrc="{_this.getAvatar(folder)}"\n\t\t\t\thas-parent-private-folders="{attrs[\'has-parent-private-folders\']}"\n\t\t\t\thas-virtual-containers="{attrs[\'has-virtual-containers\']}"\n\t\t\t>\n\t\t\t\t<a\n\t\t\t\t\tbem:elem="item"\n\t\t\t\t\tqa:id="{attrs.model.id}"\n\t\t\t\t\tdata-folder-link-id="{attrs.model.id}"\n\t\t\t\t\tqa:state="level:{attrs[\'child-level\']}"\n\t\t\t\t\tremit:mousedown="folderclickstart"\n\t\t\t\t\tremit:touchstart="folderclickstart"\n\t\t\t\t\tremit:mouseenter="folderhover"\n\t\t\t\t\tremit:click="folderclick"\n\t\t\t\t\tremit:contextmenu="rightclick"\n\t\t\t\t\tevent:details="attrs.model">\n\n\t\t\t\t\t<fn:add-class name="js-shortcut" test="attrs.shortcut" />\n\n\t\t\t\t\t<fn:attr name="href" value="{attrs.url}" test="attrs.url"/>\n\t\t\t\t\t<fn:attr name="title" value="{attrs[\'data-title\']}" test="attrs[\'data-title\']"/>\n\t\t\t\t\t<fn:attr name="data-title" value="{attrs[\'data-title\']}" test="attrs[\'data-title\']"/>\n\n\t\t\t\t\t<fn:var name="folder" value="{attrs.model}"/>\n\t\t\t\t\t<fn:var name="active" value="{attrs.active == attrs.model.id}"/>\n\n\t\t\t\t\t<bem:mod name="active" test="active" />\n\t\t\t\t\t<bem:mod name="shortcut" test="attrs.isShortcut" />\n\t\t\t\t\t<bem:mod name="highlight" test="attrs.highlight == attrs.model.id" />\n\t\t\t\t\t<bem:mod name="expanded" test="!(attrs[\'is-parents-expanded\'] && attrs.model.get(\'children\'))" value="{attrs.expanded}"/>\n\t\t\t\t\t<bem:mod name="child-level" value="{attrs[\'child-level\']}"/>\n\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tbem:elem="folder"\n\t\t\t\t\t\tqa:id="selected:{active ? \'true\' :\'false\'}"\n\t\t\t\t\t>\n\t\t\t\t\t\t\x3c!-- класс для стилей, дата атрибут для тестов --\x3e\n\t\t\t\t\t\t<bem:mod name="parent" test="attrs.model.get(\'children\')" />\n\t\t\t\t\t\t<fn:attr name="data-parent" value="{attrs.model.get(\'children\') ? \'true\' : \'false\'}"/>\n\n\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t\x3c!-- Разворот папок --\x3e // TODO: here\n\t\t\t\t\t\t\t<fn:when test="attrs[\'is-expand-controls-visible\']">\n\t\t\t\t\t\t\t\t<div bem:elem="folder-ico" qa:id="folder-arrow">\n\t\t\t\t\t\t\t\t\t<fn:if test="attrs.expanded">\n\t\t\t\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\t\t\t\tremit:click.prevent.stop="foldertoggle"\n\t\t\t\t\t\t\t\t\t\t\tico="navigation:drop_down_big"\n\t\t\t\t\t\t\t\t\t\t\tqa:id="arrow-up"\n\t\t\t\t\t\t\t\t\t\t\tbadge\n\t\t\t\t\t\t\t\t\t\t\ttitle="{i18n(\'Свернуть\')}"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t\t<fn:if test="!attrs.expanded">\n\t\t\t\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\t\t\t\tremit:click.prevent.stop="foldertoggle"\n\t\t\t\t\t\t\t\t\t\t\tico="navigation:drop_next_big"\n\t\t\t\t\t\t\t\t\t\t\tqa:id="arrow-down"\n\t\t\t\t\t\t\t\t\t\t\tbadge\n\t\t\t\t\t\t\t\t\t\t\tico-arrow-down\n\t\t\t\t\t\t\t\t\t\t\ttitle="{i18n(\'Развернуть\')}"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t\t\x3c!-- Иконка папок --\x3e\n\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t<div bem:elem="folder-ico" qa:id="folder-ico">\n\t\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\t\tname="{attrs[\'folder-ico\']}"\n\t\t\t\t\t\t\t\t\t\tmod="{attrs[\'folder-ico\']}"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t</fn:choose>\n\n\t\t\t\t\t\t<fn:if test="attrs[\'has-virtual-containers\'] && attrs[\'child-level\'] === 0 && attrs.avatarSrc">\n\t\t\t\t\t\t\t<div bem:elem="avatar" qa:id="avatar">\n\t\t\t\t\t\t\t\t<b:avatar\n\t\t\t\t\t\t\t\t\tsrc="{attrs.avatarSrc}"\n\t\t\t\t\t\t\t\t\tsize="xs"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t<fn:if test="folder.id === attrs[\'parent-private-folders-container-id\']">\n\t\t\t\t\t\t\t<div bem:elem="hidden-folders-icon" qa:id="hidden-folders-icon">\n\t\t\t\t\t\t\t\t<b:avatar\n\t\t\t\t\t\t\t\t\tico="status:lock_on_small"\n\t\t\t\t\t\t\t\t\tico-size="s"\n\t\t\t\t\t\t\t\t\tsize="xs"\n\t\t\t\t\t\t\t\t\twith-border="{false}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\x3c!-- Название папки --\x3e\n\t\t\t\t\t\t<div bem:elem="folder-name" qa:id="folder-name:name:{attrs.model.get(\'name\')}">\n\t\t\t\t\t\t\t<bem:mod name="secure" test="attrs.model.get(\'security\')"/>\n\t\t\t\t\t\t\t<bem:mod name="shared" test="attrs.model.isShared()"/>\n\t\t\t\t\t\t\t<bem:mod name="shared-give" test="attrs.model.isShareGive()"/>\n\n\t\t\t\t\t\t\t<div bem:elem="folder-name__txt" qa:id="folder-name">\n\t\t\t\t\t\t\t\t<fn:value>attrs.title</fn:value>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<fn:if test="attrs.model.isSecure()">\n\t\t\t\t\t\t\t\t<div bem:elem="folder-name__lock">\n\t\t\t\t\t\t\t\t\t\x3c!-- Замок если папка запаролена --\x3e\n\t\t\t\t\t\t\t\t\t<fn:if test="!attrs.model.isSecureOpen()">\n\t\t\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\t\t\tname="{attrs.icomap[\'lock-on_fill\']}"\n\t\t\t\t\t\t\t\t\t\t\tmod="{attrs.icomap[\'lock-on_fill\']}"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t\t\x3c!-- Замок если папка распаролена --\x3e\n\t\t\t\t\t\t\t\t\t<fn:if test="attrs.model.isSecureOpen()">\n\t\t\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\t\t\tname="{attrs.icomap[\'lock-off_fill\']}"\n\t\t\t\t\t\t\t\t\t\t\tmod="{attrs.icomap[\'lock-off_fill\']}"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t<fn:if test="attrs.model.isShareGive()">\n\t\t\t\t\t\t\t\t<div bem:elem="folder-name__shared">\n\t\t\t\t\t\t\t\t\t\x3c!-- Значок расшаренной папки --\x3e\n\t\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\t\tname="{attrs.icomap[\'shared\']}"\n\t\t\t\t\t\t\t\t\t\tmod="{attrs.icomap[\'shared\']}"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\x3c!-- Кнопка Очистить для корзины и спама, если там есть письма --\x3e\n\t\t\t\t\t\t<fn:if test="attrs[\'show-clear\']">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tbem:elem="folder-clear"\n\t\t\t\t\t\t\t\tqa:id="folder-clear"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\t\tradar-id="clear-{folder.isTrashLike() ? \'trash\' : \'spam\'}"\n\t\t\t\t\t\t\t\t\tremit:click.prevent="clear"\n\t\t\t\t\t\t\t\t\tevent:details="{model:folder}"\n\t\t\t\t\t\t\t\t\ttext="{i18n(\'Очистить\')}"\n\t\t\t\t\t\t\t\t\tbadge\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\x3c!-- Счетчик непрочитанных --\x3e\n\t\t\t\t\t\t<fn:if test="!attrs[\'counters-off\'] && attrs.unread && !folder.isTrashLike() && !folder.isSpam() && !folder.isArchive()">\n\t\t\t\t\t\t\t<div bem:elem="folder-badge" data-folder-id="{folder.id}">\n\t\t\t\t\t\t\t\t<fn:var name="unreadLimit" value="{attrs[\'nav-short\'] ? 99 : 999}"/>\n\t\t\t\t\t\t\t\t<b:badge\n\t\t\t\t\t\t\t\t\t\ttext="{attrs.unread > unreadLimit ? unreadLimit + \'+\' : attrs.unread}"\n\t\t\t\t\t\t\t\t\t\tsize="{attrs[\'nav-short\'] ? attrs.ponymode ? \'xxs_alt\' : \'s_alt\' : \'m\'}"\n\t\t\t\t\t\t\t\t\t\ttransparent="{attrs.short}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</b:immutable-virtual-block>\n\t\t\t<fn:if test="!attrs[\'hide-add-folder\'] && !attrs.short && attrs[\'has-virtual-containers\'] && _this.isMyFoldersContainerExpanded() && _this.isLastOfMyFolders(folder)">\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="new-folder-btn-wrapper"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="pony-mode" test="attrs.ponymode" />\n\t\t\t\t\t<b:new-folder-btn\n\t\t\t\t\t\tkey="{folder.id}"\n\t\t\t\t\t\tisSidebar="{!!attrs.sidebar}"\n\t\t\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\t\t</fn:match>\n\n\t\t<fn:match name="nav-foot">\n\t\t\t<fn:if test="!attrs[\'hide-add-folder\'] && !attrs.short && !attrs[\'has-virtual-containers\']">\n\t\t\t\t<fn:if test="!attrs[\'show-unsubscribe-button\']">\n\t\t\t\t\t<hr bem:elem="hr"/>\n\t\t\t\t</fn:if>\n\n\t\t\t\t<b:new-folder-btn\n\t\t\t\t\tisSidebar="{!!attrs.sidebar}"\n\t\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t\t<fn:if test="attrs[\'touch\'] && attrs[\'touch-nav\']">\n\t\t\t\t<a bem:elem="item" remit:click.prevent.stop="settings:click" href="/settings/">\n\t\t\t\t\t<table bem:elem="folder">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td bem:elem="folder-ico">\n\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\tname="setting"\n\t\t\t\t\t\t\t\t\tmod="setting"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td bem:elem="folder-name">\n\t\t\t\t\t\t\t\t<div bem:elem="folder-name__txt">\n\t\t\t\t\t\t\t\t\t<fn:value>i18n(\'Настройки\')</fn:value>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</a>\n\t\t\t</fn:if>\n\t\t\t<fn:if test="attrs[\'show-unsubscribe-button\']">\n\t\t\t\t<hr bem:elem="hr"/>\n\t\t\t\t<b:react-async\n\t\t\t\t\t\t\tcomponent="SidebarUnsubscribeButton"\n\t\t\t\t\t\t\tshowTitle\n\t\t\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</fn:match>\n\t</b:nav>\n</div>\n',"app/feast-tpl!ui-block/nav-folders/nav-folders.html")});define("feast-tpl!ui-block/nav-folders/nav-folders.html",["feast-tpl!app/feast-tpl!ui-block/nav-folders/nav-folders.html"],function(a){return a});define("helpers/folder-to-ico-map",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getFolderType=c;exports.getFolderIco=d;var a={inbox:"categories:mail",sent:"actions:reply",drafts:"categories:drafts",templates:"navigation:folder",spam:"actions:dislike",trash:"actions:delete",archive:"actions:archive",user:"navigation:folder",social:"navigation:users",promotions:"categories:discounts",newsletters:"categories:mailings",tomyself:"categories:self_mail",news:"categories:subscriptions",official:"categories:government",receipts:"categories:receipts",school:"categories:school",games:"categories:games",outbox:"status:time",folder:"navigation:folder",shared:"navigation:user_s",child_trash:"actions:delete",parental_control:"navigation:tip","lock-on":"status:lock_on_small","lock-off":"status:lock_off_small","lock-on_fill":"mail_20:status:lock_on_small","lock-off_fill":"mail_20:status:lock_off_small"};exports.default=a;var b=exports.folder2icoMapHelperPonyMode={inbox:"categories:mail_s",sent:"actions:reply_s",drafts:"categories:drafts_s",templates:"navigation:folder_s",spam:"actions:dislike_s",trash:"actions:delete_s",archive:"actions:archive_s",user:"navigation:folder_s",social:"navigation:users_s",promotions:"categories:discounts",newsletters:"categories:mailings_s",tomyself:"categories:self_mail_s",news:"categories:subscriptions_s",official:"categories:government_s",receipts:"categories:receipts_s",school:"categories:school_s",games:"categories:games_s",outbox:"status:time_s",folder:"navigation:folder_s",shared:"navigation:user_s",child_trash:"actions:delete_s",parental_control:"navigation:tip_s","lock-on":"status:lock_on_small","lock-off":"status:lock_off_small","lock-on_fill":"mail_20:status:lock_on_small","lock-off_fill":"mail_20:status:lock_off_small"};function c(a){var b=a.get("type");if(b==="archive"&&!a.isArchive()){b="user"}if(a.isArchive()){b="archive"}return b}function d(b){var d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:a;var e=c(b);return b.isSystem()||b.isArchive()?d[e]||d.folder:d.folder}});define("feast-tpl!app/feast-tpl!ui-block/nav/nav.html",["feast"],function(a){return a.smartParse('<nav>\n\t<bem:mod name="short" test="attrs.short"/>\n\t<bem:mod name="expanded" test="!attrs.short"/>\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="clean" test="attrs.clean"/>\n\t<bem:mod name="touch-nav" test="attrs[\'touch-nav\']"/>\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']"/>\n\t<bem:mod name="pony-mode" test="attrs[\'pony-mode\']"/>\n\n\t\x3c!-- Для nav.spec.js--\x3e\n\t<fn:match name="nav-item" args="item">\n\t\t<span\n\t\t\tbem:elem="item"\n\t\t\tkey="{item.id}">\n\n\t\t\t<bem:mod name="active" test="item.active" />\n\t\t\t<bem:mod name="shortcut" test="attrs.short" />\n\n\t\t\t<table bem:elem="folder">\n\t\t\t\t<tr>\n\t\t\t\t\t<td bem:elem="folder-ico">\n\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\tname="{item.icon}"\n\t\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\t\t\t\t\t<fn:if test="!attrs.short">\n\t\t\t\t\t\t<td bem:elem="folder-name">\n\t\t\t\t\t\t\t<div bem:elem="folder-name__txt">\n\t\t\t\t\t\t\t\t<fn:value>item.title</fn:value>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</span>\n\t</fn:match>\n\n\t<fn:apply-match name="nav-head"/>\n\n\n\t<fn:var name="myFoldersItem" value="{_this.getMyFoldersItem(attrs.models)}"/>\n\n\t<fn:if test="attrs[\'has-parent-private-folders\']">\n\t\t<fn:apply-match name="nav-item" args="_this.getParentPrivateFoldersItem()" />\n\t\t<fn:for data="_this.getParentPrivateFolders(attrs.models)" as="item">\n\t\t\t<fn:if test="!item.hidden">\n\t\t\t\t<fn:apply-match name="nav-item" args="item" />\n\t\t\t</fn:if>\n\t\t</fn:for>\n\t\t<hr bem:elem="hr"/>\n\t</fn:if>\n\n\t<fn:if test="!!myFoldersItem">\n\t\t<fn:apply-match name="nav-item" args="myFoldersItem"/>\n\t</fn:if>\n\t<fn:for data="_this.getCommonFolders(attrs.models)" as="item">\n\t\t<fn:if test="!item.hidden">\n\t\t\t<fn:apply-match name="nav-item" args="item" myFoldersItem="myFoldersItem"/>\n\t\t</fn:if>\n\t</fn:for>\n\n\t<fn:apply-match name="nav-foot"/>\n</nav>\n',"app/feast-tpl!ui-block/nav/nav.html")});define("feast-tpl!ui-block/nav/nav.html",["feast-tpl!app/feast-tpl!ui-block/nav/nav.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/nav/nav",["require","exports","default-values","feast","feast-tpl!./nav.html","helpers/browser","helpers/folder","mail/Folder","ui-block/ico/ico"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);exports.default=b.default.Block.extend({name:"nav",template:c.default,defaults:{"hover-support":d.default.capabilities["hover-support"]},blocks:{ico:g.default},getMyFoldersItem:function(){var b=this.get("models");if(!f.default.all.hasSharedTake.call(b)&&!this.get("has-parent-private-folders")){return null}var c=this.get("has-parent-private-folders")?i18n("Детские папки"):i18n("Мои папки");if(this.myFoldersItem&&this.myFoldersItem.get("name")===c){return this.myFoldersItem}this.myFoldersItem=new f.default((0,e.virtualFolderData)({type:a.NAV_MY_FOLDERS_CONTAINER_ID,name:c}));return this.myFoldersItem},getParentPrivateFoldersItem:function(){if(!this.get("has-parent-private-folders")){return null}if(this.parentPrivateFoldersItem){return this.parentPrivateFoldersItem}this.parentPrivateFoldersItem=new f.default((0,e.virtualFolderData)({type:a.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID,name:i18n("Скрытые папки")}));return this.parentPrivateFoldersItem},getParentPrivateFolders:function(a){return a.filter(function(a){return(0,e.isParentPrivateFolder)(a)})},getCommonFolders:function(a){return a.filter(function(a){return!(0,e.isParentPrivateFolder)(a)})}})});define("feast-tpl!app/feast-tpl!ui-block/new-folder-btn/new-folder-btn.html",["feast"],function(a){return a.smartParse('<div data-qa-id="new-folder-btn">\n\t<bem:mod name="in-sidebar" test="attrs.isSidebar"/>\n\t<bem:mod name="ponymode" test="attrs.ponymode"/>\n\n\t<div bem:elem="button-wrapper">\n\t\t<b:button2\n\t\t\tbem:elem="btn"\n\t\t\tremit:click="openPopup"\n\t\t\tshort="{attrs.short}"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tdropmenu="{!attrs.isSidebar}"\n\t\t\tnowrap\n\t\t\ttext-overflow\n\t\t\tfluid="{!_this.useNewToolbar()}"\n\t\t\tfill="{_this.useNewToolbar()}"\n\t\t\tpure\n\t\t\tico="{attrs.ponymode ? \'actions:add\' : \'actions:add_big\'}"\n\t\t\ttext="{i18n(\'Новая папка\')}"\n\t\t/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/new-folder-btn/new-folder-btn.html")});define("feast-tpl!ui-block/new-folder-btn/new-folder-btn.html",["feast-tpl!app/feast-tpl!ui-block/new-folder-btn/new-folder-btn.html"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/new-folder-btn/new-folder-btn",["require","exports","default-values","feast","feast-tpl!./new-folder-btn.html","ui-block/button2/button2"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);exports.default=b.default.Block.extend({name:"new-folder-btn",template:c.default,events:{openPopup:"openPopup"},blocks:{button2:d.default},didMount:function(){var a=this;new Promise(function(a,b){require(["mediator/folders-actions"],a,b)}).then(__importStar).then(function(b){var c=b.default;c.register(a)})},openPopup:function(){this.broadcast("add",{model:{params:{isSidebar:this.get("isSidebar")}}})},useNewToolbar:function(){return a.NEW_TOOLBAR}})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/nav-folders/nav-folders",["require","exports","@mail/xray","default-values","feast","feast-mod/folder-name","feast-mod/letter-count","feast-mod/letters-count","feast-tpl!./nav-folders.html","helpers/browser","helpers/folder","helpers/folder-to-ico-map","helpers/get-avatar-path","helpers/keys","mail/Folder","service/auth","service/contextmenu","service/radars/decorator","service/radars/index","service/secure-folder","service/smokescreen","service/storage","ui-block/avatar/avatar","ui-block/badge/badge","ui-block/button2/button2","ui-block/ico/ico","ui-block/nav/nav","ui-block/new-folder-btn/new-folder-btn","ui-block/react-async/react-async","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);g=__importDefault(g);h=__importDefault(h);j=__importStar(j);k=__importDefault(k);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);var C="folders:expanded";var D=t.default.get(C)||{};var E=h.default.capabilities["touch-support"];exports.default=y.default.extend((0,p.default)({explicit:"radar"})({name:"nav-folders",template:g.default,isolateEvents:false,blocks:{ico:x.default,nav:y.default,button2:w.default,badge:v.default,"new-folder-btn":z.default,avatar:u.default,"react-async":A.default},folder2shortcutMap:{inbox:"g,i",drafts:"g,d",sent:"g,s"},displayedShortcut:["parental_control","inbox","sent","drafts","outbox","archive","spam","trash","child_trash"],events:{foldertoggle:"onFolderClick",folderclick:"onFolderLinkClick",rightclick:"onRightClick"},defaults:{short:false,active:null,"handle-drop":false,router:null,"counters-off":false,"with-clear":false,mobile:b.TOUCH_MODE,"without-press-context-menu":false,"read-only":false,hasSharedFolders:false,lastOfMyFoldersId:false,"has-parent-private-folders":false,"has-virtual-containers":false,"parent-private-folders-container-id":b.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID,"show-unsubscribe-button":false},attrChanged:{active:function(a){var c=m.default.all.get(a);if(c){var d=c.get("parent");if(this.isFolderInMyFoldersContainer(c)){d=b.NAV_MY_FOLDERS_CONTAINER_ID}else if((0,i.isParentPrivateFolder)(c)){d=b.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID}if(d!=-1&&!D[d]){this.toggleFolderExpand(d)}}},models:function(){var a=this.get("models");var b=m.default.all.hasSharedTake.call(a);var c=b||(0,i.hasParentPrivateFolders)(a);if(c||c!==this.get("has-virtual-containers")||(0,i.hasParentPrivateFolders)(a)!==this.get("has-parent-private-folders")){this.set({"has-parent-private-folders":(0,i.hasParentPrivateFolders)(a),"has-virtual-containers":c,lastOfMyFoldersId:this.getLastOfMyFoldersId()})}}},didMount:function(){var a=this;this._dragExpandedFolders=[];this.highlight=null;if(E){(0,B.lazyHammerJS)().then(function(b){if(!a.isMounted()){return}var c=new b.Manager(a.el);var d=new b.Press({time:500});c.add(d);c.on("press",function(b){var c,d;var e=b.target.closest("[data-folder-link-id]");if(e){var f=m.default.all.get(e.dataset.folderLinkId);var g=__assign(__assign({},b),{originalEvent:b.srcEvent,details:f});(d=(c=a.attrs).onPress)===null||d===void 0?void 0:d.call(c,f);if(a.attrs["without-press-context-menu"]){return}a.onRightClick(g)}})})}},$handleEvent:function(a){var b=this;c.default.Block.prototype.$handleEvent.call(this,a);if(this.mounted&&this.get("handle-drop")&&(a.type==="$created"||a.type==="$mount")){this.el.dragHandleEvent=function(a){return b.dragHandleEvent(a)}}},didUnmount:function(){this.el.dragHandleEvent=null},dragHandleEvent:function(a){var b=this;var d=a.target;var e=null;if(!this.el){return}if(a.type==="drop"){var f=m.default.all.get(this.highlight);f&&this.broadcast("drop",f)}else{var g=s.default.lookup("nav__item");while(d!==document){if(typeof d.className==="string"&&d.className.includes(g)){var h=c.default.Block.get(d);e=h?h.get("model").id:null;break}d=d.parentNode}}if(this.highlight!==e){this.highlight=e}switch(a.type){case"dragleave":case"drop":clearTimeout(this._dragFolderExpandTimer);this._lastFolderId=null;this._dragCollapseTimeout=setTimeout(function(){while(b._dragExpandedFolders.length){b.toggleFolderExpand(b._dragExpandedFolders.pop())}},600);break;case"dragenter":clearTimeout(this._dragCollapseTimeout);break;case"dragmove":if(e&&this._lastFolderId!==e){clearTimeout(this._dragFolderExpandTimer);this._lastFolderId=e;if(!this.isExpanded(e)){this._dragFolderExpandTimer=setTimeout(function(){b.toggleFolderExpand(e);b._dragExpandedFolders.push(e)},600)}}break}if(this.get("short")){switch(a.type){case"dragenter":clearTimeout(this._onDragOverTimer);this._onDragOverTimer=setTimeout(function(){b.broadcast("drag:over")},1e3);break;case"dragleave":case"drop":clearTimeout(this._onDragOverTimer);this.highlight=null;break}}},onFolderClick:function(a){var b=a.details;var c=b.get("model").id;this.toggleFolderExpand(c)},toggleFolderExpand:function(a){var b=true;if(D[a]){D[a]=false;b=false}else{D[a]=true}t.default.set(C,D);this.radar([b?"expand":"collapse"]);this.render()},isExpanded:function(a){if(D[a]===undefined){if(this.isMyFoldersContainerById(a)||this.isParentPrivateFoldersContainerById(a)){D[a]=true;return D[a]}var b=m.default.all.get(a);if(b&&b.getChildLevel()!==b.getMaxChildLevel()){D[a]=!b.get("security")}}return D[a]||false},isFolderParentsExpanded:function(a){if(!this.get("has-virtual-containers")&&a.isRoot()){return true}if(this.get("has-virtual-containers")){if(this.isFoldersContainer(a)){return true}if(a.isRoot()){return this.isMyFoldersContainerExpanded()}}var c=a.get("parent");var d=m.default.all.get(c);var e=d.getChildLevel();var f=e>=Math.min(d.getMaxChildLevel(),b.FOLDER_MAX_CHILD_LEVEL_UI);var g=this.isExpanded(c)||f;return g?this.isFolderParentsExpanded(d):false},isFolderExpanded:function(a){if(this.is("touch-nav")){return true}if(this.is("expand-all")){return true}if(this.get("has-parent-private-folders")&&a.isRoot()&&(0,i.isParentPrivateFolder)(a)&&!this.isParentPrivateFoldersContainer(a)){return this.isExpanded(b.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID)&&(!a.get("children")||this.isExpanded(a.id))}if(this.isFolderInMyFoldersContainer(a)){return this.isMyFoldersContainerExpanded()&&(!a.get("children")||this.isExpanded(a.id))}if(a.isRoot()&&!a.get("children")){return true}if(!this.isFolderParentsExpanded(a)){return false}if(a.getChildLevel()===a.getMaxChildLevel()){return true}if(!a.isParent()){return true}return this.isExpanded(a.id)},getFolderUrl:function(a){if(this.attrs["read-only"]){return""}var b=this.get("router");var c=a.get("id");if(a.isServiceShared()){c=this.getFirstSubFolderId(c)||c}if(this.isMyFoldersContainerById(c)){c=m.default.INBOX}var d=null;if(this.get("showBackToParentFolder")&&c==b.route.params.folder){d={"to-parent-button":1}}return b&&b.getUrl("#letters",{folder:c},d)},onFolderLinkClick:function(c){var d=this;var e,f;var g=c.details.id;(f=(e=this.attrs).onFolderClick)===null||f===void 0?void 0:f.call(e,m.default.all.get(g));if(c.isDefaultPrevented()||this.attrs["read-only"]){return}if(this.get("has-virtual-containers")){var h=m.default.all.get(g);var i=h===null||h===void 0?void 0:h.get("parent");switch(true){case this.isMyFoldersContainerById(g):{i=b.NAV_MY_FOLDERS_CONTAINER_ID;g=m.default.INBOX;break}case this.isParentPrivateFoldersContainerById(g):{i=b.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID;g=this.getFirstParentControlFolder();break}case h===null||h===void 0?void 0:h.isServiceShared():{i=h.get("id");g=this.getFirstSubFolderId(g)||g;break}}if(!D[i]){this.toggleFolderExpand(i)}}var j=c.originalEvent;if(j&&(0,l.isNewTabClick)(j)){return}else{c.preventDefault()}var k=this.get("router");if(!k){return}m.default.findOne(g).then(function(b){d.radar(b.get("type"));a.default.send("select_metathread_folder_navigate",{dwh:{category:g,name:b.get("name")}});if(b.isSecureOpen()){d.goToFolder(g);return}(0,r.default)(b).then(function(a){return a&&d.goToFolder(g)})});return true},goToFolder:function(b){if(!this.isMounted()){return}var c=this.get("router");var e=null;if(this.get("showBackToParentFolder")&&b==c.route.params.folder){e={"to-parent-button":1}}c&&c.go("#letters",{folder:b},e,{force:true});var f=(0,d.getFolderName)(m.default.all.get(b));a.default.send("go_to_folder",{i:{id:b},dwh:{id:b,name:f,folderPos:m.default.all.indexOf(b),foldersQty:m.default.all.length}});(0,q.default)({chain:["go","to","folder"],data:{folder:b}});var g=m.default.all.get(b);if(g.isShareTake()){a.default.send("open_shared_folder")}},getMyFoldersContainerMessagesCount:function(){if(this.isMyFoldersContainerExpanded()){return 0}return m.default.all.reduce(function(a,b){if(b.isShareTake()){return a}if(!b.isRoot()){return a}if((0,i.isParentPrivateFolder)(b)){return a}return a+(0,f.countUnreadMod)(b,true)},0)},getParentPrivateFoldersContainerMessagesCount:function(){if(this.isExpanded(b.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID)){return 0}return m.default.all.reduce(function(a,b){if(!b.isRoot()){return a}if(!(0,i.isParentPrivateFolder)(b)){return a}return a+(0,f.countUnreadMod)(b,true)},0)},unreadWithChild:function(a){if(this.isMyFoldersContainer(a)){return this.getMyFoldersContainerMessagesCount()}if(this.isParentPrivateFoldersContainer(a)){return this.getParentPrivateFoldersContainerMessagesCount()}return(0,f.countUnreadMod)(a)},getUnreadCount:function(a){if(this.isMyFoldersContainer(a)){return this.getMyFoldersContainerMessagesCount()}if(this.isParentPrivateFoldersContainer(a)){return this.getParentPrivateFoldersContainerMessagesCount()}return this.isFolderExpanded(a)?(0,f.countUnreadMod)(a,false):(0,f.countUnreadMod)(a)},getTotalCount:function(a){return this.isFolderExpanded(a)?(0,f.countTotalMod)(a,false):(0,f.countTotalMod)(a)},isShortcut:function(a){var b=a.get("type");return a.get("system")&&this.displayedShortcut.includes(b)&&!a.isShareTake()},onRightClick:function(a){if(this.attrs["without-press-context-menu"]){return}if(this.get("has-virtual-containers")){var b=a.details.id;var c=this.isMyFoldersContainerById(b)||this.isParentPrivateFoldersContainerById(b)||this.isOtherUserFoldersContainerById(b);if(c){a.preventDefault();return}}if(!this.get("touch")){o.default.show(a)}},getFolderType:j.getFolderType,getFolder2IcoMap:function(){return this.is("ponymode")?j.folder2icoMapHelperPonyMode:j.default},getFolderIco:function(a){return(0,j.getFolderIco)(a,this.getFolder2IcoMap())},getFolderTitle:function(a){if(this.is("mobile")){return null}if(this.is("short")){return a.get("name")}if(!a.isSecureOpen()){return i18n("{folderName}, защищено паролем",{folderName:a.get("name")})}if(this.isFoldersContainer(a)&&this.isFolderExpanded(a)){return a.get("name")}var b=this.getTotalCount(a);var c=this.getUnreadCount(a);var d=a.get("name");if(!b&&!c){return"".concat(d,", ").concat(i18n("нет писем"))}if(b){var f=(0,e.letterCount)(b);d+=", ".concat(f)}if(c){var g={count:c};var f=i18n.plural(c,[i18n("{count} непрочитанных",g),i18n("{count} непрочитанное",g),i18n("{count} непрочитанных",g)]);d+=", ".concat(f)}return d},isClearBtnVisible:function(a){return this.attrs["with-clear"]&&(a.isTrashLike()||a.isSpam()&&!b.HIDE_CLEAR_BUTTON_ON_SPAM_FOLDER)&&a.get("messages_total")!==0&&a.checkGrant(m.default.SHARE_GRANTS.remove)&&!(0,i.isDeleteFromFolderDisabled)(a)},isMyFoldersContainer:function(a){var b=a.get("id");return this.isMyFoldersContainerById(b)},isMyFoldersContainerById:function(a){return a===b.NAV_MY_FOLDERS_CONTAINER_ID},isMyFoldersContainerExpanded:function(){return this.isExpanded(b.NAV_MY_FOLDERS_CONTAINER_ID)},isOtherUserFoldersContainerById:function(a){var b=m.default.all.get(a);return b&&b.isRoot()&&b.isShareTake()},isOtherUserFoldersContainer:function(a){return a.isServiceShared()},isParentPrivateFoldersContainerById:function(a){return a===b.NAV_PARENT_PRIVATE_FOLDERS_CONTAINER_ID},isParentPrivateFoldersContainer:function(a){return this.isParentPrivateFoldersContainerById(a.get("id"))},isFoldersContainer:function(a){return this.isMyFoldersContainer(a)||this.isOtherUserFoldersContainer(a)||this.isParentPrivateFoldersContainer(a)},getFolderLevel:function(a){if(!this.get("has-virtual-containers")){return a.getChildLevel()}if(this.isMyFoldersContainer(a)||this.isParentPrivateFoldersContainer(a)){return 0}if(a.isShareTake()){return a.getChildLevel()}return a.getChildLevel()+1},getLimitedFolderLevel:function(a){var c=this.getFolderLevel(a);return Math.min(b.FOLDER_MAX_CHILD_LEVEL_UI,c)},isLastOfMyFolders:function(a){return a.get("id")===this.get("lastOfMyFoldersId")},getAvatar:function(a){var b;var c;if(this.isMyFoldersContainer(a)){var d=n.default.user;b=d.getEmail();c=d.getFullName()}else{var d=a.get("owner");b=d.email;c=d.name}if(!b){return null}return(0,k.default)({email:b,name:c,size:45})},getTitle:function(a){if(this.isOtherUserFoldersContainer(a)){var b=a.get("owner").email;return b}return a.get("name")},isFolderExpandControlsVisible:function(a){var c=a.getChildLevel();return a.get("children")&&!this.is("touch-nav")&&!this.is("short")&&!this.is("expand-all")&&b.FOLDER_MAX_CHILD_LEVEL_UI>c&&a.getMaxChildLevel()>c},getLastOfMyFoldersId:function(){var a=this.get("models")||[];a=a.filter(function(a){return!(0,i.isParentPrivateFolder)(a)});var b=Array.prototype.findIndex.call(a,function(a){return a.isShareTake()});if(b===-1){return a[a.length-1].get("id")}return a[b-1].get("id")},getFirstSubFolderId:function(a){var b=this.get("models")||[];var c=Array.prototype.find.call(b,function(b){return b.get("parent")===a});return c===null||c===void 0?void 0:c.get("id")},getFirstParentControlFolder:function(){var a=this.get("models")||[];var b=Array.prototype.find.call(a,i.isParentPrivateFolder);return b===null||b===void 0?void 0:b.get("id")},isFolderInMyFoldersContainer:function(a){return this.get("has-virtual-containers")&&a.isRoot()&&!a.isShareTake()&&!(0,i.isParentPrivateFolder)(a)&&!this.isParentPrivateFoldersContainer(a)}}))});define("feast-tpl!app/feast-tpl!ui-block/sidebar/sidebar.html",["feast"],function(a){return a.smartParse('<div>\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="short" value="{attrs.short}" />\n\t<fn:var name="open" value="{short && attrs.open}" />\n\t<fn:var name="shortcut" value="{short && !attrs.open}"/>\n\t<fn:var name="ponyMode" value="{attrs.ponymode}"/>\n\t<fn:var name="widget" value="{attrs.widget}"/>\n\t<fn:var name="isSearch" value="{attrs.isSearch}"/>\n\n\t\x3c!-- Modificators --\x3e\n\t<bem:mod name="short" test="short"/>\n\t<bem:mod name="open" test="open"/>\n\t<bem:mod name="closed" test="!open"/>\n\t<bem:mod name="pony-mode" test="ponyMode"/>\n\t<bem:mod name="widget" test="widget"/>\n\t<bem:mod name="search" test="isSearch"/>\n\n\t\x3c!-- Список папок компактный (шорткаты) --\x3e\n\t<div\n\t\tfn:if="_this.hasShortMenu()"\n\t\tbem:elem="short"\n\t\tqa:id="short"\n\t\tref="short"\n\t>\n\t\t<bem:mod name="fixed"/>\n\n\t\t<div ref="top-menu-short">\n\t\t\t<fn:apply-match name="sidebar-top-menu" args="true, open"/>\n\t\t</div>\n\n\t\t<b:scrollable\n\t\t\tid="scrollShort"\n\t\t\tref="scrollShort"\n\t\t\tscroll-style="{attrs[\'short-scroll-style\']}"\n\t\t\tponymode="{ponyMode}"\n\t\t\tdisable-horizontal-scroll\n\t\t>\n\t\t\t<div ref="content-short">\n\t\t\t\t<fn:apply-match name="sidebar-content" args="true, open"/>\n\t\t\t</div>\n\t\t</b:scrollable>\n\n\t\t<div ref="bottom-menu-short" bem:elem="bottom-menu">\n\t\t\t<bem:mod name="css-vars-fallback" test="attrs[\'css-vars-fallback\']"/>\n\n\t\t\t<fn:apply-match name="sidebar-bottom-menu" args="true"/>\n\t\t</div>\n\t</div>\n\n\t\x3c!-- Список полный или раскрытый --\x3e\n\t<fn:if test="_this.hasFullMenu()" animated>\n\t\t<div\n\t\t\tref="full"\n\t\t\tbem:elem="full"\n\t\t\tqa:id="full"\n\t\t>\n\t\t\t<bem:mod name="fixed" test="!open"/>\n\t\t\t<bem:mod name="left" test="attrs[\'open-left\']"/>\n\n\t\t\t<div ref="top-menu-full">\n\t\t\t\t<fn:apply-match name="sidebar-top-menu" args="false, open"/>\n\t\t\t</div>\n\n\t\t\t<b:scrollable\n\t\t\t\tid="scrollFull"\n\t\t\t\tref="scrollFull"\n\t\t\t\tponymode="{ponyMode}"\n\t\t\t\tsidebar\n\t\t\t>\n\t\t\t\t<div ref="content-full">\n\t\t\t\t\t<fn:apply-match name="sidebar-content" args="false, open"/>\n\t\t\t\t</div>\n\t\t\t</b:scrollable>\n\n\t\t\t<div ref="bottom-menu-full" bem:elem="bottom-menu">\n\t\t\t\t<bem:mod name="css-vars-fallback" test="attrs[\'css-vars-fallback\']"/>\n\n\t\t\t\t<fn:apply-match name="sidebar-bottom-menu" args="false, open"/>\n\t\t\t</div>\n\t\t</div>\n\t</fn:if>\n\n\t<fn:apply-match name="sidebar-bottom-widget" args="shortcut" fn:if="widget"/>\n</div>\n',"app/feast-tpl!ui-block/sidebar/sidebar.html")});define("feast-tpl!ui-block/sidebar/sidebar.html",["feast-tpl!app/feast-tpl!ui-block/sidebar/sidebar.html"],function(a){return a});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();define("helpers/debounce-frame",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ConcatFrameDebouncer=exports.FrameDebouncer=void 0;var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.webkitRequestAnimationFrame;var b=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.webkitCancelAnimationFrame;var c=function(a){return window.setTimeout(a,0)};var d=a||c;var e=function(){};var f=function(){function c(a){var b=this;this.fn=a;this.pending=false;this._handle=function(){b.pending=false;if(b.destroyed){return}b.fn.apply(b,b.args);b.args=undefined}}c.prototype.saveArgs=function(a){this.args=a};c.prototype.requestDebouncedFrame=function(){var a=[];for(var b=0;b<arguments.length;b++){a[b]=arguments[b]}this.saveArgs(a);if(this.pending){return}this.pending=true;this.requestID=d(this._handle)};c.prototype.destroy=function(){this.requestDebouncedFrame=e;this.destroyed=true;if(d===a){b(this.requestID)}else{window.clearTimeout(this.requestID)}};return c}();exports.FrameDebouncer=f;var g=function(a){__extends(b,a);function b(){return a!==null&&a.apply(this,arguments)||this}b.prototype.saveArgs=function(a){this.args=this.args?[this.args[0].concat(a)]:a};return b}(f);exports.ConcatFrameDebouncer=g});var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/sidebar/sidebar",["require","exports","@mail/xray","default-values","feast","feast-tpl!./sidebar.html","helpers/debounce-frame","resize-observer-polyfill","service/promo","service/radars/decorator","ui-block/ico/ico","ui-block/scrollable/scrollable"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);function k(a,b){var c,d;var e=parseInt(getComputedStyle(b).getPropertyValue("--vkui--octavius_size_sidebar_padding_top--regular"))||12;var f=b.offsetHeight-e;var g=f;var h=a.header,i=a.content,j=a.footer,k=a.themesWidget;var l=h.el.offsetHeight;g-=l;g-=j.minSize;var m=(d=(c=k===null||k===void 0?void 0:k.el)===null||c===void 0?void 0:c.offsetHeight)!==null&&d!==void 0?d:0;g-=m;var n=j.minSize;var o=i.el.offsetHeight-g;if(o>0){return{header:l,themesWidget:m,footer:n}}else{var p=-o;return{header:l,themesWidget:m,footer:j.minSize+p}}}exports.default=c.default.Block.extend((0,h.default)({explicit:"radar"})({name:"sidebar",template:d.default,blocks:{ico:i.default,scrollable:j.default},events:{"sidebar:toggle":"onToggleOpenState"},defaults:{open:false,"open-left":false,ponymode:false,short:false,isSearch:false,"css-vars-fallback":b.CSS_VARS_FALLBACK},attrChanged:{open:function(a){this[a?"$on":"$off"](this.el.ownerDocument,"mousedown",this.onOutsideClick);a&&this.radar("open")},short:function(a){if(!a){this.close()}}},constructor:function(){c.default.Block.prototype.constructor.apply(this,arguments);this.subscribeToResize=this.subscribeToResize.bind(this);this.onResizeFull=this.onResizeFull.bind(this);this.onResizeShort=this.onResizeShort.bind(this);this.onOutsideClick=this.onOutsideClick.bind(this);var a=new e.ConcatFrameDebouncer(this.onResizeFull);var b=new e.ConcatFrameDebouncer(this.onResizeShort);this.resizeObserver=new f.default(function(b){a.requestDebouncedFrame(b)});this.shortResizeObserver=new f.default(function(a){b.requestDebouncedFrame(a)});this.resizeDebouncer=a;this.shortResizeDebouncer=a},onResizeFull:function(){if(b.NEW_TOOLBAR||!this.hasFullMenu()){return}this.broadcast("resize-full",k(this.getFullBlocks(),this.refs.full))},onResizeShort:function(c){if(!this.isMounted()){a.default.send("sidebar-resize-after-unmount",{rlog:"octavius-sidebar-update-err",rlog_message:{name:"sidebar-resize-after-unmount",state:{zombie:this.zombie,destroyed:this.destroyed,mounted:this.mounted,unmountCalled:this.unmountCalled},entries:c===null||c===void 0?void 0:c.map(function(a){var b;return(b=a===null||a===void 0?void 0:a.target)===null||b===void 0?void 0:b.className}),err:new Error("empty")}});return}if(b.NEW_TOOLBAR||!this.hasShortMenu()){return}this.broadcast("resize-short",k(this.getShortBlocks(),this.refs.short))},getShortBlocks:function(){return{header:{el:this.refs["top-menu-short"]},content:{el:this.refs["content-short"]},footer:{el:this.refs["bottom-menu-short"],minSize:this.get("short-footer-min-height")}}},getFullBlocks:function(){return{header:{el:this.refs["top-menu-full"]},content:{el:this.refs["content-full"]},footer:{el:this.refs["bottom-menu-full"],minSize:this.get("footer-min-height")}}},didMount:function(){this.subscribeToResize("mount")},didUpdate:function(){this.subscribeToResize("update")},didUnmount:function(){this.unmountCalled=true;this.resizeDebouncer.destroy();this.shortResizeDebouncer.destroy();this.resizeObserver.disconnect();this.shortResizeObserver.disconnect()},onToggleOpenState:function(){this.invert("open");if(this.get("open")){setTimeout(function(){g.default.update()},1e3)}},onOutsideClick:function(a){var b=this;if(!this.el.contains(a.target)){setTimeout(function(){b.close()},300)}},subscribeToResize:function(b){var c=this;if(!this.isMounted()){a.default.send("sidebar-subscribe-after-unmount",{rlog:"octavius-sidebar-update-err",rlog_message:{name:"sidebar-subscribe-after-unmount",initiator:b,state:{zombie:this.zombie,destroyed:this.destroyed,mounted:this.mounted,unmountCalled:this.unmountCalled},err:new Error("empty")}})}if(this.hasShortMenu()){__spreadArray([this.refs.short],Object.values(this.getShortBlocks()).map(function(a){return a.el}),true).forEach(function(a){return c.shortResizeObserver.observe(a)})}if(this.hasFullMenu()){__spreadArray([this.refs.full],Object.values(this.getFullBlocks()).map(function(a){return a.el}),true).forEach(function(a){return c.resizeObserver.observe(a)})}},hasShortMenu:function(){return this.is("short")},hasFullMenu:function(){return!this.is("short")||this.is("open")},open:function(){this.set("open",true)},close:function(){this.set("open",false)},getFullScrollable:function(){return this.ids.scrollFull}}))});define("ui-block/sidebar-search/sidebar-search",["exports","feast","feast-tpl!./sidebar-search.html","ui-block/badge/badge","ui-block/ico/ico","ui-block/nav-folders/nav-folders","ui-block/react-async/react-async","ui-block/sidebar/sidebar","default-values"],function(exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var i=p(a);var j=p(b);var k=p(c);var l=p(d);var m=p(e);var n=p(f);var o=p(g);function p(a){return a&&a.__esModule?a:{default:a}}exports.default=i.default.Block.extend({name:"sidebar-search",template:j.default,blocks:{badge:k.default,ico:l.default,"react-async":n.default,sidebar:o.default,"nav-folders":m.default},defaults:{folders:null,ponymode:false,store:{},short:false,categories:h.SEARCH_CATEGORIES,colorTags:h.COLOR_TAGS},constructor:function a(){i.default.Block.apply(this,arguments);this.handleSearchPanelFocus=this.handleSearchPanelFocus.bind(this)},handleSearchPanelFocus:function a(){this.broadcast("search-sidebar:focus")}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/search-manager",["require","exports","data-source/utils","default-values","feast","helpers/suggest-search","mail/Folder","mobx","pilotjs","service/adv/config","service/radars/index","state-tree/search/search","ui-block/dataset-letters/dataset-letters","ui-block/list-letter-preview-action/list-letter-preview-action","ui-block/octopus/octopus","ui-block/search-panel/search-panel","ui-block/sidebar-search/sidebar-search"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});c=__importDefault(c);e=__importDefault(e);g=__importDefault(g);i=__importDefault(i);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);exports.default=c.default.Mediator.create("search-manager",{defaults:function(){this._lazyReactionSetup=false},components:{router:{class:g.default,events:["beforeroute","routeend"]},"search-panel":{class:n.default,events:["search-panel:focus","search-panel:blur","back"],attrs:{active:function(a){return a.isActive()}}},"search-mobile-panel":{events:["searchpanel:focus","searchpanel:blur","back"],attrs:{active:function(a){return a.isActive()},searching:function(a){return a.isSearchRoute()}}},"sidebar-search":{class:o.default,events:["search-sidebar:focus"]},octopus:{class:m.default,events:["search:set-in-excluded-folders"],attrs:{"show-search-in-excluded-folders":function(a){return a.shouldSuggestExcludedFolders()},"search-in-excluded-folders-url":function(a){return a.getInExcludedFoldersUrl()},"search-has-operands":function(a){return a.hasOperands()}}},"list-letter-search-action":{class:l.default,events:["search:set-in-excluded-folders"]},"dataset-letters":{class:k.default,events:["click:letter"],attrs:{"search-in-excluded-folders":function(a){return a.isInExcludedFolders()},"search-in-excluded-folders-url":function(a){return a.getInExcludedFoldersUrl()},"search-has-operands":function(a){return a.hasOperands()}}}},handleEvent:function(c){var d;var e=c.type;var f=this.get("router");var g=this.components["search-panel"][0];switch(e){case"click:letter":this.sendSearchPositionRadar(c);break;case"searchpanel:focus":this._isFocused=true;break;case"searchsidebar:focus":g.focus();return false;case"searchpanel:blur":this._isFocused=false;break;case"search:setinexcludedfolders":var i=c.details;var j=(0,a.getStore)();var k=j&&j.search;if(k){k.setInExcludedFolders(i)}break;case"beforeroute":if(f.route.is("#search")){(0,h.deleteRBParam)("exp_id");(0,h.deleteRBParam)("search_query")}break;case"routeend":if(f.route.is("#search")){if(b.ADV_SEARCH_EXP_ID){(0,h.setRBParam)("exp_id",b.ADV_SEARCH_EXP_ID)}var l=f.request.query.q_query;if(b.ADV_SEARCH_SEND_QUERY&&l){(0,h.setRBParam)("search_query",l)}}break;case"back":(d=g===null||g===void 0?void 0:g.reset)===null||d===void 0?void 0:d.call(g);if(f.route.is("#search #search-letter")){f.go("#letters")}break}},getSearch:function(){var b=(0,a.getStore)();return b&&b.search},isActive:function(){var a=this.get("router");var c=this.getSearch();var d=!c||c.empty;if(a.route.is("#search")){return true}else if(a.route.is("#search-letter")){return b.SEARCH_PANEL_PORTAL||this._isFocused||this.isLoading()}else{return this._isFocused||!d}},isSearchRoute:function(){var a=this.get("router");return a.route.is("#search")},isLoading:function(){var a=this;var b=this.getSearch();if(b&&!this._lazyReactionSetup){this._lazyReactionSetup=true;(0,f.reaction)(function(){return b.progress},function(){a.updateAll()})}return b&&b.progress},isInExcludedFolders:function(){var a=this.getSearch();return a&&a.in_excluded_folders},shouldSuggestExcludedFolders:function(){if(b.FORBID_EXCLUDED_FOLDERS_SEARCH){return false}var a=this.getSearch();if(!a){return false}if(this.isInExcludedFolders()){return false}var c=a.currentMailbox,d=a.isMyMailboxSelected;if(d){return true}return e.default.all.toArray().some(function(a){var b;return a.isShareTake()&&((b=a.get("owner"))===null||b===void 0?void 0:b.email)===c.email&&(a.isSpam()||a.isTrash())})},getInExcludedFoldersUrl:function(){var a=this.getSearch();var b=Object.assign({},a.routerQuery);b[j.QueryKeysMap.IN_EXCLUDED_FOLDERS]=1;var c=g.default.queryString.stringify(b);return"?".concat(c)},hasOperands:function(){var a=this.getSearch();return!!(a&&a.hasOperands)},sendSearchPositionRadar:function(a){var c=this.get("router");if(!c.route.is("#search")){return}var e=a.details&&a.details.index||0;var f=Math.floor(Date.now()/1e3);var g=c.model.search,h=g.search_id,j=g.doneRelevantSearch;(0,i.default)({chain:["search_letter_click"],value:e});var k=b.RELEVANT_SEARCH;if(k.group){var l=j?[["suc",e]]:void 0;var m=j?j.group:k.group;(0,i.default)({chain:["search_position_g_".concat(m)],intervals:l,value:e})}var n=(0,d.getSearchRadarIntervals)(c.model.search,e);(0,i.default)({chain:["search_position"],intervals:n,dwh:{search_id:h,timestamp:f}})}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("models/adv-letter/adv-letter",["require","exports","models/dataset-model/dataset-model"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.advModelLabel=void 0;a=__importDefault(a);exports.advModelLabel="advModel";var b=a.default.extend({className:"models.AdvLetter"});b.createAdvLetter=function c(d,e,f,g,h,i){var j=a.default.createModel(b,"adv::".concat(d,"_").concat(e,"_").concat(g),exports.advModelLabel);j.set("inMetathread",h,true);j.set("metathreadLastToggle",i,true);j.set("position",e);j.set("index",f);return j};b.isAdv=function b(c){return a.default.isDatasetModel(c,exports.advModelLabel)};exports.default=b});define("models/skeleton-letter/skeleton-letter",["exports","models/dataset-model/dataset-model"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}var d="skeletonLetter";var e=b.default.extend({className:"models.SkeletonLetter"});e.createSkeletonLetter=function a(c){var f=b.default.createModel(e,e.constructId(c),d);f.set({index:c},{silent:true});f.meta("_ui-index",c);return f};e.isSkeleton=function a(c){return b.default.isDatasetModel(c,d)};e.constructId=function a(b){return"skeleton::"+b};exports.default=e});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/ui-letters",["require","exports","@mail/adman","@mail-core/logger","data-source/utils/letter-list-virtualization","data-source/utils/paginator","default-values","helpers/dividerInserters","helpers/parse","helpers/seedable-random","mail/Folder","mediator/search-manager","models/adv-letter/adv-letter","models/bait-letter/bait-letter","models/discounts-block-letter/discounts-block-letter","models/height-compensation-model/height-compensation-model","models/metathread/metathread","models/promo-block-letter/promo-block-letter","models/search-action-letter/search-action-letter","models/skeleton-letter/skeleton-letter","models/spec-project-letter/spec-project-letter","models/spinner-letter/spinner-letter","models/tip-letter/tip-letter","models/welcome-block-letter/welcome-block-letter","route/utils/filter-query","service/adv/config","service/adv/index","service/smokescreen"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getAdvIntervalData=exports.getAdvConfigData=exports.isNeedAdv=void 0;a=__importDefault(a);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importStar(w);y=__importDefault(y);z=__importDefault(z);var A=function(a){var b=a&&a.params;var c=b&&b.folder;if(c===i.default.OUTBOX){return f.noopInserter}switch(w.default.getSortingType()){case w.ESortingTypes.DateDesc:return e.ENABLE_LATEST_WITH_MONTHS_LETTERS_DIVIDERS?(0,f.getLatestWithMonthsInserter)():(0,f.getLatestInserter)();case w.ESortingTypes.DateAsc:return(0,f.getMonthInserter)();case w.ESortingTypes.FromDesc:case w.ESortingTypes.FromAsc:{if(c===i.default.SENT){return e.ENABLE_AUTHOR_SEND_LETTERS_DIVIDERS?f.alphabetToInserter:f.noopInserter}return e.ENABLE_AUTHOR_LETTERS_DIVIDERS?f.alphabetFromInserter:f.noopInserter}case w.ESortingTypes.SubjectDesc:case w.ESortingTypes.SubjectAsc:return e.ENABLE_SUBJECT_LETTERS_DIVIDERS?f.alphabetSubjectInserter:f.noopInserter;default:return f.noopInserter}};var B=function(a){var b=a.filter(function(a){return typeof a==="boolean"});if(b.length>0){return b[b.length-1]}return false};var C=function(b,c,d,f){if(e.HIDE_TOYS===e.BL_PROP_NAME){return false}var h=f?e.ADV_LIST_METATHREAD_CONFIG:e.ADV_LIST_DEFAULT_CONFIG;var i=!(0,g.parseStringToBoolean)(h.mimic)&&z.default.isEnabled();var j=x.slotsConfig.list2pane,k=j===void 0?{}:j,l=x.slotsConfig.list3pane,m=l===void 0?{}:l;var n=!!k.mimicId&&!!m.mimicId;if(i&&!n){return false}var o=(0,exports.getAdvConfigData)(c,h,d,f),p=o.advConfig,q=o.currentFolderConfig;var r=!!a.default.placement("list2pane");var s=!!a.default.placement("list3pane");var t=(0,g.parseStringToBoolean)(h.enable);var u=c.support3pane,v=c.type;var w=u&&v==="3pane";var y=w?s:r;var A=(0,g.parseStringToBoolean)(q.enable);var C=(0,g.parseStringToBoolean)(p.enable);if(!y||!B([t,A,C])){return false}var D=(0,exports.getAdvIntervalData)(p).advMinLetters;if(b.length<=D){return false}return true};exports.isNeedAdv=C;var D=function(a,b,c,d){var f=d?e.ADV_LIST_METATHREAD_SPECIFIC_CONFIG:e.ADV_LIST_FOLDER_CONFIG;var g=a.support3pane,h=a.type;var i=g&&h==="3pane";var j=i?"3pane":"2pane";var k=f[c]||{"2pane":{},"3pane":{}};var l=__assign(__assign({},b[j]),k[j]);return{advConfig:l,currentFolderConfig:k,paneKey:j}};exports.getAdvConfigData=D;var E=function(a){var b=a.start,c=a.interval,d=a.minLetters;var e=parseInt(b,10);var f=parseInt(c,10);var g=parseInt(d||b,10);return{advStart:e,advInterval:f,advMinLetters:g}};exports.getAdvIntervalData=E;var F=function(a,b,c,d,f){var g=d?e.ADV_LIST_METATHREAD_CONFIG:e.ADV_LIST_DEFAULT_CONFIG;if(!(0,exports.isNeedAdv)(a,b,c,d)){return}var h=b.support3pane&&b.type==="3pane";if(e.ADS_MOVE_TOP_LINE&&(h&&e.ADS_MOVE_TOP_LINE_3PANE||!h&&e.ADS_MOVE_TOP_LINE_2PANE)&&e.NEW_TOOLBAR){return}var i=(0,exports.getAdvConfigData)(b,g,c,d),j=i.advConfig,l=i.paneKey;var m=(0,exports.getAdvIntervalData)(j),n=m.advStart,o=m.advInterval;for(var p=0,q=n;q<a.length;q+=o,p++){var r=k.default.createAdvLetter(c,q,p,l,d,f);a.splice(q,0,r)}};var G=h.default.randomSeed();function H(a,b,c){return!a&&(b===i.default.TRASH||b===i.default.CHILD_TRASH||b===i.default.SPAM)&&c.length}function I(a,b){a.unshift(u.default.createTipLetter(b))}exports.default={match:["#letters","#read-letter","#search","#search-letter"],defaults:[],fetch:function(a,g){var k=a.route&&a.route.is("#search #search-letter");var u=a.params.folder;return Promise.all([k?g("search"):g("status"),g("metathreads"),g("uiLayout"),g("uiThreadsSettings"),g("discounts")]).then(function(g){var w=g[0],x=g[1],B=g[2],C=g[3],D=g[4];var E=w.letters||[];var J=w.suggestLetters;var K=!!(E&&E.length);var L=!!(J&&J.length);var M=w.page===1;var N=typeof w.page==="number";var O=[];if(e.ENABLE_LETTERS_DIVIDERS&&(0,f.getDividersEnabled)()){try{O=(0,f.insertDividers)(E,A(a))}catch(a){O=__spreadArray([],E,true);(0,b.coreLoggerDispatchSelfError)("insert_divder_error",a)}}else{O=E.slice()}var P=new h.default(G);var Q;var R;var S;var T;var U;var V;if(M||!N){if(H(k,u,E)){I(O,u)}var W=L&&!K;var X=W?"suggestHeader":"header";if((K||L)&&k&&j.default.shouldSuggestExcludedFolders()){O.unshift(q.default.createSearchActionLetter({withSuggestHeader:W,type:X}))}}if(!k||e.ADV_SEARCH_SEND_QUERY){F(O,B,u)}var Y=(0,d.calcSkeletonsAtStart)(w);if(!k&&N&&C.paginator){for(T=0;T<Y;T++){S=r.default.createSkeletonLetter((w.offset||0)+Y-T-1);O.unshift(S)}var Z=B.support3pane&&B.type==="3pane";var _=(0,c.getGenericItemHeight)(Z,B.ponyMode)*Y;var aa=(0,d.getMemoizedPageHeight)(w.page-1)||0;var ba=Math.max(aa-_,0);var ca=n.default.createHeightCompensation(ba);if(K){O.unshift(ca)}}var da;var ea;var fa=y.default.isAdvVisible("spec-project-letter");for(T=0;T<O.length;T++){S=O[T];if(k){S.meta("_ui-index",T)}var ga=i.default.all.get(u);var ha=ga&&ga.isShareTake();if(!k&&o.default.isMetathread(S)){if(ha){O.splice(T,1);continue}Q=x[S.id];R=Q&&Q.threads;if(!R){continue}V=S.get("lastToggle");R=R.slice();U=R.length;while(U--){var ia=R[U];if(!ia.get("advModel")){ia.setContainingMetathread(S)}}if(!fa){F(R,B,S.get("metathread_data.folder"),true,V)}O.splice.apply(O,[T+1,0].concat(R,[S.getFooterModel()]));T+=R.length+1;continue}if(K&&!k&&z.default.isEnabled()&&P.random()<=.34){O.splice.apply(O,[T+1,0].concat([l.default.createBaitLetter(T)]));T+=1}}if(L&&(M||!N)){if(K){O.push(q.default.createSearchActionLetter({type:"suggestSeparator"}))}O.push.apply(O,J)}if(K){O.push(t.default.createSpinnerLetter())}if(u===i.default.INBOX&&K&&!k&&!e.WELCOME_BLOCK_DISABLED){O.unshift(v.default.createWelcomeBlock())}if(D&&K){O.unshift(m.default.createDiscountsBlock())}if(u===i.default.INBOX&&K&&!k){O.unshift(p.default.createPromoBlock())}if(K&&!k){O.unshift(s.default.createSpecProjectLetter(u))}if((0,d.isPaginatorEnabled)(a.router,C)&&!k&&typeof w.lettersTotal==="number"){da=(0,d.calcLastLetterIndex)(w);ea=(0,d.calcSkeletonsAtEnd)(w);for(T=da;T<da+ea;T++){O.push(r.default.createSkeletonLetter(T))}}return O})}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/actions/UserEditMetathreads",["require","exports","Action","mail/User","mail/Folder","RPC"],function(require,exports,a,b,c,d){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);var e=a.default.extend({className:"mail.UserEditMetathreads",_isMetathreadsError:function(a){return"error"in a},prepare:function(a){if(typeof a!=="object"||!a){return{error:true,message:"invalid_params"}}var d=Object.keys(b.default.METATHREADS_STATES).map(function(a){return b.default.METATHREADS_STATES[a]});var e=Object.keys(a).every(function(b){return c.default.OWN_METATHREADS_IDS.includes(+b)&&d.includes(a[b])});if(!e){return{error:true,message:"invalid_metathread"}}return Object.keys(a).map(function(b){return{folder_id:+b,state:a[b]}})},operation:function(a){if(this._isMetathreadsError(a)){return Promise.reject(a)}return d.default.call(b.default.url("editMetathreadsSettings"),{metathread_visible:a})}});a.default.register("mail.UserEditMetathreads",e);e.version="0.1.0";exports.default=e;return e});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/ui-threads-settings",["require","exports","@mail/flags","@mail-core/dashboard","data-source/actions","data-source/match/match","default-values","helpers/metathreads","mail/actions/UserEditMetathreads","mail/Folder","mail/User","RPC","service/notify","service/radars/index"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);d=__importDefault(d);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);function m(){if(a.default.get("priority-messages-newsletters").isExist()){return a.default.get("priority-messages-newsletters").state}if(a.default.get("priority-messages").state===false&&a.default.get("priority-messages").count.show){return false}return e.ACTUAL_LETTERS_DEFAULT_NEWSLETTERS}exports.default={match:(0,d.default)(["#attachment","#attachment-editor"]).exclude,defaults:{metathreadsSettings:{},metathreadsFiltersCount:0},fetch:function(d,n,o,p){var q=o&&o.type;var r=p&&p.uiThreadsSettings;if(!r){return b.userKeeper.group("app-fetch-ui-thd-stg-no-prev",function(){return Promise.all([n("authUser")]).then(function(b){var c=b[0];return{threads:a.default.get("threads").state,metathreads:c.get("common_purpose_flags.metathreads_on"),toMyself:a.default.get("to-myself").state,paginator:a.default.get("octavius-paginator").state,actualLettersInbox:a.default.get("priority-messages").count.show?a.default.get("priority-messages").state:e.ACTUAL_LETTERS_DEFAULT_INBOX,actualLettersNewsletters:m(),metathreadsSettings:i.default.getMetathreadsSettingsFromVisibility(c.get("metathreads_visible")),discounts:!!a.default.get(e.DISCOUNTS_FLAG_NAME).state,metathreadsFiltersCount:0}})},{score:"fetch"})}var s=function(a,b){var c={};if(typeof b!=="boolean"){return c}Object.values(h.default.OWN_METATHREADS_IDS).forEach(function(d){if(a.includes(d)){return}c[d]=b?i.default.METATHREADS_STATES.ON:i.default.METATHREADS_STATES.OFF});return c};var t=function(a){if(typeof a!=="boolean"){return}var b=s([h.default.TOMYSELF,h.default.PROMOTIONS],a);return(0,f.metathreadsToggle)(a).then(function(){return __assign(__assign({},r),{metathreads:a,metathreadsSettings:b})})};var u=function(a){if(e.HIDE_METATHREADS){return r}var b=r.metathreadsSettings;var c=__assign(__assign({},b),a);var d=(0,f.isMetathreadOnFromState)(c[h.default.TOMYSELF]);var i=h.default.OWN_METATHREADS_IDS.some(function(a){return a!==h.default.TOMYSELF&&(0,f.isMetathreadOnFromState)(c[a])});return g.default.execute(a).then(function(){return __assign(__assign({},r),{metathreadsSettings:c,toMyself:d,metathreads:i})}).catch(function(a){var b=a.error;var c=b.status,d=b.message;var e=[c,d].filter(function(a){return a}).join("_");(0,l.default)(["glng-user-edit-mthrds-err",e]);k.default.error({unique:true});return r})};return b.userKeeper.group("app-fetch-ui-thd-stg",function(){var b;switch(q){case c.TOGGLE_THREADS_SETTING:{var d=a.default.get("threads");var f=!r.threads;return d.save({state:f}).then(function(){return __assign(__assign({},r),{threads:f})})}case c.TOGGLE_METATHREADS_SETTING:{var g=!r.metathreads;return t(g)}case c.CHANGE_METATHREADS_SETTING:{var g=o&&o.state;return t(g)}case c.EDIT_METATHREADS_SETTINGS:{var k=o&&o.settings;return u(k)}case c.TOGGLE_METATHREADS_SETTINGS:{var g=o&&o.state;var k=s([h.default.PROMOTIONS],g);return u(k)}case c.TOGGLE_TO_MYSELF_METATHREAD:{var m=o&&o.state;var n=r.metathreadsSettings;var p=__assign(__assign({},n),(b={},b[h.default.TOMYSELF]=m?i.default.METATHREADS_STATES.ON:i.default.METATHREADS_STATES.OFF,b));return a.default.get("to-myself").save({state:m}).then(function(){return __assign(__assign({},r),{toMyself:m,metathreadsSettings:p})})}case c.TOGGLE_PAGINATOR:{var v=o&&o.state;return a.default.get("octavius-paginator").save({state:v}).then(function(){return __assign(__assign({},r),{paginator:v})})}case c.TOGGLE_ACTUAL_MESSAGES_IN_INBOX:{var w=o&&o.state;var x=a.default.get("priority-messages");return x.save({state:w,hit:!x.count.show}).then(function(){return __assign(__assign({},r),{actualLettersInbox:w})})}case c.TOGGLE_ACTUAL_MESSAGES_IN_NEWSLETTERS:{var y=o&&o.state;var x=a.default.get("priority-messages-newsletters");return x.save({state:y}).then(function(){return __assign(__assign({},r),{actualLettersNewsletters:y})})}case c.ENABLE_ACTUAL_MESSAGES:{var z=a.default.get("priority-messages-newsletters").save({state:true});var A=a.default.get("priority-messages");var B=A.save({state:true,hit:!A.count.show});var C=a.default.get("actual-letters-badge").save({state:true,time:true});(0,l.default)("settings_ad_actual_letters_hide");return Promise.all([z,B,C]).then(function(){return __assign(__assign({},r),{actualLettersNewsletters:true,actualLettersInbox:true})})}case c.TOGGLE_DISCOUNTS:{var D=o&&o.state;return a.default.get(e.DISCOUNTS_FLAG_NAME).save({state:D}).then(function(){return __assign(__assign({},r),{discounts:D})})}case c.UPDATE_METATHREAD_FILTERS:{if(!e.ENABLE_METATHREAD_FILTERS_SHORTCUT){return r}return j.default.get("filters",{noAuto:true}).then(function(a){var b;return __assign(__assign({},r),{metathreadsFiltersCount:((b=a===null||a===void 0?void 0:a.body)===null||b===void 0?void 0:b.length)||0})})}default:return r}},{score:"fetch",appendix:!q?"no-act":"act"})}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/actions/CleanmasterUnreadManage",["require","exports","Action","RPC"],function(require,exports,a,b){"use strict";a=__importDefault(a);b=__importDefault(b);var c=a.default.extend({className:"mail.CleanmasterUnreadManage",_isCleanmasterError:function(a){return"error"in a},prepare:function(a){if(typeof a!=="object"||!a){return{error:true,message:"invalid_params"}}var b=Object.keys(c.Methods).map(function(a){return c.Methods[a]});var d=a.method;if(!b.includes(d)){return{error:true,message:"invalid_method"}}if(d===c.Methods.Unsubscribe){return this._prepareUnsubscribe(a)}return a},operation:function(a){if(this._isCleanmasterError(a)){return Promise.reject(a)}if(a.method===c.Methods.Unread){return this._unread()}return this._unsubscribe(a)},_prepareUnsubscribe:function(a){if(!Array.isArray(a.emails)){return{error:true,message:"invalid_emails"}}return a},_unread:function(){return b.default.get("golang/messages/services/cleanmaster/unread")},_unsubscribe:function(a){return b.default.call("golang/messages/services/cleanmaster/unsubscribe",{emails:a.emails})}});c.Methods={Unsubscribe:"unsubscribe",Unread:"unread"};a.default.register("mail.Cleanmaster",c);c.version="0.1.0";exports.default=c;return c});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/unsubscribe",["require","exports","default-values","service/radars/index","service/storage"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.STORAGE_KEY=void 0;b=__importDefault(b);c=__importDefault(c);exports.STORAGE_KEY="unsubscribe-list";var d={_notCountSameUid:{},_ignoreCounter:{},countUnsubscribeView:function(d,e,f,g){var h;var i;if(d===void 0){d={counter:{},list:[]}}if(this._notCountSameUid[g]){return d}var j=(i=d.counter[g])!==null&&i!==void 0?i:0;var k=j+1;this._notCountSameUid[g]=true;var l=__assign(__assign({},d),{counter:__assign(__assign({},d.counter),(h={},h[g]=k,h))});if(k===a.LL_UNSUBSCRIBE_NEWSLETTERS_SHOW_LIMIT){this._ignoreCounter[g]=true;(0,b.default)({type:"unsub_sndrs_show_limit",dwh:{sender:g}})}var m=this.getActualSenders(l,e,f);c.default.set(exports.STORAGE_KEY,l);return __assign(__assign({},l),{actualSenders:m})},hideSenders:function(a,b,d,e){var f;var g=(f=a.hidden)!==null&&f!==void 0?f:[];if(e.every(function(a){return g.includes(a)})){return a}var h=__assign(__assign({},a),{hidden:__spreadArray(__spreadArray([],g,true),e,true)});var i=this.getActualSenders(h,b,d);c.default.set(exports.STORAGE_KEY,h);return __assign(__assign({},h),{actualSenders:i})},_calculateActualSenders:function(b,c,d){var e=this;var f=c.map(function(a){var b,c,e,f;var g=(e=(c=(b=a.get("correspondents"))===null||b===void 0?void 0:b.from)===null||c===void 0?void 0:c[0])===null||e===void 0?void 0:e.email;var h=(f=a.get("flags"))===null||f===void 0?void 0:f.unread;if(h&&d.includes(g)){return{sender:g,id:a.get("id")}}}).filter(function(c){var d,f,g;if(!c){return false}var h=c.sender;var i=(d=b===null||b===void 0?void 0:b.hidden)===null||d===void 0?void 0:d.some(function(a){return a===h});if(!h||i){return false}var j=(g=(f=b===null||b===void 0?void 0:b.counter)===null||f===void 0?void 0:f[h])!==null&&g!==void 0?g:0;return e._ignoreCounter[h]||j<a.LL_UNSUBSCRIBE_NEWSLETTERS_SHOW_LIMIT});return f.filter(function(a,b){return f.findIndex(function(b){return b.sender===a.sender})===b}).slice(0,a.LL_UNSUBSCRIBE_NEWSLETTERS_SENDERS_LIMIT)},getActualSenders:function(a,b,c,d){var e=this;var f;var g=a!==null&&a!==void 0?a:{list:[]};var h=b!==null&&b!==void 0?b:[];var i=c!==null&&c!==void 0?c:{};var j=(f=d!==null&&d!==void 0?d:g.list)!==null&&f!==void 0?f:[];var k=Object.values(i).map(function(a){return a===null||a===void 0?void 0:a.threads}).filter(function(a){return a});var l=[];__spreadArray([h],k,true).forEach(function(a){return l.push.apply(l,e._calculateActualSenders(g,a,j))});return l}};exports.default=d});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/unsubscribe-list",["require","exports","data-source/actions","data-source/match/match","default-values","mail/actions/CleanmasterUnreadManage","service/radars/index","service/storage","service/unsubscribe"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importStar(g);exports.default={match:(0,b.default)(["#attachment","#attachment-editor"]).exclude,defaults:{},fetch:function(b,h,i,j){if(!c.LL_UNSUBSCRIBE_NEWSLETTERS){return Promise.resolve({})}var k=j===null||j===void 0?void 0:j.unsubscribeList;var l=k!==null&&k!==void 0?k:f.default.get(g.STORAGE_KEY);switch(i===null||i===void 0?void 0:i.type){case a.DELETE_SENDER_FROM_UNSUBSCRIBE_LIST:{if(!(j===null||j===void 0?void 0:j.status)){return}var m=j.status.letters,n=j.metathreads;return Promise.resolve(g.default.hideSenders(l,m,n,i.senders))}case a.HIDE_UNSUBSCRIBE_SENDER:{if(!(j===null||j===void 0?void 0:j.status)){return}var m=j.status.letters,n=j.metathreads;var o=i.senders;(0,e.default)({type:"hide_unsub_sndrs",dwh:{senders:o}});return Promise.resolve(g.default.hideSenders(l,m,n,o))}case a.COUNT_UNSUBSCRIBE_VIEW:{var m=j.status.letters,n=j.metathreads;return Promise.resolve(g.default.countUnsubscribeView(l,m,n,i.sender))}case a.TOGGLE_METATHREAD:case a.TOGGLE_METATHREADS_SETTING:case a.LOAD_MORE_METATHREAD:case a.TOGGLE_THREADS_SETTING:case a.NAVIGATE:case a.UPDATE_ALL:{if(l){return Promise.all([h("status"),h("metathreads")]).then(function(a){var b=a[0],c=a[1];var d=g.default.getActualSenders(l,b.letters,c);return __assign(__assign({},l),{actualSenders:d})})}}}var p=!(l===null||l===void 0?void 0:l.timestamp);var q=Math.floor(Date.now()/1e3);var r=!k||p||q-l.timestamp>c.LL_UNSUBSCRIBE_NEWSLETTERS_INTERVAL;if(!r){return l}return Promise.all([h("status"),h("metathreads")]).then(function(a){var b=a[0],c=a[1];return d.default.execute({method:d.default.Methods.Unread}).then(function(a){return a.result}).then(function(a){var d,h;(0,e.default)({type:"clnmstr_unread_ds"});var i=a.body;var j=b.letters;var k=g.default.getActualSenders(l,j,c,i);var m={list:i,counter:(d=l===null||l===void 0?void 0:l.counter)!==null&&d!==void 0?d:{},hidden:(h=l===null||l===void 0?void 0:l.hidden)!==null&&h!==void 0?h:[],timestamp:q};f.default.set(g.STORAGE_KEY,m);return __assign(__assign({},m),{actualSenders:k})}).catch(function(a){var b=a.error;(0,e.default)({chain:["clnmstr_unread_ds_err",b.status,b.message]});return{}})})}}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/vk",["require","exports","@mail/xray","default-values"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getShopName=exports.getVkChatHref=exports.getVkChatId=exports.vkConnectChecker=void 0;a=__importDefault(a);var c={_promise:null,_fetch:function(){return new Promise(function(b){var c=new XMLHttpRequest;c.open("GET","https://vk.com/feed2.php?act=widget",true);c.withCredentials=true;c.onload=function(){a.default.send("vk-connect_request_ok");var d=null;try{d=JSON.parse(c.response)}catch(b){d={};a.default.send("vk-connect_request-parse-error")}if(c.status!==200||!d.friends){a.default.send("vk-connect_unauthorized");return b({authorized:false})}a.default.send("vk-connect_authorized");b({authorized:true})};c.onerror=function(){a.default.send("vk-connect_request_fail");b({authorized:false})};c.send()})},check:function(){if(!this._promise){this._promise=this._fetch()}return this._promise}};exports.vkConnectChecker=c;var d=function(a){if(!b.VK_MESSENGER_CHAT_ID_BY_EMAIL||b.DISABLE_VK_MESSENGER){return null}return b.VK_MESSENGER_CHAT_ID_BY_EMAIL[a.toLowerCase()]};var e=function(a){var b=d(a);if(!b){return null}return b.id};exports.getVkChatId=e;var f=function(a){var b=d(a);if(!b){return null}return b.name};exports.getShopName=f;var g=function(a){if(!a){return null}return"".concat(b.VK_MESSENGER_CHAT_HREF_BASE).concat(a)};exports.getVkChatHref=g});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("data-source/source/vkMessenger",["require","exports","data-source/match/match","default-values","feast-mod/correspondents","helpers/vk"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);exports.default={match:(0,a.default)(["#read-letter","#search-letter"]),fetch:function(a,c){var e=this;if(b.DISABLE_VK_MESSENGER){return}var f=[c("letter"),b.VK_MESSENGER_CHECK_VK_AUTH?d.vkConnectChecker.check():Promise.resolve({authorized:true})];return Promise.all(f).then(function(a){var b=a[0],c=a[1].authorized;if(!c||!b){return}return e.processThreads([b])})},processThreads:function(a){if(!a){return}a.forEach(function(a){var b=(0,c.getCorrespondentsFromMessage)(a,"from",".0.email");var e=a.get("transaction_metadata");if(!b||!e||e.get("vk_chat_href")!==undefined){return}var f=(0,d.getVkChatId)(b);var g=(0,d.getShopName)(b);if(!f){return}e.set({vk_chat_id:f,vk_chat_href:(0,d.getVkChatHref)(f),shop_name:g})})}}});define("data-source/index",["exports","@mail-core/logger","Action","data-source/actions","data-source/data-source","data-source/discounts/index","data-source/server-error","data-source/utils/logger","default-values","Emitter","helpers/delete-emoji-in-string","mail/Folder","mail/Message","mail/Thread","Model","pilotjs","service/mailbox/loader","service/notify","service/page-lifecycle","service/radars/index","./source/account","./source/aliases","./source/attachment","./source/attachment-temporary","./source/authUser","./source/bills-count","./source/collectors","./source/folder","./source/folders","./source/hidden-payment-dies","./source/jssdk-action","./source/letter","./source/letter-neighbours","./source/letters","./source/message","./source/metathreads","./source/pushManager","./source/request","./source/route","./source/router","./source/search","./source/setup","./source/status","./source/suggest-search","./source/swBox","./source/ui-layout","./source/ui-letters","./source/ui-threads-settings","./source/unsubscribe-list","./source/vkMessenger","./utils"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Y=Pa(b);var Z=Pa(d);var _=Pa(e);var aa=Pa(f);var ba=Pa(i);var ca=Pa(k);var da=Pa(l);var ea=Pa(m);var fa=Pa(n);var ga=Pa(o);var ha=Pa(p);var ia=Pa(q);var ja=Pa(r);var ka=Pa(s);var la=Pa(t);var ma=Pa(u);var na=Pa(v);var oa=Pa(w);var pa=Pa(x);var qa=Pa(y);var ra=Pa(z);var sa=Pa(A);var ta=Pa(B);var ua=Pa(C);var va=Pa(D);var wa=Pa(E);var xa=Pa(F);var ya=Pa(G);var za=Pa(H);var Aa=Pa(I);var Ba=Pa(J);var Ca=Pa(K);var Da=Pa(L);var Ea=Pa(M);var Fa=Pa(N);var Ga=Pa(O);var Ha=Pa(P);var Ia=Pa(Q);var Ja=Pa(R);var Ka=Pa(S);var La=Pa(T);var Ma=Pa(U);var Na=Pa(V);var Oa=Pa(W);function Pa(a){return a&&a.__esModule?a:{default:a}}var Qa=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var Ra=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};function Sa(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var Ta=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function Ua(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}var Va=function a(b,c,d){if(b===null)b=Function.prototype;var e=Object.getOwnPropertyDescriptor(b,c);if(e===undefined){var f=Object.getPrototypeOf(b);if(f===null){return undefined}else{return a(f,c,d)}}else if("value"in e){return e.value}else{var g=e.get;if(g===undefined){return undefined}return g.call(d)}};function Wa(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var Xa={request:Ca.default,router:Ea.default,route:Da.default,setup:Ga.default,authUser:pa.default,pushManager:Ba.default,swBox:Ja.default,folder:sa.default,folders:ta.default,account:la.default,uiLayout:Ka.default,uiThreadsSettings:Ma.default,letter:wa.default,letters:ya.default,metathreads:Aa.default,uiLetters:La.default,discounts:_.default,status:Ha.default,search:Fa.default,suggestSearch:Ia.default,message:za.default,attachment:na.default,attachmentTemporary:oa.default,jssdkAction:va.default,letterNeighbours:xa.default,collectors:ra.default,aliases:ma.default,hiddenPaymentDies:ua.default,billsCount:qa.default,unsubscribeList:Na.default,vkMessenger:Oa.default};var Ya=ea.default.prototype.valueValidator;ea.default.prototype.valueValidator=function(a,b,c,d){if(b==="subject"&&(0,j.hasEmoji)(a)){d.set("hide_emoji_in_subject",true);if(h.HIDE_EMOJI_IN_SUBJECT||d.get("flags.newsletter")&&h.HIDE_EMOJI_IN_SUBJECT_NEWSLETTER){return Ya.call(this,(0,j.deleteEmoji)(a),b,c,d)}}if(b==="snippet"&&(0,j.hasEmoji)(a)){d.set("hide_emoji_in_snippet",true);if(h.HIDE_EMOJI_IN_SNIPPET||d.get("flags.newsletter")&&h.HIDE_EMOJI_IN_SNIPPET_NEWSLETTER){return Ya.call(this,(0,j.deleteEmoji)(a),b,c,d)}}if(b==="correspondents"&&a.from&&a.from[0]&&(0,j.hasEmoji)(a.from[0].name)){d.set("hide_emoji_in_correspondent",true);if(h.HIDE_EMOJI_IN_CORRESPONDENT||d.get("flags.newsletter")&&h.HIDE_EMOJI_IN_CORRESPONDENT_NEWSLETTER){a.from[0].name=(0,j.deleteEmoji)(a.from[0].name);return Ya.call(this,a,b,c,d)}}if(b==="metathread_data"&&h.HIDE_EMOJI_IN_METATHREAD){var e=a;var f=e.category==="tomyself"?"subject":"name";e.last_senders=e.last_senders.map(function(a){if((0,j.hasEmoji)(a[f])){a[f]=(0,j.deleteEmoji)(a[f])||i18n("<Не указано>")}return a});return Ya.call(this,e,b,c,d)}return Ya.call(this,a,b,c,d)};var Za=Object.keys(Xa).map(function(a){return Xa[a].reaction&&[a,Xa[a].reaction]}).filter(function(a){return a});var $a=/^(not_exists|invalid)$/;var _a=void 0;var ab=void 0;var bb=new g.DataSourceLogger;var cb=null;var db=function a(){return cb.fetch()};var eb=false;var fb=void 0;var gb=new Promise(function(a){fb=a});function hb(){if(eb){return}eb=true;fb()}var ib=function(a){Wa(b,a);function b(){Sa(this,b);var a=Ua(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));ba.default.apply(a);a.updateAllPid=null;a.updateAll=a.updateAll.bind(a);a.scheduleUpdateAll=a.scheduleUpdateAll.bind(a);return a}Ta(b,[{key:"getData",value:function a(){var b=Ra({},_a);b.model=b;return b}},{key:"loadPromise",value:function a(){return gb}},{key:"getLoader",value:function a(){return cb}},{key:"updateAll",value:function a(){if(Y.default.active){if(h.IS_DEBUG){console.warn("[data-source] Отменён вызов updateAll, поскольку выполняется "+Y.default.active+" действий.")}return Promise.resolve(_a)}if(this.updateAllPid){window.clearTimeout(this.updateAllPid);this.updateAllPid=null}return this.dispatch({type:c.UPDATE_ALL,priority:ga.default.Loader.PRIORITY_LOW})}},{key:"scheduleUpdateAll",value:function a(){var b=this;if(this.updateAllPid){window.clearTimeout(this.updateAllPid)}this.updateAllPid=window.setTimeout(function(){b.updateAllPid=null;b.updateAll()},h.STATUS_DEBOUNCE_TIMEOUT);if(h.IS_DEBUG){console.warn("Запланирован вызов updateAll.")}}},{key:"dispatch",value:function a(c){Va(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"dispatch",this).call(this,c);return cb.dispatch(c)}}]);return b}(Z.default);var jb=new ib;if(h.LOG_DATASOURCE_PROBLEMS){jb.on("beforeaction",function(a){try{bb.addEntry(a)}catch(a){}});gb.then(function(){bb.stopLogging()})}cb=new ga.default.Loader(Xa,{persist:true,processing:function a(b,c,d){hb();Za.forEach(function(a){var c=Qa(a,2),e=c[0],f=c[1];d=f(b,d,{type:"FETCHED"},{fetch:db,previousData:_a[e]})});_a=d;_a.store=(0,X.getStore)();if(h.IS_DEBUG){console.warn("[data-source] "+c.type+(" "+(c.uid||"")),c,d)}jb.notifyNextData(b,c,d);return d},processingModelError:function b(d,e,f,g,i){if(h.IS_DEBUG){console.error("Ошибка загрузки модели:",d,e)}if((0,p.isJSSDKCompliantObject)(e)){var j=e.get("status");if(j===500&&_a===ab){(0,ka.default)(["processing","error","server"]);window.setTimeout(function(){return(0,aa.default)()},50);throw e}}if(i&&i.type===c.EXECUTE_JSSDK_ACTION){return null}(0,ka.default)(["processing","error",d]);if(!e||!e.get||!e.get("status")){ia.default.error({unique:true});if(h.IS_DEBUG){console.error(e)}(0,a.coreLoggerDispatchError)(e instanceof Error?e:new Error("Unknown datasource error in: "+d),{modelName:d,error:e});return Promise.reject("some_network_error")}switch(d){case"attachmentTemporary":{return[]}case"folders":{ia.default.error({unique:true});return ca.default.all}case"status":case"letters":{if($a.test(e.get("body.folder.error"))){if(i&&i.type===c.NAVIGATE){f.redirectTo(f.router.getUrl("#letters",{}),true)}else{f.router.nav(f.router.getUrl("#letters",{}))}var k=(0,P.emptyStatusFromRequest)(f);if(d==="letters"){return k.letters}return k}ia.default.error({unique:true});return[]}case"letter":{if($a.test(e.get("body.id.error"))){return new ea.default({NoMsg:1})}var l=f.params&&f.params.letter;ia.default.error({unique:true});return ea.default.all.get(l)||new ea.default({NoMsg:1})}case"message":{if($a.test(e.get("body.id.error"))){return new da.default({NoMsg:1})}ia.default.error({unique:true});return new da.default({NoMsg:1})}case"search":{return Ra({},(_a||{}).search,{letters:[]})}case"metathreads":{return[]}}(0,ka.default)(["processing","error","unhandled"]);return new fa.default}});_a=cb.defaults();ab=_a;_a.store=(0,X.getStore)();ha.default.on("websocket:reload",jb.scheduleUpdateAll);ha.default.on("any:reload",jb.scheduleUpdateAll);Y.default.on("complete",jb.scheduleUpdateAll);ja.default.on("pagelifecycle:reload",jb.scheduleUpdateAll);cb.setDebug(h.IS_DEBUG);exports.default=jb});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/jssdk-config/setupMailboxLimits",["require","exports","default-values","mail/Attachment","service/auth"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.kilabytesToBytes=void 0;b=__importDefault(b);c=__importDefault(c);function d(a){return a*1024}exports.kilabytesToBytes=d;var e=null;function f(c){b.default.MAX_AS_LINK_SIZE=a.MAX_CLOUD_STOCK_SIZE_LIMIT;var e=c.get("common_purpose_flags.enabled_mbox_quotas");var f=c.get("mbox_quotas");if(a.MAX_ATTACHES_SIZE_LIMIT!==null&&!e){b.default.MAX_SIZE=a.MAX_ATTACHES_SIZE_LIMIT}if(e&&f){b.default.MAX_SIZE=d(f.attach);b.default.MAX_AS_LINK_SIZE=d(f.link_attach)}}var g=function(a,b){return f(b)};function h(){var a=c.default.user;f(a);e===null||e===void 0?void 0:e.off("change",g);a.on("change",g);e=a}function i(){c.default.on("login",h)}exports.default=i});define("helpers/get-attachments-more-text",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getAttachmentsMoreText=void 0;var a=function(a){return" ".concat(i18n.plural(a,[i18n("и ещё {count} файлов",{count:a}),i18n("и ещё {count} файл",{count:a}),i18n("и ещё {count} файла",{count:a})]))};exports.getAttachmentsMoreText=a});define("helpers/get-fwd-message",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getFwdMessage=void 0;var a=function(a,b){var c=b-1;return c>0?i18n.plural(c,[i18n("Fwd: {forwardName} (+{count} писем)",{forwardName:a,count:c}),i18n("Fwd: {forwardName} (+{count} письмо)",{forwardName:a,count:c}),i18n("Fwd: {forwardName} (+{count} письма)",{forwardName:a,count:c})]):i18n("Fwd: {forwardName}",{forwardName:a})};exports.getFwdMessage=a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/create-message-form-data",["require","exports","default-values","service/auth","service/jssdk-config/setupMailboxLimits","./get-attachments-more-text","./get-fwd-message"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createMessageFormData=exports.getMessageFormDataOptions=void 0;b=__importDefault(b);var f=function(){var f={helpers:{getAttachmentsMoreText:d.getAttachmentsMoreText,getFwdMessage:e.getFwdMessage},params:{ATTACHMENTS_RESTORE:a.RESTORE_EXPIRED_ATTACHMENTS,ATTACHMENTS_EXPIRATION_TIME:a.RESTORE_EXPIRED_ATTACHMENTS?a.RESTORE_EXPIRED_ATTACHMENTS_TIME:null}};var g=b.default.user;var h=g.get("common_purpose_flags.enabled_mbox_quotas");var i=g.get("mbox_quotas");if(a.MAX_ATTACHES_SIZE_LIMIT!==null&&!h){f.params.MAX_SPACE_LEFT=a.MAX_ATTACHES_SIZE_LIMIT}if(h&&i){f.params.MAX_SPACE_LEFT=(0,c.kilabytesToBytes)(i.attach)}return f};exports.getMessageFormDataOptions=f;var g=function(a){return __awaiter(void 0,void 0,Promise,function(){var b,c,d,e,f;return __generator(this,function(g){switch(g.label){case 0:b=new Promise(function(a,b){require(["mail/MessageFormData"],a,b)}).then(__importStar);c=(0,exports.getMessageFormDataOptions)(),d=c.params,e=c.helpers;return[4,b];case 1:f=g.sent().default;return[2,new f(__assign(__assign({},d),a),e)]}})})};exports.createMessageFormData=g});define("helpers/signature",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getHTMLSignature=e;exports.cleanHTMLSignature=f;exports.getSignatures=g;var a=exports.NEW_LINE="<div><br/></div>";var b=exports.replaceBR=function a(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";return b.replace(/<br>/g,c)};var c=exports.trimBRNL=function c(d){return d.replace(/^(<br>)+|(<br>)+$/g,function(c){return b(c,a)})};var d=exports.trimBR=function a(c){return c.replace(/^(<br>)+|(<br>)+$/g,function(a){return b(a)})};function e(a){var b=a.get("signs").filter(function(a){return a.active})[0]||{};var c=b.sign_html||"";c='<div data-signature-widget="container" data-signature-id="current">'+'<div data-signature-widget="content">'+c+"</div></div>";return c}function f(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";return a.replace('data-signature-id="current"',"")}function g(a){return a.get("signs").map(function(a){a.sign_html=c(a.sign_html||"");return a})}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __rest=this&&this.__rest||function(a,b){var c={};for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0)c[d]=a[d];if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++){if(b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e]))c[d[e]]=a[d[e]]}return c};define("mediator/layout-manager/utils",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.snapToMinSize=exports.limitWidths2pane=exports.limitWidths3pane=exports.transformSizes=exports.limitWidths=exports.clamp=exports.defaultMaxSizes=exports.defaultMinSizes=exports.pick=void 0;function a(a,b){return b.reduce(function(b,c){b[c]=a[c];return b},{})}exports.pick=a;var b=15;var c=["left","sidebar","content","right"];var d=["left","main","right"];exports.defaultMinSizes={left:b,main:150,sidebar:70,content:150,right:60};var e=a(exports.defaultMinSizes,c);var f=a(exports.defaultMinSizes,d);exports.defaultMaxSizes={left:416/4,sidebar:Infinity,content:Infinity,main:1632/4,right:60};var g=a(exports.defaultMaxSizes,c);var h=a(exports.defaultMaxSizes,d);function i(a){var b=function(a,b){return a+b};return Object.values(a).reduce(b)}function j(a,b){return Object.keys(a).reduce(function(c,d){c[d]=b(d,a[d]);return c},{})}function k(a,b,c){if(b<a){return a}if(b>c){return c}return b}exports.clamp=k;function l(a,b,c){var d=c.minSizes,e=c.maxSizes,f=c.priorityColumns;var g=j(a,function(a,b){if(!b){return d[a]}return k(d[a],b,e[a])});var h=__assign(__assign({},d),g);var l=i(h);if(l<=b){return h}var m=i(d);if(m>b){console.error("minSizes provided are not suitable for current width! ".concat(JSON.stringify({minSizes:d,availableWidth:b})))}var n=__assign({},d);var o=b-m;var p=["right","content","main","sidebar","left"];var q=f||Object.keys(a);var r=q.concat(p.filter(function(b){return!a.hasOwnProperty(b)}));r.forEach(function(b){if(o<=0){return}var c=k(d[b],a[b],Math.min(exports.defaultMaxSizes[b],d[b]+o));n[b]=c;o-=c-d[b]});return n}exports.limitWidths=l;function m(a,b,c){var d={left:b.left(a.left)};var e=c==="3pane"?"content":"main";d[e]=a[e]+(a.left-d.left);return __assign(__assign({},a),d)}exports.transformSizes=m;function n(b,d,f){if(f===void 0){f={}}var h=f.minSizes,i=h===void 0?e:h,j=f.maxSizes,k=j===void 0?g:j,m=__rest(f,["minSizes","maxSizes"]);return l(a(b,["left","sidebar"]),d,__assign(__assign({},m),{minSizes:a(i,c),maxSizes:a(k,c)}))}exports.limitWidths3pane=n;function o(b,c,e){var g=e===void 0?{}:e,i=g.minSizes,j=i===void 0?f:i,k=g.maxSizes,m=k===void 0?h:k;return l(a(b,["left"]),c,{minSizes:a(j,d),maxSizes:a(m,d)})}exports.limitWidths2pane=o;function p(a,b,c){if(a<=b){return c}return a}exports.snapToMinSize=p});define("mediator/swipe-manager",["exports","feast","ui-block/swipeable/swipeable"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default=c.default.Mediator.create("swipe-manager",{components:{swipeable:{class:d.default,events:["underlay-changed"]}},defaults:function a(){this.isDatasetOpaque=true},handleEvent:function a(b){var c=b.type,d=b.details;switch(c){case"underlaychanged":this.isDatasetOpaque=!d.value;this.updateAll();break}},close:function a(b){this.getList("swipeable").forEach(function(a){if(a===b){return}a.reset()})},reset:function a(){this.close()}})});(function(a,b){typeof exports==="object"&&typeof module!=="undefined"?b(exports):typeof define==="function"&&define.amd?define("mqmatch",["exports"],b):(a=a||self,b(a.mqMatch={}))})(this,function(exports){"use strict";var a=function(){function a(){var a=this;this._queries={};this._handlers=[];this._handleMediaQueryChange=function(){var b=a.getCurrentMatches();var c=b.join(",");if(a._lastFiredSnapshot!==undefined&&a._lastFiredSnapshot===c){return}a._lastFiredSnapshot=c;for(var d=0,e=a._handlers;d<e.length;d++){var f=e[d];f(b)}}}a.prototype.getCurrentMatches=function(){var a=this;return Object.keys(this._queries).filter(function(b){return a._queries[b].query.matches}).sort()};a.prototype.getCurrentSnapshot=function(){var a=this;return Object.keys(this._queries).map(function(b){return{key:b,raw:a._queries[b].value,parsed:a._queries[b].query.media,matches:a._queries[b].query.matches}})};a.prototype.on=function(a,b){if(a!=="change"){return}if(this._handlers.indexOf(b)===-1){this._handlers.push(b)}};a.prototype.off=function(a,b){if(a!=="change"){return}var c=this._handlers.indexOf(b);if(c!==-1){this._handlers.splice(c,1)}};a.prototype.register=function(a,b){if(b===undefined){b=a}if(this._queries[a]){return}var c=matchMedia(b);if(typeof c.addEventListener==="function"){c.addEventListener("change",this._handleMediaQueryChange)}else{c.addListener(this._handleMediaQueryChange)}this._queries[a]={value:b,query:c};if(c.matches){this._handleMediaQueryChange()}};a.prototype.unregister=function(a){if(!this._queries[a]){return}var b=this._queries[a].query;if(typeof b.removeEventListener==="function"){b.removeEventListener("change",this._handleMediaQueryChange)}else{b.removeListener(this._handleMediaQueryChange)}delete this._queries[a];if(b.matches){this._handleMediaQueryChange()}};a.prototype.destroy=function(){var a=this;this._handlers.length=0;Object.keys(this._queries).forEach(function(b){return a.unregister(b)})};return a}();function b(){return new a}exports.createMediaQueryMatch=b;Object.defineProperty(exports,"__esModule",{value:true})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/vkMessengerLoader",["require","exports","default-values","helpers/data-source-dispatch","logger","mediator/layout-manager/utils","service/getModule","service/storage","service/themes.setup"],function(require,exports,a,b,c,d,e,f,g){"use strict";var h;Object.defineProperty(exports,"__esModule",{value:true});exports.vkMessengerLoader=exports.logger=void 0;c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.logger=c.default.getScope("vk-messenger-loader");var i=null;var j=((h=g.default===null||g.default===void 0?void 0:g.default.getSelectedModel())===null||h===void 0?void 0:h.isDarkMode())||false;var k=d.defaultMinSizes.right*4;exports.vkMessengerLoader={isLoaded:function(){return!!i},open:function(b){return(a.USE_WEBPACK_BUILD?new Promise(function(a,b){require(["vk-messenger"],a,b)}).then(__importStar):(0,e.default)("vk-messenger")).then(function(a){exports.logger.add("open",b);i=a.vkMessenger;return i.open(__assign({darkMode:j,offset:k,onClose:exports.vkMessengerLoader.onClose},b))})},setThemeMode:function(a){exports.logger.add("setThemeMode, darkMode:",a);j=a;if(i){i.setThemeMode(a)}},setOffset:function(a){exports.logger.add("setOffset, offset:",a);k=a;if(i){i.setOffset(a)}},restoreOnReload:function(){exports.logger.add("try restoreOnReload");if(a.VK_MESSENGER_RESTORE_ON_REFRESH_DISABLED){exports.logger.add("restoreOnReload: feature disabled");return}var b=f.default.get(a.VK_MESSENGER_ACTIVE_CHAT_STORAGE_KEY);if(!b){exports.logger.add("restoreOnReload: no active chat id",b);return}exports.logger.add("restoreOnReload: open chat for:",b);exports.vkMessengerLoader.open({chatId:b})},isOpen:function(){return exports.vkMessengerLoader.isLoaded()&&i.isOpen()},onClose:function(){(0,b.dataSourceDispatchUpdateAll)()}}});define("feast-tpl!app/feast-tpl!ui-block/ad-feedback/ad-feedback.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:choose>\n\t\t<fn:when test="attrs[\'step\'] === 2">\n\t\t\t<b:react-async\n\t\t\t\tcomponent="AdFeedback2step"\n\t\t\t\tsmall="{attrs[\'right-column\'] <= 160}"\n\t\t\t\tindented="{attrs[\'indented\']}"\n\t\t\t\tonNotInterestingClick="{_this.onNotInterestingClick}"\n\t\t\t\tonAlreadyPurchasedClick="{_this.onAlreadyPurchasedClick}"\n\t\t\t\tonOtherClick="{_this.onOtherClick}"\n\t\t\t\tonCancelClick="{_this.onCancelClick}"\n\t\t\t/>\n\t\t</fn:when>\n\t\t<fn:otherwise>\n\t\t\t<b:react-async\n\t\t\t\tcomponent="AdFeedback"\n\t\t\t\tisFirstVersion="{_this.isFirstVersion()}"\n\t\t\t\tdisabled="{attrs[\'disabled\']}"\n\t\t\t\tsmall="{attrs[\'right-column\'] <= 160}"\n\t\t\t\tindented="{attrs[\'indented\']}"\n\t\t\t\ttitle="{_this.getTextData().title}"\n\t\t\t\tnegativeButtonText="{_this.getTextData().negativeButtonText}"\n\t\t\t\tpositiveButtonText="{_this.getTextData().positiveButtonText}"\n\t\t\t\tunknownButtonText="{_this.getTextData().unknownButtonText}"\n\t\t\t\tonPositiveClick="{_this.onActionPositiveClick}"\n\t\t\t\tonNegativeClick="{_this.onActionNegativeClick}"\n\t\t\t\tonUnknownClick="{_this.onActionUnknownClick}"\n\t\t\t/>\n\t\t</fn:otherwise>\n\t</fn:choose>\n</div>\n',"app/feast-tpl!ui-block/ad-feedback/ad-feedback.html")});define("feast-tpl!ui-block/ad-feedback/ad-feedback.html",["feast-tpl!app/feast-tpl!ui-block/ad-feedback/ad-feedback.html"],function(a){return a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/ad-feedback/ad-feedback",["require","exports","@mail/xray","default-values","feast","feast-tpl!./ad-feedback.html","service/adv/index","ui-block/react-async/react-async"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);exports.default=c.default.Block.extend({name:"ad-feedback",template:d.default,blocks:{"react-async":f.default},defaults:{disabled:true,step:1},immutable:true,storedDwh:null,constructor:function(){c.default.Block.apply(this,arguments);this.onActionPositiveClick=this.onActionPositiveClick.bind(this);this.onActionNegativeClick=this.onActionNegativeClick.bind(this);this.onActionUnknownClick=this.onActionUnknownClick.bind(this);this.on1StepClick=this.on1StepClick.bind(this);this.onNotInterestingClick=this.onNotInterestingClick.bind(this);this.onAlreadyPurchasedClick=this.onAlreadyPurchasedClick.bind(this);this.onOtherClick=this.onOtherClick.bind(this);this.onCancelClick=this.onCancelClick.bind(this)},didMount:function(){var b=this;a.default.send("ad-feedback-show",{dwh:{state:"ad-feedback-show"}});e.default.on("sidebar:visible",function(){return b.handleSidebarAdVisible()})},destroyElement:function(){e.default.setFeedbackUnactive();this.el.parentNode.removeChild(this.el)},handleSidebarAdVisible:function(){this.set("disabled",false)},sendFeedback:function(b,c){var d={dwh:__assign({state:b},c)};a.default.send(b,d)},onActionPositiveClick:function(){var a=e.default.dwhData;this.sendFeedback("ad-feedback-positive",a);this.destroyElement()},onActionNegativeClick:function(){var a=e.default.dwhData;this.sendFeedback("ad-feedback-negative",a);this.on1StepClick(a)},onActionUnknownClick:function(){var a=e.default.dwhData;this.sendFeedback("ad-feedback-unknown",a);this.destroyElement()},getTextData:function(){var a=b.ADVERT_FEEDBACK_TEXTS.title,c=b.ADVERT_FEEDBACK_TEXTS.positiveButtonText,d=b.ADVERT_FEEDBACK_TEXTS.negativeButtonText,e=b.ADVERT_FEEDBACK_TEXTS.unknownButtonText;return{title:a||i18n("Вам интересны похожие предложения?"),positiveButtonText:c||i18n("Интересны"),negativeButtonText:d||i18n("Не моё"),unknownButtonText:e}},on1StepClick:function(a){var c=b.ADVERT_FEEDBACK_CONFIG2.step2enable;if(c){this.set("step",2);e.default.setFeedback2Step();this.storedDwh=a;this.sendFeedback("ad-feedback-2-show",a)}else{this.destroyElement()}},onNotInterestingClick:function(){this.sendFeedback("ad-feedback-2-not-intr",this.storedDwh);this.destroyElement()},onAlreadyPurchasedClick:function(){this.sendFeedback("ad-feedback-2-alrd-prchsd",this.storedDwh);this.destroyElement()},onOtherClick:function(){this.sendFeedback("ad-feedback-2-other",this.storedDwh);this.destroyElement()},onCancelClick:function(){this.sendFeedback("ad-feedback-2-cancel",this.storedDwh);this.destroyElement()}})});define("feast-tpl!app/feast-tpl!ui-block/application-mail/application-mail.html",["feast"],function(a){return a.smartParse('<div>\n\t\x3c!-- FMAIL-17519 Новый тулбар для кросспроектной навигации --\x3e\n\t<fn:var name="useNewToolbar" value="{_this.useNewToolbar()}" />\n\t<fn:var name="useTopLineAdv" value="{_this.useTopLineAdv()}" />\n\t<bem:mod name="pony-mode" test="attrs.ponymode"/>\n\n\t<div bem:elem="overlay" promo:id="{_this.usePromoNewToolbar() ? \'new-toolbar\' : \'\'}">\n\t\t<div bem:elem="wrap">\n\n\t\t\t\x3c!-- Флаг, что письмо не найдено --\x3e\n\t\t\t<fn:var name="letterNotFound" value="{attrs.letter && attrs.letter.isNew() && attrs.letter.is(\'NoMsg\')}" />\n\t\t\t\x3c!-- То сути означает, включен ли новый список писем --\x3e\n\t\t\t<fn:var name="isThreadRounded" value="{_this.isThreadRounded()}" />\n\t\t\t\x3c!-- Отдельный сайдбар и хедер для мобильного вебвью FMAIL-14049 --\x3e\n\t\t\t<fn:var name="webviewMobileMode" value="{attrs.mobile && (attrs[\'is-webview\'] || attrs[\'is-octavius-mobile\']) }" />\n\n\t\t\t\x3c!-- DON\'T REMOVE: <b:layer-window /> --\x3e\n\t\t\t<fn:if test="webviewMobileMode">\n\t\t\t\t<b:webview-mobile-header\n\t\t\t\t\t\tuse:mediator="letters-selection letters-actions layout-manager compose-manager search-manager pony-mode translator-manager filter-manager user-info themes-manager mobile-sidebar-manager vk-overlay"\n\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\tfolder="{attrs.model.folder}"\n\t\t\t\t\t\tletter="{attrs.model.letter}"\n\t\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\t\tstore="{attrs.store}"\n\t\t\t\t\t\tfolderActive="{attrs.route.is(\'#search #search-letter\') ? undefined : attrs.model.folder.id}"\n\t\t\t\t\t\tmodels="{attrs.model.folders}"\n\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t/>\n\t\t\t\t<b:mobile-sidebar\n\t\t\t\t\t\tuse:mediator="settings-manager mobile-sidebar-manager"\n\t\t\t\t\t\tfolder-active="{attrs.route.is(\'#search #search-letter\') ? undefined : attrs.model.folder.id}"\n\t\t\t\t\t\tmodels="{attrs.model.folders}"\n\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\tstore="{attrs.store}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="!webviewMobileMode">\n\t\t\t\t\x3c!-- Синий тулбар --\x3e\n\t\t\t\t<b:portal-menu\n\t\t\t\t\t\tfn:if="!useNewToolbar"\n\t\t\t\t\t\tuse:mediator="letters-selection letters-actions layout-manager compose-manager search-manager pony-mode translator-manager filter-manager user-info themes-manager"\n\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\tstore="{attrs.store}"\n\n\t\t\t\t\t\tletter="{attrs.model.letter}"\n\t\t\t\t\t\tfolder="{attrs.model.folder}"\n\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\tmodels="{attrs.model.letters}"\n\t\t\t\t\t\tletterNeighbours="{attrs.model.letterNeighbours}"\n\n\t\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\t\tshowBackToParentFolder="{attrs.showBackToParentFolder}"\n\t\t\t\t/>\n\t\t\t\t\x3c!-- Только поиск от ex. cиниго тулбара --\x3e\n\t\t\t\t<b:react-async\n\t\t\t\t\tfn:if="useNewToolbar && _this.useReactSearchPanel()"\n\t\t\t\t\tcustomNode="{_this.usePortalSearchPanel() ? __PH.getSearchPlaceholder() : null}"\n\t\t\t\t\tcomponent="SearchPanel"\n\t\t\t\t\tcomponentClass="{this.lazySearchPanel()}"\n\t\t\t\t\tblockRadarId="srch"\n\t\t\t\t\tuseErrorBoundary\n\t\t\t\t\tuseMediators="{[\'search-manager\',\'layout-manager\',\'themes-manager\',\'letters-selection\']}"\n\t\t\t\t\tstore="{attrs.store}"\n\t\t\t\t\tremit:click="search"\n\t\t\t\t\tponyMode="{attrs.ponyMode}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\n\t\t\t<div bem:elem="layout" bem:mod="main">\n\t\t\t\t<b:layout\n\t\t\t\t\t\tvertical-fit\n\t\t\t\t\t\tresizable="{attrs[\'user-resize\']}"\n\t\t\t\t\t\tsidebar-resizable="{attrs[\'user-resize-3pane\']}"\n\t\t\t\t\t\tbordered="{_this.showLayoutBorders()}"\n\t\t\t\t\t\tletter="{attrs.model.letter}"\n\t\t\t\t\t\tuse:mediator="layout-manager letters-selection thread-scroller search-manager todo-manager"\n\t\t\t\t\t\tid="main"\n\t\t\t\t\t\tgroup="main"\n\t\t\t\t\t\tqa:id="main"\n\t\t\t\t\t\tstore="{attrs.store}"\n\t\t\t\t\t\tponymode="{attrs.uiLayout.ponyMode}"\n\t\t\t\t\t\tisDragIconShown="{_this.isDragIconShown()}"\n\t\t\t\t>\n\t\t\t\t\t<fn:match name="left-column" args="layout">\n\t\t\t\t\t\t<fn:var name="isSearch" value="{attrs.route.is(\'#search #search-letter\')}"/>\n\t\t\t\t\t\t\x3c!-- Левая колонка --\x3e\n\t\t\t\t\t\t<fn:if test="attrs.route.is(\'#letters #read-letter #search #search-letter\')">\n\t\t\t\t\t\t\t<b:sidebar-folders\n\t\t\t\t\t\t\t\t\tis-search="{isSearch}"\n\t\t\t\t\t\t\t\t\tuse:mediator="themes-manager pony-mode compose-manager layout-manager user-info"\n\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\tfolder-active="{attrs.route.is(\'#search #search-letter\') ? undefined : attrs.model.folder.id}"\n\t\t\t\t\t\t\t\t\tmodels="{attrs.model.folders}"\n\t\t\t\t\t\t\t\t\tstore="{attrs.store}"\n\t\t\t\t\t\t\t\t\tbillsCount="{attrs.model.billsCount}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</fn:match>\n\n\t\t\t\t\t<fn:match name="main-frame-sidebar" args="layout">\n\t\t\t\t\t\t<fn:var name="touch" value="{layout.isLessThen(\'xs\')}"/>\n\t\t\t\t\t\t<fn:var\n\t\t\t\t\t\t\t\tname="compact"\n\t\t\t\t\t\t\t\tvalue="{!layout[\'left-column\'] || layout.type === \'3pane\' || touch}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<fn:var name="isSearch" value="{attrs.route.is(\'#search #search-letter\')}"/>\n\n\t\t\t\t\t\t<b:letter-list-item-adv\n\t\t\t\t\t\t\t\tfn:if="useTopLineAdv"\n\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\tcompact="{compact}"\n\t\t\t\t\t\t\t\trounded="{isThreadRounded}"\n\t\t\t\t\t\t\t\ttopline="{true}"\n\t\t\t\t\t\t\t\tfolder="{attrs.model.folder}"\n\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\tponymode="{attrs.uiLayout.ponyMode}"\n\t\t\t\t\t\t\t\tuid="{model.id}"\n\t\t\t\t\t\t\t\tno-delimeter="{true}"\n\t\t\t\t\t\t\t\tuse:mediator="letter-list-adv-optimizer advert-manager"\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\tfn:if="useNewToolbar"\n\t\t\t\t\t\t\tclass-name="only-new-toolbar new-menu"\n\n\t\t\t\t\t\t\thasLetters="{attrs.uiLetters.length}"\n\n\t\t\t\t\t\t\tcomponent="ListLetterHeaderActions"\n\t\t\t\t\t\t\tcomponentClass="{_this.lazyListLetterHeaderActions()}"\n\t\t\t\t\t\t\tadvTopLine="{useTopLineAdv}"\n\t\t\t\t\t\t\tblockRadarId="llha"\n\t\t\t\t\t\t\tuseErrorBoundary\n\t\t\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\tstore="{attrs.store}"\n\n\t\t\t\t\t\t\tletter="{attrs.model.letter}"\n\t\t\t\t\t\t\tfolder="{attrs.model.folder}"\n\t\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\t\tmodels="{attrs.model.letters}"\n\t\t\t\t\t\t\tletterNeighbours="{attrs.model.letterNeighbours}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- Список писем --\x3e\n\t\t\t\t\t\t<b:letter-list\n\t\t\t\t\t\t\t\tqa:id="letter-list-{isSearch ? \'search\' : attrs.model.folder.id}"\n\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\t\t\t\tmetathreads="{attrs.metathreads}"\n\t\t\t\t\t\t\t\tmodels="{attrs.uiLetters}"\n\t\t\t\t\t\t\t\tstatus="{attrs.status}"\n\t\t\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\t\t\tfolder="{attrs.model.folder}"\n\t\t\t\t\t\t\t\tlayout="{layout}"\n\t\t\t\t\t\t\t\thidden-payment-dies="{attrs.hiddenPaymentDies}"\n\t\t\t\t\t\t\t\tcompact="{compact}"\n\t\t\t\t\t\t\t\ttouch="{touch}"\n\t\t\t\t\t\t\t\tunsubscribeList="{attrs.unsubscribeList}"\n\t\t\t\t\t\t\t\tshowBackToParentFolder="{attrs.showBackToParentFolder}"\n\t\t\t\t\t\t\t\tuse:mediator="letters-loader letters-navigation pony-mode"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<b:renovator\n\t\t\t\t\t\t\tuse:mediator="routes-manager layout-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:match>\n\n\t\t\t\t\t<fn:match name="main-frame-content" args="layout">\n\t\t\t\t\t\t<fn:var name="touch" value="{layout.isLessThen(\'xs\')}"/>\n\t\t\t\t\t\t<fn:var\n\t\t\t\t\t\t\t\tname="compact"\n\t\t\t\t\t\t\t\tvalue="{!layout[\'left-column\'] || layout.type === \'3pane\' || touch}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t\x3c!-- Письма выбраны в 3pane --\x3e\n\t\t\t\t\t\t<fn:var\n\t\t\t\t\t\t\t\tname="previewSelectedLetters"\n\t\t\t\t\t\t\t\tvalue="{!letterNotFound && _this.checkShowLetterPreview3Pane(layout.selectMode)}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div bem:elem="letter-content" qa:id="letter-content">\n\t\t\t\t\t\t\t<bem:mod name="3pane-preview" test="previewSelectedLetters"/>\n\t\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\t\tfn:if="useNewToolbar"\n\n\t\t\t\t\t\t\t\tclass-name="only-new-toolbar new-menu content-header"\n\n\t\t\t\t\t\t\t\tcomponent="LetterHeaderActions"\n\t\t\t\t\t\t\t\tcomponentClass="{_this.lazyLetterHeaderActions()}"\n\t\t\t\t\t\t\t\tblockRadarId="lha"\n\t\t\t\t\t\t\t\tuseErrorBoundary\n\t\t\t\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\tstore="{attrs.store}"\n\n\t\t\t\t\t\t\t\tletter="{attrs.model.letter}"\n\t\t\t\t\t\t\t\tfolder="{attrs.model.folder}"\n\t\t\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\t\t\tmodels="{attrs.model.letters}"\n\t\t\t\t\t\t\t\tletterNeighbours="{attrs.model.letterNeighbours}"\n\t\t\t\t\t\t\t\tletterNotFound="{letterNotFound}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<b:letter-list-item-adv\n\t\t\t\t\t\t\t\tfn:if="_this.isAdvEnable() && !compact"\n\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\tcompact="{compact}"\n\t\t\t\t\t\t\t\tkey="{_this.getKey(model)}"\n\t\t\t\t\t\t\t\tponymode="{attrs.uiLayout.ponyMode}"\n\t\t\t\t\t\t\t\tuid="{model.id}"\n\t\t\t\t\t\t\t\tuse:mediator="letter-list-adv-optimizer advert-manager"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t\t\x3c!-- Письма выбраны в 3pane --\x3e\n\t\t\t\t\t\t\t\t<fn:when test="previewSelectedLetters">\n\t\t\t\t\t\t\t\t\t<b:panel-with-selected\n\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection themes-manager"\n\t\t\t\t\t\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\t\t\t\t\t\tfolder="{attrs.model.folder}"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<fn:match name="empty">\n\t\t\t\t\t\t\t\t\t\t\t<fn:if test="!(attrs.route.is(\'#search-letter #search\') && !attrs.model.search.length) && attrs.letters.length">\n\t\t\t\t\t\t\t\t\t\t\t\t<b:octopus\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype="no-select"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuse:mediator="layout-manager letters-actions folders-navigation filter-manager themes-manager pony-mode"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t\t\t</fn:match>\n\t\t\t\t\t\t\t\t\t</b:panel-with-selected>\n\t\t\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t\t<b:scrollable\n\t\t\t\t\t\t\t\t\t\t\tname="letter-content"\n\t\t\t\t\t\t\t\t\t\t\temit-onbottom="100"\n\t\t\t\t\t\t\t\t\t\t\tsubstrated="{!isThreadRounded}"\n\t\t\t\t\t\t\t\t\t\t\tbright="{!isThreadRounded}"\n\t\t\t\t\t\t\t\t\t\t\tuse:mediator="thread-scroller advert-manager"\n\t\t\t\t\t\t\t\t\t\t\tleft-gap="{isThreadRounded}"\n\t\t\t\t\t\t\t\t\t\t\tbackground-transparent="{isThreadRounded}"\n\t\t\t\t\t\t\t\t\t\t\tcontent\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\x3c!-- TODO: нужен рефактиринг условий, избавиться от сложный условий --\x3e\n\t\t\t\t\t\t\t\t\t\t\x3c!-- Письмо не найдено --\x3e\n\t\t\t\t\t\t\t\t\t\t<fn:if test="letterNotFound">\n\t\t\t\t\t\t\t\t\t\t\t<fn:var name="touch" value="{layout.isLessThen(\'xs\')}"/>\n\t\t\t\t\t\t\t\t\t\t\t<fn:var\n\t\t\t\t\t\t\t\t\t\t\t\t\tname="compact"\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue="{!layout[\'left-column\'] || layout.type === \'3pane\' || touch}"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t\t\t\t<fn:if test="(layout.type === \'3pane\' && !layout.selectMod) && attrs.route.is(\'#read-letter #search-letter\')">\n\t\t\t\t\t\t\t\t\t\t\t\t<b:panel-with-selected\n\t\t\t\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfolder="{attrs.model.folder}"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<fn:match name="empty">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<b:octopus\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype="no-letter"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tuse:mediator="layout-manager themes-manager pony-mode"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</fn:match>\n\t\t\t\t\t\t\t\t\t\t\t\t</b:panel-with-selected>\n\t\t\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t\t\t\t<fn:if test="((layout.type === \'2pane\' && !layout.selectMod) && attrs.route.is(\'#read-letter #search-letter\'))">\n\t\t\t\t\t\t\t\t\t\t\t\t<b:letter-list\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tqa:id="letter-list-{attrs.model.folder.id}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlayout="{layout}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompact="{false}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttouch="{touch}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodels="{attrs.uiLetters}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfolder="{attrs.model.folder}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tletter-not-found="{letterNotFound}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmetathreads="{attrs.metathreads}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tunsubscribeList="{attrs.unsubscribeList}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowBackToParentFolder="{attrs.showBackToParentFolder}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-loader letters-navigation pony-mode"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t\t\t<fn:if test="!letterNotFound">\n\t\t\t\t\t\t\t\t\t\t\t<fn:var\n\t\t\t\t\t\t\t\t\t\t\t\t\tname="compact"\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue="{!layout[\'left-column\'] || layout.type === \'3pane\'}"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t\t\t\t<fn:if test="!attrs.route.is(\'#search-letter\')">\n\t\t\t\t\t\t\t\t\t\t\t\t<fn:if test="(layout.type !== \'3pane\' || !layout.selectMode ) && attrs.route.is(\'#read-letter\')">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<b:thread\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn:if="!_this.useNewThread()"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-actions thread-manager thread-scroller compose-manager layout-manager pony-mode themes-manager folders-actions"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trounded="{isThreadRounded}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\troute="{attrs.router[\'#read-letter\']}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodel="{attrs.letter}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompact="{compact}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\texpand-letter-id="{attrs.request.params.message}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tisDragIconShown="{layout.type === \'3pane\' && _this.isDragIconShown()}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn:if="_this.useNewThread()"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomponent="Thread"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuseMediators="{[\'letters-actions\', \'thread-manager\', \'thread-scroller\', \'compose-manager\', \'layout-manager\', \'pony-mode\', \'themes-manager\', \'folders-actions\']}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trounded="{isThreadRounded}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\troute="{attrs.router[\'#read-letter\']}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodel="{attrs.letter}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompact="{compact}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\texpand-letter-id="{attrs.request.params.message}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tisDragIconShown="{layout.type === \'3pane\' && _this.isDragIconShown()}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t\t\t\t<fn:if test="attrs.route.is(\'#search-letter\')">\n\t\t\t\t\t\t\t\t\t\t\t\t<fn:if test="(layout.type !== \'3pane\' || !layout.selectMode ) && attrs.route.is(\'#search-letter\')">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<b:thread\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn:if="!_this.useNewThread()"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-actions search-manager thread-manager thread-scroller compose-manager layout-manager pony-mode themes-manager"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trounded="{isThreadRounded}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\troute="{attrs.router[\'#search-letter\']}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodel="{attrs.letter}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompact="{compact}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tautoread\n\t\t\t\t\t\t\t\t\t\t\t\t\t\texpand-letter-id="{attrs.request.params.id}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfn:if="_this.useNewThread()"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomponent="Thread"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuseMediators="{[\'letters-actions\', \'thread-manager\', \'thread-scroller\', \'compose-manager\', \'layout-manager\', \'pony-mode\', \'themes-manager\', \'folders-actions\']}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trounded="{isThreadRounded}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\troute="{attrs.router[\'#search-letter\']}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodel="{attrs.letter}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfolders="{attrs.model.folders}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompact="{compact}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tautoread\n\t\t\t\t\t\t\t\t\t\t\t\t\t\texpand-letter-id="{attrs.request.params.id}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t\t</b:scrollable>\n\t\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:match>\n\n\t\t\t\t\t<fn:match name="right-column" args="layout">\n\t\t\t\t\t\t<fn:var name="isSearch" value="{attrs.route.is(\'#search\') || attrs.route.is(\'#search-letter\') && (layout.type === \'3pane\')}"/>\n\t\t\t\t\t\t<fn:var name="isAdvertScroll" value="{layout[\'is-advert-scroll\']}"/>\n\n\t\t\t\t\t\t<div bem:elem="overflow-container" fn:if="!layout[\'hide-ads\']">\n\t\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t\t<fn:when test="isAdvertScroll">\n\t\t\t\t\t\t\t\t\t<b:advert-column\n\t\t\t\t\t\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\t\t\t\tuse:mediator="advert-manager"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t\t<b:slot qa:id="right-column-adv" use:mediator="layout-manager"/>\n\t\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\tcomponent="WidgetColumn"\n\t\t\t\t\t\t\tcomponentClass="{_this.lazyWidgetColumn()}"\n\t\t\t\t\t\t\tqa:id="right-column-todo"\n\t\t\t\t\t\t\tclass-name="fill-parent"\n\t\t\t\t\t\t\tuseMediators="{[\'layout-manager\', \'themes-manager\', \'todo-manager\']}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:match>\n\n\t\t\t\t\t<fn:match name="dimmer" args="layout">\n\t\t\t\t\t\t<fn:if test="layout.dimmer">\n\t\t\t\t\t\t\t<b:dimmer />\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</fn:match>\n\n\t\t\t\t</b:layout>\n\t\t\t</div>\n\n\t\t\t<fn:if test="webviewMobileMode && !attrs[\'disable-footer-app-toolbar\'] && !attrs.route.is(\'#read-letter #search #search-letter\')">\n\t\t\t\t<b:react-async\n\t\t\t\t\tcomponent="WebviewMobileFooter"\n\t\t\t\t\tfolderActive="{attrs.route.is(\'#search #search-letter\') ? undefined : attrs.model.folder.id}"\n\t\t\t\t\tmodels="{attrs.model.folders}"\n\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t\t\x3c!-- Контейнер для порталов реакта, для оверлея тултипа --\x3e\n\t\t\t\x3c!-- Тут будем рисовать всякие оверлеи, например использовать как портал для react элементов --\x3e\n\t\t\t\x3c!-- Используется для тултипа, который в дропдауне при нажатии на скрепку, аттачи к письму --\x3e\n\t\t\t<div bem:elem="portal-overlay" id="portal-overlay"></div>\n\t\t</div>\n\t</div>\n\n\t<b:shortcut />\n\t<b:counters/>\n\t\x3c!-- Скрытый фрейм для загрузки аттачей --\x3e\n\t\x3c!-- Один на страницу, у него всегда name=download-frame --\x3e\n\t<b:download-frame/>\n\n\t\x3c!-- Прогрессбар --\x3e\n\t<span bem:elem="progress">\n\t\t<b:progress\n\t\t\tuse:mediator="progress-bar-manager"\n\t\t\tmin="0"\n\t\t\tmax="100"\n\t\t/>\n\t</span>\n\n\t\x3c!-- Загрузчик vk messenger (покажет, если нужно) --\x3e\n\t<b:react-async\n\t\tcomponent="VkMessengerProvider"\n\t\tcomponentClass="{_this.lazyVkMessengerProvider()}"\n\t/>\n\n\t<fn:if test="webviewMobileMode">\n\t\t<b:react-async\n\t\t\tcomponent="VKUIOverlay"\n\t\t/>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/application-mail/application-mail.html")});define("feast-tpl!ui-block/application-mail/application-mail.html",["feast-tpl!app/feast-tpl!ui-block/application-mail/application-mail.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/tooltip/tooltip.html",["feast"],function(a){return a.smartParse('<div qa:id="tooltip" data-container-id="tooltip-container">\n\t<b:tooltip-overlay\n\t\tcontent="{attrs.content}"\n\t\thint="{attrs.hint}"\n\t\thidden="{attrs.hidden}"\n\t\tquick-switch="{attrs[\'quick-switch\']}"\n\t\ttarget="{attrs.target}"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/tooltip/tooltip.html")});define("feast-tpl!ui-block/tooltip/tooltip.html",["feast-tpl!app/feast-tpl!ui-block/tooltip/tooltip.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/tooltip-overlay/tooltip-overlay.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="hidden" test="attrs.hidden"/>\n\t<bem:mod name="break-word" test="attrs[\'break-word\']"/>\n\n\t<div bem:elem="content">\n\t\t{attrs.content}\n\t</div>\n\t<div fn:if="attrs.hint" bem:elem="hint">\n\t\t{attrs.hint}\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/tooltip-overlay/tooltip-overlay.html")});define("feast-tpl!ui-block/tooltip-overlay/tooltip-overlay.html",["feast-tpl!app/feast-tpl!ui-block/tooltip-overlay/tooltip-overlay.html"],function(a){return a});define("ui-block/tooltip-overlay/tooltip-overlay",["exports","default-values","feast","feast-extension/a11y","feast-tpl!./tooltip-overlay.html","service/smokescreen"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=h(b);var g=h(d);function h(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend({name:"tooltip-overlay",template:g.default,defaults:{"break-word":a.WORD_BREAK_IN_TOOLTIP},attrChanged:{hidden:function a(b,c){if(c&&!b){this.setCoordinates();if(!this.get("quick-switch")){this.el.style.animation="scaling 0.2s cubic-bezier(0.270, 0.010, 0.000, 1.000)";return}}if(b){this.el.style.animation="";this.el.style.left="0px";this.el.style.top="0px"}}},getTargetType:function a(){var b=this.get("target");var d="bottom";var f=(0,e.selector)("."+c.tooltipDirectionClassPrefix+"left");var g=(0,e.selector)("."+c.tooltipDirectionClassPrefix+"right");var h=(0,e.selector)("."+c.tooltipDirectionClassPrefix+"top");var i=(0,e.selector)("."+c.tooltipDirectionClassPrefix+"letter-bottom");if(b.closest(f)){d="left"}if(b.closest(g)){d="right"}if(b.closest(h)){d="top"}if(b.closest(i)){d="letter-bottom"}return d},setCoordinates:function a(){var b=void 0;var c=void 0;var d=this.get("target");var f=4;var g=8;var h=void 0;var i=void 0;var j=void 0;var k=void 0;var l=window.innerWidth;var m=window.innerHeight;var n=this.el.offsetWidth;var o=this.el.offsetHeight;var p=1;var q=(0,e.selector)(".js-letter-list-item");var r=d.getBoundingClientRect();var s=this.getTargetType();switch(s){case"letter-bottom":var t=d.closest(q);var u=t.getBoundingClientRect();i=r.right-d.offsetWidth/2-n/2>g;h=r.right-d.offsetWidth/2+n/2<l-g;j=u.bottom+o<m-g;if(h&&i){b=r.right-d.offsetWidth/2-n/2}else if(!i){b=g}else{b=l-n-g}if(j){c=u.bottom+p}else{c=u.top-o-p}break;case"letter-subject":t=d.closest(q);u=t.getBoundingClientRect();b=r.left;j=u.bottom+o<m-g;if(j){c=u.bottom+p}else{c=u.top-o-p}break;case"bottom":b=r.right-d.offsetWidth/2-n/2;c=r.bottom+f;i=b>g;h=b+n<l-g;j=c+o<m-g;if(!i){b=g}else if(!h){b=l-n-g}if(!j){c=r.top-o-f}break;case"top":b=r.right-d.offsetWidth/2-n/2;c=r.top-o-f;i=b>g;h=b+n<l-g;k=c-o>g;if(!i){b=g}else if(!h){b=l-n-g}if(!k){c=r.bottom+f}break;case"right":b=r.right+f;c=r.top+d.offsetHeight/2-o/2;break;case"left":b=r.left-n-f;c=r.top+d.offsetHeight/2-o/2;break}this.el.style.left=b+"px";this.el.style.top=c+"px"}})});define("ui-block/tooltip/tooltip",["exports","default-values","feast","feast-tpl!./tooltip.html","service/adv/locator","service/smokescreen","ui-block/tooltip-overlay/tooltip-overlay"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=j(b);var h=j(c);var i=j(f);function j(a){return a&&a.__esModule?a:{default:a}}exports.default=g.default.Block.extend({name:"tooltip",template:h.default,blocks:{"tooltip-overlay":i.default},defaults:{disabled:a.DISABLE_TOOLTIPS,hidden:true,content:"",hint:"",target:null,"quick-switch":false},target:null,lastTarget:null,isQuickSwitch:false,quickSwitchTimeout:20,delay:400,titleMaxLength:130,didMount:function a(){this.$on(document,"mouseover","onMouseOver");this.show=this.show.bind(this)},onMouseOver:function a(b){var c=b.target;while(c&&c!==document){var e=c.getAttribute("title")||c.getAttribute("data-title");if(!e){c=c.parentNode;continue}var f=c.classList;var g=false;for(var h=0;h<f.length;++h){if(d.locator.isWelter(f[h])){g=true;break}}if(!f.length||g){this.hideBrowserTooltip(c);c=c.parentNode;continue}if(this.target!==c){if(this.target){this.hide()}this.target=c;if(this.lastTarget){this.$off(this.lastTarget,"mouseleave","hide");this.$off(this.lastTarget,"mousedown","hide");this.$off(document,"keydown","hide");this.$off(this.lastTarget,"click","onClick");if(this.scrollable){this.$off(this.scrollable,"scroll","hide");this.scrollable=null}this.lastTarget=null}if(c.matches('[type="file"]')){return}this.hideBrowserTooltip();this.scrollable=this.getScrollable();this.$on(this.target,"mouseleave","hide");this.$on(this.target,"mousedown","hide");this.$on(document,"keydown","hide");this.$on(this.target,"click","onClick");if(this.scrollable){this.$on(this.scrollable,"scroll","hide")}this.set("quick-switch",this.isQuickSwitch);this.showTimeout=setTimeout(this.show,this.isQuickSwitch?0:this.delay)}break}},onClick:function a(b){var c=this;setTimeout(function(){if(document.body.contains(b.target)){c.hideBrowserTooltip(b.target)}},20)},getScrollable:function a(){var b=this.target;var c=(0,e.selector)(".scrollable");while(b!==document){if(b.matches(c)){return b}b=b.parentNode}},hideBrowserTooltip:function a(b){var c=this.target||b;while(c&&c!==document){if(c.hasAttribute("title")){var d=c.getAttribute("title");c.setAttribute("data-title",d);c.removeAttribute("title")}c=c.parentNode}},setBrowserTooltip:function a(){var b=this.target;while(b&&b!==document){if(b.hasAttribute("data-title")){var c=b.getAttribute("data-title");b.setAttribute("title",c);b.removeAttribute("data-title")}b=b.parentNode}},hide:function a(){var b=this;clearTimeout(this.showTimeout);this.set({content:"",hint:"",target:null,hidden:true});this.setBrowserTooltip();this.lastTarget=this.target;this.target=null;clearTimeout(this.switchTimeout);this.isQuickSwitch=true;this.switchTimeout=setTimeout(function(){b.isQuickSwitch=false},this.quickSwitchTimeout)},show:function a(){if(this.is("disabled")){return}var b=this.getTitle();var c=this.getShortcut();var d=this.getMode();if(b){switch(d){case"overflow":if(this.target.offsetWidth>=this.target.scrollWidth&&this.target.offsetHeight>=this.target.scrollHeight){return}break}this.set({hint:c,content:b,target:this.target});this.set("hidden",false)}},getTitle:function a(){if(!this.target){return""}return this.target.getAttribute("data-title")||this.target.getAttribute("title")||""},getShortcut:function a(){if(!this.target){return""}return this.target.getAttribute("data-title-shortcut")||""},getMode:function a(){if(!this.target){return"auto"}return this.target.getAttribute("data-title-mode")||"auto"},didUnmount:function a(){this.$off(document,"mouseover","onMouseOver");if(this.lastTarget){this.$off(this.lastTarget,"mouseleave","hide");this.$off(this.lastTarget,"mousedown","hide");this.$off(document,"keydown","hide");this.$off(this.lastTarget,"click","onClick");if(this.scrollable){this.$off(this.scrollable,"scroll","hide")}this.lastTarget=null}}})});define("service/title",["exports","ui-block/tooltip/tooltip"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}exports.default={setup:function a(){var c=new b.default({router:app});c.renderTo(document.body);this.setup=function(){}}}});define("feast-tpl!app/feast-tpl!ui-block/advert-column/advert-column.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="native-scroll" test="attrs[\'native-scroll\']"/>\n\t<bem:mod name="css-scroll" test="attrs[\'css-scroll\']"/>\n\t<bem:mod name="indented" test="attrs[\'indented\']"/>\n\t<bem:mod name="indented-new-letter-list" test="attrs[\'indented\'] && attrs[\'new-letter-list\']"/>\n\t<bem:mod name="ad-feedback" test="attrs[\'ad-feedback-target\']"/>\n\n\t<div bem:elem="noads-button-container">\n\t\t<b:noads-button\n\t\t\tfn:if="attrs[\'ads-off-target\']"\n\t\t/>\n\t</div>\n\t<b:ad-feedback\n\t\tfn:if="attrs[\'ad-feedback-target\']"\n\t\tqa:id="right-column-feedback"\n\t\tuse:mediator="layout-manager"\n\t\tindented="{attrs[\'indented\']}"\n\t/>\n\t<b:slot qa:id="right-column-adv" use:mediator="layout-manager advert-manager" />\n</div>\n',"app/feast-tpl!ui-block/advert-column/advert-column.html")});define("feast-tpl!ui-block/advert-column/advert-column.html",["feast-tpl!app/feast-tpl!ui-block/advert-column/advert-column.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/noads-button/noads-button.html",["feast"],function(a){return a.smartParse('<div\n\tqa:id="right-column-noads"\n\tpromo:id="right-column-noads"\n>\n\t<fn:var name="isDefaultTheme" value="{attrs[\'isDefaultTheme\']}"/>\n\t<div bem:elem="button">\n\t\t<b:react-async\n\t\t\tcomponent="NoadsButton"\n\t\t\ttext="{_this.getButtonContent()}"\n\t\t\tisDefaultTheme="{isDefaultTheme}"\n\t\t\tonClick="{_this.onActionClick}"\n\t\t/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/noads-button/noads-button.html")});define("feast-tpl!ui-block/noads-button/noads-button.html",["feast-tpl!app/feast-tpl!ui-block/noads-button/noads-button.html"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/get-oauth",["require","exports","default-values","service/radars/index"],function(require,exports,a,b){"use strict";var c;Object.defineProperty(exports,"__esModule",{value:true});exports.OAuthFeature=void 0;b=__importDefault(b);var d;(function(a){a["Calls"]="calls";a["CloudDnD"]="cloud-dnd";a["Default"]="default";a["Calendar"]="calendar";a["Todo"]="todo"})(d=exports.OAuthFeature||(exports.OAuthFeature={}));var e=(c={},c[d.Calls]=["calls.api"],c[d.CloudDnD]=["cloud.openapi.dnd"],c[d.Default]=[],c[d.Calendar]=["calendar.calendars.read","calendar.events.read"],c[d.Todo]=["todo.api"],c);function f(c){if(c===void 0){c=d.Default}return new Promise(function(b,d){new Promise(function(a,b){require(["@mail/oauth"],a,b)}).then(__importStar).then(function(f){f.init({clientId:a.OAUTH_CLIENT_ID,scopes:e[c]});f.setOAuthHost(a.OAUTH_HOST);f.auth(function(a){var c=a.status,e=a.access_token;if(c!==f.AUTH_CONNECTED){d(c)}b(e)})}).catch(function(a){d(a)})}).catch(function(a){(0,b.default)({type:"oauth-err_".concat(c),rlog:"octavius_error_oauth",rlog_message:a});return Promise.reject(a)})}exports.default=f});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/quota",["require","exports","@mail/xray"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.handleQuotaErr=void 0;a=__importDefault(a);var b=function(b,c){return b().then(function(a){return a}).catch(function(b){a.default.send("union_quota",{i:"error",rlog:"union_quota_err",rlog_message:{err:b,placement:c}})})};exports.handleQuotaErr=b});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __rest=this&&this.__rest||function(a,b){var c={};for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0)c[d]=a[d];if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++){if(b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e]))c[d[e]]=a[d[e]]}return c};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/request-api-oauth",["require","exports","helpers/get-oauth","request","service/radars/index","service/storage","uuid"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.requestApiOAuth=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);var f=function(a){return"Bearer ".concat(a)};var g=function(a){return a.status===401};var h="oauth-token";var i=false;function j(a,b){var c=(0,e.default)();a["X-Request-Id"]=c;if(b){a[b]=c}}function k(e,k,l){if(l===void 0){l={}}var m=l.authorizationFormatter,n=m===void 0?f:m,o=l.isAuthError,p=o===void 0?g:o,q=l.headers,r=q===void 0?{}:q,s=l.customRequestIdHeader,t=l.oauthFeature,u=l.canceller,v=__rest(l,["authorizationFormatter","isAuthError","headers","customRequestIdHeader","oauthFeature","canceller"]);var w=d.default.get(h);var x=i?Promise.resolve(w):(0,a.default)(t).then(function(a){d.default.set(h,a);i=true;return a});return x.then(function(a){var c=__assign(__assign({},r),{Authorization:n(a)});j(c,s);var d=(0,b.default)(e,k,__assign(__assign({},v),{headers:c,withoutRequestId:true}));u===null||u===void 0?void 0:u.set(d);return d}).catch(function(f){if(p(f)&&i){(0,c.default)({type:"oauth-request_retry",intervals:[[t]]});return(0,a.default)(t).then(function(a){d.default.set(h,a);var c=__assign(__assign({},r),{Authorization:n(a)});j(c,s);return(0,b.default)(e,k,__assign(__assign({},v),{headers:c,withoutRequestId:true}))})}var g=f.error,l=f.responseText,m=f.status;if(g==="parsererror"&&l===""&&m===200){return Promise.resolve(f.data)}return Promise.reject(f)})}exports.requestApiOAuth=k;exports.default=k});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/cloud",["require","exports","default-values","helpers/get-oauth","helpers/quota","helpers/request-api-oauth","service/radars/index"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EntityType=exports.PromiseStatus=exports.Errors=void 0;d=__importDefault(d);e=__importDefault(e);var f;(function(a){a["ResponseNotOK"]="response_not_ok";a["RequestError"]="request_err";a["ResponseNoAuth"]="response_no_auth";a["ResponseParentNotFound"]="response_parent_not_found";a["RequestAborted"]="request_aborted"})(f=exports.Errors||(exports.Errors={}));var g;(function(a){a["fulfilled"]="fulfilled";a["rejected"]="rejected"})(g=exports.PromiseStatus||(exports.PromiseStatus={}));var h;(function(a){a["UserInfo"]="user/info";a["Create"]="private/create";a["Share"]="private/share";a["MakeDirectory"]="private/mkdir";a["List"]="private/list";a["Move"]="private/move";a["AgreeLa"]="user/agree-la";a["Delete"]="private/delete";a["Quota"]="user/quota"})(h||(h={}));var i;(function(a){a["directory"]="d";a["file"]="f"})(i=exports.EntityType||(exports.EntityType={}));var j=null;var k=null;var l=function(){function g(){this.ABORT_STATUS_CODE=0;this.NO_AUTH_STATUS_CODE=403;this.PARENT_NOT_FOUND_CODE=404}g.prototype.getRequestParams=function(a){var c=this;if(a===void 0){a="GET"}var d=function(a){return a.status===c.NO_AUTH_STATUS_CODE};return{type:a,processData:false,customRequestIdHeader:"X-Req-ID",isAuthError:d,oauthFeature:b.OAuthFeature.CloudDnD}};g.prototype.getResponseInfo=function(a){var b=a||{},c=b.status,d=b.body,e=b.options,f=b.url;return{status:c,body:d,options:e,url:f}};g.prototype.getErrorInfo=function(a){var b=a||{},c=b.status,d=b.url,e=b.error,f=b.responseText,g=b.statusText,h=b.body;return{status:c,url:d,errorText:e,responseText:f,statusText:g,body:h}};g.prototype.isAgreedLA=function(){var b=this;if(j){return Promise.resolve(j)}var c="".concat(a.CLOUD_OPEN_API_URL).concat(h.UserInfo);var g=__assign({force:true},this.getRequestParams());return(0,d.default)(c,null,g).then(function(a){var b;b=(a===null||a===void 0?void 0:a.body)||{},j=b["agreed-la"],k=b.upload_url;return j}).catch(function(a){var c=a.status;var d=f.RequestError;if(typeof c==="number"){(0,e.default)(["cld-openapi-user-info-err",c]);var g=c===b.NO_AUTH_STATUS_CODE||c===b.PARENT_NOT_FOUND_CODE;d=g?f.ResponseNoAuth:f.ResponseNotOK}else{(0,e.default)("cld-openapi-user-info-err-nost")}return Promise.reject({type:d,err:b.getResponseInfo(a)})})};g.prototype.prepareFolder=function(b,c){if(c===void 0){c=a.CLOUD_LOAD_DIRECTORY}if(b.length<=1){return Promise.resolve(c)}var d=(new Date).toLocaleString().replace(/:/g,"-");var e="".concat(c,"/").concat(d);return this.createFolder(e)};g.prototype.withCreateFolder=function(a,b){var c=this;return this.getFoldersTree().then(function(d){var e=d===null||d===void 0?void 0:d.map(function(a){var b=a.path;return b});var f=e===null||e===void 0?void 0:e.find(function(b){return b===a});if(!f){return c.createFolder(a).then(b)}return b(a)})};g.prototype.getErrorByStatus=function(a){var b=this,c=b.NO_AUTH_STATUS_CODE,d=b.PARENT_NOT_FOUND_CODE,e=b.ABORT_STATUS_CODE;switch(a){case e:return f.RequestAborted;case c:return f.ResponseNoAuth;case d:return f.ResponseParentNotFound;default:return f.ResponseNotOK}};g.prototype.createFiles=function(b,c,d){var e=this;if(c===void 0){c=a.CLOUD_LOAD_DIRECTORY}if(d===void 0){d={}}var g=__spreadArray([],b,true).sort(function(a,b){return a.size-b.size}),h=g[0],i=g.slice(1);var j=function(a){return e.prepareFolder(b,a).then(function(a){return e.createFile(h,a,d).then(function(b){var c=i.map(function(b){return e.createFile(b,a)});return Promise.allSettled(__spreadArray([Promise.resolve(b)],c,true))}).catch(function(b){var c=b.type;if([f.ResponseParentNotFound,f.ResponseNoAuth].includes(c)){return Promise.reject(b)}var d=i.map(function(b){return e.createFile(b,a)});return Promise.allSettled(__spreadArray([Promise.reject(b)],d,true))})})};return this.withCreateFolder(c,j).catch(function(a){var b=i.map(function(){return Promise.reject(__assign(__assign({},a),{type:"".concat(a.type,"_1st")}))});return Promise.allSettled(__spreadArray([Promise.reject(a)],b,true))})};g.prototype.createFile=function(a,b,c){var g=this;if(b===void 0){b=""}if(c===void 0){c={}}var h=__assign(__assign({force:true},this.getRequestParams("PUT")),c);if(!k){return Promise.reject({type:f.RequestError,err:"no upload_url"})}var i="".concat(k).concat(b,"/").concat(a.name.normalize("NFC"));return(0,d.default)(i,a,h).then(function(a){return a===null||a===void 0?void 0:a.body}).catch(function(a){var b=a.status;var c=f.RequestError;if(typeof b==="number"){(0,e.default)(["cld-openapi-create-file-err",b]);c=g.getErrorByStatus(b)}else{(0,e.default)("cld-openapi-create-file-err-nost")}return Promise.reject({type:c,err:g.getResponseInfo(a)})})};g.prototype.createWebLink=function(b){var c=this;var g=__assign({force:true},this.getRequestParams("POST"));var i="".concat(a.CLOUD_OPEN_API_URL).concat(h.Share).concat(b);return(0,d.default)(i,null,g).then(function(a){var b;return(b=a===null||a===void 0?void 0:a.body)===null||b===void 0?void 0:b.url}).catch(function(a){var b=a.status;var d=f.RequestError;if(typeof b==="number"){(0,e.default)(["cld-openapi-create-weblink-err",b]);d=b===c.NO_AUTH_STATUS_CODE?f.ResponseNoAuth:f.ResponseNotOK}else{(0,e.default)("cld-openapi-create-weblink-err-nost")}return Promise.reject({type:d,err:c.getResponseInfo(a)})})};g.prototype.createFolder=function(b){var c=this;var g=__assign({force:true},this.getRequestParams("POST"));var i="".concat(a.CLOUD_OPEN_API_URL).concat(h.MakeDirectory).concat(b);return(0,d.default)(i,null,g).then(function(a){var b;return(b=a===null||a===void 0?void 0:a.body)===null||b===void 0?void 0:b.path}).catch(function(a){var b=a.status;var d=f.RequestError;if(typeof b==="number"){(0,e.default)(["cld-openapi-mkdir-err",b]);d=c.getErrorByStatus(b)}else{(0,e.default)("cld-openapi-mkdir-err-nost")}return Promise.reject({type:d,err:c.getResponseInfo(a)})})};g.prototype.getFolderContent=function(b){var c=this;if(b===void 0){b="/"}var g="".concat(a.CLOUD_OPEN_API_URL).concat(h.List).concat(b);var i=__assign({force:true},this.getRequestParams());return(0,d.default)(g,null,i).then(function(a){return a===null||a===void 0?void 0:a.body}).catch(function(a){var b=a.status;var d=f.RequestError;if(b){(0,e.default)(["cld-openapi-list-err",b]);d=b===c.NO_AUTH_STATUS_CODE?f.ResponseNoAuth:f.ResponseNotOK}return Promise.reject({type:d,err:a})})};g.prototype.getFoldersTree=function(){return this.getFolderContent().then(function(a){var b,c;return(c=(b=a.list)===null||b===void 0?void 0:b.filter(function(a){return a.kind==="folder"}))===null||c===void 0?void 0:c.map(function(a){return a})})};g.prototype.move=function(b,c,g){var i=this;if(g===void 0){g=false}if(b===c){return Promise.resolve(null)}var j="".concat(a.CLOUD_OPEN_API_URL).concat(h.Move);var k=__assign({force:true},this.getRequestParams("POST"));var l={src_path:b,dst_path:c,overwrite:g};return(0,d.default)(j,JSON.stringify(l),k).then(function(a){return a===null||a===void 0?void 0:a.body}).catch(function(a){var b=a.status;var c=f.RequestError;if(b){(0,e.default)(["cld-openapi-move-err",b]);c=b===i.NO_AUTH_STATUS_CODE?f.ResponseNoAuth:f.ResponseNotOK}return Promise.reject({type:c,err:a})})};g.prototype.delete=function(b){var c=this;var g="".concat(a.CLOUD_OPEN_API_URL).concat(h.Delete).concat(b);var i=__assign({force:true},this.getRequestParams("POST"));return(0,d.default)(g,null,i).then(function(a){return a===null||a===void 0?void 0:a.body}).catch(function(a){var b=a.status;var d=f.RequestError;if(b){(0,e.default)(["cld-openapi-delete-err",b]);d=b===c.NO_AUTH_STATUS_CODE?f.ResponseNoAuth:f.ResponseNotOK}return Promise.reject({type:d,err:a})})};g.prototype.agreeLa=function(){var b="".concat(a.CLOUD_OPEN_API_URL).concat(h.AgreeLa);var c=this.getRequestParams("POST");return(0,d.default)(b,null,c).catch(function(a){return Promise.reject({err:a})})};g.prototype.getUserQuota=function(){var b=this;var c="".concat(a.CLOUD_OPEN_API_URL).concat(h.Quota);var e=this.getRequestParams();return(0,d.default)(c,null,e).then(function(a){return a===null||a===void 0?void 0:a.body}).catch(function(a){return Promise.reject(b.getErrorInfo(a))})};g.prototype.getQuotaDWH=function(a){var b=this.getUserQuota.bind(this);return(0,c.handleQuotaErr)(b,a).then(function(b){if(!b){return}var c=b.quota,d=b.used.total;return{client_id:"UA-43037165-12",size_quota:d,free_quota:c-d,placement:a}})};return g}();exports.default=new l});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/noads-button/noads-button",["require","exports","@mail/xray","default-values","feast","feast-tpl!./noads-button.html","service/ads-off","service/cloud","ui-block/react-async/react-async"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);exports.default=c.default.Block.extend({name:"noads-button",template:d.default,immutable:true,blocks:{"react-async":g.default},events:{"action:click":"onActionClick"},dwh:null,constructor:function(){c.default.Block.apply(this,arguments);this.onActionClick=this.onActionClick.bind(this)},didMount:function(){var c=this;require(["mediator/layout-manager","mediator/themes-manager"],function(a,b){a.default.register(c);b.default.register(c)});this.getDwhPromise().then(function(b){b&&a.default.send("union_quota",{i:"placement_view",dwh:b})});a.default.send("noads_button_show_".concat(b.ADV_EXP_ID))},onActionClick:function(){a.default.send("noads_button_click_".concat(b.ADV_EXP_ID));this.getDwhPromise().then(function(b){b&&a.default.send("union_quota",{i:"placement_click",dwh:b})});(0,e.onComplete)(b.QUOTA_AD_URL)},getButtonContent:function(){var a=this.getTextFromExpId(),b=a.short,c=a.long;return this.get("isSmallAdvColumnRight")?b:c},getTextFromExpId:function(){if(b.ADV_OFF_MONTH_GROUP.includes(b.ADV_EXP_ID)){return{short:i18n("Месяц без рекламы"),long:i18n("Месяц без рекламы бесплатно")}}return{short:i18n("Можно без рекламы?"),long:i18n("А можно без рекламы?")}},getDwhPromise:function(){if(!this.dwh){this.dwh=f.default.getQuotaDWH("noads_btn")}return this.dwh}})});define("feast-tpl!app/feast-tpl!ui-block/slot/slot.html",["feast"],function(a){return a.smartParse('<div\n\tstyle="width: {attrs[\'right-column\']}px"\n>\n\t<div ref="el"/>\n</div>\n',"app/feast-tpl!ui-block/slot/slot.html")});define("feast-tpl!ui-block/slot/slot.html",["feast-tpl!app/feast-tpl!ui-block/slot/slot.html"],function(a){return a});define("ui-block/slot/slot",["exports","@mail/adman","feast","feast-tpl!./slot.html","service/adv/index","service/smokescreen"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=j(a);var g=j(b);var h=j(c);var i=j(d);function j(a){return a&&a.__esModule?a:{default:a}}exports.default=g.default.Block.extend((0,e.withWelter)({name:"slot",template:h.default,immutable:true,blocks:{},attrChanged:{"right-column":function a(b,c){var d=this;this.refs.el.style.width=b+"px";if(b===c){return}var e=function a(){var b=d.isMounted();if(b){d.refs.el.style.visibility="visible"}return b};var f=function a(b,c){if(e()){i.default.onPlacementRender(b,c)}};var g=i.default.toggleActiveSidebarPlacement(b);if(g){this.refs.el.style.visibility="hidden";g.attachToContainer(this.refs.el);g.render(true,false).then(f.bind(this,g),e)}}},didMount:function a(){var b=this;i.default.toggleActiveSidebarPlacement(this.get("right-column"));d.sidebarPlacementsList.forEach(function(a){if(i.default.getActiveSidebarPlacement()!==a){return}var c=f.default.placement(a);if(!c){return}c.attachToContainer(b.refs.el);c.wakeUp();c.render(true,false).then(i.default.onPlacementRender.bind(i.default,c),function(){return null})})},didUnmount:function a(){if(f.default.placement("sidebar")){f.default.placement("sidebar").destroy()}if(f.default.placement("sidebar-small")){f.default.placement("sidebar-small").destroy()}}}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/advert-column/advert-column",["require","exports","default-values","feast","feast-tpl!./advert-column.html","service/ads-off","service/adv/index","ui-block/ad-feedback/ad-feedback","ui-block/noads-button/noads-button","ui-block/slot/slot"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);exports.default=b.default.Block.extend({name:"advert-column",defaults:{"ads-off-target":a.NOADS_BUTTON_SHOW_FORCE,"ad-feedback-target":!(0,d.isAdsOffTargetGroup)()&&e.default.showAdFeedback(),"new-letter-list":a.NEW_LETTER_LIST,indented:a.ADVERT_SIDEBAR_ROUNDED},template:c.default,blocks:{slot:h.default,"noads-button":g.default,"ad-feedback":f.default},didMount:function(){this.broadcast("adcolumn:mount")},didUnmount:function(){this.broadcast("adcolumn:unmount")}})});define("feast-tpl!app/feast-tpl!ui-block/contextmenu/contextmenu.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="expanded" test="attrs.expanded"/>\n\n\t<div\n\t\tbem:elem="container"\n\t\tstyle="{_this.setStyle()}"\n\t\tremit:click.prevent="menu-toggle"\n\t>\n\t\t<div bem:elem="block" ref="block"/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/contextmenu/contextmenu.html")});define("feast-tpl!ui-block/contextmenu/contextmenu.html",["feast-tpl!app/feast-tpl!ui-block/contextmenu/contextmenu.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/contextmenu-correspondents/contextmenu-correspondents.html",["feast"],function(a){return a.smartParse('<div qa:id="contextmenu-correspondents">\n\t<fn:var name="contacts" value="{attrs.model.contacts || []}"/>\n\t<fn:var name="isSingle" value="{contacts.length === 1}"/>\n\n\t<b:list>\n\t\t<b:list-item\n\t\t\tref="js-copy"\n\t\t\tqa:id="copy"\n\t\t\tradar-id="copy"\n\t\t>\n\t\t\t<span bem:elem="ico" bem:mod="copy">\n\t\t\t\t<b:ico name="actions:copy" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{isSingle ? i18n(\'Копировать адрес\') : i18n(\'Копировать адреса\')}</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\tqa:id="compose"\n\t\t\tremit:click="compose:to"\n\t\t\tevent:details="contacts"\n\t\t\tradar-id="compose"\n\t\t>\n\t\t\t<span bem:elem="ico" bem:mod="compose">\n\t\t\t\t<b:ico name="compose" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Написать письмо\')}</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\tqa:id="call"\n\t\t\tfn:if="_this.canCallTo(contacts)"\n\t\t\tremit:click="call:to"\n\t\t\tevent:details="contacts"\n\t\t\tradar-id="call"\n\t\t>\n\t\t\t<span bem:elem="ico" bem:mod="call">\n\t\t\t\t<b:ico name="categories:camera" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Позвонить\')}</span>\n\t\t</b:list-item>\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/contextmenu-correspondents/contextmenu-correspondents.html")});define("feast-tpl!ui-block/contextmenu-correspondents/contextmenu-correspondents.html",["feast-tpl!app/feast-tpl!ui-block/contextmenu-correspondents/contextmenu-correspondents.html"],function(a){return a});define("ui-block/contextmenu-correspondents/contextmenu-correspondents",["exports","default-values","feast","feast-tpl!./contextmenu-correspondents.html","helpers/opener","service/calls","service/compose","ui-block/list/list","ui-block/list-item/list-item","lazy.modules"],function(exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var j=q(b);var k=q(c);var l=q(d);var m=q(e);var n=q(f);var o=q(g);var p=q(h);function q(a){return a&&a.__esModule?a:{default:a}}exports.default=j.default.Block.extend({name:"contextmenu-correspondents",template:k.default,blocks:{list:o.default,"list-item":p.default},events:{"compose:to":"onComposeCreateTo","call:to":"onCallTo"},defaults:{type:"correspondents",model:{clipboardText:"",contacts:[],type:"correspondents"}},didMount:function a(){var b=this;var c=this.refs["js-copy"];var d=this.get("model");c.setAttribute("data-clipboard-text",d.clipboardText);(0,i.lazyClipboard)().then((0,i.uniqCallback)(this,function(a){b.clipboard=b.isMounted()?new a(c):null}))},destroyClipboard:function a(){this.clipboard&&this.clipboard.destroy();this.clipboard=null},didUnmount:function a(){this.destroyClipboard()},onBeforeHide:function a(){this.destroyClipboard()},onComposeCreateTo:function a(b){var c=b.details;var d="default"in n.default&&"open"in n.default.default?n.default.default:n.default;d.open({correspondents:{to:c}})},canCallTo:function b(c){return a.CALLS_P2P_OUTGOING&&m.default.getCallsAPIClient().canCallTo(c.map(function(a){return a.email})).some(function(a){return a.canCall})},onCallTo:function a(b){var c=b.details;m.default.getCallsAPIClient().callTo(c.map(function(a){return a.email})).then(function(a){if(a.redirectUrl){(0,l.default)(a.redirectUrl)}})}})});define("feast-tpl!app/feast-tpl!ui-block/contextmenu-folder/contextmenu-folder.html",["feast"],function(a){return a.smartParse('<div qa:id="contextmenu">\n\t<fn:var name="folder" value="{attrs.model}"/>\n\t<fn:var name="metathreadToMyselfEnabled" value="{attrs[\'to-myself-enabled\']}"/>\n\t<fn:var name="icomap" value="{_this.folder2icoMap}"/>\n\n\t<b:list>\n\t\t<fn:if test="attrs[\'new-tab-available\']">\n\t\t\t<b:list-item\n\t\t\t\tremit:click="newtab"\n\t\t\t\tqa-id="newtab"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t<b:ico name="actions:tab_add" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Открыть в новой вкладке\')}</span>\n\t\t\t</b:list-item>\n\n\t\t\t<div bem:elem="hr"/>\n\t\t</fn:if>\n\n\t\t<fn:if test="folder.get(\'security\') && !folder.get(\'open\')">\n\t\t\t<b:list-item\n\t\t\t\tqa-id="unlock"\n\t\t\t\tradar-id="unlock"\n\t\t\t\tremit:click="unlock"\n\t\t\t\tevent:details="{model:folder}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="lock-off">\n\t\t\t\t\t<b:ico\n\t\t\t\t\t\tname="{icomap[\'lock-off_fill\']}"\n\t\t\t\t\t\tmod="{icomap[\'lock-off_fill\']}"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Разблокировать\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="folder.get(\'security\') && folder.get(\'open\')">\n\t\t\t<b:list-item\n\t\t\t\tremit:click="lock"\n\t\t\t\tevent:details="{model:folder}"\n\t\t\t\tqa-id="lock"\n\t\t\t\tradar-id="lock"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="lock-on">\n\t\t\t\t\t<b:ico\n\t\t\t\t\t\tname="{icomap[\'lock-on_fill\']}"\n\t\t\t\t\t\tmod="{icomap[\'lock-on_fill\']}"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Заблокировать\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<b:list-item\n\t\t\tremit:click="read"\n\t\t\tevent:details="{model:folder}"\n\t\t\tqa-id="read"\n\t\t\tradar-id="read"\n\t\t>\n\t\t\t<bem:mod name="disabled" test="folder.get(\'messages_unread\') === 0 || !folder.is(\'open\')"/>\n\n\t\t\t<span bem:elem="ico" bem:mod="read">\n\t\t\t\t<b:ico name="status:read" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Пометить все письма прочитанными\')}</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\tremit:click="clear"\n\t\t\tevent:details="{model:folder}"\n\t\t\tqa-id="clear"\n\t\t\tradar-id="clear"\n\t\t>\n\t\t\t<bem:mod name="disabled" test="!_this.isEnableClear()"/>\n\n\t\t\t<span bem:elem="ico" bem:mod="clear">\n\t\t\t\t<b:ico name="navigation:folder_hidden" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{_this.getRemoveText()}</span>\n\t\t</b:list-item>\n\n\t\t<div bem:elem="hr"/>\n\n\t\t<b:list-item\n\t\t\tremit:click="edit"\n\t\t\tevent:details="{model:folder}"\n\t\t\tradar-id="edit"\n\t\t\tqa-id="edit"\n\t\t>\n\t\t\t\x3c!-- выключаем редактирование на некоторых папках --\x3e\n\t\t\t<bem:mod name="disabled" test="_this.isDisableEdit()"/>\n\n\t\t\t<span bem:elem="ico" bem:mod="edit">\n\t\t\t\t<b:ico name="actions:edit" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Редактировать папку\')}</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\tremit:click="remove"\n\t\t\tevent:details="{model:folder}"\n\t\t\tradar-id="remove"\n\t\t\tqa-id="delete"\n\t\t>\n\t\t\t<bem:mod name="disabled" test="!_this.isEnableRemove()"/>\n\n\t\t\t<span bem:elem="ico" bem:mod="delete">\n\t\t\t\t<b:ico name="delete" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Удалить папку\')}</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\tremit:click="add"\n\t\t\tevent:details="{model: _this.canAddSubfolder() ? folder : _this.getDisplayParentFolder()}"\n\t\t\tqa-id="create"\n\t\t>\n\t\t\t\x3c!-- выключаем создание вложенной папки на некоторых папках --\x3e\n\t\t\t<bem:mod name="disabled" test="_this.isDisableCreate()"/>\n\n\t\t\t<span bem:elem="ico" bem:mod="newfolder">\n\t\t\t\t<b:ico name="actions:add_big" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{_this.getCreateText()}</span>\n\t\t</b:list-item>\n\n\t\t<fn:if test="attrs[\'folders-share-enabled\'] && !attrs.mobile">\n\t\t\t<div bem:elem="hr"/>\n\t\t\t<fn:if test="_this.showDenySharedFolder()">\n\t\t\t\t<b:list-item\n\t\t\t\t\t\tqa-id="deny"\n\t\t\t\t\t\tradar-id="deny"\n\t\t\t\t\t\tremit:click="sharefolders:denysharedfolder"\n\t\t\t\t\t\tevent:details="{model:folder}"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="ico" bem:mod="deny-share">\n\t\t\t\t\t\t<b:ico name="status:block" size="s"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Отказаться от папки\')}</span>\n\t\t\t\t</b:list-item>\n\t\t\t</fn:if>\n\n\t\t\t<b:list-item\n\t\t\t\tqa-id="share"\n\t\t\t\tradar-id="share"\n\t\t\t\tremit:click="sharefolders:opensharefolders"\n\t\t\t\tevent:details="{model:folder}"\n\t\t\t>\n\t\t\t\t\x3c!-- некоторыми папками нельзя поделиться --\x3e\n\t\t\t\t<bem:mod name="disabled" test="_this.isDisableShare()"/>\n\n\t\t\t\t<span bem:elem="ico" bem:mod="share">\n\t\t\t\t\t<b:ico name="navigation:users" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Настроить доступ к папкам\')}</span>\n\t\t\t</b:list-item>\n\n\t\t\t<b:list-item\n\t\t\t\tqa-id="shareOpportunities"\n\t\t\t\tradar-id="shareOpportunities"\n\t\t\t\tremit:click="shareopportunities:openshareopportunities"\n\t\t\t>\n\t\t\t\t\x3c!-- некоторыми папками нельзя поделиться --\x3e\n\t\t\t\t<bem:mod name="disabled" test="_this.isDisableShareOpportunities()"/>\n\n\t\t\t\t<span bem:elem="ico" bem:mod="share">\n\t\t\t\t\t<b:ico name="categories:mailings" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Предоставить возможности\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t\x3c!-- пункт контекстного меню для метатреда "письма себе" --\x3e\n\t\t<fn:if test="folder.isToMyself()">\n\t\t\t<div bem:elem="hr"/>\n\n\t\t\t<b:list-item\n\t\t\t\tqa-id="tomyself-disable"\n\t\t\t\tradar-id="tomyself-disable"\n\t\t\t\tremit:click="disable:tomyself"\n\t\t\t\tevent:details="{model:folder}"\n\t\t\t>\n\t\t\t\t\x3c!-- дизейблим этот пункт, если метатред уже отключен --\x3e\n\t\t\t\t\x3c!-- (такое возможно, когда мы паролим папку "Письма себе" и отключаем метатред) --\x3e\n\t\t\t\t<bem:mod name="disabled" test="!metathreadToMyselfEnabled"/>\n\n\t\t\t\t<span bem:elem="ico" bem:mod="share">\n\t\t\t\t\t<b:ico name="categories:self_mail" size="s" />\n\t\t\t\t</span>\n\n\t\t\t\t<span bem:elem="text">{i18n(\'Отключить группировку писем себе\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/contextmenu-folder/contextmenu-folder.html")});define("feast-tpl!ui-block/contextmenu-folder/contextmenu-folder.html",["feast-tpl!app/feast-tpl!ui-block/contextmenu-folder/contextmenu-folder.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/contextmenu-folder/contextmenu-folder",["require","exports","@mail/xray","default-values","feast","feast-tpl!./contextmenu-folder.html","helpers/folder","helpers/folder-to-ico-map","helpers/opener","mail/Folder","ui-block/list/list","ui-block/list-item/list-item"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);exports.default=c.default.Block.extend({name:"contextmenu-folder",template:d.default,blocks:{list:i.default,"list-item":j.default},events:{newtab:"onNewTab"},folder2icoMap:f.default,defaults:{type:"folder",model:null,"folders-share-enabled":b.FOLDERS_SHARE_ENABLED,"new-tab-available":!b.USE_SINGLE_TAB},didMount:function(){var a=this;require(["mediator/share-folders-manager/share-folders-manager","mediator/layout-manager","mediator/folders-actions"],function(){var b=[];for(var c=0;c<arguments.length;c++){b[c]=arguments[c]}b.forEach(function(b){var c=b.default;c.register(a)})})},isDisableEdit:function(){var a=this.get("model");return!a.isEditable()},showDenySharedFolder:function(){var a=this.get("model");return a.isShareTake()&&!(0,e.isSharedMailbox)(a)},isDisableShare:function(){var a=this.get("model");return!a.isSharable()},isDisableShareOpportunities:function(){var a=this.get("model");return a.isShareTake()},canAddSubfolder:function(){var a=this.get("model");return a.canAddSubfolder()},isDisableCreate:function(){var a=this.get("model");if(a.isShareTake()){return!this.canAddSubfolder()}return false},getRemoveText:function(){if(b.CHANGE_TEXT_REMOVE_BUTTON_SIDEBAR){return i18n("Удалить все письма")}return i18n("Очистить содержимое")},getCreateText:function(){var a=this.get("model");var b=i18n("Добавить вложенную папку");if(a.isShareTake()){return b}return this.canAddSubfolder()?b:i18n("Добавить папку")},getDisplayParentFolder:function(){var a=this.get("model");var b=function(a){return h.default.get(a.get("parent"))};var c=b(a);while(c&&c.getChildLevel()>=h.default.MAX_CHILD_LEVEL){c=b(c)}return c||null},onNewTab:function(b){var c;b.preventDefault();var d=this.get("router");var e=this.get("model");var f=d.getUrl("#letters",{folder:e.get("id")});(0,g.default)(f);a.default.send("click_new_page",{dwh:{object:"folder",screen:(c=d===null||d===void 0?void 0:d.route)===null||c===void 0?void 0:c.id}})},isEnableClear:function(){var a=this.get("model");return a.isClearable()&&!(0,e.isDeleteFromFolderDisabled)(a)},isEnableRemove:function(){var a=this.get("model");return a.isRemovable(true)}})});define("feast-tpl!app/feast-tpl!ui-block/contextmenu-message/contextmenu-message.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="message" value="{attrs.model}"/>\n\t<fn:var name="folder" value="{message && message.getFolder()}"/>\n\t<fn:var name="isMetaThread" value="{message && message.get(\'flags.metathread\')}" />\n\n\t<b:list>\n\t\t\x3c!-- Условие: "Открыть в новой вкладки" ИЛИ "Выделить все письма" --\x3e\n\t\t<fn:if test="_this.isNewTabAvailable() || (!isMetaThread && _this.hasSelectButton())">\n\t\t\t\x3c!-- Открыть в новой вкладке --\x3e\n\t\t\t<fn:if test="_this.isNewTabAvailable()">\n\t\t\t\t<b:list-item\n\t\t\t\t\tqa:id="newtab"\n\t\t\t\t\tremit:click="newtab"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t<b:ico name="actions:tab_add" size="s"/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Открыть в новой вкладке\')}</span>\n\t\t\t\t</b:list-item>\n\t\t\t</fn:if>\n\n\t\t\t\x3c!-- Выделить все письма --\x3e\n\t\t\t<fn:if test="!isMetaThread && _this.hasSelectButton()">\n\t\t\t\t<fn:if test="!attrs.deselectAll">\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\tqa:id="select:all"\n\t\t\t\t\t\tremit:click="select:all"\n\t\t\t\t\t\tradar-id="select-all"\n\t\t\t\t\t>\n\n\t\t\t\t\t\t<span bem:elem="ico" bem:mod="select-all">\n\t\t\t\t\t\t\t<b:ico name="select-all" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t\t\t{i18n(\'Выделить все письма\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</b:list-item>\n\t\t\t\t</fn:if>\n\n\t\t\t\t<fn:if test="attrs.deselectAll">\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\tqa:id="select:drop"\n\t\t\t\t\t\tremit:click="select:drop"\n\t\t\t\t\t\tradar-id="deselect"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico" bem:mod="select-all">\n\t\t\t\t\t\t\t<b:ico name="select-all" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t\t\t{i18n(\'Снять выделение\')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</b:list-item>\n\t\t\t\t</fn:if>\n\t\t\t</fn:if>\n\n\t\t\t<div bem:elem="hr" />\n\t\t</fn:if>\n\n\t\t<fn:if test="_this.isRemoveVisible()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="remove"\n\t\t\t\tremit:click="remove"\n\t\t\t\tevent:details="{model: message, parentThread: _this.getParentThread()}"\n\t\t\t\tradar-id="remove"\n\t\t\t\tdisabled="{!_this.isEnableRemove()}"\n\t\t\t>\n\n\t\t\t\t<span bem:elem="ico" bem:mod="delete">\n\t\t\t\t\t<b:ico name="delete" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{folder && folder.isTrashLike() ? i18n(\'Удалить навсегда\') : i18n(\'Удалить\')}\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<b:list-item\n\t\t\tqa:id="archive"\n\t\t\tremit:click="archive"\n\t\t\tevent:details="{model: message, parentThread: _this.getParentThread()}"\n\t\t\tradar-id="archive"\n\n\t\t\tfn:if="!folder.isArchive() && !attrs[\'archive-disabled\']"\n\t\t\tdisabled="{!_this.isEnableMoveToArchive()}"\n\t\t>\n\t\t\t<span bem:elem="ico" bem:mod="archive">\n\t\t\t\t<b:ico name="archive" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'В архив\')}</span>\n\t\t</b:list-item>\n\n\t\t<fn:if test="_this.shouldDisplaySpam()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="spam"\n\t\t\t\tremit:click="spam"\n\t\t\t\tevent:details="{model: message, parentThread: _this.getParentThread()}"\n\t\t\t\tradar-id="spam"\n\t\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="spam-on">\n\t\t\t\t\t<b:ico name="spam-on" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Спам\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="folder.isSpam() && !attrs.deselectAll && !folder.isShareTake()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="unspam"\n\t\t\t\tremit:click="unspam"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="unspam"\n\t\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="spam-off">\n\t\t\t\t\t<b:ico name="spam-off" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Не спам\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<b:list-item\n\t\t\tqa:id="move"\n\t\t\tid="move-to"\n\t\t\tremit:click.stop.prevent="click:move"\n\t\t\tradar-id="move"\n\t\t\tnested\n\t\t\tdisabled="{!_this.isEnableMove()}"\n\t\t>\n\t\t\t<span bem:elem="ico">\n\t\t\t\t<b:ico name="folder-move" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Переместить в папку\')}</span>\n\t\t\t<span bem:elem="nested">\n\t\t\t\t<b:ico name="navigation:drop_next" size="s"/>\n\t\t\t</span>\n\t\t</b:list-item>\n\n\t\t<div bem:elem="hr"/>\n\n\t\t<fn:if test="!message.is(\'flags.unread\')">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="mark:unread"\n\t\t\t\tremit:click="mark:unreaded"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="unread"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="unread">\n\t\t\t\t\t<b:ico name="status:unread" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Пометить непрочитанным\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="message.is(\'flags.unread\')">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="mark:read"\n\t\t\t\tremit:click="mark:readed"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="read"\n\n\t\t\t\tdata-shortcut="q"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="read">\n\t\t\t\t\t<b:ico name="status_read" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Пометить прочитанным\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="!message.is(\'flags.flagged\')">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="mark:flagged"\n\t\t\t\tremit:click="mark:flagged"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="flag"\n\t\t\t\tdisabled="{!_this.isEnableMark()}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="flag">\n\t\t\t\t\t<b:ico name="actions:favorite_on" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Пометить флажком\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="message.is(\'flags.flagged\') && _this.isEnableMark()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="mark:unflagged"\n\t\t\t\tremit:click="mark:unflagged"\n\t\t\t\tevent:details="{model: message}"\n\t\t\t\tradar-id="unflag"\n\t\t\t\tdisabled="{!_this.isEnableMark()}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="unflag">\n\t\t\t\t\t<b:ico name="actions:favorite_off" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Снять флажок\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="!attrs.deselectAll && _this.isShowCallsButton()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="calls:invite"\n\n\t\t\t\tremit:click="calls:invite"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="calls-invite"\n\t\t\t\tdisabled="{!_this.isEnableCall()}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t<b:ico name="categories:camera" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Предложить звонок\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="!attrs.deselectAll && _this.isShowCallendarButton()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="create:calendar-event"\n\t\t\t\tremit:click="calendar:create"\n\t\t\t\tevent:details="{model:message, createContent:\'web_email_letter_context_menu\'}"\n\t\t\t\tradar-id="calendar-create"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t<b:ico name="calendar-month" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Создать событие\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="_this.shouldDisplayFilter()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="create:filter"\n\t\t\t\tremit:click="settingsfilters:create"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="filter-create"\n\n\t\t\t\tdisabled="{!_this.isEnableFilterCreate()}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="filter">\n\t\t\t\t\t<b:ico name="actions:filter" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Создать фильтр\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<div bem:elem="hr"/>\n\n\t\t<fn:if test="_this.shouldDisplaySearch()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="search:from"\n\t\t\t\tremit:click="search:from"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="search"\n\t\t\t>\n\t\t\t\t<bem:mod name="disabled" test="attrs.isSearchDisabled"/>\n\n\t\t\t\t<span bem:elem="ico" bem:mod="delete">\n\t\t\t\t\t<b:ico name="search" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Найти все письма\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/contextmenu-message/contextmenu-message.html")});define("feast-tpl!ui-block/contextmenu-message/contextmenu-message.html",["feast-tpl!app/feast-tpl!ui-block/contextmenu-message/contextmenu-message.html"],function(a){return a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/contextmenu/contextmenu-abstract",["require","exports","@mail/smokescreen","helpers/folder","mail/Folder","service/smokescreen"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.withWelterContextMenu=exports.isEnableFilterCreate=exports.isEnableMove=exports.isRemoveVisible=exports.isEnableRemove=exports.isEnableMoveToArchive=exports.isEnableMoveToSpam=exports.isEnableMark=exports.checkFolderGrant=exports.isContainedInMetaThread=exports.hasSelectButton=void 0;a=__importDefault(a);c=__importDefault(c);function e(){var a=this.get("selectable");return a&&!this.isContainedInMetaThread()}exports.hasSelectButton=e;function f(){var a=this.get("router");var b=a&&a.model&&a.model.folder;var c=this.get("model");var d=c&&c.getFolder();return d!==b}exports.isContainedInMetaThread=f;function g(a){var b=this.get("model");return b.checkGrant(a)}exports.checkFolderGrant=g;function h(){return this.checkFolderGrant(c.default.SHARE_GRANTS.mark_as_important)}exports.isEnableMark=h;function i(){return this.checkFolderGrant(c.default.SHARE_GRANTS.move_to_spam)}exports.isEnableMoveToSpam=i;function j(){return this.checkFolderGrant(c.default.SHARE_GRANTS.move_to_archive)}exports.isEnableMoveToArchive=j;function k(){return this.checkFolderGrant(c.default.SHARE_GRANTS.remove)}exports.isEnableRemove=k;function l(){return!(0,b.isDeleteFromFolderDisabled)(this.get("model").getFolder())}exports.isRemoveVisible=l;function m(){return this.checkFolderGrant(c.default.SHARE_GRANTS.move)}exports.isEnableMove=m;function n(){var a=this.get("model");var b=a.getFolder();return!b.isShareTake()}exports.isEnableFilterCreate=n;exports.withWelterContextMenu=a.default.createWelterDecorator(function(a){return __assign({},a)},d.withWelter)});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/contextmenu-message/contextmenu-message",["require","exports","@mail/xray","default-values","feast","feast-tpl!./contextmenu-message.html","lazy.modules","mail/Folder","mail/Thread","service/layer","service/submenu","ui-block/contextmenu/contextmenu-abstract","ui-block/list/list","ui-block/list-item/list-item"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);k=__importDefault(k);l=__importDefault(l);exports.default=c.default.Block.extend((0,j.withWelterContextMenu)({name:"contextmenu-message",template:d.default,blocks:{list:k.default,"list-item":l.default},events:{"click:move":"onClickMove",newtab:"onNewTab"},defaults:{type:"message",model:null,selectable:true,"archive-disabled":b.ARCHIVE_DISABLED,"invite-call":b.CALLS&&!b.CALLS_DISABLE_LETTER_CALL},hasSelectButton:j.hasSelectButton,isContainedInMetaThread:j.isContainedInMetaThread,checkFolderGrant:j.checkFolderGrant,isEnableMark:j.isEnableMark,isEnableMoveToSpam:j.isEnableMoveToSpam,isEnableMoveToArchive:j.isEnableMoveToArchive,isEnableRemove:j.isEnableRemove,isEnableMove:j.isEnableMove,isEnableFilterCreate:j.isEnableFilterCreate,isRemoveVisible:j.isRemoveVisible,didMount:function(){var a=this;Promise.all([new Promise(function(a,b){require(["mediator/letters-actions"],a,b)}).then(__importStar),new Promise(function(a,b){require(["mediator/letters-selection"],a,b)}).then(__importStar),new Promise(function(a,b){require(["mediator/settings-filters-manager"],a,b)}).then(__importStar),(0,e.lazyMediatorCalendarManager)(),(0,e.lazyMediatorCallsManager)(),new Promise(function(a,b){require(["mediator/layout-manager"],a,b)}).then(__importStar)]).then(function(b){var c=b[0].default,d=b[1].default,e=b[2].default,f=b[3].default,g=b[4].default,h=b[5].default;c.register(a);d.register(a);e.register(a);f.register(a);g.register(a);h.register(a)});var b=this.get("model");if(b&&b.hasOwnProperty("folders")){this.set("folders",b.folders)}if(b&&b.hasOwnProperty("selectable")){this.set("selectable",b.selectable)}},isNewTabAvailable:function(){return!b.USE_SINGLE_TAB&&this.get("model")instanceof g.default},isShowCallendarButton:function(){var a=this.get("model");var c=b.FEATURE_UNSUBSCRIBE&&a&&a.get("flags.newsletter")&&b.DISABLE_LETTER_CALENDAR_NEWSLETTERS;return!this.is("disable-create-event")&&!c},onNewTab:function(b){var c;b.preventDefault();var d=this.get("router");a.default.send("click_new_page",{dwh:{object:"message",screen:(c=d===null||d===void 0?void 0:d.route)===null||c===void 0?void 0:c.id}})},isShowCallsButton:function(){var a=this.get("model");var c=b.FEATURE_UNSUBSCRIBE&&a&&a.get("flags.newsletter")&&b.CALLS_DISABLE_LETTER_CALL_NEWSLETTERS;return this.is("invite-call")&&!c},getParentThread:function(){var a=this.get("extraDetails");return a===null||a===void 0?void 0:a.parentThread},onClickMove:function(){var a=this.ids["move-to"];var b={folders:this.get("folders"),model:this.get("model"),parentThread:this.getParentThread()};if(this.is("mobile")){h.default.open("move-to-folder",b,{dimmer:true,mobile:true,resolvable:false})}else{i.default.open("moveto-folder",b,a)}a.set("selected",true)},isEnableCall:function(){return this.checkFolderGrant(f.default.SHARE_GRANTS.reply)},shouldDisplayFilter:function(){return!b.FORBID_FILTERS&&!this.get("deselectAll")&&!this.is("mobile")},shouldDisplaySearch:function(){return!this.is("mobile")},shouldDisplaySpam:function(){var a=this.get("model").getFolder();return!b.FORBID_SPAM&&!a.isSpam()&&!this.get("deselectAll")}}))});define("feast-tpl!app/feast-tpl!ui-block/contextmenu-metathread/contextmenu-metathread.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="message" value="{attrs.model}"/>\n\t<fn:var name="folder" value="{message && message.getFolder()}"/>\n\n\t<b:list>\n\t\t<fn:if test="_this.isNewTabAvailable()">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="newtab"\n\t\t\t\tremit:click="metathreadnewtab"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t<b:ico name="actions:tab_add" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Открыть в новой вкладке\')}</span>\n\t\t\t</b:list-item>\n\n\t\t\t<div bem:elem="hr" />\n\t\t</fn:if>\n\n\t\t<fn:if test="_this.isRemoveVisible()">\n\t\t\t<b:list-item\n\t\t\t\tremit:click="remove"\n\t\t\t\tqa:id="remove"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="remove"\n\t\t\t\tdisabled="{!_this.isEnableRemove()}"\n\t\t\t>\n\n\t\t\t\t<span bem:elem="ico" bem:mod="delete">\n\t\t\t\t\t<b:ico name="{_this.getRemoveButtonIcon()}" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{_this.getRemoveButtonText()}\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<b:list-item\n\t\t\tqa:id="archive"\n\t\t\tremit:click="archive"\n\t\t\tevent:details="{model:message}"\n\t\t\tradar-id="archive"\n\t\t\tdisabled="{!_this.isEnableMoveToArchive()}"\n\n\t\t\tfn:if="!folder.isArchive() && !attrs[\'archive-disabled\']"\n\t\t>\n\t\t\t<span bem:elem="ico" bem:mod="archive">\n\t\t\t\t<b:ico name="archive" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'В архив\')}</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\tqa:id="move"\n\t\t\tid="move-to"\n\t\t\tremit:click.stop.prevent="click:move"\n\t\t\tradar-id="move"\n\t\t\tnested\n\t\t>\n\t\t\t<span bem:elem="ico">\n\t\t\t\t<b:ico name="folder-move" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">{i18n(\'Переместить в папку\')}</span>\n\t\t\t<span bem:elem="nested">\n\t\t\t\t<b:ico name="navigation:drop_next" size="s"/>\n\t\t\t</span>\n\t\t</b:list-item>\n\n\t\t<div bem:elem="hr"/>\n\n\t\t<fn:if test="!message.is(\'flags.unread\')">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="mark:unread"\n\t\t\t\tremit:click="metathreadtogglestatus:unread"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="unread"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="unread">\n\t\t\t\t\t<b:ico name="status:unread" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Пометить непрочитанным\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="message.is(\'flags.unread\')">\n\t\t\t<b:list-item\n\t\t\t\tqa:id="mark:read"\n\t\t\t\tremit:click="metathreadtogglestatus:unread"\n\t\t\t\tevent:details="{model:message}"\n\t\t\t\tradar-id="read"\n\n\t\t\t\tdata-shortcut="q"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="read">\n\t\t\t\t\t<b:ico name="status:read" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">{i18n(\'Пометить прочитанным\')}</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/contextmenu-metathread/contextmenu-metathread.html")});define("feast-tpl!ui-block/contextmenu-metathread/contextmenu-metathread.html",["feast-tpl!app/feast-tpl!ui-block/contextmenu-metathread/contextmenu-metathread.html"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/contextmenu-metathread/contextmenu-metathread",["require","exports","@mail/xray","default-values","feast","feast-tpl!./contextmenu-metathread.html","helpers/folder","helpers/opener","lazy.modules","mail/Folder","mail/Thread","service/submenu","ui-block/list/list","ui-block/list-item/list-item"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);exports.default=c.default.Block.extend({name:"contextmenu-metathread",template:d.default,blocks:{list:k.default,"list-item":l.default},events:{metathreadnewtab:"onNewtab","click:move":"onClickMove"},defaults:{type:"metathread",model:null,"archive-disabled":b.ARCHIVE_DISABLED},didMount:function(){var a=this;Promise.all([new Promise(function(a,b){require(["mediator/letters-actions"],a,b)}).then(__importStar),new Promise(function(a,b){require(["mediator/letters-selection"],a,b)}).then(__importStar),new Promise(function(a,b){require(["mediator/settings-filters-manager"],a,b)}).then(__importStar),(0,g.lazyMediatorCalendarManager)()]).then(function(b){var c=b[0].default,d=b[1].default,e=b[2].default,f=b[3].default;c.register(a);d.register(a);e.register(a);f.register(a)});var b=this.get("model");if(b&&b.folders){this.set("folders",b.folders)}},onNewtab:function(b){var c;b.preventDefault();var d=this.get("router");var e=this.get("model");var g=e.get("metathread_data.folder");var h=d.getUrl("#letters",{folder:g});(0,f.default)(h);a.default.send("click_new_page",{dwh:{object:"metathread_".concat(g),screen:(c=d===null||d===void 0?void 0:d.route)===null||c===void 0?void 0:c.id}})},isNewTabAvailable:function(){return!b.USE_SINGLE_TAB&&this.get("model")instanceof i.default},onClickMove:function(){var a=this.ids["move-to"];var b={folders:this.get("folders"),model:this.get("model"),selectedMetathreads:true};j.default.open("moveto-folder",b,a);a.set("selected",true)},isEnableMoveToArchive:function(){var a=this.get("model");var b=a.get("metathread_data.folder");return b.checkGrant(h.default.SHARE_GRANTS.move_to_archive)},isEnableRemove:function(){var a=this.get("model");var b=a.get("metathread_data.folder");return b.checkGrant(h.default.SHARE_GRANTS.remove)},isRemoveVisible:function(){return!(0,e.isDeleteFromFolderDisabled)(this.get("model").get("metathread_data.folder"))},getRemoveButtonIcon:function(){if(b.CHANGE_ICON_REMOVE_BUTTON_METATHREAD){return"navigation:folder_hidden"}return"delete"},getRemoveButtonText:function(){var a=this.get("model");var c=a&&a.getFolder();if(c&&c.isTrashLike()){return i18n("Удалить навсегда")}if(b.CHANGE_TEXT_REMOVE_BUTTON_METATHREAD_DELETE){return i18n("Удалить все письма")}if(b.CHANGE_TEXT_REMOVE_BUTTON_METATHREAD_EMPTY){return i18n("Очистить содержимое")}return i18n("Удалить")}})});define("feast-tpl!app/feast-tpl!ui-block/contextmenu-selection/contextmenu-selection.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="folder" value="{attrs.model && attrs.model.getFolder()}"/>\n\t<fn:var name="stats" value="{_this.getSelectedStats()}"/>\n\n\t<b:list>\n\t\t\x3c!-- Выделить все письма --\x3e\n\t\t<fn:if test="_this.hasSelectButton() && attrs.selectable">\n\n\t\t\t<b:list-item\n\t\t\t\t\tqa:id="select:all"\n\t\t\t\t\tremit:click="select:all"\n\t\t\t\t\tradar-id="select-all"\n\t\t\t\t\tfn:if="!attrs[\'if-folder-selected\']"\n\t\t\t\t\tnested\n\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico" bem:mod="select-all">\n\t\t\t\t\t\t\t<b:ico name="select-all" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{i18n(\'Выделить все письма\')}\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\t\tqa:id="amount-select:all"\n\t\t\t\t\t> {stats.all} </span>\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\n\t\t\t<b:list-item\n\t\t\t\t\tqa:id="select:drop"\n\t\t\t\t\tremit:click="select:drop"\n\t\t\t\t\tradar-id="deselect"\n\t\t\t\t\tfn:if="attrs[\'if-folder-selected\']"\n\t\t\t\t\tnested\n\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico" bem:mod="select-all">\n\t\t\t\t\t\t\t<b:ico name="select-all" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{i18n(\'Снять выделение\')}\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\t\tqa:id="amount-select:drop"\n\t\t\t\t\t> {stats.all} </span>\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\n\t\t\t<div bem:elem="hr"/>\n\t\t</fn:if>\n\n\t\t<fn:if test="_this.isRemoveVisible()">\n\t\t\t<b:list-item\n\t\t\t\t\tqa:id="remove"\n\t\t\t\t\tremit:click="remove"\n\t\t\t\t\tevent:details="{model:attrs.selected, selection:attrs[\'if-folder-selected\']}"\n\t\t\t\t\tradar-id="remove"\n\t\t\t\t\tdisabled="{!_this.isEnableRemove()}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="delete">\n\t\t\t\t\t<b:ico name="delete" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{folder && folder.isTrashLike() ? i18n(\'Удалить навсегда\') : i18n(\'Удалить\')}\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\t\tqa:id="amount-remove"\n\t\t\t\t\t> {stats.all} </span>\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="!folder.isArchive() && !attrs[\'archive-disabled\'] && (!stats || stats.noarchive)">\n\t\t\t<b:list-item\n\t\t\t\t\tqa:id="archive"\n\t\t\t\t\tremit:click="archive"\n\t\t\t\t\tevent:details="{model:attrs.selected, selection:attrs[\'if-folder-selected\']}"\n\t\t\t\t\tradar-id="archive"\n\t\t\t\t\tdisabled="{!_this.isEnableMoveToArchive()}"\n\t\t\t>\n\t\t\t<span bem:elem="ico" bem:mod="archive">\n\t\t\t\t<b:ico name="archive" size="s"/>\n\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{i18n(\'В архив\')}\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\t\tqa:id="amount-archive"\n\t\t\t\t\t> {stats.all} </span>\n\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="_this.shouldDisplaySpam(stats)">\n\t\t\t<b:list-item\n\t\t\t\t\tqa:id="spam"\n\t\t\t\t\tremit:click="spam"\n\t\t\t\t\tevent:details="{model:attrs.selected}"\n\t\t\t\t\tradar-id="spam"\n\t\t\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\t>\n\t\t\t\t\t<span bem:elem="ico" bem:mod="spam-on">\n\t\t\t\t\t\t<b:ico name="spam-on" size="s"/>\n\t\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{i18n(\'Спам\')}\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\t\tfn:if="!attrs[\'if-folder-selected\'] && !stats.metathread"\n\t\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\t\tqa:id="amount-spam"\n\t\t\t\t\t> {stats.nospam} </span>\n\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<fn:if test="folder.isSpam() && !folder.isShareTake() && (!stats || !attrs[\'if-folder-selected\'])">\n\t\t\t<b:list-item\n\t\t\t\t\tqa:id="unspam"\n\t\t\t\t\tremit:click="unspam"\n\t\t\t\t\tevent:details="{model:attrs.selected}"\n\t\t\t\t\tradar-id="unspam"\n\t\t\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="spam-off">\n\t\t\t\t\t<b:ico name="spam-off" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{i18n(\'Не спам\')}\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\t\tfn:if="!attrs[\'if-folder-selected\'] && !stats.metathread"\n\t\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\t\tqa:id="amount-unspam"\n\t\t\t\t\t> {stats.spam} </span>\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\t\t<b:list-item\n\t\t\t\tqa:id="move"\n\t\t\t\tid="move-to"\n\t\t\t\tremit:click.stop.prevent="click:move"\n\t\t\t\tevent:details="{selection:attrs[\'if-folder-selected\']}"\n\t\t\t\tradar-id="move"\n\t\t\t\tnested\n\t\t\t\tdisabled="{!_this.isEnableMove()}"\n\t\t>\n\t\t\t<span bem:elem="ico">\n\t\t\t\t<b:ico name="folder-move" size="s"/>\n\t\t\t</span>\n\t\t\t<span bem:elem="text">\n\t\t\t\t{i18n(\'Переместить в папку\')}\n\t\t\t\t<span\n\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\tqa:id="amount-click:move"\n\t\t\t\t> {stats.all} </span>\n\n\t\t\t</span>\n\t\t\t<span bem:elem="nested">\n\t\t\t\t<b:ico name="navigation:drop_next" size="s"/>\n\t\t\t</span>\n\t\t</b:list-item>\n\n\t\t<div bem:elem="hr"/>\n\n\t\t<b:list-item\n\t\t\t\tqa:id="mark:unread"\n\t\t\t\tremit:click="mark:unreaded"\n\t\t\t\tevent:details="{model:attrs.selected, selection:attrs[\'if-folder-selected\']}"\n\t\t\t\tradar-id="unread"\n\t\t\t\tfn:if="!stats || stats.read > 0"\n\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="unread">\n\t\t\t\t\t<b:ico name="status:unread" size="s"/>\n\t\t\t\t</span>\n\t\t\t<span bem:elem="text">\n\t\t\t\t{i18n(\'Пометить непрочитанным\')}\n\t\t\t\t<span\n\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\tqa:id="amount-mark:unread"\n\t\t\t\t> {stats.read} </span>\n\n\t\t\t</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\t\tqa:id="mark:read"\n\t\t\t\tremit:click="mark:readed"\n\t\t\t\tevent:details="{model:attrs.selected, selection:attrs[\'if-folder-selected\']}"\n\t\t\t\tradar-id="read"\n\t\t\t\tdata-shortcut="q"\n\n\t\t\t\tfn:if="!stats || stats.unread > 0"\n\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="read">\n\t\t\t\t\t<b:ico name="status:read" size="s"/>\n\t\t\t\t</span>\n\t\t\t<span bem:elem="text">\n\t\t\t\t{i18n(\'Пометить прочитанным\')}\n\t\t\t\t<span\n\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\tqa:id="amount-mark:read"\n\t\t\t\t> {stats.unread} </span>\n\n\t\t\t</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\t\tqa:id="mark:flagged"\n\t\t\t\tremit:click="mark:flagged"\n\t\t\t\tevent:details="{model:attrs.selected, selection:attrs[\'if-folder-selected\']}"\n\t\t\t\tradar-id="flag"\n\n\t\t\t\tfn:if="!stats || stats.noflagged > 0"\n\t\t\t\tdisabled="{!_this.isEnableMark()}"\n\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="flag">\n\t\t\t\t\t<b:ico name="actions:favorite_on" size="s"/>\n\t\t\t\t</span>\n\t\t\t<span bem:elem="text">\n\t\t\t\t{i18n(\'Пометить флажком\')}\n\t\t\t\t<span\n\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\tqa:id="amount-mark:flagged"\n\t\t\t\t> {stats.noflagged} </span>\n\t\t\t</span>\n\t\t</b:list-item>\n\n\t\t<b:list-item\n\t\t\t\tqa:id="mark:unflagged"\n\t\t\t\tremit:click="mark:unflagged"\n\t\t\t\tevent:details="{model: attrs.selected, selection:attrs[\'if-folder-selected\']}"\n\t\t\t\tradar-id="unflag"\n\n\t\t\t\tfn:if="!stats || stats.flagged > 0"\n\t\t\t\tdisabled="{!_this.isEnableMark()}"\n\t\t>\n\t\t\t\t<span bem:elem="ico" bem:mod="unflag">\n\t\t\t\t\t<b:ico name="actions:favorite_off" size="s"/>\n\t\t\t\t</span>\n\t\t\t<span bem:elem="text">\n\t\t\t\t\t{i18n(\'Снять флажок\')}\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\t\tqa:id="amount-mark:unflagged"\n\t\t\t\t\t> {stats.flagged} </span>\n\t\t\t\t</span>\n\t\t</b:list-item>\n\n\t\t<fn:if test="_this.shouldDisplayFilter(stats)">\n\t\t\t<b:list-item\n\t\t\t\t\tqa:id="create:filter"\n\t\t\t\t\tremit:click="settingsfilters:create"\n\t\t\t\t\tevent:details="{model:attrs.selected}"\n\t\t\t\t\tradar-id="filter-create"\n\n\t\t\t\t\tdisabled="{!_this._isEnableFilterCreate()}"\n\t\t\t>\n\t\t\t\t<bem:mod name="disabled" test="attrs[\'if-folder-selected\'] || stats.metathread"/>\n\t\t\t\t<span bem:elem="ico" bem:mod="filter">\n\t\t\t\t\t<b:ico name="actions:filter" size="s"/>\n\t\t\t\t</span>\n\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t{i18n(\'Создать фильтр\')}\n\t\t\t\t\t<span\n\t\t\t\t\t\t\tbem:elem="text"\n\t\t\t\t\t\t\tfn:if="!attrs[\'if-folder-selected\'] && !stats.metathread"\n\t\t\t\t\t\t\tbem:mod="disabled"\n\t\t\t\t\t\t\tqa:id="amount-create:filter"\n\t\t\t\t\t> {stats.all} </span>\n\t\t\t\t</span>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/contextmenu-selection/contextmenu-selection.html")});define("feast-tpl!ui-block/contextmenu-selection/contextmenu-selection.html",["feast-tpl!app/feast-tpl!ui-block/contextmenu-selection/contextmenu-selection.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/get-selected-stats",["require","exports","mail/Folder","models/metathread/metathread"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);function c(c,e){if(!c){return}var f=c.filter(function(a){return a.getFolder&&!b.default.isMetathreadFooter(a)});var g={all:0,unread:0,read:0,flagged:0,noflagged:0,spam:0,nospam:0,noarchive:0,metathread:0,fromTrustedMailer:0};f.forEach(function(b){var c=b.getFolder();if(b.get("flags.metathread")){var f=b.get("metathread_data.folder");c=a.default.get(f);d(g,c);g.metathread++}else if(!e){b.is("flags.unread")?g.unread++:g.read++;b.is("flags.flagged")?g.flagged++:g.noflagged++;g.all++;if(b.is("flags.newsletter")&&b.is("flags.show_definitely_spam")&&b.is("flags.have_unsubscribe_list")){g.fromTrustedMailer++}}c.isSpam()?g.spam++:g.nospam++;!c.isArchive()&&g.noarchive++});if(e){d(g,e)}return g}exports.default=c;function d(a,b){a.unread+=b.get("messages_unread");a.read+=b.get("messages_total")-b.get("messages_unread");a.flagged+=b.get("messages_flagged");a.noflagged+=b.get("messages_total")-b.get("messages_flagged");a.all+=b.get("messages_total")}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/contextmenu-selection/contextmenu-selection",["require","exports","default-values","feast","feast-tpl!./contextmenu-selection.html","helpers/get-selected-stats","service/submenu","ui-block/contextmenu/contextmenu-abstract","ui-block/list/list","ui-block/list-item/list-item"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);g=__importDefault(g);h=__importDefault(h);exports.default=b.default.Block.extend((0,f.withWelterContextMenu)({name:"contextmenu-selection",template:c.default,blocks:{list:g.default,"list-item":h.default},events:{"click:move":"onClickMove"},defaults:{type:"selection",model:null,selectable:true,"archive-disabled":a.ARCHIVE_DISABLED},hasSelectButton:f.hasSelectButton,isContainedInMetaThread:f.isContainedInMetaThread,checkFolderGrant:f.checkFolderGrant,isEnableMark:f.isEnableMark,isEnableMoveToSpam:f.isEnableMoveToSpam,isEnableMoveToArchive:f.isEnableMoveToArchive,isEnableRemove:f.isEnableRemove,isEnableMove:f.isEnableMove,isEnableFilterCreate:f.isEnableFilterCreate,isRemoveVisible:f.isRemoveVisible,didMount:function(){var a=this;require(["mediator/letters-actions","mediator/letters-selection","mediator/settings-filters-manager"],function(b,c,d){var e=b.default;var f=c.default;var g=d.default;if(a.isMounted()){e.register(a);f.register(a);g.register(a)}});var b=this.get("model");if(b&&b.get("selectable")){this.set("selectable",b.get("selectable"))}},getSelectedStats:function(){return(0,d.default)(this.get("selected"),this.get("selected-folder"))},onClickMove:function(){var a=this.ids["move-to"];var b=this.get("model");var c=[];if(b&&b.hasOwnProperty("folders")){c=b.folders}var d={folders:c,model:this.get("selected"),lettersFoldersIds:this.get("letters-folders-ids"),selectedMetathreads:this.get("selected-metathreads"),selection:this.get("if-folder-selected")};e.default.open("moveto-folder",d,a);a.set("selected",true)},shouldDisplayFilter:function(b){return!a.FORBID_FILTERS&&!this.get("if-folder-selected")&&(!b||!b.metathread)},shouldDisplaySpam:function(b){return!a.FORBID_SPAM&&!this.get("model").getFolder().isSpam()&&!this.get("if-folder-selected")&&(!b||!b.metathread)}}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/contextmenu/contextmenu",["require","exports","default-values","feast","feast-tpl!./contextmenu.html","lazy.modules","mail/Folder","mail/Message","mail/Thread","service/radars/decorator","service/smokescreen","service/submenu","ui-block/contextmenu-correspondent/contextmenu-correspondent","ui-block/contextmenu-correspondents/contextmenu-correspondents","ui-block/contextmenu-folder/contextmenu-folder","ui-block/contextmenu-message/contextmenu-message","ui-block/contextmenu-metathread/contextmenu-metathread","ui-block/contextmenu-selection/contextmenu-selection"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);var q={thread:n.default,letter:n.default,selection:p.default,folder:m.default,metathread:o.default,correspondent:k.default,correspondents:l.default};var r=document.getElementsByClassName(i.default.lookup("scrollable"));exports.default=b.default.Block.extend((0,h.default)({id:function(a){var b;return"contextmenu-"+((b=a===null||a===void 0?void 0:a.block)===null||b===void 0?void 0:b.get("type"))},explicit:true})({name:"contextmenu",template:c.default,blocks:{},events:{"menu-toggle":"onMenuClick"},defaults:{type:"",expanded:false,x:0,y:0},notVisualAttributes:{type:true},attrChanged:{expanded:function(a){var b=this;this[a?"$on":"$off"](this.el.ownerDocument,"click","handleOutside");this[a?"$on":"$off"](this.el.ownerDocument.defaultView,"resize","handleOutside");this[a?"$on":"$off"](this.el.ownerDocument.defaultView,"blur","handleOutside");[].forEach.call(r,function(c){b[a?"$one":"$off"](c,"scroll","handleOutside")});if(!a){j.default.close()}}},didMount:function(){var a=this;require(["mediator/letters-selection"],function(b){var c=b.default;if(a.isMounted()){c.register(a)}});this.onEscape=function(b){b.stopImmediatePropagation();a.hide()}},didUnmount:function(){this.destroyBlock()},onContextmenu:function(a,b){a.preventDefault();this.createMenu(a,b);this.setCoordinates(a);this.show()},setCoordinates:function(a){var b=a.originalEvent;var c=this.refs.block;var d=4;var e=8;var f=b.clientX;var g=b.clientY;var h=window.innerWidth;var i=window.innerHeight;var j=c.offsetWidth;var k=c.offsetHeight;var l=h-f-e-d>j;var m=f-e-d>j;var n=i-g>k;var o;var p;if(l){o=f+d}else if(m){o=f-j-d}else{o=h-j-e}if(n){p=g}else{p=g-(k-(i-g))}this.set({x:o,y:p})},createMenu:function(a,b){var c=this.getEventType(a);var d=q[c];var e=this.get("type");if(!d){return}if(c===e){this.block.set({model:a.details,extraDetails:b});return}this.destroyBlock();var f="default"in d&&"blockName"in d.default&&"render"in d.default?d.default:d;var g=new f({model:a.details,router:this.get("router"),extraDetails:b},this.getChildContext());this.block=g;g.renderTo(this.refs.block)},show:function(){var a=this;this.set("expanded",false);Promise.resolve(this.block.onShow&&this.block.onShow()).then(function(){a.set("expanded",true);a.radar("show");(0,d.lazyMailKeymaster)().then((0,d.uniqCallback)(a,function(b){b("escape",a.onEscape)}))})},hide:function(){this.set("expanded",false);this.onHide()},setStyle:function(){return"left: ".concat(this.get("x"),"px;top: ").concat(this.get("y"),"px")},handleOutside:function(a){if(a&&a.button===2&&a.type!=="contextmenu"){a.preventDefault();return}if(a.target.window){this.hide();return}if(!this.el.contains(a.target)){this.hide()}},getBlock:function(){return this.block},destroyBlock:function(){if(!this.block){return}this.block.onDestroy&&this.block.onDestroy();this.block.destroy();this.set("type","");this.block=null;this.refs.block.innerHTML="";j.default.destroy()},getEventType:function(a){var b=a.details;var c="";if(!b){return c}if(b instanceof e.default){c="folder"}if(b instanceof f.default){c="letter"}if(b instanceof g.default){c="thread"}if(String(b.id).match("multithreadFixId")){c="metathread"}if(b.type==="correspondent"){c="correspondent"}if(b.type==="correspondents"){c="correspondents"}if(this.checkIfSelection(b)){c="selection"}return c},checkIfSelection:function(b){var c=this.isSelectedMatchToClicked(b);return a.ENABLE_ACTION_OVER_SELECTED&&b&&b.isLetterSelected&&!c},isSelectedMatchToClicked:function(a){var b=this.get("selected-map");var c=this.get("selected-length");return b[a.id]&&c===1},onHide:function(){var a=this;if(!this.block){return}this.block.onBeforeHide&&this.block.onBeforeHide();(0,d.lazyMailKeymaster)().then((0,d.uniqCallback)(this,function(b){b.unbind("escape",a.onEscape)}))},onMenuClick:function(a){if(!a.isDefaultPrevented()||this.is("expanded")){a.preventDefault();this.hide()}}}))});define("feast-tpl!app/feast-tpl!ui-block/counters/counters.html",["feast"],function(a){return a.smartParse('<div style="position: absolute; left: -100000px; top: -100000px;">\n\t<fn:if test="attrs.vkcid">\n\t\t<script type="text/javascript">\n\t\t\tvar _tmr = _tmr || [];\n\t\t\t_tmr.push({\n\t\t\t\ttype: \'setUserParams\',\n\t\t\t\tparams: {\n\t\t\t\t\tVKConnectID: {attrs.vkcid}\n\t\t\t\t}\n\t\t\t});\n\t\t<\/script>\n\t</fn:if>\n\t<div ref="counter-tns"/>\n\t<div ref="counter-li"/>\n\t<div ref="counter-top"/>\n\t<div ref="counter-top-hit"/>\n</div>\n',"app/feast-tpl!ui-block/counters/counters.html")});define("feast-tpl!ui-block/counters/counters.html",["feast-tpl!app/feast-tpl!ui-block/counters/counters.html"],function(a){return a});define("ui-block/counters/counters",["exports","@mail/adman","cfgUser","feast","feast-tpl!./counters.html"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=g.default.Block.extend({name:"counters",template:h.default,blocks:{},defaults:{vkcid:f.default.get("initialUser.vkc_user_id")},getPlacements:function a(){return["counter-tns","counter-li","counter-top","counter-top-hit"].map(function(a){return e.default.placement(a)})},didMount:function a(){var b=this;this.getPlacements().forEach(function(a){if(a){a.attachToContainer(b.refs[a.name]).wakeUp()}})},didUnmount:function a(){this.getPlacements().forEach(function(a){if(a){a.sleep()}})}})});define("feast-tpl!app/feast-tpl!ui-block/dimmer/dimmer.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="color" value="{attrs.color}" test="attrs.color"/>\n\t<bem:mod name="new-toolbar" test="_this.useNewToolbar()"/>\n</div>\n',"app/feast-tpl!ui-block/dimmer/dimmer.html")});define("feast-tpl!ui-block/dimmer/dimmer.html",["feast-tpl!app/feast-tpl!ui-block/dimmer/dimmer.html"],function(a){return a});define("ui-block/dimmer/dimmer",["exports","default-values","feast","feast-tpl!./dimmer.html"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(b);var e=f(c);function f(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"dimmer",template:e.default,blocks:{},defaults:{color:""},useNewToolbar:function b(){return a.NEW_TOOLBAR}})});define("feast-tpl!app/feast-tpl!ui-block/download-frame/download-frame.html",["feast"],function(a){return a.smartParse('<iframe name="{attrs.name}"/>\n',"app/feast-tpl!ui-block/download-frame/download-frame.html")});define("feast-tpl!ui-block/download-frame/download-frame.html",["feast-tpl!app/feast-tpl!ui-block/download-frame/download-frame.html"],function(a){return a});define("ui-block/download-frame/download-frame",["exports","feast","feast-tpl!./download-frame.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DOWNLOAD_IFRAME_NAME=undefined;var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=exports.DOWNLOAD_IFRAME_NAME="download-frame";exports.default=c.default.Block.extend({name:"download-frame",template:d.default,blocks:{},defaults:{name:f}})});define("feast-tpl!app/feast-tpl!ui-block/layer-window/layer-window.html",["feast"],function(a){return a.smartParse('<div use:mediator="layout-manager">\n\t<fn:var name="hideHeadline" value="{attrs[\'hide-headline\']}" />\n\n\t<bem:mod name="hidden" test="!attrs.active"/>\n\x3c!-- Выглядит так, что это с точки зрения текущего дизайна только лишнее FMAIL-15984 --\x3e\n\x3c!--\t<bem:mod name="mobile-full" test="attrs.mobile && !attrs.compact"/>--\x3e\n\t<bem:mod name="mobile-compact" test="attrs.mobile && !!attrs.compact"/>\n\t<bem:mod name="fullscreen" test="attrs.fullscreen"/>\n\t\x3c!-- Потому что на планшетах нам не нужен "мобильный" вид, используем десктопный. Но z-index надо переписать --\x3e\n\t<bem:mod name="foreground" test="attrs.foreground"/>\n\n\t<bem:mod name="new-toolbar" test="_this.useNewToolbar()"/>\n\n\t\x3c!-- Затемнение на заднем фоне --\x3e\n\t<div bem:elem="dimmer">\n\t\t<b:dimmer\n\t\t\tfn:if="attrs.dimmer && attrs.active"\n\t\t\tcolor="{attrs[\'dimmer-color\']}"\n\t\t/>\n\t</div>\n\n\t\x3c!-- Контейнер, чтобы dimmer не попадал в скролл, он же ловит клики "как бы" по диммеру --\x3e\n\t<div bem:elem="container" remit:click="dimmer:click" ref="container">\n\t\t<bem:mod name="silent" test="attrs.silent"/>\n\t\t<bem:mod name="hide-headline" test="hideHeadline"/>\n\t\t\x3c!-- Дополнительные отступы --\x3e\n\t\t<div bem:elem="spacer" fn:if="!attrs.mobile">\n\t\t\t<bem:mod name="hide-headline" test="hideHeadline"/>\n\t\t</div>\n\n\t\t\x3c!-- Место рендера блока --\x3e\n\t\t<div bem:elem="block" ref="block" qa:id="layer-window-block"/>\n\n\t\t\x3c!-- Место показа нотификаций поверх лейера --\x3e\n\t\t<b:notify-stack id="notify-stack" fixed/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/layer-window/layer-window.html")});define("feast-tpl!ui-block/layer-window/layer-window.html",["feast-tpl!app/feast-tpl!ui-block/layer-window/layer-window.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/notify-stack/notify-stack.html",["feast"],function(a){return a.smartParse('<div qa:id="notify">\n\t<bem:mod name="touch" test="_this.isTouch()"/>\n\t<bem:mod name="fixed" test="attrs.fixed"/>\n\t<bem:mod name="mobile-footer" test="attrs[\'mobile-footer\']"/>\n\n    <fn:add-class name="slide-in" test="attrs.animated"/>\n\n\t<fn:if test="attrs.items">\n\t\t<fn:for data="attrs.items" as="data">\n\t\t\t<fn:if test="data">\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="data.item">\n\t\t\t\t\t\t<div key="notify-{data[\'_key\']}" ref="{data[\'_key\']}" style="margin: 8px 0;"/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<b:notify\n\t\t\t\t\t\t\t\tkey="notify-{data[\'_key\']}"\n\t\t\t\t\t\t\t\tref="{data[\'_key\']}"\n\t\t\t\t\t\t\t\ttype="{data.type}"\n\t\t\t\t\t\t\t\ttext="{data.text}"\n\t\t\t\t\t\t\t\tsecondary-text="{data.secondaryText}"\n\t\t\t\t\t\t\t\ticon="{data.icon}"\n\t\t\t\t\t\t\t\ticon-size="{data.iconSize}"\n\t\t\t\t\t\t\t\tqa:id="{data.qa}"\n\t\t\t\t\t\t\t\tduration="{data.duration}"\n\t\t\t\t\t\t\t\tactions="{data.actions}"\n\t\t\t\t\t\t\t\tsecondary-actions="{data.secondaryActions}"\n\t\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\t\tinline="{data.inline}"\n\t\t\t\t\t\t\t\tdirection="{data.direction}"\n\t\t\t\t\t\t\t\tshortcut="{data.shortcut}"\n\t\t\t\t\t\t\t\tanimated\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</fn:if>\n\t\t</fn:for>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/notify-stack/notify-stack.html")});define("feast-tpl!ui-block/notify-stack/notify-stack.html",["feast-tpl!app/feast-tpl!ui-block/notify-stack/notify-stack.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/notify/notify.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="type" value="{attrs.type}" test="attrs.type"/>\n\t<bem:mod name="inline" test="attrs.inline"/>\n\t<bem:mod name="touch" test="attrs.touch || _this.isOctaviusMobile()"/>\n\t<bem:mod name="direction" value="{attrs.direction}" test="attrs.direction"/>\n\t<bem:mod name="hasntactions" test="!attrs.actions || !attrs.actions.length"/>\n\n\t<fn:add-class name="js-shortcut" test="attrs.shortcut" />\n\n\t<fn:var name="secondaryActions" value="{attrs[\'secondary-actions\']}"/>\n\t<fn:var name="hasSecondaryActions" value="{secondaryActions && secondaryActions.length}"/>\n\t<fn:var name="multiline" value="{!!attrs[\'secondary-text\'] || hasSecondaryActions}"/>\n\n\t<fn:if test="!attrs.closed" animated>\n\t\t<div bem:elem="body">\n\t\t\t<div\n\t\t\t\tbem:elem="icon"\n\t\t\t\tfn:if="attrs.icon"\n\t\t\t>\n\t\t\t\t<b:ico name="{attrs.icon}" size="{attrs[\'icon-size\'] || \'s\'}"/>\n\t\t\t</div>\n\t\t\t<div bem:elem="content">\n\t\t\t\t<span bem:elem="message">\n\t\t\t\t\t<span bem:elem="message__text" qa:id="message">\n\t\t\t\t\t\t\x3c!--<bem:mod name="center" test="attrs.touch && !hasAction"/>--\x3e\n\t\t\t\t\t\t<fn:value>attrs.text</fn:value>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\n\t\t\t\t<span bem:elem="actions">\n\t\t\t\t\t<span bem:elem="actions-sub">\n\t\t\t\t\t\t<fn:for data="attrs.actions" test="attrs.actions" as="item"\n\t\t\t\t\t\t\t\tkey="index">\n\t\t\t\t\t\t\t<a bem:elem="action" remit:click="action" qa:id="action"\n\t\t\t\t\t\t\t   event:details="item.event"\n\t\t\t\t\t\t\t   key="{index}">\n\t\t\t\t\t\t\t\t<fn:if test="item.link">\n\t\t\t\t\t\t\t\t\t<fn:attr name="href" value="{item.link}"/>\n\t\t\t\t\t\t\t\t\t<fn:attr name="target" value="_blank"/>\n\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t<span bem:elem="{item.text}" qa:id="action-text">\n\t\t\t\t\t\t\t\t<fn:value>item.text</fn:value>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</fn:for>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="secondary"\n\t\t\t\t\tfn:if="attrs[\'secondary-text\'] && !hasSecondaryActions"\n\t\t\t\t>\n\t\t\t\t\t{attrs[\'secondary-text\']}\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="secondary"\n\t\t\t\t\tfn:if="hasSecondaryActions"\n\t\t\t\t>\n\t\t\t\t\t<span bem:elem="actions">\n\t\t\t\t\t\t<span bem:elem="actions-sub">\n\t\t\t\t\t\t\t<fn:for data="secondaryActions"\n\t\t\t\t\t\t\t\t\ttest="hasSecondaryActions"\n\t\t\t\t\t\t\t\t\tas="item"\n\t\t\t\t\t\t\t\t\tkey="index"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<a bem:elem="action"\n\t\t\t\t\t\t\t\t   remit:click="action:secondary"\n\t\t\t\t\t\t\t\t   qa:id="action:secondary:{index}"\n\t\t\t\t\t\t\t\t   event:details="item.event"\n\t\t\t\t\t\t\t\t   key="{index}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<fn:if test="item.link">\n\t\t\t\t\t\t\t\t\t\t<fn:attr name="href" value="{item.link}"/>\n\t\t\t\t\t\t\t\t\t\t<fn:attr name="target" value="_blank"/>\n\t\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t\t<span bem:elem="{item.text}" qa:id="secondary-action-text">\n\t\t\t\t\t\t\t\t\t\t{item.text}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</fn:for>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<fn:if test="!attrs[\'hide-close-button\']">\n\t\t\t\t<div bem:elem="ico-close">\n\t\t\t\t\t<bem:mod name="multiline" test="multiline"/>\n\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\tico="actions:close"\n\t\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\t\tsecondary\n\t\t\t\t\t\t\tshort\n\t\t\t\t\t\t\tremit:click="notify-close"\n\t\t\t\t\t\t\tcentered\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/notify/notify.html")});define("feast-tpl!ui-block/notify/notify.html",["feast-tpl!app/feast-tpl!ui-block/notify/notify.html"],function(a){return a});define("ui-block/notify/notify",["exports","default-values","feast","feast-tpl!./notify.html","ui-block/button2/button2","ui-block/ico/ico"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=j(b);var g=j(c);var h=j(d);var i=j(e);function j(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend({name:"notify",template:g.default,isolateEvents:false,blocks:{button2:h.default,ico:i.default},events:{"notify-close":"close"},defaults:{touch:a.OCTAVIUS_MOBILE,duration:0,closed:false,"hide-close-button":a.HIDE_NOTIFY_CLOSE_BUTTON},isOctaviusMobile:function b(){return a.OCTAVIUS_MOBILE},didMount:function a(){this.delay()},delay:function a(){var b=this;window.clearTimeout(this._id);var c=this.get("duration");if(c){this._id=setTimeout(function(){return b.close()},c*1e3)}},close:function a(){window.clearTimeout(this._id);if(this.destroyed||this.get("closed")){return}this.set("closed",true);this.broadcast("closed")}})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/notify-stack/notify-stack",["require","exports","default-values","feast","feast-tpl!./notify-stack.html","mediator/layout-manager","ui-block/notify/notify"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);var f=400;window.__notifyDebugList=[];exports.default=b.default.Block.extend({name:"notify-stack",_notifyKey:0,blocks:{notify:e.default},events:{closed:"handleClose"},defaults:{items:null,animated:false,"mobile-footer":a.CAN_SHOW_FOOTER_APP_TOOLBAR},attrChanged:{animated:function(a){var b=this;clearTimeout(this._animatedTimeout);if(a){this._animatedTimeout=setTimeout(function(){return b.set("animated",false)},f)}}},template:c.default,activeByContent:{},didMount:function(){this.set("items",__spreadArray([],this.get("items")||[],true),true)},isTouch:function(){var b;return((b=d.default===null||d.default===void 0?void 0:d.default.isLessThen)===null||b===void 0?void 0:b.call(d.default,"xs"))||a.OCTAVIUS_MOBILE},handleClose:function(a){var b=this;setTimeout(function(){return b.remove(a.details)},f);return false},add:function(a){var c=this;if(!this.isMounted()){return}var d=++this._notifyKey;var e=Object.assign({},a,{_key:d});var f=Object.assign({},e);if(window.__notifyDebugList.length>500){window.__notifyDebugList=[]}window.__notifyDebugList.push(f);var g=e.unique,h=e.onTop,i=h===void 0?false:h;var j=g&&this.getContentId(e);var k=[].concat(this.get("items")||[]);if(g){var l=this.activeByContent[j];if(l){return l}}if(i){k.unshift(e)}else{k.push(e)}e.idx=d;this.set({animated:true,items:k});if(e.item){e.item.renderComponentToNode(this.refs[d]);e.item.props.onDestroy=function(){c.remove(e)}}else{var m=b.default.Block.get(this.refs[d]);if(!m){return}m.idx=d;if(g){this.activeByContent[j]=m}return m}},remove:function(a){if(!this.isMounted()){return}var b=a.idx||a;if(b){var c=[].concat(this.get("items"));var d=c.findIndex(function(a){return a.idx===b});if(d<0){return}var e=this.getContentId(c[d]);delete this.activeByContent[e];c.splice(d,1);this.set("items",c)}},getContentId:function(a){return a.type+":"+a.text},setData:function(a,b){if(!this.isMounted()){return}var c=[].concat(this.get("items"));var d=c.findIndex(function(b){return b.idx===a});if(d<0){return}c[d]=__assign(__assign({},c[d]),b);this.set({items:c})}})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-window/layer-window",["require","exports","default-values","feast","feast-tpl!./layer-window.html","lazy.modules","service/adv/index","service/notify","service/radars/index","ui-block/dimmer/dimmer","ui-block/notify-stack/notify-stack"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);e=__importStar(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);var j=function(){e.default.wakeUp.apply(e.default,e.SLOTS_EXCEPT_SENT);e.default.updateOnAction()};exports.default=b.default.Block.extend({name:"layer-window",template:c.default,isolateEvents:false,_layerKey:0,blocks:{dimmer:h.default,"notify-stack":i.default},events:{"dimmer:click":"onDimmerClick"},defaults:{active:false,"close-on-dimmer":true,"close-on-esc":true,compact:false,dimmer:false,silent:false,"dimmer-color":"",fullscreen:false,mobile:false,foreground:a.TOUCH_MODE,"reject-on-close":false,"reject-on-dimmer":false,resolvable:false,"hide-headline":false},attrChanged:{"close-on-esc":function(a){(0,d.lazyMailKeymaster)().then((0,d.uniqCallback)(this,function(b){b.setScope(a?"all":"layer-no-shortcuts")}))},mobile:function(a){if(!this.block){return}if(this.block.is("responsive")){this.block.set("mobile",a);return}a?this.hide():this.show()},slim:function(a){if(!this.block){return}this.block.set("slim",a)},active:function(a){var b=this;(0,d.lazyMailKeymaster)().then((0,d.uniqCallback)(this,function(c){if(a&&b.is("close-on-esc")||a&&b.is("reject-on-dimmer")){c("escape",b.onEscape)}else{c.unbind("escape",b.onEscape)}}))}},didMount:function(){var a=this;f.default.setup(this.ids["notify-stack"],"layer-window");require(["mediator/layout-manager"],function(b){var c=b.default;c.register(a)});this.onEscape=function(b){b.stopImmediatePropagation();a.onHide("escape")}},setLayer:function(a,c){var d=b.default.Mediator.getAll();d.forEach(function(b){b.registerComponent(a.prototype.name,a)});var e=new a(__assign(__assign({},c),{mobile:this.is("mobile"),slim:this.is("slim")}));var f=this.getBlockPromise(e);e.on("layer:hide",this.onHide.bind(this,"action_hide"));e.on("layer:close",this.onHide.bind(this,"action_close"));e.on("layer:dimmer:click",this.onDimmerClick.bind(this));e.renderTo(this.refs.block);this.block=e;d.forEach(function(a){a.register(e)});this.show();return f},getBlockPromise:function(a){var b=this;if(!this.is("resolvable")){return Promise.resolve(a)}this._layerResolved=false;return new Promise(function(c,d){b._rejectLayer=d;b._resolveLayer=c;a.on("layer:resolve",function(d){a.off("layer:resolve",c);b._layerResolved=true;var e=d.details,f=e.resolveData,g=e.close;if(g){b.onHide("action_close")}c(f)})})},onHide:function(a){if(a===void 0){a="unknown"}if(!this.is("active")){return}var b=this.block.name;if(this.block.onBeforeHide){var c=this.block.onBeforeHide();if(c===null||c===void 0?void 0:c.stopHiding){return}}this.block.destroy();this.block=null;this.hide();if(this.is("resolvable")){if(this.is("reject-on-close")){!this._layerResolved&&this._rejectLayer()}else{!this._layerResolved&&this._resolveLayer()}}(0,g.default)([b,"hide",a]);if(this.showTS){(0,g.default)([b,"visible"],new Date-this.showTS)}this.broadcast("window:close");j()},onDimmerClick:function(a){if(!this.is("close-on-dimmer")){return}if(a.target!==this.refs.container){return}this.onHide("dimmer")},show:function(){this.showTS=new Date;this.set("active",true);this.block.set("visible",true);(0,g.default)([this.block.name,"show"]);e.default.sleep.apply(e.default,e.SLOTS_EXCEPT_SENT)},hide:function(){this.set("active",false);if(this.block){this.block.set("visible",false)}},useNewToolbar:function(){return a.NEW_TOOLBAR},getBlock:function(){return this.block}})});define("feast-tpl!app/feast-tpl!ui-block/letter-list/letter-list.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="layout" value="{attrs.layout}"/>\n\t<fn:var name="route" value="{attrs.route}"/>\n\t<fn:var name="router" value="{attrs.router}"/>\n\t<fn:var name="models" value="{attrs.models}"/>\n\t<fn:var name="status" value="{attrs.status}"/>\n\t<fn:var name="metathreads" value="{attrs.metathreads}"/>\n\t\x3c!-- Вынести страницу с ошибкой в отдельный блок --\x3e\n\t<fn:var name="letterNotFound" value="{attrs[\'letter-not-found\']}" />\n\t<fn:var name="transparent" value="{attrs.transparent && layout.isLessThen(\'xs\')}"/>\n\t<fn:var name="empty" value="{!models.length || letterNotFound}"/>\n\t<fn:var name="touch" value="{attrs.touch}"/>\n\t<fn:var name="compact" value="{attrs.compact}"/>\n\t<fn:var name="folders" value="{attrs.folders}"/>\n\t<fn:var name="folder" value="{attrs.folder}"/>\n\t<fn:var name="ponyMode" value="{attrs.ponymode}"/>\n\t<fn:var name="unsubscribeList" value="{attrs.unsubscribeList}"/>\n\t<fn:var name="useNewLetterList" value="{_this.useNewLetterList()}"/>\n\t<fn:var name="search" value="{route.is(\'#search #search-letter\')}"/>\n\n\t<bem:mod name="has-letters" test="!empty"/>\n\t<bem:mod name="touch" test="touch"/>\n\t<bem:mod name="transparent" test="transparent"/>\n\t<bem:mod name="empty-touch" test="empty && touch"/>\n\n\t<b:scrollable\n\t\t\tfn:if="!useNewLetterList"\n\t\t\tname="dataset-letters"\n\t\t\temit-onbottom="760"\n\t\t\temit-ontop="760"\n\t\t\tfooter="{!empty && !transparent}"\n\t\t\tsubstrated\n\t\t\tbright\n\t\t\tmeasure-fps\n\t\t\tfull-height\n\t\t\tsilent="{_this.isScrollableSilent()}"\n\t\t\tuse:mediator="letters-loader scrollable-manager letter-list-adv-optimizer advert-manager"\n\t>\n\t\t<b:dataset-letters\n\t\t\t\tuse:mediator="letters-shortcut letters-selection letters-actions letters-loader compose-manager flags search-manager paginator-manager welcome-block-manager unsubscribe-actions"\n\t\t\t\tkey="{search ? \'search\' : (\'folder_\' + folder.id)}"\n\t\t\t\trouter="{router}"\n\t\t\t\tfolder="{folder}"\n\t\t\t\tthread="{route.is(\'#search #search-letter\') ? route.params.id : route.params.letter}"\n\t\t\t\tfolders="{folders}"\n\t\t\t\tmodels="{models}"\n\t\t\t\tstatus="{status}"\n\t\t\t\tmetathreads="{metathreads}"\n\t\t\t\tcompact="{compact}"\n\t\t\t\ttouch="{touch}"\n\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\tdark-mode="{darkMode}"\n\t\t\t\tselect-mode="{layout.selectMode}"\n\t\t\t\tletter-not-found="{letterNotFound}"\n\t\t\t\tsearch="{search}"\n\t\t\t\tsearch-letter="{route.is(\'#search-letter\')}"\n\t\t\t\thidden-payment-dies="{attrs[\'hidden-payment-dies\']}"\n\t\t\t\tunsubscribeList="{unsubscribeList}"\n\t\t\t\tshowBackToParentFolder="{attrs[\'showBackToParentFolder\']}"\n\t\t/>\n\t</b:scrollable>\n\n\t<b:draggable\n\t\tfn:if="useNewLetterList"\n\t\tenabled="{!_this.isTouchDevice()}"\n\t\tremit:preparedragelement="preparedragelement"\n\t\tuse:mediator="todo-manager"\n\t>\n\t\t\x3c!-- TODO: завернуть class-name в selector() --\x3e\n\t\t<b:react-async\n\t\t\tclass-name="letter-list__react"\n\t\t\tid="reactList"\n\t\t\tblockRadarId="llist"\n\t\t\tuseErrorBoundary\n\t\t\tcomponentClass="{_this.component}"\n\t\t\tcomponent="DatasetLetters"\n\t\t\tqaEnabled="{attrs[\'qa-enabled\']}"\n\t\t\tuseMediators="{[\'letters-shortcut\', \'letters-selection\', \'letters-actions\', \'letters-loader\', \'compose-manager\', \'flags\', \'search-manager\', \'paginator-manager\', \'welcome-block-manager\', \'unsubscribe-actions\', \'themes-manager\', \'folders-navigation\']}"\n\t\t\tmodels="{models}"\n\t\t\tonScrollToBottom="{_this.onScrollToBottom}"\n\t\t\tonScroll="{_this.onScroll}"\n\t\t\trouter="{router}"\n\t\t\tfolder="{folder}"\n\t\t\tthread="{route.is(\'#search #search-letter\') ? route.params.id : route.params.letter}"\n\t\t\tfolders="{folders}"\n\t\t\tstatus="{status}"\n\t\t\tmetathreads="{metathreads}"\n\t\t\tcompact="{compact}"\n\t\t\ttouch="{touch}"\n\t\t\tpony-mode="{ponyMode}"\n\t\t\tselect-mode="{layout.selectMode}"\n\t\t\tletter-not-found="{letterNotFound}"\n\t\t\tsearch="{search}"\n\t\t\tsearch-letter="{route.is(\'#search-letter\')}"\n\t\t\thidden-payment-dies="{attrs[\'hidden-payment-dies\']}"\n\t\t\tunsubscribeList="{unsubscribeList}"\n\t\t\tshowBackToParentFolder="{attrs[\'showBackToParentFolder\']}"\n\t\t/>\n\t\t<b:paginator-container\n\t\t\tvisible="{attrs[\'nav-up\']}"\n\t\t\tnav-up="{attrs[\'nav-up-enabled\']}"\n\n\t\t\tuse:mediator="layout-manager compose-manager"\n\t\t>\n\t\t\t<fn:match name="nav-up">\n\t\t\t\t<b:button2\n\t\t\t\t\tico="navigation:arrow_up"\n\t\t\t\t\ttitle="{i18n(\'Наверх\')}"\n\t\t\t\t\tpure\n\t\t\t\t\tdisabled="{!attrs[\'nav-up\']}"\n\t\t\t\t\tqa:id="paginator-button-up"\n\t\t\t\t\tremit:click="paginator:up"\n\t\t\t\t\tcentered\n\t\t\t\t/>\n\t\t\t</fn:match>\n\t\t</b:paginator-container>\n\t</b:draggable>\n</div>\n',"app/feast-tpl!ui-block/letter-list/letter-list.html")});define("feast-tpl!ui-block/letter-list/letter-list.html",["feast-tpl!app/feast-tpl!ui-block/letter-list/letter-list.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/headless-counter",["require","exports","@mail/xray","default-values"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.sendHeadCheckRadar=void 0;a=__importDefault(a);function c(c){if(!b.HEADLESS_COUNTER){return}try{if(!document.head||!document.body){a.default.send("headless_counter",{rlog:"octavius_headless_log",rlog_message:{id:c,body:!!document.body,head:!!document.head}})}}catch(b){a.default.send("headless_counter_error",{rlog:"octavius_headless_log",rlog_message:{id:c,error:b}})}}exports.sendHeadCheckRadar=c});define("mediator/letters-loader/vars",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LettersLoaderEvents=void 0;var a;(function(a){a["onBottom"]="scroll:onbottom";a["loadMore"]="lettersloader:loadmore"})(a=exports.LettersLoaderEvents||(exports.LettersLoaderEvents={}))});define("ui-react/containers/DatasetLetters/DatasetLetters",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=null});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/letter-list/letter-list",["require","exports","cfg","data-source/utils/paginator","default-values","feast","feast-tpl!./letter-list.html","helpers/headless-counter","helpers/new-letter-list","mediator/letters-loader/vars","ui-block/dataset-letters/dataset-letters","ui-block/react-async/react-async","ui-block/scrollable/scrollable","ui-react/containers/DatasetLetters/DatasetLetters"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);d=__importDefault(d);e=__importDefault(e);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);exports.default=d.default.Block.extend({name:"letter-list",template:e.default,component:l.default,events:{preparedragelement:"onPrepareDragElement","paginator:up":"onPaginatorUp"},blocks:{scrollable:k.default,"dataset-letters":i.default,"react-async":j.default},defaults:{models:[],"nav-up-enabled":c.ENABLE_NAV_UP,"qa-enabled":a.default.get("qa")},constructor:function(){d.default.Block.apply(this,arguments);this.onScrollToBottom=this.onScrollToBottom.bind(this);this.onScroll=this.onScroll.bind(this);this.onPrepareDragElement=this.onPrepareDragElement.bind(this);this.onPaginatorUp=this.onPaginatorUp.bind(this);(0,f.sendHeadCheckRadar)("letter-list-constructor")},didMount:function(){(0,f.sendHeadCheckRadar)("letter-list-mount")},didUnmount:function(){},useNewLetterList:function(){return(0,g.isNewLetterListEnabled)(this.get("compact"))},onScrollToBottom:function(a){this.broadcast(h.LettersLoaderEvents.loadMore,a)},onScroll:function(a){var b=a.scrollTop>0;if(this.get("nav-up")!==b){this.set("nav-up",b)}},onPaginatorUp:function(){var a,b;(b=(a=this.ids.reactList)===null||a===void 0?void 0:a.getComponent())===null||b===void 0?void 0:b.scrollToTop()},onPrepareDragElement:function(a){var b,c;(c=(b=this.ids.reactList)===null||b===void 0?void 0:b.getComponent())===null||c===void 0?void 0:c.onPrepareDragElement(a)},isScrollableSilent:function(){var a=this.get("router");return(0,b.isPaginatorGlobalEnabled)(a)&&!this.get("route").is("#search #search-letter")},isTouchDevice:function(){return c.TOUCH_MODE}})});define("feast-tpl!app/feast-tpl!ui-block/list-nested/list-nested.html",["feast"],function(a){return a.smartParse('<div qa:id="list-nested">\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']"/>\n\t<bem:mod name="expanded" test="attrs.expanded"/>\n\t<bem:mod name="touch" test="attrs.touch"/>\n\n\t<div bem:elem="content" ref="block"></div>\n</div>\n',"app/feast-tpl!ui-block/list-nested/list-nested.html")});define("feast-tpl!ui-block/list-nested/list-nested.html",["feast-tpl!app/feast-tpl!ui-block/list-nested/list-nested.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/list-nested-category-feedback/list-nested-category-feedback.html",["feast"],function(a){return a.smartParse('<div qa:id="list-nested-moveto-folder">\n\t<b:list ref="list">\n\t\t<div/>\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/list-nested-category-feedback/list-nested-category-feedback.html")});define("feast-tpl!ui-block/list-nested-category-feedback/list-nested-category-feedback.html",["feast-tpl!app/feast-tpl!ui-block/list-nested-category-feedback/list-nested-category-feedback.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("filters/Filter",["require","exports","utils/util","RPC","RPCModel"],function(require,exports,a,b,c){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=c.default.extend({className:"filters.Filter",findUrl:"filters",addSeveralUrl:"filters/add",changeOrderUrl:"/cgi-bin/settings/ajax_filters_order?func_name=move",switchEnabledUrl:"/cgi-bin/settings/ajax_settings?ajax_call=1&func_name=switch_filter",confirmForwardUrl:"/cgi-bin/settings/ajax_settings?ajax_call=1&func_name=confirm_filter_email",resendConfirmUrl:"/cgi-bin/settings/ajax_settings?ajax_call=1&func_name=confirm_filter_email_resend",editUrl:"filters/edit",removeUrl:"filters/remove",searchUrl:"filters/search",messagesMatchUrl:"filters/messages/match",defaults:{id:null,enabled:true,applyToSpam:false,continue:false,conditionsOr:false,isAutoFilter:false,isForAlias:false,maillistId:0,conditions:[],actions:{remove:false,move:0,read:false,flag:false,forward:[],notify:[],reply:"",reject:false,replace_category:null},apply_folders:[]},isShareGive:function(){return this.get("share")==="give"},isShareTake:function(){return this.get("share")==="take"},isOwn:function(){return!this.isShareTake()},checkGrant:function(a){var b;var c=this.get("owner");if(!c){return true}return Boolean((b=c.filters_grants)===null||b===void 0?void 0:b[a])},isOwner:function(a){var b=this.get("owner");return b&&b.email===a},isAuthor:function(a){var b=this.get("author");return b&&b.email===a},isForward:function(){var a,b;var c=this.get("actions");return!!((a=c===null||c===void 0?void 0:c.forward)===null||a===void 0?void 0:a.length)&&!c.reply&&!c.remove&&!c.flag&&!c.read&&!c.reject&&+c.move===0&&((b=this.get("conditions"))===null||b===void 0?void 0:b.length)===0&&this.get("continue")},isEditable:function(a){var b,c,e,f,g,h,i;if(a===void 0){a={}}var j=a.email;var k=true;if(this.isShareTake()){k=this.checkGrant(d.SHARE_GRANTS.edit_filter);if(j&&this.isAuthor(j)){k=this.checkGrant(d.SHARE_GRANTS.add_filter)}if(((c=(b=this.get("actions"))===null||b===void 0?void 0:b.forward)===null||c===void 0?void 0:c.length)||((f=(e=this.get("actions"))===null||e===void 0?void 0:e.notify)===null||f===void 0?void 0:f.length)||((g=this.get("actions"))===null||g===void 0?void 0:g.reply)||((h=this.get("actions"))===null||h===void 0?void 0:h.reject)||((i=this.get("actions"))===null||i===void 0?void 0:i.remove)){k=false}}return k},isRemovable:function(a){if(a===void 0){a={}}var b=a.email;var c=true;if(this.isShareTake()){c=this.checkGrant(d.SHARE_GRANTS.remove_filter);if(b&&this.isAuthor(b)){c=this.checkGrant(d.SHARE_GRANTS.add_filter)}}return c}});d.fetchMessagesMatch=function(a){return b.default.call(d.url("messagesMatch"),a)};a.default.extend(d,{SHARE_TAKE:"take",SHARE_GIVE:"give",SHARE_GRANTS:{add_filter:"add_filter",edit_filter:"edit_filter",remove_filter:"remove_filter"}});d.version="1.0.0";exports.default=d;return d});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("filters/actions/SaveSeveral",["require","exports","RPC","Action","filters/Filter"],function(require,exports,a,b,c){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=b.default.extend({prepare:function(a){return this._removeEmptyParams(a)},_removeEmptyParams:function(a){a.filters.forEach(function(a){if(a.actions.notify&&!a.actions.notify.length){delete a.actions.notify}if(a.actions.replace_category===null){delete a.actions.replace_category}});return a},operation:function(b){return a.default.call(c.default.url("addSeveral"),b).then(function(a){return d.processResult(b,a)})}});d.processResult=function(a,b){return c.default.map(a.filters.map(function(a,c){a.id=b.get("body."+c);a.apply_folders=b.get("data.apply_folders");return a}))};b.default.register("filters.SaveSeveral",d);d.version="0.1.0";exports.default=d;return d});define("mail/actions/CategoryChange",function(require){"use strict";var a=require("Action");var b=require("RPC");var c=require("mail/Folder");var d=require("mail/Message");const e=new Set(["official","news","newsletter","social","promotions","receipts","school","games"]);var f=function(a){return e.has(a)};var g=function(a){switch(a){case"official":return c.OFFICIAL;case"news":return c.NEWS;case"newsletter":return c.NEWSLETTERS;case"social":return c.SOCIAL;case"promotions":return c.PROMOTIONS;case"school":return c.SCHOOL;case"games":return c.GAMES;case"receipts":return c.RECEIPTS}};var h=a.extend({prepare:function(a){this._models={};var b={ids:a.ids,drop_category:a.drop_category||false,add_filter:a.add_filter||false};if(a.category){b.category=a.category}if(a.folder_password){b.folder_password=a.folder_password}if(a.ids&&Array.isArray(a.ids)){a.ids.forEach(function(a){var b=d.all.get(a);if(!b){return}this._models[a]=b}.bind(this))}return b},_validate:function(a){var b={};if(!a.ids){b.ids="required"}if(!a.category&&!a.drop_category){b.category="required"}if(a.category&&a.drop_category){b.drop_category="redundant"}if(Object.keys(b).length){return b}return null},operation:function(d){var e=this._validate(d);if(e){return Promise.reject(e)}return b.post("messages/services/category/change",d).then(function(a){var b=a.get("body");if(Array.isArray(b)){b.forEach(function(a){var b=this._models[a];if(b){var e=d.category;var h=b.getFolder();var i;var j;if(d.drop_category){j=null;i=h.isMetathread()?c.INBOX:h.get("id")}else if(f(e)){j=null;i=g(e)}else{j=e;i=h.isMetathread()?c.INBOX:h.get("id")}b.set({transaction_category:j,folder:i})}}.bind(this))}return a}.bind(this)).catch(function(b){if(b.get("status")===449){var e=b.get("body.auth.folder_password.id");if(e){return c.findOne(e).then(function(b){return a.waitFor("folderSecure",[b]).then(function(){return this.operation(d)}.bind(this))}.bind(this))}}return Promise.reject(b)}.bind(this))}});a.register("mail.CategoryChange",h);h.isMetathreadCategory=f;h.getMetathreadFolder=g;h.version="0.1.0";return h});define("ui-block/list-nested-category-feedback/list-nested-category-feedback",["exports","@mail/features","default-values","Emitter","feast","feast-tpl!./list-nested-category-feedback.html","filters/actions/SaveSeveral","mail/actions/CategoryChange","service/getModule","service/notify","service/radars/index"],function(exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var k=t(a);var l=t(c);var m=t(d);var n=t(e);var o=t(f);var p=t(g);var q=t(h);var r=t(i);var s=t(j);function t(a){return a&&a.__esModule?a:{default:a}}exports.default=m.default.Block.extend({name:"list-nested-category-feedback",template:n.default,events:{},defaults:{html:"",model:null,folders:null},didUnmount:function a(){this.unrenderUI()},attrChanged:{model:function a(b,c){if(this.ui&&b===c){this.update()}else{this.renderUI()}},metathreads:function a(){if(this.ui){this.update()}},"dark-mode":function a(){if(this.ui){this.update()}}},update:function a(){this.ui.injectDependencies(this.getParams());this.ui.render()},renderUI:function a(){var b=this;this.unrenderUI();(0,q.default)("category.feedback").then(function(a){b.ui=new a.CategoryFeedback(b.refs.list,{model:b.get("model"),listMode:true,externalTooltip:b.createFilterNotify});b.ui.injectDependencies(b.getParams());b.ui.render();b.broadcast("resize",null,null,true)})},unrenderUI:function a(){this.ui&&this.ui.destroy();this.ui=null},getParams:function a(){return{CategoryChange:p.default,SaveSeveral:o.default,isOctavius:true,isDarkMode:this.is("dark-mode"),features:k.default,bridge:this.getBridge(),metathreads:this.is("metathreads")}},createFilterNotify:function a(c){var d=c.header,e=c.text,f=c.action;return new Promise(function(a,c){var g=r.default.add({text:d+". "+e,actions:[{text:f}],qa:"create-filter-notify",duration:b.CATEGORY_FEEDBACK_SUBMENU_NOTIFY_DURATION,inline:false});if(!g){c();return}g.on("action",function(){a();g.close()});g.on("closed",c)})},getBridge:function a(){if(!this._bridge){this._bridge=new l.default;this._bridge.on("radar",function(a){var b=a.chain;(0,s.default)(["submenu"].concat(b))})}return this._bridge}})});define("feast-tpl!app/feast-tpl!ui-block/list-nested-moveto-folder/list-nested-moveto-folder.html",["feast"],function(a){return a.smartParse('<div qa:id="list-nested-moveto-folder">\n\t<fn:var name="model" value="{attrs.model}" />\n\t<fn:var name="lettersFoldersIds" value="{attrs.lettersFoldersIds}" />\n\t<fn:var name="folder" value="{model && model.getFolder()}"/>\n\t<fn:var name="folders" value="{attrs.folders}" />\n\t<fn:var name="icomap" value="{_this.folder2icoMap}"/>\n\n\t<b:list>\n\t\t<fn:if test="_this.showMyFoldersContainer()">\n\t\t\t<b:list-item\n\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\tqa:id="{_this.getMyFoldersContainerId()}"\n\t\t\t\tkey="{_this.getMyFoldersContainerId()}"\n\t\t\t>\n\t\t\t\t<bem:mod name="child-level" value="0"/>\n\t\t\t\t<bem:mod name="disabled"/>\n\n\t\t\t\t<fn:attr name="title" value="{_this.getMyFoldersContainerName()}"/>\n\n\t\t\t\t<div bem:elem="avatar" qa:id="avatar">\n\t\t\t\t\t<b:avatar\n\t\t\t\t\t\tsrc="{_this.getMyFoldersContainerAvatar()}"\n\t\t\t\t\t\tsize="xs"/>\n\t\t\t\t</div>\n\n\t\t\t\t\x3c!-- Название папки --\x3e\n\t\t\t\t<div bem:elem="text">\n\t\t\t\t\t<div bem:elem="text-txt">\n\t\t\t\t\t\t<fn:value>_this.getMyFoldersContainerName()</fn:value>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\n\n\t\t<fn:for data="folders" as="f" key="idx">\n\t\t\t<fn:var name="showFolder" value="{_this.showFolder(f)}"/>\n\n\t\t\t<fn:if test="showFolder">\n\n\t\t\t\t<fn:var name="id" value="{f.get(\'id\')}"/>\n\n\t\t\t\t<b:list-item\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tqa:id="{f.get(\'id\')}"\n\n\t\t\t\t\tremit:click="move"\n\t\t\t\t\tevent:details="{\'model\': attrs.model, \'id\': id, \'selection\': attrs.selection, \'parentThread\': attrs.parentThread}"\n\n\t\t\t\t\tkey="{id}"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="child-level" value="{_this.getLimitedFolderLevel(f)}"/>\n\t\t\t\t\t<bem:mod name="disabled" test="_this.isDisabled(f)"/>\n\n\t\t\t\t\t<fn:attr name="title" value="{f.get(\'name\')}"/>\n\n\t\t\t\t\t<fn:var name="isSharedVirtualDir" value="{f.isShareTake() && f.isRoot()}"/>\n\n\t\t\t\t\t<fn:if test="isSharedVirtualDir">\n\t\t\t\t\t\t<div bem:elem="avatar" qa:id="avatar">\n\t\t\t\t\t\t\t<b:avatar\n\t\t\t\t\t\t\t\tsrc="{_this.getSharedTakeDirAvatar(f)}"\n\t\t\t\t\t\t\t\tsize="xs"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="!isSharedVirtualDir">\n\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t<fn:var name="ico" value="{_this.getFolderIco(f)}"/>\n\n\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\tname="{ico}"\n\t\t\t\t\t\t\t\tmod="{ico}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</fn:if>\n\n\n\t\t\t\t\t\x3c!-- Название папки --\x3e\n\t\t\t\t\t<div bem:elem="text">\n\t\t\t\t\t\t<bem:mod name="ico" test="f.get(\'security\')"/>\n\n\t\t\t\t\t\t<div bem:elem="text-txt">\n\t\t\t\t\t\t\t<fn:value>f.get(\'name\')</fn:value>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<fn:if test="f.get(\'security\')">\n\t\t\t\t\t\t\t<div bem:elem="text-ico">\n\t\t\t\t\t\t\t\t\x3c!-- Замок если папка запаролена --\x3e\n\t\t\t\t\t\t\t\t<fn:if test="!f.get(\'open\')">\n\t\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\t\tname="{icomap[\'lock-on_fill\']}"\n\t\t\t\t\t\t\t\t\t\tmod="{icomap[\'lock-on_fill\']}"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t\x3c!-- Замок если папка распаролена --\x3e\n\t\t\t\t\t\t\t\t<fn:if test="f.get(\'open\')">\n\t\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\t\tname="{icomap[\'lock-off_fill\']}"\n\t\t\t\t\t\t\t\t\t\tmod="{icomap[\'lock-off_fill\']}"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t<fn:if test="f.isSharedGive()">\n\t\t\t\t\t\t\t<div bem:elem="text-ico">\n\t\t\t\t\t\t\t\t\x3c!-- Значок расшаренной папки --\x3e\n\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\tname="{icomap[\'shared\']}"\n\t\t\t\t\t\t\t\t\tmod="{icomap[\'shared\']}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</div>\n\t\t\t\t</b:list-item>\n\t\t\t</fn:if>\n\t\t</fn:for>\n\n\t\t\x3c!-- Кнопка "Новая папка" --\x3e\n\t\t<fn:if test="attrs[\'allow-new-folder\']">\n\t\t\t<div bem:elem="hr"/>\n\n\t\t\t<b:list-item\n\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\tqa:id="new-folder-btn"\n\t\t\t\tremit:click="add"\n\t\t\t\tevent:details="{model: {moveLetters: true, letterCurrentFolder: _this.getMessagesFolders()[0]}}"\n\t\t\t>\n\t\t\t\t<bem:mod name="disabled" test="_this.disableCreateFolder()"/>\n\n\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t<b:ico name="{attrs.ponymode ? \'actions:add\' : \'actions:add_big\'}"/>\n\t\t\t\t</span>\n\n\t\t\t\t\x3c!-- Текст кнопки --\x3e\n\t\t\t\t<div bem:elem="text">\n\t\t\t\t\t<div bem:elem="text-txt">\n\t\t\t\t\t\t<fn:value>i18n(\'Новая папка\')</fn:value>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</b:list-item>\n\t\t</fn:if>\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/list-nested-moveto-folder/list-nested-moveto-folder.html")});define("feast-tpl!ui-block/list-nested-moveto-folder/list-nested-moveto-folder.html",["feast-tpl!app/feast-tpl!ui-block/list-nested-moveto-folder/list-nested-moveto-folder.html"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-nested-moveto-folder/list-nested-moveto-folder",["require","exports","default-values","feast","feast-tpl!./list-nested-moveto-folder.html","helpers/folder-to-ico-map","helpers/get-avatar-path","mail/Folder","service/auth"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importStar(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.default=b.default.Block.extend({name:"list-nested-moveto-folder",template:c.default,events:{},defaults:{model:null,folders:null,selection:false,"allow-new-folder":false,"allow-move":true},folder2icoMap:d.default,getFolderIco:d.getFolderIco,hasSharedFolders:false,attrChanged:{models:function(){var a=this.get("folders");this.hasSharedFolders=f.default.all.hasSharedTake.call(a)}},didMount:function(){var a=this;if(this.is("allow-move")){require(["mediator/letters-actions"],function(b){var c=b.default;c.register(a)})}},getMessagesFolders:function(){var a=this.get("model");if(a&&!Array.isArray(a)){var b=a.get("folder");if(a.get("flags.metathread")){b=a.get("metathread_data.folder")}return[f.default.get(b)]}var c=this.get("lettersFoldersIds");return c.map(function(a){return f.default.get(a)})},showFolder:function(a){var b=this.getMessagesFolders()[0];if(b===null||b===void 0?void 0:b.isShareTake()){if(!a.isShareTake()){return false}if(a.get("owner").email!==b.get("owner").email){return false}return true}if(a.isShareTake()){return false}return true},isDisabled:function(a){var b=this;if(a.isShareTake()&&a.isRoot()){return true}if(!a.checkGrant(f.default.SHARE_GRANTS.move)){return true}var c=this.getMessagesFolders();return c.some(function(c){if(a.isSpam()&&(!c.checkGrant(f.default.SHARE_GRANTS.move_to_spam)||b.get("selectedMetathreads"))){return true}if(a.isArchive()&&!c.checkGrant(f.default.SHARE_GRANTS.move_to_archive)){return true}if(a.isTrashLike()&&!c.checkGrant(f.default.SHARE_GRANTS.remove)){return true}return a.id==c.id})},getFolderLevel:function(a){if(!this.hasSharedFolders){return a.getChildLevel()}if(this.isMyFoldersContainer(a)){return 0}if(a.isShareTake()){return a.getChildLevel()}return a.getChildLevel()+1},getLimitedFolderLevel:function(b){var c=this.getFolderLevel(b);return Math.min(a.FOLDER_MAX_CHILD_LEVEL_UI,c)},getAvatar:function(a,b){return(0,e.default)({email:a,name:b,size:45})},getMyFoldersContainerAvatar:function(){var a=g.default.user;var b=a.getEmail();var c=a.get("nick");if(!b||!c){return null}return this.getAvatar(b,c)},getSharedTakeDirAvatar:function(a){var b=a.get("owner");var c=b.email;var d=b.name;if(!c||!d){return null}return this.getAvatar(c,d)},showMyFoldersContainer:function(){var a=this.getMessagesFolders()[0];return this.hasSharedFolders&&!(a===null||a===void 0?void 0:a.isShareTake())},isMyFoldersContainer:function(a){var b=a.get("id");return this.getMyFoldersContainerId()===b},getMyFoldersContainerId:function(){return a.NAV_MY_FOLDERS_CONTAINER_ID},getMyFoldersContainerName:function(){return i18n("Мои папки")},disableCreateFolder:function(){var a=this.getMessagesFolders()[0];if(!a.isShareTake()){return false}return f.default.all.toArray().filter(function(b){var c,d;return((c=a.get("owner"))===null||c===void 0?void 0:c.email)===((d=b.get("owner"))===null||d===void 0?void 0:d.email)}).every(function(a){return!(a.canAddSubfolder()&&a.checkGrant(f.default.SHARE_GRANTS.move))})}})});define("feast-tpl!app/feast-tpl!ui-block/list-nested-sorting/list-nested-sorting.html",["feast"],function(a){return a.smartParse('<div qa:id="list-nested-sorting">\n\t<fn:var name="sortings" value="{_this.sortings}" />\n\t<fn:var name="touch" value="{attrs.touch}" />\n\t<fn:var name="ponyMode" value="{attrs.ponymode}" />\n\n\t<bem:mod name="touch" test="touch" />\n\t<bem:mod name="pony-mode" test="ponyMode" />\n\n\t<fn:match name="item" args="item, key, isSelected, text, touch">\n\t\t<fn:var name="type" value="{item.type}" />\n\t\t<b:list-item\n\t\t\ttouch="{touch}"\n\t\t\tdisabled="{isDisabled}"\n\t\t\tmarkable\n\t\t\tmarked="{isSelected}"\n\t\t\tqa:id="{type}"\n\t\t\tkey="{key}"\n\t\t\tremit:click="item-click"\n\t\t\tevent:details="item"\n\t\t>\n\t\t\t<span bem:elem="text"> {text} </span>\n\t\t</b:list-item>\n\t</fn:match>\n\n\t<b:list\n\t\ttouch="{touch}"\n\t\tqa:id="sortings-dropdown"\n\t\tremit:item-click="list:item-click"\n\t>\n\t\t<fn:for data="sortings" as="item">\n\t\t\t<fn:var name="key" value="{item.text}" />\n\t\t\t<fn:var name="text" value="{item.text}" />\n\t\t\t<fn:var name="isSelected" value="{attrs.sortingType === item.type}" />\n\t\t\t<fn:apply-match name="item" args="item, key, isSelected, text, touch" />\n\t\t</fn:for>\n\t</b:list>\n</div>\n',"app/feast-tpl!ui-block/list-nested-sorting/list-nested-sorting.html")});define("feast-tpl!ui-block/list-nested-sorting/list-nested-sorting.html",["feast-tpl!app/feast-tpl!ui-block/list-nested-sorting/list-nested-sorting.html"],function(a){return a});define("ui-block/list-nested-sorting/sorting",["require","exports"],function(require,exports){"use strict";var a,b;Object.defineProperty(exports,"__esModule",{value:true});exports.LetterSortings=exports.SortingTextForControl=exports.SortingText=exports.isDefaultSorting=exports.SortingType=void 0;exports.SortingType={dateDesc:"D",dateAsc:"d",fromAsc:"f",fromDesc:"F",subjectAsc:"s",subjectDesc:"S"};var c=function(a){return a===exports.SortingType.dateDesc};exports.isDefaultSorting=c;exports.SortingText=(a={},a[exports.SortingType.dateDesc]=i18n("Сначала новые"),a[exports.SortingType.dateAsc]=i18n("Сначала старые"),a[exports.SortingType.fromAsc]=i18n("Автор: от А до Я"),a[exports.SortingType.fromDesc]=i18n("Автор: от Я до А"),a[exports.SortingType.subjectAsc]=i18n("Тема: от А до Я"),a[exports.SortingType.subjectDesc]=i18n("Тема: от Я до А"),a);exports.SortingTextForControl=(b={},b[exports.SortingType.dateDesc]=i18n("Сначала новые"),b[exports.SortingType.dateAsc]=i18n("Сначала старые"),b[exports.SortingType.fromAsc]=i18n("Автор: А - Я"),b[exports.SortingType.fromDesc]=i18n("Автор: Я - А"),b[exports.SortingType.subjectAsc]=i18n("Тема: А - Я"),b[exports.SortingType.subjectDesc]=i18n("Тема: Я - А"),b);function d(a){this.type=a||exports.SortingType.dateDesc;this.text=exports.SortingText[this.type];this.controlText=exports.SortingTextForControl[this.type]}exports.default=d;exports.LetterSortings=[new d(exports.SortingType.dateDesc),new d(exports.SortingType.dateAsc),new d(exports.SortingType.fromAsc),new d(exports.SortingType.fromDesc),new d(exports.SortingType.subjectAsc),new d(exports.SortingType.subjectDesc)]});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/list-nested-sorting/list-nested-sorting",["require","exports","feast","feast-tpl!./list-nested-sorting.html","service/radars/decorator","ui-block/list/list","ui-block/list-item/list-item","ui-block/list-nested/list-nested","./sorting"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);exports.default=a.default.Block.extend((0,c.default)({id:"filter",explicit:true})({name:"list-nested-sorting",template:b.default,events:{"list:item-click":"onSortingClick"},blocks:{list:d.default,"list-nested":f.default,"list-item":e.default},defaults:{sortingType:"D"},sortings:g.LetterSortings,onSortingClick:function(a){var b=a.details;var c="sorting_".concat(b.type,"_click");this.radar(c);this.broadcast("sortingclick",b.type)},didMount:function(){var a=this;require(["mediator/filter-manager"],function(b){var c=b.default;c.register(a)})}}))});define("ui-block/list-nested/list-nested",["exports","feast","feast-tpl!./list-nested.html","helpers/browser","ui-block/list-nested-category-feedback/list-nested-category-feedback","ui-block/list-nested-moveto-folder/list-nested-moveto-folder","ui-block/list-nested-sorting/list-nested-sorting"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=m(a);var h=m(b);var i=m(c);var j=m(d);var k=m(e);var l=m(f);function m(a){return a&&a.__esModule?a:{default:a}}var n={"moveto-folder":k.default,"category-feedback":j.default,sorting:l.default};exports.default=g.default.Block.extend({name:"list-nested",template:h.default,events:{resize:"onContentResize"},defaults:{expanded:false,"hover-support":i.default.capabilities["hover-support"]},setCoordinates:function a(b){var c=b.el.getBoundingClientRect();var d=this.refs.block;var e=4;var f=window.innerWidth;var g=window.innerHeight;var h=d.offsetWidth;var i=d.offsetHeight;var j=f-c.right>h;var k=!j;var l=g-c.top>i;var m=void 0;var n=void 0;var o=void 0;var p=c.top-2*e;if(j){m=c.right}if(k){m=c.left-h}if(l){o="none"}if(!l){n=i-(g-c.top);o=i-n+"px"}d.style.left=m+"px";d.style.top=p+"px";d.style["max-height"]=""+o},onContentResize:function a(){this.setCoordinates(this.control)},setSubmenu:function a(b,c,d){var e=n[b];if(!e||!d){return}this.destroyBlock();var f=new e(Object.assign({},c,{router:this.get("router")}));this.block=f;this.control=d;f.renderTo(this.refs.block);this.setCoordinates(d);this.show();return f},show:function a(){if(!this.block||!this.control){return}this.block.onShow&&this.block.onShow();this.control.onSubmenuShow&&this.control.onSubmenuShow();this.set("expanded",true)},hide:function a(){if(!this.block||!this.control){return}this.block.onHide&&this.block.onHide();this.control.onSubmenuHide&&this.control.onSubmenuHide();this.set("expanded",false)},destroyBlock:function a(){if(!this.block||!this.control){return}this.block.onDestroy&&this.block.onDestroy();this.control.onDestroy&&this.control.onDestroy();this.block=null;this.refs.block.innerHTML="";this.refs.block.removeAttribute("style")}})});define("feast-tpl!app/feast-tpl!ui-block/mobile-sidebar/mobile-sidebar.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:match name="sidebar-content">\n\t\t<b:nav-folders\n\t\t\tref="navFolders"\n\t\t\tuse:mediator="letters-actions folders-actions user-info letters-loader pony-mode folders-navigation"\n\t\t\tremit:folderclick="folder:click"\n\t\t\tactive="{attrs[\'folder-active\']}"\n\t\t\thandle-drop\n\t\t\tmodels="{attrs.models}"\n\t\t\trouter="{attrs.router}"\n\t\t\tsidebar\n\t\t\twith-clear\n\t\t/>\n\n\t\t<div bem:elem="divider" />\n\n\t\t<div bem:elem="footer" qa:id="mobile-sidebar-footer">\n\t\t\t<fn:if test="!attrs[\'hide-settings-button\']">\n\t\t\t\t<b:button2\n\t\t\t\t\tqa:id="settings-button"\n\t\t\t\t\tico="navigation:settings"\n\t\t\t\t\tremit:click="settings:click"\n\t\t\t\t\ttext="Настройки"\n\t\t\t\t\tfluid\n\t\t\t\t\tpure\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t\t<b:button2\n\t\t\t\tqa:id="contacts-button"\n\t\t\t\tico="categories:addressbook_webview"\n\t\t\t\tremit:click="contacts:open"\n\t\t\t\ttext="Контакты"\n\t\t\t\tfluid\n\t\t\t\tpure\n\t\t\t/>\n\t\t\t<fn:if test="attrs.showUnsubscribeButton">\n\t\t\t\t<b:react-async\n\t\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\t\tcomponent="SidebarUnsubscribeButton"\n\t\t\t\t\tponyMode\n\t\t\t\t\tmobile\n\t\t\t\t\tshowTitle\n\t\t\t\t/>\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="attrs[\'show-reload-button\']">\n\t\t\t\t<b:button2\n\t\t\t\t\tqa:id="reload-button"\n\t\t\t\t\tico="actions:postpone_alt"\n\t\t\t\t\tremit:click="reload:click"\n\t\t\t\t\ttext="Обновить страницу"\n\t\t\t\t\tfluid\n\t\t\t\t\tpure\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:match>\n\n\t<fn:if test="_this.isOpen()" animated>\n\t\t<div bem:elem="wrapper" remit:click="mobilesidebar:close">\n\t\t\t<div bem:elem="content" qa:id="mobile-sidebar" remit:click.prevent.stop>\n\t\t\t\t<bem:mod name="open" test="attrs.open" />\n\n\t\t\t\t<div bem:elem="header">\n\t\t\t\t\t<b:button2\n\t\t\t\t\t\tqa:id="close"\n\t\t\t\t\t\tico="navigation:arrow_list_previous"\n\t\t\t\t\t\tremit:click="mobilesidebar:close"\n\t\t\t\t\t\ttext="Свернуть"\n\t\t\t\t\t\tpure\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<b:scrollable\n\t\t\t\t\tid="scrollShort"\n\t\t\t\t\tref="scrollShort"\n\t\t\t\t\tscroll-style="{attrs[\'short-scroll-style\']}"\n\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\tdisable-horizontal-scroll\n\t\t\t\t>\n\t\t\t\t\t<fn:apply-match name="sidebar-content" />\n\t\t\t\t</b:scrollable>\n\t\t\t</div>\n\t\t</div>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/mobile-sidebar/mobile-sidebar.html")});define("feast-tpl!ui-block/mobile-sidebar/mobile-sidebar.html",["feast-tpl!app/feast-tpl!ui-block/mobile-sidebar/mobile-sidebar.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/mobile-sidebar/mobile-sidebar",["require","exports","default-values","feast","feast-tpl!./mobile-sidebar.html","helpers/opener","ui-block/button2/button2","ui-block/nav-folders/nav-folders","ui-block/scrollable/scrollable"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.default=b.default.Block.extend({name:"mobile-sidebar",template:c.default,blocks:{"nav-folders":f.default,button2:e.default,scrollable:g.default},events:{"folder:click":"onFolderClick","reload:click":"onReloadClick","contacts:open":"onContactsClick"},defaults:{open:false,"folder-active":undefined,"hide-settings-button":a.HIDE_SETTINGS_BUTTON,"show-reload-button":a.SHOW_RELOAD_BUTTON,showUnsubscribeButton:a.SHOW_SIDEBAR_UNSUBSCRIBE_BUTTON_MOBILE},attrChanged:{"folder-active":function(){this.broadcast("mobilesidebar:close")}},onFolderClick:function(a){var b=a.details.id;if(b==this.get("folder-active")){this.broadcast("mobilesidebar:close")}},onReloadClick:function(){location.reload()},onContactsClick:function(){(0,d.default)(a.MOBILE_ADDRESSBOOK_URL)},isOpen:function(){return this.is("open")}})});define("feast-tpl!app/feast-tpl!ui-block/panel-with-selected/panel-with-selected.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="active" test="attrs.selected.length" />\n\t<bem:mod name="one" test="attrs.selected.length == 1" />\n\t<bem:mod name="two" test="attrs.selected.length == 2" />\n\t<bem:mod name="more" test="attrs.selected.length > 2" />\n\n\t<div bem:elem="empty" fn:if="!attrs.selected.length">\n\t\t<fn:apply-match name="empty" />\n\t</div>\n\n\t<fn:if test="attrs.selected.length && attrs[\'selected-last-thread\']">\n\t\t<fn:choose>\n\t\t\t<fn:when test="attrs[\'is-metathread\']">\n\t\t\t\t<b:metathread-preview\n\t\t\t\t\tmodel="{attrs[\'selected-last-thread\']}"\n\t\t\t\t\tselectedLetterCountText="{this.getSelectedLetterCountText()}"\n\t\t\t\t/>\n\t\t\t</fn:when>\n\t\t\t<fn:otherwise>\n\t\t\t\t<b:thread\n\t\t\t\t\tfn:if="!_this.useNewThread()"\n\t\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\t\tmodel="{attrs[\'selected-last-thread\']}"\n\t\t\t\t\texpand-letter-id="{attrs[\'expand-letter-id\']}"\n\t\t\t\t\tselectedLetterCountText="{this.getSelectedLetterCountText()}"\n\t\t\t\t\tpreview-mode\n\t\t\t\t/>\n\t\t\t\t<b:react-async\n\t\t\t\t\tfn:if="_this.useNewThread()"\n\t\t\t\t\tcomponent="Thread"\n\t\t\t\t\tuseMediators="{[\'themes-manager\']}"\n\t\t\t\t\tmodel="{attrs[\'selected-last-thread\']}"\n\t\t\t\t\texpand-letter-id="{attrs[\'expand-letter-id\']}"\n\t\t\t\t\tpreview-mode\n\t\t\t\t/>\n\t\t\t\t<fn:if test="!attrs[\'dark-mode\']">\n\t\t\t\t\t<div bem:elem="gradient"></div>\n\t\t\t\t</fn:if>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/panel-with-selected/panel-with-selected.html")});define("feast-tpl!ui-block/panel-with-selected/panel-with-selected.html",["feast-tpl!app/feast-tpl!ui-block/panel-with-selected/panel-with-selected.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/metathread-preview/metathread-preview.html",["feast"],function(a){return a.smartParse('<div qa:id="metathread-preview">\n\t<fn:var name="message" value="{attrs.model}" />\n\t<fn:var name="ponymode" value="{attrs.ponymode}"/>\n\n\t<fn:var name="metathreadData" value="{_this.getMetathreadData()}"/>\n\t<fn:var name="title" value="{metathreadData.folder_name}"/>\n\t<fn:var name="type" value="{metathreadData.category}"/>\n\t<fn:var name="unread" value="{metathreadData.flags.unread}"/>\n\n\t<div\n\t\tbem:elem="selected-count"\n\t\tfn:if="attrs.selectedLetterCountText"\n\t>\n\t\t<b:badge text="{attrs.selectedLetterCountText}" size="l"/>\n\t</div>\n\n\t<div bem:elem="header">\n\t\t<div bem:elem="avatar" qa:id="metathread-avatar">\n\t\t\t<b:metathread-avatar\n\t\t\t\tindent="{ponymode ? \'right\' : false}"\n\t\t\t\tmodel="{message}"\n\t\t\t\tsize="common"\n\t\t\t\tdisable-select\n\t\t\t\tdisable-hover\n\t\t\t\ttype="{type}"\n\t\t\t/>\n\t\t</div>\n\n\t\t<div bem:elem="title" qa:id="metathread-title">\n\t\t\t<b:metathread-title\n\t\t\t\ttitle="{title}"\n\t\t\t\ttype="{type}"\n\t\t\t\tunread="{unread}"\n\t\t\t\tpony-mode="{ponymode}"\n\t\t\t/>\n\t\t</div>\n\t</div>\n\n\t<div bem:elem="snippet">\n\t\t<fn:choose>\n\t\t\t<fn:when test="message.isToMyself()">\n\t\t\t\t<b:metathread-snippet-tomyself senders="{metathreadData.last_senders}" preview />\n\t\t\t</fn:when>\n\t\t\t<fn:otherwise>\n\t\t\t\t<b:metathread-snippet senders="{metathreadData.last_senders}" />\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/metathread-preview/metathread-preview.html")});define("feast-tpl!ui-block/metathread-preview/metathread-preview.html",["feast-tpl!app/feast-tpl!ui-block/metathread-preview/metathread-preview.html"],function(a){return a});define("ui-block/metathread-preview/metathread-preview",["exports","feast","feast-tpl!./metathread-preview.html","ui-block/badge/badge","ui-block/metathread-avatar/metathread-avatar","ui-block/metathread-snippet/metathread-snippet","ui-block/metathread-snippet-tomyself/metathread-snippet-tomyself","ui-block/metathread-title/metathread-title"],function(exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var h=o(a);var i=o(b);var j=o(c);var k=o(d);var l=o(e);var m=o(f);var n=o(g);function o(a){return a&&a.__esModule?a:{default:a}}exports.default=h.default.Block.extend({name:"metathread-preview",template:i.default,defaults:{model:null},blocks:{"metathread-avatar":k.default,"metathread-title":n.default,"metathread-snippet":l.default,"metathread-snippet-tomyself":m.default,badge:j.default},getMetathreadData:function a(){return this.get("model").get("metathread_data")}})});define("feast-tpl!app/feast-tpl!ui-block/portal-menu/portal-menu.html",["feast"],function(a){return a.smartParse('<div qa:id="portal">\n\t\x3c!-- TODO: разделить тулбар на обычный и notFound и выбирать его еще на уровне application-mail --\x3e\n\t<fn:var name="current" value="{_this.getCurrentBreakpoint()}" />\n\t<fn:var name="globals" value="{current.globals}"/>\n\t<fn:var name="selectedLettersInfo" value="{_this.getSelectedLettersIdsAndSenders(globals, _this.getAttrs())}"/>\n\t<fn:var name="selectedLettersIds" value="{selectedLettersInfo.ids}"/>\n\t<fn:var name="selectedLettersSenders" value="{selectedLettersInfo.senders}"/>\n\n\t<fn:var name="letterNotFound" value="{attrs[\'letter-not-found\']}" />\n\t<fn:var name="readMode" value="{globals.readMode}"/>\n\t<fn:var name="selectMode" value="{attrs.selectMode}"/>\n\t<fn:var name="isDisableEdit" value="{globals.isDisableEdit}" />\n\n\t<fn:var name="searchRoute" value="{attrs.route.is(\'#search #search-letter\')}"/>\n\t<fn:var name="filterRoute" value="{attrs.route.is(\'#letters #read-letter\') && attrs.route.filterQuery.has()}"/>\n\t<fn:var name="layoutType" value="{attrs.layoutType}"/>\n\t<fn:var name="ponyMode" value="{attrs.ponyMode}"/>\n\n\t<fn:var name="letterCount" value="{_this.hasLetterCount()}"/>\n\n\t<fn:var name="theme" value="portal-menu"/>\n\t<fn:var name="theme" value="{theme}_mobile" test="attrs.mobile"/>\n\n\t<fn:var name="mobile" value="{attrs.mobile}"/>\n\n\t<bem:mod name="mobile" test="mobile"/>\n\t<bem:mod name="pony-mode" test="ponyMode"/>\n\n\t<fn:add-class name="js-shortcut" test="attrs.shortcut" />\n\n\t<fn:match name="actions-list" args="layout, attrs, readMode">\n\t\t<fn:var name="letter" value="{globals.letter}" />\n\t\t<fn:var name="letterId" value="{letter && letter.id}"/>\n\n\t\t<fn:if test="readMode || selectMode">\n\t\t\t<fn:for data="current.actionsList" as="item">\n\t\t\t\t\x3c!--TODO: возможно, добавить spread в feast? --\x3e\n\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\tfn:if="!item.hasOwnProperty(\'if\') || item.if"\n\t\t\t\t\t\tkey="{item.type}"\n\t\t\t\t\t\ttype="{item.type}"\n\t\t\t\t\t\tshort="{item.short}"\n\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\ttouch-nav="{mobile}"\n\t\t\t\t\t\tdisabled="{item.disabled ? true : item.disabled !== false && isDisableEdit}"\n\t\t\t\t\t\tletter-id="{letterId}"\n\t\t\t\t\t\tletter="{letter}"\n\t\t\t\t\t\tselectedLettersIds="{selectedLettersIds}"\n\t\t\t\t\t\tselectedLettersSenders="{selectedLettersSenders}"\n\t\t\t\t\t\tradar-id="item.hasOwnProperty(\'radar-id\') ? item[\'radar-id\'] : null"\n\t\t\t\t\t\tread="{item.read}"\n\t\t\t\t\t\tunread="{item.unread}"\n\t\t\t\t\t\tflag="{item.flag}"\n\t\t\t\t\t\tunflag="{item.unflag}"\n\t\t\t\t\t\tarchive="{item.archive}"\n\t\t\t\t\t\tspam="{item.spam}"\n\t\t\t\t\t\tspamAbovePrint="{item.spamAbovePrint}"\n\t\t\t\t\t\tspamDisabled="{item.spamDisabled}"\n\t\t\t\t\t\tunsubscribeAbovePrint="{item.unsubscribeAbovePrint}"\n\t\t\t\t\t\tunspam="{item.unspam}"\n\t\t\t\t\t\tsuperspam="{item.superspam}"\n\t\t\t\t\t\tforward="{item.forward}"\n\t\t\t\t\t\tfolders="{item.folders}"\n\t\t\t\t\t\tcreate-filter="{item[\'create-filter\']}"\n\t\t\t\t\t\tinvite-call="{item[\'invite-call\']}"\n\t\t\t\t\t\tcreate-event="{item[\'create-event\']}"\n\t\t\t\t\t\ttranslate="{item[\'translate\']}"\n\t\t\t\t\t\tdisable-edit="{item[\'disable-edit\']}"\n\t\t\t\t\t\treadletter="{item.readletter}"\n\t\t\t\t\t\tstore="{globals.store}"\n\t\t\t\t\t\tprint="{item.print}"\n\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t/>\n\t\t\t</fn:for>\n\t\t</fn:if>\n\t</fn:match>\n\n\n\t<fn:match name="selectall-button" args="layout,disabled">\n\t\t<fn:var name="selectedCount" value="{_this.getSelectedCount() || \'\'}" />\n\n\t\t<fn:var name="isShort" value="{_this.isShortButtonSelectAll(layout, selectedCount, attrs.filter, attrs.sortingType)}"/>\n\t\t<fn:var name="marginLeft" value="{_this.getPaddingLeft(layoutType, isShort, ponyMode)}"/>\n\n\t\t<fn:var name="paddingRight" value="{_this.getPaddingRight(layout, isShort, ponyMode)}"/>\n\n\t\t<span style="margin-left: {marginLeft}px; padding-right: {paddingRight}px;">\n\n\t\t\t<b:portal-menu-element fn:if="!attrs.deselectAll"\n\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\tdisabled="{disabled}"\n\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\ttype="select"\n\t\t\t\t\t\t\t\t\ttouch-nav="{mobile}"\n\t\t\t\t\t\t\t\t\tshort="{isShort}"\n\t\t\t\t\t\t\t\t\thas-explanation\n\t\t\t\t\t\t\t\t\ttext="{selectedCount ? selectedCount : \'\'}"/>\n\n\t\t\t<b:portal-menu-element fn:if="attrs.deselectAll"\n\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\tdisabled="{disabled}"\n\t\t\t\t\t\t\t\t\ttouch-nav="{mobile}"\n\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\ttype="deselect"\n\t\t\t\t\t\t\t\t\thas-explanation="{selectedCount}"\n\t\t\t\t\t\t\t\t\ttext="{selectedCount}"/>\n\t\t</span>\n\t</fn:match>\n\n\t<b:layout use:mediator="layout-manager" id="portal" group="main">\n\t\t<fn:match name="foot">\n\t\t\t<b:search-panel\n\t\t\t\t\tfn:if="!_this.useReactSearchPanel()"\n\t\t\t\t\tuse:mediator="search-manager layout-manager themes-manager letters-selection"\n\t\t\t\t\tstore="{attrs.store}"\n\t\t\t\t\tremit:click="search"\n\t\t\t\t\tponyMode="{ponyMode}"\n\t\t\t/>\n\t\t\t<b:react-async\n\t\t\t\t\tfn:if="_this.useReactSearchPanel()"\n\t\t\t\t\tcustomNode="{_this.usePortalSearchPanel() ? __PH.getSearchPlaceholder() : null}"\n\t\t\t\t\tcomponent="SearchPanel"\n\t\t\t\t\tuseMediators="{[\'search-manager\',\'layout-manager\',\'themes-manager\',\'letters-selection\']}"\n\t\t\t\t\tstore="{attrs.store}"\n\t\t\t\t\tremit:click="search"\n\t\t\t\t\tponyMode="{ponyMode}"\n\t\t\t/>\n\t\t</fn:match>\n\n\t\t<fn:match name="left-column" args="layout">\n\t\t\t<b:portal-menu-logo\n\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\troute="{attrs.route}"\n\t\t\t\tselectMode="{attrs.selectMode}"\n\t\t\t\treadMode="{readMode}"\n\t\t\t\tlayoutType="{layoutType}"\n\t\t\t\tponyMode="{ponyMode}"\n\t\t\t\tneedBackToParentFolder="{_this.needBackToParentFolder()}"\n\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\tfolders="{attrs.folders}"\n\t\t\t/>\n\t\t</fn:match>\n\n\t\t<fn:match name="main-frame" args="layout">\n\t\t\t<table width="100%" style="table-layout: fixed">\n\t\t\t\t<tbody>\n\t\t\t\t<tr style="display: flex; width: 100%">\n\t\t\t\t\t<fn:var name="is3Pane" value="{layout.type === \'3pane\'}"/>\n\t\t\t\t\t<fn:var name="is2Pane" value="{layout.type === \'2pane\'}"/>\n\t\t\t\t\t<fn:var name="isLeftColumnCollapsed" value="{layout[\'is-shortcut-left\']}"/>\n\n\t\t\t\t\t<fn:var name="combineFilterAndFolderName" value="{is3Pane && isLeftColumnCollapsed}"/>\n\t\t\t\t\t<fn:var name="showFolderName" value="{isLeftColumnCollapsed}"/>\n\n\t\t\t\t\t\x3c!-- Сайдбар --\x3e\n\t\t\t\t\t<fn:if\n\t\t\t\t\t\ttest="!readMode || is3Pane"\n\t\t\t\t\t>\n\t\t\t\t\t\t<td bem:elem="sidebar">\n\t\t\t\t\t\t\t<bem:mod name="nowrap"/>\n\t\t\t\t\t\t\t<bem:mod name="2pane" test="is2Pane"/>\n\t\t\t\t\t\t\t<bem:mod name="3pane" test="is3Pane"/>\n\t\t\t\t\t\t\t<bem:mod name="size-{layout[\'sidebar-column\']}"\n\t\t\t\t\t\t\t\t\t test="layout[\'sidebar-column\'] && is3Pane"/>\n\n\t\t\t\t\t\t\t\x3c!-- Мы не в режиме выделения --\x3e\n\t\t\t\t\t\t\t<fn:if test="!selectMode">\n\t\t\t\t\t\t\t\t\x3c!-- Выбрать все --\x3e\n\t\t\t\t\t\t\t\t<fn:apply-match name="selectall-button" args="layout, !letterCount"/>\n\n\t\t\t\t\t\t\t\t\x3c!-- Просто название папки когда не 3пане и левая колонка скрыта --\x3e\n\t\t\t\t\t\t\t\t<fn:if test="is2Pane && showFolderName">\n\t\t\t\t\t\t\t\t\t<div bem:elem="folder-name" qa:id="folder-name-portal">\n\t\t\t\t\t\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\t\ttype="title"\n\t\t\t\t\t\t\t\t\t\t\ttext="{attrs.folder.get(\'name\')}"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t\x3c!-- Совмещенный контрол имени папки и фильтров на 3пане, когда скрыта левая колонка --\x3e\n\t\t\t\t\t\t\t\t<fn:if test="combineFilterAndFolderName">\n\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t<b:portal-menu-element type="filters"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   folder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   combineFilterAndFolderName="{combineFilterAndFolderName}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   use:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\t<fn:if test="_this.isAllReadVisible()">\n\t\t\t\t\t\t\t\t\t\x3c!-- Отметить все прочитанным везде где не 3пане --\x3e\n\t\t\t\t\t\t\t\t\t<fn:if test="is2Pane">\n\t\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t\t<b:portal-menu-element ponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   type="all-read"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   shortText="{_this.isShortTextAllRead()}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   touch-nav="{mobile}"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   use:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t<fn:if test="is2Pane && !selectMode && _this.isRemoveAllVisible()">\n\t\t\t\t\t\t\t\t<fn:var name="selectedCount" value="{_this.getSelectedCount() || \'\'}" />\n\t\t\t\t\t\t\t\t<fn:var name="isSelectAllShort" value="{_this.isShortButtonSelectAll(layout, selectedCount, attrs.filter, attrs.sortingType)}"/>\n\t\t\t\t\t\t\t\t<fn:var name="isRemoveAllShort" value="{_this.isRemoveAllButtonShort(layout)}"/>\n\n\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t<b:portal-menu-element ponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection folders-actions"\n\t\t\t\t\t\t\t\t\t\ttype="removeAll"\n\t\t\t\t\t\t\t\t\t\ttouch-nav="{mobile}"\n\t\t\t\t\t\t\t\t\t\tstore="{globals.store}"\n\t\t\t\t\t\t\t\t\t\tshort="{isRemoveAllShort}"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\x3c!-- 3pane: фильтры без имени папки --\x3e\n\t\t\t\t\t\t\t<fn:if test="is3Pane && !selectMode && !showFolderName">\n\t\t\t\t\t\t\t\t<div bem:block="portal-menu__group" bem:mod="right" fn:if="!searchRoute">\n\t\t\t\t\t\t\t\t\t<bem:mod name="mobile" test="mobile"/>\n\t\t\t\t\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\t\t\t\t\ttype="filters"\n\t\t\t\t\t\t\t\t\t\t\tshort\n\t\t\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\x3c!-- 3pane: Кебаб с "отметить прочитанным" и "удалить все письма" --\x3e\n\t\t\t\t\t\t\t<fn:if bem:block="portal-menu__group" test="_this.needMoreLettersActions()">\n\t\t\t\t\t\t\t\t<span style="float: right">\n\t\t\t\t\t\t\t\t\t<bem:mod name="right" test="isLeftColumnCollapsed"/>\n\t\t\t\t\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\ttype="moreLettersActions"\n\t\t\t\t\t\t\t\t\t\tallRead="{_this.isAllReadVisible()}"\n\t\t\t\t\t\t\t\t\t\tremoveAll="{_this.isRemoveAllVisible()}"\n\t\t\t\t\t\t\t\t\t\tstore="{globals.store}"\n\t\t\t\t\t\t\t\t\t\tuse:mediator="folders-actions"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\t\x3c!-- Выбрать все --\x3e\n\t\t\t\t\t\t\t<fn:apply-match fn:if="selectMode" name="selectall-button" args="layout"/>\n\n\t\t\t\t\t\t\t\x3c!-- Действия с письмами --\x3e\n\t\t\t\t\t\t\t<fn:if test="is2Pane">\n\t\t\t\t\t\t\t\t<fn:var name="style" value="{\'flex: 1 1 0; -ms-flex: 1 1 0px; min-width: 0;\'}"/>\n\t\t\t\t\t\t\t\t<fn:var name="style" value="{style + \'margin-left:12px; margin-right:4px;\'}"/>\n\n\t\t\t\t\t\t\t\t<span style="{style}" ref="actions-list">\n\t\t\t\t\t\t\t\t\t<fn:apply-match name="actions-list" args="layout, attrs, readMode"/>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\x3c!-- 3pane, чтение письма --\x3e\n\t\t\t\t\t<fn:if test="readMode || is3Pane">\n\t\t\t\t\t\t\x3c!-- Инлайн стили, потому что мы в fn:match :( --\x3e\n\t\t\t\t\t\t<td bem:elem="content" style="display: -ms-flexbox; display: flex; flex: 1 1 0; -ms-flex: 1 1 0px; min-width: 0;">\n\t\t\t\t\t\t\t<div ref="actions-list" style="display: flex; align-items: center; flex: 1 1 0; -ms-flex: 1 1 0px; min-width: 0;">\n\t\t\t\t\t\t\t\t\x3c!-- Действия с письмами --\x3e\n\t\t\t\t\t\t\t\t<fn:apply-match name="actions-list" args="layout, attrs, readMode"/>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\x3c!-- Вперед / Назад --\x3e\n\t\t\t\t\t\t\t<fn:if test="readMode">\n\t\t\t\t\t\t\t\t<div bem:block="portal-menu__group">\n\t\t\t\t\t\t\t\t\t<bem:mod name="padded" test="layout.isLessThen(\'s\')"/>\n\t\t\t\t\t\t\t\t\t<fn:var name="hasPrev" value="{!!attrs.letterNeighbours.prev}"/>\n\t\t\t\t\t\t\t\t\t<fn:var name="hasNext" value="{!!attrs.letterNeighbours.next}"/>\n\n\t\t\t\t\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\t\t\t\t\ttype="prev"\n\t\t\t\t\t\t\t\t\t\t\ttouch-nav="{mobile}"\n\t\t\t\t\t\t\t\t\t\t\tletter="{attrs.letter}"\n\t\t\t\t\t\t\t\t\t\t\tis-search="{searchRoute}"\n\t\t\t\t\t\t\t\t\t\t\tis-filter="{filterRoute}"\n\t\t\t\t\t\t\t\t\t\t\tid="search_button_prev"\n\t\t\t\t\t\t\t\t\t\t\thidden="{is3Pane}"\n\t\t\t\t\t\t\t\t\t\t\tdisabled="{isDisableEdit || !hasPrev}"\n\t\t\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\t\t\t\t\ttype="next"\n\t\t\t\t\t\t\t\t\t\t\ttouch-nav="{mobile}"\n\t\t\t\t\t\t\t\t\t\t\tletter="{attrs.letter}"\n\t\t\t\t\t\t\t\t\t\t\tis-search="{searchRoute}"\n\t\t\t\t\t\t\t\t\t\t\tis-filter="{filterRoute}"\n\t\t\t\t\t\t\t\t\t\t\tid="search_button_next"\n\t\t\t\t\t\t\t\t\t\t\thidden="{is3Pane}"\n\t\t\t\t\t\t\t\t\t\t\tdisabled="{isDisableEdit || !hasNext}"\n\t\t\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\x3c!-- 2pane: список писем --\x3e\n\t\t\t\t\t<fn:if test="!readMode && !selectMode && !searchRoute && is2Pane">\n\t\t\t\t\t\t<fn:var name="groupStyle" value="{\'\'}"/>\n\t\t\t\t\t\t<fn:var name="groupStyle"\n\t\t\t\t\t\t\t\tvalue="{groupStyle + \'padding-right:56px;\'}"\n\t\t\t\t\t\t\t\ttest="attrs[\'small-search\']"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<td bem:elem="content">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tbem:block="portal-menu__group" bem:mod="float"\n\t\t\t\t\t\t\t\t\tstyle="{groupStyle}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\ttype="filters"\n\t\t\t\t\t\t\t\t\t\tshort\n\t\t\t\t\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</fn:match>\n\n\t\t<fn:match name="right-column"\n\t\t\t\t  test="globals.shouldShowSearch"/>\n\n\t</b:layout>\n</div>\n',"app/feast-tpl!ui-block/portal-menu/portal-menu.html")});define("feast-tpl!ui-block/portal-menu/portal-menu.html",["feast-tpl!app/feast-tpl!ui-block/portal-menu/portal-menu.html"],function(a){return a});define("mediator/folders-navigation/utils",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getParentFolder=void 0;var a=function(a,b){if(!a||!b){return null}var c=a.get("parent");return b.find(function(a){var b=a.id;return c===b})};exports.getParentFolder=a});define("mediator/layout-manager/vars",["require","exports","default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.sizes=exports.columnSidebarXl=exports.columnSidebarM=exports.SIDEBAR_SHORT_COLUMN_LIMIT_PX=void 0;var b=7;exports.SIDEBAR_SHORT_COLUMN_LIMIT_PX=a.SHORTCUT_LEFT_COLUMN_LIMIT*4-b;exports.columnSidebarM=80;exports.columnSidebarXl=100;exports.sizes=["xxs","xs","s","m","l","xl","xxl"]});define("feast-tpl!app/feast-tpl!ui-block/filters/filters.html",["feast"],function(a){return a.smartParse('<div promo:id="portal-menu-filters">\n\t<fn:var name="folder" value="{attrs.folder}" />\n\t<fn:var name="filter" value="{_this.getFilter(attrs.filter)}" />\n\t<fn:var name="filters" value="{_this.filters}" />\n\t<fn:var name="selectedFilterIndexes" value="{_this.getSelectedFilterIndexes()}"/>\n\t<fn:var name="settings" value="{_this.getSettings()}" />\n\t<fn:var name="sortingEnable" value="{_this.isSortingEnable()}" />\n\t<fn:var name="showResetAll" value="{_this.isShowResetAll()}"/>\n\n\t<fn:var name="short" value="{attrs.short}" />\n\t<fn:var name="full" value="{!attrs.short}" />\n\t<fn:var name="touch" value="{attrs.touch}" />\n\t<fn:var name="ponyMode" value="{attrs.ponymode}" />\n\t<fn:var name="alignRight" value="{_this.isAlignRight()}" />\n\n\t<fn:var name="layoutType" value="{attrs.type}" />\n\n\t<bem:mod name="short" test="short" />\n\t<bem:mod name="full" test="full" />\n\t<bem:mod name="touch" test="touch" />\n\t<bem:mod name="pony-mode" test="ponyMode" />\n\n\t\x3c!-- Шаблон элемента списка - фильтра --\x3e\n\t<fn:match\n\t\tname="item"\n\t\targs="item, key, isSelected, isDisabled, text, icon, touch"\n\t>\n\t\t<fn:var name="type" value="{item.type}" />\n\t\t<b:list-item\n\t\t\ttouch="{touch}"\n\t\t\tdisabled="{isDisabled}"\n\t\t\tmarkable\n\t\t\tmarked="{isSelected}"\n\t\t\tqa:id="{type}"\n\t\t\tkey="{key}"\n\t\t\tremit:click="item-click"\n\t\t\tevent:details="item"\n\t\t>\n\t\t\t<span bem:elem="ico" fn:if="icon">\n\t\t\t\t<b:ico name="{icon}" size="s" />\n\t\t\t</span>\n\n\t\t\t<span bem:elem="text"> {text} </span>\n\t\t</b:list-item>\n\t</fn:match>\n\n\t<fn:match\n\t\tname="unselectable-item"\n\t\targs="item, key, isSelected, text, icon, helpLink, touch, event"\n\t>\n\t\t<fn:var name="test" value="threads:toggle" />\n\t\t<fn:var name="type" value="{item.type}" />\n\t\t<b:list-item\n\t\t\ttouch="{touch}"\n\t\t\tmarkable\n\t\t\tmarked="{isSelected}"\n\t\t\tqa:id="{type}"\n\t\t\tkey="{key}"\n\t\t\tremit:click="filters:unselectable-item-click"\n\t\t\tevent:details="item"\n\t\t>\n\t\t\t<span bem:elem="ico" fn:if="icon">\n\t\t\t\t<b:ico name="{icon}" size="s" />\n\t\t\t</span>\n\n\t\t\t<span bem:elem="text"> {text} </span>\n\t\t\t\x3c!-- Для метатредов при клике открывается попап настроек, где будет ссылка на help, но в дропдауне скрываем\t--\x3e\n\t\t\t<fn:if test="helpLink && helpLink!==\'metathreads\' && !attrs[\'hide-help\']">\n\t\t\t\t<fn:apply-match\n\t\t\t\t\tname="help-link"\n\t\t\t\t\targs="helpLink, attrs[\'help-links\'][helpLink]"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</b:list-item>\n\t</fn:match>\n\n\t<fn:match name="help-link" args="eventName, link">\n\t\t<b:settings-help-link\n\t\t\tevent-details="{eventName}"\n\t\t\tlink="{link}"\n\t\t\tuse:mediator="settings-manager pony-mode"\n\t\t/>\n\t</fn:match>\n\n\t\x3c!-- Селект "Фильтры" --\x3e\n\t<b:select\n\t\tref="select"\n\t\tid="select"\n\t\tremit:item-click="select:item-click"\n\t\tremit:toggle="select:list-toggle"\n\t\tremit:sorting-open-submenu="select:sorting-open-submenu"\n\t\tremit:reset-all="select:reset-all"\n\t\titems="{filters}"\n\t\ttouch="{touch}"\n\t\tmultiple="{true}"\n\t\tselected-index="{selectedFilterIndexes}"\n\t\tautochange="{attrs.autochange}"\n\t\talign-right="{alignRight}"\n\t>\n\t\t<fn:match name="control" args="_, selectedItem, selectedIndex, expanded">\n\t\t\t<b:filters-control\n\t\t\t\tfilters="{selectedItem}"\n\t\t\t\tsortingType="{attrs.sortingType}"\n\t\t\t\tfolder="{folder}"\n\t\t\t\tfull="{full}"\n\t\t\t\tshort="{short}"\n\t\t\t\tactive="{attrs.expanded}"\n\t\t\t\tsidebar-column="{_this.get(\'sidebar-column\')}"\n\t\t\t\tmain-column="{_this.get(\'main-column\')}"\n\t\t\t\tpure="{attrs.pure}"\n\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\tpressed="{expanded}"\n\t\t\t\tlayoutType="{layoutType}"\n\t\t\t\ticonOnly="{attrs.iconOnly}"\n\t\t\t\tdefault-filter-text="{_this.getDefaultFilterText()}"\n\t\t\t\tremit:click="control-click"\n\t\t\t\tcombineFilterAndFolderName="{attrs.combineFilterAndFolderName}"\n\t\t\t/>\n\t\t</fn:match>\n\n\t\t<fn:match\n\t\t\tname="items"\n\t\t\targs="items, selectedItem, selectedIndex, disabledItem, disabledIndex, touch"\n\t\t>\n\t\t\t\x3c!-- Список фильтров --\x3e\n\t\t\t<b:list touch="{touch}" qa:id="filters-dropdown">\n\t\t\t\t<fn:for data="items" as="item">\n\t\t\t\t\t<fn:var name="key" value="{item.text}" />\n\t\t\t\t\t<fn:var name="text" value="{item.text}" />\n\t\t\t\t\t<fn:var\n\t\t\t\t\t\tname="isSelected"\n\t\t\t\t\t\tvalue="{selectedItem.filter((element) => element.text === key).length}"\n\t\t\t\t\t/>\n\t\t\t\t\t<fn:var name="isDisabled" value="{key === disabledItem.text}" />\n\t\t\t\t\t<fn:var name="icon" value="{item.icon}" />\n\n\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\tname="item"\n\t\t\t\t\t\targs="item, key, isSelected, isDisabled, text, icon, touch"\n\t\t\t\t\t/>\n\t\t\t\t</fn:for>\n\n\t\t\t\t<fn:if test="sortingEnable">\n\t\t\t\t\t\x3c!-- Сортировка --\x3e\n\t\t\t\t\t<div bem:elem="hr" />\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\ttouch="{touch}"\n\t\t\t\t\t\tid="sorting"\n\t\t\t\t\t\tqa:id="sorting"\n\t\t\t\t\t\tnested\n\t\t\t\t\t\tkey="sorting"\n\t\t\t\t\t\tremit:click="sorting-open-submenu"\n\t\t\t\t\t\tmarkable\n\t\t\t\t\t>\n\t\t\t\t\t\t<span bem:elem="text"> {i18n(\'Сортировка\')} </span>\n\n\t\t\t\t\t\t<span bem:elem="nested">\n\t\t\t\t\t\t\t<b:ico name="navigation:drop_next" size="s" />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t<fn:if test="showResetAll">\n\t\t\t\t\t\t\x3c!-- Сбросить всё --\x3e\n\t\t\t\t\t\t<div bem:elem="hr" />\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{touch}"\n\t\t\t\t\t\t\tqa:id="resetAll"\n\t\t\t\t\t\t\tkey="resetAll"\n\t\t\t\t\t\t\tremit:click="reset-all"\n\t\t\t\t\t\t\tmarkable\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="text"> {i18n(\'Сбросить всё\')} </span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:if>\n\n\t\t\t\t\x3c!-- Внешний вид --\x3e\n\t\t\t\t<fn:if test="settings">\n\t\t\t\t\t<div bem:elem="hr">\n\t\t\t\t\t\t<bem:mod name="markable" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div bem:elem="caption">\n\t\t\t\t\t\t<bem:mod name="markable" />\n\t\t\t\t\t\t{i18n(\'Внешний вид\')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<fn:for data="settings" as="item">\n\t\t\t\t\t\t<fn:var name="key" value="{item.text}" />\n\t\t\t\t\t\t<fn:var name="text" value="{item.text}" />\n\t\t\t\t\t\t<fn:var name="isSelected" value="{item.isOn}" />\n\t\t\t\t\t\t<fn:var name="icon" value="{item.icon}" />\n\t\t\t\t\t\t<fn:var name="helpLink" value="{item.helpLink}" />\n\t\t\t\t\t\t<fn:var name="event" value="{item.event}" />\n\t\t\t\t\t\t<fn:var name="couldToggle" value="{item.couldToggle}" />\n\n\t\t\t\t\t\t<fn:if test="couldToggle">\n\t\t\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\t\tname="unselectable-item"\n\t\t\t\t\t\t\t\targs="item, key, isSelected, text, icon, helpLink, touch, event"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</fn:for>\n\t\t\t\t</fn:if>\n\t\t\t</b:list>\n\t\t</fn:match>\n\t</b:select>\n</div>\n',"app/feast-tpl!ui-block/filters/filters.html")});define("feast-tpl!ui-block/filters/filters.html",["feast-tpl!app/feast-tpl!ui-block/filters/filters.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/filters-control/filters-control.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="folder" value="{attrs.folder}" />\n\t<fn:var name="sortingType" value="{attrs.sortingType}" />\n\t<fn:var name="folderName" value="{folder.get(\'name\')}" />\n\t<fn:var name="activeFilters" value="{_this.getActiveFilters()}" />\n\t<fn:var name="activeFiltersAndSorting" value="{_this.getActiveFiltersAndSorting()}" />\n\t<fn:var name="controlIcons" value="{_this.getControlIcons()}" />\n\t<fn:var name="ponyMode" value="{attrs[\'pony-mode\']}" />\n\n\t<fn:var name="short" value="{attrs.short}" />\n\t<fn:var name="full" value="{attrs.full}" />\n\t<fn:var name="defaultFilter" value="{activeFilters === \'all\'}" />\n\t<fn:var name="combinedMode" value="{full || short && !defaultFilter}" />\n\t<fn:var name="controlText" value="{_this.getControlText()}" />\n\n\t<bem:mod name="short" test="short" />\n\t<bem:mod name="full" test="full" />\n\t<bem:mod name="active" test="attrs.active" />\n\t<bem:mod name="pressed" test="attrs.pressed" />\n\n\t<bem:mod name="pure" test="attrs.pure" />\n\t<bem:mod name="base" test="!attrs.pure" />\n\t<bem:mod name="pony-mode" test="ponyMode" />\n\t<bem:mod name="with-folder" test="combinedMode && attrs.combineFilterAndFolderName" />\n\n\t<bem:mod name="new-toolbar" test="_this.useNewToolbar()" />\n\n\t<fn:attr name="title" value="{controlText}" />\n\n\t\x3c!-- Папка --\x3e\n\t<fn:match name="folder-block">\n\t\t<span bem:elem="folder" qa:id="folder-name-filter">\n\t\t\t<fn:value>folderName</fn:value>\n\t\t</span>\n\t</fn:match>\n\n\t\x3c!-- Фильтр --\x3e\n\t<fn:match name="filter-block">\n\t\t<span bem:elem="filter">\n\t\t\t<bem:mod name="short" test="short" />\n\t\t\t<bem:mod name="pony-mode" test="ponyMode" />\n\n\t\t\t<span bem:elem="filter-icon" fn:if="controlIcons.length">\n\t\t\t\t<fn:for data="controlIcons" as="filterIcon">\n\t\t\t\t\t<b:ico\n\t\t\t\t\t\tname="{filterIcon}"\n\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\tkey="icon-{filterIcon}"\n\t\t\t\t\t\tqa:id="filter-icon-{filterIcon}"\n\t\t\t\t\t/>\n\t\t\t\t</fn:for>\n\t\t\t</span>\n\t\t\t<span\n\t\t\t\tbem:elem="filter-text"\n\t\t\t\tqa:id="filter-text"\n\t\t\t\tpromo:id="octavius-tooltip-mailbox-sort"\n\t\t\t\tqa:state="{activeFiltersAndSorting}"\n\t\t\t>\n\t\t\t<fn:var name="isFixedWidthFilterText" value="{_this.isFixedWidthFilterText()}" />\n\t\t\t<bem:mod name="{isFixedWidthFilterText.width}" fn:if="isFixedWidthFilterText.fixed" />\n\t\t\t\t<fn:if test="!attrs.iconOnly">{controlText}</fn:if>\n\t\t\t\t<fn:if test="attrs.iconOnly && defaultFilter"><b:ico name="actions:sort"/></fn:if>\n\t\t\t</span>\n\t\t</span>\n\t</fn:match>\n\n\t\x3c!-- Подробный вид --\x3e\n\t<div bem:elem="text" fn:if="full">\n\t\t<bem:mod name="combined" fn:if="combinedMode" />\n\t\t<bem:mod name="pony-mode" test="ponyMode" />\n\n\t\t<fn:apply-match name="folder-block" />\n\n\t\t<span bem:elem="filter" fn:if="combinedMode" qa:id="filter-text" promo:id="octavius-tooltip-mailbox-sort">\n\t\t\t<bem:mod name="{_this.isFixedWidthFilterText().width}" fn:if="_this.isFixedWidthFilterText().fixed" />\n\t\t\t<fn:value>controlText</fn:value>\n\t\t</span>\n\t</div>\n\n\t\x3c!-- Компактный вид --\x3e\n\t<div bem:elem="text" fn:if="short">\n\t\t<bem:mod name="default-filter" fn:if="activeFilters === \'all\'" />\n\n\t\t<fn:apply-match name="filter-block" />\n\t</div>\n\n\t<fn:if test="!attrs.iconOnly">\n\t\t\x3c!-- Стрелка --\x3e\n\t\t<div bem:elem="arrow-down-icon">\n\t\t\t<b:ico name="navigation:drop_down" size="s" />\n\t\t</div>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/filters-control/filters-control.html")});define("feast-tpl!ui-block/filters-control/filters-control.html",["feast-tpl!app/feast-tpl!ui-block/filters-control/filters-control.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/filters-control/filters-control",["require","exports","default-values","feast","feast-tpl!./filters-control.html","mrg-i18n-utils","ui-block/list-nested-sorting/sorting"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);exports.default=b.default.Block.extend({name:"filters-control",template:c.default,defaults:{"pony-mode":false,iconOnly:false},getControlText:function(){var a=this.get("full");var b=this.get("default-filter-text");var c=this.get("filters");var f=this.get("sortingType");if(a){if(f&&f!=="D"&&c.length>1){return"".concat((0,d.default)("Фильтры"),": ").concat(c.length,", ").concat(new e.default(f).controlText)}if(f&&f!=="D"&&c.length===1&&c[0].type!=="all"){return"".concat(c[0].text,", ").concat(new e.default(f).controlText)}if(f&&f!=="D"){return new e.default(f).controlText}if(c.length>1){return"".concat((0,d.default)("Фильтры"),": ").concat(c.length)}if(c.length){return"".concat(c[0].text)}}if(f&&f!=="D"){return new e.default(f).controlText}if(c.length===1&&c[0].type==="all"){return b}if(c.length>1){return(0,d.default)("Фильтры")}return c[0].text},getControlIcons:function(){var a=this.get("filters");return a.map(function(a){return a.icon})},getActiveFilters:function(){var a=this.get("filters");return a.map(function(a){return a.type}).join(",")},getActiveFiltersAndSorting:function(){var a=this.get("sortingType");return"".concat(this.getActiveFilters(),"|").concat(a)},isFixedWidthFilterText:function(){if(a.PORTAL_MENU_MORE_FOLDER_ACTIONS){return this.isFixedWidthFilterTextWithKebab()}var b=this.get("sidebar-column");if(this.get("full")){return{fixed:b<75,width:"maxWidth150"}}var c=this.get("filters");if(Object.keys(c).length===3&&b<80){return{fixed:true,width:"maxWidth80"}}if(Object.keys(c).length===3&&b>=100){return{fixed:true,width:"maxWidth80"}}if(Object.keys(c).length===2&&b<75){return{fixed:true,width:"maxWidth100"}}return{fixed:false,width:""}},useNewToolbar:function(){return a.NEW_TOOLBAR},isFixedWidthFilterTextWithKebab:function(){var a=this.get("sidebar-column");var b=this.get("pony-mode");var c=this.get("filters");var d=Object.keys(c).length;var e=this.get("sortingType");if(this.get("full")){if(a<79){return{fixed:true,width:"maxWidth100"}}if(a<93){return{fixed:true,width:"maxWidth150"}}if(a>=100&&a<109){return{fixed:true,width:"maxWidth100"}}return{fixed:a<75||a>=109&&a<123,width:!b?"maxWidth100":"maxWidth150"}}if(this.get("layoutType")==="3pane"){if(!b){if(a<74){if(e&&e!=="D"&&d<1){return{fixed:true,width:"maxWidth100"}}if(d<=1){return{fixed:true,width:"maxWidth80"}}if(d<=2){return{fixed:true,width:"maxWidth60"}}return{fixed:true,width:"maxWidth40"}}if(a<79){return{fixed:true,width:"maxWidth60"}}if(a<88){return{fixed:true,width:"maxWidth80"}}}if(a<73){return{fixed:true,width:"maxWidth60"}}if(a<77||a>=100&&a<107){return{fixed:true,width:"maxWidth80"}}}if(Object.keys(c).length===3&&a<80){return{fixed:true,width:"maxWidth80"}}if(Object.keys(c).length===3&&a>=100){return{fixed:true,width:"maxWidth80"}}if(Object.keys(c).length===2&&a<75){return{fixed:true,width:"maxWidth100"}}return{fixed:false,width:""}}})});define("feast-tpl!app/feast-tpl!ui-block/select/select.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="expanded" value="{attrs.expanded}"/>\n\t<fn:var name="touch" value="{attrs.touch}" />\n\t<fn:var name="userToggled" value="{_this.userToggled}"/>\n\t<fn:var name="items" value="{attrs.items}"/>\n\t<fn:var name="selectedIndex" value="{_this.getSelectedIndex()}"/>\n\t<fn:var name="selectedItem" value="{_this.getSelectedItem()}"/>\n\t<fn:var name="disabledIndex" value="{attrs[\'disabled-index\']}"/>\n\t<fn:var name="disabledItem" value="{_this.getItem(disabledIndex)}" />\n\t<fn:var name="alignRight" value="{attrs[\'align-right\']}" />\n\t\x3c!-- Для передачи массива selectedIndex --\x3e\n\t<fn:var name="multiple" value="{attrs.multiple}"/>\n\n\t<bem:mod name="touch" test="touch"/>\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']"/>\n\n\n\t\x3c!-- Контрол --\x3e\n\t<fn:match name="control" args="selectedText, selectedItem, selectedIndex, expanded">\n\t\t<b:button2\n\t\t\ttext="{selectedText}"\n\t\t\tpressed="{expanded}"\n\t\t\tremit:click="control-click"\n\t\t/>\n\t</fn:match>\n\n\t\x3c!-- Элемент --\x3e\n\t<fn:match name="item" args="item, key, isSelected, isDisabled, text, icon, touch">\n\t\t<b:list-item\n\t\t\ttouch="{touch}"\n\t\t\tdisabled="{isDisabled}"\n\t\t\tmarkable\n\t\t\tmarked="{isSelected}"\n\n\t\t\tqa:id="{key}"\n\t\t\tkey="{key}"\n\t\t\tremit:click="item-click"\n\t\t\tevent:details="item"\n\t\t>\n\t\t\t<span bem:elem="ico" fn:if="icon">\n\t\t\t\t<b:ico name="{icon}" size="s" />\n\t\t\t</span>\n\n\t\t\t<span bem:elem="text">\n\t\t\t\t<fn:value>text</fn:value>\n\t\t\t</span>\n\t\t</b:list-item>\n\t</fn:match>\n\n\t\x3c!-- Список элементов --\x3e\n\t<fn:match name="items" args="items, selectedItem, selectedIndex, disabledItem, disabledIndex, touch">\n\t\t<b:list\n\t\t\ttouch="{touch}"\n\t\t>\n\t\t\t<fn:for data="items" as="item">\n\t\t\t\t<fn:var name="key" value="{_this.getItemAttr(item, \'key\')}"/>\n\t\t\t\t<fn:var name="text" value="{_this.getItemAttr(item, \'text\')}"/>\n\t\t\t\t<fn:var name="isSelected" value="{key === _this.getItemAttr(selectedItem, \'key\')}"/>\n\t\t\t\t<fn:var name="isDisabled" value="{key === _this.getItemAttr(disabledItem, \'key\')}" />\n\t\t\t\t<fn:var name="icon" value="{_this.getItemAttr(item, \'icon\')}"/>\n\n\t\t\t\t\x3c!-- Элемент --\x3e\n\t\t\t\t<fn:apply-match name="item" args="item, key, isSelected, isDisabled, text, icon, touch"/>\n\t\t\t</fn:for>\n\t\t</b:list>\n\t</fn:match>\n\n\t\x3c!-- Кнопка выбора --\x3e\n\t<div bem:elem="control">\n\t\t<fn:var name="selectedText" value="{_this.getItemAttr(selectedItem, \'text\')}"/>\n\t\t<fn:apply-match name="control"\n\t\t\t\t\t\targs="selectedText, selectedItem, selectedIndex, expanded"/>\n\t</div>\n\n\t\x3c!-- Выпадающий список --\x3e\n\t<div bem:elem="items">\n\t\t<bem:mod name="expanded" test="expanded"/>\n\t\t<bem:mod name="collapsed" test="!expanded && userToggled"/>\n\t\t<bem:mod name="align-right" test="alignRight" />\n\n\t\t<fn:apply-match name="items" args="items, selectedItem, selectedIndex, disabledItem, disabledIndex, touch"/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/select/select.html")});define("feast-tpl!ui-block/select/select.html",["feast-tpl!app/feast-tpl!ui-block/select/select.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/select/select",["require","exports","feast","feast-tpl!./select.html","ui-block/list/list","ui-block/list-item/list-item","../../lazy.modules"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);exports.default=a.default.Block.extend({name:"select",template:b.default,blocks:{list:c.default,"list-item":d.default},events:{"control-click":"onControlClick","item-click":"onItemClick","list-hide":"hide"},defaults:{autochange:true,"default-selected-index":null,"disabled-index":null,expanded:false,items:[],"selected-index":null,touch:false},attrChanged:{"selected-index":function a(b){this.broadcast("item-change",this.getItem(b))},expanded:function a(b){var c=this;(0,e.lazyMailKeymaster)().then((0,e.uniqCallback)(this,function(a){if(b){a("escape",c.onEscape)}else{a.unbind("escape",c.onEscape)}}));this.broadcast("toggle",b)}},userToggled:false,onControlClick:function(){this.userToggled=true;this.invert("expanded")},onOutsideClick:function(a){if(!this.el.contains(a.target)){this.hide()}},onItemClick:function(a){var b=a.details;this.hide();if(this.is("autochange")){this.set("selected-index",this.indexOf(b))}return true},hide:function(){this.set("expanded",false)},getItem:function(a){return this.get("items")[a]},getSelectedItem:function(){var a=this;if(this.get("multiple")){var b=[];this.getSelectedIndex().forEach(function(c){b.push(a.get("items")[c])});return b}return this.get("items")[this.getSelectedIndex()]},indexOf:function(a){return this.get("items").indexOf(a)},getSelectedIndex:function(){var a=this.get("selected-index");if(a==null){return this.get("default-selected-index")}return a},getItemAttr:function(a,b){if(!a){if(b==="text"){return i18n("Выберите элемент")}return null}if(typeof a.get!=="function"){if(b==="text"||b==="key"){return a[b]||a.text||String(a)}return a[b]}if(b==="key"){return a.get("key")||a.get("text")}return a.get(b)},didMount:function(){var a=this;this.set("selected-index",this.getSelectedIndex());this.toggleOutsideListener(true);this.onEscape=function(b){b.stopImmediatePropagation();a.hide()}},didUnmount:function(){this.toggleOutsideListener(false)},toggleOutsideListener:function(a){this[a?"$on":"$off"](this.el.ownerDocument,"click","onOutsideClick")}})});define("ui-block/filters/filter",["require","exports"],function(require,exports){"use strict";var a,b;Object.defineProperty(exports,"__esModule",{value:true});exports.FilterDefaultText=exports.LetterFilters=exports.FilterIcon=exports.FilterText=exports.FilterType=void 0;exports.FilterType={all:"all",unread:"unread",flagged:"flagged",withAttachments:"with_attachments"};exports.FilterText=(a={},a[exports.FilterType.all]=i18n("Все письма"),a[exports.FilterType.unread]=i18n("Непрочитанные"),a[exports.FilterType.flagged]=i18n("С флажком"),a[exports.FilterType.withAttachments]=i18n("С вложениями"),a);exports.FilterIcon=(b={},b[exports.FilterType.all]="",b[exports.FilterType.unread]="point",b[exports.FilterType.flagged]="flag",b[exports.FilterType.withAttachments]="attach",b);function c(a){this.type=a||exports.FilterType.all;this.text=exports.FilterText[this.type];this.icon=exports.FilterIcon[this.type]}exports.default=c;exports.LetterFilters=[new c(exports.FilterType.all),new c(exports.FilterType.unread),new c(exports.FilterType.flagged),new c(exports.FilterType.withAttachments)];exports.FilterDefaultText={filter:i18n("Фильтр"),view:i18n("Вид")}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/filters/filters",["require","exports","default-values","feast","feast-tpl!./filters.html","mail/User","service/radars/decorator","service/submenu","ui-block/filters-control/filters-control","ui-block/list-nested/list-nested","ui-block/list-nested-sorting/sorting","ui-block/select/select","./filter"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);j=__importDefault(j);exports.default=b.default.Block.extend((0,e.default)({id:"filter",explicit:true,events:[{name:"threads:toggle",rename:"threads_toggle",immediate:true},{name:"metathreads:settings:open",rename:"metathreads_settings_toggle",immediate:true},{name:"priority:messages:toggle",rename:"priority_messages_click",immediate:true},{name:"ponymode:toggle",rename:"ponymode_click",immediate:true},{name:"help:open",rename:"help_open"},{name:"layout:toggle",rename:"layout_toggle",immediate:true},{name:"shortcuts:toggle",rename:"shortcuts_toggle",immediate:true}]})({name:"filters",template:c.default,blocks:{"filters-control":g.default,select:j.default,"list-nested":h.default},defaults:{expanded:false,filter:{all:true,unread:false,flagged:false,with_attachments:false},"pony-mode":false,autochange:true,iconOnly:false,alignLeft:false},events:{"select:item-change":"onFilterChange","select:item-click":"onFilterClick","select:list-toggle":"onToggle","select:sorting-open-submenu":"openSortingSubmenu","select:reset-all":"resetFiltersAndSortings","filters:unselectable-item-click":"onUnselectableItemClick"},filters:k.LetterFilters,getFilter:function(a){return k.LetterFilters.find(function(b){return b.type===a})},isShowResetAll:function(){return!(this.get("filter")["all"]&&(0,i.isDefaultSorting)(this.get("sortingType")))},onFilterChange:function(){},isFilterOn:function(a){return this.get("filter")[a]},onFilterClick:function(b){var c=b.details;var d=this.isFilterOn(c.type)?"_off":"_on";d=c.type==="all"?"_on":d;var e="".concat(c.type,"_click").concat(a.ENABLE_MULTIPLE_FILTERS?d:"");this.radar(e);this.broadcast("filterclick",c.type)},openSortingSubmenu:function(){this.radar("open_sorting_submenu");f.default.open("sorting",{},this.ids["sorting"])},resetFiltersAndSortings:function(){this.radar("reset_filters_and_sorting");this.broadcast("resetall");this.ids.select.hide()},onToggle:function(a){var b=a.details;if(!b){f.default.close();return}this.radar("click-on")},getSelectedFilterIndexes:function(){var a=this;var b=[];Object.entries(this.get("filter")).forEach(function(c){var d=c[0],e=c[1];if(e){b.push(a.filters.findIndex(function(a){return a.type===d}))}});return b},isSortingEnable:function(){return a.ENABLE_SORTING},getSettings:function(){if(!this.get("has-metathreads-settings")){return null}var a=this.get("metathreadsSettings");return[{type:"metathreads",text:i18n("Умная сортировка писем"),isOn:a&&Object.values(a).some(function(a){return a===d.default.METATHREADS_STATES.ON||a===d.default.METATHREADS_STATES.HIDDEN}),couldToggle:!this.get("hide-metathreads")||!this.get("hide-to-myself"),event:"metathreads:settings:open",helpLink:"metathreads",from:"filter",metathreadsSettings:a},{type:"threads",text:i18n("Группировка по отправителю"),isOn:this.get("threads"),couldToggle:true,event:"threads:toggle",from:"filter",helpLink:"threads"},{type:"layout",text:i18n("Список писем с колонкой письма"),isOn:this.get("type")==="3pane",couldToggle:this.get("support3pane"),event:"layout:toggle",from:"filter",helpLink:"help3pane"},{type:"ponyMode",text:i18n("Компактный вид"),isOn:this.get("ponymode"),couldToggle:this.get("can-toggle-ponymode"),event:"ponymode:toggle",from:"filter"},{type:"shortcuts",text:i18n("Скрывать список папок"),isOn:this.get("manual-shortcuts"),couldToggle:this.get("can-toggle-shortcuts"),event:"shortcuts:toggle",from:"filter"}]},onUnselectableItemClick:function(a){var b=a.details;var c=b.event;if(c){this.broadcast(c,b)}this.ids.select.broadcast("list-hide")},isAlignRight:function(){return this.attrs.alignRight||!this.attrs.alignLeft&&!a.HIDE_METATHREADS&&this.get("type")!=="3pane"},getDefaultFilterText:function(){return k.FilterDefaultText.filter},didUnmount:function(){f.default.destroy()}}))});define("feast-tpl!app/feast-tpl!ui-block/portal-menu-element/portal-menu-element.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="size" value="m"/>\n\t<fn:var name="type" value="{attrs.type}"/>\n\t<fn:var name="short" value="{attrs.short}"/>\n\t<fn:var name="theme" value="{attrs.theme}"/>\n\t<fn:var name="touch" value="{attrs[\'touch-nav\']}"/>\n\n\t<bem:mod name="{type}" test="type" />\n\t<bem:mod name="short" test="short" />\n\t<bem:mod name="expanded" test="!short" />\n\t<bem:mod name="touch" test="touch" />\n\t<bem:mod name="not-touch" test="!touch" />\n\t<bem:mod name="hidden" test="attrs.hidden" />\n\t<bem:mod name="pony-mode" test="attrs.ponymode" />\n\n\t<bem:mod name="folder-overflow" test="attrs[\'folder-overflow\']"/>\n\n\t<div fn:if="type === \'title\' && !attrs.disabled" bem:elem="text"\n\t\t\ttitle="{attrs.text}">\n\t\t{attrs.text}\n\t</div>\n\n\t<b:button2 fn:if="type === \'removeAll\'"\n\t\t\tremit:click="clearActiveFolder"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\ttext="{_this.getClearActiveFolderLabel()}"\n\t\t\ttitle="{_this.getClearActiveFolderLabel()}"\n\t\t\tico="actions:delete"\n\t\t\tqa:id="removeAll"\n\t\t\tdisabled="{attrs.disabled}"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'delete\'"\n\t\t\tremit:click="remove"\n\t\t\tevent:details="{selection:true}"\n\t\t\ttext="{i18n(\'Удалить\')}"\n\t\t\tico="delete"\n\t\t\tqa:id="delete"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'reply\'"\n\t\t\tremit:click="compose:reply"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="r"\n\t\t\ttext="{i18n(\'Ответить\')}"\n\t\t\tico="reply"\n\t\t\tqa:id="reply"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tdisabled="{!_this.isEnableReply()}"\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'reply-all\'"\n\t\t\tremit:click="compose:replyall"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="shift+r"\n\t\t\ttext="{i18n(\'Ответить всем\')}"\n\t\t\tico="reply-all"\n\t\t\tqa:id="reply-all"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tdisabled="{!_this.isEnableReply()}"\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'forward\'"\n\t\t\tremit:click="compose:forward"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="f"\n\t\t\ttext="{i18n(\'Переслать\')}"\n\t\t\tico="forward"\n\t\t\tqa:id="forward"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tdisabled="{!_this.isEnableForward()}"\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'remove\'"\n\t\t\tremit:click="remove"\n\t\t\tevent:details="{selection:true}"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="del|command+backspace"\n\t\t\ttext="{i18n(\'Удалить\')}"\n\t\t\tico="delete"\n\t\t\tqa:id="delete"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tdisabled="{!_this.isEnableRemove()}"\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'archive\'"\n\t\t\tremit:click="archive"\n\t\t\tevent:details="{selection:true}"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="e"\n\t\t\ttext="{i18n(\'В архив\')}"\n\t\t\tico="archive"\n\t\t\tqa:id="archive"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tdisabled="{!_this.isEnableMoveToArchive()}"\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'spam\'"\n\t\t\tremit:click="spam"\n\t\t\tevent:details="{selection:true}"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="shift+j"\n\t\t\ttext="{i18n(\'Спам\')}"\n\t\t\tico="spam-on"\n\t\t\tqa:id="spam-on"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:unsubscribe fn:if="type === \'unsubscribe\'"\n\t\t\tuse:mediator="unsubscribe-actions themes-manager"\n\t\t\ttouch="{attrs.touch}"\n\t\t\tponymode="{attrs.ponymode}"\n\t\t\tinsteadSpamButton\n\t\t\tqa:id="unsubscribe"\n\t\t\tsenderFrom="{attrs.selectedLettersSenders}"\n\t\t\tletterId="{attrs.selectedLettersIds}"\n\t\t\tshort\n\t\t\twithoutText="{attrs.short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'unspam\' && !attrs.store.folder.isShareTake()"\n\t\t\tremit:click="unspam"\n\t\t\tevent:details="{selection:true}"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="shift+j"\n\t\t\ttext="{i18n(\'Не спам\')}"\n\t\t\tico="spam-off"\n\t\t\tqa:id="spam-off"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'all-read\'"\n\t\t\t   event:details="{selection:true}"\n\t\t\t   use:mixin="shortcut-title"\n\t\t\t   remit:click="mark:allreaded"\n\t\t\t   text="{attrs.shortText ? i18n(\'Прочитать все\') : i18n(\'Отметить все прочитанными\')}"\n\t\t\t   compact="{attrs.ponymode}"\n\t\t\t   pure\n\t\t\t   ico="status:read"\n\t\t\t   qa:id="all-read"\n\t\t\t   touch="{touch}"\n\t\t\t   size="{size}"\n\t\t\t   short="{short}"\n\t\t\t   disabled="{attrs.disabled}"\n\t\t\t   centered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'read\'"\n\t\t\tremit:click="mark:readed"\n\t\t\tevent:details="{selection:true}"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="q"\n\t\t\ttext="{i18n(\'Прочитать\')}"\n\t\t\tico="status:read"\n\t\t\tqa:id="to-read"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'select\'"\n\t\t\tremit:click="select:all"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="ctrl+a|command+a"\n\t\t\ttitle="{i18n(\'Выделить все\')}"\n\t\t\ttext="{attrs.text}"\n\t\t\texplanation="{attrs[\'has-explanation\'] ? i18n(\'Выделить все\'): \'\'}"\n\t\t\tdisabled="{attrs.disabled}"\n\t\t\tico="select-all"\n\t\t\tqa:id="select-all"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'deselect\'"\n\t\t\tremit:click="select:drop"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="ctrl+a|command+a"\n\t\t\ttitle="{i18n(\'Снять выделение\')}"\n\t\t\ttext="{attrs.text}"\n\t\t\texplanation="{attrs[\'has-explanation\'] ? i18n(\'Снять выделение\'): \'\'}"\n\t\t\tmap="toolbar"\n\t\t\tico="select-all"\n\t\t\tqa:id="deselect-all"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'deselect-back\'"\n\t\t\tremit:click="select:drop"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="esc"\n\t\t\ttitle="{attrs.deselectLabelReset ? i18n(\'Сбросить\') : i18n(\'Вернуться\')}"\n\t\t\ttext="{attrs.deselectLabelReset ? i18n(\'Сбросить\') : i18n(\'Вернуться\')}"\n\t\t\tmap="toolbar"\n\t\t    ico="{(!attrs.deselectLabelReset || short) && _this.getBackIcon()}"\n\t\t\tqa:id="deselect-arrow"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\ttext-center="{short}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tnowrap="{attrs.nowrap}"\n\t\t\tico-text-top\n\t\t\tcentered="{short}"\n\t/>\n\n\t<b:button2 fn:if="type === \'prev\'"\n\t\t\tremit:click="letter:prev"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="ctrl+up|ctrl+j"\n\t\t\tshortcut-mac="ctrl+j"\n\t\t\ttext="{i18n(\'Предыдущее\')}"\n\t\t\tmap="toolbar"\n\t\t\tico="arrow-up"\n\t\t\tqa:id="letter_prev"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tshort\n\t\t\tico-text-top\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tdisabled="{attrs.disabled}"\n\t\t\trole="prev"\n\t\t\tuse:mediator="thread-manager"\n\t\t\tcentered\n\t/>\n\n\t<b:button2 fn:if="type === \'next\'"\n\t\t\tremit:click="letter:next"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="ctrl+down|ctrl+k"\n\t\t\tshortcut-mac="ctrl+k"\n\t\t\ttext="{i18n(\'Следующее\')}"\n\t\t\tico="arrow-down"\n\t\t\tqa:id="letter_next"\n\t\t\tmap="toolbar"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tshort\n\t\t\tico-text-top\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t\t\tdisabled="{attrs.disabled}"\n\t\t\trole="next"\n\t\t\tuse:mediator="thread-manager"\n\t\t\tcentered\n\t/>\n\n\t<b:button2 fn:if="type === \'back\'"\n\t\t\tremit:click="letter:back"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="esc"\n\t\t\ttext="{i18n(\'Вернуться\')}"\n\t\t\tico="{_this.getBackIcon()}"\n\t\t\tqa:id="letter_back"\n\t\t\tcompact="{attrs.ponymode}"\n\t\t\tpure\n\t\t\ttouch="{touch}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t\t\tsize="{size}"\n\t\t\tnowrap="{attrs.nowrap}"\n\t\t\tcentered="{short}"\n\t\t\tuse:mediator="thread-manager"\n\t/>\n\n\t<fn:if test="type === \'backToParentFolder\'">\n\t\t<b:button2 fn:if="_this.needBackToParentShortcut()"\n\t\t\t\tevent:details="{pos:\'logo\'}"\n\t\t\t\tremit:click="back:to:parent:folder"\n\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\tshortcut="esc"\n\t\t\t\ttext="{_this.getParentFolderName()}"\n\t\t\t\tico="{_this.getBackIcon()}"\n\t\t\t\tqa:id="letter_back_to_parent_folder"\n\t\t\t\tcompact="{attrs.ponymode}"\n\t\t\t\tpure\n\t\t\t\ttouch="{touch}"\n\t\t\t\tshort="{short}"\n\t\t\t\tico-text-top\n\t\t\t\tsize="{size}"\n\t\t\t\tnowrap="{attrs.nowrap}"\n\t\t\t\tcentered="{short}"\n\t\t\t\tuse:mediator="folders-navigation"\n\t\t\t\tdisabled="{attrs.disabled}"\n\t\t/>\n\t\t<b:button2 fn:if="!_this.needBackToParentShortcut()"\n\t\t\t\tevent:details="{pos:\'logo\'}"\n\t\t\t\tremit:click="back:to:parent:folder"\n\t\t\t\ttext="{_this.getParentFolderName()}"\n\t\t\t\tico="{_this.getBackIcon()}"\n\t\t\t\tqa:id="letter_back_to_parent_folder"\n\t\t\t\tcompact="{attrs.ponymode}"\n\t\t\t\tpure\n\t\t\t\ttouch="{touch}"\n\t\t\t\tshort="{short}"\n\t\t\t\tico-text-top\n\t\t\t\tsize="{size}"\n\t\t\t\tnowrap="{attrs.nowrap}"\n\t\t\t\tcentered="{short}"\n\t\t\t\tuse:mediator="folders-navigation"\n\t\t\t\tdisabled="{attrs.disabled}"\n\t\t/>\n\t</fn:if>\n\n\t<b:dropdown fn:if="type === \'moreLettersActions\'"\n\t\t\t\tico="more-hor"\n\t\t\t\tpure\n\t\t\t\ttext="{i18n(\'Ещё\')}"\n\t\t\t\tshort\n\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\tqa:id="more_letters_actions"\n\t>\n\t\t<fn:match name="items" args="dropdownArgs">\n\t\t\t<b:list>\n\t\t\t\t<fn:if test="attrs.allRead">\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\tremit:click="mark:allreaded:before"\n\t\t\t\t\t\tqa:id="allRead"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t<b:ico name="status:read" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Отметить все прочитанными\')}</span>\n\t\t\t\t\t</b:list-item>\n\t\t\t\t</fn:if>\n\t\t\t\t<fn:if test="attrs.removeAll">\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\tremit:click="clearActiveFolder"\n\t\t\t\t\t\tqa:id="removeAll"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t<b:ico name="actions:delete" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span bem:elem="text">{_this.getClearActiveFolderLabel()}</span>\n\t\t\t\t\t</b:list-item>\n\t\t\t\t</fn:if>\n\t\t\t</b:list>\n\t\t</fn:match>\n\t</b:dropdown>\n\n\t<b:dropdown fn:if="type === \'move\' && !touch"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tshortcut="v"\n\t\t\ttext="{i18n(\'В папку\')}"\n\t\t\tico="folder-move"\n\t\t\tqa:id="move-to-folder"\n\t\t\tpure\n\t\t\tponymode="{attrs.ponymode}"\n\t\t\tdisable-expand-top\n\t\t\tdisable-expand-center\n\t\t\tdisabled="{!_this.isEnableMove()}"\n\t\t\tsize="{size}"\n\t\t\tshort="{short}"\n\t\t\tico-text-top\n\t>\n\n\t\t<fn:match name="items">\n\t\t\t<b:list-nested-moveto-folder\n\t\t\t\tmodel="{attrs.store.letter}"\n\t\t\t\tfolder="{attrs.store.folder}"\n\t\t\t\tfolders="{attrs.folders}"\n\t\t\t\tlettersFoldersIds="{attrs.lettersFoldersIds}"\n\t\t\t\tallow-new-folder\n\t\t\t\tallow-move="{false}"\n\t\t\t\tremit:move="folder:click"\n\t\t\t\tuse:mediator="pony-mode folders-actions letters-selection"\n\t\t\t\tqa:id="list-moveto-folder"\n\t\t\t/>\n\t\t</fn:match>\n\t</b:dropdown>\n\n\t<b:button2 fn:if="type === \'move\' && touch"\n\t\t\t\tremit:click="move:click"\n\t\t\t\ttext="{i18n(\'В папку\')}"\n\t\t\t\tico="folder-move"\n\t\t\t\tqa:id="move-to-folder"\n\t\t\t\tcompact="{attrs.ponymode}"\n\t\t\t\tpure\n\t\t\t\ttouch="{touch}"\n\t\t\t\ttouch-nav="{touch}"\n\t\t\t\tdisabled="{!_this.isEnableMove()}"\n\t\t\t\tsize="{size}"\n\t\t\t\tshort="{short}"\n\t\t\t\tico-text-top\n\t\t\t\tcentered="{short}"\n\t/>\n\n\t<b:dropdown fn:if="type === \'folders\'"\n\t\t\tpure\n\t\t\tshort\n\t\t\tnav-folders\n\t\t\ttouch="{touch}"\n\t\t\ttouch-nav="{touch}"\n\t\t\tremit:dropdown-change-state="folders-toggle">\n\n\t\t<fn:match name="ctrl" args="attrs">\n\t\t\t<b:button2\n\t\t\t\t\tqa:id="burger-button"\n\t\t\t\t\tremit:click="ctrl-click"\n\t\t\t\t\tico="{attrs.ponymode ? \'navigation:menu_s\' : \'navigation:menu\'}"\n\t\t\t\t\tcompact="{attrs.ponymode}"\n\t\t\t\t\tshort\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tpure="{attrs.pure}"\n\t\t\t\t\tsecondary="{attrs.secondary}"\n\t\t\t\t\tsize="{attrs.size}"\n\t\t\t\t\tcentered="{short}"\n\t\t\t/>\n\n\t\t\t<b:button2\n\t\t\t\t\tqa:id="hide"\n\t\t\t\t\tremit:click="ctrl-click"\n\t\t\t\t\ttext="{i18n(\'Скрыть\')}"\n\t\t\t\t\tico="arrow-back"\n\t\t\t\t\tcompact="{attrs.ponymode}"\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tpure="{attrs.pure}"\n\t\t\t\t\tsecondary="{attrs.secondary}"\n\t\t\t\t\tsize="{attrs.size}"\n\t\t\t\t\tcentered="{short}"\n\t\t\t/>\n\t\t</fn:match>\n\n\t\t<fn:match name="items">\n\t\t\t<b:list-nested-moveto-folder\n\t\t\t\tmodel="{attrs.store.letter}"\n\t\t\t\tfolder="{attrs.store.folder}"\n\t\t\t\tfolders="{attrs.folders}"\n\t\t\t\tlettersFoldersIds="{attrs.lettersFoldersIds}"\n\t\t\t\tallow-new-folder\n\t\t\t\tuse:mediator="pony-mode folders-actions letters-selections"\n\t\t\t\tqa:id="list-moveto-folder"\n\t\t\t/>\n\t\t</fn:match>\n\t</b:dropdown>\n\n\t<b:dropdown-actions fn:if="type === \'more\'"\n\t\t\tuse:mixin="shortcut-title"\n\t\t\tuse:mediator="layout-manager settings-filters-manager unsubscribe-actions calendar-manager translator-manager calls-manager letters-selection"\n\t\t\tqa:id="more"\n\t\t\tmodel="{attrs.store.letter}"\n\t\t\tselectedLettersIds="{attrs.selectedLettersIds}"\n\t\t\tfolder="{attrs.store.folder}"\n\t\t\tdropdown-shortcut="."\n\t\t\ttext="{i18n(\'Ещё\')}"\n\t\t\tico="more-hor"\n\t\t\tcontainer="{_this.getMainFrame()}"\n\n\t\t\tdisable-edit="{attrs[\'disable-edit\']}"\n\n\t\t\tread="{attrs.read}"\n\t\t\tunread="{attrs.unread}"\n\t\t\tflag="{attrs.flag}"\n\t\t\tunflag="{attrs.unflag}"\n\t\t\tarchive="{attrs.archive}"\n\t\t\tinvite-call="{attrs[\'invite-call\']}"\n\t\t\tcreate-event="{attrs[\'create-event\']}"\n\t\t\tcreate-filter="{attrs[\'create-filter\']}"\n\t\t\ttranslate="{attrs.translate}"\n\t\t\tprint="{attrs.print}"\n\n\t\t\treadletter="{attrs.readletter}"\n\t\t\tforward="{attrs.forward}"\n\t\t\tspam="{attrs.spam}"\n\t\t\tspamAbovePrint="{attrs.spamAbovePrint}"\n\t\t\tspamDisabled="{attrs.spamDisabled}"\n\t\t\tunsubscribeAbovePrint="{attrs.unsubscribeAbovePrint}"\n\t\t\tunspam="{attrs.unspam}"\n\t\t\tmove="{attrs.move}"\n\t\t\tsuperspam="{attrs.superspam}"\n\n\t\t\tmore="{attrs.readletter}"\n\n\t\t\tdisable-expand-top\n\t\t\tdisable-expand-center\n\t\t\tponymode="{attrs.ponymode}"\n\t\t\tpure\n\t\t\tshort\n\t\t\tico-text-top\n\t\t\tselection-actions\n\t\t\ttouch="{touch}"\n\t\t\tsize="{size}"\n\t/>\n\n\t<b:filters fn:if="(type === \'filters\')"\n\t\t\tqa:id="filters"\n\t\t\tuse:mediator="filter-manager layout-manager settings-manager pony-mode advert-manager todo-manager"\n\t\t\tfolder="{attrs.folder}"\n\t\t\tshort="{attrs.short}"\n\t\t\ttouch="{attrs.touch}"\n\t\t\tautochange="{false}"\n\t\t\tpure\n\t\t\thas-metathreads-settings="{attrs[\'has-metathreads-settings\']}"\n            combineFilterAndFolderName="{attrs.combineFilterAndFolderName}"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/portal-menu-element/portal-menu-element.html")});define("feast-tpl!ui-block/portal-menu-element/portal-menu-element.html",["feast-tpl!app/feast-tpl!ui-block/portal-menu-element/portal-menu-element.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/dropdown-actions/dropdown-actions.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="message" value="{attrs.model}"/>\n\t<fn:var name="folder" value="{message && message.getFolder && message.getFolder() || attrs.folder}"/>\n\t<fn:var name="folders" value="{attrs.folders}"/>\n\t<fn:var name="parentThread" value="{attrs.parentThread}"/>\n\n\t<b:dropdown\n\t\t\tcontainer="{attrs.container}"\n\t\t\tshortcut="{attrs[\'dropdown-shortcut\']}"\n\t\t\ttitle-shortcut="{attrs[\'title-shortcut\']}"\n\t\t\ttitle="{attrs.title}"\n\t\t\ttext="{attrs.text}"\n\t\t\tico="{attrs.ico}"\n\t\t\tshort\n\t\t\tponymode="{attrs.ponymode}"\n\t\t\tpure="{attrs.pure}"\n\t\t\tsecondary="{attrs.secondary}"\n\t\t\ttouch="{attrs.touch}"\n\t\t\ttouch-nav="{attrs[\'touch-nav\']}"\n\t\t\texpand-left="{attrs[\'expand-left\']}"\n\t\t\tdisable-expand-top="{attrs[\'disable-expand-top\']}"\n\t\t\tdisable-expand-center="{attrs[\'disable-expand-center\']}"\n\n\t\t\tsize="{attrs.size}"\n\t\t\tradar-id="ctrl"\n\t\t\tremit:dropdown-change-state="dropdown-change"\n\t\t>\n\n\t\t<fn:match name="items" args="dropdownArgs">\n\t\t\t<b:list\n\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\tshortcut\n\t\t\t\tref="list"\n\t\t\t>\n\t\t\t\t\x3c!-- Блок №1 – "Ответ на письмо" --\x3e\n\t\t\t\t<fn:if test="attrs.reply">\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\tdisabled="{!_this.isEnableReply()}"\n\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\tqa:id="reply"\n\n\t\t\t\t\t\tremit:click="compose:reply"\n\t\t\t\t\t\tevent:details="message"\n\n\t\t\t\t\t\tshortcut="r"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t<b:ico name="reply" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Ответить\')}</span>\n\t\t\t\t\t\t<span bem:elem="hint">\n\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\tshortcut="r"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\n\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\tdisabled="{!_this.isEnableReply()}"\n\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\tqa:id="replyall"\n\n\t\t\t\t\t\tremit:click="compose:replyall"\n\t\t\t\t\t\tevent:details="message"\n\n\t\t\t\t\t\tshortcut="shift+r"\n\n\t\t\t\t\t\tfn:if="attrs.reply == \'all\'"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t<b:ico name="reply-all" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Ответить всем\')}</span>\n\t\t\t\t\t\t<span bem:elem="hint">\n\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\tshortcut="shift+r"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\tdisabled="{!_this.isEnableForward()}"\n\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\tqa:id="forward"\n\n\t\t\t\t\t\tremit:click="compose:forward"\n\t\t\t\t\t\tevent:details="message"\n\n\t\t\t\t\t\tshortcut="f"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t<b:ico name="forward" size="s"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Переслать\')}</span>\n\t\t\t\t\t\t<span bem:elem="hint">\n\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\tshortcut="f"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t<div bem:elem="hr"/>\n\t\t\t\t</fn:if>\n\t\t\t\t\x3c!-- END\\ Блок №1 – "Ответ на письмо" --\x3e\n\n\t\t\t\t\x3c!-- Блок №2 – "Действия над письмами" --\x3e\n\t\t\t\t<fn:if test="attrs.remove || attrs.unsubscribe || attrs.archive || attrs.spam || attrs.unspam || attrs.move">\n\t\t\t\t\t<fn:if test="attrs.remove && _this.isRemoveVisible()">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableRemove()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="remove"\n\n\t\t\t\t\t\t\tremit:click="remove"\n\t\t\t\t\t\t\tevent:details="{model: message,selection: attrs[\'selection-actions\'],parentThread: parentThread}"\n\n\t\t\t\t\t\t\tshortcut="del|command+backspace"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="delete" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">\n\t\t\t\t\t\t\t\t{folder && folder.isTrashLike() ? i18n(\'Удалить навсегда\') : i18n(\'Удалить\')}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="del|command+backspace"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.archive && !attrs[\'archive-force-disabled\']">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableMoveToArchive()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="archive"\n\n\t\t\t\t\t\t\tremit:click="archive"\n\t\t\t\t\t\t\tevent:details="{model: message,selection: attrs[\'selection-actions\'],parentThread: parentThread}"\n\t\t\t\t\t\t\tshortcut="e"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="archive" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'В архив\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="e"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.spam">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="spam"\n\n\t\t\t\t\t\t\tremit:click="spam"\n\t\t\t\t\t\t\tevent:details="{model: message,selection: attrs[\'selection-actions\'],parentThread: parentThread}"\n\n\t\t\t\t\t\t\tshortcut="shift+j"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="spam-on" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Спам\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="shift+j"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.unsubscribe">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="unsubscribe"\n\t\t\t\t\t\t\tremit:click="click:unsubscribe"\n\t\t\t\t\t\t\tevent:details="{selectedLettersIds: attrs.selectedLettersIds}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="spam-on" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Отписаться\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.unspam && !folder.isShareTake()">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="unspam"\n\n\t\t\t\t\t\t\tremit:click="unspam"\n\t\t\t\t\t\t\tevent:details="{model:message, selection:attrs[\'selection-actions\']}"\n\n\t\t\t\t\t\t\tshortcut="shift+j"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="spam-off" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Не спам\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="shift+j"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\x3c!-- Перемещение в папку --\x3e\n\t\t\t\t\t<fn:if test="attrs.move">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableMove()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="folder"\n\n\t\t\t\t\t\t\tid="moveto-folder"\n\n\t\t\t\t\t\t\tremit:click.stop.prevent="click:move"\n\n\t\t\t\t\t\t\tselected="{attrs.expanded}"\n\t\t\t\t\t\t\tnested\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="folder-move" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Переместить в папку\')}</span>\n\t\t\t\t\t\t\t<span bem:elem="nested">\n\t\t\t\t\t\t\t\t<b:ico name="navigation:drop_next" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<div fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hr"/>\n\t\t\t\t</fn:if>\n\t\t\t\t\x3c!-- END\\ Блок №2 – "Действия над письмами" --\x3e\n\n\t\t\t\t\x3c!-- Блок №3 – "Действия над письмами + `мета` действия" --\x3e\n\t\t\t\t<fn:if test="attrs.superspam || attrs.read || attrs.spamAbovePrint || attrs.unsubscribeAbovePrint || attrs.print || attrs.unread || attrs.flag || attrs.unflag || attrs[\'create-event\'] || attrs[\'create-filter\']">\n\t\t\t\t\t<fn:if test="attrs.superspam">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableMoveToSpam()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="superspam"\n\n\t\t\t\t\t\t\tremit:click="superspam"\n\t\t\t\t\t\t\tevent:details="{model:message, selection:attrs[\'selection-actions\']}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="spam-on" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Точно спам\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.read">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{attrs[\'disable-edit\']}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="read"\n\n\t\t\t\t\t\t\tremit:click="mark:readed"\n\t\t\t\t\t\t\tevent:details="{model:message, selection:attrs[\'selection-actions\']}"\n\n\t\t\t\t\t\t\tshortcut="q"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico" bem:mod="read">\n\t\t\t\t\t\t\t\t<b:ico name="status:read" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Пометить прочитанным\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="q"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.unread">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{attrs[\'disable-edit\']}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="unread"\n\n\t\t\t\t\t\t\tremit:click="mark:unreaded"\n\t\t\t\t\t\t\tevent:details="{model:message, selection:attrs[\'selection-actions\']}"\n\n\t\t\t\t\t\t\tshortcut="u"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico" bem:mod="unread">\n\t\t\t\t\t\t\t\t<b:ico name="status:unread" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Пометить непрочитанным\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="u"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.flag">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableMark()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="flag"\n\n\t\t\t\t\t\t\tremit:click="mark:flagged"\n\t\t\t\t\t\t\tevent:details="{model:message, selection:attrs[\'selection-actions\']}"\n\n\t\t\t\t\t\t\tshortcut="i"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico" bem:mod="flag">\n\t\t\t\t\t\t\t\t<b:ico name="actions:favorite_on" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Пометить флажком\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="i"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.unflag">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableMark()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="unflag"\n\n\t\t\t\t\t\t\tremit:click="mark:unflagged"\n\t\t\t\t\t\t\tevent:details="{model:message, selection:attrs[\'selection-actions\']}"\n\n\t\t\t\t\t\t\tshortcut="i"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico" bem:mod="unflag">\n\t\t\t\t\t\t\t\t<b:ico name="actions:favorite_off" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Снять флажок\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="i"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs[\'invite-call\']">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="calls:invite"\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableCall()}"\n\n\t\t\t\t\t\t\tremit:click="calls:invite"\n\t\t\t\t\t\t\tevent:details="{model:message}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="categories:camera" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Предложить звонок\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs[\'create-event\']">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="calendar:create"\n\n\t\t\t\t\t\t\tremit:click="calendar:create"\n\t\t\t\t\t\t\tevent:details="{model:message, createContent:\'web_email_header_select\'}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="calendar-month" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Создать событие\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.spamAbovePrint">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{attrs.spamDisabled}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="spam"\n\n\t\t\t\t\t\t\tremit:click="spam"\n\t\t\t\t\t\t\tevent:details="{model: message,selection: attrs[\'selection-actions\'],parentThread: parentThread}"\n\n\t\t\t\t\t\t\tshortcut="shift+j"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="spam-on" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Спам\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="shift+j"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.unsubscribeAbovePrint">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="unsubscribe"\n\t\t\t\t\t\t\tremit:click="click:unsubscribe"\n\t\t\t\t\t\t\tevent:details="{selectedLettersIds: attrs.selectedLettersIds}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="spam-on" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Отписаться\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.print">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="print"\n\t\t\t\t\t\t\tevent:details="{model: message, selection:attrs[\'selection-actions\']}"\n\t\t\t\t\t\t\tremit:click="print"\n\t\t\t\t\t\t\tshortcut="command+p|ctrl+p"\n\t\t\t\t\t\t\tdisabled="{!_this.isEnablePrint()}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="actions:print" size="s" />\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Распечатать\')}</span>\n\t\t\t\t\t\t\t<span bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="ctrl+p"\n\t\t\t\t\t\t\t\t\tshortcut-mac="cmd+p"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs[\'create-filter\'] && !attrs.mobile">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="settingsfilters:create"\n\n\t\t\t\t\t\t\tevent:details="{model:message, selection:attrs[\'selection-actions\']}"\n\t\t\t\t\t\t\tremit:click="settingsfilters:create"\n\n\t\t\t\t\t\t\tshortcut="shift+l"\n\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableFilterCreate()}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="filter" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Создать фильтр\')}</span>\n\t\t\t\t\t\t\t<span fn:if="!attrs[\'disable-shortcuts\']" bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="shift+l"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs[\'category-feedback\'] && !folder.isShareTake()">\n\t\t\t\t\t\t<fn:var name="category" value="{_this.getCategoryIcon(message, folder)}"/>\n\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{attrs[\'disable-edit\']}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="category-feedback"\n\n\t\t\t\t\t\t\tid="category-feedback"\n\n\t\t\t\t\t\t\tremit:click.stop.prevent="click:category-feedback"\n\n\t\t\t\t\t\t\tselected="{attrs.expanded}"\n\t\t\t\t\t\t\tnested\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico" bem:mod="{category.name}">\n\t\t\t\t\t\t\t\t<b:ico name="{category.icon}" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Категория письма\')}</span>\n\t\t\t\t\t\t\t<span bem:elem="nested">\n\t\t\t\t\t\t\t\t<b:ico name="navigation:drop_next" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.translate">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="translate"\n\t\t\t\t\t\t\tevent:details="{model:message}"\n\t\t\t\t\t\t\tremit:click="translator:show"\n\t\t\t\t\t\t\tshortcut="shift+t"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="wysiwyg:translate" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Перевести письмо\')}</span>\n\t\t\t\t\t\t\t<span bem:elem="hint">\n\t\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\t\tshortcut="shift+t"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="attrs.forward">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableForwardAsAttach()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="forward"\n\n\t\t\t\t\t\t\tremit:click="forward"\n\t\t\t\t\t\t\tevent:details="{model:message, selection:attrs[\'selection-actions\']}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="status:attach" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Переслать как вложение\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<div bem:elem="hr"/>\n\t\t\t\t</fn:if>\n\t\t\t\t\x3c!-- END\\ Блок №3 – "Действия над письмами + `мета` действия" --\x3e\n\n\t\t\t\t\x3c!-- Блок №4 – "Поиск по письму" --\x3e\n\t\t\t\t<fn:if test="attrs.readletter">\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\tqa:id="search:from"\n\n\t\t\t\t\t\tremit:click="search:from"\n\n\t\t\t\t\t\tshortcut="shift+s"\n\t\t\t\t\t>\n\n\t\t\t\t\t\t<span bem:elem="ico" bem:mod="delete">\n\t\t\t\t\t\t\t<b:ico name="search" size="s"/>\n\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Найти все письма\')}</span>\n\t\t\t\t\t\t<span bem:elem="hint">\n\t\t\t\t\t\t\t<b:shortcut-hint\n\t\t\t\t\t\t\t\tshortcut="shift+s"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</b:list-item>\n\t\t\t\t</fn:if>\n\t\t\t\t\x3c!-- END/ Блок №4 – "Поиск по письму" --\x3e\n\n\t\t\t\t\x3c!-- Блок №5 – "Ещё" --\x3e\n\t\t\t\t<fn:if test="attrs.more">\n\t\t\t\t\t<div bem:elem="hr"/>\n\n\t\t\t\t\t<b:list-item\n\t\t\t\t\t\tfn:if="!attrs[\'more-expanded\']"\n\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\tqa:id="letter-more"\n\n\t\t\t\t\t\tid="letter-more"\n\n\t\t\t\t\t\tremit:click.stop.prevent="click:letter-more"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t<b:ico name="navigation:drop_down_big" size="s"/>\n\t\t\t\t\t\t</span>\n\n\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Ещё\')}</span>\n\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t<fn:if test="attrs[\'more-expanded\']">\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableRedirect()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="redirect"\n\t\t\t\t\t\t\tevent:details="{model: message}"\n\t\t\t\t\t\t\tremit:click="redirect"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="wysiwyg:arrow" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Перенаправить\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableForwardAsAttach()}"\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="forward-as-attach"\n\t\t\t\t\t\t\tevent:details="{model: message}"\n\t\t\t\t\t\t\tremit:click="forward"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="status:attach" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Переслать как вложение\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="headers"\n\t\t\t\t\t\t\tevent:details="{model: message}"\n\t\t\t\t\t\t\tremit:click="headers"\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableServiceHeaders()}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="categories:document" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Служебные заголовки\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\tqa:id="download"\n\t\t\t\t\t\t\tevent:details="{model: message}"\n\t\t\t\t\t\t\tremit:click="download"\n\t\t\t\t\t\t\tdisabled="{!_this.isEnableDownload()}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t<b:ico name="actions:download_alt" size="s"/>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Скачать на компьютер\')}</span>\n\t\t\t\t\t\t</b:list-item>\n\n\t\t\t\t\t\t<fn:if test="attrs[\'new-tab-available\']">\n\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\t\tqa:id="newtab"\n\t\t\t\t\t\t\t\tevent:details="{model: message}"\n\t\t\t\t\t\t\t\tremit:click="newtab"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t\t<b:ico name="actions:tab_add" size="s"/>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Открыть в новой вкладке\')}</span>\n\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:if>\n\t\t\t\t\x3c!-- END/ Блок №5 – "Ещё" --\x3e\n\t\t\t</b:list>\n\t\t</fn:match>\n\n\t</b:dropdown>\n</div>\n',"app/feast-tpl!ui-block/dropdown-actions/dropdown-actions.html")});define("feast-tpl!ui-block/dropdown-actions/dropdown-actions.html",["feast-tpl!app/feast-tpl!ui-block/dropdown-actions/dropdown-actions.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/shortcut-hint/shortcut-hint.html",["feast"],function(a){return a.smartParse("<div>\n\t<fn:value>_this.getShortcut()</fn:value>\n</div>\n","app/feast-tpl!ui-block/shortcut-hint/shortcut-hint.html")});define("feast-tpl!ui-block/shortcut-hint/shortcut-hint.html",["feast-tpl!app/feast-tpl!ui-block/shortcut-hint/shortcut-hint.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/shortcut-hint/shortcut-hint",["require","exports","feast","feast-tpl!./shortcut-hint.html","helpers/browser","service/shortcut"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);exports.default=a.default.Block.extend({name:"shortcut-hint",template:b.default,defaults:{shortcut:"","shortuc-mac":"","is-mac":c.default.mac},getShortcut:function(){var a=this.get("shortcut-mac");var b=this.get("shortcut");var c=this.get("is-mac");if(c&&a){return d.default.getShortcutTitle(a)}return d.default.getShortcutTitle(b)}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/dropdown-actions/dropdown-actions",["require","exports","default-values","feast","feast-tpl!./dropdown-actions.html","helpers/folder","helpers/radar-utils","mail/Folder","service/layer","service/radars/decorator","service/submenu","ui-block/dropdown/dropdown","ui-block/ico/ico","ui-block/list/list","ui-block/list-item/list-item","ui-block/list-nested/list-nested","ui-block/shortcut-hint/shortcut-hint"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);var p={newsletters:"categories:mailings",social:"navigation:users",news:"categories:subscriptions",official:"categories:government",receipts:"categories:receipts",travel:"categories:flight",event:"categories:ticket",finance:"categories:currency_rouble",registration:"categories:access",order:"navigation:cart",fees:"categories:government",uncategorized:"categories:mail",tomyself:"categories:self_mail",school:"categories:school",games:"categories:games"};exports.default=b.default.Block.extend((0,h.default)({id:"dropdown",events:[{name:"compose:reply",data:e.getModelData},{name:"compose:replyall",data:e.getModelData},{name:"compose:forward",data:e.getModelData},{name:"mark:readed",data:e.getModelData},{name:"mark:unreaded",data:e.getModelData},{name:"mark:flagged",data:e.getModelData},{name:"mark:unflagged",data:e.getModelData},{name:"remove",data:e.getModelData},{name:"archive",data:e.getModelData},{name:"spam",data:e.getModelData},{name:"unspam",data:e.getModelData},{name:"superspam",data:e.getModelData},{name:"click:move",data:e.getModelData},{name:"search:from",data:e.getModelData},{name:"calendar:create",data:e.getModelData},{name:"print",data:e.getModelData},{name:"calls:invite",data:e.getModelData},{name:"settingsfilters:create",data:e.getModelData},{name:"forward",data:e.getModelData},{name:"translator:show",rename:"trans:click"},{name:"download",rename:"download:eml"},{name:"headers",rename:"headers:open"},"click:category-feedback","click:letter-more","newtab"]})({name:"dropdown-actions",template:c.default,isolateEvents:false,blocks:{dropdown:j.default,list:l.default,"list-nested":n.default,"list-item":m.default,ico:k.default,"shortcut-hint":o.default},defaults:{"nestedmenu-expanded":false,"selection-actions":false,"more-expanded":false,translate:false,"archive-force-disabled":a.ARCHIVE_DISABLED,"new-tab-available":!a.USE_SINGLE_TAB,"disable-shortcuts":a.DISABLE_DROPDOWN_ACTIONS_SHORTCUTS},events:{"click:move":"onMoveToClick","click:category-feedback":"onCategoryFeedbackClick","click:letter-more":"onLetterMoreClick","dropdown-change":"onDropdownChangeState","click:unsubscribe":"onUnsubscribeClick"},didUnmount:function(){i.default.destroy()},didUpdate:function(){if(this._scrollToLastItem&&this.get("more-expanded")){var a=this.refs.list;var b=a.parentNode;try{b.scrollTo({top:1e4,behavior:"smooth"})}catch(a){b.scrollTop=1e4}this._scrollToLastItem=null}},onLetterMoreClick:function(){this._scrollToLastItem=true;this.set("more-expanded",true)},onUnsubscribeClick:function(a){var b=a.details;var c=b.selectedLettersIds;this.broadcast("unsubscribe",{ids:c,position:"more-dropdown"})},onMoveToClick:function(){if(this.is("touch")){var a=this.get("model");g.default.open("move-to-folder",{letter:a},{dimmer:true,mobile:true,resolvable:true})}else{this.toggleSubmenu("moveto-folder")}},onCategoryFeedbackClick:function(){this.toggleSubmenu("category-feedback")},toggleSubmenu:function(a){var b=this.get("nestedmenu-expanded");if(!b){var c=this.ids[a];var d={folders:this.get("folders"),model:this.get("model"),"dark-mode":this.get("dark-mode"),metathreads:this.get("metathreads"),parentThread:this.get("parentThread")};i.default.open(a,d,c)}},onDropdownChangeState:function(a){var b=a.details.state;if(!b){i.default.close();this.set({"nestedmenu-expanded":false,"more-expanded":false})}},getCategoryIcon:function(a,b){var c=a.get("transaction_category");var d=b.isMetathread()&&b.get("type");var e=c||d||"uncategorized";return{name:e,icon:p[e]}},getCurrentFoldersIds:function(){var a=this.get("route");if(a.is("#read-letter #search-letter")){var b=this.get("model");return[b.get("folder")]}var c=this.get("lettersFoldersIds");if(c.length){return c}return[this.get("folder").id]},checkFolderGrant:function(a){var b=this.getCurrentFoldersIds();return b.every(function(b){var c=f.default.all.get(b);return c.checkGrant(a)})},isEnableReply:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.reply)},isEnableForward:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.forward)},isEnableRedirect:function(){return this.checkFolderGrant(f.default.SHARE_GRANTS.redirect_everywhere)},isEnableForwardAsAttach:function(){return this.checkFolderGrant(f.default.SHARE_GRANTS.forward_as_attachment)},isEnableMove:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.move)},isEnableRemove:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.remove)},isRemoveVisible:function(){return!(0,d.isDeleteFromFolderDisabled)(this.get("folder"))},isEnableMark:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.mark_as_important)},isEnableMoveToSpam:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.move_to_spam)},isEnableMoveToArchive:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.move_to_archive)},isEnablePrint:function(){return this.isEverySelectedFoldersMine()},isEnableDownload:function(){return this.isEverySelectedFoldersMine()},isEnableServiceHeaders:function(){return!a.DISABLE_LETTER_HEADERS_BUTTON&&this.isEverySelectedFoldersMine()},isEnableCall:function(){return this.checkFolderGrant(f.default.SHARE_GRANTS.reply)},isEnableFilterCreate:function(){return this.isEverySelectedFoldersMine()},isEverySelectedFoldersMine:function(){var a=this.getCurrentFoldersIds();return a.every(function(a){var b=f.default.all.get(a);return!b.isShareTake()})}}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/portal-menu-element/portal-menu-element",["require","exports","@mail/xray","default-values","feast","feast-tpl!./portal-menu-element.html","helpers/radar-utils","mail/Folder","service/layer","service/radars/decorator","ui-block/button2/button2","ui-block/dropdown/dropdown","ui-block/dropdown-actions/dropdown-actions","ui-block/filters/filters","ui-block/layout/layout","ui-block/list-nested-moveto-folder/list-nested-moveto-folder","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);exports.default=c.default.Block.extend((0,h.default)({prop:"type",events:[{name:"move:click",rename:"mobile",data:e.getLetterData},{name:"remove",data:e.getLetterData,default:true},{name:"archive",data:e.getLetterData,default:true},{name:"spam",data:e.getLetterData,default:true},{name:"unspam",data:e.getLetterData,default:true},{name:"move",data:e.getLetterData,default:true},{name:"translate",data:e.getLetterData,default:true},{name:"compose:reply",data:e.getLetterData,default:true},{name:"compose:replyall",data:e.getLetterData,default:true},{name:"compose:forward",data:e.getLetterData,default:true},{name:"compose:new",default:true},{name:"mark:readed",default:true},"select:all","select:drop","letter:prev","letter:next","letter:back","search:back","back:to:parent:folder"]})({name:"portal-menu-element",template:d.default,isolateEvents:false,blocks:{button2:i.default,dropdown:j.default,"dropdown-actions":k.default,filters:l.default,"list-nested-moveto-folder":n.default},lazyBlocks:{unsubscribe:o.lazyUIUnsubscribe},defaults:{"has-metathreads-settings":false,deselectLabelReset:b.DESELECT_ALL_LABEL_STYLE==="reset"||b.NEW_TOOLBAR},events:{"folders-toggle":"onFoldersToggle","move:click":"onMoveToClick","folder:click":"onFolderClick",clearActiveFolder:"onClearActiveFolder","mark:allreaded:before":"onMarkAllreadedBefore"},didMount:function(){if(this.get("type")==="backToParentFolder"&&!this.get("hidden")){var b=this.get("folder");var c=this.get("parentFolder");a.default.send("back-to-parent-show",{dwh:{pos:"logo",folder:b===null||b===void 0?void 0:b.id,parentFolder:c===null||c===void 0?void 0:c.id}})}},useReactSearchPanel:function(){return b.SEARCH_PANEL_REACT},usePortalSearchPanel:function(){return b.SEARCH_PANEL_PORTAL},useNewToolbar:function(){return b.NEW_TOOLBAR},getBackIcon:function(){if(!this.useNewToolbar()){return"arrow-back"}if(this.get("type")==="deselect-back"){return"actions:close_big"}return"navigation:arrow_previous"},onFoldersToggle:function(a){this.set("folder-overflow",a.details.state)},onFolderClick:function(a){this.broadcast("move",Object.assign(a.details,{selection:true,model:undefined}))},onMoveToClick:function(){g.default.open("move-to-folder",{folders:this.get("folders"),letter:this.get("model")},{dimmer:false,mobile:true,resolvable:false})},getCurrentFoldersIds:function(){var a=this.get("store");if(a.route.is("#read-letter #search-letter")){var b=a.letter;return[b.get("folder")]}var c=this.get("lettersFoldersIds");if(c.length){return c}return[a.folder.id]},checkFolderGrant:function(a){var b=this.getCurrentFoldersIds();return b.every(function(b){var c=f.default.all.get(b);return c.checkGrant(a)})},onClearActiveFolder:function(){var b=this.get("store");var c=b.folder;a.default.send("folder-more-clear-click",{dwh:{folder:c.id}});this.broadcast("clear",{model:c})},onMarkAllreadedBefore:function(){var b=this.get("store");var c=b.folder;a.default.send("folder-more-allread-click",{dwh:{folder:c.id}});this.broadcast("mark:allreaded")},getClearActiveFolderLabel:function(){var a=this.get("store");var b=a.folder;if(b.isInbox()||b.isNewsletters()||b.isToMyself()||b.isOfficial()){return"".concat(i18n("Удалить")," ").concat(b.attributes.name.toLowerCase())}return i18n("Удалить все письма")},isEnableReply:function(){if(this.get("disabled")){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.reply)},isEnableForward:function(){if(this.get("disabled")){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.forward)},isEnableMove:function(){if(this.get("disabled")){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.move)},isEnableRemove:function(){if(this.get("disabled")){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.remove)},isEnableMoveToSpam:function(){if(this.get("disabled")){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.move_to_spam)},isEnableMoveToArchive:function(){if(this.get("disabled")){return false}return this.checkFolderGrant(f.default.SHARE_GRANTS.move_to_archive)},isShowUnspam:function(){if(this.get("disabled")){return false}var a=this.get("store").letter;var b=this.get("store").folder||a.getFolder();return b.isShareTake()},getParentFolderName:function(){var a;return(a=this.get("parentFolder"))===null||a===void 0?void 0:a.get("name")},needBackToParentShortcut:function(){return b.BACK_TO_PARENT_SHORTCUT},getMainFrame:function(){return b.NEW_TOOLBAR?m.default.getLayoutById("main").refs["main-frame"]:null}}))});define("feast-tpl!app/feast-tpl!ui-block/portal-menu-logo/portal-menu-logo.html",["feast"],function(a){return a.smartParse('<div qa:id="portal-menu-logo">\n\t<fn:var name="readMode" value="{attrs.readMode}"/>\n\t<fn:var name="selectMode" value="{attrs.selectMode}"/>\n\t<fn:var name="searchRoute" value="{attrs.route.is(\'#search #search-letter\')}"/>\n\t<fn:var name="filterRoute" value="{attrs.route.is(\'#letters #read-letter\') && attrs.route.filterQuery.has()}"/>\n\t<fn:var name="layoutType" value="{attrs.layoutType}"/>\n\t<fn:var name="ponyMode" value="{attrs.ponyMode}"/>\n\t<fn:var name="hideLogo" value="{_this.hideLogo}"/>\n\n\t<fn:var name="isShortcutLogo" value="{attrs.compact}"/>\n\n\t\x3c!-- То же условие что и для лого, но в перспективе может поменяться и по смыслу не то же, так что разделяем --\x3e\n\t<fn:var name="isShortcutButton" value="{isShortcutLogo}"/>\n\n\t<fn:var name="showBackToListButton" value="{layoutType === \'2pane\' && readMode}"/>\n\t<fn:var name="showBackToParentFolderButtonAtAll" value="{attrs.needBackToParentFolder}"/>\n\t<fn:var name="showBackToParentFolderButtonAtLogo" value="{_this.needBackToParentFolderButton()}"/>\n\n\t<fn:var name="activeLogoKey" value="{_this.getActiveLogoKey(isShortcutLogo)}" />\n\t<fn:var name="activeLogoSrc" value="{_this.getLogoSrcFromKey(activeLogoKey)}" />\n\t<fn:var name="isActiveLogoAdaptive" value="{_this.isActiveLogoAdaptive(activeLogoKey)}" />\n\n\t<bem:mod name="pony-mode" test="attrs.ponyMode"/>\n\t<bem:mod name="short" test="isShortcutLogo"/>\n\n\t<div bem:elem="content">\n\t\t<bem:mod name="adaptive" test="isActiveLogoAdaptive && !searchRoute && !selectMode && !showBackToListButton" />\n\n\t\t<fn:choose>\n\t\t\t<fn:when test="selectMode">\n\t\t\t\t<span>\n\t\t\t\t\t<fn:var name="marginLeft" value="{\'margin-left: 4px\'}"/>\n\n\t\t\t\t\t\x3c!-- TODO: костыль, перепилить с инлайн стилей на классы --\x3e\n\t\t\t\t\t<fn:attr test="isShortcutButton && ponyMode"\n\t\t\t\t\t\t\t\tname="style"\n\t\t\t\t\t\t\t\tvalue="{marginLeft};"\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\ttype="deselect-back"\n\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\tshort="{isShortcutButton}"\n\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t</fn:when>\n\t\t\t<fn:when test="searchRoute">\n\t\t\t\t<span>\n\t\t\t\t\t<fn:var name="marginLeft" value="{\'margin-left: 8px\'}"/>\n\n\t\t\t\t\t<fn:attr test="isShortcutButton && ponyMode"\n\t\t\t\t\t\t\tname="style"\n\t\t\t\t\t\t\tvalue="{marginLeft};"\n\t\t\t\t\t/>\n\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\ttype="back"\n\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\tshort="{isShortcutButton}"\n\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t</fn:when>\n\t\t\t<fn:otherwise>\n\t\t\t\t<span fn:if="showBackToListButton || readMode && layoutType === \'3pane\' && attrs.ENABLE_BACK_TO_LETTERS_SHORTCUT_3PANE">\n\t\t\t\t\t\x3c!-- TODO: костыль, перепилить с инлайн стилей на классы --\x3e\n\t\t\t\t\t<fn:var name="marginLeft" value="{\'margin-left: 4px\'}"/>\n\n\t\t\t\t\t<fn:attr test="isShortcutButton && ponyMode && showBackToListButton"\n\t\t\t\t\t\t\tname="style"\n\t\t\t\t\t\t\tvalue="{marginLeft};"\n\t\t\t\t\t/>\n\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\t\t\t\ttype="back"\n\t\t\t\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\t\t\t\tshort="{isShortcutButton}"\n\t\t\t\t\t\t\t\t\tnowrap\n\t\t\t\t\t\t\t\t\thidden="{!showBackToListButton}"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\n\t\t\t\t<span fn:if="(showBackToParentFolderButtonAtLogo || showBackToParentFolderButtonAtAll && attrs.enableBackToParentShortcut) && !showBackToListButton">\n\t\t\t\t\t<fn:var name="parentFolder" value="{_this.findParentFolder()}"/>\n\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\ttype="backToParentFolder"\n\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\tshort="{isShortcutButton}"\n\t\t\t\t\t\tnowrap\n\t\t\t\t\t\thidden="{!showBackToParentFolderButtonAtLogo}"\n\t\t\t\t\t\tparentFolder="{parentFolder}"\n\t\t\t\t\t\tfolder="{folder}"\n\t\t\t\t\t\tfolders="{folders}"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\n\t\t\t\t<fn:var name="logo" value="{_this.getLogo()}"/>\n\t\t\t\t<fn:var name="logoWidth" value="{_this.getLogoWidth(logo, isShortcutLogo, ponyMode)}"/>\n\t\t\t\t<fn:var name="logoHeight" value="{_this.getLogoHeight(logo, isShortcutLogo, ponyMode)}"/>\n\t\t\t\t<fn:var name="logoImageWidth" value="{logo.scale ? logoWidth : \'auto\'}"/>\n\t\t\t\t<fn:var name="adaptiveLogoSrc" value="{_this.getAdaptiveLogo(logo)}" />\n\t\t\t\t<fn:var name="rebrandingMedium" value="{_this.isMediumRebrandingLogo(logo, isShortcutLogo)}"/>\n\t\t\t\t<a\n\t\t\t\t\tfn:if="!showBackToListButton && !hideLogo && !showBackToParentFolderButtonAtLogo"\n\t\t\t\t\tbem:elem="logo"\n\t\t\t\t\tbem:mod="{_this.getLogoMod(logo, isShortcutLogo, ponyMode)}"\n\t\t\t\t\theight="{logoHeight}"\n\t\t\t\t\tstyle="width: {logoWidth}px;"\n\t\t\t\t\tremit:click="logo-click"\n\t\t\t\t\tqa:id="{isShortcutLogo ? \'short-logo\' : \'logo\'}"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="compact" test="isShortcutLogo"/>\n\t\t\t\t\t<bem:mod name="pony-mode" test="ponyMode"/>\n\t\t\t\t\t<bem:mod name="hidden" test="!logoWidth"/>\n\t\t\t\t\t<bem:mod name="scale" test="logo.scale"/>\n\t\t\t\t\t<bem:mod name="bg_logo" test="_this.getLogoKind() === \'bg\'"/>\n\t\t\t\t\t<bem:mod name="load_err" test="attrs[\'logo-load-err\']"/>\n\t\t\t\t\t<bem:mod name="load_err_pony" test="ponyMode && attrs[\'logo-load-err\']"/>\n\t\t\t\t\t<bem:mod name="load_err_compact" test="isShortcutLogo && attrs[\'logo-load-err\']"/>\n\t\t\t\t\t<bem:mod name="rebranding-medium" test="rebrandingMedium"/>\n\n\t\t\t\t\t<a\n\t\t\t\t\t\tbem:elem="container"\n\t\t\t\t\t\ttitle="{_this.getLogoTitle(logo)}"\n\t\t\t\t\t\ttarget="{_this.getLogoTarget(logo)}"\n\t\t\t\t\t\thref="{_this.getLogoHref(logo)}"\n\t\t\t\t\t\talt="{logo.alt}"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div bem:elem="image-wrapper">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tfn:if="activeLogoSrc"\n\t\t\t\t\t\t\t\tbem:block="portal-menu-logo__logo__img"\n\t\t\t\t\t\t\t\tsrc="{activeLogoSrc}"\n\t\t\t\t\t\t\t\theight="{logoHeight}"\n\t\t\t\t\t\t\t\twidth="{logoImageWidth}"\n\t\t\t\t\t\t\t\tremit:error="logo-load-error"\n\t\t\t\t\t\t\t\tremit:load="logo-load-success"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<fn:add-class name="hide" test="isActiveLogoAdaptive"/>\n\t\t\t\t\t\t\t</img>\n\n\t\t\t\t\t\t\t\x3c!--- Вторая картирка нужна для адаптивного лого, чтобы во время переходного этапа между шорткатами\n\t\t\t\t\t\t\tи норм видом никакая картинка не отображалась.\n\t\t\t\t\t\t\tЕсли так не сделать, во время загрузки новой картинки будет отображаться старая, а стили уже обновятся\n\t\t\t\t\t\t\t@see https://jira.mail.ru/browse/FMAIL-11793\n\t\t\t\t\t\t\t---\x3e\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tfn:if="adaptiveLogoSrc"\n\t\t\t\t\t\t\t\tbem:block="portal-menu-logo__logo__img"\n\t\t\t\t\t\t\t\tsrc="{adaptiveLogoSrc}"\n\t\t\t\t\t\t\t\theight="{logoHeight}"\n\t\t\t\t\t\t\t\twidth="{logoImageWidth}"\n\t\t\t\t\t\t\t\tremit:error="logo-load-error"\n\t\t\t\t\t\t\t\tremit:load="logo-load-success"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<fn:add-class name="hide" test="!isActiveLogoAdaptive"/>\n\t\t\t\t\t\t\t</img>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a\n\t\t\t\t\t\tbem:elem="container"\n\t\t\t\t\t\ttitle="{_this.getLogoTitleBrand(logo)}"\n\t\t\t\t\t\ttarget="{_this.getLogoTargetBrand(logo)}"\n\t\t\t\t\t\thref="{_this.getLogoHrefBrand(logo)}"\n\t\t\t\t\t    alt="{logo.altBrand}"\n\t\t\t\t\t>\n\t\t\t\t\t\t<bem:mod name="vk_rebranding-medium" test="rebrandingMedium"/>\n\n\t\t\t\t\t\t<fn:var name="rebranding" value="{_this.isRebranding(logo)}"/>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tfn:if="!isShortcutLogo && rebranding"\n\t\t\t\t\t\t\tbem:elem="vk"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<fn:var name="vkSrc" value="{_this.getVkSrc(logo, rebrandingMedium)}"/>\n\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tsrc="{vkSrc}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<fn:add-class name="hide" test="isActiveLogoAdaptive"/>\n\t\t\t\t\t\t\t</img>\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tsrc="{vkSrc}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<fn:add-class name="hide" test="!isActiveLogoAdaptive"/>\n\t\t\t\t\t\t\t</img>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t</a>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/portal-menu-logo/portal-menu-logo.html")});define("feast-tpl!ui-block/portal-menu-logo/portal-menu-logo.html",["feast-tpl!app/feast-tpl!ui-block/portal-menu-logo/portal-menu-logo.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/get-adaptive",["require","exports","helpers/fast-deep-equal","resize-observer-polyfill","./debounce-frame"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.GetAdaptive=void 0;a=__importDefault(a);b=__importDefault(b);function d(a){return typeof a==="function"}var e=function(){function e(e){var f=e.breakpoints,g=e.onResize,h=e.element,i=e.pureBreakpoints;var j=this;this.handleResize=function(b){var c=j.breakpoints.find(function(a){if(!a.conditions){return true}return!!a.conditions(b)});if(d(c.props)){var e=c.props(b);if(j.pureBreakpoints&&c==j.lastBreakpoint&&(0,a.default)(e,j.lastProps)){return}j.onResize(e);j.lastProps=e}else{if(j.pureBreakpoints&&c==j.lastBreakpoint){return}j.onResize(c.props)}j.lastBreakpoint=c};this.breakpoints=f;this.onResize=g;this.pureBreakpoints=i;var k=new c.FrameDebouncer(this.handleResize);this.validateBreakpoints();this.resizeObserver=new b.default(function(a){k.requestDebouncedFrame(a[0].contentRect)});this.resizeObserver.observe(h);this.debouncer=k}e.prototype.validateBreakpoints=function(){var a=this.breakpoints.filter(function(a){return!a.conditions});if(a.length===0){throw new Error("No default breakpoint provided!")}if(a.length>1){throw new Error("Too many default breakpoints provided, expected 1")}};e.prototype.destroy=function(){this.resizeObserver.disconnect();this.debouncer.destroy()};return e}();exports.GetAdaptive=e});var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/portal-menu-logo/portal-menu-logo",["require","exports","@mail/xray","cfg","default-values","feast","feast-tpl!./portal-menu-logo.html","helpers/get-adaptive","mediator/folders-navigation/utils","ui-block/portal-menu-element/portal-menu-element"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);h=__importDefault(h);var i=96;var j=200;var k=16;var l;(function(a){a["src"]="src";a["bgSrcAdaptive"]="bg_src_adaptive";a["bgSrcBig"]="bg_src_big";a["bgSrcSmall"]="bg_src_small"})(l||(l={}));function m(){var a=document.createElement("a");a.href=b.default.urls.logoUrl;a.hostname=window.location.hostname;a.pathname="/imgsmail"+a.pathname;return a.pathname}var n={name:"portal-menu-logo",template:e.default,blocks:{"portal-menu-element":h.default},events:{"logo-load-error":"handleLogoLoadError","logo-load-success":"handleLogoLoadSuccess","logo-click":"onLogoClick"},defaults:{"logo-load-err":false,enableBackToParentShortcut:c.BACK_TO_PARENT_SHORTCUT,ENABLE_BACK_TO_LETTERS_SHORTCUT_3PANE:c.ENABLE_BACK_TO_LETTERS_SHORTCUT_3PANE},hideLogo:c.HIDE_LOGO,constructor:function(){d.default.Block.prototype.constructor.apply(this,arguments);this.onResize=this.onResize.bind(this)},didMount:function(){var a=this;var c=b.default.get("logo.breakpoints")?b.default.get("logo.breakpoints").map(function(a){var b=a.width,c=a.height,d=a.compact;return{conditions:function(a){var c=a.width;return c>=b},props:{width:b,height:c,compact:d,"hide-scale-logo":false}}}):[];this.adaptiveHandler=new f.GetAdaptive({pureBreakpoints:true,breakpoints:__spreadArray(__spreadArray([],c,true),[{conditions:function(b){var c=b.width;if(a.getLogoKind()!=="bg"){return false}return c<a.getBgLogoConfig().fullSizeMinWidth},props:{compact:true,"hide-scale-logo":false}},{conditions:function(){return a.getLogoKind()==="bg"},props:function(){return{compact:false,"hide-scale-logo":false}}},{conditions:function(a){var b=a.width;return b>=j+k*2},props:{compact:false,"hide-scale-logo":false}},{conditions:function(a){var b=a.width;return b>=i+k*2},props:function(){return{compact:false,"hide-scale-logo":true}}},{props:{compact:true,"hide-scale-logo":true}}],false),element:this.el,onResize:this.onResize})},getBgLogoConfig:function(){var a=this.getLogo();return{fullSizeMinWidth:c.PROMO_LOGO_MIN_WIDTH,bgAdaptive:a.bgAdaptive}},getLogo:function(){return b.default.get("logo")},getLogoMod:function(a,b,c){if(a.scale){return"scale"}return"".concat(c?"pony":"normal","_").concat(b?"compact":"wide")},getLogoSize:function(a,b,c){if(a.scale&&this.get("hide-scale-logo")){return{height:0,width:0}}if(a.scale){return{width:"100%",height:"auto"}}if(a.breakpoints){return{width:this.get("width"),height:this.get("height")}}var d=a.sizes[this.getLogoMod(a,b,c)];if(d){return d}return{width:0,height:0}},getVkSrc:function(a,b,d){if(d===void 0){d=this.get("theme")}var e="light";if(c.CONTRAST_LOGO_THEMES.includes(d)){e="contrast"}var f="https://img.imgsmail.ru/static.promo/logo/rebranding/vk_with_stroke_".concat(e,".svg");if(b){f="https://img.imgsmail.ru/static.promo/logo/rebranding/vk_".concat(e,".svg")}if(a.en_lang){f=f.replace(".svg","_en.svg")}return f},isRebranding:function(a){return a.rebranding},isMediumRebrandingLogo:function(a,b){if(!a.rebranding||b){return false}var c=a.en_lang?161:179;return this.get("width")<c},getLogoWidth:function(a,b,c){var d=this.getLogoSize(a,b,c);return d.width},getLogoHeight:function(a,b,c){var d=this.getLogoSize(a,b,c);return d.height},getLogoTitle:function(a){return a.title||i18n("Почта Mail.ru")},getLogoTitleBrand:function(a){return a.titleBrand||i18n("Экосистема VK")},getLogoHref:function(a){return a.href},getLogoHrefBrand:function(a){return a.hrefBrand},getLogoTarget:function(a){return a.target},getLogoTargetBrand:function(a){return a.targetBrand},getLogoAlt:function(a){return a.alt||i18n("Почта Mail.ru")},getLogoAltBrand:function(a){return a.altBrand||i18n("Экосистема VK")},handleLogoLoadError:function(a){var b=a.target;this.set("logo-load-err",true);b.src=m()},handleLogoLoadSuccess:function(a){var c=a.target;if((b.default.logo.bgBig||b.default.logo.bgSmall)&&c.src!==m()){this.set("logo-load-err",false)}},getActiveLogoKey:function(a,b){if(b===void 0){b=this.getLogo()}switch(true){case b.bgAdaptive&&!a:{return l.bgSrcAdaptive}case b.bgBig&&!a:{return l.bgSrcBig}case b.bgSmall&&a:{return l.bgSrcSmall}default:{return l.src}}},getLogoSrcFromKey:function(a,b,c){if(b===void 0){b=this.get("theme")}if(c===void 0){c=this.getLogo()}var d=c["".concat(b,"_").concat(a)];return d||c[a]},getLogoKind:function(){var a=this.getLogo(),b=a.bgBig,c=a.bgSmall,d=a.bgAdaptive;if(b||c||d){return"bg"}return"normal"},isActiveLogoAdaptive:function(a){return a===l.bgSrcAdaptive},findParentFolder:function(){return(0,g.getParentFolder)(this.get("folder"),this.get("folders"))},needBackToParentFolderButton:function(){return this.get("needBackToParentFolder")&&c.BACK_TO_PARENT_AT_LOGO&&c.METATHREAD_BACK_TO_INBOX},getAdaptiveLogo:function(a){if(a===void 0){a=this.getLogo()}var b=this.get("theme");return this.getLogoSrcFromKey(l.bgSrcAdaptive,b,a)},didUnmount:function(){this.adaptiveHandler.destroy()},onResize:function(a){this.set(a)},onLogoClick:function(){var c=b.default.get("rbLogo");var d=Object.keys(c).length>0;var e=this.getLogo();var f=d?"unknown":"default";var g=e&&e.banner_id?e.banner_id:f;if(g!=="unknown"){a.default.sendImmediately("portal-menu-logo_".concat(g,"_click"))}else{a.default.sendImmediately("portal-menu-logo_error",{rlog:"portal-menu-logo_unknown-banner-id",rlog_message:{logo:e}})}}};exports.default=d.default.Block.extend(n)});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("ui-block/portal-menu/breakpoints",["require","exports"],function(require,exports){"use strict";var a,b,c,d,e;Object.defineProperty(exports,"__esModule",{value:true});exports.readingBreakpoints=exports.selectionBreakpoints=exports.mainColumnBreakpoints=exports.mainColumnDefault=exports.Buttons=void 0;var f;(function(a){a["more"]="more";a["remove"]="remove";a["archive"]="archive";a["spam"]="spam";a["unsubscribe"]="unsubscribe";a["unspam"]="unspam";a["move"]="move";a["read"]="read";a["replyAll"]="reply-all";a["reply"]="reply";a["forward"]="forward"})(f=exports.Buttons||(exports.Buttons={}));exports.mainColumnDefault={order:[f.remove,f.move,f.spam,f.unsubscribe,f.unspam,f.archive,f.read,f.more,f.replyAll,f.reply,f.forward]};exports.mainColumnBreakpoints=[{minWidth:852,meta:{"no-short-reply":true}},{minWidth:772},{minWidth:704,modifiers:(a={},a[f.archive]={short:true},a[f.unsubscribe]={short:true},a)},{minWidth:656,modifiers:(b={},b[f.archive]={short:true},b[f.unsubscribe]={short:true},b[f.spam]={short:true},b[f.unspam]={short:true},b)},{minWidth:584,modifiers:(c={},c[f.archive]={short:true},c[f.unsubscribe]={short:true},c[f.spam]={short:true},c[f.unspam]={short:true},c[f.move]={short:true},c)},{minWidth:528,modifiers:(d={},d[f.remove]={short:true},d[f.archive]={short:true},d[f.unsubscribe]={short:true},d[f.spam]={short:true},d[f.unspam]={short:true},d[f.move]={short:true},d)},{minWidth:0,modifiers:(e={},e[f.remove]={short:true},e[f.archive]={short:true},e[f.unsubscribe]={short:true},e[f.spam]={short:true},e[f.unspam]={short:true},e[f.move]={short:true},e[f.replyAll]={short:true},e[f.reply]={short:true},e[f.read]={short:true},e[f.forward]={short:true},e)}];var g=156;var h=40;var i=40;var j=g+h+i;var k=44;exports.selectionBreakpoints=exports.mainColumnBreakpoints.map(function(a){return __assign(__assign({},a),{minWidth:a.minWidth-j})});exports.readingBreakpoints=exports.selectionBreakpoints.map(function(a){return __assign(__assign({},a),{minWidth:a.minWidth+k})})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/portal-menu/portal-menu",["require","exports","@mail/features","default-values","feast","feast-tpl!./portal-menu.html","helpers/allread-button-visible","helpers/debounce-frame","helpers/folder","helpers/get-selected-stats","helpers/letter","mediator/folders-navigation/utils","mediator/layout-manager","mediator/layout-manager/vars","resize-observer-polyfill","service/auth","service/promo","service/radars/decorator","ui-block/filters/filters","ui-block/layout/layout","ui-block/portal-menu-element/portal-menu-element","ui-block/portal-menu-logo/portal-menu-logo","ui-block/search-panel/search-panel","./breakpoints"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.radarPortalMenu=exports.blockSpec=exports.isShortButtonSelectAll=exports.isShortTextAllRead=exports.hasLetterCount=exports.getSelectedCount=exports.getSelectedLettersIdsAndSenders=exports.getBreakpointData=exports.isLettersFromTrustedMailer=exports.getGlobals=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);h=__importDefault(h);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);var w=v.mainColumnBreakpoints.map(function(a){return __assign(__assign({},a),{minWidth:a.minWidth+48})});var x=v.selectionBreakpoints.map(function(a){return __assign(__assign({},a),{minWidth:a.minWidth+48})});function y(c){var d,e,f,h,j,k,l,m,o;var p=c.model;var q=c.layoutType,r=c.selectMode;var s=c.letterNotFound;var t=!!((d=c.route)===null||d===void 0?void 0:d.is("#read-letter #search-letter"))&&!c.selectMode&&!s;var u=q==="3pane";var v=q==="2pane";var w=c.selectedStats||Object.create(null);var x=!!((e=c.route)===null||e===void 0?void 0:e.is("#search #search-letter"));var y=!!((f=c.route)===null||f===void 0?void 0:f.is("#letters #read-letter"))&&!!((h=c.route)===null||h===void 0?void 0:h.filterQuery.has());var z=c.ponyMode;var A=t&&!!((j=c.route)===null||j===void 0?void 0:j.params.part);var B=t?c.letter:null;var C=B&&B.id;var D=B&&B.get("messages").first();var E=(0,i.hasLetterReplyAll)(D);var F=t&&!((k=c.folder)===null||k===void 0?void 0:k.isSpam())||w.nospam>0;var G=t&&!!((l=c.folder)===null||l===void 0?void 0:l.isSpam())||w.spam>0;var H=a.default.has("has-super-spam")||n.default.user.is("has_super_spam");var I=t&&!!((m=c.letterNeighbours)===null||m===void 0?void 0:m.prev);var J=t&&!!((o=c.letterNeighbours)===null||o===void 0?void 0:o.next);var K=!r;var L=B&&B.get("flags.newsletter")&&b.FEATURE_UNSUBSCRIBE;var M=!(0,g.isDeleteFromFolderDisabled)(c.folder);return{store:p,letterNotFound:s,selectedStats:w,layoutType:q,readMode:t,selectMode:r,searchRoute:x,filterRoute:y,ponyMode:z,isDisableEdit:A,letter:B,letterId:C,isReplyAll:E,is3Pane:u,is2Pane:v,isSpam:F,isUnspam:G,hasPrev:I,hasNext:J,hasSuperSpam:H,shouldShowSearch:K,isNewsletter:L,isRemoveVisible:M}}exports.getGlobals=y;function z(a){var b=a.isSpam,c=a.letter,d=a.readMode,e=a.selectMode,f=a.selectedStats;if(!b){return false}if(c&&d){return c.is("flags.newsletter")&&c.is("flags.show_definitely_spam")&&c.is("flags.have_unsubscribe_list")}if(e){var g=f.fromTrustedMailer,h=f.all;return g===h}return false}exports.isLettersFromTrustedMailer=z;function A(a,c,d,e){var f,g,h;var i=z(c);var j={unsubscribeInMoreDropdown:i&&b.UNSUBSCRIBE_IN_MORE_DROPDOWN,unsubscribeInsteadSpam:i&&b.UNSUBSCRIBE_INSTEAD_SPAM};var k=(f=d===null||d===void 0?void 0:d.order)!==null&&f!==void 0?f:e.order;var l=k.map(function(a){if(typeof a==="string"){return{type:a}}return a});var m=(g=d===null||d===void 0?void 0:d.modifiers)!==null&&g!==void 0?g:{};var n=(h=d.meta)!==null&&h!==void 0?h:{};var o=l.reduce(function(a,b){a[b.type]=true;return a},{});var p=B(a,c,o,n,j);var q=l.map(function(a){var b=p[a.type];var c=m[a.type];if(b||c){return Object.assign(a,b,c)}return a});return{actionsList:q,globals:c}}exports.getBreakpointData=A;var B=function(a,c,d,e,f){var g=c.selectMode,h=c.readMode,i=c.selectedStats,j=c.isSpam,k=c.isUnspam,l=c.hasSuperSpam,m=c.isDisableEdit,n=c.letter,o=c.isReplyAll,p=c.isNewsletter,q=c.isRemoveVisible;var r=f.unsubscribeInsteadSpam,s=f.unsubscribeInMoreDropdown;return{archive:{if:!a.folder.isArchive()&&!b.ARCHIVE_DISABLED,disabled:m},forward:{if:h,letter:n,disabled:m},move:{"radar-id":g?"selected":"letter-header",folders:a.folders,disabled:m},remove:{if:q,disabled:m},read:{"radar-id":g?"selected":"letter-header",if:g&&i.unread>0},reply:{if:h,letter:n,short:e["no-short-reply"]?false:o,disabled:m},"reply-all":{if:h&&o,letter:n,disabled:m},spam:{if:!b.FORBID_SPAM&&j&&!r,disabled:m||g&&(a.deselectAll||i.metathread)},unsubscribe:{if:r,letter:n,disabled:m||g&&(a.deselectAll||i.metathread)},unspam:{if:k,disabled:m||g&&a.deselectAll},more:Object.assign({if:h||g},g?{read:i.unread>0,unread:i.read>0,flag:i.noflagged>0,unflag:i.flagged>0,print:i.all===1,archive:!d.archive&&i.noarchive&&!b.ARCHIVE_DISABLED,spam:!b.FORBID_SPAM&&!d.unspam&&j&&!i.metathread,spamDisabled:m||g&&(a.deselectAll||i.metathread),spamAbovePrint:!b.FORBID_SPAM&&!i.metathread&&r,unsubscribeAbovePrint:s,unspam:!d.spam&&k,superspam:l&&!i.metathread&&!a.deselectAll,forward:!i.metathread&&!a.deselectAll,"create-filter":!b.FORBID_FILTERS&&!i.metathread&&!a.deselectAll}:h&&{readletter:true,print:true,"invite-call":b.CALLS&&!b.CALLS_DISABLE_LETTER_CALL&&!(p&&b.CALLS_DISABLE_LETTER_CALL_NEWSLETTERS),"create-event":!b.DISABLE_CREATE_EVENT&&!(p&&b.DISABLE_LETTER_CALENDAR_NEWSLETTERS),"create-filter":!b.FORBID_FILTERS,translate:!b.DISABLE_TRANSLATE,"disable-edit":m,read:n.is("flags.unread"),unread:!n.is("flags.unread"),flag:!n.is("flags.flagged"),unflag:n.is("flags.flagged"),archive:!d.archive&&!n.getFolder().isArchive()&&!b.ARCHIVE_DISABLED,spam:!b.FORBID_SPAM&&!d.spam&&j,spamAbovePrint:!b.FORBID_SPAM&&r,unsubscribeAbovePrint:s,unspam:!d.unspam&&k,superspam:l})}};var C=function(a,b){var c=a.readMode,d=a.letter,e=a.selectMode,f=a.searchRoute;var g=b.selected;if(c&&d){return{ids:[d.get("expand")||"".concat(d.id).split(":")[1]],senders:[d.get("correspondents.from.0.email")]}}if(!e){return{}}return{ids:g.map(function(a){if(f){return"".concat(a.id)}return a.get("expand")||"".concat(a.id).split(":")[1]}),senders:g.map(function(a){return a.get("correspondents.from.0.email")})}};exports.getSelectedLettersIdsAndSenders=C;var D=function(a,b){var c=a.selected,d=a.selectFolder,e=a.folder;var f=b.searchRoute;return f?c.length:(0,h.default)(c,d?e:undefined).all};exports.getSelectedCount=D;var E=function(a){var b=a.filter,c=a.folder;if(b.all){return c.is("messages_total")}return(!b.flagged||c.is("messages_flagged"))&&(!b.unread||c.is("messages_unread"))&&(!b.with_attachments||c.is("messages_with_attachments"))};exports.hasLetterCount=E;var F=function(a){var c=a.is2Pane;if(k.layoutManager.isLessThen("s")){return true}if(b.NEW_TOOLBAR&&k.layoutManager.getMainColumn()<180&&c){return true}return k.layoutManager.isLessThen("l")&&k.layoutManager["left-column"]>75};exports.isShortTextAllRead=F;var G=function(a,c,d){var e=a.selectedCount,f=a.sidebarColumn,g=a.newToolbar;var h=c.sortingType,i=c.filter,j=c.ponyMode;var m=d.is2Pane;if(e){return false}if(m){return b.PORTAL_MENU_MORE_FOLDER_ACTIONS?k.layoutManager.getMainColumn()+k.layoutManager.columnRight<250:k.layoutManager.isLessThen("m")}f!==null&&f!==void 0?f:f=k.layoutManager.getSidebarColumn();if(f<=l.columnSidebarM+(b.PORTAL_MENU_MORE_FOLDER_ACTIONS?5:0)){return true}if(b.PORTAL_MENU_MORE_FOLDER_ACTIONS&&f<108&&j){return true}if((!i.all||h&&h!=="D"||g)&&f<=l.columnSidebarXl){return true}var n=k.layoutManager.getLeftColumn()<=b.SHORTCUT_LEFT_COLUMN_LIMIT;if(n&&f<=l.columnSidebarXl){return true}return false};exports.isShortButtonSelectAll=G;exports.blockSpec={name:"portal-menu",template:d.default,blocks:{layout:r.default,"portal-menu-element":s.default,"portal-menu-logo":t.default,"search-panel":u.default,filters:q.default},events:{},defaults:{selected:[],readAllInProgress:false},attrChanged:{selected:function(){if(!this.isMounted()){return}this.set("selectedStats",this.getSelectedStats())},selectMode:function(){o.default.update()}},constructor:function(){c.default.Block.prototype.constructor.apply(this,arguments);this.setDefaultBreakpoint();this.handleResize=this.handleResize.bind(this);this.frameDebouncer=new f.FrameDebouncer(this.handleResize);this.createResizeObserver()},useReactSearchPanel:function(){return b.SEARCH_PANEL_REACT},usePortalSearchPanel:function(){return b.SEARCH_PANEL_PORTAL},setDefaultBreakpoint:function(){this._currentBreakpoint=w[w.length-1]},didMount:function(){this.updateListeners()},isSelectAllVisible:function(a){return(0,e.isAllreadButtonVisible)(a,this.get("model"))},isAllReadVisible:function(){return this.isSelectAllVisible(this.get("filter"))&&!this.get("read-all-in-progress")},isRemoveAllVisible:function(){if(!b.PORTAL_MENU_CLEAR_METATHREAD){return false}var a=this.get("folder");var c=this.get("filter");var d=this.get("sortingType");if(!c.all||d&&d!=="D"){return false}return!this.get("selectMode")&&a.isMetathread()&&a.isClearable()},needMoreLettersActions:function(){var a=this.get("layoutType")==="3pane";var c=this.get("selectMode");return b.PORTAL_MENU_MORE_FOLDER_ACTIONS&&a&&!c&&(this.isAllReadVisible()||this.isRemoveAllVisible())},needBackToParentFolder:function(){return!!(this.get("showBackToParentFolder")&&(0,j.getParentFolder)(this.get("folder"),this.get("folders")))},hasLetterCount:function(){return(0,exports.hasLetterCount)(this.getAttrs())},getPaddingLeft:function(a,b,c){if(a=="2pane"){if(c&&b){return 32}return 28}if(c){if(b){return 20}return 16}return 24},getPaddingRight:function(a,b,c){if(!b){return 20}if(a.type=="3pane"){if(c){return 8}return 14}return 0},getSelectedCount:function(){return(0,exports.getSelectedCount)(this.getAttrs(),{searchRoute:this.getAttrs().route.is("#search #search-letter")})},getSelectedStats:function(){return(0,h.default)(this.get("selected"))},isShortButtonSelectAll:function(a,b,c,d){return(0,exports.isShortButtonSelectAll)({selectedCount:b},{sortingType:d,filter:c},{is2Pane:a.type==="2pane"})},isRemoveAllButtonShort:function(){var a=this.get("main-column");var b=this.get("right-column");return a+b<=275},getAttrs:function(){return this.attrs},isShortTextAllRead:function(){return(0,exports.isShortTextAllRead)(y(this.getAttrs()))},getCurrentBreakpoint:function(){var a=this.getAttrs();var b=y(a);var c=v.mainColumnDefault;var d=this._currentBreakpoint;return A(a,b,d,c)},getSelectedLettersIdsAndSenders:exports.getSelectedLettersIdsAndSenders,didUpdate:function(){this.updateListeners()},createResizeObserver:function(){var a=this;this.resizeObserver=new m.default(function(b){a.frameDebouncer.requestDebouncedFrame(b)})},updateListeners:function(){this.resizeObserver.disconnect();if(this.refs["actions-list"]){this.resizeObserver.observe(this.refs["actions-list"])}},didUnmount:function(){this.resizeObserver.disconnect()},handleResize:function(a){if(!this.refs["actions-list"]){return}var b=a[0].contentRect.width;var c=this.is("selectMode")?x:w;var d=[-1,c.length-1];while(d[1]-d[0]>1){var e=(d[1]+d[0]-(d[1]+d[0])%2)/2;d[+(c[e].minWidth<=b)]=e}var f=c[d[1]];if(this._currentBreakpoint===f){return}this._currentBreakpoint=f;if(this.isMounted()){this.render()}}};exports.radarPortalMenu=p.default({id:function(a){return a.is("selectMode")?"head-select":"head"}});exports.default=c.default.Block.extend((0,exports.radarPortalMenu)(exports.blockSpec))});define("feast-tpl!app/feast-tpl!ui-block/thread/thread.html",["feast"],function(a){return a.smartParse('<div qa:id="thread" data-transaction-category="{attrs.model.get(\'transaction_category\')}">\n\t<fn:var name="message" value="{attrs.model}" />\n\t<fn:var name="messageSubject" value="{message.get(\'subject\') || i18n(\'<Без темы>\')}" />\n\t<fn:var name="folders" value="{attrs.folders}" />\n\t<fn:var name="isDisableEdit" value="{attrs.route.params.part}" />\n\t<fn:var name="compressed" value="{attrs.ponymode}"/>\n\t<fn:var name="metadata" value="{message.get(\'transaction_metadata\')}" />\n\t<fn:var name="actualLettersEnabled" value="{_this.actualLettersEnabled()}"/>\n\t<fn:var name="reliableSender" value="{message.get(\'messages.0.headers.X-Mailru-Bimi-Organization\')}"/>\n\t<fn:var name="showAttachList" value="{_this.needHideAttachList() ? attrs.showAttachList : true}"/>\n\t<bem:mod name="preview" test="attrs[\'preview-mode\']"/>\n\t<bem:mod name="fluid" test="!attrs.compact"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\t<bem:mod name="rounded" test="attrs.rounded"/>\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="no-divider" test="attrs.noDivider"/>\n\t<bem:mod name="compressed" test="attrs.ponymode"/>\n\n\t<div bem:elem="header">\n\t\t<div\n\t\t\tbem:elem="selected-count"\n\t\t\tfn:if="attrs.selectedLetterCountText"\n\t\t>\n\t\t\t<b:badge text="{attrs.selectedLetterCountText}" size="l"/>\n\t\t</div>\n\n\t\t<fn:if test="!attrs[\'preview-mode\']">\n\t\t\t<div bem:elem="meta-header">\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="_this.parentalControlDieEnabled()">\n\t\t\t\t\t\t<b:letter-meta\n\t\t\t\t\t\t\ttype="parent-filter"\n\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\tuse:mediator="letters-actions themes-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:when test="_this.getMessageFolder().isSpam() && message.get(\'messages.0.flags.blacklist_spam\')">\n\t\t\t\t\t\t<b:letter-meta\n\t\t\t\t\t\t\ttype="spam-blacklist"\n\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\tuse:mediator="letters-actions themes-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:when test="message.meta(\'unread-on-open\') && _this.isShowPromoPush()">\n\t\t\t\t\t\t<b:letter-meta\n\t\t\t\t\t\t\ttype="promo-push-header"\n\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\tuse:mediator="letters-actions themes-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:when test="message.meta(\'unread-on-open\') && actualLettersEnabled && this.get(\'actualReasonFeedback\') && message.get(\'actual_reason\')">\n\t\t\t\t\t\t<b:letter-meta\n\t\t\t\t\t\t\ttype="actual-reason-feedback"\n\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\tuse:mediator="letters-actions themes-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:when test="attrs.showOfficialSender && _this.isOfficialSender(message) && !_this.isTrackingStatusPlate()">\n\t\t\t\t\t\t<b:letter-meta\n\t\t\t\t\t\t\ttype="official-sender"\n\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\tsender="{reliableSender}"\n\t\t\t\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\t\t\t\tdata-test-id="official-sender-promo"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:when test="_this.isShowPlateMailingSubscribe() && message.meta(\'unread-on-open\')">\n\t\t\t\t\t\t<b:letter-meta\n\t\t\t\t\t\t\ttype="newsletter-mailing-subscribe"\n\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\tuse:mediator="letters-actions themes-manager"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:when test="_this.isShowCategoryFeedbackPlate() && message.meta(\'unread-on-open\')">\n\t\t\t\t\t\t<b:letter-meta\n\t\t\t\t\t\t\ttype="category-feedback"\n\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\t\t\t\tonShowCategoryFeedbackPlate="{_this.onShowCategoryFeedbackPlate.bind(this)}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:when test="attrs.showReliableSender && _this.isReliableSender(message) && !_this.isTrackingStatusPlate()">\n\t\t\t\t\t\t<b:letter-meta\n\t\t\t\t\t\t\ttype="reliable-sender"\n\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\tsender="{reliableSender}"\n\t\t\t\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\t\t\t\tdata-test-id="reliable-sender-promo"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:when test="_this.isFakeDoorFmail18333Visible(message)">\n\t\t\t\t\t\t<b:letter-meta\n\t\t\t\t\t\t\ttype="fake-door-header-fmail-18333"\n\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t</fn:choose>\n\t\t\t</div>\n\n\t\t\t\x3c!-- FMAIL-7550: плашка над письмом для отправителей выбранных доменов --\x3e\n\t\t\t<fn:if test="!_this.isTrackingStatusPlate()">\n\t\t\t\t<b:promo-domain-die\n\t\t\t\t\tmodel="{message}"\n\t\t\t\t\tsenderEmail="{_this.getSenderEmail(message)}"\n\t\t\t\t\treceivers="{_this.getReceivers(message)}"\n\t\t\t\t\tdark-mode="{attrs[\'dark-mode\']}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</fn:if>\n\n\t\t<div bem:elem="subject-line">\n\t\t\t<b:thread-subject\n\t\t\t\tkey="{messageSubject}"\n\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\tsubject="{messageSubject}"\n\t\t\t/>\n\n\t\t\t<fn:if test="!attrs[\'disable-category\'] && !message.getFolder().isSpam() && !attrs.mobile && !attrs.selectedLetterCountText">\n\t\t\t\t<fn:if test="message.get(\'transaction_category\')">\n\t\t\t\t\t<fn:var name="category" value="{message.get(\'transaction_category\')}"/>\n\t\t\t\t</fn:if>\n\n\t\t\t\t\x3c!-- OCTAVIUS-3672 --\x3e\n\t\t\t\t\x3c!-- Скрываем категорию event или fees, если есть соответствующая плашка --\x3e\n\t\t\t\t<fn:var name="hideCategory" value="{_this.isHideCategory(message)}"/>\n\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="attrs[\'category-feedback\'] && !message.getFolder().isShareTake()">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tbem:elem="category"\n\t\t\t\t\t\t\tfn:if="_this.hasCategory(message) && !hideCategory"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\x3c!-- Смена категории письма, включая письма в метатредах --\x3e\n\t\t\t\t\t\t\t<b:category-feedback\n\t\t\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\t\t\tuse:mediator="settings-manager themes-manager"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tbem:elem="category"\n\t\t\t\t\t\t\tfn:if="category && !hideCategory"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\x3c!-- Плашка категории в письме --\x3e\n\t\t\t\t\t\t\t<b:letter-category name="{category}" short="{attrs.touch}"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</fn:if>\n\t\t</div>\n\n\t\t<fn:var name="resendData" value="{_this.getResendData()}" />\n\n\t\t<fn:if test="!attrs.isResendDropdownDisabled && resendData">\n\t\t\t<b:react-async\n\t\t\t\tcomponent="ResendDropdown"\n\t\t\t\tclass-name="thread__resend-dropdown"\n\t\t\t\tresendFrom="{resendData.from}"\n\t\t\t\tresendTo="{resendData.to}"\n\t\t\t\tresendDate="{resendData.date}"\n\t\t\t\treceivedDate="{resendData.receivedDate}"\n\t\t\t\tdarkMode="{attrs[\'dark-mode\']}"\n\t\t\t/>\n\t\t</fn:if>\n\n\t\t<fn:if test="_this.needLetterMeta()">\n\t\t\t<b:letter-meta\n\t\t\t\tmodel="{message}"\n\t\t\t\tmetadata="{metadata}"\n\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\tcalendar="{_this.getFirstCalendarAttach()}"\n\t\t\t\tneedSkeleton="{_this.needLetterMetaSkeleton()}"\n\t\t\t\tneedHideAttach="{_this.needHideAttachList()}"\n\t\t\t\tremit:render="letter-meta:render"\n\t\t\t\tremit:letterclick="letter-meta:letterclick"\n\t\t\t\tremit:toggle-ics="letter-meta:toggle-ics"\n\t\t\t\tuse:mediator="themes-manager layout-manager"\n\t\t\t/>\n\t\t</fn:if>\n\t</div>\n\n\t<fn:if test="attrs.hasDraft">\n\t\t<fn:var name="draft" value="{attrs.draft}" />\n\t\t<div bem:elem="letter">\n\t\t\t<bem:mod name="first"/>\n\t\t\t<bem:mod name="expanded"/>\n\t\t\t<fn:choose>\n\t\t\t\t<fn:when test="draft">\n\t\t\t\t\t<b:letter-list-item\n\t\t\t\t\t\tmodel="{draft}"\n\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\tdisabled\n\t\t\t\t\t\tdraft\n\t\t\t\t\t\tdisable-select\n\t\t\t\t\t\tdisable-subject\n\t\t\t\t\t\tdisable-category\n\t\t\t\t\t\tremit:click="draft:open"\n\t\t\t\t\t\tcompressed="{compressed}"\n\t\t\t\t\t/>\n\t\t\t\t</fn:when>\n\t\t\t\t<fn:otherwise>\n\t\t\t\t\t<b:letter-list-item-placeholder\n\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\tcompressed="{compressed}"\n\t\t\t\t\t/>\n\t\t\t\t</fn:otherwise>\n\t\t\t</fn:choose>\n\t\t</div>\n\t</fn:if>\n\n\t<fn:for data="attrs.model.get(\'messages\')" as="letter" key="idx">\n\t\t<div bem:elem="letter" key="{letter.id}" data-id="{letter.id}" qa:id="thread-letter:{idx + 1}" qa:state="open:{!_this.isCollapsed(letter.id)}"\n\t\t\t fn:if="!attrs[\'preview-mode\'] || !_this.isCollapsed(letter.id)"\n\t\t>\n\t\t\t<fn:var name="isFirst" value="{idx == 0}"/>\n\t\t\t<fn:var name="isLast" value="{attrs.model.get(\'length\') == idx + 1}"/>\n\t\t\t<fn:var name="isSingle" value="{attrs.model.get(\'length\') == 1}"/>\n\t\t\t<fn:var name="isDefaultCollapsed" value="{!attrs.model.canUnfoldMessage(letter)}"/>\n\t\t\t<fn:var name="isPrevCollapsed" value="{_this.isPrevCollapsed(idx)}"/>\n\t\t\t<fn:var name="isNextCollapsed" value="{_this.isNextCollapsed(idx)}"/>\n\t\t\t<fn:var name="isSticky" value="{_this.isSticky(letter.id)}"/>\n\t\t\t<fn:var name="isExpanded" value="{!_this.isCollapsed(letter.id)}"/>\n\t\t\t<fn:var name="datesMetadata" value="{_this._formDatesMetadata()}"/>\n\n\t\t\t<bem:mod name="expanded" test="isExpanded"/>\n\t\t\t<bem:mod name="expanded-next" test="!isNextCollapsed"/>\n\t\t\t<bem:mod name="expanded-prev" test="!isFirst && !isPrevCollapsed"/>\n\t\t\t<bem:mod name="collapsed" test="_this.isCollapsed(letter.id) && !attrs[\'preview-mode\']"/>\n\t\t\t<bem:mod name="collapsed-next" test="isNextCollapsed"/>\n\t\t\t<bem:mod name="first" test="isFirst"/>\n\t\t\t<bem:mod name="last" test="isLast"/>\n\t\t\t<bem:mod name="single" test="isSingle"/>\n\n\t\t\t<fn:if test="!_this.isCollapsed(letter.id)">\n\t\t\t\t<b:letter\n\t\t\t\t\troute="{attrs.route}"\n\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\tmodel="{letter}"\n\t\t\t\t\tparentThread="{attrs.model}"\n\t\t\t\t\tfolders="{folders}"\n\t\t\t\t\tautoread="{letter.isDataFully() && !attrs[\'preview-mode\']}"\n\t\t\t\t\tallow-collapse="{attrs.model.get(\'length\') > 1 && !attrs[\'preview-mode\']}"\n\t\t\t\t\treadonly="{attrs[\'preview-mode\']}"\n\t\t\t\t\tsingle="{isSingle}"\n\t\t\t\t\tcollapsed-default="{isDefaultCollapsed}"\n\t\t\t\t\tfirst="{isFirst}"\n\t\t\t\t\tlast="{isLast}"\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tsticky="{_this.isStickyEnabled() && isSticky && attrs.sticky}"\n\t\t\t\t\tshowfolder="{attrs.model.get(\'folder\') != letter.get(\'folder\')}"\n\t\t\t\t\tquotes-collapsed-default="{!isLast}"\n\t\t\t\t\tdisable-category\n\t\t\t\t\tdisable-edit="{isDisableEdit}"\n\t\t\t\t\tcompactTranslator="{attrs.compact}"\n\t\t\t\t\tponymode="{compressed}"\n\t\t\t\t\tdark-mode="{attrs[\'dark-mode\']}"\n\t\t\t\t\texpanded-next="{!isNextCollapsed}"\n\t\t\t\t\tselectMode="{!!attrs.selectedLetterCountText}"\n\t\t\t\t\tpreview-mode="{attrs[\'preview-mode\']}"\n\t\t\t\t\tdates-metadata="{datesMetadata}"\n\t\t\t\t\ttransaction-metadata="{metadata}"\n\t\t\t\t\tshowAttachList="{showAttachList}"\n\n\t\t\t\t\tuse:mediator="user-info layout-manager settings-filters-manager attachments-manager calendar-manager translator-manager addressbook-manager share-folders-manager settings-manager calls-manager marusia-manager thread-scroller"\n\n\t\t\t\t\tremit:clickhead="letter:close"\n\t\t\t\t\tremit:attaches:expanded="letter:expand:attaches"\n\t\t\t\t\tremit:attaches:collapsed="letter:collapsed:attaches"\n\t\t\t\t\tremit:resize="letter:resize"\n\t\t\t\t\tremit:letter-force-recalc="force:recalc"\n\t\t\t\t\tremit:translator:scrollto="translator:scrollto"\n\t\t\t\t\tevent:details="letter"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t\t<fn:if test="_this.isCollapsed(letter.id) && !attrs[\'preview-mode\']">\n\t\t\t\t<div\n\t\t\t\t\tremit:click="letter:open"\n\t\t\t\t\tevent:details="letter"\n\t\t\t\t>\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="attrs.touch">\n\t\t\t\t\t\t\x3c!-- touch 2pane --\x3e\n\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\t\tcomponent="ListLetterCommonTouch"\n\t\t\t\t\t\t\t\tin-thread\n\t\t\t\t\t\t\t\tdisable-subject\n\t\t\t\t\t\t\t\tdisable-select\n\t\t\t\t\t\t\t\tkey="{letter.id}"\n\t\t\t\t\t\t\t\tfirst="{isFirst || !isPrevCollapsed}"\n\t\t\t\t\t\t\t\tlast="{isLast || !isNextCollapsed}"\n\t\t\t\t\t\t\t\tpony-mode="{compressed}"\n\t\t\t\t\t\t\t\tmodel="{letter}"\n\t\t\t\t\t\t\t\tmain-field="from"\n\t\t\t\t\t\t\t\tshowfolder="{attrs.model.get(\'folder\') != letter.get(\'folder\')}"\n\t\t\t\t\t\t\t\twelter="{false}"\n\t\t\t\t\t\t\t\tremit:contextmenu="letter:rightclick"\n\t\t\t\t\t\t\t\tevent:details="letter"\n\t\t\t\t\t\t\t\tuse:mediator="letters-actions"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\x3c!-- desktop 2pane  --\x3e\n\t\t\t\t\t\t<b:list-letter-common\n\t\t\t\t\t\t\t\tin-thread\n\t\t\t\t\t\t\t\tdisable-subject\n\t\t\t\t\t\t\t\tdisable-select\n\t\t\t\t\t\t\t\tdisable-avatar-hover\n\t\t\t\t\t\t\t\tenable-user-select\n\t\t\t\t\t\t\t\tkey="{letter.id}"\n\t\t\t\t\t\t\t\tfirst="{isFirst || !isPrevCollapsed}"\n\t\t\t\t\t\t\t\tlast="{isLast || !isNextCollapsed}"\n\t\t\t\t\t\t\t\tpony-mode="{compressed}"\n\t\t\t\t\t\t\t\tmodel="{letter}"\n\t\t\t\t\t\t\t\tmain-field="from"\n\t\t\t\t\t\t\t\tshowfolder="{attrs.model.get(\'folder\') != letter.get(\'folder\')}"\n\t\t\t\t\t\t\t\twelter="{false}"\n\t\t\t\t\t\t\t\tremit:contextmenu="letter:rightclick"\n\t\t\t\t\t\t\t\tevent:details="letter"\n\t\t\t\t\t\t\t\tuse:mediator="letters-actions layout-manager"\n\t\t\t\t\t\t\t\tlayout-mode="2pane"\n\t\t\t\t\t\t\t\tdark-mode="{attrs[\'dark-mode\']}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\n\t\t\t\x3c!-- Широкий разделитель только вокруг раскрытого треда --\x3e\n\t\t\t<b:delimeter fn:if="!attrs[\'preview-mode\']" full="{isExpanded || !isPrevCollapsed}"/>\n\t\t</div>\n\t</fn:for>\n\n\t<div bem:elem="rounding-footer wrapper">\n\t\t<div bem:elem="rounding-footer" fn:if="_this.usePortalSearchPanel()"></div>\n\t</div>\n\n\t<fn:choose>\n\t\t<fn:when test="attrs.kaspersky && !attrs[\'preview-mode\']">\n\t\t\t<div bem:elem="footer">\n\t\t\t\t<div bem:elem="kaspersky">\n\t\t\t\t\t<b:react-async\n\t\t\t\t\t\tcomponent="KasperskyLogo"\n\t\t\t\t\t\tisEngLogo="{_this.isEngKasperskyLogo()}"\n\t\t\t\t\t\tonLogoLinkClick="{_this.onKasperskyLogoClick}"\n\t\t\t\t\t\tcontrast="{!(attrs.isDarkDefaultMode || attrs.isLightDefaultMode)}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</fn:when>\n\n\t\t<fn:otherwise>\n\t\t\t<div bem:elem="footer" bem:mod="empty"/>\n\t\t</fn:otherwise>\n\t</fn:choose>\n</div>\n',"app/feast-tpl!ui-block/thread/thread.html")});define("feast-tpl!ui-block/thread/thread.html",["feast-tpl!app/feast-tpl!ui-block/thread/thread.html"],function(a){return a});define("mail/actions/MarkAs",["logger","utils/util","RPC","Action","mail/Folder","mail/Message","mail/Thread"],function(a,b,c,d,e,f,g){"use strict";var h=d.extend({models:[],prepare:function(c){var d=c.flag,h="flags."+d,i="length_"+d,j=c.force,k=!!c.state,l=c.models,m={},n={},o={clean:true};var p=function(a,b){var c={};c[h]=a;c[i]=b;return c};var q=function(a,b){if(d==="unread"&&a.is("flags.mention")){if(a instanceof g){var c=a.get("messages").some(function(a){return a.is("flags.mention_unread")});b["flags.mention_unread"]=c}else{b["flags.mention_unread"]=b[h]}}a.set(b,o)};var r=function(a,b){if(d==="unread"&&a.is("flags.mention")){if(k){var c=a.get("messages")[0];if(c&&c.is("flags.mention")){b["flags.mention_unread"]=true}}else{b["flags.mention_unread"]=b[h]}}a.set(b,o)};l=l.filter(function(a){if(a.is(h)!=k||j){var b=g.getByMessageId(a.id),c=a.get("folder"),d=a.get(i);m[c]=(m[c]||0)+(d||1);n[a.id]=p(!k,d);if(b){n[b.id]=p(b.get(h),b.get(i))}else if(a instanceof g){a.get("messages").forEach(function(a){a=f.all.get(a.id);a&&(n[a.id]=p(a.get(h),0))})}return true}});this.models=l;a.add("prepare",{models:{before:c.models.length,after:l.length},counters:m});var s=function(a,b){if(d=="unread"){Object.keys(m).forEach(function(b){e.getSafe(b).increment("messages_unread",m[b]*(a?1:-1),o)})}l.forEach(function(c){var d=g.getByMessageId(c.id);if(c instanceof g){r(c,b?n[c.id]:p(a,+a))}else{q(c,b?n[c.id]:p(a,+a))}if(d){if(b){q(d,n[d.id])}else{d.increment(i,a?1:-1,o);var e={};e[h]=a?true:d.is(i);q(d,e)}}else if(c instanceof g){c.get("messages").some(function(d){d=f.all.get(d.id);if(d){if(b){q(d,n[d.id])}else if(a){if(d.get("folder")==c.get("folder")){var e={};e[h]=true;q(d,e);return true}}else{var e={};e[h]=false;q(d,e)}}})}})};s(k);this.rollbackOperation=b.bindWithoutArgs(s,[!k,true]);return l},operation:function(a,b){return this._markAs(a,b.flag,b.state)},undoOperation:function(a,b){a=this.prepare({flag:b.flag,state:!b.state,models:a});return this._markAs(a,b.flag,!b.state)},_markAs:function(a,d,e){var f={name:d},h,i;function j(b){return g.List.fn.pluck.call(a,b)}f[e?"set":"unset"]=j("id");i=a[0];h={};if(i){f.folder=Number(i.get("folder"))}if(i instanceof g){h.message_id_last=JSON.stringify(b.object(j("id"),j("last")))}h.marks=JSON.stringify([f]);return a.length?c.call(i.markAsUrl,h):Promise.resolve()}});d.register("mail.MarkAs",h);h.version="0.1.1";return h});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/getters/MessageMeta",["require","exports","mail/Message","utils/util"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getCalendarMLEvent=exports.getCalendarIcsEvent=exports.getCategoriesFromMeta=void 0;a=__importDefault(a);b=__importDefault(b);var c=function(c){var d=c.get("meta");var e=d===null||d===void 0?void 0:d.find(function(b){return b["@context"]===a.default.CATEGORY_META.context&&b["@type"]===a.default.CATEGORY_META.type});if(!b.default.isPlainObject(e)||!Array.isArray(e.categories)){return null}return e.categories};exports.getCategoriesFromMeta=c;var d=function(c){var d=c.getMetaInfo("calendar_ics_events");if(!d||!d.length){return null}var e=d.filter(function(c){if(!b.default.isPlainObject(c)){return false}if(!a.default.CALENDAR_ICS_TYPES[c.type]){return false}if(c.type==="cancel"){if(!c.from||!c.to){return false}}else if(!b.default.isPlainObject(c.event_uri)||!c.event_uri.event_id||!c.event_uri.calendar_id){return false}if(c.type==="reply"&&(!b.default.isPlainObject(c.attendee)||!c.attendee.name||!c.attendee.email||!c.status)){return false}return true});return e.length&&e[0]};exports.getCalendarIcsEvent=d;var e=function(a){var c=a.getMetaInfo("calendar_ml_events");if(!c||!c.length){return null}var d=c.filter(function(a){if(!b.default.isPlainObject(a)){return false}if(!b.default.isPlainObject(a.event_uri)||!a.event_uri.event_id||!a.event_uri.calendar_id){return false}return true});return d.length&&d[0]};exports.getCalendarMLEvent=e});define("feast-tpl!app/feast-tpl!ui-block/category-feedback/category-feedback.html",["feast"],function(a){return a.smartParse('<div>\n\t<div ref="container"></div>\n\t<div bem:elem="portal" ref="portal" />\n</div>\n',"app/feast-tpl!ui-block/category-feedback/category-feedback.html")});define("feast-tpl!ui-block/category-feedback/category-feedback.html",["feast-tpl!app/feast-tpl!ui-block/category-feedback/category-feedback.html"],function(a){return a});define("ui-block/category-feedback/category-feedback",["exports","@mail/features","Emitter","feast","feast-tpl!./category-feedback.html","filters/actions/SaveSeveral","mail/actions/CategoryChange","service/getModule","service/radars/index","service/smokescreen"],function(exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var j=q(a);var k=q(b);var l=q(c);var m=q(d);var n=q(f);var o=q(g);var p=q(h);function q(a){return a&&a.__esModule?a:{default:a}}exports.default=l.default.Block.extend({name:"category-feedback",template:m.default,defaults:{html:""},constructor:function a(){l.default.Block.apply(this,arguments);this.onModelChange=this.onModelChange.bind(this)},didUnmount:function a(){this.unrenderUI()},attrChanged:{model:function a(b,c){if(this.ui&&this.getMessage(b)===this.getMessage(c)){this.update()}else{this.renderUI()}},metathreads:function a(){if(this.ui){this.update()}},"dark-mode":function a(){if(this.ui){this.update()}}},renderUI:function a(){var b=this;this.unrenderUI();var c=this.getMessage(this.get("model"));if(!c){(0,p.default)(["category-feedback","no-message"]);return}(0,o.default)("category.feedback").then(function(a){if(!b.isMounted()){return}b.ui=new a.CategoryFeedback(b.refs.container,{model:c,menuContainer:b.refs.portal,tooltipContainer:b.getTooltipContainer()});b.update();c.on("change",b.onModelChange)})},onModelChange:function a(b){if(this.ui&&(b.changes.includes("transaction_category")||b.changes.includes("folder"))){this.update()}},update:function a(){this.ui.injectDependencies(this.getParams());this.ui.render()},unrenderUI:function a(){this.ui&&this.ui.destroy();this.ui=null;var b=this.getMessage(this.get("model"));if(b){b.off("change",this.onModelChange)}},getParams:function a(){return{CategoryChange:n.default,SaveSeveral:e.SaveSeveral,isOctavius:true,isDarkMode:this.is("dark-mode"),features:j.default,bridge:this.getBridge(),metathreads:this.is("metathreads"),scrollable:this.getScrollable()}},getMessage:function a(b){return b&&b.get("messages").find(function(a){return a.getFolder()===b.getFolder()})},getTooltipContainer:function a(){if(!this._tooltipContainer){this._tooltipContainer=document.createElement("div");document.body.appendChild(this._tooltipContainer)}return this._tooltipContainer},getBridge:function a(){if(!this._bridge){this._bridge=new k.default;this._bridge.on("radar",function(a){var b=a.chain;(0,p.default)(b)})}return this._bridge},getScrollable:function a(){var b=this.refs.container;var c=(0,i.selector)(".scrollable");while(b&&b!==document){if(b.matches(c)){return b}b=b.parentNode}}})});define("feast-tpl!app/feast-tpl!ui-block/letter-list-item/letter-list-item.html",["feast"],function(a){return a.smartParse('<a\n\tremit:click="clickletter"\n\tqa:id="letter-item:subject:{attrs.model.get(\'subject\') || i18n(\'<Без темы>\')}"\n>\n\n\t<fn:var name="compressed" value="{attrs.compressed}"/>\n\t<fn:var name="message" value="{attrs.model}"/>\n\t<fn:var name="messageFolder" value="{message.getFolder()}"/>\n\t<fn:var name="messageSubject" value="{message.get(\'subject\') || i18n(\'<Без темы>\')}" />\n\n\t<fn:var name="selectMode" value="{attrs[\'select-mode\']}"/>\n\t<fn:var name="selectable" value="{!attrs[\'disable-select\']}"/>\n\t<fn:var name="isDraft" value="{attrs.draft}"/>\n\n\t<fn:if test="message.isHigh()">\n\t\t<fn:var name="category" value="important"/>\n\t</fn:if>\n\n\t<fn:if test="!attrs[\'disable-category\'] && message.get(\'transaction_category\') && !messageFolder.isSpam()">\n\t\t<fn:var name="category" value="{message.get(\'transaction_category\')}"/>\n\t</fn:if>\n\n\t\x3c!-- Особый случай, когда у компактного письма без темы приоритет склеивается с папкой --\x3e\n\t<fn:var name="specialCase"\n\t\t\tvalue="{attrs.compact && attrs[\'disable-subject\'] && category}"/>\n\n\t<fn:attr name="data-shortcut" value="list-letter"/>\n\t<fn:attr name="active" test="attrs.selected"/>\n\t<fn:attr name="tabindex" value="-1"/>\n\t<fn:attr name="data-id" value="{message.get(\'id\')}"/>\n\t<fn:attr name="data-draggable-id" value="{message.get(\'id\')}"/>\n\t<fn:attr name="data-uidl-id" value="{message.get(\'last\')}"/>\n\n\t<bem:mod name="unread_{message.is(\'flags.unread\')}"/>\n\t<bem:mod name="flagged_{message.is(\'flags.flagged\')}"/>\n\t<bem:mod name="attach_{message.is(\'flags.attach\')}"/>\n\n\t<bem:mod name="active" test="attrs.active"/>\n\t<bem:mod name="showfolder" test="attrs.showfolder || specialCase || isDraft"/>\n\t<bem:mod name="selected" test="attrs.selected"/>\n\t<bem:mod name="first" test="attrs.first" />\n\t<bem:mod name="last" test="attrs.last" />\n\t<bem:mod name="select-mode" test="selectMode"/>\n\t<bem:mod name="draft" test="isDraft"/>\n\t<bem:mod name="disabled" test="attrs.disabled"/>\n\n\t<bem:mod name="disable-user-select" value="{attrs[\'disable-user-select\'] ? \'on\' : \'off\'}"/>\n\t<bem:mod name="disable-subject" value="{attrs[\'disable-subject\'] ? \'on\' : \'off\'}"/>\n\n\t<bem:mod name="compressed" test="compressed"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\t<bem:mod name="fluid" test="!attrs.compact"/>\n\t<bem:mod name="touch" test="attrs.touch" />\n\t<bem:mod name="swipe-actions-touched" test="attrs[\'swipe-actions-touched\']"/>\n\t<bem:mod name="swipe-actions-visible" test="attrs[\'swipe-actions-visible\']"/>\n\t<bem:mod name="swipe-actions-animated" test="attrs[\'swipe-actions-animated\']"/>\n\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']"/>\n\t<bem:mod name="indent" test="attrs.indent"/>\n\n\t\x3c!-- Пометка прочитанным --\x3e\n\t<fn:match name="status-unread">\n\t\t<div bem:elem="unread" remit:click.prevent="togglestatus:unread" qa:id="unread">\n\t\t\t<bem:mod name="plain" test="!(message.is(\'flags.forward\') || message.is(\'flags.reply\'))"/>\n\t\t\t<b:letter-status2\n\t\t\t\tname="unread"\n\t\t\t\tsmall\n\t\t\t\tforward="{message.is(\'flags.forward\')}"\n\t\t\t\treply="{message.is(\'flags.reply\')}"\n\t\t\t\tstate="{message.is(\'flags.unread\')}"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Пометка важным --\x3e\n\t<fn:match name="status-flag">\n\t\t<div bem:elem="flag" remit:click.prevent="togglestatus:flagged" qa:id="flagged">\n\t\t\t<b:letter-status2\n\t\t\t\tname="flagged"\n\t\t\t\tsmall\n\t\t\t\tstate="{message.is(\'flags.flagged\')}"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Бейдж папки --\x3e\n\t<fn:match name="folder">\n\t\t<fn:choose>\n\t\t\t<fn:when test="isDraft">\n\t\t\t\t<div bem:elem="folder">\n\t\t\t\t\t<b:badge text="{i18n(\'Черновик\')}" size="l"/>\n\t\t\t\t</div>\n\t\t\t</fn:when>\n\t\t\t<fn:when test="specialCase">\n\t\t\t\t<b:letter-category\n\t\t\t\t\tname="{category}"\n\t\t\t\t\tshort="{attrs.showfolder}"\n\t\t\t\t/>\n\n\t\t\t\t<b:badge\n\t\t\t\t\tfn:if="attrs.showfolder"\n\t\t\t\t\ttext="{messageFolder.get(\'name\')}"\n\t\t\t\t\tsize="l"\n\t\t\t\t/>\n\t\t\t</fn:when>\n\t\t\t<fn:when test="attrs.showfolder">\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="message.isSchedule()">\n\t\t\t\t\t\t\x3c!-- Отложенная отправка (когда показываем имя папки) --\x3e\n\t\t\t\t\t\t<div bem:elem="folder">\n\t\t\t\t\t\t\t<b:badge title="{message.get(\'send_date\') | scheduleDate}" text="{messageFolder.get(\'name\')}" size="l"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<div bem:elem="folder">\n\t\t\t\t\t\t\t<b:badge text="{messageFolder.get(\'name\')}" size="l"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</fn:when>\n\t\t</fn:choose>\n\t</fn:match>\n\n\t\x3c!-- Бейдж треда --\x3e\n\t<fn:match name="thread-badge">\n\t\t<fn:var\n\t\t\tname="text"\n\t\t\tvalue="{message.get(\'length\') > 99 ? \'99+\' : message.get(\'length\')}"\n\t\t\ttest="message.get(\'length\') > 1"/>\n\n\t\t<div\n\t\t\tbem:elem="thread-count"\n\t\t\tfn:if="!(attrs[\'disable-subject\'] && attrs.compact) && (text || category)">\n\t\t\t<bem:mod name="1" test="message.get(\'length\') > 1"/>\n\t\t\t<bem:mod name="2" test="message.get(\'length\') > 9"/>\n\t\t\t<bem:mod name="3" test="message.get(\'length\') > 99"/>\n\t\t\t<b:letter-category name="{category}" text="{text}" short="{!text}"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Отложенная отправка (когда не показываем имя папки) --\x3e\n\t<fn:match name="schedule">\n\t\t<fn:if test="!attrs.showfolder">\n\t\t\t<div bem:elem="schedule">\n\t\t\t\t<b:letter-status2\n\t\t\t\t\ttitle="{message.get(\'send_date\') | scheduleDate}"\n\t\t\t\t\tname="schedule"\n\t\t\t\t\tsmall/>\n\t\t\t</div>\n\t\t</fn:if>\n\t</fn:match>\n\n\t\x3c!-- Иконка вложений --\x3e\n\t<fn:match name="attach">\n\t\t<div bem:elem="attach">\n\t\t\t<b:letter-status2\n\t\t\t\tname="attach"\n\t\t\t\tsmall\n\t\t\t\tstate="{true}"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Время отправки письма --\x3e\n\t<fn:match name="date">\n\t\t<div bem:elem="date">\n\t\t\t<fn:value mod="letterDate">message.get(\'date\')</fn:value>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Тема письма --\x3e\n\t<fn:match name="subject">\n\t\t<div\n\t\t\tbem:elem="subject"\n\t\t\tqa:id="subject"\n\t\t>\n\t\t\t<fn:if test="!attrs.search">\n\t\t\t\t{messageSubject}\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="attrs.search">\n\t\t\t\t<b:highlighter\n\t\t\t\t\ttext="{messageSubject}"\n\t\t\t\t\tcolor="{message.meta(\'search_subject.color\')}"\n\t\t\t\t/>\n\t\t\t\t\x3c!-- распорка --\x3e\n\t\t\t\t<fn:value>\' \'</fn:value>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Сниппет --\x3e\n\t<fn:match name="snippet">\n\t\t<div bem:elem="snippet" qa:id="snippet">\n\t\t\t<fn:if test="!attrs.search">\n\t\t\t\t{message.get(\'snippet\')}\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="attrs.search">\n\t\t\t\t<b:highlighter\n\t\t\t\t\ttext="{message.meta(\'search_snippet.value\')}"\n\t\t\t\t\tcolor="{message.meta(\'search_snippet.color\')}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Отправитель --\x3e\n\t<fn:match name="addrs">\n\t\t<div bem:elem="addrs">\n\t\t\t<fn:value mod="correspondent">_this.getCorrespondents()</fn:value>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Аватарка --\x3e\n\t<fn:match name="avatar-wrap">\n\t\t<div bem:elem="avatar-wrap">\n\t\t\t<fn:apply-match name="status-unread" fn:if="!attrs.compact"/>\n\t\t\t<div bem:elem="avatar" remit:click="clickavatar" qa:id="avatar">\n\t\t\t\t<b:avatar\n\t\t\t\t\t\tsize="{attrs.compact && !compressed ? \'m\' : \'s\'}"\n\t\t\t\t\t\tsrc="{_this.getAvatar()}"\n\t\t\t\t\t\tselectable="{selectable}"\n\t\t\t\t\t\tselected="{attrs.selected}"\n\t\t\t\t\t\ttouch="{!attrs[\'hover-support\']}"/>\n\t\t\t</div>\n\t\t\t<fn:apply-match name="status-unread" fn:if="attrs.compact"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Наконец то сам контейнер --\x3e\n\t<b:swipeable use:mediator="swipe-manager"\n\t\t\t\t remit:underlay-changed="underlay:changed"\n\t\t\t\t remit:animation-changed="animation:changed"\n\t\t\t\t remit:pan-changed="pan:changed"\n\n\t\t\t\t max-offset="{attrs.compact ? null : \'170\'}"\n\t\t\t\t disabled="{selectMode}"\n\t\t\t\t id="swipeable">\n\t\t<fn:match name="swipe-underlay">\n\t\t\t\x3c!-- Подложка контейнера --\x3e\n\t\t\t<b:letter-swipe-actions model="{message}"\n\t\t\t\t\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\t\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\t\t\t\t\t\tremit:action-unread="togglestatus:unread"\n\t\t\t\t\t\t\t\t\tremit:action-flagged="togglestatus:flagged"\n\t\t\t\t\t\t\t\t\tremit:action-remove="remove"\n\t\t\t\t\t\t\t\t\tremit:action-spam="spam"\n\t\t\t\t\t\t\t\t\tremit:action-unspam="unspam"\n\t\t\t\t\t\t\t\t\tuse:mediator="layout-manager"/>\n\t\t</fn:match>\n\n\t\t<fn:match name="swipe-header" bem:block="letter-list-item">\n\t\t\t\x3c!-- Аватарка --\x3e\n\t\t\t<fn:apply-match name="avatar-wrap"/>\n\t\t</fn:match>\n\n\t\t<fn:match name="swipe-content" bem:block="letter-list-item">\n\t\t\t<div bem:elem="info">\n\n\t\t\t\t<fn:if test="attrs.compact">\n\t\t\t\t\t<div bem:elem="content">\n\t\t\t\t\t\t<div bem:elem="column" bem:mod="1">\n\t\t\t\t\t\t\t<fn:apply-match name="addrs"/>\n\t\t\t\t\t\t\t<fn:apply-match name="subject" fn:if="!attrs[\'disable-subject\']"/>\n\t\t\t\t\t\t\t<fn:apply-match name="snippet"/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div bem:elem="column" bem:mod="2">\n\t\t\t\t\t\t\t<fn:apply-match name="date"/>\n\t\t\t\t\t\t\t<fn:apply-match name="thread-badge" fn:if="!compressed"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div bem:elem="footer">\n\t\t\t\t\t\t<fn:apply-match name="folder" fn:if="!attrs[\'disable-letter-item-folder\']"/>\n\t\t\t\t\t\t<fn:apply-match name="schedule" fn:if="message.isSchedule()"/>\n\t\t\t\t\t\t<fn:apply-match name="attach" fn:if="message.is(\'flags.attach\')"/>\n\t\t\t\t\t\t<fn:apply-match name="status-flag"/>\n\t\t\t\t\t\t<fn:apply-match name="thread-badge" fn:if="compressed"/>\n\t\t\t\t\t</div>\n\t\t\t\t</fn:if>\n\n\t\t\t\t<fn:if test="!attrs.compact">\n\t\t\t\t\t<fn:apply-match name="addrs"/>\n\t\t\t\t\t<fn:apply-match name="status-flag"/>\n\t\t\t\t\t<fn:apply-match name="thread-badge"/>\n\n\t\t\t\t\t<div bem:elem="subject-wrapper">\n\t\t\t\t\t\t<fn:apply-match name="subject" fn:if="!attrs[\'disable-subject\']"/>\n\t\t\t\t\t\t<fn:apply-match name="snippet"/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div bem:elem="info-wrapper">\n\t\t\t\t\t\t<fn:apply-match name="folder" fn:if="!attrs[\'disable-letter-item-folder\']"/>\n\t\t\t\t\t\t<fn:apply-match name="schedule" fn:if="message.isSchedule()"/>\n\t\t\t\t\t\t<fn:apply-match name="attach" fn:if="message.is(\'flags.attach\')"/>\n\t\t\t\t\t\t<fn:apply-match name="date"/>\n\t\t\t\t\t</div>\n\t\t\t\t</fn:if>\n\t\t\t</div>\n\t\t</fn:match>\n\t</b:swipeable>\n</a>\n',"app/feast-tpl!ui-block/letter-list-item/letter-list-item.html")});define("feast-tpl!ui-block/letter-list-item/letter-list-item.html",["feast-tpl!app/feast-tpl!ui-block/letter-list-item/letter-list-item.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/letter-status2/letter-status2.html",["feast"],function(a){return a.smartParse('<div qa:id="{attrs.name}:{attrs.state}">\n\t<fn:var name="data" value="{_this.getData()}"/>\n\n\t<bem:mod name="{attrs.name}"/>\n\t<bem:mod name="{attrs.state}"/>\n\t<bem:mod name="disabled" test="attrs.disabled"/>\n\n\t<b:button2\n\t\t\tico="{data.ico}"\n\t\t\tico-hover="{data.icoHover}"\n\t\t\ttitle="{data.title}"\n\t\t\tdisabled="{attrs.disabled}"\n\t\t\tsize="{attrs.size}"\n\t\t\ttouch="{attrs.touch}"\n\t\t\tcompact="{attrs.compact}"\n\t\t\tsmall="{attrs.small}"\n\t\t\tremit:click="button-click"\n\t\t\tsecondary\n\t\t\tcentered\n\t/>\n</div>\n',"app/feast-tpl!ui-block/letter-status2/letter-status2.html")});define("feast-tpl!ui-block/letter-status2/letter-status2.html",["feast-tpl!app/feast-tpl!ui-block/letter-status2/letter-status2.html"],function(a){return a});define("ui-block/letter-status2/letter-status2",["exports","feast","feast-tpl!./letter-status2.html","ui-block/button2/button2","ui-block/ico/ico"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend({name:"letter-status2",template:f.default,blocks:{ico:h.default,button2:g.default},defaults:{name:"unread",state:false,reply:false,forward:false,disabled:false},getData:function a(){var b=this.get("state");var c=this.get("forward");var d=this.get("reply");switch(this.get("name")){case"schedule":return{ico:"status:time",title:this.get("title")};case"attach":return{ico:"attach"};case"flagged":return{ico:b?"actions:favorite_on":"actions:favorite_off",title:b?i18n("Снять флажок"):i18n("Пометить флажком")};case"unread":var e="point";var f="point";if(b){e="point";f=""}else if(c&&d){e="mail_20:actions:forward_reply_small"}else if(c){e="mail_20:actions:forward_small"}else if(d){e="mail_20:actions:reply_small"}else{f=""}return{ico:e,icoHover:f,title:b?i18n("Пометить прочитанным"):i18n("Пометить непрочитанным")};case"dark-mode":return{ico:"logotypes:idea",title:b?i18n("Выключить тёмный режим"):i18n("Включить тёмный режим")}}},didMount:function a(){this.el.classList.add("stop-animate")}})});define("ui-block/letter-list-item/letter-list-item",["exports","default-values","feast","feast-mod/correspondents","feast-mod/letter-date","feast-tpl!./letter-list-item.html","helpers/browser","helpers/radar-utils","service/layer","service/radars/decorator","ui-block/avatar/avatar","ui-block/badge/badge","ui-block/highlighter/highlighter","ui-block/letter-category/letter-category","ui-block/letter-status2/letter-status2","ui-block/letter-swipe-actions/letter-swipe-actions","ui-block/swipeable/swipeable"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var q=C(b);var r=C(e);var s=C(f);var t=C(h);var u=C(i);var v=C(j);var w=C(k);var x=C(l);var y=C(m);var z=C(n);var A=C(o);var B=C(p);function C(a){return a&&a.__esModule?a:{default:a}}exports.default=q.default.Block.extend((0,u.default)({id:"letter-item",events:[{name:"clickavatar",rename:function a(b){return b.is("selected")?"deselect":"select"}},{name:"togglestatus:unread",rename:function a(b){return(0,g.renameRadarOnStatusToggle)(b,"unread")}},{name:"togglestatus:flagged",rename:function a(b){return(0,g.renameRadarOnStatusToggle)(b,"flagged")}},{name:"remove",data:g.getModelData},{name:"spam",data:g.getModelData},"unspam"]})({name:"letter-list-item",template:r.default,isolateEvents:false,performanceTrace:true,mods:{correspondent:c.correspondent,scheduleDate:d.scheduleDate,letterDate:d.letterDate},blocks:{"letter-category":y.default,"letter-status2":z.default,avatar:v.default,swipeable:B.default,badge:w.default,highlighter:x.default,"letter-swipe-actions":A.default},defaults:{"disable-letter-item-folder":a.DISABLE_LETTER_ITEM_FOLDER,"main-field":"from","swipe-actions-visible":false,"disable-subject":false,"disable-category":false,"hover-support":s.default.capabilities["hover-support"],"expand-attachment-dropdown":false},notVisualAttributes:{"list-index":true},attrChange:{"avatar-field":function a(b){return b==="from"||b==="to"?b:"from"}},events:{"pan:changed":"onPanChanged","underlay:changed":"onUnderlayChanged","animation:changed":"onAnimationChanged"},didMount:function a(){var b=t.default.getInstance();if(b&&b.el){this.ids.swipeable.addInsideTarget(b.el)}},onPanChanged:function a(b){this.set("swipe-actions-touched",b.details.value)},onAnimationChanged:function a(b){this.set("swipe-actions-animated",b.details.value)},onUnderlayChanged:function a(b){this.set("swipe-actions-visible",b.details.value)},getModel:function a(){var b=this.get("model");var c=b.get("messages.0");if(c&&!b.get("date")&&!b.get("snippet")){return c}return b},getCorrespondents:function a(){var b=this.get("model");var d=this.get("main-field");if(d==="from"){return(0,c.correspondentsFromMessage)(b,d)}return["to","cc"].map(function(a){return(0,c.correspondentsFromMessage)(b,a)}).filter(function(a){return!!a}).join(", ")},getAvatar:function b(){var d=this.get("model");var e=this.get("main-field");var f=(0,c.correspondentsAvatarFromMessage)(d,e);return f||a.DEFAULT_AVATAR_SRC},getSubject:function a(){var b=this.get("model");return b.get("subject")||i18n("<Без темы>")}}))});define("feast-tpl!app/feast-tpl!ui-block/letter-list-item-placeholder/letter-list-item-placeholder.html",["feast"],function(a){return a.smartParse('<div>\n\t<b:letter-list-item\n\t\tcompact="{attrs.compact}"\n\t\ttouch="{attrs.touch}"\n\t\tdisabled\n\t\tdraft\n\t\tdisable-select\n\t\tdisable-subject\n\t\tdisable-category\n\t/>\n</div>\n',"app/feast-tpl!ui-block/letter-list-item-placeholder/letter-list-item-placeholder.html")});define("feast-tpl!ui-block/letter-list-item-placeholder/letter-list-item-placeholder.html",["feast-tpl!app/feast-tpl!ui-block/letter-list-item-placeholder/letter-list-item-placeholder.html"],function(a){return a});define("ui-block/letter-list-item-placeholder/letter-list-item-placeholder",["exports","feast","feast-tpl!./letter-list-item-placeholder.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default=c.default.Block.extend({name:"letter-list-item-placeholder",template:d.default})});define("feast-tpl!app/feast-tpl!ui-block/letter-meta/letter-meta.html",["feast"],function(a){return a.smartParse('<div>\n    <fn:if test="attrs.showSkeleton">\n        <div ref="skeleton" class="skeleton">\n            <b:react-async\n                component="LetterMetaSkeleton"\n                darkMode="{attrs[\'dark-mode\']}"\n                animateContent="{attrs[\'start-animation\']}"\n                onMount="{_this.onSkeletonMount}"\n            />\n        </div>\n    </fn:if>\n    <div ref="container" class="letter-meta-container">\n        <fn:add-class name="letter-meta-container-with-skeleton" test="attrs.showSkeleton"/>\n    </div>\n</div>\n',"app/feast-tpl!ui-block/letter-meta/letter-meta.html")});define("feast-tpl!ui-block/letter-meta/letter-meta.html",["feast-tpl!app/feast-tpl!ui-block/letter-meta/letter-meta.html"],function(a){return a});define("mediator/settings-events",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.settingsEvents=void 0;exports.settingsEvents={openCleanmailbox:"cleanmailbox:open"}});define("feast-tpl!app/feast-tpl!ui-block/settings/settings.html",["feast"],function(a){return a.smartParse('<div promo:id="settings">\n\t<b:button2\n\t\tqa:id="settings"\n\t\tremit:click.prevent="settings-icon:click"\n\t\tradar-id="s-btn"\n\t\tshortcut="{attrs.shortcut}"\n\t\ttitle-shortcut="{attrs[\'title-shortcut\']}"\n\t\ttitle="{attrs.title}"\n\t\tannotation="{attrs.annotation}"\n\t\ttext="{i18n(\'Настройки\')}"\n\t\tico="{attrs.ponymode ? \'navigation:settings_s\' : \'navigation:settings\'}"\n\t\trotate-ico="{attrs[\'rotate-ico\']}"\n\t\ttouch="{attrs.touch}"\n\t\tshort="{!attrs.showTitle}"\n\t\tico-text-top="{attrs[\'ico-text-top\']}"\n\t\tpure\n\t\tsecondary="{attrs.secondary}"\n\t\tsize="{attrs.size}"\n\t\tdisabled="{attrs.disabled}"\n\t\tcompact="{attrs.ponymode}"\n\t\tclean="{attrs.clean}"\n\t\tfont-size-pony="{attrs[\'font-size-pony\']}"\n\t\tnotification-badge="{attrs[\'notification-badge\']}"\n\t\tnotification-badge-size="m"\n\t\tnotification-badge-color="accent"\n\t\talways-bright="{attrs[\'always-bright\']}"\n\t\tcentered="{!attrs.showTitle}"\n\t\tfill="{attrs.fill}"\n\t\ttext-overflow="{attrs[\'text-overflow\']}"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/settings/settings.html")});define("feast-tpl!ui-block/settings/settings.html",["feast-tpl!app/feast-tpl!ui-block/settings/settings.html"],function(a){return a});define("mediator/todo-manager/consts",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.WIDGET_COLUMN_SET_WIDGET=exports.WIDGET_COLUMN_UNMOUNT=exports.DATA_SOURCE_ACTIONED=exports.TODO_IFRAME_MESSAGE=exports.TODO_DRAG_END=exports.TODO_DRAG_START=exports.TODO_TOGGLE=void 0;exports.TODO_TOGGLE="todo:toggle";exports.TODO_DRAG_START="drag:start";exports.TODO_DRAG_END="drag:end";exports.TODO_IFRAME_MESSAGE="todo:iframe:message";exports.DATA_SOURCE_ACTIONED="actionend";exports.WIDGET_COLUMN_UNMOUNT="widgetcolumn:unmount";exports.WIDGET_COLUMN_SET_WIDGET="widgetcolumn:setwidget"});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/settings/settings",["require","exports","@mail/flags","default-values","feast","feast-tpl!./settings.html","mediator/todo-manager/consts","service/radars/decorator","ui-block/button2/button2"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);var h=a.default.get("security-checkup-link");exports.default=c.default.Block.extend((0,f.default)({events:[{name:"threads:toggle",rename:"threads_toggle",immediate:true},{name:"metathreads:toggle",rename:"metathreads_toggle",immediate:true},{name:"ponymode:toggle",rename:"ponymode_click",immediate:true},{name:"help:open",rename:"help_open"},{name:"notifications:click",rename:"notifications_click"},{name:"themes:panel",rename:"themes_panel"},{name:"layout:toggle",rename:"layout_toggle"},{name:"subscriptions:open",rename:"subscriptions_click"},{name:"settings:click",rename:"settings_click"},{name:"cleanmaster:click",rename:"cleanmaster_click"},{name:"language:click",rename:"language_click"},{name:"tomyself:toggle",rename:"tomyself_toggle",immediate:true},{name:"paginator:toggle",rename:"paginator_toggle",immediate:true},{name:e.TODO_TOGGLE,rename:"todo_toggle",immediate:true},{name:"shortcuts:toggle",rename:"shortcuts_toggle",immediate:true},{name:"settings:open",rename:"dock"}]})({name:"settings",template:d.default,blocks:{button2:g.default},defaults:{"open-as-page":b.WEBVIEW,"notification-badge":!h.state&&b.SHOW_SECURITY_CHECKUP_LINK_IN_SETTINGS},events:{"settings-icon:click":"onSettingsClick"},onSettingsClick:function(){this.broadcast(this.get("open-as-page")?"settings:click":"settings:open")}}))});define("feast-tpl!app/feast-tpl!ui-block/settings-dock/settings-dock.html",["feast"],function(a){return a.smartParse('<div>\n\t<b:react-async\n\t\tcomponent="SettingsDock"\n\t\tcomponentClass="{_this.lazySettingsDock()}"\n\t\tshow="{attrs.show}"\n\t\tstartSection="{attrs.startSection}"\n\t\tapplicationElement="{_this.getApplicationElement()}"\n\t\tonEvent="{_this.handleEvent}"\n\t\tdarkMode="{attrs.darkMode}"\n\t\tuserLang="{attrs.userLang}"\n\t\tthirtyFiftyMode="{attrs.thirtyFiftyMode}"\n\t\tdisableExpand="{attrs.disableExpand}"\n\t\tdisableAutoExpand="{attrs.disableAutoExpand}"\n\t\tstartFullscreen="{attrs.startFullscreen}"\n\t\tsupport3pane="{attrs.support3pane}"\n\t\tlayoutType="{attrs.type}"\n\t\tcanTogglePonymode="{attrs[\'can-toggle-ponymode\']}"\n\t\tponymode="{attrs.ponymode}"\n\t\tcanToggleShortcuts="{attrs[\'can-toggle-shortcuts\']}"\n\t\tmanualShortcuts="{attrs[\'manual-shortcuts\']}"\n\t\tthreads="{attrs.threads}"\n\t\tthemes="{_this.getThemes()}"\n\t\tmetathreadsData="{attrs.metathreadsData}"\n\t\tonMetathreadsSettingsEdit="{_this.onMetathreadsSettingsEdit}"\n\t\tonMetathreadsHelpClick="{_this.onMetathreadsHelpClick}"\n\t\tmetathreadsFiltersCount="{attrs.metathreadsFiltersCount}"\n\t\tmetathreadsFiltersCountLoading="{attrs.metathreadsFiltersCountLoading}"\n\t\tcanToggleTodo="{attrs.canToggleTodo}"\n\t\ttodo="{attrs.todo}"\n\t\tlettersDividersEnabled="{attrs[\'letters-dividers-enabled\']}"\n\t\tcanToggleLettersDividers="{attrs[\'can-toggle-letters-dividers\']}"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/settings-dock/settings-dock.html")});define("feast-tpl!ui-block/settings-dock/settings-dock.html",["feast-tpl!app/feast-tpl!ui-block/settings-dock/settings-dock.html"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/settings-dock/settings-dock",["require","exports","data-source/actions","default-values","feast","feast-tpl!./settings-dock.html","helpers/data-source-dispatch","helpers/lazy","service/smokescreen","service/themes.setup"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);h=__importDefault(h);var i=(0,f.lazyInit)(function(){return new Promise(function(a,b){require(["ui-react/containers/SettingsDock/SettingsDock"],a,b)}).then(__importStar)});exports.default=c.default.Block.extend({name:"settings-dock",template:d.default,defaults:{show:false,startSection:"appearance",applicationElement:null,thirtyFiftyMode:b.SETTINGS_DOCK_30_50_MODE,disableExpand:b.SETTINGS_DOCK_DISABLE_EXPAND_BUTTON,disableAutoExpand:b.SETTINGS_DOCK_DISABLE_AUTO_EXPAND,startFullscreen:b.SETTINGS_DOCK_START_FULL_SCREEN,support3pane:true,layoutType:"2pane","can-toggle-ponymode":true,ponymode:false,"can-toggle-shortcuts":true,"manual-shortcuts":false,threads:true,theme:null,darkMode:false,userLang:"ru_RU",metathreadsData:[],metathreadsFiltersCount:0,metathreadsFiltersCountLoading:false,helpLink:"metathreads","can-toggle-todo":false,todo:false,"letters-dividers-enabled":false,"can-toggle-letters-dividers":false},constructor:function(){c.default.Block.apply(this,arguments);this.handleEvent=this.handleEvent.bind(this);this.onMetathreadsSettingsEdit=this.onMetathreadsSettingsEdit.bind(this);this.onMetathreadsHelpClick=this.onMetathreadsHelpClick.bind(this)},lazySettingsDock:i,handleEvent:function(a){this.broadcast(a.type,a.details)},uid:0,onMetathreadsSettingsEdit:function(b){var c=this;return(0,e.default)({type:a.EDIT_METATHREADS_SETTINGS,settings:b,uid:this.uid++}).then(function(a){c.broadcast("metathreads:settings:updated");return a})},onMetathreadsHelpClick:function(){this.broadcast("help:open",this.attrs.helpLink)},getApplicationElement:function(){if(!this.applicationElenemt){this.applicationElement=document.querySelector((0,g.selector)(".application-mail__wrap"))}return this.applicationElement},getThemes:function(){return{main:h.default.getModels(),colorized:h.default.getColorizedModels(),selected:h.default.getSelectedModel()}}})});define("feast-tpl!app/feast-tpl!ui-block/settings-help-link/settings-help-link.html",["feast"],function(a){return a.smartParse('<div\n\tremit:click.prevent.stop="help:open"\n\tevent:details="attrs[\'event-details\']"\n\tqa:id="help-link"\n>\n\t<bem:mod name="pony-mode" test="attrs.ponymode" />\n\t<a bem:elem="link" href="{attrs.link}" target="_blank" qa:id="settings-help-link">\n\t\t<b:ico name="{\'navigation:tip_round\'}"/>\n\t</a>\n\t<div bem:elem="empty" />\n</div>\n',"app/feast-tpl!ui-block/settings-help-link/settings-help-link.html")});define("feast-tpl!ui-block/settings-help-link/settings-help-link.html",["feast-tpl!app/feast-tpl!ui-block/settings-help-link/settings-help-link.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/settings-help-link/settings-help-link",["require","exports","feast","feast-tpl!./settings-help-link.html","service/radars/decorator"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.default=a.default.Block.extend((0,c.default)({events:[{name:"help:open",rename:"help_open"}]})({name:"settings-help-link",template:b.default}))});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/settings-manager",["require","exports","@mail/flags","@mail/xray","data-source/actions","data-source/utils/paginator","default-values","feast","filters/Filter","helpers/data-source-dispatch","helpers/opener","mail/Folder","mail/User","mediator/settings-events","pilotjs","service/auth","service/layer","service/notify","service/promo","service/radars/index","service/vkMessengerLoader","ui-block/category-feedback/category-feedback","ui-block/filters/filters","ui-block/mobile-sidebar/mobile-sidebar","ui-block/nav-folders/nav-folders","ui-block/settings/settings","ui-block/settings-dock/settings-dock","ui-block/settings-help-link/settings-help-link","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);var B={help3pane:e.HELP_3PANE,threads:e.HELP_THREADS,metathreads:e.HELP_METATHREADS,"to-myself":e.HELP_TO_MYSELF,paginator:e.HELP_PAGINATOR};var C=function(f){__extends(C,f);function C(){var a=f!==null&&f.apply(this,arguments)||this;a._metathreadsFiltersCountLoading=false;return a}C.prototype.getComponentsSpec=function(){return{router:{class:m.default},"settings-dock":{class:y.default,events:["threads:toggle","metathreads:settings:updated","help:open","metathreads:filters:create","metathreads:filters:update","logs:click","support_vk:click","settings:close",l.settingsEvents.openCleanmailbox],attrs:{userLang:function(){return e.USER_LANG},threads:function(a){return a.get("router.model.uiThreadsSettings").threads},metathreadsData:function(a){return a.getMetathreadsData()},metathreadsFiltersCount:function(a){return a.getMetathreadsFiltersCount()},metathreadsFiltersCountLoading:function(a){return a.getMetathreadsFiltersCountLoading()}}},settings:{class:x.default,events:["settings:click","settings:open"]},filters:{class:u.default,events:["help:open","settings:click","threads:toggle","metathreads:toggle","notifications:click","cleanmaster:click","logs:click","language:click","tomyself:toggle","paginator:toggle","priority:messages:toggle","metathreads:settings:open"],attrs:{threads:function(a){return a.get("router.model.uiThreadsSettings").threads},metathreadsSettings:function(a){return a.get("router.model.uiThreadsSettings").metathreadsSettings},"to-myself":function(a){return a.get("router.model.uiThreadsSettings").toMyself},"can-toggle-paginator":function(a){return(0,d.canPaginatorBeEnabled)(a.get("router"))},"help-links":function(){return B},"hide-help":function(){return e.SETTINGS_DROPDOWN_HIDE_HELP},"hide-metathreads":function(){return e.HIDE_METATHREADS},"hide-to-myself":function(){return e.SETTINGS_DROPDOWN_HIDE_TO_MYSELF}}},"layer-metathreads-settings":{lazy:A.lazyUILayerMetathreadsSettings,events:["metathreads:settings:open","metathreads:settings:updated","metathreads:filters:create","metathreads:filters:update","help:open"],attrs:{metathreadsData:function(a){return a.getMetathreadsData()},metathreadsFiltersCount:function(a){return a.getMetathreadsFiltersCount()},metathreadsFiltersCountLoading:function(a){return a.getMetathreadsFiltersCountLoading()}}},"nav-folders":{class:w.default,events:["settings:click"]},"category-feedback":{class:t.default,attrs:{metathreads:function(a){return a.get("router.model.uiThreadsSettings").metathreads}}},letter:{lazy:A.lazyUILetter,attrs:{metathreads:function(a){return a.get("router.model.uiThreadsSettings").metathreads}}},"settings-help-link":{class:z.default,events:["help:open"]},"mobile-sidebar":{class:v.default,events:["settings:click"]}}};C.prototype.handleEvent=function(a){switch(a.type){case"settings:open":this.onSettingsDockOpen();break;case"settings:close":this.onSettingsDockClose();break;case"help:open":this.onHelpOpen(a.details);break;case"metathreads:filters:create":this.onCreateFilter();break;case"metathreads:filters:update":this.updateFilter();break;case l.settingsEvents.openCleanmailbox:this.onSettingsDockCleanmailboxOpen();break;case"settings:click":this.onSettingsClick();break;case"notifications:click":this.onNotificationsClick();break;case"cleanmaster:click":this.onCleanmasterClick();break;case"logs:click":(0,A.lazyHelpersLogger)().then(function(a){a.sendLogs()});break;case"language:click":this.onLanguageClick();break;case"priority:messages:toggle":this.onPriorityMessagesToggle();return false;case"threads:toggle":this.onThreadsToggle(a.details);return false;case"metathreads:toggle":this.onMetaThreadsToggle(a.details);return false;case"tomyself:toggle":this.onToMyselfToggle();return false;case"paginator:toggle":this.onPaginatorToggle();return false;case"metathreads:settings:open":this.onMetathreadsSettingsOpen(a.details);break;case"support_vk:click":this.onHelpVK();break}};C.prototype.onSettingsDockClose=function(){var a=this.get("settings-dock");a===null||a===void 0?void 0:a.set({show:false,startSection:"appearance"});q.default.update()};C.prototype.onSettingsDockOpen=function(){var a=this.get("settings-dock");a===null||a===void 0?void 0:a.set({show:true});q.default.update()};C.prototype.onSettingsMetathreadsOpen=function(){var a=this.get("settings-dock");a===null||a===void 0?void 0:a.set({show:true,startSection:"metathreads"})};C.prototype.onSettingsDockCleanmasterOpen=function(){var a=this.get("settings-dock");a===null||a===void 0?void 0:a.set({show:true,startSection:"cleanmaster"})};C.prototype.onSettingsDockAppearanceOpen=function(){var a=this.get("settings-dock");a===null||a===void 0?void 0:a.set({show:true,startSection:"appearance"})};C.prototype.onSettingsDockCleanmailboxOpen=function(){var a=this.get("settings-dock");a===null||a===void 0?void 0:a.set({show:true,startSection:"cleanmailbox"})};C.prototype.onSettingsDockBrowserSettingsOpen=function(){var a=this.get("settings-dock");a===null||a===void 0?void 0:a.set({show:true,startSection:"browsersettings"})};C.prototype.onCleanmasterClick=function(){(0,i.default)(e.CLEANMASTER_URL)};C.prototype.onHelpOpen=function(a){if(typeof a==="string"){(0,i.default)(B[a]);return}(0,i.default)(e.HELP_URL)};C.prototype.updateFilter=function(){var a=this;this._metathreadsFiltersCountLoading=true;(0,h.default)({type:c.UPDATE_METATHREAD_FILTERS,uid:undefined}).then(function(){a._metathreadsFiltersCountLoading=false})};C.prototype.onCreateFilter=function(){o.default.open("edit-settings-filter",{filterModel:(new g.default).toJSON()},{dimmer:true})};C.prototype.getMetathreadsFiltersCountLoading=function(){return this._metathreadsFiltersCountLoading};C.prototype.getMetathreadsFiltersCount=function(){return this.get("router.model.uiThreadsSettings").metathreadsFiltersCount};C.prototype.onMetathreadsSettingsOpen=function(b){if(this.shouldShowAdActualLetters()){var c=a.default.get("actual-letters-badge");c.save({state:true,time:true});(0,r.default)("settings_ad_actual_letters_hide")}var d=this.get("router.model.folders");var e=!!d.find(function(a){return a.isNews()});var f=__assign(__assign({},b),{newsMetathreadFolder:e});o.default.open("metathreads-settings",f,f)};C.prototype.onNotificationsClick=function(){(0,i.default)(e.NOTIFICATIONS_URL)};C.prototype.onSettingsClick=function(){(0,i.default)(e.SETTINGS_URL)};C.prototype.onThreadsToggle=function(a){var b=a&&a.from;var d=!this.get("router.model.uiThreadsSettings").threads;(0,r.default)({type:"threads-toggle-".concat(d?"on":"off"),intervals:[["".concat(b),1]]});(0,h.default)({type:c.TOGGLE_THREADS_SETTING,uid:undefined})};C.prototype.onMetaThreadsToggle=function(a){var b=a&&a.from;var d=!this.get("router.model.uiThreadsSettings").metathreads;(0,r.default)({type:"metathreads-toggle-".concat(d?"on":"off"),intervals:[["".concat(b),1]]});if(!d&&e.METATHREADS_FORCED_EXP){(0,r.default)({type:"metathreads-forced-exp-off",dwh:{group:e.METATHREADS_FORCED_EXP.split("|")[0],folder:"folder"}})}(0,h.default)({type:c.TOGGLE_METATHREADS_SETTING,uid:undefined})};C.prototype.onLanguageClick=function(){o.default.open("change-language",{currentLang:e.USER_LANG},{dimmer:true,compact:true,resolvable:true,"reject-on-close":true}).then(function(a){var b=a===void 0?{resolveType:"error",lang:e.USER_LANG}:a,c=b.resolveType,d=b.lang;if(c==="ok"&&e.USER_LANG!==d){n.default.user.save("lang",d).then(function(){(0,r.default)(["settings-manager","save-lang",d]);window.location.reload()}).catch(function(){(0,r.default)(["settings-manager","save-lang-error"])})}}).catch(function(a){if(a){throw a}})};C.prototype.onPriorityMessagesToggle=function(){var a=!this.get("router.model.uiThreadsSettings").actualLettersInbox;(0,h.default)({type:c.TOGGLE_ACTUAL_MESSAGES_IN_INBOX,state:a,uid:undefined});(0,r.default)({type:"priority_messages_".concat(a?"enable":"disable"),intervals:[["settings",1]]})};C.prototype.onToMyselfToggle=function(){var a=this;var b=this.get("router.model.uiThreadsSettings").toMyself;if(!b){(0,h.default)({type:c.TOGGLE_TO_MYSELF_METATHREAD,state:true,uid:undefined});(0,r.default)({type:"tomyself-enable",intervals:[["settings",1]]});return}var d=this.get("router.model.folders");var f=d.find(function(a){return a.isToMyself()});if(!f){(0,r.default)("tomyself-disable-no-folder");p.default.error({unique:true});return}var g=function(){(0,h.default)({type:c.TOGGLE_TO_MYSELF_METATHREAD,state:false,uid:undefined});(0,r.default)({type:"tomyself-disable",intervals:[["settings",1]]});if(a.get("router.model.folder.id")===f.id){var b=a.get("router");b.go("#letters",{folder:j.default.TYPE_INBOX})}};if(e.LAYER_METATHREAD_DISABLE){o.default.open("disable-metathread",{model:f},{dimmer:true,resolvable:true,"close-on-dimmer":true,"reject-on-dimmer":true,"close-on-esc":false,"reject-on-close":true}).then(function(){g()}).catch(function(a){if(a){throw a}})}else{g()}};C.prototype.onPaginatorToggle=function(){var a=!this.get("router.model.uiThreadsSettings").paginator;(0,h.default)({type:c.TOGGLE_PAGINATOR,state:a,uid:undefined});(0,r.default)({type:"paginator-".concat(a?"enable":"disable"),intervals:[["settings",1]]})};C.prototype.isNewsShown=function(){var b=a.default.get("news-subscription-badge");return b&&b.isActive()};C.prototype.shouldShowAdActualLetters=function(){var b=a.default.get("actual-letters-badge");var c=this.get("router.model.uiThreadsSettings");var d=c.metathreadsSettings&&c.metathreadsSettings[j.default.NEWSLETTERS]===k.default.METATHREADS_STATES.ON;return e.HAS_PRIORITY_MESSAGES&&b&&!b.isActive()&&d&&!c.actualLettersNewsletters&&!c.actualLettersInbox};C.prototype.onDiscountsToggle=function(a){var d=this;b.default.send("discounts_switch_".concat(a),{i:{"from-popup":1}});return(0,h.default)({type:c.TOGGLE_DISCOUNTS,state:a,uid:undefined}).then(function(){d.updateAll()})};C.prototype.isMetathreadOff=function(a){var b=this.get("router.model.uiThreadsSettings").metathreadsSettings,c=b===void 0?{}:b;return c[a]===k.default.METATHREADS_STATES.OFF};C.prototype.getMetathreadsData=function(){var a=this.get("router.model.uiThreadsSettings"),b=a.metathreadsSettings,c=b===void 0?{}:b,d=a.discounts,f=a.actualLettersInbox,g=a.actualLettersNewsletters;var h=e.HIDE_METATHREADS;var i=e.SETTINGS_DROPDOWN_HIDE_TO_MYSELF&&this.isMetathreadOff(j.default.TOMYSELF);var k=e.HIDE_NEWS_METATHREAD&&this.isMetathreadOff(j.default.NEWS);var l=(!e.HAS_PRIORITY_MESSAGES||this.isMetathreadOff(j.default.NEWSLETTERS))&&!f;var m=e.HIDE_OFFICIAL_METATHREAD&&this.isMetathreadOff(j.default.OFFICIAL);var n=e.HIDE_RECEIPTS_METATHREAD&&this.isMetathreadOff(j.default.RECEIPTS);var o=e.HIDE_SCHOOL_METATHREAD&&this.isMetathreadOff(j.default.SCHOOL);var p=e.HIDE_GAMES_METATHREAD&&this.isMetathreadOff(j.default.GAMES);var q=[{type:"inbox",folderId:j.default.INBOX,title:i18n("Входящие"),text:i18n("Настройки отображения писем во входящих"),icon:"FOLDER_INBOX",isHidden:l||h||e.FORCE_HIDE_PRIORITY_MESSAGES_SETTINGS,subSettings:[{type:"checkbox",value:f,testId:"actual-in-inbox",text:i18n("Выделять актуальные письма"),onChange:this.onActualInboxToggle.bind(this)}]},{type:"toMyself",folderId:j.default.TOMYSELF,title:i18n("Письма себе"),text:i18n("Письма, отправленные на свой адрес электронной почты"),icon:"FOLDER_TOMYSELF",state:c[j.default.TOMYSELF],isHidden:i||h},{type:"newsLetters",folderId:j.default.NEWSLETTERS,title:i18n("Рассылки"),text:i18n("Письма от интернет-магазинов, акции и скидки. Рекламные рассылки."),icon:"FOLDER_NEWSLETTERS",state:c[j.default.NEWSLETTERS],isHidden:h&&this.isMetathreadOff(j.default.NEWSLETTERS),subSettings:[e.DISCOUNTS_BLOCK&&{type:"checkbox",value:d,testId:"discounts",text:i18n("Показывать актуальные скидки"),onChange:this.onDiscountsToggle.bind(this)},!e.FORCE_HIDE_PRIORITY_MESSAGES_SETTINGS&&(e.HAS_PRIORITY_MESSAGES||g)&&{type:"checkbox",value:g,testId:"actual-in-newsletters",text:i18n("Выделять актуальные письма"),onChange:this.onActualNewslettersToggle.bind(this)}]},{type:"social",folderId:j.default.SOCIAL,title:i18n("Социальные сети"),text:i18n("Уведомления из «ВКонтакте», «Одноклассников» и других соцсетей"),icon:"FOLDER_SOCIAL",state:c[j.default.SOCIAL],isHidden:h&&this.isMetathreadOff(j.default.SOCIAL)},{type:"news",folderId:j.default.NEWS,title:i18n("Новости"),text:i18n("Уведомления от новостных сайтов, дайджесты"),icon:"FOLDER_NEWS",state:c[j.default.NEWS],isHidden:k||h},{type:"official",folderId:j.default.OFFICIAL,title:i18n("Госписьма"),text:i18n("Рассылки от государственных сервисов"),icon:"FOLDER_OFFICIAL",state:c[j.default.OFFICIAL],isHidden:m||h},{type:"receipts",folderId:j.default.RECEIPTS,title:i18n("Чеки"),text:i18n("Письма с подтверждениями оплат в магазинах и сервисах"),icon:"FOLDER_RECEIPTS",state:c[j.default.RECEIPTS],isHidden:n||h},{type:"school",folderId:j.default.SCHOOL,title:i18n("Учёба"),text:i18n("Письма про учёбу и на школьную тематику"),icon:"FOLDER_SCHOOL",state:c[j.default.SCHOOL],isHidden:o||h,sortOrder:e.METATHREADS_SETTINGS_ORDER.indexOf("school")},{type:"games",folderId:j.default.GAMES,title:i18n("Игры"),text:i18n("Всё, что связано с играми"),icon:"FOLDER_GAMES",state:c[j.default.GAMES],isHidden:p||h,sortOrder:e.METATHREADS_SETTINGS_ORDER.indexOf("games")}];return q.map(function(a){return __assign({sortOrder:e.METATHREADS_SETTINGS_ORDER.indexOf(a.type)},a)})};C.prototype.onActualInboxToggle=function(a){var d=this;b.default.send("actual_inbox_switch_".concat(a),{i:{"from-popup":1}});return(0,h.default)({type:c.TOGGLE_ACTUAL_MESSAGES_IN_INBOX,state:a,uid:undefined}).then(function(){d.updateAll()})};C.prototype.onActualNewslettersToggle=function(a){var d=this;b.default.send("actual_newsletters_switch_".concat(a),{i:{"from-popup":1}});return(0,h.default)({type:c.TOGGLE_ACTUAL_MESSAGES_IN_NEWSLETTERS,state:a,uid:undefined}).then(function(){d.updateAll()})};C.prototype.onHelpVK=function(){s.vkMessengerLoader.open({chatId:e.VK_HELP_CHAT_ID})};return C}(f.default.Mediator);exports.default=f.default.Mediator.createFromClass("settings-manager",C)});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/letter-meta/letter-meta",["require","exports","@mail/features","@mail/flags","@mail/xray","cfg","cfgUser","default-values","feast","feast-tpl!./letter-meta.html","helpers/data-source-dispatch","helpers/getCurrentTimestamp","helpers/opener","mail/getters/MessageMeta","mediator/settings-manager","router","RPC","service/auth","service/getModule","service/notify","service/promo","service/smokescreen","service/storage","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);k=__importDefault(k);l=__importStar(l);m=__importDefault(m);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);u=__importDefault(u);exports.default=g.default.Block.extend({name:"letter-meta",template:h.default,defaults:{html:"",showSkeleton:false},loadingPlateTimer:null,constructor:function(){g.default.Block.apply(this,arguments);this.destroyElementOnError=this.destroyElementOnError.bind(this);this.destroySkeleton=this.destroySkeleton.bind(this)},didMount:function(){var a;if(f.TRACKING_STATUS_PLATE&&((a=this.get("model").get("transaction_metadata"))===null||a===void 0?void 0:a.get("statement_status"))){c.default.send("appl_state_plate_letter_open")}},didUnmount:function(){this.unrenderUI();clearTimeout(this.loadingPlateTimer);this.refs.container.removeEventListener("letter-meta-loaded",this.destroySkeleton);this.refs.container.removeEventListener("letter-meta-loading-err",this.destroyElementOnError)},didUpdate:function(){if(this.ui){this.ui.update(this.getParams())}},attrChanged:{model:function(){this.renderUI()}},getParams:function(){var c=this.get("model");var f=this.get("metadata")?this.get("metadata").getAttributes():null;var g=c.get("messages");var h=this.get("ponymode");var j=this.is("dark-mode");var k=this.get("sender");var m=p.default.user;var n=this.get("calendar");var q=this.get("promoDomainPlate");var r=this.get("needHideAttach");return{model:c,features:a.default,flags:b.default,cfg:d.default,storage:u.default,octavius:true,lang:e.default.get("LANG"),email:m&&m.getEmail(),calendar:n,onPopupToggle:this.onPopupToggle,selector:t.selector,dataSourceDispatch:i.default,metadata:f,message:c,messages:g,ponymode:h,darkMode:j,sender:k,icsWithAttachToggle:r,onStatusClick:this.onStatusClick.bind(this),promoDomainPlate:q,onPromoDomainClose:this.onPromoDomainClose.bind(this),onBlockPhishingLetter:this.onBlockPhishingLetter.bind(this),onActualFeedback:this.onActualFeedback.bind(this),onEternalDislike:this.onEternalDislike.bind(this),onNewsletterMailingPlateChoice:this.onNewsletterMailingPlateChoice.bind(this),onCategoryFeedback:this.onCategoryFeedback.bind(this),onCategoryFeedbackPlateShow:this.onCategoryFeedbackPlateShow.bind(this),onWindowOpen:this.onWindowOpen,onAttachesCloudSave:this.onAttachesCloudSave.bind(this),onBlockFilteredLetter:this.onBlockFilteredLetter.bind(this),onApproveFilteredLetter:this.onApproveFilteredLetter.bind(this),createSmartCardConfirmPopup:this.createSmartCardConfirmPopup.bind(this),onSmartCardError:this.onSmartCardError.bind(this),onPromoPushPlateShow:this.onPromoPushPlateShow.bind(this),onPromoPush:this.onPromoPush.bind(this),onPromoPushSettings:this.onPromoPushSettings.bind(this),onDeleteMLCardSuccess:this.onDeleteMLCardSuccess.bind(this),onDeleteMLCardError:this.onDeleteMLCardError.bind(this),onToggleIcsAttachClick:this.onToggleIcsAttachClick.bind(this),MailGettersMessageMeta:l,RPC:o.default}},renderUI:function(){var b=this;this.unrenderUI();var c=performance.now();var d=p.default.user;var e=this.is("dark-mode");var f={message:this.get("model"),features:a.default,promoDomainPlate:this.get("promoDomainPlate"),sender:this.get("sender"),type:this.get("type")};if(this.get("needSkeleton")&&!this.loadingPlateTimer){this.waitForLoadingPlate()}(0,q.default)("letter.meta").then(function(a){return b.isMounted()&&a&&a(__assign({loadPath:window.require.toUrl("letter.meta.js").replace("letter.meta.js",""),email:d&&d.getEmail(),darkMode:e,MailGettersMessageMeta:l},f))}).then(function(a){if(!a||!b.isMounted()){return false}b.ui=new a(b.refs.container);b.ui.renderWrapper(__assign(__assign({},b.getParams()),{timingStart:c,timingNow:function(){return performance.now()}}));var d=b.refs.container.children.length;s.default.update();b.broadcast("render",{showed:d})})},unrenderUI:function(){this.ui&&this.ui.destroy();this.ui=null},onPopupToggle:function(a){(0,v.lazyMailKeymaster)().then((0,v.uniqCallback)(this,function(b){b.setScope(a?"layer-no-shortcuts":"all")}))},onStatusClick:function(a){this.broadcast("letterclick",{uidl:a})},onPromoDomainClose:function(){this.broadcast("promodomainclose")},onBlockPhishingLetter:function(){var a=this.get("model");this.broadcast("spam",{model:a})},onActualFeedback:function(a){var b=this.get("model");o.default.call("messages/services/ispriority",{ids:[b.get("messages.0.id")],is_priority:a})},onEternalDislike:function(a,b){var c=this.get("model");o.default.call("messages/services/ispriority",{ids:[c.get("messages.0.id")],is_priority:b,permanent_priority:true})},onCategoryFeedbackPlateShow:function(a){var b;if(f.USE_QUEUE_CATEGORY_FEEDBACK_PLATE){var c=u.default.get("letter.meta-category-feedback-shows")||{};(b=this.get("onShowCategoryFeedbackPlate"))===null||b===void 0?void 0:b();if(!c.hasOwnProperty(a)){c[a]={countShows:0,time:0}}c[a].countShows++;c[a].time=(0,j.getCurrentTimestamp)();u.default.set("letter.meta-category-feedback-shows",c)}},onNewsletterMailingPlateChoice:function(a){var b=this.get("model");var c=(u.default.get("newsletter-mailing-choiced-list")||"").split(",");var d=b.get("correspondents.from.0.email");c.push(d);u.default.set("newsletter-mailing-choiced-list",c.join(","));var e=a?i18n("Рассылка подтверждена"):i18n("Вы успешно отписались");r.default.add({text:e,qa:"newsletter-mailing-plate-choice-".concat(a?"sub":"unsub")})},onCategoryFeedback:function(a,b){var c=this.get("model");if(b){o.default.call("messages/services/category/feedback",{id:c.get("messages.0.id"),other_category:b});return}o.default.call("messages/services/category/feedback",{id:c.get("messages.0.id"),category:a})},onWindowOpen:function(a){(0,k.default)(a)},onAttachesCloudSave:function(){this.broadcast("attaches-cloud-save",this.get("model").getAttachmentsList())},onBlockFilteredLetter:function(){c.default.send("rl_btn_block");this.broadcast("move",{id:f.PARENTAL_CONTROL_DENY_FOLDER_ID,model:this.get("model")})},onApproveFilteredLetter:function(){c.default.send("rl_btn_approve");this.broadcast("move",{id:f.PARENTAL_CONTROL_APPROVE_FOLDER_ID,model:this.get("model")})},createSmartCardConfirmPopup:function(a,b){var c=this;Promise.all([(0,q.default)("react"),(0,q.default)("blitz")]).then(function(d){var e=d[0],f=d[1].LayerManager;if(!c.isMounted()){return}var g=c.layerManager||new f;g.setup(c.el,{popup:false,radarPrefix:"smart-card"});var h=g.openLayer(e.createElement(a,__assign(__assign({},b),{onClose:function(){b.onClose();if(g){g.destroyLayer(h)}}})),{noPanelWrap:true,responsive:"auto"}).id})},onSmartCardError:function(){r.default.add({text:i18n("Временно не работает. Попробуйте попозже"),qa:"clnd-smart-card-notify-err"})},onPromoPushPlateShow:function(){if(f.USE_QUEUE_PROMO_PUSH_PLATE){var a=+u.default.get("letter.meta-promo-push-show")||0;u.default.set("letter.meta-promo-push-show",a+1)}},onPromoPush:function(a,b){var d;return(d=(0,n.getAppRouter)().model.swBox.pushManager)===null||d===void 0?void 0:d.forCurrentEmail().set({active:true}).then(function(){c.default.send(["notifications-push","switch","on"],{dwh:{source:"letter-promo"}});r.default.add({text:a})}).catch(function(a){c.default.send(["notifications-push","switch","error"],{rlog:"push-switch-error",rlog_message:{error:a,on:true}});r.default.add({type:"error",text:b})})},onPromoPushSettings:function(){m.default.onSettingsDockBrowserSettingsOpen()},onDeleteMLCardSuccess:function(){r.default.add({text:i18n("Событие удалено из календаря"),qa:"clnd-ml-card-del-success"});this.unrenderUI()},onDeleteMLCardError:function(){r.default.add({text:i18n("Временно не работает. Попробуйте попозже"),qa:"clnd-ml-card-del-err"})},waitForLoadingPlate:function(){this.set("showSkeleton",true);this.loadingPlateTimer=setTimeout(this.destroyElementOnError,f.LETTER_META_SKELETON_WAIT_TIMEOUT);this.refs.container.addEventListener("letter-meta-loaded",this.destroySkeleton);this.refs.container.addEventListener("letter-meta-loading-err",this.destroyElementOnError)},onSkeletonMount:function(){c.default.send("lm-skeleton-show")},destroySkeleton:function(){clearTimeout(this.loadingPlateTimer);this.loadingPlateTimer=null;this.set("showSkeleton",false)},destroyElementOnError:function(){c.default.send("lm-skeleton-destroy",{rlog:"calendar_smart_card_logs",rlog_message:{message:"skeleton-destroy-on-timeout",letterId:this.get("model").id}});this.destroySkeleton()},onToggleIcsAttachClick:function(a){this.broadcast("toggle-ics",{isOpen:a})}})});define("feast-tpl!app/feast-tpl!ui-block/promo-domain-die/promo-domain-die.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:if test="_this.checkPromoDomainPlate()">\n\t\t<b:letter-meta\n\t\t\tmodel="{attrs.model}"\n\t\t\tpromoDomainPlate="{attrs.promoDomainPlate}"\n\t\t\tdark-mode="{attrs[\'dark-mode\']}"\n\t\t\tremit:promodomainclose="letter-meta:promodomainclose"\n\t\t\tuse:mediator="themes-manager"\n\t\t/>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/promo-domain-die/promo-domain-die.html")});define("feast-tpl!ui-block/promo-domain-die/promo-domain-die.html",["feast-tpl!app/feast-tpl!ui-block/promo-domain-die/promo-domain-die.html"],function(a){return a});define("mail/actions/PromoplatesManage",["RPC","Action"],function(a,b){"use strict";var c=b.extend({prepare:function(a){if(!a){return null}switch(a.method){case c.CONFIG:return this._prepareConfig(a);case c.HIDE:case c.SHOW:return this._preparePromoDomainPlates(a);default:return null}},operation:function(a){switch(a.method){case c.CONFIG:return this._config(a);case c.HIDE:return this._hide(a);case c.SHOW:return this._show(a);case c.CHECK:return this._check(a)}},_done:function(a){if(a){window.__DEBUG_PROMO_DOMAIN_SERVER=1}},_prepareConfig:function(a){var b=a.email;var d=a.senderEmail;var e=a.config;var f=a.isClosable;var g=a.isToMyself;var h=!b||!d||!Array.isArray(e)||b===d&&!g;if(h){return null}var i=null;if(g){i=c.TO_MYSELF_DOMAIN}else{var j=d.match(/.+@(.+)/);i=j&&j[1]}if(!i){return null}var k=null;var l=e.some(function(a){var b=Array.isArray(a.domains)&&a.domains.includes(i);var c=Array.isArray(a.emails)&&a.emails.includes(d);if(b){k=i}else if(c){k=d}return b||c});if(!l){return null}if(!f){return{method:c.CONFIG,plate:k}}return Object.assign(a,{senderDomain:i})},_preparePromoDomainPlates:function(a){if(!Array.isArray(a.promoDomainPlates)){return null}return a},_config:function(b){if(b.plate){return Promise.resolve(b.plate)}var c=this;var d=function(a){c._done(b.isAutotest);return a};return a.get("user/promoplates/config").then(d,d).then(function(a){var c=a.body.domains;var d=a.body.emails;if(!Array.isArray(c)||!Array.isArray(d)||!c.length&&!d.length){return null}return c.find(function(a){return a===b.senderDomain})||d.find(function(a){return a===b.senderEmail})})},_hide:function(b){var c=this;var d=function(a){c._done(b.isAutotest);return a};return a.post("user/promoplates/hide",{promo_plates:b.promoDomainPlates}).then(d,d)},_show:function(b){var c=this;var d=function(a){c._done(b.isAutotest);return a};return a.post("user/promoplates/show",{promo_plates:b.promoDomainPlates}).then(d,d)}});c.CONFIG="CONFIG";c.HIDE="HIDE";c.SHOW="SHOW";c.TO_MYSELF_DOMAIN="toMyself";b.register("mail.PromoplatesManage",c);c.version="0.1.0";return c});define("mail/PromoDomain",["Model","mail/actions/PromoplatesManage"],function(a,b){"use strict";var c=a.extend({checkPlate:function(a){var c=a.promoDomainPlate;if(c===b.TO_MYSELF_DOMAIN){return!a.toMyselfFlag}return true}});c.version="0.1.0";return c});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/promo-domain-die/promo-domain-die",["require","exports","@mail/flags","cfg","default-values","feast","feast-tpl!./promo-domain-die.html","mail/actions/PromoplatesManage","mail/PromoDomain","service/auth","service/radars/index","ui-block/letter-meta/letter-meta"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);exports.default=d.default.Block.extend({name:"promo-domain-die",template:e.default,blocks:{"letter-meta":j.default},events:{"letter-meta:promodomainclose":"onPromoDomainClose"},defaults:{promoDomainModel:new g.default,promoDomainPlate:"",senderEmail:"","dark-mode":false,receivers:[]},constructor:function(){d.default.Block.apply(this,arguments)},attrChanged:{senderEmail:function(a){if(a){this.onGetPromoDomainPlate()}},receivers:function(){this.onGetPromoDomainPlate()}},onGetPromoDomainPlate:function(){var a=this;this.set("promoDomainPlate","");var d=this.get("model");var e=!!b.default.get("qa");var g=this.get("senderEmail");var j=h.default.user;var k=j&&j.getEmail();f.default.execute({method:f.default.CONFIG,email:k,senderEmail:g,config:c.PROMO_DOMAIN_HEADER,isAutotest:e,isClosable:c.PROMO_DOMAIN_CROSS_ENABLED,isToMyself:d&&d.isToMyself()},{silent:true}).then(function(b){var c=b&&b.result;if(c){a.set("promoDomainPlate",c)}}).catch(function(){return(0,i.default)("get-user-promoplates-config-err")})},onPromoDomainClose:function(){var a=!!b.default.get("qa");var c=this.get("promoDomainPlate");f.default.execute({method:f.default.HIDE,promoDomainPlates:[c],isAutotest:a}).catch(function(){return(0,i.default)("user-promoplates-hide-err")});this.set("promoDomainPlate","")},checkPromoDomainPlate:function(){if(!c.PROMO_DOMAIN_HEADER.length){return false}var b=a.default.get("to-myself").isActive();var d=this.get("promoDomainPlate");var e=this.get("promoDomainModel");var f=e.checkPlate({promoDomainPlate:d,toMyselfFlag:b});if(!f){d="";if(c.PROMO_DOMAIN_CROSS_ENABLED){this.onPromoDomainClose()}else{this.set("promoDomainPlate",d)}}return!!d}})});define("feast-tpl!app/feast-tpl!ui-block/thread-subject/thread-subject.html",["feast"],function(a){return a.smartParse('<h2 bem:elem="subject" qa:id="subject">\n    <bem:mod name="pony-mode" test="attrs.ponymode"/>\n    <fn:value>attrs.subject</fn:value>\n</h2>',"app/feast-tpl!ui-block/thread-subject/thread-subject.html")});define("feast-tpl!ui-block/thread-subject/thread-subject.html",["feast-tpl!app/feast-tpl!ui-block/thread-subject/thread-subject.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/thread-subject/thread-subject",["require","exports","feast","feast-tpl!./thread-subject.html","service/emoji"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);exports.default=a.default.Block.extend({name:"thread-subject",template:b.default,didMount:function(){(0,c.emojiFallback)(this.el,"tr-subj")}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/thread/thread",["require","exports","@mail/features","@mail/flags","cfgUser","data-source/utils/actual-letters","default-values","feast","feast-mod/correspondents","feast-mod/letter-date","feast-tpl!./thread.html","helpers/getCurrentTimestamp","helpers/lazy","helpers/metrics/performance","helpers/radar-utils","mail/actions/MarkAs","mail/Folder","mail/getters/MessageMeta","mail/Message","service/adv/config","service/contextmenu","service/getModule","service/notify","service/promo","service/radars/decorator","service/radars/index","service/search-attaches/utils","service/smokescreen","service/storage","ui-block/badge/badge","ui-block/category-feedback/category-feedback","ui-block/delimeter/delimeter","ui-block/letter-category/letter-category","ui-block/letter-list-item/letter-list-item","ui-block/letter-list-item-placeholder/letter-list-item-placeholder","ui-block/letter-meta/letter-meta","ui-block/promo-domain-die/promo-domain-die","ui-block/react-async/react-async","ui-block/scrollable/scrollable","ui-block/thread-subject/thread-subject","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockSpec=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);f=__importDefault(f);i=__importDefault(i);n=__importDefault(n);o=__importDefault(o);q=__importDefault(q);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);I=__importDefault(I);J=__importDefault(J);K=__importDefault(K);L=__importDefault(L);var N="relevant-messages-push-promo";exports.blockSpec={name:"thread",template:i.default,performanceTrace:"track",blocks:{delimeter:D.default,"letter-list-item":F.default,"letter-list-item-placeholder":G.default,"letter-category":E.default,"letter-meta":H.default,"category-feedback":C.default,"promo-domain-die":I.default,"thread-subject":L.default,badge:B.default,"react-async":J.default},lazyBlocks:{letter:M.lazyUILetter},events:{"draft:open":"onDraftOpen","letter:open":"onLetterOpen","letter:close":"onLetterClose","letter:rightclick":"onRightClick","letter-meta:render":"onLetterMetaRender","letter-meta:letterclick":"onLetterMetaClick","letter-meta:toggle-ics":"onToggleIcsAttach","translator:scrollto":"onTranslatorScrollTo"},defaults:{sticky:null,"sticky-disabled":false,"disable-category":false,"enable-amp":e.ENABLE_AMP,noDivider:false,"category-feedback":e.CATEGORY_FEEDBACK,touch:e.TOUCH_MODE,"dark-mode":false,kaspersky:e.KASPERSKY,senderEmail:"",isResendDropdownDisabled:e.IS_RESEND_DROPDOWN_DISABLED,actualReasonFeedback:e.ACTUAL_REASON_FEEDBACK,showOfficialSender:e.SHOW_OFFICIAL_SENDER_PROMO,showReliableSender:e.SHOW_RELIABLE_SENDER_PROMO,attachListHidden:false,categoryFeedbackPlateShowed:false},attrChanged:{model:function(a,b){this.isModelFullyLoaded=a&&a.isDataFully();this.unbindThread(b);this.bindThread(a)},"load-draft-disabled":function(a){if(a===false){this._loadDraft(this.get("model"))}},"expand-letter-id":function(a){if(a&&this.get("model")){this._setExpanded(this.get("model"),true)}}},constructor:function(){f.default.Block.apply(this,arguments);this.onKasperskyLogoClick=this.onKasperskyLogoClick.bind(this);var a=this.get("model");if(a){this.isModelFullyLoaded=a.isDataFully();this._setExpanded(a)}},didMount:function(){(0,k.afterMountCallback)("readletter");v.default.update()},didUnmount:function(){if(this.settedExpidAliexpress){this.settedExpidAliexpress=false;(0,r.deleteRBParam)("exp_id");(0,x.default)("aliexpress-resetting-exp-id")}this.unbindThread(this.get("model"))},bindThread:function(a){var b=this;if(!a){return}this._setExpandedBind=function(){if(b.isMounted()){b._setExpanded(a)}};this._onThreadLoaded=function(){if(b.isMounted()){b._setExpanded(a,false,true);b._emitRecalcAfterUpdate=true}};var c=this.get("direction")||"next";this.el.classList.remove("thread_direction-prev","thread_direction-next");void this.el.offsetWidth;this.el.classList.add("thread_direction-".concat(c));this._letterChangeBind=function(a){var c=a.target,d=a.changes;if(!b.destroyed&&d.includes("folder")){var e=c.getFolder();if(e&&!e.isSpam()&&!e.isTrashLike()){b._closeLetter(c)}}};a.meta("unread-on-open",a.get("flags.unread"));a.on("change",this._setExpandedBind);a.on("loaded-changes",this._onThreadLoaded);a.get("messages").on("change",this._letterChangeBind);this._setExpandedBind();this._emitRecalcAfterUpdate=true;this._loadDraft(a)},usePortalSearchPanel:function(){return e.SEARCH_PANEL_PORTAL},getSenderEmail:function(a){var b;return(b=(0,g.getCorrespondentsFromMessage)(a,"from",".0.email"))!==null&&b!==void 0?b:""},getReceivers:function(a){return(0,g.getCorrespondentsFromMessage)(a,"to")},unbindThread:function(a){if(a){this._letterChangeBind&&a.get("messages").off("change",this._letterChangeBind);this._setExpandedBind&&a.off("change",this._setExpandedBind);this._setExpandedForceBind&&a.off("loaded-changes",this._onThreadLoaded);this._letterChangeBind=null;this._setExpandedBind=null;this._setExpandedForceBind=null;delete this._showCategoryFeedback;this.set("noDivider",false,true)}},isOfficialSender:function(a){var b=a.get("messages.0");return b.is("headers.X-Mailru-Bimi-Organization")&&(b.is("flags.official")||b.is("flags.official_newsletter"))},isReliableSender:function(a){var b=a.get("messages.0");return b.is("headers.X-Mailru-Bimi-Organization")&&(b.is("flags.bimi_msg")||b.is("flags.bimi_important_msg"))},isFakeDoorFmail18333Visible:function(a){var b=c.default.get("LANG");return b==="ru_RU"&&!A.default.get("fake-door-header-fmail-18333",{email:false})&&a.getFolder().get("type")==="tomyself"},isTrackingStatusPlate:function(){return e.TRACKING_STATUS_PLATE&&this.get("model").get("transaction_metadata").get("statement_status")},isCollapsed:function(a){return!this._expandedLetters[a]},isStickyEnabled:function(){return!this.is("sticky-disabled")},isSticky:function(a){var b=this.get("sticky");return b&&b.id===a},isNextCollapsed:function(a){var b=this.get("model").get("messages");var c=b[a+1];return c&&this.isCollapsed(c.id)},isPrevCollapsed:function(a){var b=this.get("model").get("messages");var c=b[a-1];return c&&this.isCollapsed(c.id)},isHideCategory:function(a){var b=a.get("transaction_category");return this.get("noDivider")&&(b==="event"||b==="fees"||b==="order"||b==="travel")},hasCategory:function(a){var b=a.get("transaction_category");var c=a.getFolder().isMetathread();var d=b||c;if(this._showCategoryFeedback===undefined&&d){this._showCategoryFeedback=d}return d||this._showCategoryFeedback},actualLettersEnabled:function(){var a,b;return(0,d.isActualLettersEnabledInFolder)(this.get("router"),(a=this.get("model"))===null||a===void 0?void 0:a.getFolder(),(b=this.get("model"))===null||b===void 0?void 0:b.get("flags.newsletter"))},onShowCategoryFeedbackPlate:function(){this.set("categoryFeedbackPlateShowed",true,false)},isShowCategoryFeedbackPlate:function(){var a;var b=this.get("model");var c=e.SHOW_CATEGORY_FEEDBACK_PLATE&&b.get("messages.0").is("user_feedback");if(e.USE_QUEUE_CATEGORY_FEEDBACK_PLATE&&c){var d=(a=b.get("messages.0").get("user_feedback"))===null||a===void 0?void 0:a.category;var f=A.default.get("letter.meta-category-feedback-shows")||{};var g=this.get("categoryFeedbackPlateShowed");if(!f.hasOwnProperty(d)){return c}if(f[d].countShows>=e.MAX_COUNT_SHOW_CATEGORY_FEEDBACK_PLATE&&!g){return false}if((0,j.getCurrentTimestamp)()-f[d].time<e.DELAY_CATEGORY_FEEDBACK_PLATE&&!g){return false}}return c},isShowPromoPush:function(){var a=this.get("model");var c=a.getFolder();var d=e.SHOW_PROMO_PUSH_PLATE&&!c.isSpam()&&!c.isTrash()&&!b.default.get(N).state&&!b.default.get(N).getCount("close")&&a.get("flags.is_relevant");if(e.USE_QUEUE_PROMO_PUSH_PLATE){var f=+A.default.get("letter.meta-promo-push-show")||0;var g=b.default.get(N).getTimeDelta((0,j.getCurrentTimestamp)());if(f>=e.COUNT_SHOW_PROMO_PUSH_PLATE_BEFORE_DELAY){if(g<e.DELAY_PROMO_PUSH_PLATE){return false}else{A.default.set("letter.meta-promo-push-show",0)}}}return d},isShowPlateMailingSubscribe:function(){if(!e.SHOW_PLATE_NEWSLETTER_MAILING_SUBCRIBE){return false}var a=this.get("model");var b=(A.default.get("newsletter-mailing-choiced-list")||"").split(",");var c=a.get("correspondents.from.0.email");return a.get("flags.newsletter")&&!b.includes(c)},getMessageFolder:function(){return o.default.get(this.get("model").getFolder())},setExpId:function(a){this.settedExpidAliexpress=true;(0,r.setRBParam)("exp_id",a);(0,x.default)("aliexpress-set-exp-id_"+a)},_setExpanded:function(b,c,d){var e=this;if(c===void 0){c=false}if(d===void 0){d=false}var f=b.get("messages")||[];var g=this.get("expand-letter-id");var h=b.get("transaction_metadata");var i=b.get("messages.0");var j=i&&i.get("correspondents.from.0");if(b.id!==this._threadId||!this._expandedLetters||c||d){this._threadId=b.id;if(!d){this._expandedLetters={}}f.forEach(function(a){if(d&&e._expandedLetters.hasOwnProperty(a.id)){return}var c=!e.get("preview-mode");var f=b.canUnfoldMessage(a);var h=c&&f;if(g){var i=a.id.split(";")[0];h=g===a.id||g===i}if(a&&!a.isDataFully()){h=void 0}e._expandedLetters[a.id]=h});if(g&&typeof this._expandedLetters[g]==="undefined"){var k=f.get(g);if(!k){(0,x.default)("search_letter_too_far")}this._loadLetter(k,{behavior:"auto"})}}if(a.default.has("aliexpress-exp-id")&&j){var l=a.default.getAsArray("aliexpress-exp-id");var m=a.default.getAsArray("aliexpress-exp-id-emails");if(h&&h.type==="aliexpress"||j.email===m[0]){this.setExpId(l[0])}else if(j.email===m[1]){this.setExpId(l[1])}else if(j.email===m[2]){this.setExpId(l[2])}else if(/aliexpress.com$/.test(j.email)){this.setExpId(l[3])}}},_loadDraft:function(a){var b=this;var c=a.get("messages");var d=c[0];this.set("hasDraft",false);if(d&&d.get("id")===a.get("expand")){var e=d.get("drafts.last_type");if(e){var f=d.get("drafts.".concat(e));if(f){this.set("hasDraft",true);var g=d.get("folder");q.default.fetchData({id:f,folder_id:g},true,true).then(function(a){b.set("draft",new q.default(a));b.set("draft-source",{id:d.get("id"),mode:e})},function(){b.set("hasDraft",false);d.set("drafts.".concat(e),"")})}}}},onTranslatorScrollTo:function(a){this.scrollLetterIntoView(a.target)},scrollLetterIntoView:function(a,b){if(b===void 0){b={behavior:"smooth"}}if(!this.isMounted()){return false}var c=a;if(typeof a==="string"){c=this.el.querySelector((0,z.selector)('[data-id="'.concat(a,'"]')))}var d=K.default.getScrollableBlock(this);if(!c||!d){return false}var e=this.el.getBoundingClientRect().top;var f=c.getBoundingClientRect().top;var g=f-e;var h=d.get("silent");d.set({silent:true});try{d.el.scrollTo({top:g,behavior:b.behavior||"smooth"})}catch(a){d.el.scrollTop=g}d.set({silent:h});return true},scheduleScrollLetterIntoView:function(a){this._scrollToIdAfterUpdate=a},didUpdate:function(){var a=this;var b;(0,l.sendAfterUpdateLetterMetric)((b=this.get("model"))===null||b===void 0?void 0:b.get("id"));if(this._scrollToIdAfterUpdate){this.scrollLetterIntoView(this._scrollToIdAfterUpdate);this._scrollToIdAfterUpdate=null}if(this._emitRecalcAfterUpdate){this._emitRecalcAfterUpdate=false;this.broadcast("force:recalc")}if(e.THREAD_SWITCH_RACE_FIX){var c=this.get("model");if(!this.isModelFullyLoaded&&c&&c.isDataFully()){this.isModelFullyLoaded=true;this._setExpanded(c,true);window.setTimeout(function(){if(a.isMounted()){a.render()}})}}},_loadLetter:function(a,b){var c=this;if(a){var d=a.is("flags.unread");var f=a.get("id");var g=a.get("folder");if(d){n.default.execute({flag:"unread",state:false,models:[a]})}a.fetch({id:f,folder_id:g,use_color_scheme:e.DARK_MODE_MEDIA_QUERY?1:0}).then(function(){c._expandedLetters[f]=true;c.update();if(b!==null){c.scrollLetterIntoView(f,b)}}).catch(function(a){console.log(a);if(a&&!a.body){(0,t.default)("trackJS").then(function(b){return b.addErrorFromApp(a,"octavius_smth_wrong")});u.default.error({unique:true})}})}},_closeLetter:function(a){this._expandedLetters[a.get("id")]=void 0},update:function(){this.render()},onDraftOpen:function(a){var b=this.get("draft");var c=this.get("draft-source");if(!a.isDefaultPrevented()){this.broadcast("compose:draft",{model:b,source:c})}return true},onLetterOpen:function(a){var b=a.details;if(!a.isDefaultPrevented()){this._loadLetter(b,null)}return true},onLetterClose:function(a){if(this.get("preview-mode")){return true}var b=window.getSelection();var c=a.details;var d=this.get("model");var e=d.get("messages");var f=e.length;if(!a.isDefaultPrevented()&&!b.toString().length&&f>1){this.broadcast("letter:collapse",c);a.preventDefault();this._closeLetter(c);this.update()}return true},onRightClick:function(a){a.details.folders=this.get("folders");a.details.selectable=false;var b={parentThread:this.get("model")};s.default.show(a,b)},onLetterMetaRender:function(a){this.set("noDivider",!!a.details.showed)},onLetterMetaClick:function(a){var b=(a.details||{}).uidl;var c=this.get("model");var d=c.get("messages");var e=d.find(function(a){return a.get("id")===b});this._loadLetter(e)},getFirstCalendarAttach:function(){var a=this.get("model");var b=a.getExpandMessage();var c=b.getCalendarFromAttach();if(c.length){return{messageId:b.get("id"),calendarInfo:c[0]}}},isEngKasperskyLogo:function(){return e.KASPERSKY_ENG_LOGO_LANGS.includes(e.USER_LANG)},onKasperskyLogoClick:function(a){a.stopPropagation();a.nativeEvent.stopImmediatePropagation();this.broadcast("click-kaspersky")},_formDatesMetadata:function(){var a=this.get("model");var b=a.get("dates_metadata.priority_date");if(e.DATES_METADATA&&b.timestamp&&a.get("messages").length===1){return b}return null},getResendData:function(){var a,b;var c=this.get("model");var d=c.getExpandMessage();if(!d){return null}var e=d.get("resend");if(!e||!((a=e.from)===null||a===void 0?void 0:a.length)&&!((b=e.to)===null||b===void 0?void 0:b.length)){return null}var f=d.get("date");var g=e.from,i=g===void 0?[]:g,j=e.to,k=j===void 0?[]:j,l=e.date;return{from:i,to:k,date:l?(0,h.getLocaleDateFull)(l,false):null,receivedDate:(0,h.getLocaleDateFull)(f,false)}},parentalControlDieEnabled:function(){return this.getMessageFolder().isParentalControl()||e.FORCE_PARENTAL_CONTROL_DIE},needLetterMeta:function(){var a=this.get("model");var b=a.get("transaction_metadata");return!!(a.getJsonLdInfo()||b.getAttributes()||(0,p.getCalendarIcsEvent)(a)||(0,p.getCalendarMLEvent)(a))},needLetterMetaSkeleton:function(){var a=this.get("model");var b=e.SMART_CARD_ICS&&!!(0,p.getCalendarIcsEvent)(a);var c=this.isTrackingStatusPlate();var d=e.SMART_CARD_ML&&!!(0,p.getCalendarMLEvent)(a);return e.LETTER_META_SKELETON_ENABLE&&(b||c||d)},onToggleIcsAttach:function(a){this.set("showAttachList",a.details.isOpen)},needHideAttachList:function(){var a=this.get("model");if(!e.SMART_CARD_ICS||!(0,p.getCalendarIcsEvent)(a)){return false}var b=a.get("messages.0");var c=b===null||b===void 0?void 0:b.get("attaches.list.length");if(c!==1){return false}var d=b.get("correspondents.from.0.email");if(e.SHOW_ICS_ATTACH_CALENDAR_LETTER&&e.CALENDAR_EMAIL_LIST.includes(d)){return false}var f=b.get("attaches.list.0").get("name");var g=(0,y.getAttachmentExtension)(f);return e.HIDE_ICS_ATTACH&&g==="ics"}};exports.default=f.default.Block.extend((0,w.default)({events:[{name:"mount",data:m.getModelDataWithRelevant},{name:"unmount",data:m.getModelData},{name:"click-kaspersky",rename:"kaspersky_click"}]})(exports.blockSpec))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/panel-with-selected/panel-with-selected",["require","exports","default-values","feast","feast-mod/letter-count","feast-tpl!./panel-with-selected.html","mail/Thread","models/metathread/metathread","ui-block/metathread-preview/metathread-preview","ui-block/portal-menu/portal-menu","ui-block/thread/thread"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);i=__importDefault(i);exports.default=b.default.Block.extend({name:"panel-with-selected",template:d.default,blocks:{thread:i.default,"metathread-preview":g.default},attrChanged:{selected:function(a){var b=a[a.length-1];var c=b;var d;if(b&&!(b instanceof e.default)){c=e.default.getSafe(b.meta("thread_id"));d=b.id}var g=c&&f.default.isMetathread(c);function h(){if(!d&&c&&c.get("messages").length){d=c.get("messages").eq(0).id}this.set({"is-metathread":g,"selected-last-thread":c,"expand-letter-id":d});this.render()}if(c&&!c.isDataFully()&&!g){c.fetch().then(h.bind(this))}else{h.apply(this)}}},didMount:function(){var a=this.el;var b=a.style;var c=a.offsetParent;b.marginTop=c.scrollTop+"px";this.$on(c,"scroll",function(){b.marginTop=c.scrollTop+"px"})},didUnmount:function(){this.el.style.marginTop=""},useNewThread:function(){return a.NEW_THREAD},didUpdate:function(a){var b=this.attrs,c=b.folder,d=b.selectFolder,e=b.selected,f=b.route;var g=f.is("#search #search-letter");if(c!==undefined&&d!==undefined&&e!==undefined&&g!==undefined&&(a.folder!==c||a.selectFolder!==d||a.selected!==e||a.searchRoute!==g)){this.set("searchRoute",g);this.set("selectedCount",(0,h.getSelectedCount)({folder:c,selectFolder:d,selected:e},{searchRoute:g}))}},getSelectedLetterCountText:function(){var b=this.get("selectedCount");return a.NEW_TOOLBAR&&b?(0,c.letterCount)(b):""}})});define("feast-tpl!app/feast-tpl!ui-block/progress/progress.html",["feast"],function(a){return a.smartParse('<span>\n\t<bem:mod name="hidden" test="!attrs.visible"/>\n\t<bem:mod name="inanimate" test="attrs.inanimate"/>\n\n\t<span\n\t\tbem:elem="value"\n\t\tstyle="width: {_this.getProgressWidth_()};"\n\t/>\n\n</span>\n',"app/feast-tpl!ui-block/progress/progress.html")});define("feast-tpl!ui-block/progress/progress.html",["feast-tpl!app/feast-tpl!ui-block/progress/progress.html"],function(a){return a});define("ui-block/progress/progress",["exports","feast","feast-tpl!./progress.html"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=0;var g=100;var h=0;exports.default=c.default.Block.extend({name:"progress",template:d.default,immutable:true,defaults:{visible:true},getProgressWidth_:function a(){var b=parseInt(this.get("min"),10)||f;var c=parseInt(this.get("max"),10)||g;var d=parseInt(this.get("value"),10)||h;var e=Math.max(c-b,0);return Math.round(d/e*100)+"%"}})});define("feast-tpl!app/feast-tpl!ui-block/renovator/renovator.html",["feast"],function(a){return a.smartParse('<div ref="container">\n\t<bem:mod name="visible" test="attrs.isLettersRoute"/>\n\t<bem:mod name="{attrs.type}"/>\n</div>\n',"app/feast-tpl!ui-block/renovator/renovator.html")});define("feast-tpl!ui-block/renovator/renovator.html",["feast-tpl!app/feast-tpl!ui-block/renovator/renovator.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/renovator/renovator",["require","exports","feast","feast-tpl!./renovator.html","service/promo"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.default=a.default.Block.extend({name:"renovator",template:b.default,defaults:{isLettersRoute:false,type:"2pane"},attrChanged:{isLettersRoute:function(a){if(a){c.default.updateRenovator()}else{c.default.hideRenovator()}}}})});define("feast-tpl!app/feast-tpl!ui-block/shortcut/shortcut.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:add-class name="js-shortcut" />\n</div>\n',"app/feast-tpl!ui-block/shortcut/shortcut.html")});define("feast-tpl!ui-block/shortcut/shortcut.html",["feast-tpl!app/feast-tpl!ui-block/shortcut/shortcut.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/shortcut/shortcut",["require","exports","feast","feast-tpl!./shortcut.html","service/compose","service/layer","service/radars/index","service/shortcut"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);var g=document.createElement("div");g.style.cssText="\n    position: absolute;\n    display : none;\n    width: 1px;\n    height: 1px;\n";exports.default=a.default.Block.extend({name:"shortcut",template:b.default,defaults:{shortcut:"shift+?|shift+&"},events:{click:"onBlockClick"},onBlockClick:function(){var a=this;if(this.layer){this.layer.broadcast("dimmer:click")}d.default.open("shortcut",{},{dimmer:true}).then(function(b){a.layer=b;(0,e.default)({chain:["shortcut"],intervals:[["help_show","1"]]})})},updateTitleByElement:function(a){if(!a.getAttribute("data-shortcut-title")){var b=a.getAttribute("title")||a.getAttribute("data-title");if(b){var c=f.default.getShortcutTitle(a.getAttribute("data-shortcut"));if(c){a.setAttribute("data-title-shortcut","".concat(c))}}a.setAttribute("data-shortcut-title",1)}},updateTitles:function(){var b=this.shortcut.getShortcutItems();for(var c=0,d=b;c<d.length;c++){var e=d[c];var f=a.default.Block.get(e);if(!f){this.updateTitleByElement(e)}}},didMount:function(){var b=this;this.shortcut=new f.default;this.shortcut._canDoIt=function(a){var b=a.offsetParent;while(b&&!b.className.includes("dropdown ")){b=b.offsetParent}var e=getComputedStyle(a).visibility==="visible"||b&&b.className.includes("dropdown ")&&getComputedStyle(b).visibility==="visible";if(e){var f=d.default.getInstance();var g=(c.default.getView||c.default.default.getView)();var h=f&&f.get("active")&&!f.el.contains(a);var i=g&&g.get("active")&&!g.el.contains(a);if(h||i){e=false}}return e};this.shortcut._doAction=function(c,d){var f=b.shortcut._canDoIt(c);if(f){var h=a.default.Block.get(c);if(h&&d.uiname){h.broadcast(d.uiname.replace("-",":"))}else{var i=void 0;var j=void 0;if(typeof Event==="function"){i=new Event("mousedown");j=new Event("mouseup")}else{i=document.createEvent("MouseEvents");j=document.createEvent("MouseEvents");i.initMouseEvent("mousedown",true,true,window,0,0,0,0,0,false,false,false,false,undefined,null);j.initMouseEvent("mousedown",true,true,window,0,0,0,0,0,false,false,false,false,undefined,null)}if(d.uiname){g.setAttribute("data-name",d.uiname);c.parentElement.appendChild(g);g.dispatchEvent(i);g.dispatchEvent(j);g.click();setTimeout(function(){g.setAttribute("data-name","")},0)}else if(c.nodeName=="INPUT"&&(c.type=="text"||c.type=="password")||c.nodeName=="TEXTAREA"){c.focus()}else{c.dispatchEvent(i);c.dispatchEvent(j);c.click()}return true}(0,e.default)({chain:["shortcut"],intervals:[[String(d.shortcut),"1"]]})}return f};this.updateTitles()}})});define("feast-tpl!app/feast-tpl!ui-block/sidebar-folders/sidebar-folders.html",["feast"],function(a){return a.smartParse('<div a11y:tooltip-direction="right">\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="short" value="{attrs.short}" />\n\t<fn:var name="ponyMode" value="{attrs.ponymode}" />\n\t<fn:var name="widget" value="{attrs[\'widget-enabled\']}" />\n\t<fn:var name="isSearch" value="{attrs[\'is-search\']}" />\n\t<fn:var name="widgetsMinHeight" value="{_this.getWidgetsMinHeight()}" />\n\n\t<bem:mod name="css-vars-fallback" test="attrs[\'css-vars-fallback\']" />\n\n\t\x3c!-- Сайдбар --\x3e\n\t<b:sidebar\n\t\tid="sidebar"\n\t\tponymode="{ponyMode}"\n\t\tsettings\n\t\tshort="{short}"\n\t\twidget="{widget}"\n\t\tref="sidebar"\n\t\tshort-scroll-style="{isSearch ? \'thin\' : \'minimal\'}"\n\t\tisSearch="{isSearch}"\n\t\tremit:resize-full="sidebar-resize-full"\n\t\tremit:resize-short="sidebar-resize-short"\n\t\tfooter-min-height="{widgetsMinHeight.full}"\n\t\tshort-footer-min-height="{widgetsMinHeight.short}"\n\t>\n\t\t<fn:match name="sidebar-top-menu" args="isShort, isOpen">\n\t\t\t\x3c!-- Кнопка звонков основная, остальное второстепенное, так что без неё можно и не показывать дропдаун --\x3e\n\t\t\t<fn:var name="withDropdown" value="{attrs[\'invite-calls\'] && !isShort}" />\n\t\t\t<fn:var name="webview" value="{attrs.webview}" />\n\n\t\t\t\x3c!-- Шапка сайдбара --\x3e\n\t\t\t<div bem:elem="header" ref="sideBarHeader">\n\t\t\t\t\x3c!-- Кнопка Написать письмо (есть всегда) --\x3e\n\t\t\t\t<div bem:elem="compose-btn-box">\n\t\t\t\t\t<bem:mod name="with-dropdown" test="withDropdown" />\n\t\t\t\t\t<b:compose-button\n\t\t\t\t\t\tremit:click="compose:new"\n\t\t\t\t\t\tremit:mouseenter="compose:preload"\n\t\t\t\t\t\tremit:mousedown="compose:preload"\n\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\tqa:id="compose"\n\t\t\t\t\t\tbase="{!isShort}"\n\t\t\t\t\t\tcompact="{ponyMode}"\n\t\t\t\t\t\tshortcut="n"\n\t\t\t\t\t\ttitle="{i18n(\'Написать письмо\')}"\n\t\t\t\t\t\twhite="{!isOpen}"\n\t\t\t\t\t\twith-dropdown="{withDropdown}"\n\t\t\t\t\t\twebview="{webview}"\n\t\t\t\t\t/>\n\t\t\t\t\t<b:compose-dropdown\n\t\t\t\t\t\tfn:if="withDropdown"\n\t\t\t\t\t\tqa:id="compose-dropdown"\n\t\t\t\t\t\tuse:mediator="compose-manager calendar-manager calls-manager"\n\t\t\t\t\t\tcompact="{ponyMode}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t\x3c!-- Бургер/Скрыть --\x3e\n\t\t\t\t<a\n\t\t\t\t\tfn:if="isShort || isOpen"\n\t\t\t\t\tbem:elem="menu-item"\n\t\t\t\t\tremit:click="sidebar:toggle"\n\t\t\t\t\tqa:id="burger-button"\n\t\t\t\t\ttitle="{!isOpen && !isSearch ? i18n(\'Все папки\') : i18n(\'Все фильтры\')}"\n\t\t\t\t>\n\t\t\t\t\t<div bem:elem="unread-badge">\n\t\t\t\t\t\t<fn:var name="unreadLimit" value="99" />\n\t\t\t\t\t\t<fn:var name="unread" value="{_this.getTotalUnread()}" />\n\t\t\t\t\t\t<b:badge\n\t\t\t\t\t\t\ttext="{unread > unreadLimit ? unreadLimit + \'+\' : unread}"\n\t\t\t\t\t\t\tsize="{ponyMode ? \'xxs_alt\' : \'s_alt\'}"\n\t\t\t\t\t\t\tstrong\n\t\t\t\t\t\t\ttransparent="{short}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<span bem:elem="menu-ico">\n\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\tname="{attrs.ponymode ? \'navigation:menu_s\' : \'navigation:menu\'}"\n\t\t\t\t\t\t\tsize="m"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="menu-text">{i18n(\'Скрыть\')}</span>\n\t\t\t\t</a>\n\n\t\t\t\t<fn:if test="isSearch">\n\t\t\t\t\t<div bem:elem="filter-inbox-container" fn:if="!_this.useNewToolbar()">\n\t\t\t\t\t\t<bem:mod name="ponymode" test="ponyMode" />\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\tbem:elem="menu-item"\n\t\t\t\t\t\t\thref="{_this.getInboxUrl()}"\n\t\t\t\t\t\t\tremit:click="search:inbox:click"\n\t\t\t\t\t\t\tqa:id="search-sidebar-inbox"\n\t\t\t\t\t\t\ttitle="{isShort && i18n(\'Перейти во входящие\')}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div bem:elem="filter-inbox-item">\n\t\t\t\t\t\t\t\t<bem:mod name="ponymode" test="!isShort && ponyMode" />\n\t\t\t\t\t\t\t\t<span bem:elem="menu-ico">\n\t\t\t\t\t\t\t\t\t<div bem:elem="filter-icon">\n\t\t\t\t\t\t\t\t\t\t<bem:mod name="short" test="isShort" />\n\t\t\t\t\t\t\t\t\t\t<bem:mod name="full" test="!isShort" />\n\t\t\t\t\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\t\t\t\t\tclass="filter-inbox-icon"\n\t\t\t\t\t\t\t\t\t\t\tname="{attrs.ponymode ? \'categories:mail_s\' : \'categories:mail\'}"\n\t\t\t\t\t\t\t\t\t\t\tsize="m"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<div fn:if="!isShort || isOpen" bem:elem="filter-inbox">\n\t\t\t\t\t\t\t\t\t<bem:mod name="ponymode" test="ponyMode" />\n\t\t\t\t\t\t\t\t\t<bem:mod name="normal" test="!ponyMode" />\n\t\t\t\t\t\t\t\t\t<fn:add-class name="r-text" />\n\t\t\t\t\t\t\t\t\t{i18n(\'Перейти во входящие\')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<fn:if test="!isShort || isOpen">\n\t\t\t\t\t\t<div bem:elem="filter-txt" qa:id="search-sidebar-filters">\n\t\t\t\t\t\t\t<fn:add-class name="r-text" />\n\t\t\t\t\t\t\t{i18n(\'Фильтры поиска\')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<hr bem:elem="hr" />\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:if>\n\t\t\t</div>\n\t\t</fn:match>\n\n\t\t<fn:match name="sidebar-content" args="isShort, isOpen">\n\t\t\t\x3c!-- Контент: список папок на шорткатах--\x3e\n\t\t\t<div ref="sideBarContent" id="sideBarContent">\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="isSearch">\n\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\tref="reactAsync"\n\t\t\t\t\t\t\tclass-name="sidebar__layer"\n\t\t\t\t\t\t\tuse:mediator="letters-actions user-info letters-loader pony-mode"\n\t\t\t\t\t\t\tcomponent="SearchSidebar"\n\t\t\t\t\t\t\tonSearchPanelFocus="{_this.handleSearchPanelFocus}"\n\t\t\t\t\t\t\tponyMode="{ponyMode}"\n\t\t\t\t\t\t\tnanoMode="{ponyMode}"\n\t\t\t\t\t\t\tsearch="{attrs.store.search}"\n\t\t\t\t\t\t\tshortcut="{isShort}"\n\t\t\t\t\t\t\tcategories="{attrs.categories}"\n\t\t\t\t\t\t\tcolorTags="{attrs.colorTags}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<b:nav-folders\n\t\t\t\t\t\t\tref="navFolders"\n\t\t\t\t\t\t\tuse:mediator="letters-actions folders-actions letters-loader pony-mode folders-navigation"\n\t\t\t\t\t\t\tremit:folderclick="folder:click"\n\t\t\t\t\t\t\tactive="{attrs[\'folder-active\']}"\n\t\t\t\t\t\t\thandle-drop\n\t\t\t\t\t\t\tmodels="{attrs.models}"\n\t\t\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\t\t\tshort="{isShort}"\n\t\t\t\t\t\t\tsidebar\n\t\t\t\t\t\t\twith-clear="{!isShort}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</div>\n\t\t</fn:match>\n\n\t\t<fn:match name="sidebar-bottom-menu" args="isShort, isOpen">\n\t\t\t<b:sidebar-widgets\n\t\t\t\tfn:if="!_this.useNewToolbar()"\n\t\t\t\tuse:mediator="sidebar-menu"\n\t\t\t\tref="sideBarFooter"\n\t\t\t\tbillsCount="{attrs.billsCount}"\n\t\t\t\tshort="{isShort}"\n\t\t\t\topen="{isOpen}"\n\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t/>\n\n\t\t\t<fn:if test="attrs.showUnsubscribeButton">\n\t\t\t\t<b:react-async\n\t\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\t\tcomponent="SidebarUnsubscribeButton"\n\t\t\t\t\tponyMode="{ponyMode}"\n\t\t\t\t\tshowTitle="{!isShort || isOpen}"\n\t\t\t\t\tshortOpenedSidebar="{isShort || isOpen}"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\n\t\t\t<b:settings\n\t\t\t\tfn:if="_this.useNewToolbar()"\n\t\t\t\tfont-size-pony="{ponyMode}"\n\t\t\t\tshowTitle="{!isShort || isOpen}"\n\t\t\t\tremit:click="menu-settings:click"\n\t\t\t\tuse:mediator="layout-manager themes-manager settings-manager pony-mode advert-manager todo-manager"\n\t\t\t\tradar-id="st"\n\t\t\t\tfill\n\t\t\t\ttext-overflow\n\t\t\t/>\n\t\t</fn:match>\n\n\t\t<fn:match name="sidebar-bottom-widget" args="isShort">\n\t\t\t\x3c!-- Виджет тем --\x3e\n\t\t\t<b:themes-widget ref="themesWidget" use:mediator="themes-manager" />\n\t\t</fn:match>\n\t</b:sidebar>\n</div>\n',"app/feast-tpl!ui-block/sidebar-folders/sidebar-folders.html")});define("feast-tpl!ui-block/sidebar-folders/sidebar-folders.html",["feast-tpl!app/feast-tpl!ui-block/sidebar-folders/sidebar-folders.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/compose-button/compose-button.html",["feast"],function(a){return a.smartParse('<a\n\ttitle="{attrs.title || attrs.text}"\n\thref="/compose/"\n\tdata-title-shortcut="{attrs[\'title-shortcut\'] || \'\'}"\n\tqa:id="button:{attrs.ico || attrs.title || attrs.text}"\n>\n\t<bem:mod name="white" test="attrs.white"/>\n\t<bem:mod name="base" test="attrs.base"/>\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="short" test="attrs.short"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\t<bem:mod name="with-dropdown" test="attrs[\'with-dropdown\']"/>\n\t<bem:mod name="webview" test="attrs.webview"/>\n\n\t<fn:add-class name="js-shortcut" test="attrs.shortcut" />\n\n\n\t<span\n\t\tbem:elem="wrapper"\n\t\tref="wrapper"\n\t>\n\t\t<fn:attr\n\t\t\tname="tabindex"\n\t\t\tvalue="{attrs.disabled ? -1 : attrs[\'tab-index\']}"\n\t\t\ttest="attrs[\'tab-index\'] !== void 0"\n\t\t/>\n\n\t\t<span bem:elem="ico" fn:if="attrs.short">\n\t\t\t<b:ico name="compose"/>\n\t\t</span>\n\n\t\t<span ref="text" bem:elem="txt" fn:if="!attrs.short">{i18n(\'Написать письмо\')}</span>\n\t</span>\n</a>\n',"app/feast-tpl!ui-block/compose-button/compose-button.html")});define("feast-tpl!ui-block/compose-button/compose-button.html",["feast-tpl!app/feast-tpl!ui-block/compose-button/compose-button.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/compose-button/compose-button",["require","exports","feast","feast-tpl!./compose-button.html","helpers/get-adaptive","service/radars/decorator","ui-block/ico/ico"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);var f=150;exports.default=a.default.Block.extend((0,d.default)({events:[{name:"click-radar",rename:"click"}]})({name:"compose-button",template:b.default,defaults:{},blocks:{ico:e.default},events:{"keydown:enter":"onKeydownEnter"},didMount:function(){this.onResize=this.onResize.bind(this);this.adaptiveHandler=new c.GetAdaptive({pureBreakpoints:true,breakpoints:[{conditions:function(a){return a.width<f},props:{short:true}},{props:{short:false}}],onResize:this.onResize,element:this.el})},didUnmount:function(){this.adaptiveHandler.destroy()},onResize:function(a){this.set(a)},onKeydownEnter:function(){var a=$(this.el);a.click()},focus:function(){this.refs.wrapper.focus()}}))});define("feast-tpl!app/feast-tpl!ui-block/compose-dropdown/compose-dropdown.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="expanded" test="attrs.expanded"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\n\t<b:dropdown\n\t\tqa:id="compose-dropdown"\n\t\tremit:dropdown-change-state="dropdown:toggle"\n\t\tradar-id="cdd"\n\t\tico="navigation:drop_down"\n\t\tclean\n\t\trotate-ico\n\t\talways-bright\n\t\tponymode="{attrs.compact}"\n\t\ttouch="{attrs.touch}"\n\t>\n\t\t<fn:match name="items">\n\t\t\t<b:list>\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="!attrs[\'disabled-tomyself\']"\n\t\t\t\t\tremit:click="compose:tomyself"\n\t\t\t\t\tradar-id="tomyself"\n\t\t\t\t\tqa:id="tomyself"\n\t\t\t\t\tpure\n\t\t\t\t>\n\t\t\t\t\t<b:avatar\n\t\t\t\t\t\tico="categories:self_mail"\n\t\t\t\t\t\tico-size="s"\n\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\tbg-color="#00bd93"\n\t\t\t\t\t\tico-color="#fff"\n\t\t\t\t\t\twith-border="{false}"\n\t\t\t\t\t/>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Написать себе\')}</span>\n\t\t\t\t</b:list-item>\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="_this.needShowButton(\'note\')"\n\t\t\t\t\tremit:click="compose:opennote"\n\t\t\t\t\tradar-id="note_fake"\n\t\t\t\t\tpure\n\t\t\t\t>\n\t\t\t\t\t<b:avatar\n\t\t\t\t\t\tico="categories:drafts_s"\n\t\t\t\t\t\tico-size="s"\n\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\tbg-color="#CCA7FF"\n\t\t\t\t\t\tico-color="#fff"\n\t\t\t\t\t\twith-border="{false}"\n\t\t\t\t\t/>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Создать заметку\')}</span>\n\t\t\t\t</b:list-item>\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="_this.needShowButton(\'task\')"\n\t\t\t\t\tremit:click="compose:fakedoor"\n\t\t\t\t\tradar-id="task_fake"\n\t\t\t\t\tpure\n\t\t\t\t>\n\t\t\t\t\t<b:avatar\n\t\t\t\t\t\tico="status:doneround"\n\t\t\t\t\t\tico-size="s"\n\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\tbg-color="#FA8857"\n\t\t\t\t\t\tico-color="#fff"\n\t\t\t\t\t\twith-border="{false}"\n\t\t\t\t\t/>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Создать задачу\')}</span>\n\t\t\t\t</b:list-item>\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="_this.needShowButton(\'board\')"\n\t\t\t\t\tremit:click="compose:fakedoor"\n\t\t\t\t\tradar-id="board_fake"\n\t\t\t\t\tpure\n\t\t\t\t>\n\t\t\t\t\t<b:avatar\n\t\t\t\t\t\tico="navigation:view_pinterest"\n\t\t\t\t\t\tico-size="s"\n\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\tbg-color="#F77272"\n\t\t\t\t\t\tico-color="#fff"\n\t\t\t\t\t\twith-border="{false}"\n\t\t\t\t\t/>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Создать интерактивную доску\')}</span>\n\t\t\t\t</b:list-item>\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="!attrs[\'disabled-call\']"\n\t\t\t\t\tremit:click="calls:invitenew"\n\t\t\t\t\tradar-id="call"\n\t\t\t\t\tqa:id="call"\n\t\t\t\t\ttitle="{!attrs[\'disable-calls-tip\'] && i18n(\'Участники встречи получат ссылку для видеозвонка и присоединятся, когда перейдут по ней\')}"\n\t\t\t\t\tpure\n\t\t\t\t>\n\t\t\t\t\t<b:avatar\n\t\t\t\t\t\tico="categories:camera"\n\t\t\t\t\t\tico-size="s"\n\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\tbg-color="#38e0a1"\n\t\t\t\t\t\tico-color="#fff"\n\t\t\t\t\t\twith-border="{false}"\n\t\t\t\t\t/>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Предложить звонок\')}</span>\n\t\t\t\t</b:list-item>\n\t\t\t\t<b:list-item\n\t\t\t\t\tfn:if="!attrs[\'disabled-calendar\']"\n\t\t\t\t\tremit:click="calendar:createnew"\n\t\t\t\t\tevent:details="{createContent:\'web_email_select\'}"\n\t\t\t\t\tradar-id="calendar"\n\t\t\t\t\tqa:id="calendar"\n\t\t\t\t\tpure\n\t\t\t\t>\n\t\t\t\t\t<b:avatar\n\t\t\t\t\t\tico="calendar-month"\n\t\t\t\t\t\tico-size="s"\n\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\tbg-color="#005ff9"\n\t\t\t\t\t\tico-color="#fff"\n\t\t\t\t\t\twith-border="{false}"\n\t\t\t\t\t/>\n\t\t\t\t\t<span bem:elem="text">{i18n(\'Создать событие\')}</span>\n\t\t\t\t</b:list-item>\n\t\t\t</b:list>\n\t\t</fn:match>\n\t</b:dropdown>\n</div>\n',"app/feast-tpl!ui-block/compose-dropdown/compose-dropdown.html")});define("feast-tpl!ui-block/compose-dropdown/compose-dropdown.html",["feast-tpl!app/feast-tpl!ui-block/compose-dropdown/compose-dropdown.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/compose-dropdown/compose-dropdown",["require","exports","default-values","feast","feast-tpl!./compose-dropdown.html","service/radars/decorator","ui-block/dropdown/dropdown"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);exports.default=b.default.Block.extend((0,d.default)({events:[{name:"click-radar",rename:"click"},"mount"]})({name:"compose-dropdown",template:c.default,defaults:{expanded:false,"radar-id":"cdd","disabled-tomyself":a.CALLS_DISABLE_COMPOSE_DROPDOWN_TOMYSELF,"disabled-call":a.CALLS_DISABLE_COMPOSE_DROPDOWN_CALL,"disabled-calendar":a.CALLS_DISABLE_COMPOSE_DROPDOWN_CALENDAR,"disable-calls-tip":a.DISABLE_CALLS_TIP},blocks:{dropdown:e.default},events:{"dropdown:toggle":"onDropdownToggle"},checkHasFeature:function(b){switch(b){case"note":return a.NEW_TOOLBAR_PROJECTS_NOTES}return false},needShowButton:function(a){return this.checkHasFeature(a)},onDropdownToggle:function(a){this.set("expanded",a.details.state)}}))});define("feast-tpl!app/feast-tpl!ui-block/sidebar-widgets/sidebar-widgets.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="short" value="{attrs.short}" />\n\t<fn:var name="isOpen" value="{attrs.open}" />\n\n\t<fn:var name="showTitle" value="{attrs[\'vertical-list\'] && (!short || isOpen)}" />\n\t<fn:var name="position" value="{showTitle || short && !isOpen  ? \'vertical\' : \'horizontal\'}" />\n\n\t<fn:var name="ponyMode" value="{attrs[\'pony-mode\']}" />\n\n\t<bem:mod name="pony-mode" test="attrs[\'pony-mode\']" />\n\t<bem:mod name="short" test="attrs[\'short\']" />\n\t<bem:mod name="full" test="!attrs[\'short\']" />\n\t<bem:mod name="wide-settings-button" test="attrs[\'menu-widget-list\'].length === 0 && ponyMode" />\n\n\t<fn:var name="isPayWidgetInDropdown" value="_this.isPayWidgetInDropdown()"/>\n\n\t\x3c!-- Футер сайдбара: виджеты --\x3e\n\t<div bem:elem="footer"\n\t\t\tqa:id="sidebar-footer-{position}"\n\t\t\tpromo:id="sidebar-widgets-position-{position}"\n\t\t\tdata-position="{position}"\n\t\t\tref="sidebarFooter"\n\t\t\ta11y:tooltip-direction="{position === \'horizontal\' ? \'top\' : \'right\'}"\n\t>\n\t\t<bem:mod name="vertical" test="attrs[\'vertical-list\']"/>\n\t\t<bem:mod name="centered" test="attrs[\'short\']"/>\n\n\t\t<fn:for data="attrs[\'menu-widget-list\']" as="menuItem" key="menuItemKey">\n\t\t\t<div bem:elem="footer__item" key="{menuItemKey}" promo:id="sidebar-widgets-item{showTitle ? \'-full\' : \'\'}">\n\t\t\t\t<fn:var name="menuItemType" value="{(menuItem.type === \'bonus\' && attrs[\'is-pdd-user\']) ? \'club\' : menuItem.type}" />\n\t\t\t\t<fn:var name="isPayBadgeActive" value="{attrs[\'is-pay-widget-helper-active\']}" />\n\t\t\t\t<fn:var name="isPayWidget" value="{menuItem.type === \'pay\'}" />\n\n\t\t\t\t<fn:choose>\n\t\t\t\t\t<fn:when test="menuItem.type === \'contacts\'">\n\t\t\t\t\t\t<b:widget\n\t\t\t\t\t\t\t\tuse:mediator="addressbook-manager"\n\t\t\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\t\t\tremit:click-on-link="menu-item:click"\n\t\t\t\t\t\t\t\tshortcut="g,c"\n\t\t\t\t\t\t\t\ttype="{menuItemType}"\n\t\t\t\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\t\t\t\tshowTitle="{showTitle}"\n\t\t\t\t\t\t\t\tqa:id="footer-widget"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:when>\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<b:widget\n\t\t\t\t\t\t\t\tremit:click-on-link="menu-item:click"\n\t\t\t\t\t\t\t\ttype="{menuItemType}"\n\t\t\t\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\t\t\t\tshowTitle="{showTitle}"\n\t\t\t\t\t\t\t\tnotification-badge="{isPayWidget && isPayBadgeActive && \'sidebar_pay_notif_show\'}"\n\t\t\t\t\t\t\t\tqa:id="footer-widget"\n\t\t\t\t\t\t\t\tbillsCount="{attrs.billsCount}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</div>\n\t\t</fn:for>\n\t\t<fn:if test="attrs[\'menu-dropdown-list\'].length > 0">\n\t\t\t<div\n\t\t\t\t\tbem:elem="footer__item"\n\t\t\t\t\tpromo:id="{isPayWidgetInDropdown && \'menu-item_pay\'}"\n\t\t\t>\n\t\t\t\t<b:dropdown\n\t\t\t\t\t\tqa:id="dropdown-menu"\n\t\t\t\t\t\tico="more-hor"\n\t\t\t\t\t\tpure\n\t\t\t\t\t\tshort\n\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\tradar-id="dropdown_menu"\n\t\t\t\t\t\ttype="dropdown_menu"\n\t\t\t\t\t\tremit:ctrl-click="menu-item:click"\n\t\t\t\t\t\tauto-close="{false}"\n\t\t\t\t\t\tdisable-expand-center\n\t\t\t\t\t\tdisable-expand-bottom\n\t\t\t\t\t\tscroll-style="minimal"\n\t\t\t\t>\n\t\t\t\t\t<fn:match name="items">\n\t\t\t\t\t\t<b:list>\n\t\t\t\t\t\t\t<fn:for data="attrs[\'menu-dropdown-list\']" as="menuItem" key="menuItemKey">\n\t\t\t\t\t\t\t\t<b:list-item key="{menuItemKey}" qa:id="menu-dropdown-item" paddingless a11y:tooltip-direction="right">\n\t\t\t\t\t\t\t\t\t<fn:var name="menuItemType" value="{(menuItem.type === \'bonus\' && attrs[\'is-pdd-user\']) ? \'club\' : menuItem.type}" />\n\t\t\t\t\t\t\t\t\t<fn:var name="isPayBadgeActive" value="{attrs[\'is-pay-widget-helper-active\'] && menuItem.type === \'pay\'}" />\n\n\t\t\t\t\t\t\t\t\t<bem:mod name="pony-mode-dropdown" test="ponyMode"/>\n\t\t\t\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t\t\t\t<fn:when test="menuItemType === \'contacts\'">\n\t\t\t\t\t\t\t\t\t\t\t<b:widget\n\t\t\t\t\t\t\t\t\t\t\t\t\tremit:click-on-link="menu-item:click"\n\t\t\t\t\t\t\t\t\t\t\t\t\tuse:mediator="addressbook-manager"\n\t\t\t\t\t\t\t\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\t\t\t\t\t\t\t\tshortcut="g,c"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype="{menuItemType}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tdropDownMode="{true}"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t\t\t\t<b:widget\n\t\t\t\t\t\t\t\t\t\t\t\t\tremit:click-on-link="menu-item:click"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype="{menuItemType}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tdropDownMode="{true}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tisList="{attrs[\'vertical-list\']}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tnotification-badge="{isPayBadgeActive && \'sidebar_pay_notif_show_dropd\'}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tbillsCount="{attrs.billsCount}"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t</fn:for>\n\t\t\t\t\t\t</b:list>\n\t\t\t\t\t</fn:match>\n\t\t\t\t</b:dropdown>\n\t\t\t</div>\n\t\t</fn:if>\n\t\t<div bem:elem="footer__item" ref="settingsMenu" promo:id="menu-item_settings">\n\t\t\t<b:settings\n\t\t\t\t\tfont-size-pony="{ponyMode}"\n\t\t\t\t\tshowTitle="{_this.useNewToolbar() ? !short || isOpen : showTitle}"\n\t\t\t\t\tremit:click="menu-settings:click"\n\t\t\t\t\tuse:mediator="layout-manager themes-manager settings-manager pony-mode advert-manager todo-manager"\n\t\t\t\t\tradar-id="st"\n\t\t\t/>\n\t\t</div>\n\t\t<div bem:elem="footer__item" fn:if="attrs[\'show-reload-button\']">\n\t\t\t<b:button2\n\t\t\t\tqa:id="reload-button"\n\t\t\t\ttitle="{i18n(\'Обновить страницу\')}"\n\t\t\t\ttext="{i18n(\'Обновить\')}"\n\t\t\t\tshort="{!showTitle}"\n\t\t\t\tshortcut="ctrl+r|command+r"\n\t\t\t\tpure\n\t\t\t\tico="actions:postpone_alt"\n\t\t\t\tremit:click="reload:click"\n\t\t\t/>\n\t\t</div>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/sidebar-widgets/sidebar-widgets.html")});define("feast-tpl!ui-block/sidebar-widgets/sidebar-widgets.html",["feast-tpl!app/feast-tpl!ui-block/sidebar-widgets/sidebar-widgets.html"],function(a){return a});define("ui-block/sidebar-widgets/sidebar-widgets.constants",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.WIDGETS_BLOCK_MIN_HEIGHT=exports.WIDGET_SIZES_NORMAL=exports.WIDGET_SIZES_PONY=exports.SideBarMenuEvents=void 0;exports.SideBarMenuEvents={deactivateNotifyBadge:"sidebarmenu:deactivatenotifybadge"};var a=16;var b=8;var c=a+b;exports.WIDGET_SIZES_PONY={width:28,height:28};exports.WIDGET_SIZES_NORMAL={width:40,height:40};exports.WIDGETS_BLOCK_MIN_HEIGHT={normal:{short:exports.WIDGET_SIZES_NORMAL.height*2+c,full:exports.WIDGET_SIZES_NORMAL.height+c},pony:{short:exports.WIDGET_SIZES_PONY.height*2+c,full:exports.WIDGET_SIZES_PONY.height+c}}});define("feast-tpl!app/feast-tpl!ui-block/widget/widget.html",["feast"],function(a){return a.smartParse('<span qa:state="{attrs[\'pony-mode\'] && \'pony-mode\'}"\n\t  xmlns:fn="http://www.w3.org/1999/html">\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="title" value="{_this.getTitleByType(attrs.type)}" />\n\t<fn:var name="dataTitleShortcut" value="{attrs[\'title-shortcut\']}" fn:if="!attrs.dropDownMode && attrs[\'title-shortcut\']"/>\n\t<fn:var name="showTitle" value="{attrs.dropDownMode || attrs.showTitle}" />\n\t<fn:var name="hasPayBadge" value="{attrs.billsCount && attrs.billsCount.total && showTitle && attrs.type === \'pay\'}" />\n\t<fn:var name="tooltipTitle" value="{_this.getTooltipTitle(attrs.type, showTitle)}" />\n\t<fn:var name="widgetIco" value="{_this.getIcoByType(attrs.type)}" />\n\n\t<bem:mod name="pony-mode" test="attrs[\'pony-mode\']"/>\n\t<bem:mod name="dropdown" test="attrs.dropDownMode"/>\n\t<bem:mod name="list" test="attrs.showTitle"/>\n\n\t<fn:match name="block" args="type">\n\t\t<a bem:elem="link" target="{_this.getTargetByType(type)}" rel="noopener"\n\t\t   remit:click="click-on-link" data-qa-id="{_this.getQaIdByType(type)}"\n\t\t   promo:id="{_this.getPromoIdByType(type)}">\n\t\t\t<bem:mod name="dropdown" test="attrs.dropDownMode"/>\n\t\t\t<fn:attr name="href" value="{_this.getLinkByType(type)}"/>\n\n\t\t\t<fn:attr name="data-shortcut" value="{_this.getShortcutByType(type)}" test="_this.getShortcutByType(type)" />\n\t\t\t<fn:add-class name="js-shortcut" test="_this.getShortcutByType(type)" />\n\n\t\t\t\x3c!-- TODO: переписать два bem:elem="ico" в один --\x3e\n\t\t\t\x3c!-- "Красный прыщик" на иконке виджета --\x3e\n\t\t\t<b:notification-badge\n\t\t\t\tfn:if="attrs[\'notification-badge\']"\n\t\t\t\tshow="{true}"\n\t\t\t\tponymode="{attrs[\'pony-mode\']}"\n\t\t\t\ttop="2"\n\t\t\t\tright="3"\n\t\t\t\tradar-id="{attrs[\'notification-badge\']}"\n\t\t\t>\n\t\t\t\t<fn:match name="content" bem:block="widget">\n\t\t\t\t\t<span bem:elem="ico" qa:id="widget-icon-{attrs.type}">\n\t\t\t\t\t\t<bem:mod name="{type}{_this.getImageVariantByType(type)}" test="!widgetIco"/>\n\t\t\t\t\t\t<b:ico fn:if="widgetIco" name="{widgetIco}"/>\n\t\t\t\t\t</span>\n\t\t\t\t</fn:match>\n\t\t\t</b:notification-badge>\n\n\t\t\t<span bem:elem="ico" fn:if="!attrs[\'notification-badge\']" qa:id="widget-icon-{attrs.type}">\n\t\t\t\t<bem:mod name="{type}{_this.getImageVariantByType(type)}" test="!widgetIco"/>\n\t\t\t\t<b:ico fn:if="widgetIco" name="{widgetIco}"/>\n\t\t\t</span>\n\n\t\t\t<fn:if test="showTitle">\n\t\t\t\t<span qa:id="widget-title-{attrs.type}" class="widget__title">{title}</span>\n\t\t\t</fn:if>\n\t\t\t<b:badge\n\t\t\t\tfn:if="hasPayBadge"\n\t\t\t\ttext="{_this.getTotalBillsCount()}"\n\t\t\t\tsize="{attrs[\'nav-short\'] ? attrs.ponymode ? \'xs\' : \'s\' : \'l\'}"\n\t\t\t\ttransparent\n\t\t\t\tqa:id="widget-badge"\n\t\t\t/>\n\t\t</a>\n\t</fn:match>\n\t<fn:attr name="title" value="{tooltipTitle}" fn:if="tooltipTitle" />\n\t<fn:choose>\n\t\t<fn:when test="attrs.type === \'calendar\'">\n\t\t\t<b:widget-calendar\n\t\t\t\ttitle="{showTitle ? title : \'\'}"\n\t\t\t\tpony-mode="{attrs[\'pony-mode\']}"\n\t\t\t\tdropdown-mode="{attrs.dropDownMode}"\n\t\t\t\tvariant="{_this.getImageVariantByType(attrs.type)}"\n\t\t\t\tremit:click="click-on-link"\n\t\t\t/>\n\t\t</fn:when>\n\n\t\t<fn:otherwise>\n\t\t\t<fn:apply-match name="block" args="attrs.type"/>\n\n\t\t\t<fn:attr name="data-title-shortcut" value="{dataTitleShortcut}" test="dataTitleShortcut"/>\n\t\t</fn:otherwise>\n\t</fn:choose>\n</span>\n',"app/feast-tpl!ui-block/widget/widget.html")});define("feast-tpl!ui-block/widget/widget.html",["feast-tpl!app/feast-tpl!ui-block/widget/widget.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/widget/widget",["require","exports","default-values","feast","feast-tpl!./widget.html","helpers/opener","service/radars/decorator","ui-block/ico/ico","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);exports.default=b.default.Block.extend((0,e.default)({events:[{name:"click-on-link",rename:function(a){return a.get("type")+"_click"}}]})({events:{"click-on-link":"onClickLink"},name:"widget",template:c.default,blocks:{ico:f.default},lazyBlocks:{"widget-calendar":g.lazyUIWidgetCalendar},types:{calls:{title:i18n("Видеозвонки"),link:a.WIDGET_CALLS_URL,imageVariant:a.WIDGET_ICONS_VARIANT,target:"_blank"},cloud:{title:i18n("Облако"),link:a.WIDGET_CLOUD_URL,imageVariant:a.WIDGET_ICONS_VARIANT,target:"_blank"},contacts:{title:i18n("Адресная книга"),shortcut:"g,c",link:a.WIDGET_ADDRESSBOOK_URL,imageVariant:a.WIDGET_ICONS_VARIANT,target:"_blank",ico:a.ADDRESSBOOK_ICO,dataQaId:"addressbook-open-button",promoId:"menu-item_addressbook"},bonus:{title:i18n("Бонус"),link:"https://r.mail.ru/n279211045",target:"_blank"},club:{title:i18n("Бизнес-клуб"),link:"https://r.mail.ru/n236907368",target:"_blank"},calendar:{title:i18n("Календарь"),imageVariant:a.WIDGET_ICONS_VARIANT},pay:{title:i18n("Оплаты"),link:a.WIDGET_PAYMENT_URL,target:"_blank",imageVariant:a.PAY_IMAGE_VARIANT,dataQaId:"pay-open-button_".concat(a.PAY_IMAGE_VARIANT),promoId:"menu-item_pay"},todo:{title:i18n("Задачи"),link:a.WIDGET_TODO_URL,imageVariant:a.WIDGET_ICONS_VARIANT,target:"_blank",dataQaId:"todo-open-button"}},getIcoByType:function(a){var b=this.types[a];return(b===null||b===void 0?void 0:b.ico)||""},getImageVariantByType:function(a){var b=this.types[a];if(b&&b.imageVariant){return"_".concat(b.imageVariant)}return""},getLinkByType:function(a){var b=this.types[a];if(b&&b.link){return b.link}return""},getTargetByType:function(b){var c=this.types[b];if(b==="contacts"&&a.IS_NEW_ADDRESSBOOK){return"_self"}return c.target},getTitleByType:function(a){var b=this.types[a];if(b&&b.title){return b.title}return""},getShortcutByType:function(a){var b=this.types[a];return b.shortcut?b.shortcut:void 0},getQaIdByType:function(a){var b=this.types[a];return b.dataQaId?b.dataQaId:void 0},getPromoIdByType:function(a){var b=this.types[a];return b.promoId?b.promoId:void 0},onClickLink:function(b){var c=this.get("type");if(c==="contacts"){if(!a.IS_NEW_ADDRESSBOOK){(0,d.default)(a.WIDGET_ADDRESSBOOK_URL)}else{this.broadcast("addressbook:open")}b.preventDefault()}if(c==="pay"){(0,d.default)(this.getLinkByType(c));b.preventDefault()}if(c==="todo"){(0,d.default)(this.getLinkByType(c));b.preventDefault()}},getTooltipTitle:function(b,c){var d=this.get("billsCount");if(b==="pay"&&a.SIDEBAR_PAY_NOTIFICATION_BADGE_SMART&&d){var e=d.unpaidFines,f=d.unpaidBills,g=d.total;var h=i18n("Оплаты");var i={count:e};var j=e>a.BILLS_COUNTER_MAX?i18n("{count}+ штрафов",{count:a.BILLS_COUNTER_MAX}):i18n.plural(e,[i18n("{count} штрафов",i),i18n("{count} штраф",i),i18n("{count} штрафа",i)]);var k={count:f};var l=f>a.BILLS_COUNTER_MAX?i18n("{count}+ счетов",{count:a.BILLS_COUNTER_MAX}):i18n.plural(f,[i18n("{count} счетов",k),i18n("{count} счет",k),i18n("{count} счета",k)]);var m="";switch(true){case!g:m=i18n("Нет счетов к оплате");break;case e===undefined:m=l;break;case!e:m="".concat(i18n("Нет штрафов"),", ").concat(l);break;case!f:m=j;break;default:m="".concat(j,", ").concat(l)}return"".concat(h,", ").concat(m)}if(c){return null}return this.getTitleByType(b)},getTotalBillsCount:function(){var b=this.get("billsCount");if(!b||!a.SIDEBAR_PAY_NOTIFICATION_BADGE_SMART){return null}return b.total>a.BILLS_COUNTER_MAX?"".concat(a.BILLS_COUNTER_MAX,"+"):b.total}}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/sidebar-widgets/sidebar-widgets",["require","exports","default-values","feast","feast-tpl!./sidebar-widgets.html","helpers/get-adaptive","service/radars/decorator","service/radars/index","ui-block/dropdown/dropdown","ui-block/settings/settings","ui-block/sidebar-widgets/sidebar-widgets.constants","ui-block/widget/widget"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);j=__importDefault(j);var k=a.SHOW_RELOAD_BUTTON?2:1;var l=a.NEW_TOOLBAR?[]:a.SIDEBAR_MENU_LIST_CONFIG.filter(function(a){return!a.hidden});var m=l.length+k;var n=165;exports.default=b.default.Block.extend((0,e.default)({explicit:"radar"})({name:"sidebar-widgets",template:c.default,blocks:{settings:h.default,widget:j.default,dropdown:g.default},events:{"folder:click":"onFolderClick","drag:over":"openSideBar","menu-item:click":"onMenuItemClick","menu-settings:click":"onSettingsClick","search:inbox:click":"onInboxClick","reload:click":"onReloadClick"},defaults:{"pony-mode":false,"vertical-list":false,"menu-widget-list":[],"menu-dropdown-list":[],short:false,"is-pay-widget-helper-active":false,"is-pdd-user":false,"css-vars-fallback":a.CSS_VARS_FALLBACK,"widget-sent-radars":{},"show-reload-button":a.SHOW_RELOAD_BUTTON},constructor:function(){b.default.Block.prototype.constructor.apply(this,arguments);this.onResize=this.onResize.bind(this)},getWidgetSizes:function(){return this.is("pony-mode")?i.WIDGET_SIZES_PONY:i.WIDGET_SIZES_NORMAL},didMount:function(){var a=this;this.adaptiveHandler=new d.GetAdaptive({pureBreakpoints:true,breakpoints:[{conditions:function(b){var c=b.height,d=b.width;if(d<n){return false}var e=a.getWidgetSizes();return m*e.height<=c},props:{"vertical-list":true,"menu-widget-list":l,"menu-dropdown-list":[]}},{conditions:function(b){var c=b.width;var d=a.getWidgetSizes();return m*d.width<=c},props:{"vertical-list":false,"menu-widget-list":l,"menu-dropdown-list":[]}},{conditions:function(b){var c=b.width;var d=a.getWidgetSizes();return c<d.width*2},props:function(b){var c=b.height;var d=a.getWidgetSizes();var e=Math.floor(c/d.height)-k;if(e<l.length){var f=Math.max(e-1,0);return{"vertical-list":true,"menu-widget-list":l.slice(0,f),"menu-dropdown-list":l.slice(f)}}return{"vertical-list":true,"menu-widget-list":l,"menu-dropdown-list":[]}}},{props:function(b){var c=b.width;var d=a.getWidgetSizes();var e=Math.floor(c/d.width)-k-1;return{"menu-widget-list":l.slice(0,e),"menu-dropdown-list":l.slice(e),"vertical-list":false}}}],element:this.el,onResize:this.onResize})},sendWidgetRadars:function(a,b,c){var d=this;if(a){a.forEach(function(a){var e=a.type;if(!d.attrs["widget-sent-radars"][e]){d.onSendRadar(e,b,c)}})}},shouldUpdate:function(a){this.sendWidgetRadars(a["menu-widget-list"],false,"show");this.sendWidgetRadars(a["menu-dropdown-list"],true,"show");return Object.keys(a).length>0},isPayWidgetInDropdown:function(){return this.get("menu-dropdown-list").some(function(a){return a.type==="pay"})},onResize:function(a){this.set(a)},didUnmount:function(){this.adaptiveHandler.destroy()},onSettingsClick:function(){this.onSendRadar("settings",false,"click")},onReloadClick:function(){location.reload()},onMenuItemClick:function(a){var b=a.details;var c=b.get("type");var d=b.get("dropDownMode");this.onSendRadar(c,d,"click");if(c==="pay"&&this.get("is-pay-widget-helper-active")){this.broadcast(i.SideBarMenuEvents.deactivateNotifyBadge);this.set("is-pay-widget-helper-active",false);(0,f.default)({type:"sidebar_pay_notif_click"})}},onSendRadar:function(b,c,d){if(c===void 0){c=false}var e={dropdown:c,isList:!!this.get("vertical-list")};if(b==="pay"){e.payImage=a.PAY_IMAGE_VARIANT}var g="sidebar-menu_".concat(b,"_").concat(d);(0,f.default)({type:g,dwh:e});if(d==="show"){this.attrs["widget-sent-radars"][b]=true}},useNewToolbar:function(){return a.NEW_TOOLBAR}}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/sidebar-folders/sidebar-folders",["require","exports","default-values","feast","feast-mod/letters-count","feast-tpl!./sidebar-folders.html","helpers/debounce-frame","mediator/layout-manager/vars","resize-observer-polyfill","service/promo","service/radars/decorator","service/radars/index","ui-block/badge/badge","ui-block/compose-button/compose-button","ui-block/compose-dropdown/compose-dropdown","ui-block/dropdown/dropdown","ui-block/ico/ico","ui-block/nav-folders/nav-folders","ui-block/react-async/react-async","ui-block/settings/settings","ui-block/sidebar/sidebar","ui-block/sidebar-widgets/sidebar-widgets","ui-block/sidebar-widgets/sidebar-widgets.constants","ui-block/widget/widget","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);d=__importDefault(d);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);v=__importDefault(v);exports.default=b.default.Block.extend((0,i.default)({explicit:"radar"})({name:"sidebar-folders",template:d.default,blocks:{badge:k.default,"compose-button":l.default,"compose-dropdown":m.default,ico:o.default,"nav-folders":p.default,settings:r.default,sidebar:s.default,"sidebar-widgets":t.default,widget:v.default,dropdown:n.default,"react-async":q.default},lazyBlocks:{"themes-widget":w.lazyUIThemesWidget},events:{"folder:click":"onFolderClick","drag:over":"openSideBar","search:inbox:click":"onInboxClick","sidebar-resize-full":"onSidebarFullResize","sidebar-resize-short":"onSidebarShortResize","menu-settings:click":"onSettingsClick"},defaults:{"folder-active":undefined,models:null,ponymode:false,router:null,isExpandedWidth:false,short:false,"widget-enabled":false,"is-pdd-user":false,"invite-calls":a.CALLS&&!a.CALLS_DISABLE_COMPOSE_DROPDOWN,categories:a.SEARCH_CATEGORIES,colorTags:a.COLOR_TAGS,"css-vars-fallback":a.CSS_VARS_FALLBACK,webview:a.WEBVIEW,showUnsubscribeButton:a.SHOW_SIDEBAR_UNSUBSCRIBE_BUTTON},attrChanged:{"folder-active":function(){this.closeSidebar()},short:function(a){if(a){h.default.update()}}},constructor:function(){b.default.Block.prototype.constructor.apply(this,arguments);this.onResize=this.onResize.bind(this)},didMount:function(){var a=this;var b=new e.ConcatFrameDebouncer(this.onResize);var c=new g.default(function(a){b.requestDebouncedFrame(a)});c.observe(this.el);this.resizeObserver=c;this.resizeDebouncer=b;this.el.dragHandleEvent=function(b){return a.onDrag(b)}},getWidgetsMinHeight:function(){return u.WIDGETS_BLOCK_MIN_HEIGHT[this.is("ponymode")?"pony":"normal"]},onSidebarShortResize:function(a){var b=a.details;this.el.style.setProperty("--sidebar-short-folders-header-height","".concat(b.header,"px"));this.el.style.setProperty("--sidebar-short-widgets-min-height","".concat(b.footer,"px"))},onSidebarFullResize:function(a){var b=a.details;this.el.style.setProperty("--sidebar-folders-header-height","".concat(b.header,"px"));this.el.style.setProperty("--vkui--octavius_size_sidebar_widgets_height_min--regular","".concat(b.footer,"px"))},didUnmount:function(){this.el.dragHandleEvent=null;this.resizeObserver.disconnect();this.resizeDebouncer.destroy()},pureSet:function(a,b){if(this.get("key")===b){return}this.set(a,b)},onResize:function(a){var b=a[0].contentRect.width;if(b<=f.SIDEBAR_SHORT_COLUMN_LIMIT_PX){this.pureSet("short",true)}else{this.pureSet("short",false)}},onFolderClick:function(a){var b=a.details.id;if(b==this.get("folder-active")&&!a.isDefaultPrevented()){this.closeSidebar()}},onDrag:function(a){var b=a.type;if(b=="dragenter"){this.openSideBar()}},onMouseDrop:function(){var a=this;this.dropTimeout=setTimeout(function(){a.closeSidebar();a.$off(a.el,"mousemove","onMouseMove");a.$off(a.el,"mouseleave","onMouseDrop");a.$off(a.el,"mouseup","onMouseDrop")},600);this.$one(this.el,"mouseenter",function(){clearTimeout(a.dropTimeout)})},onMouseMove:function(a){var b=this.el.getBoundingClientRect();var c=b.top;var d=b.bottom;var e=a.clientY<c+60;var f=a.clientY>d-120;var g=this.ids.sidebar.getFullScrollable();if((e||f)&&g){var h=g.getScrollPos();var i=h.y+(e?-1:+1)*5;g.scrollTo(0,i,true)}},getTotalUnread:function(){return(0,c.countUnreadTotalMod)(true)},openSideBar:function(){this.ids.sidebar.open();this.$on(this.el,"mouseleave","onMouseDrop");this.$on(this.el,"mouseup","onMouseDrop");this.$on(this.el,"mousemove","onMouseMove")},closeSidebar:function(){this.ids.sidebar.close()},onInboxClick:function(){(0,j.default)("search-direct-inbox_click")},getInboxUrl:function(){var a=this.get("router");return a===null||a===void 0?void 0:a.getUrl("#letters")},useNewToolbar:function(){return a.NEW_TOOLBAR},onSettingsClick:function(){(0,j.default)("sidebar-menu_settings_click")}}))});define("data-source/store/vk-overlay/state",["require","exports","@mail/jssdk/next/state/global"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.VKOverlayState=void 0;exports.VKOverlayState=(0,a.createGlobalState)("vk-overlay",{modalData:{},modalHistory:[],snackbar:null,popout:null})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};define("data-source/store/vk-overlay/actions",["require","exports","@mail/jssdk/next/action/global","data-source/store/vk-overlay/state"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.resetModal=exports.updateModalData=exports.updateModalDataById=exports.popModalDataById=exports.popModalHistory=exports.popModal=exports.pushModal=exports.resetPopout=exports.setPopout=exports.resetSnackbar=exports.setSnackbar=void 0;exports.setSnackbar=(0,a.createGlobalAction)("vk-overlay/setSnackbar",function(a){return{snackbar:a}});exports.resetSnackbar=(0,a.createGlobalAction)("vk-overlay/resetSnackbar",function(){return{snackbar:null}});exports.setPopout=(0,a.createGlobalAction)("vk-overlay/setPopout",function(a){return{popout:a}});exports.resetPopout=(0,a.createGlobalAction)("vk-overlay/resetPopout",function(){return{popout:null}});exports.pushModal=(0,a.createGlobalAction)("vk-overlay/pushModal",function(a){var c=__spreadArray([],b.VKOverlayState.get().modalHistory,true);var d=__assign({},b.VKOverlayState.get().modalData);var e=typeof a!=="string";var f=e?a===null||a===void 0?void 0:a.id:a;if(e){d[f]=a===null||a===void 0?void 0:a.data}if(c.includes(f)){c=c.splice(0,c.indexOf(f)+1)}else{c.push(f)}return{modalHistory:c,modalData:d}});exports.popModal=(0,a.createGlobalAction)("vk-overlay/popModal",function(){var a=__spreadArray([],b.VKOverlayState.get().modalHistory,true);var c=__assign({},b.VKOverlayState.get().modalData);var d=a.pop();if(d){delete c[d]}return{modalHistory:a,modalData:c}});exports.popModalHistory=(0,a.createGlobalAction)("vk-overlay/popModalHistory",function(){var a=__spreadArray([],b.VKOverlayState.get().modalHistory,true);a.pop();return{modalHistory:a,modalData:b.VKOverlayState.get().modalData}});exports.popModalDataById=(0,a.createGlobalAction)("vk-overlay/popModalDataById",function(a){var c=__assign({},b.VKOverlayState.get().modalData);delete c[a];return{modalHistory:b.VKOverlayState.get().modalHistory,modalData:c}});exports.updateModalDataById=(0,a.createGlobalAction)("vk-overlay/updateModalDataById",function(a){var c;var d=a.id,e=a.data;if(Object.keys(b.VKOverlayState.get().modalData).includes(d)){return{modalHistory:b.VKOverlayState.get().modalHistory,modalData:__assign(__assign({},b.VKOverlayState.get().modalData),(c={},c[d]=e,c))}}return{modalHistory:b.VKOverlayState.get().modalHistory,modalData:b.VKOverlayState.get().modalData}});exports.updateModalData=(0,a.createGlobalAction)("vk-overlay/updateModalData",function(a){var c=a.ids,d=a.data;var e=__assign({},b.VKOverlayState.get().modalData);var f=Array.isArray(d);c.forEach(function(a,c){if(Object.keys(b.VKOverlayState.get().modalData).includes(a)){if(f){e[a]=d[c]}else{e[a]=d}}});return{modalHistory:b.VKOverlayState.get().modalHistory,modalData:e}});exports.resetModal=(0,a.createGlobalAction)("vk-overlay/resetModal",function(){return{modalHistory:[],modalData:{}}});b.VKOverlayState.on((0,a.anyOf)(exports.setSnackbar.fulfilled,exports.resetSnackbar.fulfilled,exports.setPopout.fulfilled,exports.resetPopout.fulfilled,exports.pushModal.fulfilled,exports.popModal.fulfilled,exports.popModalDataById.fulfilled,exports.popModalHistory.fulfilled,exports.resetModal.fulfilled,exports.updateModalDataById.fulfilled,exports.updateModalData.fulfilled),function(a){var c=a.payload;b.VKOverlayState.set(function(){return __assign(__assign({},b.VKOverlayState.get()),c)})})});define("data-source/store/vk-overlay/types",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ModalPages=void 0;var a;(function(a){a["account"]="account";a["letterFastActionSettings"]="letterFastActionSettings";a["folders"]="folders";a["foldersSettings"]="foldersSettings";a["cleanmaster"]="cleanmaster"})(a=exports.ModalPages||(exports.ModalPages={}))});define("feast-tpl!app/feast-tpl!ui-block/webview-mobile-header/webview-mobile-header.html",["feast"],function(a){return a.smartParse('<div qa:id="webview-mobile-header">\n\t<fn:var name="selectMode" value="{attrs.selectMode}" />\n\t<fn:var name="searchMode" value="{attrs.searchMode}" />\n\t<fn:var\n\t\tname="readMode"\n\t\tvalue="{attrs.route.is(\'#read-letter #search-letter\') && !selectMode && !attrs.letterNotFound}"\n\t/>\n\n\t<fn:var name="readActions" value="{_this.getReadActions()}" />\n\t<fn:var name="unreadCount" value="{_this.getUnreadCount()}" />\n\t<fn:var name="selectedCount" value="{_this.getSelectedCount()}" />\n\t<fn:var name="selectedStats" value="{_this.getSelectedStats()}" />\n\t<fn:var name="letterId" value="{attrs.letter && attrs.letter.id}" />\n\t<bem:mod\n\t\tname="enable-footer-app-toolbar"\n\t\ttest="!attrs[\'disable-footer-app-toolbar\']"\n\t/>\n\n\t<div fn:if="attrs[\'disable-footer-app-toolbar\']" bem:elem="element">\n\t\t<b:button2\n\t\t\tqa:id="open-sidebar"\n\t\t\tico="navigation:menu"\n\t\t\tremit:click.prevent="folders:open"\n\t\t\tcentered\n\t\t\tpure\n\t\t/>\n\n\t\t<fn:if test="!attrs[\'hide-webview-title\']">\n\t\t\t<span bem:elem="title">{i18n(\'Почта\')}</span>\n\t\t</fn:if>\n\n\t\t<b:button2\n\t\t\tqa:id="open-compose"\n\t\t\tico="actions:add_big"\n\t\t\tremit:click="compose:new"\n\t\t\tcentered\n\t\t\tpure\n\t\t/>\n\t</div>\n\n\t<div bem:elem="controls">\n\t\t<bem:mod name="searchMode" test="searchMode"/>\n\t\t<bem:mod name="selectMode" test="selectMode"/>\n\n\t\t<fn:if test="!selectMode && !readMode && !searchMode">\n\t\t\t<div bem:elem="filters">\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="folder-name"\n\t\t\t\t\tqa:id="folder-name:name:{attrs.folder.get(\'name\')}"\n\t\t\t\t>\n\t\t\t\t\t{attrs.folder.get(\'name\')}\n\t\t\t\t\t<fn:if test="unreadCount > 0">\n\t\t\t\t\t\t<span bem:elem="unread-count"> {unreadCount} </span>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</span>\n\n\t\t\t\t<b:filters\n\t\t\t\t\t\tqa:id="filters"\n\t\t\t\t\t\tuse:mediator="filter-manager layout-manager settings-manager advert-manager todo-manager"\n\t\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\t\tshort\n\t\t\t\t\t\ttouch\n\t\t\t\t\t\tautochange="{false}"\n\t\t\t\t\t\tpure\n\t\t\t\t\t\ticonOnly\n\t\t\t\t\t\talignLeft\n\t\t\t\t\t\thas-metathreads-settings="{attrs[\'has-metathreads-settings\']}"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<fn:if test="attrs[\'enable-mobile-search-button\']">\n\t\t\t\t<b:button2\n\t\t\t\t\t\tremit:click="search"\n\t\t\t\t\t\tico="search"\n\t\t\t\t\t\tqa:id="search"\n\t\t\t\t\t\tcompact\n\t\t\t\t\t\tpure\n\t\t\t\t\t\tsize="m"\n\t\t\t\t\t\tshort\n\t\t\t\t\t\tico-text-top\n\t\t\t\t\t\tcentered\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</fn:if>\n\t\t<fn:if test="selectMode">\n\t\t\t<span bem:elem="select-button">\n\t\t\t\t<b:button2\n\t\t\t\t\tremit:click="select:drop"\n\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\tmap="toolbar"\n\t\t\t\t\tico="close"\n\t\t\t\t\tqa:id="deselect-all-close"\n\t\t\t\t\tshort\n\t\t\t\t\tpure\n\t\t\t\t\tsize="m"\n\t\t\t\t/>\n\n\t\t\t\t<b:button2\n\t\t\t\t\tfn:if="!attrs.deselectAll"\n\t\t\t\t\tremit:click="select:all"\n\t\t\t\t\texplanation="{i18n(\'Выделить все\')}"\n\t\t\t\t\tdisabled="{attrs.disabled}"\n\t\t\t\t\tico="select-all"\n\t\t\t\t\tqa:id="select-all"\n\t\t\t\t\tpure\n\t\t\t\t\tsize="m"\n\t\t\t\t\tcentered\n\t\t\t\t\thas-explanation="{selectedCount}"\n\t\t\t\t\ttext="{selectedCount}"\n\t\t\t\t/>\n\n\t\t\t\t<b:button2\n\t\t\t\t\tfn:if="attrs.deselectAll"\n\t\t\t\t\tremit:click="select:drop"\n\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\texplanation="{i18n(\'Снять выделение\')}"\n\t\t\t\t\tmap="toolbar"\n\t\t\t\t\tico="select-all"\n\t\t\t\t\tqa:id="deselect-all"\n\t\t\t\t\tpure\n\t\t\t\t\tsize="m"\n\t\t\t\t\thas-explanation="{selectedCount}"\n\t\t\t\t\ttext="{selectedCount}"\n\t\t\t\t/>\n\t\t\t</span>\n\n\t\t\t<div bem:elem="select-actions">\n\t\t\t\t<b:button2\n\t\t\t\t\tremit:click="remove"\n\t\t\t\t\tevent:details="{selection:true}"\n\t\t\t\t\tico="delete"\n\t\t\t\t\tqa:id="delete"\n\t\t\t\t\tcompact\n\t\t\t\t\tpure\n\t\t\t\t\tsize="m"\n\t\t\t\t\tshort\n\t\t\t\t\tico-text-top\n\t\t\t\t\tcentered\n\t\t\t\t/>\n\n\t\t\t\t<b:button2\n\t\t\t\t\tremit:click="move:click"\n\t\t\t\t\tico="folder-move"\n\t\t\t\t\tqa:id="move-to-folder"\n\t\t\t\t\tcompact\n\t\t\t\t\tpure\n\t\t\t\t\ttouch-nav\n\t\t\t\t\tdisabled="{!_this.isEnableMove()}"\n\t\t\t\t\tsize="m"\n\t\t\t\t\tshort\n\t\t\t\t\tico-text-top\n\t\t\t\t\tcentered\n\t\t\t\t/>\n\n\t\t\t\t<b:button2\n\t\t\t\t\tfn:if="attrs.folder.isSpam()"\n\t\t\t\t\tremit:click="unspam"\n\t\t\t\t\tevent:details="{selection:true}"\n\t\t\t\t\tico="spam-off"\n\t\t\t\t\tqa:id="spam-off"\n\t\t\t\t\tcompact\n\t\t\t\t\tpure\n\t\t\t\t\tsize="m"\n\t\t\t\t\tshort\n\t\t\t\t\tico-text-top\n\t\t\t\t\tcentered\n\t\t\t\t/>\n\n\t\t\t\t<b:dropdown-actions\n\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\tuse:mediator="layout-manager settings-filters-manager calendar-manager translator-manager calls-manager letters-selection"\n\t\t\t\t\tqa:id="more"\n\t\t\t\t\tmodel="{attrs.letter}"\n\t\t\t\t\tfolder="{attrs.folder}"\n\t\t\t\t\tico="more-hor"\n\t\t\t\t\tread="{selectedStats.unread > 0}"\n\t\t\t\t\tunread="{selectedStats.read > 0}"\n\t\t\t\t\tflag="{selectedStats.noflagged > 0}"\n\t\t\t\t\tunflag="{selectedStats.flagged > 0}"\n\t\t\t\t\tforward="{!selectedStats.metathread}"\n\t\t\t\t\tspam="{!selectedStats.metathread && ((readMode && !attrs.folder.isSpam()) || selectedStats.nospam > 0)}"\n\t\t\t\t\tunspam="{attrs.folder.isSpam()}"\n\t\t\t\t\tarchive="{!attrs.folder.isArchive()}"\n\t\t\t\t\tcreate-filter\n\t\t\t\t\tdisable-expand-top\n\t\t\t\t\tdisable-expand-center\n\t\t\t\t\tpure\n\t\t\t\t\tshort\n\t\t\t\t\tico-text-top\n\t\t\t\t\tselection-actions\n\t\t\t\t\tsize="m"\n\t\t\t\t\ttouch\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</fn:if>\n\n\t\t<fn:if test="readMode">\n\t\t\t<b:button2\n\t\t\t\tremit:click="letter:back"\n\t\t\t\ttext="{i18n(\'Вернуться\')}"\n\t\t\t\tico="arrow-back"\n\t\t\t\tqa:id="letter_back"\n\t\t\t\tpure\n\t\t\t\tuse:mediator="thread-manager"\n\t\t\t\tshort\n\t\t\t/>\n\n\t\t\t<div>\n\t\t\t\t<fn:for data="readActions" as="item">\n\t\t\t\t\t<b:portal-menu-element\n\t\t\t\t\t\tfn:if="!item.hasOwnProperty(\'if\') || item.if"\n\t\t\t\t\t\tkey="{item.type}"\n\t\t\t\t\t\ttype="{item.type}"\n\t\t\t\t\t\tshort="{item.short}"\n\t\t\t\t\t\tdisabled="{item.disabled ? true : item.disabled !== false && isDisableEdit}"\n\t\t\t\t\t\tletter-id="{letterId}"\n\t\t\t\t\t\tletter="{attrs.letter}"\n\t\t\t\t\t\tread="{item.read}"\n\t\t\t\t\t\tunread="{item.unread}"\n\t\t\t\t\t\tflag="{item.flag}"\n\t\t\t\t\t\tunflag="{item.unflag}"\n\t\t\t\t\t\tarchive="{item.archive}"\n\t\t\t\t\t\tspam="{item.spam}"\n\t\t\t\t\t\tunspam="{item.unspam}"\n\t\t\t\t\t\tmove="{item.move}"\n\t\t\t\t\t\tforward="{item.forward}"\n\t\t\t\t\t\tcreate-filter="{item[\'create-filter\']}"\n\t\t\t\t\t\tstore="{attrs.model}"\n\t\t\t\t\t\tuse:mediator="letters-selection"\n\t\t\t\t\t\ttouch-nav\n\t\t\t\t\t\ttouch\n\t\t\t\t\t/>\n\t\t\t\t</fn:for>\n\t\t\t</div>\n\t\t</fn:if>\n\t</div>\n\t<div bem:elem="search">\n\t\t<bem:mod name="searchMode" test="searchMode"/>\n\t\t<b:react-async\n\t\t\tcomponent="SearchMobilePanel"\n\t\t\tsearch="{attrs.store.search}"\n\t\t\tsetSearchMode="{_this.setSearchMode}"\n\t\t\tsearchMode="{searchMode}"\n\t\t/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/webview-mobile-header/webview-mobile-header.html")});define("feast-tpl!ui-block/webview-mobile-header/webview-mobile-header.html",["feast-tpl!app/feast-tpl!ui-block/webview-mobile-header/webview-mobile-header.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/webview-mobile-header/webview-mobile-header",["require","exports","@mail/xray","data-source/store/vk-overlay/actions","data-source/store/vk-overlay/types","default-values","feast","feast-mod/letters-count","feast-tpl!./webview-mobile-header.html","helpers/letter","service/layer","ui-block/button2/button2","ui-block/portal-menu/portal-menu","ui-block/portal-menu-element/portal-menu-element"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);e=__importDefault(e);g=__importDefault(g);i=__importDefault(i);j=__importDefault(j);l=__importDefault(l);var m={name:"webview-mobile-header",template:g.default,blocks:{button2:j.default,"portal-menu-element":l.default},events:{"move:click":"onMoveToClick","folders:open":"onOpenFolders",search:"onSearchClick"},defaults:{searchMode:false,"hide-webview-title":d.HIDE_WEBVIEW_TITLE,"disable-footer-app-toolbar":d.DISABLE_FOOTER_APP_TOOLBAR,"enable-mobile-search-button":d.ENABLE_MOBILE_SEARCH_BUTTON},attrChanged:{selected:function(){if(!this.isMounted()){return}this.set("selectedStats",this.getSelectedStats())},models:function(){if(!d.USE_NEW_MOBILE_FOLDERS_MODAL){return}(0,b.updateModalDataById)({id:c.ModalPages.folders,data:{folderActive:this.attrs.folderActive,models:this.attrs.models,router:this.attrs.router}})}},constructor:function(){e.default.Block.apply(this,arguments);this.setSearchMode=this.setSearchMode.bind(this)},getSelectedStats:k.blockSpec.getSelectedStats,getSelectedCount:function(){return(0,k.getSelectedCount)({folder:this.attrs.folder,selectFolder:this.attrs.selectFolder,selected:this.attrs.selected},{searchRoute:this.attrs.route.is("#search #search-letter")})},searchMode:false,getUnreadCount:function(){return(0,f.countUnreadMod)(this.attrs.folder,false)},getReadActions:function(){var a,b;var c=((b=(a=this.attrs)===null||a===void 0?void 0:a.route)===null||b===void 0?void 0:b.is("#read-letter #search-letter"))&&!this.selectMode&&!this.attrs.letterNotFound;var e=c&&this.attrs.route.params.part;var f=this.attrs.selectedStats||Object.create(null);var g=c&&!this.attrs.folder.isSpam()||f.nospam>0;var i=c&&this.attrs.folder.isSpam();var j=this.attrs.letter;var k=j&&j.get("messages").first();return[{type:"remove",short:true,disabled:e},{type:"reply",short:true,letter:j,disabled:e},{type:"reply-all",if:(0,h.hasLetterReplyAll)(k),short:true,letter:j,disabled:e},{type:"forward",short:true,letter:j,disabled:e},{type:"more",short:true,spam:g,unspam:i,read:j.is("flags.unread"),unread:!j.is("flags.unread"),flag:!j.is("flags.flagged"),unflag:j.is("flags.flagged"),archive:!j.getFolder().isArchive()&&!d.ARCHIVE_DISABLED,"create-filter":true,forward:!f.metathread&&!this.attrs.deselectAll,move:true}]},onOpenFolders:function(){if(!d.USE_NEW_MOBILE_FOLDERS_MODAL){this.broadcast("mobilesidebar:open");return}(0,b.pushModal)({id:c.ModalPages.folders,data:{folderActive:this.attrs.folderActive,models:this.attrs.models,router:this.attrs.router}})},onMoveToClick:function(){var a=this.get("model");i.default.open("move-to-folder",{folder:a.folder,folders:a.folders},{dimmer:true,mobile:true,resolvable:false})},onSearchClick:function(){a.default.send("mobile-search_open");this.set("searchMode",true);this.searchMode=true},setSearchMode:function(a){this.set("searchMode",a)}};exports.default=e.default.Block.extend(m)});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/application-mail/application-mail",["require","exports","@mail/xray","data-source/source/ui-letters","default-values","feast","feast-tpl!./application-mail.html","helpers/g-silent","helpers/lazy","helpers/new-letter-list","service/contextmenu","service/radars/index","service/submenu","service/title","ui-block/advert-column/advert-column","ui-block/contextmenu/contextmenu","ui-block/counters/counters","ui-block/dimmer/dimmer","ui-block/download-frame/download-frame","ui-block/layer-window/layer-window","ui-block/layout/layout","ui-block/letter-list/letter-list","ui-block/letter-list-item-adv/letter-list-item-adv","ui-block/list-nested/list-nested","ui-block/mobile-sidebar/mobile-sidebar","ui-block/octopus/octopus","ui-block/panel-with-selected/panel-with-selected","ui-block/portal-menu/portal-menu","ui-block/progress/progress","ui-block/react-async/react-async","ui-block/renovator/renovator","ui-block/scrollable/scrollable","ui-block/settings-dock/settings-dock","ui-block/shortcut/shortcut","ui-block/sidebar-folders/sidebar-folders","ui-block/sidebar-search/sidebar-search","ui-block/slot/slot","ui-block/thread/thread","ui-block/webview-mobile-header/webview-mobile-header"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);I=__importDefault(I);J=__importDefault(J);K=__importDefault(K);var L=(0,g.lazyInit)(function(){return new Promise(function(a,b){require(["ui-react/components/LetterHeaderActions/LetterHeaderActions"],a,b)}).then(__importStar).then(function(a){return a.LetterHeaderActions})});var M=(0,g.lazyInit)(function(){return new Promise(function(a,b){require(["ui-react/components/ListLetterHeaderActions/ListLetterHeaderActions"],a,b)}).then(__importStar).then(function(a){return a.ListLetterHeaderActions})});var N=(0,g.lazyInit)(function(){return new Promise(function(a,b){require(["ui-react/components/VkMessengerProvider/VkMessengerProvider"],a,b)}).then(__importStar)});var O=(0,g.lazyInit)(function(){return new Promise(function(a,b){require(["ui-react/components/WidgetColumn/WidgetColumn"],a,b)}).then(__importStar).then(function(a){return a.WidgetColumn})});var P=(0,g.lazyInit)(function(){return new Promise(function(a,b){require(["ui-react/containers/SearchPanel/SearchPanel"],a,b)}).then(__importStar)});exports.default=d.default.Block.extend({name:"application-mail",template:e.default,performanceTrace:true,isolate:false,isolateEvents:false,_gSilent:(0,f.default)({el:document.body,holder:window,timeout:150}),blocks:{contextmenu:n.default,counters:o.default,dimmer:p.default,"download-frame":q.default,layout:s.default,"layer-window":r.default,"letter-list":t.default,"letter-list-item-adv":u.default,octopus:x.default,"panel-with-selected":y.default,"portal-menu":z.default,"react-async":B.default,scrollable:D.default,shortcut:F.default,"sidebar-folders":G.default,"sidebar-search":H.default,slot:I.default,"advert-column":m.default,thread:J.default,progress:A.default,renovator:C.default,"settings-dock":E.default,"mobile-sidebar":w.default,"webview-mobile-header":K.default},defaults:{"user-resize":c.USER_LAYOUT_RESIZE,"user-resize-3pane":c.USER_LAYOUT_RESIZE_3PANE,"is-webview":c.WEBVIEW,"is-octavius-mobile":c.OCTAVIUS_MOBILE,"disable-footer-app-toolbar":c.DISABLE_FOOTER_APP_TOOLBAR},lazySearchPanel:P,lazyListLetterHeaderActions:M,lazyWidgetColumn:O,lazyLetterHeaderActions:L,lazyVkMessengerProvider:N,checkShowLetterPreview3Pane:function(a){var b=this.get("router");var c=this.get("uiLayout");return c.type==="3pane"&&c.support3pane&&a||!b.route.is("#search-letter #read-letter")},isAdvEnable:function(){return c.LETTER_CONTENT_ADV_ENABLE&&c.HIDE_TOYS!==c.BL_PROP_NAME},is3Pane:function(){return this.get("uiLayout").type==="3pane"&&this.get("uiLayout").support3pane},showLayoutBorders:function(){return!(0,h.isNewLetterListEnabled)(this.is3Pane())},useNewThread:function(){return c.NEW_THREAD},useNewToolbar:function(){return c.NEW_TOOLBAR},usePromoNewToolbar:function(){return c.NEW_TOOLBAR&&c.PROMO_NEW_TOOLBAR},useTopLineAdv:function(){var a=this.get("uiLayout");var d=this.get("folder");var e=this.get("uiLetters");var f=this.is3Pane();return c.ADS_MOVE_TOP_LINE&&(f&&c.ADS_MOVE_TOP_LINE_3PANE||!f&&c.ADS_MOVE_TOP_LINE_2PANE)&&c.NEW_TOOLBAR&&(0,b.isNeedAdv)(e,a,d)},useReactSearchPanel:function(){return c.SEARCH_PANEL_REACT},usePortalSearchPanel:function(){return c.SEARCH_PANEL_PORTAL},isThreadRounded:function(){return(0,h.isNewLetterListEnabled)(this.is3Pane())},isDragIconShown:function(){return c.RESIZER_DRAG_ICON_SHOWN&&(0,h.isNewLetterListEnabled)(this.is3Pane())},constructor:function(){d.default.Block.prototype.constructor.apply(this,arguments)},didMount:function(){i.default.setup(n.default);k.default.setup(v.default);l.default.setup();(0,j.default)(["application-mail","mount"]);if(!this.get("folder")||!this.get("router")){a.default.send("crossnav-am-no-val-err",{rlog:"crossnav-am-no-val-err",rlog_message:Object.entries(this.attrs).map(function(a){var b=a[0],c=a[1];return[b,typeof c]})})}},didUnmount:function(){i.default.teardown();k.default.teardown();(0,j.default)(["application-mail","unmount"])}})});define("feast-mod/file-count",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fileCountSaved=exports.fileCount=void 0;function a(a){return i18n.plural(a,[i18n("{count} файлов",{count:a}),i18n("{count} файл",{count:a}),i18n("{count} файла",{count:a})])}exports.fileCount=a;function b(a){return i18n.plural(a,[i18n("{count} файлов сохранено",{count:a}),i18n("{count} файл сохранен",{count:a}),i18n("{count} файла сохранено",{count:a})])}exports.fileCountSaved=b});define("feast-tpl!app/feast-tpl!ui-block/attach-list/attach-list.html",["feast"],function(a){return a.smartParse('<div qa:id="attach-list">\n\t<fn:var name="attachCount" value="{attrs.models.length}" />\n\t<fn:var name="isSticky" value="{_this.isStickyEnabled()}"/>\n\t<fn:var name="attachSafetyStatusLocator" value="attach-safety-status:{attrs[\'safety-status\']}"/>\n\n\t<bem:mod name="hidden" test="!attrs.showAttachList"/>\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\t<bem:mod name="expanded" test="attrs.expanded && !attrs.mobile || attrs[\'preview-mode\']"/>\n\t<bem:mod name="preview-mode" test="attrs[\'preview-mode\']"/>\n\n\t<div>\n\t\t<div bem:elem="container"  ref="container">\n\t\t\t<div bem:elem="thumbs" ref="thumbs" qa:id="thumbs">\n\t\t\t\t<fn:for data="attrs.models" as="attachment" key="idx">\n\t\t\t\t\t<b:attach-thumb\n\t\t\t\t\t\tkey="{attachment.id}"\n\t\t\t\t\t\tmodel="{attachment}"\n\t\t\t\t\t\tfull="{attachCount <= _this.fullLimit()}"\n\t\t\t\t\t\tresponsive="{attrs.mobile && attachCount === 1}"\n\t\t\t\t\t\tsave-to-cloud="{attrs[\'save-to-cloud\'] && !attrs[\'disable-save-to-cloud\'] && !attrs.mobile}"\n\t\t\t\t\t\tdark-mode="{attrs[\'dark-mode\']}"\n\t\t\t\t\t\tremit:download="thumb-download"\n\t\t\t\t\t\tremit:cloud="thumb-cloud"\n\t\t\t\t\t\tremit:open="thumb-open"\n\t\t\t\t\t\tremit:thumb-item-rendered="thumb-rendered"\n\t\t\t\t\t\tremit:toggle-ics="toggle-ics"\n\t\t\t\t\t\tuse:mediator="attachments-manager"\n\t\t\t\t\t/>\n\t\t\t\t</fn:for>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tfn:if="attrs.showmore && !attrs.mobile && !attrs.expanded && !attrs[\'preview-mode\']"\n\t\t\t\tbem:elem="more"\n\t\t\t\tremit:click="expand"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="expand"\n\t\t\t\t\tbem:mod="gradient"\n\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div bem:elem="expand-container">\n\t\t\t\t\t<div\n\t\t\t\t\t\tbem:elem="expand-center"\n\t\t\t\t\t\tqa:id="more"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div bem:elem="attach-icon"><b:ico name="attach"/></div>\n\t\t\t\t\t\t<div bem:elem="all">{i18n(\'все\')}</div>\n\t\t\t\t\t\t<div bem:elem="attach-count" qa:id="attach-count">{attachCount}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div bem:elem="controls" qa:id="attach-list-controls">\n\t\t\t<div bem:elem="controls-element">\n\t\t\t\t<bem:mod\n\t\t\t\t\tname="type"\n\t\t\t\t\tvalue="info"\n\t\t\t\t\ttest="attrs.showAttachSafetyStatus && (attrs[\'attach-safety-status-position\'] === \'start\')"\n\t\t\t\t/>\n\t\t\t\t<span bem:elem="controls-element-count" qa:id="attach-count">\n\t\t\t\t\t<fn:value mod="fileCount">attachCount</fn:value>\n\t\t\t\t</span>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="controls-element-safety-status"\n\t\t\t\t\tqa:id="{attachSafetyStatusLocator}"\n\t\t\t\t\tfn:if="attrs.showAttachSafetyStatus && (attrs[\'attach-safety-status-position\'] === \'start\')"\n\t\t\t\t\tremit:click="attaches-status-click"\n\t\t\t\t\tremit:mouseenter="attaches-status-hover"\n\t\t\t\t>\n\t\t\t\t\t\x3c!-- span обёрнут в div, чтобы span перестал быть flex-item-ом.\n\t\t\t\t\tТогда ему можно применить правильное вертикальное выравнивание --\x3e\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<span bem:elem="controls-element-spacer">&bullet;&ThinSpace;</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<b:react-async\n\t\t\t\t\t\tcomponent="AttachSafetyStatus"\n\t\t\t\t\t\tsafetyStatus="{attrs[\'safety-status\']}"\n\t\t\t\t\t\thasBackground="{attrs[\'has-attach-safety-status-background\']}"\n\t\t\t\t\t\tattachCount="{attachCount}"\n\t\t\t\t\t\tmobile="{attrs.mobile}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tbem:elem="controls-element"\n\t\t\t\tfn:if="attrs[\'download-link\'] && !(attachCount > 1 && attrs[\'disable-save-in-archive\'])">\n\t\t\t\t<a\n\t\t\t\t\tbem:elem="controls-element-download"\n\t\t\t\t\tdata-name="{attachCount === 1 ? \'download-link\' : null}"\n\t\t\t\t\thref="{attrs[\'download-link\']}"\n\t\t\t\t\tqa:id="download-link"\n\t\t\t\t\tremit:click="download-link">{attachCount === 1 ? i18n(\'Скачать\') : i18n(\'Скачать одним архивом\')}</a>\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="controls-element-size"\n\t\t\t\t\tfn:if="attrs[\'total-size\']">\n\t\t\t\t\t(<fn:value mod="fileSize">attrs[\'total-size\']</fn:value>)\n\t\t\t\t</span>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="controls-element" fn:if="!attrs[\'disable-save-to-cloud\'] && _this.hasSaveToCloudAll()">\n\t\t\t\t<span\n\t\t\t\t\t\tbem:elem="controls-element-cloud"\n\t\t\t\t\t\tremit:click="attach-list-cloud"\n\t\t\t\t\t\tqa:id="save-to-cloud-link"\n\t\t\t\t\t\tevent:details="attrs.models">\n\t\t\t\t\t<fn:if test="attrs.mobile">{i18n(\'В Облако\')}</fn:if>\n\t\t\t\t\t<fn:if test="!attrs.mobile">{i18n(\'Сохранить в Облако\')}</fn:if>\n\t\t\t\t</span>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="controls-element">\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="controls-element-safety-status"\n\t\t\t\t\tqa:id="{attachSafetyStatusLocator}"\n\t\t\t\t\tfn:if="attrs.showAttachSafetyStatus && (attrs[\'attach-safety-status-position\'] === \'end\')"\n\t\t\t\t\tremit:click="attaches-status-click"\n\t\t\t\t\tremit:mouseenter="attaches-status-hover"\n\t\t\t\t>\n\t\t\t\t\t<b:react-async\n\t\t\t\t\t\tcomponent="AttachSafetyStatus"\n\t\t\t\t\t\tsafetyStatus="{attrs[\'safety-status\']}"\n\t\t\t\t\t\thasBackground="{attrs[\'has-attach-safety-status-background\']}"\n\t\t\t\t\t\tattachCount="{attachCount}"\n\t\t\t\t\t\tmobile="{attrs.mobile}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t</div>\n\t</div>\n\n\t<div>\n\t\t<div\n\t\t\tfn:if="!attrs.mobile && attrs.expanded && !attrs[\'preview-mode\']"\n\t\t\tbem:elem="less"\n\t\t\tremit:click="collapse"\n\t\t\tqa:id="less"\n\t\t>\n\t\t\t<bem:mod name="sticky" test="isSticky"/>\n\t\t\t<div bem:elem="collapse-container">\n\t\t\t\t<div bem:elem="collapse-center">\n\t\t\t\t\t<b:ico name="arrow-up"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/attach-list/attach-list.html")});define("feast-tpl!ui-block/attach-list/attach-list.html",["feast-tpl!app/feast-tpl!ui-block/attach-list/attach-list.html"],function(a){return a});define("helpers/can-save-attach-to-cloud",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.canSaveAttachToCloud=void 0;var a=function(a){return!a.isOverMaxSize()&&!a.isLink()&&!a.isCloud()||a.isCloudStock()};exports.canSaveAttachToCloud=a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/resizer",["require","exports","resize-observer-polyfill","utils/util"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);var c=function(a,b,c){var d=false;var e=false;var f=[];return function(){var g=[];for(var h=0;h<arguments.length;h++){g[h]=arguments[h]}if(d){e=true;f.push(g)}else{a.apply(null,g);d=true;setTimeout(function(){d=false;if(e){a.apply(null,c(f));e=false;f=[]}},b)}}};function d(a){if(a.length===1){return a[0]}var b={};for(var c=0,d=a;c<d.length;c++){var e=d[c][0];var f=Object.keys(e);for(var g=0,h=f;g<h.length;g++){var i=h[g];b[i]=e[i]}}return[b]}function e(){var e;var f;var g={};return{set:function(a,f,g){if(f===void 0){f=150}if(g===void 0){g=false}if(!e){e=g?b.default.debounce(a,f,null):c(a,f,d);window.addEventListener("resize",e)}},observe:function(b,c){if(!e){throw new Error("Please use .set() first to initialize Resizer.")}if(!f){window.removeEventListener("resize",e);f=new a.default(function(a){var b={};for(var c=0,d=a;c<d.length;c++){var f=d[c];var g=f.target.__resizerKey__;if(g!==undefined){b[g]=f.contentRect}}e(b)})}if(g[c]){f.unobserve(g[c])}f.observe(b);g[c]=b;b.__resizerKey__=c},unobserve:function(a){var b=a.__resizerKey__;if(f){if(g[b]){f.unobserve(a);g[b]=undefined}if(Object.keys(b).length===0){f.disconnect();f=undefined;g={};window.addEventListener("resize",e)}}},unbind:function(){if(e){window.removeEventListener("resize",e);e=null}if(f){f.disconnect();f=undefined;g={}}}}}exports.default=e});define("feast-tpl!app/feast-tpl!ui-block/attach-thumb/attach-thumb.html",["feast"],function(a){return a.smartParse('<div qa:id="{_this.getQaId()}">\n\t<fn:var name="hasNoTopbar" value="{_this.hasNoTopbar()}"/>\n\t<fn:var name="canSaveToCloud" value="{_this.canSaveToCloud()}"/>\n\t<fn:var name="isSquare" value="{!attrs.responsive && !attrs.full && hasNoTopbar}"/>\n\t<fn:var name="isInfected" value="{_this.isInfected()}" />\n\t<fn:var name="attachWarningTooltip" value="{attrs[\'attach-warning-tooltip\'] && isInfected}" />\n\n\t<fn:attr name="title" value="{attrs.mainTitle}"/>\n\n\t<bem:mod name="full" test="attrs.full"/>\n\t<bem:mod name="responsive" test="attrs.responsive"/>\n\n\t<bem:mod name="top-free" test="hasNoTopbar"/>\n\t<bem:mod name="normal" test="!attrs.responsive && !attrs.full && !hasNoTopbar"/>\n\t<bem:mod name="square" test="isSquare"/>\n\t<bem:mod name="hide-link" test="isSquare"/>\n\n\t<div bem:elem="thumb-elem" qa:id="{_this.getParams().filename.name}">\n\t\t<b:react-async\n\t\t\tcomponent="AttachThumb"\n\t\t\ttitle="{_this.getParams().filename.name}"\n\t\t\tpreview="{_this.getThumbImage()}"\n\t\t\tfullPreview="{_this.isImage() && !attachWarningTooltip}"\n\t\t\tdownloadBtnTitle="{_this.getTitles().downloadTitle}"\n\t\t\tuploadBtnTitle="{_this.getTitles().uploadTitle}"\n\t\t\tdownloadBtnTooltip="{_this.getTitles().downloadTooltip}"\n\t\t\tuploadBtnTooltip="{_this.getTitles().uploadTooltip}"\n\t\t\tonDownloadClick="{_this.onDownload}"\n\t\t\tdisableCloudUpload="{!attrs[\'save-to-cloud\'] || !canSaveToCloud}"\n\t\t\tonCloudUploadClick="{_this.onCloudUpload}"\n\t\t\tonOpenClick="{_this.onOpen}"\n\t\t\ttestId="thumb"\n\t\t\ticonType="{_this.getIcon()}"\n\t\t\tisLink="{_this.isBigAttach()}"\n\t\t\tlinkTitle="{_this.getTitles().mainTitle}"\n\t\t\tdarkMode="{attrs[\'dark-mode\']}"\n\t\t\tlink="{_this.getDownloadUrl()}"\n\t\t\tattachWarningTooltip="{attachWarningTooltip}"\n\t\t/>\n\t</div>\n\n</div>\n',"app/feast-tpl!ui-block/attach-thumb/attach-thumb.html")});define("feast-tpl!ui-block/attach-thumb/attach-thumb.html",["feast-tpl!app/feast-tpl!ui-block/attach-thumb/attach-thumb.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/attach-thumb/attach-thumb",["require","exports","default-values","feast","feast-mod/file-size","feast-mod/letter-date","feast-tpl!./attach-thumb.html","helpers/can-save-attach-to-cloud","helpers/opener","mail/Attachment","service/layer","service/notify","service/radars/index","ui-block/download-frame/download-frame","ui-block/react-async/react-async"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);e=__importDefault(e);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);m=__importDefault(m);exports.default=b.default.Block.extend({name:"attach-thumb",template:e.default,blocks:{"react-async":m.default},attrChanged:{"save-to-cloud":function(){if(this.thumbBlock){this.thumbBlock.setData(this.getParams());this.thumbBlock.render()}}},defaults:{"attach-warning-tooltip":a.ATTACH_WARNING_TOOLTIP},events:{},isImage:function(){var a=this.get("model");return a.isImage()},isDoc:function(){var a=this.get("model");return a.isPreviewFromDocs()||a.isCloudStock()},isBigAttach:function(){var a=this.get("model");return a.isLink()||a.isCloud()||a.isCloudStock()},getAttachSize:function(){var a=this.get("model");return(0,c.fileSize)(a.get("size"))},getIcon:function(){var a=this.get("model");return a.getExtension()},getDownloadUrl:function(){var a=this.get("model");return a.getDownloadUrl()},getThumbImage:function(){if(this.get("attach-warning-tooltip")&&this.isInfected()){return}var b=this.get("model");var c=b.isFromDocs()?h.default.THUMBNAIL_SIZE_L:h.default.THUMBNAIL_SIZE_M;var d=b.getThumbnailUrl(c);if((this.is("full")||this.is("responsive"))&&b.isImage()&&!b.isFromDocs()){d=b.getThumbnailUrl(h.default.THUMBNAIL_SIZE_ORIGINAL)||d;if(b.isPreviewFromDocs()||b.isCloudStock()){d=b.getPreviewUrl()||d}}if(b.isFromDocs()&&b.isCloudStock()){return}if(a.DISABLE_DOCS_PREVIEWS&&(b.isFromDocs()||b.isPreviewFromDocs())){return}return d},getTitles:function(){var a=this.get("model");var b=i18n("Скачать");var e=i18n("Скачать")+" (".concat((0,c.fileSize)(a.get("size")),")");var f=i18n("В Облако");var g=i18n("Сохранить в Облако");var h=a.get("duedate")?"".concat(a.get("name"),". ")+i18n("Ссылка доступна до")+" "+(0,d.letterAttachLinkDate)(a.get("duedate")):a.get("name");return{downloadTitle:b,downloadTooltip:e,uploadTitle:f,uploadTooltip:g,mainTitle:h}},canSaveToCloud:function(){var a=this.get("model");return(0,f.canSaveAttachToCloud)(a)},getParams:function(){var b=this.get("model");this.unsafe=b.isUnsafe();this.extension=b.getExtension();this.filename=b.getName();var e=b.isLink()||b.isCloud()||b.isCloudStock();var f=this.is("save-to-cloud")&&!b.isLink()&&!b.isCloud();var g=this.getThumbImage();var h=this.is("full")?i18n("Скачать"):"";var i=i18n("Скачать")+" (".concat((0,c.fileSize)(b.get("size")),")");var j=this.is("full")?i18n("В Облако"):"";var k=i18n("Сохранить в Облако");var m=b.get("duedate")?"".concat(b.get("name"),". ")+i18n("Ссылка доступна до")+" "+(0,d.letterAttachLinkDate)(b.get("duedate")):b.get("name");var n={isDeferred:false,showFilenameTitle:false,filename:{name:b.get("name")},imageUrl:g,icon:b.getExtension(),type:b.getPrimitiveType(),mainTitle:m,isDocument:g&&b.isFromDocs()&&!b.isImage(),controls:{bottom:{left:{items:[{block:"btn",params:{text:h,title:i,href:b.getDownloadUrl(),icon:"system_download",name:"download",mods:["bare"],target:b.isCloud()||a.VIEWER_OPEN_DOWNLOAD_IN_NEW_WINDOW?"_blank":l.DOWNLOAD_IFRAME_NAME}}]},right:{items:[]}}}};f&&n.controls.bottom.left.items.push({block:"btn",params:{text:j,title:k,icon:"to-cloud",name:"cloud",mods:["bare"]}});e&&n.controls.bottom.right.items.push({block:"btn",params:{title:m,icon:"compose_link",name:"link",mods:["bare","visible","round","green"]}});return n},sendAnalytics:function(a){this.broadcast("attachment:analytics",{models:[this.get("model")],event:a})},didMount:function(){this.onDownload=this.onDownload.bind(this);this.onCloudUpload=this.onCloudUpload.bind(this);this.onOpen=this.onOpen.bind(this);this.broadcast("thumb-item-rendered",this.get("model"));this.sendAnalytics("show")},onDownload:function(b){var c=this;this.broadcast("download",this.get("model"));this.sendAnalytics("download");var d=this.get("model");var e=d.isCloud()||a.VIEWER_OPEN_DOWNLOAD_IN_NEW_WINDOW?"_blank":l.DOWNLOAD_IFRAME_NAME;if(!a.LAYER_UNSAFE_ATTACH||!this.unsafe){return}i.default.open("unsafe-attach",{filename:this.filename,extension:this.extension},{dimmer:true,compact:true,resolvable:true,"reject-on-close":true}).then(function(a){var b=a===void 0?{resolveType:"error"}:a,d=b.resolveType;if(d==="ok"){window.open(c.getDownloadUrl(),e)}}).catch(function(a){if(a){throw a}});b.preventDefault()},onCloudUpload:function(){var a=this.get("model");if(a.isOverMaxLinkSize()){(0,k.default)("big_attach_cl_save");j.default.error({text:i18n("Что-то пошло не так")});return}this.broadcast("cloud",this.get("model"))},onOpen:function(){this.sendAnalytics("open");var a=this.get("model");if(a.isOverMaxLinkSize()){var b=a.getDownloadUrl();(0,g.default)(b);return}this.broadcast("open",this.get("model"))},isInfected:function(){var a=this.get("model");return a.isInfected()},getQaId:function(){var a=this.get("model");return"".concat(a.get("name")).concat(this.isInfected()?":infected":"")}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/attach-list/attach-list",["require","exports","@mail/xray","default-values","feast","feast-mod/file-count","feast-mod/file-size","feast-tpl!./attach-list.html","helpers/browser","helpers/can-save-attach-to-cloud","helpers/resizer","service/layer","service/radars/decorator","service/radars/index","ui-block/attach-thumb/attach-thumb","ui-block/ico/ico"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);f=__importDefault(f);g=__importDefault(g);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);var o=new i.default;exports.default=c.default.Block.extend((0,k.default)({events:[{name:"attach-list-cloud",rename:"to-cloud"},"download-link","thumb-download","thumb-open","thumb-cloud"]})({name:"attach-list",template:f.default,isolateEvents:false,mods:{fileSize:e.fileSize,fileCount:d.fileCount},blocks:{"attach-thumb":m.default,ico:n.default},events:{expand:"onExpandClick",collapse:"onCollapseClick","thumb-rendered":"onThumbRendered","download-link":"onDownloadLink","attaches-status-click":"onAttachesStatusClick","attaches-status-hover":"onAttachesStatusHover"},attrChanged:{expanded:function(a){var b=a?"attach-list-expanded":"attach-list-collapsed";this.broadcast(b);this.showMore()}},defaults:{models:[],"disable-save-to-cloud":b.DISABLE_SAVE_TO_CLOUD,"total-size":0,"download-link":"",itemsRendered:0,"disable-save-in-archive":b.DISABLE_SAVE_IN_ARCHIVE},didMount:function(){var a=this.showMore.bind(this);this.el&&o.set(function(){setTimeout(a,200)});this.downloadBtn=this.el.querySelector('[data-name="download-link"]');if(this.downloadBtn){this.downloadBtn.addEventListener("click",this.onDownload.bind(this),true)}},didUpdate:function(){this.broadcast("force-recalc")},didUnmount:function(){o.unbind()},onExpandClick:function(){this.set("expanded",true)},onCollapseClick:function(){this.set("expanded",false)},hasSaveToCloudAll:function(){return this.is("save-to-cloud")&&this.get("models").some(h.canSaveAttachToCloud)},fullLimit:function(){return b.FULL_ATTACH_THUMB_LIMIT},onThumbRendered:function(a){var b=this.get("itemsRendered");var c=this.get("models").length;b++;this.set("itemsRendered",b,true);if(b===c){this.showMore();this.forceExpandedAttaches()}},showMore:function(){var a=this.refs.thumbs;var b=this.refs.container;if(!a||!b){return}this.set("showmore",b.scrollWidth<a.scrollWidth)},forceExpandedAttaches:function(){if(this.get("showmore")&&b.FORCE_EXPANDED_ATTACH_LIST&&this.get("letter-length")<=b.FORCE_EXPANDED_ATTACHES_MAX_TEXT_LENGTH){this.set("expanded",true);(0,l.default)("force_expanded_attach-list")}},isStickyEnabled:function(){return!b.IS_NATIVE_STICKY_DISABLED&&g.default.capabilities["sticky-support"]},onDownloadLink:function(){this.broadcast("attachment:analytics",{models:this.get("models"),event:"download_archv"})},onDownload:function(a){var c=this;if(this.get("models").length!==1){return}if(!b.LAYER_UNSAFE_ATTACH){return}var d=this.get("models")[0];var e=d.isUnsafe();if(!e){return}var f=d.getExtension();var g=d.getName();j.default.open("unsafe-attach",{filename:g,extension:f},{dimmer:true,compact:true,resolvable:true,"reject-on-close":true}).then(function(a){var b=a===void 0?{resolveType:"error"}:a,d=b.resolveType;if(d==="ok"){window.open(c.downloadBtn.getAttribute("href"),"download-frame")}}).catch(function(a){if(a){throw a}});a.preventDefault()},onAttachesStatusClick:function(){a.default.send("attaches-status-click_action",{dwh:{reason:"click"}})},onAttachesStatusHover:function(){a.default.send("attaches-status-click_action",{dwh:{reason:"hover"}})}}))});define("feast-tpl!app/feast-tpl!ui-block/layer-confirm-clear-folder/layer-confirm-clear-folder.html",["feast"],function(a){return a.smartParse('<div qa:id="layer-confirm-clear-folder">\n\t<bem:mod name="touch" test="attrs.mobile"/>\n\t<bem:mod name="full" test="!attrs.mobile"/>\n\t<bem:mod name="hidden" test="attrs.hidden"/>\n\n\t<b:layer\n\t\t\tremit:close="layer:close"\n\t\t\tmodel="{attrs.model}"\n\t\t\terror="{attrs.error}"\n\t\t\tmobile="{attrs.mobile}"\n\t\t\tname="confirm-clear-folder"\n\t\t\tclose\n\t\t\theader\n\t\t\tfooter\n\t\t\tcenter\n\t\t\tstandard\n\t\t\tresolvable\n\t>\n\n\t\t<fn:match name="header" args="attrs">\n\t\t\t{_this.getText()}\n\t\t</fn:match>\n\n\t\t<fn:match name="content" args="attrs">\n\t\t\t<fn:choose>\n\t\t\t\t<fn:when test="attrs.model.isTrashLike() || attrs.model.isSpam()">\n\t\t\t\t\t<span qa:id="remove-forever">\n\t\t\t\t\t\t{i18n(\'Письма удалятся навсегда — восстановить их не получится.\')}\n\t\t\t\t\t</span>\n\t\t\t\t</fn:when>\n\n\t\t\t\t<fn:otherwise>\n\t\t\t\t\t<span qa:id="remove-to-trash">\n\t\t\t\t\t\t{i18n(\'Все письма будут перенесены в папку «Корзина».\')}\n\t\t\t\t\t</span>\n\t\t\t\t</fn:otherwise>\n\t\t\t</fn:choose>\n\t\t</fn:match>\n\n\t\t<fn:match name="footer" args="attrs">\n\t\t\t<div bem:elem="submit-button">\n\t\t\t\t<b:button2\n\t\t\t\t\t\tqa:id="submit"\n\t\t\t\t\t\tremit:click="layer:resolve"\n\t\t\t\t\t\tevent:details="{close: true}"\n\t\t\t\t\t\ttext="{i18n(\'Очистить\')}"\n\t\t\t\t\t\tprimary\n\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="cancel-button">\n\t\t\t\t<b:button2\n\t\t\t\t\t\tqa:id="cancel"\n\t\t\t\t\t\tremit:click="layer:close"\n\t\t\t\t\t\ttext="{i18n(\'Отменить\')}"\n\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</fn:match>\n\n\t</b:layer>\n</div>\n',"app/feast-tpl!ui-block/layer-confirm-clear-folder/layer-confirm-clear-folder.html")});define("feast-tpl!ui-block/layer-confirm-clear-folder/layer-confirm-clear-folder.html",["feast-tpl!app/feast-tpl!ui-block/layer-confirm-clear-folder/layer-confirm-clear-folder.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/layer/layer.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="standard" test="attrs.standard"/>\n\t<bem:mod name="media" test="attrs.media"/>\n\t<bem:mod name="compose" test="attrs.compose"/>\n\t<bem:mod name="center" test="attrs.center"/>\n\t<bem:mod name="size" value="{attrs.size}"/>\n\t<bem:mod name="wide" test="attrs.wide"/> \x3c!-- OCTAVIUS-1835 --\x3e\n\t<bem:mod name="{attrs.name}" test="attrs.name"/>\n\n\t<div bem:elem="controls" qa:id="controls">\n\t\t<b:button2\n\t\t\tfn:if="attrs.collapse"\n\t\t\tremit:click="collapse"\n\t\t\tqa:id="collapse"\n\t\t\tico="minimize"\n\t\t\ttext="{i18n(\'Свернуть\')}"\n\t\t\tsize="m"\n\t\t\tpure\n\t\t\tclean\n\t\t\tshort\n\t\t\ttab-index="1100"\n\t\t\tcentered\n\t\t/>\n\n\t\t<b:button2\n\t\t\tfn:if="attrs.close"\n\t\t\tremit:click="close"\n\t\t\tqa:id="close"\n\t\t\tico="close"\n\t\t\ttext="{i18n(\'Закрыть\')}"\n\t\t\tsize="m"\n\t\t\tpure\n\t\t\tshort\n\t\t\talways-bright="{this.isIframe()}"\n\t\t\tradar-id="close"\n\t\t\ttab-index="1000"\n\t\t\tcentered\n\t\t/>\n\t</div>\n\n\t<div bem:elem="header" fn:if="attrs.header" qa:id="header">\n\t\t<fn:apply-match name="header"/>\n\t</div>\n\n\t<div bem:elem="content" qa:id="content">\n\t\t<fn:apply-match name="content"/>\n\t</div>\n\n\t<div bem:elem="footer" fn:if="!attrs.hiddenfooter" qa:id="footer">\n\t\t<fn:apply-match name="footer"/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/layer/layer.html")});define("feast-tpl!ui-block/layer/layer.html",["feast-tpl!app/feast-tpl!ui-block/layer/layer.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer/layer",["require","exports","feast","feast-tpl!./layer.html","ui-block/button2/button2"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);exports.default=a.default.Block.extend({name:"layer",template:b.default,blocks:{button2:c.default},isIframe:function(){var a=this.get("name");return a==="iframe"}})});define("ui-block/layer-confirm-clear-folder/layer-confirm-clear-folder",["exports","feast","feast-mod/brackets","feast-mod/folder-name","feast-tpl!./layer-confirm-clear-folder.html","ui-block/button2/button2","ui-block/layer/layer"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=k(a);var h=k(d);var i=k(e);var j=k(f);function k(a){return a&&a.__esModule?a:{default:a}}exports.default=g.default.Block.extend({name:"layer-confirm-clear-folder",template:h.default,blocks:{layer:j.default,button2:i.default},getName:function a(){var d=(0,c.getFolderName)(this.get("model"));return(0,b.brackets)(d)},getText:function a(){return i18n("Очистить папку {folder}?",{folder:this.getName()})}})});define("feast-tpl!app/feast-tpl!ui-block/letter-body/letter-body.html",["feast"],function(a){return a.smartParse('<div qa:id="letter-body">\n\t\x3c!-- Переменные --\x3e\n\t<fn:var\n\t\tname="hasQuotes"\n\t\tvalue="{!!(attrs[\'quotes-raw\'] || attrs[\'quotes-formatted\'].length)}"\n\t/>\n\n\t<fn:var\n\t\tname="bodyRaw"\n\t\tvalue="{attrs[\'body-raw\']}"\n\t/>\n\n\t<fn:var\n\t\tname="darkMode"\n\t\tvalue="{attrs[\'dark-mode\']}"\n\t/>\n\n\t<fn:var\n\t\tname="message"\n\t\tvalue="{attrs[\'message\']}"\n\t/>\n\n\t\x3c!-- Модификаторы --\x3e\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\n\t<bem:mod\n\t\tname="formatted-quotes"\n\t\ttest="!attrs[\'quotes-mode-raw\'] && attrs[\'quotes-formatted\'].length"\n\t/>\n\n\t<bem:mod\n\t\tname="raw-quotes"\n\t\ttest="attrs[\'quotes-mode-raw\'] && attrs[\'quotes-raw\']"\n\t/>\n\n\t<bem:mod\n\t\tname="quotes"\n\t\ttest="hasQuotes"\n\t/>\n\n\t<bem:mod name="dark-mode" test="darkMode"/>\n\n\t\x3c!-- Содержимое --\x3e\n\t<div bem:elem="body" qa:id="body">\n\t\t<bem:mod name="no-scroll" test="attrs[\'preview-mode\']"/>\n\t\t<div bem:elem="body-wrapper" ref="body">\n\t\t\t<div bem:elem="body-content" tabindex="-1" ref="js-body">\n\t\t\t\t\x3c!-- отрисовка письма всего один раз и навсегда --\x3e\n\t\t\t\t<b:html-parser\n\t\t\t\t\tid="body-parser"\n\t\t\t\t\tfn:if="bodyRaw"\n\t\t\t\t\tcontent="{bodyRaw}"\n\t\t\t\t\tdarkosha="{_this.getOrCreateDarkosha()}"\n\t\t\t\t\tmessage="{message}"\n\t\t\t\t\tdark-mode="{darkMode}"\n\t\t\t\t\tremit:zoom="letter:zoom"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t\x3c!-- Есть цитаты? --\x3e\n\t<fn:if test="hasQuotes">\n\t\t\x3c!-- Тоглер сворачивания цитат --\x3e\n\t\t<fn:if test="attrs.collapsable">\n\t\t\t<div bem:elem="badge">\n\t\t\t\t<b:button2\n\t\t\t\t\tbadge\n\t\t\t\t\tsecondary\n\t\t\t\t\tico="navigation:more"\n\t\t\t\t\tremit:click="blockquote:toggle"\n\t\t\t\t\tqa:id="blockquote-toggler"\n\t\t\t\t\tcentered\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</fn:if>\n\n\t\t\x3c!-- Когда свернуть нельзя, просто подписываем --\x3e\n\t\t<fn:if test="!attrs.collapsable">\n\t\t\t<div\n\t\t\t\tbem:elem="title"\n\t\t\t\tqa:id="blockquote-title"\n\t\t\t>{i18n(\'вся переписка\')}</div>\n\t\t</fn:if>\n\n\t\t\x3c!-- Тело цитат --\x3e\n\t\t<div\n\t\t\tref="blockquotes"\n\t\t\tbem:elem="blockquotes"\n\t\t\tqa:id="blockquotes">\n\t\t\t\x3c!-- Если цитаты развернуты --\x3e\n\t\t\t<fn:if test="!attrs.collapsable || !_this.isCollapsed()">\n\t\t\t\t\x3c!-- Старые цитаты --\x3e\n\t\t\t\t<fn:if test="attrs[\'quotes-mode-raw\']">\n\t\t\t\t\t<div bem:elem="blockquotes-raw" qa:id="raw">\n\t\t\t\t\t\t<b:html-parser\n\t\t\t\t\t\t\tid="quote-parser"\n\t\t\t\t\t\t\tcontent="{attrs[\'quotes-raw\']}"\n\t\t\t\t\t\t\tdarkosha="{_this.getOrCreateDarkosha()}"\n\t\t\t\t\t\t\tmessage="{message}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</fn:if>\n\n\t\t\t\t\x3c!-- Новые цитаты --\x3e\n\t\t\t\t<fn:if test="!attrs[\'quotes-mode-raw\']">\n\t\t\t\t\t<fn:for data="attrs[\'quotes-formatted\']" as="blockquote" key="key">\n\t\t\t\t\t\t<b:letter-blockquote\n\t\t\t\t\t\t\tkey="{key}"\n\t\t\t\t\t\t\tindex="{key}"\n\t\t\t\t\t\t\tblockquote="{blockquote}"\n\t\t\t\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\t\t\t\tmessage="{message}"\n\t\t\t\t\t\t\tdarkosha="{_this.getOrCreateDarkosha()}"\n\t\t\t\t\t\t\tremit:blockquote-zoom="letter:zoom"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:for>\n\t\t\t\t</fn:if>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/letter-body/letter-body.html")});define("feast-tpl!ui-block/letter-body/letter-body.html",["feast-tpl!app/feast-tpl!ui-block/letter-body/letter-body.html"],function(a){return a});define("helpers/metrics/scores",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a={"letter:render":[1600,2600,3600],"letter:ready":[2100,3600,5600]};exports.default=a});define("helpers/perf",["require","exports","@mail-core/dashboard","helpers/lazy"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getPerfActionStartAt=exports.getPerfRouterStartAt=exports.initPerfMonitoring=void 0;var c={};var d=0;var e=0;var f=null;var g=null;var h={"Ctrl+A":"sel-all",Del:"del",V:"move",E:"arch",".":"more",N:"compose"};var i=function(a){return false};var j=[{name:"folder",test:function(a,b){return b.navFolderId}},{name:"list-item",test:function(a,b){return a.is("#letters")&&b.letterId}},{name:"list-item-sel",test:function(a,b){return a.is("#letters")&&b.letterCheckbox}},{name:"search",test:function(a,b){return b.searchInput}}];var k=function(){if(!g){g={};try{do{var a=f.dataset||c;g.navFolderId=g.navFolderId||a.folderLinkId;g.letterId=g.letterId||a.uidlId&&a.id;g.letterSelect=g.letterSelect||f.type==="checkbox";g.ctrl=g.ctrl||h[a.titleShortcut];f=f.parentNode}while(f)}catch(a){}f=null}return g};var l=function(c){c.on("before-route",function(){d=performance.now()});c.on("route-end",function(){(0,b.nextFrame)(function(){var b;var e=performance.now();var f=((b=c.route)===null||b===void 0?void 0:b.id.replace(/[^\w_-]/g,""))||"unk";if(!i(c)){a.userKeeper.add("app-route-change",d,e,{score:"route",appendix:f,dwh:true})}})});document.addEventListener("mousedown",function(a){var b=a.target;e=performance.now();g=null;f=b},true);document.addEventListener("click",function(){(0,b.nextFrame)(function(){var b;var d=k();var f=(b=j.find(function(a){var b=a.test;return!b||b(c.route,d)}))===null||b===void 0?void 0:b.name;var g=d.ctrl;var h=performance.now();a.userKeeper.add("app-click-latency",e,h,{score:"latency",dwh:true});if(f){a.userKeeper.add("app-click-latency",e,h,{score:"latency",appendix:f})}if(g){a.userKeeper.add("app-click-latency",e,h,{score:"latency",appendix:"".concat(f,"-").concat(g)})}})})};exports.initPerfMonitoring=l;var m=function(){return d};exports.getPerfRouterStartAt=m;var n=function(){return e||d};exports.getPerfActionStartAt=n});define("feast-tpl!app/feast-tpl!ui-block/html-parser/html-parser.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="message" value="{attrs[\'message\']}" />\n\n\t<b:html-fishing id="fishing" message="{message}">\n\t\t<b:html-expander id="expander" dark-mode="{attrs[\'dark-mode\']}">\n\t\t\t<fn:value output="raw">attrs.content</fn:value>\n\t\t</b:html-expander>\n\t</b:html-fishing>\n</div>\n',"app/feast-tpl!ui-block/html-parser/html-parser.html")});define("feast-tpl!ui-block/html-parser/html-parser.html",["feast-tpl!app/feast-tpl!ui-block/html-parser/html-parser.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/html-expander/html-expander.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:apply-match name="default" />\n</div>\n',"app/feast-tpl!ui-block/html-expander/html-expander.html")});define("feast-tpl!ui-block/html-expander/html-expander.html",["feast-tpl!app/feast-tpl!ui-block/html-expander/html-expander.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/html-expander-wrapper/html-expander-wrapper.html",["feast"],function(a){return a.smartParse('<div remit:click="wrapper:click">\n\t\x3c!-- Modifiers --\x3e\n\t<bem:mod name="expanded" test="attrs.expanded"/>\n\t<bem:mod name="collapsed" test="!attrs.expanded"/>\n\t<bem:mod name="type_{attrs.type}" test="attrs.type"/>\n\n\t\x3c!-- Variables --\x3e\n\t<fn:var name="icoName" value="navigation:zoom_overlay"/>\n\n\t\x3c!-- Content --\x3e\n\t\x3c!-- todo: перенести в отдельный компонент кнопки --\x3e\n\t<div\n\t\tbem:elem="button"\n\t\tfn:if="attrs[\'is-button-visible\']"\n\t\tremit:click="zoom:click"\n\t\tqa:id="expand-button"\n\t>\n\t\t<span bem:elem="icon">\n\t\t\t<b:ico name="{icoName}"/>\n\t\t</span>\n\t</div>\n\n\t\x3c!-- Сюда добавится содержимое враппера --\x3e\n</div>\n',"app/feast-tpl!ui-block/html-expander-wrapper/html-expander-wrapper.html")});define("feast-tpl!ui-block/html-expander-wrapper/html-expander-wrapper.html",["feast-tpl!app/feast-tpl!ui-block/html-expander-wrapper/html-expander-wrapper.html"],function(a){return a});define("ui-block/html-expander-wrapper/html-expander-wrapper",["exports","feast","feast-tpl!./html-expander-wrapper.html","service/radars/decorator","ui-block/ico/ico"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend((0,g.default)({events:[]})({name:"html-expander-wrapper",template:f.default,performanceTrace:"track",immutable:true,isolate:true,isolateEvents:true,defaults:{expanded:false,"is-button-visible":false,type:""},blocks:{ico:h.default},didMount:function a(){}}))});define("service/processors/Expander",["exports","@mail/xray","default-values","Emitter","service/smokescreen","ui-block/html-expander-wrapper/html-expander-wrapper"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=i(a);var g=i(c);var h=i(e);function i(a){return a&&a.__esModule?a:{default:a}}function j(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var l=function(){function a(b){var c=b.radarName,d=c===undefined?"expander":c,e=b.isDefaultZoomOut,f=e===undefined?true:e,h=b.isTogglerVisible,i=h===undefined?false:h;j(this,a);g.default.apply(this);this.elements=new Map;this.radarName=d;this.parentWidth=0;this.container=null;this.isDefaultZoomOut=f;this.isTogglerVisible=i;this.radar("create")}k(a,[{key:"radar",value:function a(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++){c[d]=arguments[d]}f.default.send([this.radarName].concat(c),{skipdwh:true})}},{key:"prepare",value:function a(b,c){this.container=b;this.parentWidth=c||b.getBoundingClientRect().width;var e=b.querySelectorAll((0,d.selector)(this.SELECTOR));for(var f=0;f<e.length;f++){var g=e[f];var h=this.prepareItem(g),i=h.item,j=h.isFiltered;if(!j){this.elements.set(g,i)}}this.prepareEnd()}},{key:"prepareEnd",value:function a(){console.log(this.radarName+"#prepareEnd")}},{key:"prepareItem",value:function a(b){console.log(this.radarName+"#prepareItem")}},{key:"reset",value:function a(){var b=this;this.elements.forEach(function(a){b.resetItem(a)});this.elements.clear()}},{key:"resetItem",value:function a(b){console.log(this.radarName+"#resetItem")}},{key:"toggleZoom",value:function a(b){this.radar("toggle-size");if(b.isSmall){this.zoomIn(b)}else{this.zoomOut(b)}}},{key:"zoomIn",value:function a(b){this.radar("set-original");b.isSmall=false;b.toggler.set("expanded",true);this.zoomInItem(b);this.emit("zoomin",b)}},{key:"zoomInItem",value:function a(b){console.warn("Expander#zoomInItem",b)}},{key:"zoomOut",value:function a(b){this.radar("set-small");b.isSmall=true;b.toggler.set("expanded",false);this.zoomOutItem(b);this.emit("zoomout",b)}},{key:"zoomOutItem",value:function a(b){console.warn("Expander#zoomOutItem",b)}},{key:"wrap",value:function a(c){var d=this;this.radar("wrap");var e=c.element,f=c.type;var g=document.createElement("div");var i=new h.default({"is-button-visible":this.isTogglerVisible&&!b.DISABLE_IMAGE_EXPANDER,expanded:true,type:f});i.on("wrapper:click",function(a){d.emit("item:click",c);a.originalEvent.preventDefault()});i.on("zoom:click",function(a){d.emit("button:click",c);a.originalEvent.stopPropagation();a.originalEvent.preventDefault()});i.renderTo(g);e.parentNode.insertBefore(g,e);i.el.appendChild(e);c.toggler=i;c.wrapper=g;c.clone=e.cloneNode(true);return c}},{key:"unwrap",value:function a(b){this.radar("unwrap");var c=b.toggler,d=b.wrapper,e=b.element;c.destroy();var f=d;var g=d.parentNode;g.insertBefore(e,f);g.removeChild(f);b.wrapper=null;b.toggler=null}},{key:"SELECTOR",get:function a(){return""}},{key:"ITEM_TYPE",get:function a(){return""}}]);return a}();exports.default=l});define("service/processors/ImagesExpander",["exports","@mail/xray","default-values","service/processors/Expander"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=f(a);var e=f(c);function f(a){return a&&a.__esModule?a:{default:a}}var g=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};function h(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function j(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function k(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var l=function(a){k(c,a);function c(a){h(this,c);return j(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,g({radarName:"images-expander"},a)))}i(c,[{key:"zoomInItem",value:function a(b){var c=b.element,d=b.cssWidth,e=b.cssHeight,f=b.cssMaxWidth;c.style.width=d;c.style.height=e;c.style.maxWidth=f}},{key:"zoomOutItem",value:function a(b){var c=b.element;c.style.width="";c.style.height="";c.style.maxWidth="100%"}},{key:"prepareItem",value:function a(c){var e=this.elements.get(c);if(e){return{item:e,isFiltered:true}}var f=c.closest("table "+this.SELECTOR);if(f&&this.container.contains(f)){return{item:null,isFiltered:true}}var g=c.closest("a");var h=g?"image-link":this.ITEM_TYPE;var i={cssWidth:c.style.width,cssHeight:c.style.height,cssMaxWidth:c.style.maxWidth,element:c,wrapper:null,isSmall:false,isCollapsable:false,isLink:g,type:h};var j=this.onItemLoad.bind(this,i);i.onImageLoad=j;if(!c.complete){d.default.send("add-event-load",{skipdwh:b.SKIP_DWH});c.addEventListener("load",j)}else{i.onImageLoad()}return{item:i,isFiltered:false}}},{key:"resetItem",value:function a(c){var e=c.element,f=c.onImageLoad,g=c.isCollapsable;d.default.send("remove-event-load",{skipdwh:b.SKIP_DWH});e.removeEventListener("load",f);if(!g){return}this.zoomIn(c);this.unwrap(c)}},{key:"onItemLoad",value:function a(b){var c=b.element;var d=c.getBoundingClientRect(),e=d.width;if(e===0){this.radar("width-0");return}this.radar("has-width");if(e>this.parentWidth){b.isCollapsable=true;this.radar("big-image");this.wrap(b);if(this.isDefaultZoomOut){this.zoomOut(b)}}}},{key:"SELECTOR",get:function a(){return"img"}},{key:"ITEM_TYPE",get:function a(){return"image"}}]);return c}(e.default);exports.default=l});define("service/processors/scale-element",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getWrapperCSSHeight=f;exports.getScale=g;var a=exports.MAX_SCALE=1;var b=exports.CONTAINER_MIN_HEIGHT=40;function c(a){var b=window.getComputedStyle(a,null);var c=parseInt(b.marginLeft,10)||0;var d=parseInt(b.marginRight,10)||0;return c+d}function d(a){var b=window.getComputedStyle(a,null);var c=parseInt(b.marginTop,10)||0;var d=parseInt(b.marginBottom,10)||0;return c+d}function e(a,b){var c=a.offsetHeight;return Math.ceil(c*b)+d(a)}function f(a,c){return Math.max(e(a,c),b)+"px"}function g(b,d){var e=b.getBoundingClientRect(),f=e.width;if(!(d>0&&f>0)){return a}d-=c(b);return d/f}});define("service/processors/TablesExpander",["exports","logger","service/processors/Expander","service/processors/scale-element","service/smokescreen"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=g(a);var f=g(b);function g(a){return a&&a.__esModule?a:{default:a}}function h(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++){c[b]=a[b]}return c}else{return Array.from(a)}}var i=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};function j(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();function l(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a}function m(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b}var n="img";var o=2e3;var p=function(a){m(b,a);function b(a){j(this,b);var c=l(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,i({radarName:"tables-expander"},a)));c.images=[];return c}k(b,[{key:"zoomInItem",value:function a(b){var c=b.element,d=b.wrapper;c.style.transform="";c.style.transformOrigin="";d.style.height=""}},{key:"zoomOutItem",value:function a(b){var d=b.element,e=b.scale,f=b.wrapper;d.style.transform="scale("+e+", "+e+")";d.style.transformOrigin="top left";f.style.height=(0,c.getWrapperCSSHeight)(d,e)}},{key:"prepareItem",value:function a(b){var c=b.closest(this.SELECTOR+" "+this.SELECTOR);if(c&&this.container.contains(c)){return{isFiltered:true,item:null}}this.images=[].concat(h(this.images),h(b.querySelectorAll((0,d.selector)(n))));var e={element:b,type:this.ITEM_TYPE};return{item:e,isFiltered:false}}},{key:"prepareEnd",value:function a(){if(this.images.length>0){this.radar("find-images");this.processImages()}else{this.radar("find-no-images");this.processTables()}}},{key:"processTables",value:function a(){var b=this;this.elements.forEach(function(a){b.scaleItem(a)})}},{key:"scaleItem",value:function a(b){this.radar("scale");var d=b.element;var e=(0,c.getScale)(d,this.parentWidth);b.scale=e;if(e<c.MAX_SCALE){this.wrap(b);if(this.isDefaultZoomOut){this.zoomOut(b)}}if(e>=c.MAX_SCALE&&d.scrollWidth>this.parentWidth){}}},{key:"processImages",value:function a(b){var c=this;var d=this.images;try{if(!b){b=(new Date).getTime()}var f=d.length;for(var g=0;g<d.length;g++){var h=d[g];if(!h||!h.src||h.complete){f--}}if(f==0||(new Date).getTime()-b>=o){this.processTables()}else{window.requestAnimationFrame(function(){c.processImages(b)})}}catch(a){this.radar("process-images","error");e.default.add("Error processing images in table-expander: "+a)}}},{key:"SELECTOR",get:function a(){return"table"}},{key:"ITEM_TYPE",get:function a(){return"table"}}]);return b}(f.default);exports.default=p});define("ui-block/html-expander/html-expander",["exports","default-values","feast","feast-tpl!./html-expander.html","service/layer","service/processors/ImagesExpander","service/processors/TablesExpander"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=l(b);var h=l(c);var i=l(d);var j=l(e);var k=l(f);function l(a){return a&&a.__esModule?a:{default:a}}exports.default=g.default.Block.extend({name:"html-expander",template:h.default,performanceTrace:"track",immutable:false,isolate:true,isolateEvents:false,defaults:{images:a.IMAGES_EXPANDER,"images-default-zoomout":true,"images-popup":a.IMAGES_EXPANDER_POPUP,tables:a.TABLES_EXPANDER,"tables-default-zoomout":true,"tables-popup":a.TABLES_EXPANDER_POPUP},init:function a(){var b=this.el.getBoundingClientRect(),c=b.width;this.handleImageClick=this.handleImageClick.bind(this);this.handleImageButtonClick=this.handleImageButtonClick.bind(this);this.handleTableClick=this.handleTableClick.bind(this);this.handleTableButtonClick=this.handleTableButtonClick.bind(this);this.handleItemZoom=this.handleItemZoom.bind(this);if(this.is("tables")){this.tablesExpander=new k.default({isTogglerVisible:this.is("tables-popup"),isDefaultZoomOut:this.is("tables-default-zoomout")});this.tablesExpander.on("item:click",this.handleTableClick);this.tablesExpander.on("button:click",this.handleTableButtonClick);this.tablesExpander.on("zoomin",this.handleItemZoom);this.tablesExpander.on("zoomout",this.handleItemZoom);this.tablesExpander.prepare(this.el,c)}if(this.is("images")){this.imagesExpander=new j.default({isTogglerVisible:this.is("images-popup"),isDefaultZoomOut:this.is("images-default-zoomout")});this.imagesExpander.on("item:click",this.handleImageClick);this.imagesExpander.on("button:click",this.handleImageButtonClick);this.imagesExpander.on("zoomin",this.handleItemZoom);this.imagesExpander.on("zoomout",this.handleItemZoom);this.imagesExpander.prepare(this.el,c)}},deinit:function a(){if(this.imagesExpander){this.imagesExpander.off("item:click",this.handleImageClick);this.imagesExpander.off("button:click",this.handleImageButtonClick);this.imagesExpander.off("zoomin",this.handleItemZoom);this.imagesExpander.off("zoomout",this.handleItemZoom);this.imagesExpander.reset()}if(this.tablesExpander){this.tablesExpander.off("item:click",this.handleTableClick);this.tablesExpander.off("button:click",this.handleTableButtonClick);this.tablesExpander.off("zoomin",this.handleItemZoom);this.tablesExpander.off("zoomout",this.handleItemZoom);this.tablesExpander.reset()}},handleItemZoom:function a(){this.broadcast("zoom")},handleTableClick:function a(b){if(b.isSmall){this.tablesExpander.zoomIn(b)}},handleTableButtonClick:function a(b){this.openInLayer(b)},handleImageClick:function a(b){if(!b.isLink){this.imagesExpander.toggleZoom(b)}},handleImageButtonClick:function a(b){this.openInLayer(b)},openInLayer:function a(b){i.default.open("html-viewer",{content:b.clone.outerHTML,"dark-mode":this.get("dark-mode")},{dimmer:true,"dimmer-color":"dark",fullscreen:true})}})});define("feast-tpl!app/feast-tpl!ui-block/html-fishing/html-fishing.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:apply-match name="default" />\n</div>\n',"app/feast-tpl!ui-block/html-fishing/html-fishing.html")});define("feast-tpl!ui-block/html-fishing/html-fishing.html",["feast-tpl!app/feast-tpl!ui-block/html-fishing/html-fishing.html"],function(a){return a});define("helpers/domain-test",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=function a(b,c){return new RegExp("^(https?:)?//([\\w\\.\\-]+\\.)?"+c).test(b)};exports.default=a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/fishing",["require","exports","@mail/features","default-values","helpers/browser","helpers/domain-test","helpers/querystring","helpers/querystring-add"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);var g="__originUrl";var h=location.protocol,i=location.hostname,j=location.pathname;var k=new RegExp("^"+h+"//"+i+"("+j+"|/)#");var l=document.createElement("div");var m="A";var n="FORM";var o="checklink.mail.ru";var p=function(){function h(){this.ERROR_HASH_URL="ERROR_HASH_URL";this.ERROR_EMPTY_URL="ERROR_EMPTY_URL";this.ERROR_NO_INFO_CHECK="ERROR_NO_INFO_CHECK"}h.prototype.removeRedirectFromLinks=function(a){var b=a.length;while(b--){this.getNodeInfo(a[b])}};h.prototype.removeRedirectFromText=function(a){l.innerHTML=a;var b=l.querySelectorAll("a");var c=b.length;while(c--){this.getNodeInfo(b[c])}return l.innerHTML};h.prototype.getNodeInfo=function(b){var f=b[g]||b.href||b.action;var h={};if(!f){console.warn("[fishing] no url in node");return h}try{var i=b.innerHTML;var j=b.childNodes;var l=b.tagName;var p=(0,e.default)(f);var q=a.default.has("clicker-proxy")?a.default.get("clicker-proxy").data:o;if(p.url&&(0,d.default)(f,q)){var r=(0,e.default)(p.url);Object.assign(p,r)}["check","url","u","js"].forEach(function(a){h[a]=p[a]});if(f.includes("#")&&k.test(f)){h={};h[f]=""}if(h.check&&h.url&&!h.u){if(!h.js&&l!==n){f=f.replace(/^([^#]+)/,"$1&js=1")}if(location.protocol=="https:"&&/^http/i.test(h.url)||c.default.isIE){h.redir=1}}h.real=f;h.attr=b.href?"href":"action";if(h.u){h.check=1;h.url=h.u;h.noajax=1}if(h.check&&h.url){b.target="_blank";b[g]=h.real;b.setAttribute(h.attr,l===m||h.u?h.url:f);b.removeAttribute("onclick");if(c.default.isIE&&l===m&&j.length==1&&j[0].nodeType==3){b.innerHTML=i}}else{h.url=f}}catch(a){console.warn("[fishing] error caught",a)}return h};h.prototype.revertUrl=function(a){var b=this.getNodeInfo(a);var c=a.href;var d=a.tagName===m;if(b.check&&d){a.href=b.real;setTimeout(function(){a.href=c},300)}};h.prototype.verify=function(a,b){if(b===void 0){b={}}var c=this.getNodeInfo(a);var d=a.tagName===n;var e=b.sync,f=e===void 0?false:e,g=b.callback,h=g===void 0?{resolve:function(){},reject:function(a){return a}}:g;var i=f?h:Promise;var j=c.url;if(!j){return i.reject(this.ERROR_EMPTY_URL)}if(j.includes("#")&&a.hostname===location.hostname&&(a.pathname===location.pathname||a.pathname==="/")){return i.reject(this.ERROR_HASH_URL)}if(c.noajax&&!d){return i.resolve()}if(!c.check){return i.reject(this.ERROR_NO_INFO_CHECK)}return i.reject()};h.prototype.go=function(a,c,d){if(c===void 0){c=false}if(d===void 0){d={}}if(a[g]){a[g]=(0,f.default)(a[g],d)}var e=this.getNodeInfo(a);var h=a.tagName===n;var i=e[e.redir||e.noajax?"real":"url"];var j=null;if(e.redir){i+="&redir=1"}if(h){document.createElement("form").submit.call(a)}else{if(b.IS_CHROME){j=window.open(i,"_blank","toolbar=yes, location=yes, status=yes, menubar=yes, scrollbars=yes, noopener=true")}else{j=c||window.open(i)}if(j){j.opener=null}}};return h}();exports.default=new p});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/html-fishing/html-fishing",["require","exports","@mail/xray","default-values","feast","feast-tpl!./html-fishing.html","service/fishing","service/radars/decorator"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);exports.default=c.default.Block.extend((0,f.default)({events:[]})({name:"html-fishing",template:d.default,performanceTrace:"track",immutable:false,isolate:true,isolateEvents:false,init:function(){this.onLinkClick=this.onLinkClick.bind(this);this.onLinkMouseDown=this.onLinkMouseDown.bind(this);this.el.addEventListener("click",this.onLinkClick);this.el.addEventListener("mousedown",this.onLinkMouseDown);this.removeLinksFromBody()},deinit:function(){if(typeof this.onLinkClick!=="function"&&typeof this.onLinkClick!=="object"){if(b.LOG_FISHING_DEINIT_ERROR){a.default.send("fishing_deinit_error",{rlog:"fishing_errors",rlog_message:{onLinkClick:typeof this.onLinkClick,onLinkMouseDown:typeof this.onLinkMouseDown,keys:Object.keys(this)}})}this.el.removeEventListener("click");this.el.removeEventListener("mousedown");return}this.el.removeEventListener("click",this.onLinkClick);this.el.removeEventListener("mousedown",this.onLinkMouseDown)},getLink:function(a){while(a&&a!==this.el){if(a.tagName.toLowerCase()==="a"){return a}a=a.parentElement}},onLinkMouseDown:function(a){if(a.which>2){return}var b=this.getLink(a.target);if(b){e.default.revertUrl(b)}},onLinkClick:function(a){var c=this.getLink(a.target);if(c){var d=e.default.verify(c,{sync:true});var f=this.get("message");var g=f.get("flags.maybe_phishing");if(d===e.default.ERROR_HASH_URL||d===e.default.ERROR_EMPTY_URL){return true}a.preventDefault();e.default.go(c,null,__assign({},g&&{maybe_phishing:b.PHISHING_ALERT?"1":"0"}))}},removeLinksFromBody:function(){var a=this.el.querySelectorAll("a");e.default.removeRedirectFromLinks(a)}}))});define("ui-block/html-parser/html-parser",["exports","feast","feast-tpl!./html-parser.html","service/radars/decorator","ui-block/html-expander/html-expander","ui-block/html-fishing/html-fishing"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=k(a);var g=k(b);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend((0,h.default)({events:[]})({name:"html-parser",template:g.default,performanceTrace:"track",immutable:false,isolate:true,isolateEvents:false,defaults:{content:"",message:null,darkosha:undefined},blocks:{"html-fishing":j.default,"html-expander":i.default},applyDarkosha:function a(){var b=this.get("darkosha");if(b){b.isolateSubtree(this.el)}},didMount:function a(){this.applyDarkosha()},rerender:function a(){this.ids.expander.deinit();this.ids.fishing.deinit();this.ids.expander.init();this.ids.fishing.init();this.applyDarkosha()},didUnmount:function a(){this.ids.expander.deinit();this.ids.fishing.deinit()}}))});define("feast-tpl!app/feast-tpl!ui-block/letter-blockquote/letter-blockquote.html",["feast"],function(a){return a.smartParse('<div qa:id="letter-blockquote">\n\t<bem:mod name="first" test="attrs.index === 0"/>\n\t<bem:mod name="ponymode" test="attrs.ponymode"/>\n\n\t<fn:var name="message" value="{attrs[\'message\']}" />\n\t<fn:var name="blockquote" value="{attrs.blockquote}"/>\n\t<fn:var name="letterShowEmail" value="{attrs.letterShowEmail}"/>\n\n\t<fn:if test="blockquote.isSenderFully">\n\t\t<div bem:elem="header">\n\t\t\t<b:avatar\n\t\t\t\tsize="s"\n\t\t\t\tsrc="{blockquote.avatar}"\n\t\t\t\tanonymous="{blockquote.anonymous}"\n\t\t\t/>\n\t\t\t<fn:if test="letterShowEmail">\n\t\t\t\t<span\n\t\t\t\t\tqa:id="name"\n\t\t\t\t\tbem:elem="name"\n\t\t\t\t\tfn:if="blockquote.email"\n\t\t\t\t>\n\t\t\t\t\t{blockquote.email}\n\t\t\t\t</span>\n\t\t\t\t<span\n\t\t\t\t\tqa:id="name"\n\t\t\t\t\tbem:elem="email"\n\t\t\t\t\tfn:if="blockquote.name"\n\t\t\t\t>\n\t\t\t\t\t(<bem:mod name="anonymous" test="blockquote.anonymous"/>{blockquote.name})\n\t\t\t\t</span>\n\t\t\t</fn:if>\n\t\t\t<fn:if test="!letterShowEmail">\n\t\t\t\t<span\n\t\t\t\t\tqa:id="name"\n\t\t\t\t\tbem:elem="name"\n\t\t\t\t\tfn:if="blockquote.name"\n\t\t\t\t>\n\t\t\t\t\t<bem:mod name="anonymous" test="blockquote.anonymous"/>{blockquote.name}\n\t\t\t\t</span>\n\t\t\t\t<span\n\t\t\t\t\tqa:id="email"\n\t\t\t\t\tbem:elem="email"\n\t\t\t\t\tfn:if="blockquote.email"\n\t\t\t\t>\n\t\t\t\t\t<fn:value mod="addBrackets">blockquote.email</fn:value>\n\t\t\t\t</span>\n\t\t\t</fn:if>\n\t\t\t<time bem:elem="time" qa:id="time">\n\t\t\t\t<fn:value mod="letterAttachLinkDate">blockquote.timestamp</fn:value>\n\t\t\t</time>\n\t\t</div>\n\t</fn:if>\n\n\t<div bem:elem="body" qa:id="body">\n\t\t<b:html-parser\n\t\t\tid="parser"\n\t\t\tcontent="{blockquote.body}"\n\t\t\tdarkosha="{attrs.darkosha}"\n\t\t\tmessage="{message}"\n\t\t\tremit:zoom="blockquote-zoom"\n\t\t/>\n\t</div>\n\n\t\x3c!-- Бордер --\x3e\n\t<b:delimeter/>\n</div>\n',"app/feast-tpl!ui-block/letter-blockquote/letter-blockquote.html")});define("feast-tpl!ui-block/letter-blockquote/letter-blockquote.html",["feast-tpl!app/feast-tpl!ui-block/letter-blockquote/letter-blockquote.html"],function(a){return a});define("ui-block/letter-blockquote/letter-blockquote",["exports","default-values","feast","feast-mod/letter-date","feast-tpl!./letter-blockquote.html","service/emoji","ui-block/delimeter/delimeter","ui-block/html-parser/html-parser"],function(exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var h=l(b);var i=l(d);var j=l(f);var k=l(g);function l(a){return a&&a.__esModule?a:{default:a}}exports.default=h.default.Block.extend({name:"letter-blockquote",template:i.default,defaults:{letterShowEmail:a.LETTER_SHOW_EMAIL,blockquote:{},index:0,ponymode:false,"dark-mode":false},blocks:{delimeter:j.default,"html-parser":k.default},mods:{letterAttachLinkDate:c.letterAttachLinkDate,addBrackets:function a(b){return"<"+b+">"}},didMount:function a(){this.rerender()},rerender:function a(){(0,e.emojiFallback)(this.el,"blq");this.ids.parser.rerender()}})});define("ui-block/letter-body/blockquote",["exports","feast-mod/avatar","service/radars/index","service/smokescreen"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}function f(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++){c[b]=a[b]}return c}else{return Array.from(a)}}var g=".mail-quote-collapse";var h=".mail-quote-collapse .mail-quote-collapse";var i='[data-type="body"]';var j='[data-type="sender"]';exports.default={findQuoteRoot:function a(b){var d=[].concat(f(b.querySelectorAll((0,c.selector)(g)))).filter(function(a){return!a.closest((0,c.selector)(h))});if(d.length>1){return null}return d[0]},split:function a(b,e){try{var f=false;var g=this.findQuoteRoot(b);if(!g){return{bodyEl:b,quoteEl:null,newQuotesFound:false}}var h=b.querySelector((0,c.selector)(i));var k=b.querySelector((0,c.selector)(j));if(h&&!h.children.length){(0,d.default)(["quotes","new","empty"])}if(h&&h.children.length&&k){f=true;g=document.createElement("div");g.appendChild(h);g.appendChild(k)}else{g.parentElement.removeChild(g)}return{bodyEl:b,quoteEl:g,newQuotesFound:f}}catch(a){b.innerHTML=e;(0,d.default)(["quotes","error","split"]);return{bodyEl:b,quoteEl:null,newQuotesFound:false}}},format:function b(d){return[].concat(f(d.querySelectorAll((0,c.selector)(i)))).reduceRight(function(b,e){var f=e.getAttribute("data-quote-id");var g=d.querySelector((0,c.selector)(j+'[data-quote-id="'+f+'"]'));var h="";var i="";var k="";var l="";var m=false;var n=false;var o=e.innerHTML;if(g){h=g.getAttribute("data-name");i=g.getAttribute("data-timestamp");k=g.getAttribute("data-email");l=(0,a.avatarUrl)(k,h,90)}if(i){m=true}if(!h&&!k){n=true;h=i18n("Аноним");l=""}if(g){g.parentNode.removeChild(g)}if(e.parentNode){e.parentNode.removeChild(e)}b.push({id:f,body:o,name:h,timestamp:i,email:k,avatar:l,anonymous:n,isSenderFully:m});return b},[]).reverse()},formatFallback:function a(b){b.style.display="";return b.outerHTML}}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/letter-body/letter-body",["require","exports","@mail-core/dashboard","@mail-core/logger","default-values","feast","feast-tpl!./letter-body.html","helpers/lazy","helpers/metrics/scores","helpers/perf","router","service/auth","service/emoji","service/radars/index","service/smokescreen","ui-block/button2/button2","ui-block/html-parser/html-parser","ui-block/letter-blockquote/letter-blockquote","../../lazy.modules","./blockquote"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockSpec=void 0;d=__importDefault(d);e=__importDefault(e);g=__importDefault(g);j=__importDefault(j);l=__importDefault(l);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);r=__importDefault(r);function s(a){return(0,q.lazyDomPurify)().then(function(b){return b.sanitize(a)})}exports.blockSpec={name:"letter-body",immutable:true,template:e.default,defaults:{bodyHtml:"","body-raw":"",collapsed:null,collapsable:true,"collapsed-default":null,"flags-threads":false,"features-blockquote":false,"features-blockquote-thread":false,id:null,ponymode:false,"quotes-formatted":[],"quotes-raw":"","quotes-mode-raw":true,"dark-mode":false,message:null,"current-user":null},notVisualAttributes:{bodyHtml:false},blocks:{button2:n.default,"html-parser":o.default,"letter-blockquote":p.default},events:{"blockquote:toggle":"onBlockquoteToggle","letter:zoom":"onLetterZoom"},attrChanged:{id:function(a,b){if(!a||!b||a===b){return}this.renderBody()}},didMount:function(){var a=this;this.renderBody().then((0,q.uniqCallback)(this,function(){a.asyncDidMountRender()}))},asyncDidMountRender:function(){var a=this;if(!this.isMounted()){return}var b=["reminder-created","reminder-remind","new-receipt","payed-receipt-succeed","sub-created"];b.forEach(function(b){__spreadArray([],a.el.querySelectorAll('[data-id="'.concat(b,'"]')),true).forEach(function(b){return a.$on(b,"click","handleClickMonetaLink")})});__spreadArray([],this.el.querySelectorAll("[data-moneta]"),true).forEach(function(b){return a.$on(b,"click","handleClickMonetaPayment")});this.highlightCurrentUserMention();__spreadArray([],this.el.querySelectorAll("[data-sig]"),true).forEach(function(b){a.$on(b,"click","handleClickFinePayment");a.$on(b,"contextmenu","handleClickRightFinePayment")});__spreadArray([],this.el.querySelectorAll('[data-id="tomyself"]'),true).forEach(function(b){return a.$on(b,"click","handleClickToMyself")});Object.entries(c.LETTER_BODY_POPUP_ALLOWED).forEach(function(b){var c=b[0],d=b[1];__spreadArray([],a.el.querySelectorAll(d.selector),true).forEach(function(b){return a.$on(b,"click",function(b){return a.handleClickAllowedAttr(b,d,c)})})});Object.entries(c.LETTER_DATA_WHITE_LIST).forEach(function(b){var c=b[0],d=b[1];var e=null;if(d.limit&&d.limit>1){e=Array.from(a.el.querySelectorAll(d.selector)).slice(0,d.limit)}else{e=[a.el.querySelector(d.selector)]}e.filter(Boolean).forEach(function(b){a.$on(b,"click",function(b){if(d.preventEvent){b.preventDefault();b.stopImmediatePropagation()}a.handelDataAttributeClick({event:b,params:d,type:c})})})})},handelDataAttributeClick:function(a){var b=a.event,c=a.params,d=a.type;var e=__assign(__assign({},c),{type:d});this.broadcast("data-attr-click",e,b)},didUpdate:function(a){if(this.get("dark-mode")!=a["dark-mode"]){this.applyDarkosha()}},didUnmount:function(){if(this._darkosha){this._darkosha.destroy()}},handleClickAllowedAttr:function(a,b,c){var d=__assign(__assign({},b),{skin:c});this.broadcast("allowedattrclick",d,a);(0,l.default)({type:"letter-body_payment-btn_click_".concat(b.radarName)})},handleClickRightFinePayment:function(a){this.broadcast("finepaymentright",this,a);(0,l.default)({type:"letter-body_payment-btn_rclk_finepayment_gd-exp"})},handleClickFinePayment:function(a){this.broadcast("finepayment",this,a);(0,l.default)({type:"letter-body_payment-btn_click_finepayment_gd-exp"})},handleClickToMyself:function(a){this.broadcast("tomyselfclick",this,a);(0,l.default)({type:"letter-body_myslf-btn_click"})},handleClickMonetaLink:function(a){var b=a.target.getAttribute("data-id");var c=a.target.getAttribute("data-selector");var d=c.split(":"),e=d[0],f=d[1];(0,l.default)({type:"moneta_click_".concat(b,"_").concat(e),dwh:{merchant:f}})},handleClickMonetaPayment:function(a){this.broadcast("monetapayment",this,a);(0,l.default)({type:"letter-body_payment-btn_click_moneta"})},getOrCreateDarkosha:function(){var a=this._createConfiguredDarkosha;if(!this._darkosha&&a){this._darkosha=a(this.el,this.is("dark-mode"))}return this._darkosha},applyDarkosha:function(a){if(a===void 0){a=false}if(a&&this._darkosha){this._darkosha.destroy();this._darkosha=undefined}var b=this.getOrCreateDarkosha();if(b){if(this.is("dark-mode")){b.transform()}else{b.rollback()}}},renderBody:function(){var d=this;var e=(0,i.getAppRouter)().previousRoute?"warm":"cold";a.userKeeper.time("letter-body-render");var j=document.createElement("div");var n=this.get("bodyHtml").replace(/<base .*?>/g,"");var o=n.length/1024;var p=o<=30?"less_30K":o<=100?"less_100K":o<=500?"less_500K":o<=1e3?"less_1M":"more_1M";var t=Promise.all([(0,q.lazyServiceDarkosha)().catch(function(a){(0,b.coreLoggerDispatchError)(a,null,"lazy-dark");return null}),(c.DOMPURIFY?s(n):Promise.resolve(n)).catch(function(a){(0,b.coreLoggerDispatchError)(a,null,"dom-sanitize");return n})]).then(function(a){var b=a[0],c=a[1];if(!d.isMounted()){return}d._createConfiguredDarkosha=b===null||b===void 0?void 0:b.createConfiguredDarkosha;j.innerHTML=c;var e=r.default.split(j),g=e.bodyEl,h=e.quoteEl,i=e.newQuotesFound;d.set("body-raw",g.innerHTML);d.rerenderParser("body-parser");if(h){var k=d.is("flags-threads");var n=d.is("features-blockquote")&&!k||d.is("features-blockquote-threads")&&k;d.el.classList.add((0,m.selector)(".letter-body_hidden").replace(".",""));return new Promise(function(a){(0,f.nextFrame)(function(){if(d.isMounted()){var b=i&&n;var c=b?"new":"old";(0,l.default)(["quotes","show",c]);d.format(c,h);d.el.classList.remove((0,m.selector)(".letter-body_hidden").replace(".",""))}d.broadcast("force-recalc");a()})})}else{d.broadcast("force-recalc")}}).catch(function(a){(0,b.coreLoggerDispatchError)(a,null,"letter-body")});t.then(function(){if(d.isMounted()){d.applyDarkosha()}(0,k.emojiFallback)(d.el,"ltr-body");(0,f.nextFrame)(function(){a.userKeeper.timeEnd("letter-body-render",{score:g.default["letter:render"],appendix:p});a.userKeeper.add("letter-ready",(0,h.getPerfRouterStartAt)(),undefined,{score:g.default["letter:ready"],appendix:e})})});return t},format:function(a,b){var c=false;if(a==="new"){try{c=this.formatNew(b)}catch(a){(0,l.default)(["quotes","error","format-new"]);c=this.formatFallback(b)}}else{c=this.formatFallback(b)}c&&this.triggerBlockquoteChange()},formatNew:function(a){var b=r.default.format(a);this.set({collapsable:this.is("flags-threads"),"quotes-mode-raw":false,"quotes-formatted":b});return b.length!==0},formatFallback:function(a){if(!a){return}var b=r.default.formatFallback(a);this.set({collapsable:this.is("flags-threads"),"quotes-mode-raw":true,"quotes-raw":b});this.rerenderParser("quote-parser");return b!==""},rerenderParser:function(a){try{this.ids[a].rerender()}catch(b){(0,l.default)(["letter-body","error",a])}},isCollapsed:function(){var a=this.get("collapsed");if(a==null){return this.is("collapsed-default")}return a},triggerBlockquoteChange:function(){this.broadcast("resize")},onBlockquoteToggle:function(){this.set("collapsed",!this.isCollapsed());this.triggerBlockquoteChange();this.applyDarkosha(true);if(!this.isCollapsed()){this.asyncDidMountRender()}},onLetterZoom:function(){this.broadcast("resize")},highlightCurrentUserMention:function(){var a=j.default.user.getEmail();this.el.querySelectorAll("a[data-mention]").forEach(function(b){if(b.dataset.mentionEmail===a){b.classList.add("highlighted");b.setAttribute("data-test-highlighted","true")}})}};exports.default=d.default.Block.extend(exports.blockSpec)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/todo-manager/todo-manager",["require","exports","data-source/actions","data-source/data-source","data-source/source/ui-layout","default-values","feast","helpers/data-source-dispatch","helpers/opener","pilotjs","service/auth","ui-block/settings-dock/settings-dock","./consts"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TodoManager=exports.canTodoBeShown=exports.FROM_TODO_READY=void 0;b=__importDefault(b);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);var l="todo:start";exports.FROM_TODO_READY="todo:ready";var m="todo:open";function n(a){var b=a===null||a===void 0?void 0:a.route;return b&&!b.is("#search")&&!b.is("#search-letter")}exports.canTodoBeShown=n;var o=function(e){__extends(o,e);function o(){return e!==null&&e.apply(this,arguments)||this}o.prototype.getComponentsSpec=function(){return{router:{class:h.default,events:["routeend"]},"settings-dock":{class:j.default,attrs:{canToggleTodo:function(a){return a.canToggleTodo()},todo:function(a){return a.isActive()}},events:[k.TODO_TOGGLE]},ToDoIframe:{events:[k.TODO_IFRAME_MESSAGE]},WidgetColumn:{events:[k.WIDGET_COLUMN_UNMOUNT,k.WIDGET_COLUMN_SET_WIDGET]},dataSource:{class:b.default,events:[k.DATA_SOURCE_ACTIONED]}}};o.prototype.handleEvent=function(a){switch(a.type){case k.TODO_TOGGLE:return this.toggleTodo();case k.TODO_IFRAME_MESSAGE:return this.handlePostMessage(a);case k.WIDGET_COLUMN_SET_WIDGET:return this.setWidget(a.details.value)}};o.prototype.handlePostMessage=function(a){var b,c;if(!((c=(b=a===null||a===void 0?void 0:a.details)===null||b===void 0?void 0:b.data)===null||c===void 0?void 0:c.type)){return false}var d=a.details.data;switch(d.type){case l:return this.sendMessageToTodo(a,{type:"todo:email",email:i.default.user.getEmail()});case m:return this.openTodo(d)}};o.prototype.openTodo=function(a){(0,g.default)("".concat(d.TODO_URL).concat(a.path||""));return false};o.prototype.sendMessageToTodo=function(a,b){a.details.data.sendAns(b);return false};o.prototype.canToggleTodo=function(){return!d.WIDGET_COLUMN&&d.SHOW_TODO_TOGGLE&&d.HIDE_TOYS===d.BL_PROP_NAME&&n(this.get("router"))&&this.isSupportTodo()};o.prototype.getUILayout=function(){return this.get("router.model.uiLayout")||c.defaults};o.prototype.isActive=function(){return this.getUILayout().widget==="widget-todo"&&this.getUILayout().widgetIsOpen};o.prototype.isSupportTodo=function(){return this.getUILayout().supportWidget};o.prototype.toggleTodo=function(){(0,f.default)({type:a.TOGGLE_TODO,uid:undefined});return false};o.prototype.setWidget=function(b){(0,f.default)({type:a.SET_WIDGET,uid:undefined,value:b});return false};return o}(e.default.Mediator);exports.TodoManager=o;exports.default=e.default.Mediator.createFromClass("todo-manager",o)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/layout-manager",["require","exports","@mail/flags","@mail/xray","data-source/actions","data-source/data-source","data-source/index","data-source/source/ui-layout","default-values","feast","helpers/data-source-dispatch","helpers/dividerInserters","mediator/layout-manager/utils","mediator/swipe-manager","mqmatch","pilotjs","service/adv/index","service/getModule","service/promo","service/radars/index","service/storage","service/vkMessengerLoader","ui-block/ad-feedback/ad-feedback","ui-block/application-mail/application-mail","ui-block/attach-list/attach-list","ui-block/contextmenu-folder/contextmenu-folder","ui-block/contextmenu-message/contextmenu-message","ui-block/discounts/discounts","ui-block/dropdown-actions/dropdown-actions","ui-block/filters/filters","ui-block/headline/headline","ui-block/layer-confirm-clear-folder/layer-confirm-clear-folder","ui-block/layer-window/layer-window","ui-block/layout/layout","ui-block/letter-body/letter-body","ui-block/letter-swipe-actions/letter-swipe-actions","ui-block/list-letter-common/list-letter-common","ui-block/list-letter-compact/list-letter-compact","ui-block/list-letter-tip/list-letter-tip","ui-block/list-letter-welcome/list-letter-welcome","ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions","ui-block/metathread/metathread","ui-block/metathread-footer/metathread-footer","ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded","ui-block/noads-button/noads-button","ui-block/octopus/octopus","ui-block/paginator-container/paginator-container","ui-block/portal-menu/portal-menu","ui-block/promo-block-letter/promo-block-letter","ui-block/renovator/renovator","ui-block/search-panel/search-panel","ui-block/settings/settings","ui-block/settings-dock/settings-dock","ui-block/sidebar-folders/sidebar-folders","ui-block/slot/slot","ui-block/thread/thread","utils/util","../lazy.modules","./layout-manager/vars","./todo-manager/consts","./todo-manager/todo-manager"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba,ca,da,ea,fa){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.layoutManager=exports.getColumnContentWidth=void 0;a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);h=__importDefault(h);i=__importDefault(i);l=__importDefault(l);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importStar(F);G=__importDefault(G);H=__importDefault(H);I=__importDefault(I);J=__importDefault(J);K=__importDefault(K);L=__importDefault(L);M=__importDefault(M);N=__importDefault(N);O=__importDefault(O);P=__importDefault(P);Q=__importDefault(Q);R=__importDefault(R);S=__importDefault(S);T=__importDefault(T);U=__importDefault(U);V=__importDefault(V);W=__importDefault(W);X=__importDefault(X);Y=__importDefault(Y);Z=__importDefault(Z);_=__importDefault(_);aa=__importDefault(aa);ba=__importDefault(ba);var ga="(min-width: 1200px) and (max-width: 1260px) and (min-height: 800px)";var ha=(0,m.createMediaQueryMatch)();var ia=true;var ja=false;var ka=15;var la=13;var ma=0;var na=58;var oa=58;var pa=68;var qa=63;var ra=70;var sa=da.columnSidebarM;var ta=da.columnSidebarXl;var ua=60;var va=function(a){var b=40;if(g.ADV_SIDEBAR_160_ALWAYS||g.ADV_SIDEBAR_160_ON_WIDTH_1800&&a<1800||g.ADV_SIDEBAR_160_ON_WIDTH_1420&&a<1420){return b}return ua};var wa=4;var xa=8;var ya=80;var za=2;var Aa=2;var Ba=function(){var a=document.documentElement.style;a.setProperty("--column-right-with-widget",wa*ya+"px");a.setProperty("--column-right-space-left",wa*za+"px");a.setProperty("--column-right-space-right",wa*Aa+"px")};Ba();var Ca="octavius-custom-layout";function Da(a,b){if(g.NEW_TOOLBAR){return a._getColumnRight()}return b.get("id")==="portal"?a._getDefaultColumnRight():a.columnRight}function Ea(a){return wa*a}exports.getColumnContentWidth=Ea;function Fa(a){return Ea(a)}function Ga(a){if(a===0){return 0}return a*wa+xa}function Ha(a){var b=document.createElement("div");try{for(var c=0,d=a;c<d.length;c++){var e=d[c];b.style.display=e;if(b.style.display===e){return{value:e,error:""}}}}catch(a){return{value:"",error:a}}return{value:"",error:""}}var Ia=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--vkui--octavius_size_layout_width_min--regular"))||0;var Ja=g.SHOW_TODO_TOGGLE||g.WIDGET_CALENDAR;var Ka=window.matchMedia("(orientation: landscape)");var La=function(h){__extends(m,h);function m(){var d=h.call(this)||this;d.size="m";d.verticalSize="m";d.maxWidth=1260;d.adv160ColumnRight=undefined;d.adv160ColumnRight3pane=undefined;d.columnRight=ua;d.defaultColumnRight=ua;d.columnSidebar=ra;d.columnRightSidebar=false;d.support3pane=true;d.supportWidget=false;d.supportSticky=true;d.supportHeadline=true;d.supportComposeExtend=true;d.paymentDieWithIndentOn3Pane=false;d.searchSuggestCount=5;d.forceShortcuts=false;d.performanceTrace="track";d.updateCustomColumnsDebounced=ba.default.debounce(d.updateCustomColumns,g.RESIZE_UPDATE_DEBOUNCE_TIME,d);d._createMedia();d._registerQueries();window.addEventListener("resize",d.updateCustomColumnsDebounced.bind(d,true));d.updateAll();var f=Ha(["-ms-grid","grid"]);if(!f.value){b.default.send("no-grid-support",g.NO_CSS_GRID_LOG_KAKTAM&&{rlog:"octavius-no-grid-support",rlog_message:{"octavius-no-grid-support":true,error:f.error}})}e.default.one("actionend",function(){var b=a.default.get("octavius");var e=a.default.get("ignore-ponymode-experiment");var f=b&&b.isActive()&&b.getCount("show");var g=d.getUiLayout();var h=g.ponyMode;if(e&&e.state){return}if(!f){return}if(h){e.save({state:true});return}if(d.maxWidth>1420){e.save({state:true});return}(0,i.default)({type:c.TOGGLE_PONY_MODE,uid:undefined});e.save({state:true});(0,r.default)("force_ponymode")});d.getType()==="2pane"?o.default.setActiveListPlacement("list2pane"):o.default.setActiveListPlacement("list3pane");return d}m.prototype.getComponentsSpec=function(){var a=this;return{router:{class:n.default,events:["route"]},layout:{class:F.default,attrs:{type:function(a){return a.getType()},size:function(a){return a.size},mobile:function(a){return a.isLessThen("xs")},isMoreThen:function(a){return a.isMoreThen},isLessThen:function(a){return a.isLessThen},"left-column":function(a){return a.getLeftColumn()},"right-column":function(a,b){return Da(a,b)},"sidebar-column":function(a){return a.getSidebarColumn()},"support-compose-extend":function(a){return a.supportComposeExtend},showWidget:function(a){return a.showWidget()},showWidgetColumn:function(a){return a.showWidgetColumn()},"is-shortcut-left":function(a){return a.getLeftColumn()<=g.SHORTCUT_LEFT_COLUMN_LIMIT},"max-width":function(){return g.MAX_LAYOUT_WIDTH},"is-advert-scroll":function(){return g.ADVERT_SCROLL}},events:[F.LayoutEvents.LayoutResize],handleEvent:"handleLayoutEvent"},"application-mail":{class:v.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}},WidgetColumn:{attrs:{showWidgetColumn:function(a){return a.showWidgetColumn()},widgetIsOpen:function(a){return a.widgetIsOpen()},widgetType:function(a){return a.widgetType()}},events:[ea.TODO_TOGGLE]},"portal-menu":{class:T.default,attrs:{layoutType:function(a){return a.getType()},"small-search":function(a){return a.isLessThen("s")},mobile:function(a){return a.isLessThen("xs")},"search-column":function(a){return Fa(a._getDefaultColumnRight())},"right-column":function(a){return a._getColumnRight()},"main-column":function(a){return a.getMainColumn()}}},"settings-dock":{class:Y.default,events:["layout:toggle","shortcuts:toggle","lettersdividers:toggle"],attrs:{type:function(a){return a.getType()},support3pane:function(a){return a.support3pane},"can-toggle-shortcuts":function(a){return a.canToggleShortcuts()},"manual-shortcuts":function(a){return a.getUiLayout().manualShortcuts},"can-toggle-letters-dividers":function(){return g.ENABLE_LETTERS_LIST_DIVIDER_SWITCHER&&g.ENABLE_LETTERS_DIVIDERS},"letters-dividers-enabled":function(a){return a.isLettersListDividersEnabled()}}},settings:{class:X.default,events:["layout:toggle","shortcuts:toggle",ea.TODO_TOGGLE],attrs:{type:function(a){return a.getType()},support3pane:function(a){return a.support3pane},"can-toggle-shortcuts":function(a){return a.canToggleShortcuts()},"manual-shortcuts":function(a){return a.getUiLayout().manualShortcuts}}},filters:{class:B.default,events:["layout:toggle","shortcuts:toggle"],attrs:{type:function(a){return a.getType()},support3pane:function(a){return a.support3pane},"sidebar-column":function(a){return a.getSidebarColumn()},"can-toggle-shortcuts":function(a){return a.canToggleShortcuts()},"manual-shortcuts":function(a){return a.getUiLayout().manualShortcuts}}},headline:{class:C.default,attrs:{enabled:function(a){return a.supportHeadline}}},letter:{lazy:ca.lazyUILetter,attrs:{"sticky-reduce-all-texts":function(a){return a.getMainColumn()<200},"sticky-reduce-one-text":function(a){return a.getMainColumn()<230},"sticky-reduce-reply":function(a){return g.NEW_LETTER_LIST&&a.getMainColumn()<160},"sticky-position":function(a){var b={};var c=1;var d=8;var e=a.columnRight*wa+d;var f=a.getLeftColumn()*wa+c;if(a.getType()==="3pane"){f=(a.getLeftColumn()+a.getSidebarColumn())*wa+c}if(a.maxWidth>g.MAX_LAYOUT_WIDTH){b.maxWidth=g.MAX_LAYOUT_WIDTH-f-e}b.left=f;b.right=e;return b},mobile:function(a){return a.isLessThen("xs")}}},"letter-swipe-actions":{class:H.default,attrs:{"layout-size":function(a){return a.size},"layout-type":function(a){return a.getType()}}},"metathread-head-compact-expanded":{class:P.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}},"layer-confirm-clear-folder":{class:D.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}},"layer-window":{class:E.default,attrs:{mobile:function(a){return a.isLessThen("xs")},slim:function(a){return a.isLessThen("s")}}},"layer-sent-page":{attrs:{slim:function(a){return a.isLessThen("s")}}},"letter-body":{class:G.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}},"list-letter-tip":{class:K.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}},"list-letter-compact":{class:J.default,attrs:{"payment-die-with-indent":function(a){return a.paymentDieWithIndentOn3Pane},"layout-type":function(a){return a.getType()}}},"list-letter-common":{class:I.default,attrs:{"layout-type":function(a){return a.getType()}}},metathread:{class:N.default,attrs:{"short-text":function(a){return a.isLessThen("m")},"short-dropdown":function(a){return a.isShortColumn()}}},"dropdown-actions":{class:A.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}},"context-menu":{class:x.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}},octopus:{class:R.default,attrs:{isHorizontal:function(a){return a.isHorizontal()},mobile:function(a){return a.isLessThen("xs")},is3Pane:function(a){return a.getType()==="3pane"}}},"metathread-footer":{class:O.default,attrs:{"short-text":function(a){return a.isShortColumn()}}},"attach-list":{class:w.default,attrs:{"save-to-cloud":function(a){return a.isMoreThen("xxs")},mobile:function(a){return a.isLessThen("xs")}}},"search-panel":{class:W.default,attrs:{leftColumn:function(a){return a.getLeftColumn()},rightColumn:function(a){return Fa(a._getDefaultColumnRight())},layoutType:function(a){return a.getType()},size:function(a){return a.size},maxWidth:function(){return g.MAX_LAYOUT_WIDTH},onlyIcon:function(a){return a.isLessThen("s")}}},slot:{class:_.default,attrs:{"right-column":function(a){return Ea(a.columnRight)}}},"noads-button":{class:Q.default,attrs:{isSmallAdvColumnRight:function(b){return g.ADV_160_ON_SMALL_WIDTH?b.columnRight===a._getAdv160ColumnRight():false},"right-column":function(a){return Ea(a.columnRight)}}},"ad-feedback":{class:u.default,attrs:{"right-column":function(a){return Ea(a.columnRight)}}},thread:{class:aa.default,attrs:{"sticky-disabled":function(a){return!a.supportSticky},mobile:function(a){return a.isLessThen("xs")}}},"promo-block-letter":{class:U.default,attrs:{support3pane:function(a){return a.support3pane}}},"list-letter-welcome":{class:L.default,attrs:{type:function(a){return a.getType()},ponyMode:function(a){return a.getUiLayout().ponyMode}}},"list-letter-welcome-suggestions":{class:M.default,attrs:{ponyMode:function(a){return a.getUiLayout().ponyMode}}},"sidebar-folders":{class:Z.default,attrs:{size:function(a){return a.size},layoutType:function(a){return a.getType()}}},"paginator-container":{class:S.default,attrs:{type:function(a){return a.getType()},"right-column":function(a){return Ga(a._getColumnRight())},"left-column":function(a){return Ga(a._getColumnLeft())},"sidebar-column":function(a){return a.getSidebarColumn()*wa},"max-breakpoint":function(a){return a.maxBreakpoint},"right-offset":function(a){return a._getRightOffset()}}},renovator:{class:V.default,attrs:{type:function(a){return a.getType()}}},discounts:{class:z.default,attrs:{width:function(a){if(a.getType()==="3pane"&&a.getSidebarColumn()<da.columnSidebarM){return"small"}return"default"}}},"vk-messenger-provider":{attrs:{offset:function(a){return Ga(a._getColumnRight())}}},"vkui-overlay-modals":{attrs:{mobile:function(a){return a.isLessThen("xs")}}},"data-source":{class:d.default,events:["actionend"]},"contextmenu-message":{class:y.default,attrs:{mobile:function(a){return a.isLessThen("xs")}}}}};m.prototype.isVertical=function(a){return a===this.verticalSize};m.prototype.isHorizontal=function(){return Ka.matches};m.prototype.isShortColumn=function(){return this.getSidebarColumn()===ra&&this.getType()==="3pane"};m.prototype.isMoreThen=function(a){return da.sizes.indexOf(this.size)>da.sizes.indexOf(a)};m.prototype.isLessThen=function(a){return da.sizes.indexOf(this.size)<da.sizes.indexOf(a)};m.prototype.getLeftColumn=function(){var a,b;var c="main";return(b=(a=this.customLayout[c])===null||a===void 0?void 0:a.left)!==null&&b!==void 0?b:this.columnLeft};m.prototype.getSidebarColumn=function(){var a,b;var c="main";return(b=(a=this.customLayout[c])===null||a===void 0?void 0:a.sidebar)!==null&&b!==void 0?b:this.columnSidebar};m.prototype.getMainColumn=function(){if(this.getType()==="3pane"){return this.getCurrentLayoutWidth()-this.getSidebarColumn()-this.getLeftColumn()-this.columnRight}else{return this.getCurrentLayoutWidth()-this.getLeftColumn()-this.columnRight}};m.prototype.canToggleShortcuts=function(){return!this.forceShortcuts&&!g.USER_LAYOUT_RESIZE};m.prototype.getType=function(){return this.getUiLayout().type==="3pane"&&this.support3pane?"3pane":"2pane"};m.prototype._getAdv160ColumnRight=function(){if(this.adv160ColumnRight!==undefined){return this.adv160ColumnRight}return this.getType()==="3pane"?this.adv160ColumnRight3pane:undefined};m.prototype._getDefaultColumnRight=function(){if(g.ADV_160_ON_SMALL_WIDTH){var a=this._getAdv160ColumnRight();if(a){return a}}return this.defaultColumnRight};m.prototype._getColumnRight=function(){var a=this._getDefaultColumnRight();if(this.showWidgetColumn()){return za+(this.widgetIsOpen()?ya+Aa:0)}if(this.showWidget()){return a}if(g.HIDE_TOYS===g.BL_PROP_NAME){return 0}return a};m.prototype.hideAds=function(){return g.HIDE_TOYS===g.BL_PROP_NAME};m.prototype.canShowWidget=function(){return Ja&&g.HIDE_TOYS===g.BL_PROP_NAME&&this.supportWidget&&(0,fa.canTodoBeShown)(this.get("router"))};m.prototype.canShowTodo=function(){return g.SHOW_TODO_TOGGLE&&this.canShowWidget()};m.prototype.showWidget=function(){return this.getUiLayout().widgetIsOpen&&this.canShowWidget()};m.prototype.widgetType=function(){return this.getUiLayout().widget};m.prototype.widgetIsOpen=function(){return g.HIDE_TOYS===g.BL_PROP_NAME&&this.getUiLayout().widgetIsOpen};m.prototype.showWidgetColumn=function(){return g.WIDGET_COLUMN&&this.canShowWidget()};m.prototype.handleMedia=function(a){var b=this;a=a===void 0?this._query:this._query=a;this.updateQuery(a);if(!ia){Promise.all([(0,i.default)({type:c.UPDATE_LAYOUT_SUPPORT_3_PANE,value:this.support3pane,uid:undefined},{waitForAppLoad:true}),(0,i.default)({type:c.UPDATE_LAYOUT_SUPPORT_TODO,value:this.supportWidget,uid:undefined},{waitForAppLoad:true})]).then(function(){b.updateAll()});return}(0,f.changeSupport3Pane)(this.support3pane);(0,f.changeSupportTodo)(this.supportWidget);ia=false;this.updateCustomColumnsDebounced(true);this.updateAll()};m.prototype._logMediaQueryRace=function(a){var c;ja=true;b.default.send("media-query-race",{i:(c={},c[a]=1,c)});var d=g.MATCH_MEDIA_LOG?JSON.stringify({queries:ha.getCurrentSnapshot(),width:window.innerWidth,height:window.innerHeight}):"nolog";(0,p.default)("trackJS").then(function(b){return b.addErrorFromApp(new Error("media-query-race: "+a+", "+d),"media-query-race")})};m.prototype.updateQuery=function(a){var c=this;if(!this.media){this._logMediaQueryRace("nomedia");this._createMedia();this._registerQueries();return}var d=this.media[a];if(!d){this._logMediaQueryRace("noeffects");if(this.media[ga]){this.updateQuery(ga)}return}if(ja){ja=false;b.default.send("media-query-race",{i:{ok:1}})}var e=d.size;var f=this.size;if(e&&f&&e!==f){(0,r.default)(["on_layout_resize",e])}if(!f){(0,r.default)(["user_visit_size",e]);if(d.maxBreakpoint){(0,r.default)(["user_visit_size_max"])}}this.support3pane=d.support3pane;this.supportWidget=d.supportWidget;this.mediaKeys.forEach(function(a){var b=d[a];if(!(b instanceof Function)){c[a]=b}});var g=["forceShortcuts"];g.forEach(function(a){var b=d[a];c[a]=b instanceof Function?b(c):b});this.mediaKeys.forEach(function(a){var b=d[a];if(b instanceof Function&&!g.includes(a)){c[a]=b(c)}});if((f==="xs"||f==="xxs")&&"_timers"in window){delete window._timers.ready_app}this.updateCustomColumns()};m.prototype.setLayout=function(a){var b=this;if(!(a==="2pane"||a==="3pane")){return}a==="2pane"?o.default.setActiveListPlacement("list2pane"):o.default.setActiveListPlacement("list3pane");(0,r.default)(["on_layout_change",a]);(0,i.default)({type:c.UPDATE_LAYOUT_TYPE,value:a,uid:undefined}).then(function(){b.handleMedia();q.default.update()})};m.prototype.handleEvent=function(a){var d=this;var f=a.type;var g=a.details;var h=g&&g.from;switch(f){case"layout:toggle":{var k=this.getUiLayout();var l=k.type;var m=l==="3pane"?"2pane":"3pane";(0,r.default)({type:"toggle-layout-".concat(m),intervals:[["".concat(h),1]]});this.setLayout(m);return false}case"shortcuts:toggle":{var o=!this.get("router.model.uiLayout").manualShortcuts;(0,r.default)({type:"toggle-shortcuts-".concat(o?"on":"off"),intervals:[["".concat(h),1]]});(0,i.default)({type:c.TOGGLE_FOLDER_SHORTCUTS,uid:undefined}).then(function(){d.handleMedia();q.default.update()});return false}case"route":{this.updateQuery(this._query);return false}case"actionend":return this.onDataSourceActionEnd(a);case"lettersdividers:toggle":var p=!this.isLettersListDividersEnabled();(0,j.setDividersEnabled)(p).then(function(){e.default.dispatch({type:c.TOGGLE_LETTERS_LIST_DIVIDERS,priority:n.default.Loader.PRIORITY_LOW});b.default.send("letters-dividers-".concat(p?"on":"off"))});break}};m.prototype.isLettersListDividersEnabled=function(){return g.ENABLE_LETTERS_DIVIDERS&&(0,j.getDividersEnabled)()};m.prototype.getCurrentLayoutWidth=function(){var a=(0,k.clamp)(Ia,window.innerWidth,g.MAX_LAYOUT_WIDTH);return a/wa};m.prototype.storeLayoutWidth=function(a){this.layout["main"]=a;if(g.USER_LAYOUT_SAVE_TO_STORAGE){s.default.set(Ca,__assign(__assign({},s.default.get(Ca)),this.layout))}this.customLayout["main"]=a};m.prototype.getLayouts=function(a){var b=a===void 0?{}:a,c=b.id;return this.getList("layout").filter(function(a){return c==null||a.get("id")===c})};m.prototype.applyLayoutWidth=function(a,b){var c=b.storeValue,d=b.showResizeState,e=b.onlyId;this.customLayout["main"]=a;this.columnLeft=a.left;var f=this.getLayouts({id:e});f.forEach(function(b){b.onResize(a,d)});if(c){this.storeLayoutWidth(a)}};m.prototype.updateCustomColumns=function(a){if(a===void 0){a=false}l.default.reset();if(this.layout["main"]){this.updateCustomColumn(this.layout["main"])}if(a){this.updateAll()}};m.prototype.getSizeLimits=function(){var a=k.defaultMinSizes.left;if(g.DISABLE_LEFT_COLUMN&&this.isLessThen("xs")){a=ma}else if(this.getUiLayout().ponyMode){a=la}return{min:__assign(__assign({},k.defaultMinSizes),{left:a}),max:k.defaultMaxSizes}};m.prototype.updateCustomColumn=function(a,b){var c=b===void 0?{}:b,d=c.storeValue,e=d===void 0?false:d,f=c.snapToRecommendedSize,h=f===void 0?true:f,i=c.showResizeState,j=i===void 0?false:i,l=c.shouldUpdate,m=c.onlyId;var n=this.getSizeLimits(),o=n.min,p=n.max;var q={left:this.getLeftColumn(),sidebar:this.getSidebarColumn()};var r={left:a.left||this.getLeftColumn(),sidebar:a.sidebar||this.getSidebarColumn()};var s={minSizes:__assign(__assign({},o),{right:this.columnRight}),maxSizes:__assign(__assign({},p),{right:this.columnRight})};var t=this.getType()==="3pane";var u=t?k.limitWidths3pane:k.limitWidths2pane;var v=u(r,this.getCurrentLayoutWidth(),s);if(h){v.left=(0,k.transformSizes)(v,{left:function(a){return(0,k.snapToMinSize)(a,g.SHORTCUT_LEFT_COLUMN_LIMIT,o.left)}},this.getType()).left}if(l&&!l(q,v)){return}this.applyLayoutWidth(t?(0,k.pick)(v,["left","sidebar"]):(0,k.pick)(v,["left"]),{storeValue:e,showResizeState:j,onlyId:m})};m.prototype.handleLayoutEvent=function(a){var c;switch(a.type){case F.LayoutEvents.LayoutResize:{var d=a.details;var e=d.width/wa;this.updateCustomColumn((c={},c[d.column]=e,c),{storeValue:true,snapToRecommendedSize:d.resizeEnd,showResizeState:!d.resizeEnd,shouldUpdate:function(a,b){if(d.column==="sidebar"&&b.left<a.left){return false}if(d.column==="sidebar"&&e>a.sidebar&&b.sidebar<a.sidebar){return false}return true}});if(d.resizeEnd){this.getLayouts().forEach(function(a){a.onResizeEnd()});if(g.USER_LAYOUT_ENABLE_METRICS){b.default.send("resize_layout_column_".concat(d.column))}}return d.resizeEnd}}return false};m.prototype.onDataSourceActionEnd=function(a){var b=a.details;switch(b.action.type){case c.SET_WIDGET:case c.TOGGLE_TODO:this.handleMedia();return true}return false};m.prototype._registerQueries=function(){var a=this;Object.keys(this.media).forEach(function(a){ha.register(a,"screen and "+a)});var b=function(b){var c=b.filter(function(b){return a.media[b]});a.handleMedia(c[0])};b(ha.getCurrentMatches());ha.on("change",b)};m.prototype.getUiLayout=function(){return this.get("router.model.uiLayout")||f.defaults};m.prototype.shortcutsEnabled=function(a){return this.forceShortcuts&&!a||this.getUiLayout().manualShortcuts};m.prototype._getShortColumnLeft=function(){var a=this.getUiLayout();if(a.ponyMode){return la}return ka};m.prototype._getColumnLeft=function(){var a=this.get("router.route");var b=!a||a.is("#search");var c=this.getUiLayout();if(g.DISABLE_LEFT_COLUMN&&this.isLessThen("xs")){return ma}if(this.shortcutsEnabled(b)){return this._getShortColumnLeft()}if(c.ponyMode){return oa}return na};m.prototype._getRightOffset=function(){return t.vkMessengerLoader.isOpen()?72:8};m.prototype._createMedia=function(){var a;var b=this;if(this.media){return}this.layout=g.USER_LAYOUT_SAVE_TO_STORAGE?s.default.get(Ca)||{}:{};this.customLayout={};var c=this._getColumnLeft.bind(this);var d=this._getColumnRight.bind(this);var e=(a={},a["(max-width: ".concat(g.XXS_BREAKPOINT,"px)")]={size:g.ENABLE_XXS_BREAKPOINT?"xxs":"xs",maxWidth:g.XXS_BREAKPOINT,columnLeft:c,columnRight:d,defaultColumnRight:0,columnRightSidebar:true,support3pane:false,supportWidget:false,supportSticky:false,supportHeadline:true,supportComposeExtend:false,forceShortcuts:true,searchSuggestCount:3},a["(min-width: ".concat(g.XXS_BREAKPOINT,"px) and (max-width: 960px)")]={size:"xs",maxWidth:960,columnLeft:c,columnRight:d,defaultColumnRight:0,columnRightSidebar:true,support3pane:false,supportWidget:false,supportSticky:true,supportHeadline:true,supportComposeExtend:false,forceShortcuts:true,searchSuggestCount:3},a["(min-width: 960px) and (max-width: 1140px)"]={size:"s",maxWidth:1200,columnLeft:c,columnRight:d,adv160ColumnRight:40,defaultColumnRight:va(960),columnRightSidebar:false,support3pane:false,supportWidget:false,supportSticky:true,supportHeadline:true,supportComposeExtend:false,forceShortcuts:true,searchSuggestCount:3},a["(min-width: 1140px) and (max-width: 1200px)"]={size:"s",maxWidth:1200,columnLeft:c,columnRight:d,adv160ColumnRight:40,defaultColumnRight:va(1140),columnRightSidebar:false,support3pane:false,supportWidget:false,supportSticky:true,supportHeadline:true,supportComposeExtend:true,forceShortcuts:true,searchSuggestCount:5},a["(min-width: 1200px) and (max-width: 1260px)"]={size:"m",maxWidth:1260,columnLeft:c,columnRight:d,adv160ColumnRight:40,defaultColumnRight:va(1200),columnSidebar:ra,columnRightSidebar:false,support3pane:true,supportWidget:false,supportSticky:true,supportHeadline:true,supportComposeExtend:true,paymentDieWithIndentOn3Pane:false,searchSuggestCount:5,forceShortcuts:function(a){return a.getType()==="3pane"}},a["(min-width: 1260px) and (max-width: 1420px)"]={size:"m",maxWidth:1420,columnLeft:c,columnRight:d,adv160ColumnRight3pane:40,defaultColumnRight:va(1260),columnSidebar:sa,columnRightSidebar:false,support3pane:true,supportWidget:function(a){return a.getType()!=="3pane"},supportSticky:true,supportHeadline:true,supportComposeExtend:true,paymentDieWithIndentOn3Pane:true,searchSuggestCount:5,forceShortcuts:function(a){return a.getType()==="3pane"}},a["(min-width: 1420px) and (max-width: 1600px)"]={size:"l",maxWidth:1600,columnLeft:c,columnRight:d,defaultColumnRight:va(1420),columnSidebar:sa,columnRightSidebar:false,support3pane:true,supportWidget:true,supportSticky:true,supportHeadline:true,supportComposeExtend:true,paymentDieWithIndentOn3Pane:true,searchSuggestCount:5},a["(min-width: 1600px) and (max-width: 1800px)"]={size:"l",maxWidth:1800,columnLeft:c,columnRight:d,defaultColumnRight:va(1600),columnSidebar:sa,columnRightSidebar:false,support3pane:true,supportWidget:true,supportSticky:true,supportHeadline:true,supportComposeExtend:true,paymentDieWithIndentOn3Pane:true,searchSuggestCount:5},a["(min-width: 1800px) and (max-width: 1920px)"]={size:"xl",maxWidth:1920,columnLeft:function(a){var c=b.getUiLayout();if(b.shortcutsEnabled()){return b._getColumnLeft()}if(c.ponyMode){return a.getType()==="3pane"?oa:qa}return a.getType()==="3pane"?na:pa},columnRight:d,defaultColumnRight:va(1800),columnSidebar:ta,columnRightSidebar:false,support3pane:true,supportSticky:true,supportWidget:true,supportHeadline:true,supportComposeExtend:true,paymentDieWithIndentOn3Pane:true,searchSuggestCount:5},a["(min-width: 1920px) and (max-width: ".concat(g.MAX_LAYOUT_WIDTH,"px)")]={size:"xxl",maxWidth:g.MAX_LAYOUT_WIDTH,columnLeft:function(){var a=b.getUiLayout();if(b.shortcutsEnabled()){return b._getColumnLeft()}if(a.ponyMode){return qa}return pa},columnRight:d,defaultColumnRight:va(1920),columnSidebar:100,columnRightSidebar:false,support3pane:true,supportWidget:true,supportSticky:true,supportHeadline:true,supportComposeExtend:true,searchSuggestCount:5},a["(min-width: ".concat(g.MAX_LAYOUT_WIDTH,"px)")]={size:"xxl",maxBreakpoint:true,maxWidth:Infinity,columnLeft:function(){var a=b.getUiLayout();if(b.shortcutsEnabled()){return b._getColumnLeft()}if(a.ponyMode){return qa}return pa},columnRight:d,defaultColumnRight:va(g.MAX_LAYOUT_WIDTH),columnSidebar:ta,columnRightSidebar:false,support3pane:true,supportWidget:true,supportSticky:true,supportHeadline:true,supportComposeExtend:true,paymentDieWithIndentOn3Pane:true,searchSuggestCount:5},a);var f={"(max-height: 670px)":{verticalSize:"s",searchSuggestCount:3},"(min-height: 670px) and (max-height: 800px)":{verticalSize:"l",searchSuggestCount:3},"(min-height: 800px)":{verticalSize:"l",searchSuggestCount:5}};var h={};function i(a){return new Set(Object.values(a).flatMap(Object.keys))}var j=i(e);i(f).forEach(function(a){j.add(a)});Object.keys(e).forEach(function(a){Object.keys(f).forEach(function(b){h["".concat(a," and ").concat(b)]=Object.assign({},e[a],f[b])})});this.media=h;this.mediaKeys=j};return m}(h.default.Mediator);exports.layoutManager=h.default.Mediator.createFromClass("layout-manager",La);exports.default=exports.layoutManager});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/compose",["require","exports","data-source/index","default-values","helpers/create-message-form-data","helpers/signature","logger","mail/Message","mediator/layout-manager","service/radars/index"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);var i=e.default.getScope("compose.mail.ru");var j;var k;var l;function m(){if(!b.RENDER_COMPOSE_TO_BODY_START){return document.body}var a=document.createElement("div");var c=document.body;var d=c.firstChild;if(d){c.insertBefore(a,d)}else{c.appendChild(a)}return a}function n(a,b,c){k=new a({items:[],router:app,layout:g.default});b.register(k);c.register(k);if(!l){l=m()}k.renderTo(l);return k}var o=function(a){return new Promise(function(b){window.require(a,b)})};function p(){!j&&(j=new Promise(function(a){Promise.all([new Promise(function(a,b){require(["service/auth"],a,b)}).then(__importStar),new Promise(function(a,b){require(["mail/MessageFormData"],a,b)}).then(__importStar),new Promise(function(a,b){require(["ui-block/compose-windows/compose-windows"],a,b)}).then(__importStar),new Promise(function(a,b){require(["mediator/compose-manager"],a,b)}).then(__importStar),new Promise(function(a,b){require(["mediator/pony-mode"],a,b)}).then(__importStar),new Promise(function(a,b){require(["suggests/data-source"],a,b)}).then(__importStar),new Promise(function(a,b){require(["mail/Contact"],a,b)}).then(__importStar),new Promise(function(a,b){require(["service/compose-validators"],a,b)}).then(__importStar),o(["compose.mail.ru"])]).then(function(b){a({authService:b[0].default,MessageFormData:b[1].default||b[1],view:n(b[2].default,b[3].default,b[4].default),ui:b[8]})})}));return j}var q={open:function(a){var c=this;return p().then(function(d){var e=a.mode;if(b.COMPOSE_USER_LOADING_DISABLED||e==="template"){var f=d.authService.user;return c._open(__assign({user:f,tools:d},a))}else{return d.authService.loadUser().then(function(b){return c._open(__assign({user:b,tools:d},a))})}})},_open:function(e){var g=this;var j=e.user,k=e.mode,l=e.tools,m=e.source,n=e.forward,o=e.correspondents,p=e.model,q=e.body,r=e.subject,s=e.additionalOptions;var t=(0,d.getHTMLSignature)(j);var u=a.default.getData(),v=u.collectors,w=u.aliases;(0,h.default)(["compose_open",k]);i.add("compose open mode",k);var x=(0,c.getMessageFormDataOptions)(),y=x.params,z=x.helpers;var A=new l.MessageFormData(y,z);var B=A.create({mode:k,source:m,forward:n,from:j.getEmail(),collectors:v,aliases:w,correspondents:o,signature:t,model:p,body:q,subject:r});return B.then(function(a){if(b.CKE_DEFAULT_STYLES){var c=a.get("body.html");a.set("body.html",'<div id="cke-editable-custom" style="'.concat(b.CKE_DEFAULT_STYLES,'">').concat(c,"</div>"))}l.view.add(a,s);return a},function(){if(k==="draft"&&m){g.open({mode:m.mode,model:new f.default({id:m.id}),body:q,correspondents:o})}})},add:function(a,b){var c=b===void 0?{}:b,d=c.autosend,e=d===void 0?false:d,f=c.isDragAndDrop,g=c.dragAndDropItem;return p().then(function(b){b.view.add(a,{autosend:e,isDragAndDrop:f,dragAndDropItem:g});return a})},preload:function(){return p()},getView:function(){return k},onSent:function(a,b){return p().then(function(c){c.view.layerPromise=b;c.view.onSent(a);return a})},onFailSent:function(a,b){return p().then(function(c){c.view.onFailSent(a,b);return a})},isComposeActive:function(){if(k&&k.isMounted()){return k.is("active")}return false},insertHtml:function(a){var b=this.getView();b.insertHtml(a)}};exports.default=q});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/lastseenStrings",["require","exports","default-values","service/getModule"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);exports.default=function(c){return(0,b.default)("lastseen.strings").then(function(b){if(!c){return null}if(c.status_id!==a.LASTSEEN_SHOW_TIME_STATUS){return c}var d=b.default({unixTimestamp:c.timestamp});return __assign(__assign({},c),{status:d||c.status})})}});define("feast-tpl!app/feast-tpl!ui-block/lastseen/lastseen.html",["feast"],function(a){return a.smartParse('<div bem:elem="container">\n\t<fn:var name="text" value="{attrs.text}"/>\n\t<fn:var name="loading" value="{attrs.loading}"/>\n\t<fn:var name="ico" value="{_this.getIcon()}"/>\n\n\t<div fn:if="loading && !text" bem:elem="placeholder-text">\n\t\t<div qa:id="lastseen-placeholder" bem:elem="placeholder-string"></div>\n\t</div>\n\t<div fn:if="!loading && text" bem:elem="status">\n\t\t<span fn:if="ico" bem:elem="ico" bem:mod="lastseen">\n\t\t\t<bem:mod name="success" test="attrs.success"/>\n\t\t\t<b:ico name="{ico}" size="xs"/>\n\t\t</span>\n\t\t<span qa:id="lastseen-text" bem:elem="email">\n\t\t\t<bem:mod name="success" test="attrs.success"/>\n\t\t\t{text}\n\t\t</span>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/lastseen/lastseen.html")});define("feast-tpl!ui-block/lastseen/lastseen.html",["feast-tpl!app/feast-tpl!ui-block/lastseen/lastseen.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/lastseen/lastseen",["require","exports","default-values","feast","feast-tpl!./lastseen.html"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);exports.default=b.default.Block.extend({name:"lastseen",template:c.default,defaults:{loading:true,client:"",text:""},getIcon:function(){if(a.LASTSEEN_DISABLE_PLATFORM){return null}var b=this.get("client");return b==="web"?"laptop":"mobile"}})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/contextmenu-correspondent/contextmenu-correspondent",["require","exports","@mail/xray","default-values","feast","feast-mod/avatar","feast-tpl!./contextmenu-correspondent.html","helpers/copyToClipboard","service/compose","service/lastseenStrings","ui-block/avatar/avatar","ui-block/lastseen/lastseen","ui-block/list/list","ui-block/list-item/list-item","ui-block/spinner/spinner","../../helpers/opener","../../service/calls"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);var p=180;exports.default=c.default.Block.extend({name:"contextmenu-correspondent",template:e.default,blocks:{list:k.default,avatar:i.default,"list-item":l.default,spinner:m.default,lastseen:j.default},events:{"compose:to":"onComposeCreateTo","call:to":"onCallTo",copy:"onCopyEmail"},defaults:{type:"correspondent",model:null,isInAddressbook:false,checkingPossession:true,isShouldCheckPossession:b.IS_NEW_ADDRESSBOOK,lastSeen:{status:"",client_type:""},hideAddContactButton:b.HIDE_CONTEXTMENU_ADD_CONTACT_BUTTON,hideSearchButton:b.HIDE_CONTEXTMENU_SEARCH_BUTTON,extraDetails:{mobile:false}},didMount:function(){var a=this;require(["mediator/letters-actions","mediator/addressbook-manager"],function(b,c){b.default.register(a);c.default.register(a)})},getUserName:function(a){return a.name.length?a.name:a.email.split("@")[0]},didUnmount:function(){this.clipboard&&this.clipboard.destroy()},onShow:function(){var a=this;if(!b.IS_NEW_ADDRESSBOOK){return}var c=this.get("model");c.checkContactPossessing(c.email).then(function(d){var e=d.payload;var f=e.contacts[c.email];a.sendLastSeenRadars(f);if(!b.LAST_SEEN_V2_ENABLE||!f){a.set(__assign({isInAddressbook:e[c.email],checkingPossession:false},b.LAST_SEEN_ENABLE?{lastSeen:f}:{}));return}(0,h.default)(f).then(function(d){a.set({isInAddressbook:e[c.email],checkingPossession:false,lastSeen:d,isOnline:f.status_id===b.LASTSEEN_ONLINE_STATUS})})})},onBeforeHide:function(){this.clipboard&&this.clipboard.destroy()},onComposeCreateTo:function(a){var b=a.details;var c="default"in g.default&&"open"in g.default.default?g.default.default:g.default;c.open({correspondents:{to:[b]}})},canCallTo:function(a){return b.CALLS_P2P_OUTGOING&&o.default.getCallsAPIClient().canCallTo([a.email])[0].canCall},onCallTo:function(a){var b=a.details;var c=this.getLastseenKey(b);o.default.getCallsAPIClient().callTo([b.email],{lastSeenKey:c}).then(function(a){if(a.redirectUrl){(0,n.default)(a.redirectUrl)}})},onCopyEmail:function(){var a=this.get("model");(0,f.default)(a.email)},isLastSeenPossible:function(){return b.LAST_SEEN_ENABLE||b.LAST_SEEN_V2_ENABLE},sendLastSeenRadars:function(c){var d=b.LAST_SEEN_ENABLE||b.LAST_SEEN_V2_ENABLE;if(d){a.default.send("lastseen-".concat((c===null||c===void 0?void 0:c.status_id)?"status":"empty"),{skipdwh:true})}if(b.LAST_SEEN_V2_ENABLE){a.default.send("lastseen-v2-contextmenu-".concat((c===null||c===void 0?void 0:c.status_id)?"status":"empty"),{skipdwh:true})}},getHighResolutionAvatar:function(a){if(!this.isLastSeenPossible()&&a){return a.avatars.default}return a&&(0,d.avatarUrl)(a.email,a.name,p)},getLastseenKey:function(c){if(!b.LAST_SEEN_ENABLE&&!b.LAST_SEEN_V2_ENABLE){return}var d=this.get("lastSeen");var e=""+Date.now()+Math.floor(Math.random()*1e4);a.default.send("lastseen-oncall",{dwh:{email:c.email,ls_key:e,ls_status:(d===null||d===void 0?void 0:d.status_id)||"empty",ls_platform:d===null||d===void 0?void 0:d.client_type}});return e}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/addressbook-manager",["require","exports","@mail/flags","actions/checkContactsPossessing","actions/lastSeen","data-source/actions","data-source/data-source","default-values","feast","pilotjs","RPC","service/layer","service/notify","ui-block/contextmenu-correspondent/contextmenu-correspondent","ui-block/widget/widget","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AddressbookManager=void 0;a=__importDefault(a);e=__importDefault(e);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);var o={emails:[],promise:null};var p=function(){var b;var c=(b=a.default.get("octavius-tooltip-p2p-kitty"))===null||b===void 0?void 0:b.time;if(!c){return false}var d=Math.floor(Date.now()/1e3);return d-c<f.P2P_PROMO_SHOWN_RECENTLY};var q=function(g){__extends(q,g);function q(){return g!==null&&g.apply(this,arguments)||this}q.prototype.getComponentsSpec=function(){return{router:{class:h.default},dataSource:{class:e.default,events:["actionend"]},widget:{class:m.default,events:["addressbook:open"]},"contextmenu-correspondent":{class:l.default,events:["addressbook:addcontact","addressbook:opencontact"]},"compose-app":{lazy:n.lazyUIComposeApp,events:["addressbook:addcontact","addressbook:opencontact"],attrs:{getLastSeen:function(a){return a.getLastSeen}}},letter:{lazy:n.lazyUILetter,events:["addressbook:refetchcontacts"],attrs:{checkContactPossessing:function(a){return a.checkContactPossessing},getLastSeen:function(a){return a.getLastSeen}}}}};q.prototype.renderAddressbook=function(b){if(f.IS_NEW_ADDRESSBOOK){o.emails=[];j.default.open("addressbook",{router:this.get("router"),openEmail:b,callsPromo:p()},{"close-on-esc":false});if(f.CALLS_P2P_OUTGOING){var c=a.default.get("used-p2p-addressbook");if(!(c&&c.state)){c.save({state:true,time:true})}}}};q.prototype.handleEvent=function(a){var c=a.type,e=a.details;switch(c){case"actionend":{if(e.action.type!==d.NAVIGATE){return false}if(e.request.alias==="contacts"){this.renderAddressbook()}break}case"addressbook:open":{this.renderAddressbook();break}case"addressbook:addcontact":{i.default.call("ab/contacts/add",{contacts:[{nick:e.name,emails:[e.email]}]}).then(function(){k.default.add({text:i18n("Добавлен в адресную книгу")},e.scope?e.scope:"default");o.emails=o.emails.filter(function(a){return a!==e.email})});break}case"addressbook:refetchcontacts":{if(f.IS_NEW_ADDRESSBOOK&&!f.PREFETCH_CORRESPONDENTS_DISABLE){o.emails=e;o.promise=(0,b.checkContactsPossessing)({emails:e})}break}case"addressbook:opencontact":{this.renderAddressbook(e.email);break}}return false};q.prototype.checkContactPossessing=function(a){var c=Array.isArray(a)?a:[a];if(c.every(function(a){return o.emails.includes(a)})&&o.promise){return o.promise}return(0,b.checkContactsPossessing)({emails:c})};q.prototype.getLastSeen=function(a,b){var d=b===void 0?{}:b,e=d.allowUseGarage,f=e===void 0?false:e;return(0,c.fetchLastSeen)({emails:a,only_memcache:!f})};return q}(g.default.Mediator);exports.AddressbookManager=q;exports.default=g.default.Mediator.createFromClass("addressbook-manager",q)});define("mediator/advert-manager",["exports","@mail/adman","default-values","feast","mediator/layout-manager","pilotjs","ui-block/advert-column/advert-column","ui-block/letter-list-item-adv/letter-list-item-adv","ui-block/promo-block-letter/promo-block-letter","ui-block/scrollable/scrollable","ui-block/settings/settings","ui-block/slot/slot","ui-block/spec-project-letter/spec-project-letter","utils/util"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var n=z(a);var o=z(c);var p=z(d);var q=z(e);var r=z(f);var s=z(g);var t=z(h);var u=z(i);var v=z(j);var w=z(k);var x=z(l);var y=z(m);function z(a){return a&&a.__esModule?a:{default:a}}var A=0;var B=0;var C=0;var D=0;exports.default=o.default.Mediator.create("advert-manager",{components:{router:{class:q.default},settings:{class:v.default,events:["ponymode:toggle"]},"advert-column":{class:r.default,events:["adcolumn:mount","adcolumn:unmount"]},slot:{class:w.default},"spec-project-letter":{class:x.default,events:["specline:error","specline:render"]},"promo-block-letter":{class:t.default,events:["promoblockletter:render"]},"letter-list-item-adv":{class:s.default,events:["native:render"]},scrollable:{class:u.default,events:["scrollable:mount","scrollable:unmount","scrollable:advontop"]}},defaults:function a(){this.isSpeclineReqPending=false;this.renderNative=function(){};this.onAdvBlockMouseEnter=this.onAdvBlockMouseEnter.bind(this);this.onAdvBlockMouseLeave=this.onAdvBlockMouseLeave.bind(this)},handleEvent:function a(b){var c=b.type,d=b.details;switch(c){case"adcolumn:mount":this.didAdColumnMount();break;case"adcolumn:unmount":this.didAdColumnUnmount();break;case"scrollable:mount":this.didScrollableMount(d);break;case"scrollable:unmount":this.didScrollableUnmount(d);break;case"native:render":this.renderNativeHandler(d);break;case"specline:render":this.renderSpeclineHandler(d);break;case"specline:error":this.hideNotEmptyBlock("letter-list-item-adv");break;case"scrollable:advontop":if(p.default.getType()==="2pane"){this.renderListAdv("list2pane")}break;case"ponymode:toggle":this.clearAdvCache();break;case"promoblockletter:render":this.hideEmptyBlock("spec-project-letter");break}},clearAdvCache:function a(){n.default.clearCache()},renderNativeHandler:function a(b){var c=this;var d=this.getBlock("spec-project-letter");var e=b.placement,f=b.placementRender;this.renderNative=function(){if(e.isForceFail()){f()}else{e.getBanner(true).then(function(a){var b=c.getBlock("letter-list-item-adv");if(a&&b){f(a)}}).catch(function(a){console.log(a)})}};if(!this.isSpeclineReqPending&&!d||!d.el.offsetHeight){this.renderNative()}},renderSpeclineHandler:function a(b){var c=this;var d=b.placement,e=b.placementRender;if(d.isForceFail()){return}this.isSpeclineReqPending=true;d.getBanner(false).then(function(a){c.isSpeclineReqPending=false;var b=c.getBlock("spec-project-letter");if(a&&a.html){c.hideNotEmptyBlock("letter-list-item-adv");c.hideEmptyBlock("promo-block-letter");var f=b.refs["spec-project-letter"];d.attachToContainer(f);d.wakeUp();e(a)}else{c.renderNative()}}).catch(function(a){c.isSpeclineReqPending=false;console.log(a)})},renderListAdv:function a(b){var c=this.getBlock("letter-list-item-adv");if(c){c.renderPlacement(b)}},getBlock:function a(b){var c=this.components[b].length;return this.components[b][c-1]},hideEmptyBlock:function a(b){var c=this.getBlock(b);if(c&&!c.el.offsetHeight){c.el.style.display="none"}},hideNotEmptyBlock:function a(b){var c=this.getBlock(b);if(c){c.el.style.display="none"}},didAdColumnMount:function a(){this.setInitialConf();if(b.ADVERT_SIDEBAR_SLEEP){this.setSleepEvent()}},didAdColumnUnmount:function a(){this.unsetSleepEvent()},didScrollableMount:function a(c){var d=this;var e=c.scrollableElement,f=c.name;this.scrollableName=f;var g=y.default.debounce(function(a){d.handleScroll(a,f)},4);var h=y.default.debounce(function(){d.setInitialConf()},100);this.scrollUnsubscribe=function(){if(e){e.removeEventListener("scroll",g)}};this.initialSetterUnsubscribe=function(){window.removeEventListener("resize",h)};if(b.ADVERT_SCROLL&&e){e.addEventListener("scroll",g);window.addEventListener("resize",h);this.setInitialConf()}},didScrollableUnmount:function a(){this.scrollUnsubscribe();this.initialSetterUnsubscribe()},handleScroll:function a(c,d){var e=c.target.scrollTop;var f=this.get("router");var g=f.request.route;if(p.default.getType()==="3pane"){if(!b.ADVERT_SCROLL_CONF[2]&&(g&&g.is&&!g.is("#read-letter #search-letter")||d!=="dataset-letters")){this.executeScroll(e)}}else{this.executeScroll(e)}},executeScroll:function a(b){if(b>=0&&this.advBlock&&this.advBlock.el){var c=this.getScrollDelta(b);var d=this.getScrollDirection(b);this.scrollMethod({direction:d,scrollDelta:c})}},nativeScroll:function a(c){var d=c.direction,e=c.scrollDelta;this.advBlock.el.scrollBy(0,d*e*(b.ADVERT_SCROLL_CONF[0]/10))},cssScroll:function a(c){var d=c.direction,e=c.scrollDelta;var f=D+d*e*(b.ADVERT_SCROLL_CONF[0]/10);d===1?this.scrollToTop(f):this.scrollToBottom(f)},scrollToTop:function a(b){var c=this.getHeightDelta();if(D>=c){return}D=b<c?b:c;this.advBlock.el.style.top="-"+D+"px"},scrollToBottom:function a(b){if(D<=0){return}D=b>0?b:0;this.advBlock.el.style.top="-"+D+"px"},getScrollDirection:function a(){if(A>B&&C===1){C=-1}else if(A<B&&C===-1){C=1}else if(!C){C=1}return C},getScrollDelta:function a(b){A=B;B=b;return Math.abs(B-A)},getHeightDelta:function a(){var b=this.get("slot");return b.el.offsetHeight-this.advBlock.el.offsetHeight},setInitialConf:function a(){this.advBlock=this.get("advert-column");if(this.advBlock&&this.advBlock.el){D=0;this.advBlock.el.style.top="0";this.useCssScroll=b.ADVERT_SCROLL_CONF[2]&&this.scrollableName==="letter-content"||!this.advBlock.el.scrollBy;this.advBlock.set({"native-scroll":!this.useCssScroll,"css-scroll":this.useCssScroll});this.scrollMethod=this.useCssScroll?this.cssScroll:this.nativeScroll}},onAdvBlockMouseEnter:function a(){n.default.sleep(["sidebar","sidebar-small"],true)},onAdvBlockMouseLeave:function a(){n.default.wakeUp(["sidebar","sidebar-small"],true)},setSleepEvent:function a(){var b=this.get("advert-column");var c=b&&b.el;if(c){c.addEventListener("mouseenter",this.onAdvBlockMouseEnter);c.addEventListener("mouseleave",this.onAdvBlockMouseLeave)}},unsetSleepEvent:function a(){var b=this.get("advert-column");var c=b&&b.el;if(c){c.removeEventListener("mouseenter",this.onAdvBlockMouseEnter);c.removeEventListener("mouseleave",this.onAdvBlockMouseLeave)}}})});define("@mail/cross-url-sharing/index",["module","exports"],function(a,exports){"use strict";var b=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};!function(c,d){"object"==(typeof exports==="undefined"?"undefined":b(exports))&&"undefined"!=typeof a?d(exports):"function"==typeof define&&define.amd?define("@mail/cross-url-sharing",["exports"],d):d((c="undefined"!=typeof globalThis?globalThis:c||self)["@mail/cross-url-sharing"]={})}(undefined,function(a){"use strict";var b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function c(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function d(a,b){return a(b={exports:{}},b.exports),b.exports}var e=d(function(a,b){var c,d,e;Object.defineProperty(b,"__esModule",{value:!0}),b.Errors=b.AttachType=b.ParamsKeys=void 0,(c=b.ParamsKeys||(b.ParamsKeys={})).XEmail="x-email",c.FolderId="folder-id",c.BackUrl="back_url",(d=b.AttachType||(b.AttachType={})).Attach="attach",d.Cloud="cloud",d.CloudStock="cloud_stock",d.Temporary="temporary",(e=b.Errors||(b.Errors={})).Url="err_url",e.Host="err_host",e.Decode="err_decode_url",e.Ids="err_ids",e.AttachId="err_attach_id",e.MessageId="err_message_id",e.Email="err_email",e.BackUrl="err_back_url",e.FolderId="err_folder_id",e.AttachType="err_attach_type"});c(e);var f=e.Errors,g=e.AttachType,h=e.ParamsKeys,i=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.validateMessageId=b.validateAttachId=void 0;b.validateAttachId=function(a,b,c){var d=c.cloudAttachIdReg,f=c.temporaryAttachIdReg,g=c.attachIdReg,h=c.cloudStockAttachIdReg;switch(a){case e.AttachType.Cloud:return!!b.match(d);case e.AttachType.Temporary:return!!b.match(f);case e.AttachType.Attach:return!!b.match(g);case e.AttachType.CloudStock:return!!b.match(h);default:return!1}};b.validateMessageId=function(a,b,c){var d=c.commonMessageIdReg,f=c.temporaryMessageIdReg;switch(a){case e.AttachType.Cloud:case e.AttachType.Attach:case e.AttachType.CloudStock:return!!b.match(d);case e.AttachType.Temporary:return!!b.match(f);default:return!1}}});c(i),i.validateMessageId,i.validateAttachId;var j=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.defaultRegExps=b.CloudStockAttachIdReg=b.AttachIdReg=b.TemporaryAttachIdReg=b.CloudAttachIdReg=b.TemporaryMessageIdReg=b.CommonMessageIdReg=b.AttachPathReg=b.URLPartsReg=void 0,b.URLPartsReg="^https:\\/?\\/?[^:/\\s]+\\/attaches\\/[\\w\\-.]+[^#?\\s]+.*?$",b.AttachPathReg="^(\\w+);(.*)",b.CommonMessageIdReg="^\\d{20}",b.TemporaryMessageIdReg="^\\w{32}$",b.CloudAttachIdReg="^\\/public\\/.*:\\w+:\\w+.\\w+$",b.TemporaryAttachIdReg="^\\w{16}",b.AttachIdReg="^\\w+;\\w+",b.CloudStockAttachIdReg="^\\w+:\\w+",b.defaultRegExps={attachesRegExps:{cloudAttachIdReg:b.CloudAttachIdReg,temporaryAttachIdReg:b.TemporaryAttachIdReg,attachIdReg:b.AttachIdReg,cloudStockAttachIdReg:b.CloudStockAttachIdReg},messageIdsRegExps:{commonMessageIdReg:b.CommonMessageIdReg,temporaryMessageIdReg:b.TemporaryMessageIdReg},urlPartsReg:b.URLPartsReg,attachPathReg:b.AttachPathReg}});c(j),j.defaultRegExps,j.CloudStockAttachIdReg,j.AttachIdReg,j.TemporaryAttachIdReg,j.CloudAttachIdReg,j.TemporaryMessageIdReg,j.CommonMessageIdReg,j.AttachPathReg,j.URLPartsReg;var k=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.prepareRegExps=void 0;b.prepareRegExps=function(a){var b=a.attachesRegExps,c=void 0===b?{}:b,d=c.cloudAttachIdReg,e=c.temporaryAttachIdReg,f=c.attachIdReg,g=c.cloudStockAttachIdReg,h=a.messageIdsRegExps,i=void 0===h?{}:h,k=i.commonMessageIdReg,l=i.temporaryMessageIdReg,m=a.urlPartsReg,n=a.attachPathReg;return{attachesRegExps:{cloudAttachIdReg:new RegExp(d||j.CloudAttachIdReg),temporaryAttachIdReg:new RegExp(e||j.TemporaryAttachIdReg),attachIdReg:new RegExp(f||j.AttachIdReg),cloudStockAttachIdReg:new RegExp(g||j.CloudStockAttachIdReg)},messageIdsRegExps:{commonMessageIdReg:new RegExp(k||j.CommonMessageIdReg),temporaryMessageIdReg:new RegExp(l||j.TemporaryAttachIdReg)},urlPartsReg:new RegExp(m||j.URLPartsReg),attachPathReg:new RegExp(n||j.AttachPathReg)}}});c(k),k.prepareRegExps;var l=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.generateCloudViewerUrl=void 0;var c=function a(b){var c,a=b.host,d=b.messageId,e=b.attachId,f=b.queryParams,g=encodeURIComponent("".concat(d,";").concat(e)),h=(c=f,Object.keys(c).map(function(a){return"".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(c[a]))}).join("&"));return"https://".concat(a,"/attaches/").concat(g,"?").concat(h)};b.generateCloudViewerUrl=function(a,b){var d,f=a.encodedAttachId,g=a.messageId,h=a.queryParams,l=a.host,m=void 0===l?"cloud.mail.ru":l,n=a.attachType,o=void 0===b?{}:b,p=o.validateIds,q=void 0===p||p,r=o.regExps,s=void 0===r?j.defaultRegExps:r;try{d=decodeURIComponent(f)}catch(a){return{result:null,error:e.Errors.Decode}}if(!h[e.ParamsKeys.XEmail])return{result:null,error:e.Errors.Email};if(q&&n){var t=(0,k.prepareRegExps)(s),u=t.attachesRegExps,v=t.messageIdsRegExps;if(!(0,i.validateAttachId)(n,d,u))return{result:null,error:e.Errors.AttachId};if(!(0,i.validateMessageId)(n,g,v))return{result:null,error:e.Errors.MessageId}}var w=h[e.ParamsKeys.BackUrl];if(w)try{h[e.ParamsKeys.BackUrl]=decodeURIComponent(w)}catch(a){}return{result:c({host:m,messageId:g,attachId:d,queryParams:h})}}});c(l),l.generateCloudViewerUrl;var m=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.getAttachTypeByAttachId=void 0;b.getAttachTypeByAttachId=function(a,b){void 0===b&&(b=j.defaultRegExps);var c=(0,k.prepareRegExps)(b).attachesRegExps,d=c.cloudAttachIdReg,f=c.temporaryAttachIdReg,g=c.attachIdReg,h=c.cloudStockAttachIdReg;return a?a.match(d)?e.AttachType.Cloud:a.match(h)?e.AttachType.CloudStock:a.match(g)?e.AttachType.Attach:a.match(f)?e.AttachType.Temporary:null:null}});c(m),m.getAttachTypeByAttachId;var n=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.parseAttachDetails=void 0;b.parseAttachDetails=function(a,b){var c=a.match(b);return c?(c[0],{messageId:c[1],encodedAttachId:c[2]}):null}});c(n),n.parseAttachDetails;var o=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.parseUrl=void 0;b.parseUrl=function(a,b){if(!b.test(a))return null;var c=new URL(a),d=c.hostname,e=c.pathname,f=c.searchParams;return{host:d,attachPath:e.replace("/attaches/",""),queryParams:f}}});c(o),o.parseUrl;var p=d(function(a,c){var d=b&&b.__assign||function(){return(d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){for(var e in b=arguments[c]){Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}}return a}).apply(this,arguments)};Object.defineProperty(c,"__esModule",{value:!0}),c.parseCloudViewerUrl=void 0;c.parseCloudViewerUrl=function(a,b){void 0===b&&(b=j.defaultRegExps);var c=(0,k.prepareRegExps)(b),f=c.attachPathReg,g=c.urlPartsReg,h=(0,o.parseUrl)(a,g);if(!h)return{result:null,error:e.Errors.Url};var i,l=h.host,p=h.attachPath,q=h.queryParams;try{i=decodeURIComponent(p)}catch(a){return{result:null,error:e.Errors.Decode}}var r=(0,n.parseAttachDetails)(i,f);if(null===r)return{result:null,error:e.Errors.Ids};var s=r.messageId,t=r.encodedAttachId,u=(0,m.getAttachTypeByAttachId)(t,b);if(!u)return{result:null,error:e.Errors.AttachType};var v=function(a){var b=a.get(e.ParamsKeys.XEmail),c=a.get(e.ParamsKeys.FolderId),f=a.get(e.ParamsKeys.BackUrl);return d(d({xEmail:b},c&&{folderId:c}),f&&{backUrl:f})}(q);return{result:d({attachType:u,host:l,messageId:s,encodedAttachId:t},v&&{queryParams:v})}}});c(p),p.parseCloudViewerUrl;var q=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.hasFolderId=void 0;b.hasFolderId=function(a){return"folder-id"in a}});c(q),q.hasFolderId;var r=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.validateCloudViewerUrl=void 0;b.validateCloudViewerUrl=function(a,b,c,d){void 0===d&&(d=j.defaultRegExps);var f=(0,k.prepareRegExps)(d),g=f.attachesRegExps,h=f.messageIdsRegExps,l=f.attachPathReg,m=f.urlPartsReg,p=(0,o.parseUrl)(a,m);if(!p)return{result:!1,error:e.Errors.Url};var r,s=p.host,t=p.attachPath,u=p.queryParams,v=c.correctHost,w=c.correctAttachId,x=c.correctMessageId,y=c.correctQueryParams;if(s!==v)return{result:!1,error:e.Errors.Host};try{r=decodeURIComponent(t)}catch(a){return{result:!1,error:e.Errors.Decode}}var z=(0,n.parseAttachDetails)(r,l);if(null===z)return{result:!1,error:e.Errors.Ids};var A=z.messageId,B=z.encodedAttachId;if(!(0,i.validateAttachId)(b,B,g)||B!==w)return{result:!1,error:e.Errors.AttachId};var C=(0,i.validateMessageId)(b,A,h);return A===x&&C?function(a,b,c){var d=a.get(e.ParamsKeys.XEmail),f=c[e.ParamsKeys.XEmail];if(f&&d!==f)return{result:!1,error:e.Errors.Email};var g=a.get(e.ParamsKeys.BackUrl),h=c[e.ParamsKeys.BackUrl];if(h&&g!==h)return{result:!1,error:e.Errors.BackUrl};if(b===e.AttachType.Temporary||!(0,q.hasFolderId)(c))return{result:!0};var i=a.get(e.ParamsKeys.FolderId),j=c[e.ParamsKeys.FolderId];return j&&i!==j?{result:!1,error:e.Errors.FolderId}:{result:!0}}(u,b,y):{result:!1,error:e.Errors.MessageId}}});c(r),r.validateCloudViewerUrl;var s=d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.getAttachTypeByAttachId=b.validateCloudViewerUrl=b.parseCloudViewerUrl=b.generateCloudViewerUrl=void 0,Object.defineProperty(b,"generateCloudViewerUrl",{enumerable:!0,get:function a(){return l.generateCloudViewerUrl}}),Object.defineProperty(b,"parseCloudViewerUrl",{enumerable:!0,get:function a(){return p.parseCloudViewerUrl}}),Object.defineProperty(b,"validateCloudViewerUrl",{enumerable:!0,get:function a(){return r.validateCloudViewerUrl}}),Object.defineProperty(b,"getAttachTypeByAttachId",{enumerable:!0,get:function a(){return m.getAttachTypeByAttachId}})});c(s);var t=s.getAttachTypeByAttachId,u=s.validateCloudViewerUrl,v=s.parseCloudViewerUrl,w=s.generateCloudViewerUrl;c(d(function(a,b){Object.defineProperty(b,"__esModule",{value:!0})})),a.AttachType=g,a.Errors=f,a.ParamsKeys=h,a.generateCloudViewerUrl=w,a.getAttachTypeByAttachId=t,a.parseCloudViewerUrl=v,a.validateCloudViewerUrl=u,Object.defineProperty(a,"__esModule",{value:!0})})});define("@mail/cross-url-sharing",["@mail/cross-url-sharing/index"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/viewer",["require","exports","@instant-messengers/vk-teams-bridge","@mail/cross-url-sharing","@mail/xray","default-values","helpers/encode-uri-component","helpers/opener","helpers/querystring-add","mail/Attachment","service/auth","service/notify","utils/extension"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);var l=null;function m(a){return a&&"get"in a&&typeof a.get==="function"}function n(a,b){if(d.CLOUD_VIEWER_FORCE){return"f"}if(a&&!d.CLOUD_VIEWER_TEMPORARY){return"t-".concat(d.CLOUD_VIEWER_GROUP)}var c="";if(a&&d.CLOUD_VIEWER_TEMPORARY){c="-t"}var e="".concat(c);if(b&&d.CLOUD_VIEWER_GROUP){return"sg".concat(e,"-").concat(d.CLOUD_VIEWER_GROUP)}if(!b&&d.CLOUD_VIEWER_GROUP){return"nsg".concat(e,"-").concat(d.CLOUD_VIEWER_GROUP)}if(b){return"sng".concat(e)}return"nsng".concat(e)}function o(a){var b={};a.forEach(function(a){var c=a.getExtension();var d=k.extToPrimitiveKind[c]||"other";var e=a.get("type");var f="".concat(e,"_").concat(d);if(typeof b[f]==="undefined"){b[f]=0}b[f]++});Object.keys(b).forEach(function(a){c.default.send("exp-cloud-viewer_fa_".concat(a),{v:b[a],dwh:{count:b[a]}})})}function p(a){var b=true;if(d.CLOUD_VIEWER_FORCE){return b}var c=a.map(function(a){return new h.default({name:a.get("name"),type:a.get("type")})});var e=d.CLOUD_VIEWER_ENABLE_TYPE===d.CloudViewerEnableType.fileType;var f=e?d.CLOUD_VIEWER_FILE_TYPES:d.CLOUD_VIEWER_FILE_EXTS;if(c.length&&f&&d.CLOUD_VIEWER_ATTACH_TYPES){b=!c.some(function(a){var b=a.getExtension();var c=k.extToPrimitiveKind[b]||"other";var g=e?c:b;var h=a.get("type");return!f.includes(g)||!d.CLOUD_VIEWER_ATTACH_TYPES.includes(h)});o(c)}else{b=false}return b}exports.default={open:function(c){var f=this;var h=c.attachment,i=c.message,j=c.msgId,k=c.router,l=c.modal,n=l===void 0?false:l,o=c.newWindow,q=o===void 0?false:o,r=c.attachmentId,s=r===void 0?"":r;var t=j||i.get("id");var u=i.get("folder");var v=s;if(!v){v=m(h)?h.get("id"):h.id}var w=m(h)?h.get("type"):h.type;if(!w){w=(0,b.getAttachTypeByAttachId)(v,{attachesRegExps:d.ATTACHES_ID_REG_EXPS})}var x=i.get("attaches.list");var y=(0,e.default)(v);var z=function(){if(!y){return Promise.reject(new Error("encodeURI error"))}};if(d.WEBVIEW){z();var A={back_url:k.request.href};var B=(0,g.default)("https://".concat(d.CLOUD_VIEWER_HOST,"/attaches/").concat(t,"%3B").concat(y),A);return a.default.send("OpenLink",{url:B}).catch(function(a){return console.error("VKTeamsBridge attach error: ",a)})}if(q){z();var C=p(x);this.openInNewWindow({folderId:u,messageId:t,encodedAttachId:y,router:k,isSupportCloudViewer:C,attachType:w});return Promise.resolve()}return new Promise(function(a){f.loadTools().then(function(b){var c=b[0];var d=new c({models:x,message:i,attachment:h,modal:n});d.renderTo(document.body);a(d)})})},openTemporary:function(a){var c=a.messageId,f=a.attachment,g=a.formData,h=a.router;var i=f.get("id");var j=(0,e.default)(i);var k=g.attachments;var l=p(k);if(!d.CLOUD_VIEWER_TEMPORARY){l=false}this.openInNewWindow({temporary:true,messageId:c,encodedAttachId:j,router:h,isSupportCloudViewer:l,attachType:b.AttachType.Temporary});return Promise.resolve()},openInNewWindow:function(a){var e=a.temporary,g=e===void 0?false:e,h=a.messageId,k=a.folderId,l=a.encodedAttachId,m=a.router,o=a.isSupportCloudViewer,p=a.attachType;var q=n(g,o);c.default.send("exp-cloud-viewer_".concat(q));var r={"folder-id":k,"x-email":i.default.user.getEmail(),cvg:q};if(o&&d.CLOUD_VIEWER_GROUP===d.CLOUD_VIEWER_GROUPS.CLOUD){var s={encodedAttachId:l,messageId:h,queryParams:r,host:d.CLOUD_VIEWER_HOST,attachType:p};var t={attachesRegExps:d.ATTACHES_ID_REG_EXPS,messageIdsRegExps:d.MESSAGES_ID_REG_EXP};var u={validateIds:!d.VIEW_URL_IDS_VALIDATE_DISABLE,regExps:t};var v=(0,b.generateCloudViewerUrl)(s,u),w=v.result,x=v.error;if(x){c.default.send("gen_viewer_url_fail",{i:x,rlog:"gen_viewer_url_fail",rlog_message:{project:"octavius",url:w,error:x,inputData:s,options:u}});j.default.error({text:i18n("Просмотр недоступен")});return}c.default.send("gen_viewer_url_ok");(0,f.default)(w);return}window.open(m.getUrl(g?"#attachment-temporary":"#attachment",{message:h,id:l,path:""},r))},loadTools:function(){if(l){return l}l=Promise.all([new Promise(function(a,b){require(["ui-block/viewer/viewer"],a,b)}).then(__importStar),new Promise(function(a,b){require(["mailru-toolkit-lego-bundle"],a,b)}).then(__importStar)]);return l}}});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/attachments-manager",["require","exports","@mail/xray","default-values","feast","pilotjs","service/layer","service/search-attaches/utils","service/viewer","ui-block/attach-list/attach-list","ui-block/attach-thumb/attach-thumb","ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview","ui-block/list-letter-preview-attaches-item/list-letter-preview-attaches-item","ui-block/list-letter-preview-attaches-more/list-letter-preview-attaches-more","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AttachmentsManager=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);var n=["attachments:tocloud"];var o=function(c){__extends(o,c);function o(){return c!==null&&c.apply(this,arguments)||this}o.prototype.getComponentsSpec=function(){return{router:{class:d.default},letter:{lazy:m.lazyUILetter,events:n},viewer:{class:null,events:n},"list-letter-attach-status-active":{class:j.default,events:["attachments:openviewer"]},"list-letter-preview-attaches-item":{class:k.default,events:["attachments:openviewer"]},"list-letter-preview-attaches-more":{class:l.default,events:["attachments:openviewer"]},"attach-list":{class:h.default,events:["attachment:analytics"]},"attach-thumb":{class:i.default,events:["attachment:analytics"]}}};o.prototype.handleEvent=function(a){var b=a.type.split(":").pop();if(b==="tocloud"){this.onAttachmentsCloud(a)}if(b==="openviewer"){var c=this.get("router");var d=a.details,e=d.message,f=d.attachment,h=d.attachmentId,i=d.msgId,j=d.from,k=j===void 0?"ll":j;g.default.open({attachment:f,message:e,router:c,newWindow:true,attachmentId:h,msgId:i});if(f){this.onSendAnalytics([f],"open_".concat(k))}}if(b==="analytics"){var l=a.details,m=l.models,n=l.event;this.onSendAnalytics(m,n)}};o.prototype.onAttachmentsCloud=function(a){var b=a.details,c=b.message,d=b.attachments;e.default.open("explorer-to-cloud",{attachments:d,message:c},{dimmer:true})};o.prototype.onSendAnalytics=function(c,d){if(c===void 0){c=[]}if(b.ATTACH_ANALYTICS_EXT_DISABLED){return}var e=[];var g=[];c.forEach(function(a){var b,c,d,h,i;if(!a){return}if(a.getExtension&&a.getPrimitiveType){e.push((b=a.getExtension())===null||b===void 0?void 0:b.toLowerCase());g.push((c=a.getPrimitiveType())===null||c===void 0?void 0:c.toLowerCase())}else{var j=((d=a.formName)===null||d===void 0?void 0:d.value)||((h=a.name)===null||h===void 0?void 0:h.value)||a.name;if(typeof j==="string"){e.push((i=(0,f.getAttachmentExtension)(j))===null||i===void 0?void 0:i.toLowerCase())}}});a.default.send("attach_thmb_".concat(d),{i:e.length>1?"mltpl":e[0],dwh:{ext:e,extType:g}})};return o}(c.default.Mediator);exports.AttachmentsManager=o;exports.default=c.default.Mediator.createFromClass("attachments-manager",o)});define("helpers/encode",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.safeEncodeURI=void 0;var a=/[&<>"']/g;var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"};function c(a,b){return a[b]}var d=/[()"<>']/g;var e={"(":"%28",")":"%29",'"':"%22","'":"%27","<":"%3C",">":"%3E"};var f=c.bind(null,e);function g(a){return encodeURI(a).replace(d,f)}exports.safeEncodeURI=g;var h=c.bind(null,b);function i(b){if(typeof b!=="string"){return null}return b.replace(a,h)}exports.default=i});define("service/dimmer",["exports","service/promo","ui-block/dimmer/dimmer"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=document.querySelector("#dimmer");var g=void 0;exports.default={add:function a(){g=(new d.default).renderTo(f);c.default.update()},remove:function a(){if(!g){return}try{g.destroy()}catch(a){f.innerHTML=""}c.default.update()}}});define("feast-tpl!app/feast-tpl!ui-block/letter/letter.html",["feast"],function(a){return a.smartParse('<div>\n\t\x3c!-- Переменные --\x3e\n\t<fn:var name="message" value="{attrs.model}"/>\n\t<fn:var name="messageFolder" value="{message.getFolder()}"/>\n\t<fn:var name="hasAttach" value="{attrs.model.is(\'attaches.list.length\') && _this.isEnableAttach()}"/>\n\t<fn:var name="hasReplyAll" value="{_this.hasReplyAll(message)}"/>\n\n\t<fn:var name="draftReply" value="{message.get(\'drafts.reply\')}"/>\n\t<fn:var name="draftReplyAll" value="{message.get(\'drafts.replyall\')}"/>\n\t<fn:var name="draftForward" value="{message.get(\'drafts.forward\')}"/>\n\n\t<fn:var name="folders" value="{attrs.folders}"/>\n\t<fn:var name="ponyMode" value="{attrs.ponymode}"/>\n\n\t\x3c!-- Есть ли AMP-контент? --\x3e\n\t<fn:var name="hasAmp" value="{_this.isAMPLetter()}"/>\n\n\t\x3c!-- Есть ли ошибки в AMP-письме? --\x3e\n\t<fn:var name="hasAmpErrors" value="{attrs[\'amp-error\']}"/>\n\n\t<fn:var name="letterMetaType" value="{_this.getLetterMetaHeaderType(message)}" />\n\t<fn:var name="showPhishingDie" value="{message.get(\'flags.maybe_phishing\')}" />\n\n\t<fn:var name="enableFakeCreateTodo" value="{_this.isShowFakeCreateTodo()}" />\n\t<fn:var name="showAttachList" value="{attrs.showAttachList}" />\n\n\t\x3c!-- Модификаторы --\x3e\n\t<bem:mod name="priority" value="{attrs.model.get(\'priority\')}"/>\n\t<bem:mod name="unread" value="{attrs.model.get(\'flags.unread\')}"/>\n\t<bem:mod name="attach" value="{hasAttach}"/>\n\t<bem:mod name="single" test="attrs.single"/>\n\t<bem:mod name="first" test="attrs.first"/>\n\t<bem:mod name="last" test="attrs.last"/>\n\n\t<bem:mod name="touch" test="attrs.touch"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\t<bem:mod name="fluid" test="!attrs.compact"/>\n\t<bem:mod name="sticky" test="attrs.sticky"/>\n\t<bem:mod name="native-sticky" test="attrs[\'native-sticky\']"/>\n\n\t<bem:mod name="hover-support" test="attrs[\'hover-support\']" />\n\t<bem:mod name="expanded-next" test="attrs[\'expanded-next\']" />\n\n\t<bem:mod name="light-mode" test="!_this.isDarkMode()" />\n\n\t<bem:mod name="mobile" test="attrs.mobile" />\n\n\t\x3c!-- Иконка AMP --\x3e\n\t<fn:match name="amp-icon">\n\t\t<span bem:elem="amp-icon" qa:id="amp-icon">\n\t\t\t<b:ico name="status:breaking" size="s"/>\n\n\t\t\t<bem:mod name="error" test="hasAmpErrors"/>\n\n\t\t\t<fn:attr name="title" value="{i18n(\'Это письмо поддерживает динамический контент\')}" fn:if="!hasAmpErrors"/>\n\t\t\t<fn:attr name="title" value="{i18n(\'При отображении динамического контента письма возникли ошибки\')}" fn:if="hasAmpErrors"/>\n\t\t</span>\n\t</fn:match>\n\n\t\x3c!-- Поле "Кому" --\x3e\n\t<fn:match name="correspondents" args="contacts, dir, limit, mode">\n\t\t<fn:var name="contactList" value="{limit ? contacts.slice(0, limit) : contacts}"/>\n\n\t\t<fn:for data="contactList" as="contact" key="contactKey">\n\t\t\t<fn:var name="isCurrent" value="{contact.email == attrs[\'current-user\'].getEmail()}"/>\n\t\t\t<fn:var name="isLast" value="{contactKey + 1 === contactList.length}"/>\n\t\t\t<b:letter-contact\n\t\t\t\tfolder="{messageFolder}"\n\t\t\t\tkey="{\'contact-\' + contactKey}"\n\t\t\t\tremit:click.prevent.stop="contact:click"\n\t\t\t\tevent:details="contact"\n\t\t\t\tuse:mediator="contact-selection"\n\t\t\t\tcontact="{contact}"\n\t\t\t\tdir="{dir}"\n\t\t\t\tisCurrent="{isCurrent}"\n\t\t\t\tdangerous="{dir === \'from\' && _this.isProbablyPhishing()}"\n\t\t\t\tpony-mode="{ponyMode}"\n\t\t\t\tisLast="{isLast}"\n\t\t\t\tmode="{mode}"\n\t\t\t/>\n\t\t</fn:for>\n\t</fn:match>\n\n\t\x3c!-- Дропдаун меток --\x3e\n\t<fn:match name="add-tag">\n\t\t<div bem:elem="tags">\n\t\t\t<b:dropdown\n\t\t\t\t\tfn:if="!attrs[\'preview-mode\']"\n\t\t\t\t\ttitle="{i18n(\'Добавить метку\')}"\n\t\t\t\t\tico="status:tag"\n\t\t\t\t\tqa:id="add-tag"\n\t\t\t\t\tsecondary\n\t\t\t\t\tshort\n\t\t\t\t\texpand-left\n\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t>\n\t\t\t\t<fn:match name="items">\n\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\tcomponent="TagsPicker"\n\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\ttags="{attrs.model.get(\'flags.tags\')}"\n\t\t\t\t\t\t\txrayFrom="message_icon_menu"\n\t\t\t\t\t/>\n\t\t\t\t</fn:match>\n\t\t\t</b:dropdown>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Пометка прочитанным --\x3e\n\t<fn:match name="status-unread">\n\t\t<div bem:elem="unread" qa:id="unread">\n\t\t\t<bem:mod name="plain" test="!(message.is(\'flags.forward\') || message.is(\'flags.reply\'))"/>\n\t\t\t<b:letter-status2\n\t\t\t\t\tremit:button-click.prevent="togglestatus:unread"\n\t\t\t\t\tevent:details="{model: attrs.model, state: message.is(\'flags.unread\')}"\n\n\t\t\t\t\tdisabled="{attrs[\'disable-edit\']}"\n\t\t\t\t\tname="unread"\n\t\t\t\t\tcompact="{!attrs.compact}"\n\t\t\t\t\tsmall="{attrs.compact}"\n\t\t\t\t\tforward="{message.is(\'flags.forward\')}"\n\t\t\t\t\treply="{message.is(\'flags.reply\')}"\n\t\t\t\t\tstate="{message.is(\'flags.unread\')}"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Переключение тёмного/светлого режима --\x3e\n\t<fn:match name="dark-mode-toggle">\n\t\t<div bem:elem="dark-mode-toggle" qa:id="dark-mode-toggle">\n\t\t\t<b:letter-status2\n\t\t\t\tfn:if="!attrs[\'preview-mode\']"\n\t\t\t\tremit:button-click.prevent="dark-mode:toggle"\n\t\t\t\tname="dark-mode"\n\t\t\t\tstate="{attrs[\'dark-mode-enabled\']}"\n\t\t\t/>\n\t\t</div>\n\t</fn:match>\n\n\t<fn:match name="print">\n\t\t<div bem:elem="print" qa:id="print-btn">\n\t\t\t<b:button2\n\t\t\t\t\tevent:details="{model: attrs.model}"\n\t\t\t\t\tremit:click.prevent="print"\n\t\t\t\t\tradar-id="head-print"\n\t\t\t\t\ttitle="{i18n(\'Распечатать\')}"\n\t\t\t\t\tico="actions:print"\n\t\t\t\t\tbase\n\t\t\t\t\tsecondary\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\tdisabled="{!_this.isEnableCall()}"\n\t\t\t\t\tcentered\n\t\t\t/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Пометка важным --\x3e\n\t<fn:match name="status-flag">\n\t\t<div bem:elem="flag" qa:id="flag">\n\t\t\t<b:letter-status2\n\t\t\t\t\tfn:if="!attrs[\'preview-mode\']"\n\t\t\t\t\tremit:button-click.prevent="togglestatus:flagged"\n\t\t\t\t\tevent:details="{model: attrs.model, state: message.is(\'flags.flagged\')}"\n\t\t\t\t\tdisabled="{!_this.isEnableMark()}"\n\t\t\t\t\tname="flagged"\n\t\t\t\t\tstate="{message.is(\'flags.flagged\')}"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Предложить звонок --\x3e\n\t<fn:match name="invite-call">\n\t\t<div bem:elem="flag" qa:id="calls:invite" promo:id="letter-head-calls-button">\n\t\t\t<b:button2\n\t\t\t\tfn:if="!attrs[\'preview-mode\']"\n\t\t\t\tremit:click.prevent="calls:invite"\n\t\t\t\tevent:details="attrs.model"\n\t\t\t\tradar-id="head-call"\n\t\t\t\ttitle="{i18n(\'Предложить звонок\')}"\n\t\t\t\tico="categories:camera"\n\t\t\t\tbase\n\t\t\t\tsecondary\n\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\tmodel="{attrs.model}"\n\t\t\t\tdisabled="{!_this.isEnableCall()}"\n\t\t\t\tcentered\n\t\t\t/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Создать событие --\x3e\n\t<fn:match name="calendar-create">\n\t\t<div bem:elem="flag" qa:id="calendar:create" promo:id="letter-head-calendar-button">\n\t\t\t<b:button2\n\t\t\t\tfn:if="!attrs[\'preview-mode\']"\n\t\t\t\tremit:click.prevent="calendar:create"\n\t\t\t\tevent:details="{model:attrs.model, createContent:\'web_email_letter_header\'}"\n\t\t\t\tradar-id="head-calendar"\n\t\t\t\ttitle="{i18n(\'Создать событие\')}"\n\t\t\t\tico="calendar-month"\n\t\t\t\tbase\n\t\t\t\tsecondary\n\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\tmodel="{attrs.model}"\n\t\t\t\tdisabled="{attrs[\'disable-edit\']}"\n\t\t\t\tcentered\n\t\t\t/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Аватарка --\x3e\n\t<fn:match name="avatar-wrap">\n\t\t<fn:var name="contact" value="{message.get(\'correspondents.from.0\')}"/>\n\t\t<div bem:elem="avatar-wrap">\n\t\t\t<fn:apply-match name="status-unread" fn:if="!attrs.compact"/>\n\t\t\t<div bem:elem="avatar"\n\t\t\t\t qa:id="avatar"\n\t\t\t\t remit:click.prevent.stop="clickavatar"\n\t\t\t\t event:details="contact">\n\t\t\t\t<b:notification-badge\n\t\t\t\t\t\tshow="{attrs.isOnline}"\n\t\t\t\t\t\tcolorMode="success"\n\t\t\t\t\t\tbottom="4"\n\t\t\t\t\t\tright="4"\n\t\t\t\t\t\ttest-id="{attrs.isOnline && \'online-badge\'}"\n\t\t\t\t>\n\t\t\t\t\t<fn:match name="content" bem:block="widget">\n\t\t\t\t\t\t\t\t<b:avatar\n\t\t\t\t\t\t\t\t\t\tsize="{attrs.compact ? \'m\' : \'s\'}"\n\t\t\t\t\t\t\t\t\t\tsrc="{message.get(\'correspondents.from.0.avatars.default\')}"\n\t\t\t\t\t\t\t\t\t\ttouch="{attrs.touch}"/>\n\t\t\t\t\t</fn:match>\n\t\t\t\t</b:notification-badge>\n\t\t\t</div>\n\t\t\t<fn:apply-match name="status-unread" fn:if="attrs.compact"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Бейдж папки --\x3e\n\t<fn:match name="folder">\n\t\t<fn:if test="message.isHigh()">\n\t\t\t<fn:var name="name" value="important"/>\n\t\t</fn:if>\n\n\t\t<fn:if test="!attrs[\'disable-category\'] && message.get(\'transaction_category\') && !messageFolder.isSpam()">\n\t\t\t<fn:var name="name" value="{message.get(\'transaction_category\')}"/>\n\t\t</fn:if>\n\n\t\t<fn:if test="attrs.showfolder">\n\t\t\t<fn:var name="text" value="{messageFolder.get(\'name\')}"/>\n\t\t</fn:if>\n\n\t\t<div bem:elem="folder" bem:mod="{!!(text || name)}">\n\t\t\t<b:letter-category\n\t\t\t\tshort="{!text}"\n\t\t\t\tname="{name}"\n\t\t\t\ttext="{text}"\n\t\t\t\tsize="l"/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Время отправки письма --\x3e\n\t<fn:match name="date">\n\t\t<div bem:elem="date" qa:id="date">\n\t\t\t<fn:value mod="getLocaleDateFull">message.get(\'date\')</fn:value>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Поле Кому --\x3e\n\t<fn:match name="recipients">\n\t\t<div bem:elem="recipients" bem:mod="short" qa:id="recipients:short"\n\t\t\t fn:if="!attrs[\'details-expanded\']">\n\t\t\t<fn:var name="recipients" value="{_this.getMessageCorrespondents()}"/>\n\t\t\t<fn:var name="showNames" value="{recipients.length > 3 ? 2 : recipients.length}"/>\n\t\t\t<fn:var name="moreCount" value="{recipients.length - showNames}"/>\n\n\t\t\t<span bem:elem="recipient-type">{i18n(\'Кому\')}:</span><fn:apply-match name="correspondents" args="recipients, \'to\', showNames"/>\n\t\t\t<a bem:elem="recipients-short-expand" fn:if="recipients.length > 3" remit:click.prevent="details:expand"\n\t\t\t\tqa:id="recipients:short-expand">{i18n(\'и ещё\')}\n\t\t\t\t<fn:value fn:if="attrs.touch">moreCount</fn:value>\n\t\t\t\t<fn:value fn:if="!attrs.touch" mod="correspondentsCount">moreCount</fn:value>\n\t\t\t</a>\n\t\t</div>\n\n\t\t<div bem:elem="recipients" bem:mod="expanded" qa:id="recipients:expanded"\n\t\t\t fn:if="attrs[\'details-expanded\']"\n\t\t>\n\t\t\x3c!-- remit:click.prevent="details:collapse" для поля выше ^ --\x3e\n\t\t\t<fn:var name="hasBcc" value="{attrs.model.get(\'correspondents.bcc.length\')}"/>\n\t\t\t<fn:var name="hasCc" value="{attrs.model.get(\'correspondents.cc.length\')}"/>\n\n\t\t\t<div bem:elem="header-details-recipient">\n\t\t\t\t<span bem:elem="recipient-type">{i18n(\'Кому\')}:</span><fn:apply-match name="correspondents" args="message.get(\'correspondents.to\'), \'to\'"/>\n\n\t\t\t\t<a bem:elem="recipients-short-collapse" remit:click.prevent="details:collapse" fn:if="!hasCc && !hasBcc"\n\t\t\t\t   qa:id="recipients:short-collapse">{i18n(\'Скрыть список\')}</a>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="header-details-recipient" fn:if="hasCc">\n\t\t\t\t<span bem:elem="recipient-type">{i18n(\'Копия\')}:</span><fn:apply-match name="correspondents" args="message.get(\'correspondents.cc\'), \'cc\'"/>\n\n\t\t\t\t<a bem:elem="recipients-short-collapse" remit:click.prevent="details:collapse" fn:if="!hasBcc"\n\t\t\t\t   qa:id="recipients:short-collapse">{i18n(\'Скрыть список\')}</a>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="header-details-recipient" fn:if="hasBcc">\n\t\t\t\t<span bem:elem="recipient-type">{i18n(\'Скрытая\')}:</span><fn:apply-match name="correspondents" args="message.get(\'correspondents.bcc\'), \'bcc\'"/>\n\n\t\t\t\t<a bem:elem="recipients-short-expand" remit:click.prevent="details:collapse"\n\t\t\t\t   qa:id="recipients:short-collapse">{i18n(\'Скрыть список\')}</a>\n\t\t\t</div>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Меню Ещё --\x3e\n\t<fn:match name="more">\n\t\t<fn:if test="!attrs.mobile">\n\t\t\t<div bem:elem="more" qa:id="more">\n\t\t\t\t<b:dropdown-actions\n\t\t\t\t\t\tfn:if="!attrs.readonly"\n\t\t\t\t\t\ttext="{i18n(\'Ещё\')}"\n\t\t\t\t\t\tico="more-hor"\n\t\t\t\t\t\tsecondary\n\t\t\t\t\t\texpand-left\n\n\t\t\t\t\t\tdisable-edit="{attrs[\'disable-edit\']}"\n\n\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\tparentThread="{attrs.parentThread}"\n\t\t\t\t\t\tfolders="{folders}"\n\t\t\t\t\t\tfolder="{messageFolder}"\n\t\t\t\t\t\tread="{message.is(\'flags.unread\') ? true : null}"\n\t\t\t\t\t\tunread="{!message.is(\'flags.unread\') ? true : null}"\n\t\t\t\t\t\tflag="{!message.is(\'flags.flagged\') ? true : null}"\n\t\t\t\t\t\tunflag="{message.is(\'flags.flagged\') ? true : null}"\n\t\t\t\t\t\tarchive="{!messageFolder.isArchive()}"\n\t\t\t\t\t\tspam="{_this._showSpam()}"\n\t\t\t\t\t\tselectedLettersIds="{[message.get(\'id\')]}"\n\t\t\t\t\t\tunsubscribe="{_this._showUnsubscribeInMoreMenu()}"\n\t\t\t\t\t\tunspam="{messageFolder.isSpam()}"\n\t\t\t\t\t\tdark-mode="{_this.isDarkMode()}"\n\t\t\t\t\t\tmetathreads="{attrs.metathreads}"\n\n\t\t\t\t\t\tcreate-event="{_this._showDropdownCalendarButton()}"\n\t\t\t\t\t\tinvite-call="{_this._showDropdownCallButton()}"\n\t\t\t\t\t\tcreate-filter="{_this._showFilterButton()}"\n\t\t\t\t\t\tcategory-feedback="{attrs[\'category-feedback\'] && !attrs.touch}"\n\t\t\t\t\t\ttranslate="{!attrs[\'disable-translate\']}"\n\n\t\t\t\t\t\tmore\n\t\t\t\t\t\tremove\n\t\t\t\t\t\tmove\n\t\t\t\t\t\treadletter\n\t\t\t\t\t\tprint\n\t\t\t\t\t\treply="{hasReplyAll?\'all\':true}"\n\t\t\t\t\t\tradar-id="more"\n\t\t\t\t\t\tuse:mediator="layout-manager letters-selection unsubscribe-actions"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</fn:if>\n\t</fn:match>\n\n\t\x3c!-- Отписка из письма --\x3e\n\t<fn:match name="unsubscribe">\n\t\t<div bem:elem="footer-button" qa:id="unsubscribe">\n\t\t\t<fn:var name="letterId" value="{message.get(\'id\')}"/>\n\t\t\t<fn:var name="senderFrom" value="{message.get(\'correspondents.from\')[0].email}"/>\n\t\t\t<b:unsubscribe\n\t\t\t\t\tuse:mediator="unsubscribe-actions themes-manager"\n\t\t\t\t\ttouch="{attrs.touch}"\n\t\t\t\t\tsenderFrom="{senderFrom}"\n\t\t\t\t\tletterId="{letterId}"\n\t\t\t\t\tposition-right\n\t\t\t\t\tshort="{hasReplyAll}"\n\t\t\t\t\tpromoId="octavius-tooltip-unsubscribe-button"\n\t\t\t/>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Шапка письма --\x3e\n\t<div bem:elem="head" remit:click="clickhead" qa:id="head">\n\t\t<bem:mod name="sticky" test="attrs[\'sticky-head\']"/>\n\t\t<bem:mod name="sticky-fade" test="attrs[\'sticky-head-fade\']"/>\n\n\t\t<div bem:elem="header-row">\n\t\t\t<fn:apply-match name="avatar-wrap"/>\n\n\t\t\t<div bem:elem="header-details" qa:id="head:details">\n\t\t\t\t<div bem:elem="author">\n\t\t\t\t\t<fn:apply-match name="correspondents" args="message.get(\'correspondents.from\'), \'from\', \'\', \'name-with-email\'"/>\n\t\t\t\t\t<fn:apply-match name="date" fn:if="!attrs.compact"/>\n\t\t\t\t\t<fn:apply-match name="folder" fn:if="!attrs.compact"/>\n\t\t\t\t\t<fn:apply-match name="amp-icon" fn:if="(hasAmp && !attrs[\'preview-mode\'] || hasAmpErrors) && !attrs.compact"/>\n\t\t\t\t</div>\n\n\t\t\t\t<fn:apply-match name="recipients" fn:if="_this.getMessageCorrespondents().length"/>\n\t\t\t\t<fn:apply-match name="folder" fn:if="attrs.compact"/>\n\t\t\t\t<fn:apply-match name="date" fn:if="attrs.compact"/>\n\t\t\t\t<fn:apply-match name="amp-icon" fn:if="(hasAmp && !attrs[\'preview-mode\'] || hasAmpErrors) && attrs.compact"/>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="controls" qa:id="controls">\n\t\t\t\t<fn:apply-match name="status-flag" />\n\t\t\t\t<fn:apply-match name="dark-mode-toggle" fn:if="_this.isDarkModePossible()" />\n\t\t\t\t<fn:apply-match name="invite-call" fn:if="_this._showHeadCallButton()" />\n\t\t\t\t<fn:apply-match name="calendar-create" fn:if="_this._showHeadCalendarButton()" />\n\t\t\t\t<fn:apply-match name="print" fn:if="!attrs[\'disable-head-print\'] && !attrs.selectMode"/>\n\t\t\t\t<fn:apply-match name="add-tag" fn:if="attrs[\'enable-tags\']"/>\n\t\t\t\t<fn:apply-match name="more" />\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div bem:elem="before-letter-body">\n\t\t\x3c!-- FMAIL-16605: Метки --\x3e\n\t\t<fn:if test="attrs[\'enable-tags\']">\n\t\t\t<b:react-async\n\t\t\t\t\tcomponent="LetterTags"\n\t\t\t\t\ttags="{attrs.model.get(\'flags.tags\')}"\n\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t/>\n\t\t</fn:if>\n\t\t\x3c!-- FMAIL-6259: плашка о возможном фишинге --\x3e\n\t\t\x3c!-- FMAIL-11501: Плашка о протухаемых аттачах --\x3e\n\t\t<div bem:elem="letter-meta-container" fn:if="letterMetaType">\n\t\t\t<bem:mod name="phishing" test="showPhishingDie" />\n\t\t\t<b:letter-meta\n\t\t\t\ttype="{letterMetaType}"\n\t\t\t\tmodel="{message}"\n\t\t\t\tremit:attaches-cloud-save="attaches:cloud:all"\n\t\t\t\tuse:mediator="letters-actions"\n\t\t\t/>\n\t\t</div>\n\n\t\t<div bem:elem="confirm-receipt" fn:if="_this.isEnableConfirmationReceipt()">\n\t\t\t<b:letter-confirm-receipt\n\t\t\t\tid="confirm-receipt"\n\t\t\t\tmodel="{message}"\n\t\t\t\tmobile="{attrs.mobile}"\n\t\t\t\tremit:confirm="confirmreceipt"\n\t\t\t/>\n\t\t</div>\n\t\t\x3c!-- Кнопка подтверждение прочтение письма --\x3e\n\n\t\t\x3c!-- Переводчик --\x3e\n\t\t<div bem:elem="translator" fn:if="_this.isTranslatorVisible()">\n\t\t\t<b:translator\n\t\t\t\tid="translator"\n\t\t\t\tremit:hide="translator:hide:click"\n\t\t\t\tremit:close="translator:close:click"\n\t\t\t\tremit:original="translator:original:click"\n\t\t\t\tremit:retry="translator:retry:click"\n\t\t\t\tremit:translate="translator:translate:click"\n\n\t\t\t\tletterId="{message.id}"\n\t\t\t\terror="{attrs[\'is-translator-error\']}"\n\t\t\t\tcompact="{attrs.compactTranslator}"\n\t\t\t\tfrom-default-selected="{attrs[\'translator-default-from\']}"\n\t\t\t\tloading="{attrs[\'is-translator-loading\']}"\n\t\t\t\tponymode="{ponyMode}"\n\t\t\t\tto-default-selected="{attrs[\'translator-default-to\']}"\n\t\t\t\tis-translator-visible="{attrs[\'is-translator-visible\']}"\n\t\t\t\ttranslated="{_this.isLetterTranslated()}"\n\t\t\t/>\n\t\t</div>\n\t</div>\n\n\t\x3c!-- Блок-подсказка под шапкой письма --\x3e\n\t<div bem:elem="tooltip" fn:if="!_this.isTranslatorVisible() && _this.isTooltipVisible()">\n\t\t\x3c!-- Подсказка об отключенных картинках в папке "Спам" (с возможностью включить для письма) --\x3e\n\t\t<fn:if test="_this.isImagesHiddenTooltipVisible()">\n\t\t\t<b:letter-tooltip\n\t\t\t\ttype="images-hidden-tooltip"\n\t\t\t\tponymode="{ponyMode}"\n\t\t\t\ttitle-text="{i18n(\'Мы скрыли изображения в письме, чтобы защитить аккаунт\')}"\n\t\t\t\taction-text="{i18n(\'Показать изображения\')}"\n\t\t\t\tremit:action="letter-tooltip:show-images:click"\n\t\t\t\tremit:close="letter-tooltip:close"\n\t\t\t/>\n\t\t</fn:if>\n\t</div>\n\n\t\x3c!-- Панель вложений --\x3e\n\t<fn:if test="hasAttach">\n\t\t<div bem:elem="attach-list">\n\t\t\t<bem:mod name="hidden" test="!showAttachList"/>\n\t\t\t<b:attach-list\n\t\t\t\tletter-length="{attrs.model.get(\'body.text\').length}"\n\t\t\t\tmodels="{attrs.model.get(\'attaches.list\')}"\n\t\t\t\ttotal-size="{attrs.model.getAttachmentsTotalSize()}"\n\t\t\t\tdownload-link="{_this.getAttachmentsDowloadLink()}"\n\t\t\t\tpreview-mode="{attrs[\'preview-mode\']}"\n\t\t\t\tuse:mediator="layout-manager attachments-manager"\n\t\t\t\tdark-mode="{_this.isDarkMode()}"\n\t\t\t\tshowAttachList="{showAttachList}"\n\t\t\t\tshowAttachSafetyStatus="{attrs[\'show-attach-safety-status\'] && _this.getAttachSafetyStatus() && !messageFolder.isSpam()}"\n\t\t\t\tsafety-status="{_this.getAttachSafetyStatus()}"\n\t\t\t\thas-attach-safety-status-background="{attrs[\'has-attach-safety-status-background\']}"\n\t\t\t\tattach-safety-status-position="{attrs[\'attach-safety-status-position\']}"\n\t\t\t\tremit:attach-list-expanded="attaches:expanded"\n\t\t\t\tremit:attach-list-collapsed="attaches:collapsed"\n\t\t\t\tremit:attach-list-cloud="attaches:cloud:all"\n\t\t\t\tremit:thumb-open="attaches:open"\n\t\t\t\tremit:thumb-cloud="attaches:cloud:one"\n\t\t\t/>\n\t\t</div>\n\t</fn:if>\n\n\t\x3c!-- Тело письма --\x3e\n\t<div bem:elem="body" qa:id="body">\n\t\t\x3c!-- Показ приглашения если есть ics --\x3e\n\t\t\x3c!-- Скрываем приглашение, если есть плашка адреса мероприятия --\x3e\n\t\t<b:letter-calendar\n\t\t\tkey="{_this.isDarkMode()}"\n\t\t\tdark-mode="{_this.isDarkMode()}"\n\t\t\tfn:if="!(attrs[\'address-header-calendar\'] && message.getJsonLdEvent() || attrs[\'smart-card-ics\'] && _this.hasSmartCardIcsMeta(message))"\n\t\t\tcalendars="{message.getCalendarFromAttach()}"\n\t\t/>\n\n\t\t<fn:choose>\n\t\t\t<fn:when test="hasAmp && !attrs[\'preview-mode\']">\n\t\t\t\t<b:letter-body-amp\n\t\t\t\t\t\tref="letter-body"\n\t\t\t\t\t\tdark-mode="{_this.isDarkMode()}"\n\t\t\t\t\t\tmodel="{message}"\n\t\t\t\t\t\tremit:error="amp:error"\n\t\t\t\t\t\tremit:force-recalc="letter-force-recalc"\n\t\t\t\t\t\tremit:change-css-selector-theme="amp:change-css-selector-theme"\n\t\t\t\t/>\n\t\t\t</fn:when>\n\t\t\t<fn:otherwise>\n\t\t\t\t\x3c!-- Содержимое письма --\x3e\n\t\t\t\t<b:letter-body\n\t\t\t\t\t\tref="letter-body"\n\t\t\t\t\t\tkey="{_this.getLetterBodyKey()}"\n\t\t\t\t\t\tid="{_this.getLetterBodyKey()}"\n\t\t\t\t\t\tbodyHtml="{_this.getLetterBody()}"\n\t\t\t\t\t\tcollapsed-default="{attrs[\'quotes-collapsed-default\']}"\n\t\t\t\t\t\tponymode="{ponyMode}"\n\t\t\t\t\t\tdark-mode="{_this.isDarkMode()}"\n\t\t\t\t\t\tmessage="{message}"\n\t\t\t\t\t\tpreview-mode="{attrs[\'preview-mode\']}"\n\t\t\t\t\t\tcurrent-user="{attrs[\'current-user\']}"\n\n\t\t\t\t\t\tremit:resize="resize"\n\t\t\t\t\t\tremit:blockquote="blockquote"\n\t\t\t\t\t\tremit:allowedattrclick="letter:body:allowedattrclick"\n\t\t\t\t\t\tremit:data-attr-click="letter:body:data-attr:click"\n\t\t\t\t\t\tremit:finepayment="letter:body:finepayment"\n\t\t\t\t\t\tremit:finepaymentright="letter:body:finepaymentright"\n\t\t\t\t\t\tremit:monetapayment="letter:body:monetapayment"\n\t\t\t\t\t\tremit:tomyselfclick="letter:body:tomyself"\n\t\t\t\t\t\tremit:force-recalc="letter-force-recalc"\n\t\t\t\t\t\tuse:mediator="layout-manager features flags"\n\t\t\t\t/>\n\t\t\t</fn:otherwise>\n\t\t</fn:choose>\n\t</div>\n\n\t\x3c!-- Подвал--\x3e\n\t<div bem:elem="footer" qa:id="footer" fn:if="!attrs.readonly && _this.isShowFooter()">\n\t\t<bem:mod name="sticky" test="attrs[\'sticky-footer\']"/>\n\t\t<bem:mod name="sticky-fade" test="attrs[\'sticky-footer-fade\']"/>\n\t\t<bem:mod name="new-toolbar" test="_this.useNewToolbar()" />\n\n\t\t<div bem:elem="footer-background">\n\t\t\t\x3c!-- Кнопки ответа на письмо --\x3e\n\t\t\t<div bem:elem="footer-buttons">\n\t\t\t\t<div bem:elem="footer-left">\n\t\t\t\t\t<div bem:elem="footer-button" fn:if="hasReplyAll">\n\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t<fn:when test="draftReplyAll">\n\t\t\t\t\t\t\t\t<b:dropdown\n\t\t\t\t\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\t\t\t\t\tshortcut="shift+r"\n\t\t\t\t\t\t\t\t\t\tradar-id="replyall"\n\t\t\t\t\t\t\t\t\t\ttext="{i18n(\'Ответить всем\')}"\n\t\t\t\t\t\t\t\t\t\tico="reply-all"\n\t\t\t\t\t\t\t\t\t\tbase\n\t\t\t\t\t\t\t\t\t\tpure\n\t\t\t\t\t\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableReply()}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<fn:match name="items">\n\t\t\t\t\t\t\t\t\t\t<b:list>\n\t\t\t\t\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\t\t\t\t\t\tevent:details="{model: attrs.model, draftId: draftReplyAll}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tremit:click="letter:draft:replyall"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{i18n(\'Есть черновик, продолжить с ним\')}\n\t\t\t\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\t\t\t\tremit:click="compose:replyall">\n\t\t\t\t\t\t\t\t\t\t\t\t{i18n(\'Новое письмо\')}\n\t\t\t\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t\t\t\t</b:list>\n\t\t\t\t\t\t\t\t\t</fn:match>\n\t\t\t\t\t\t\t\t</b:dropdown>\n\t\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\t\t\t\t\tshortcut="shift+r"\n\t\t\t\t\t\t\t\t\t\tremit:click="compose:replyall"\n\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\tradar-id="replyall"\n\t\t\t\t\t\t\t\t\t\ttext="{i18n(\'Ответить всем\')}"\n\t\t\t\t\t\t\t\t\t\tico="reply-all"\n\t\t\t\t\t\t\t\t\t\tbase\n\t\t\t\t\t\t\t\t\t\tpure\n\t\t\t\t\t\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableReply()}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div bem:elem="footer-button">\n\t\t\t\t\t\t<fn:var name="shortReply" value="{hasReplyAll && attrs[\'sticky-reduce-reply\']}"/>\n\n\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t<fn:when test="draftReply">\n\t\t\t\t\t\t\t\t<b:dropdown\n\t\t\t\t\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\t\t\t\t\tshortcut="r"\n\t\t\t\t\t\t\t\t\t\tradar-id="reply"\n\t\t\t\t\t\t\t\t\t\ttext="{i18n(\'Ответить\')}"\n\t\t\t\t\t\t\t\t\t\tico="reply"\n\t\t\t\t\t\t\t\t\t\tbase\n\t\t\t\t\t\t\t\t\t\tpure\n\t\t\t\t\t\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableReply()}"\n\t\t\t\t\t\t\t\t\t\tshort="{shortReply}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<fn:match name="items">\n\t\t\t\t\t\t\t\t\t\t<b:list>\n\t\t\t\t\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\t\t\t\t\t\tevent:details="{model: attrs.model, draftId: draftReply}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tremit:click="letter:draft:reply"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{i18n(\'Есть черновик, продолжить с ним\')}\n\t\t\t\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\t\t\t\tremit:click="compose:reply">\n\t\t\t\t\t\t\t\t\t\t\t\t{i18n(\'Новое письмо\')}\n\t\t\t\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t\t\t\t</b:list>\n\t\t\t\t\t\t\t\t\t</fn:match>\n\t\t\t\t\t\t\t\t</b:dropdown>\n\t\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\t\t\t\t\tshortcut="r"\n\t\t\t\t\t\t\t\t\t\tremit:click="compose:reply"\n\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\tradar-id="reply"\n\t\t\t\t\t\t\t\t\t\ttext="{i18n(\'Ответить\')}"\n\t\t\t\t\t\t\t\t\t\tico="reply"\n\t\t\t\t\t\t\t\t\t\tbase\n\t\t\t\t\t\t\t\t\t\tpure\n\t\t\t\t\t\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableReply()}"\n\t\t\t\t\t\t\t\t\t\tshort="{shortReply}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div bem:elem="footer-button">\n\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t<fn:when test="draftForward">\n\t\t\t\t\t\t\t\t<b:dropdown\n\t\t\t\t\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\t\t\t\t\tshortcut="f"\n\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\tradar-id="forward"\n\t\t\t\t\t\t\t\t\t\ttext="{i18n(\'Переслать\')}"\n\t\t\t\t\t\t\t\t\t\tico="forward"\n\t\t\t\t\t\t\t\t\t\tbase\n\t\t\t\t\t\t\t\t\t\tpure\n\t\t\t\t\t\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableForward()}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<fn:match name="items">\n\t\t\t\t\t\t\t\t\t\t<b:list>\n\t\t\t\t\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\t\t\t\t\t\tevent:details="{model: attrs.model, draftId: draftForward}"\n\t\t\t\t\t\t\t\t\t\t\t\t\tremit:click="letter:draft:forward"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{i18n(\'Есть черновик, продолжить с ним\')}\n\t\t\t\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\t\t\t\tremit:click="compose:forward">\n\t\t\t\t\t\t\t\t\t\t\t\t{i18n(\'Новое письмо\')}\n\t\t\t\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t\t\t\t</b:list>\n\t\t\t\t\t\t\t\t\t</fn:match>\n\t\t\t\t\t\t\t\t</b:dropdown>\n\t\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\t\t\tremit:click="compose:forward"\n\t\t\t\t\t\t\t\t\t\tuse:mixin="shortcut-title"\n\t\t\t\t\t\t\t\t\t\tshortcut="f"\n\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\tradar-id="forward"\n\t\t\t\t\t\t\t\t\t\ttext="{i18n(\'Переслать\')}"\n\t\t\t\t\t\t\t\t\t\tico="forward"\n\t\t\t\t\t\t\t\t\t\tbase\n\t\t\t\t\t\t\t\t\t\tpure\n\t\t\t\t\t\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableForward()}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div bem:elem="footer-right">\n\t\t\t\t\t<fn:if test="!_this._showUnsubscribeButton() && !_this.isDatesMetadataEnabled()">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tbem:elem="footer-button"\n\t\t\t\t\t\t\t\tqa:id="calls-dropdown"\n\t\t\t\t\t\t\t\tpromo:id="footer-calls-dropdown"\n\t\t\t\t\t\t\t\tfn:if="attrs[\'invite-call\'] && !attrs[\'disable-call\'] && !attrs[\'disable-footer-call\'] && _this.canCallTo(attrs.model) && !enableFakeCreateTodo"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<b:dropdown\n\t\t\t\t\t\t\t\t\tdisable-expand-center\n\t\t\t\t\t\t\t\t\texpand-left\n\t\t\t\t\t\t\t\t\tico="categories:camera"\n\t\t\t\t\t\t\t\t\ttext="{i18n(\'Позвонить\')}"\n\t\t\t\t\t\t\t\t\ttitle="{i18n(\'Позвонить\')}"\n\t\t\t\t\t\t\t\t\tannotation="{!attrs[\'disable-calls-tip\'] && i18n(\'Отправьте ссылку на звонок или позвоните сейчас — если ваши собеседники онлайн, они увидят вызов\')}"\n\t\t\t\t\t\t\t\t\tponymode="{attrs[\'pony-mode\']}"\n\t\t\t\t\t\t\t\t\tpure\n\t\t\t\t\t\t\t\t\tshort="{attrs[\'sticky-reduce-all-texts\']}"\n\t\t\t\t\t\t\t\t\tradar-id="footer-call-dropdown"\n\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableCall()}"\n\t\t\t\t\t\t\t\t\tremit:dropdown-change-state="dropdown-change"\n\t\t\t\t\t\t\t\t\tcentered="{attrs[\'sticky-reduce-one-text\']}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<fn:match name="items" args="dropdownArgs">\n\t\t\t\t\t\t\t\t\t<b:list>\n\t\t\t\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\t\t\t\t\tqa:id="calls:call"\n\t\t\t\t\t\t\t\t\t\t\t\tremit:click="calls:groupcall"\n\t\t\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\t\t\tradar-id="footer-calls-groupcall"\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableCall()}"\n\t\t\t\t\t\t\t\t\t\t\t\ttitle="{!attrs[\'disable-calls-tip\'] && i18n(\'Если собеседники онлайн на сайте Mail.ru, они увидят вызов и смогут ответить сразу\')}"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t\t\t\t<b:ico name="categories:camera"/>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Позвонить сейчас\')}</span>\n\t\t\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t\t\t\t<b:list-item\n\t\t\t\t\t\t\t\t\t\t\t\tqa:id="calls:invite"\n\t\t\t\t\t\t\t\t\t\t\t\tremit:click="calls:invite"\n\t\t\t\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\t\t\t\tradar-id="footer-calls-invite"\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableCall()}"\n\t\t\t\t\t\t\t\t\t\t\t\ttitle="{!attrs[\'disable-calls-tip\'] && i18n(\'Собеседники получат ссылку для видеозвонка и присоединятся, когда перейдут по ней\')}"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<span bem:elem="ico">\n\t\t\t\t\t\t\t\t\t\t\t<b:ico name="status:link"/>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t<span bem:elem="text">{i18n(\'Отправить ссылку на звонок\')}</span>\n\t\t\t\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t\t\t</b:list>\n\t\t\t\t\t\t\t\t</fn:match>\n\t\t\t\t\t\t\t</b:dropdown>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tbem:elem="footer-button"\n\t\t\t\t\t\t\t\tpromo:id="footer-calls-button"\n\t\t\t\t\t\t\t\tfn:if="attrs[\'invite-call\'] && !attrs[\'disable-call\'] && !attrs[\'disable-footer-call\'] && !_this.canCallTo(attrs.model) && !enableFakeCreateTodo"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\t\tqa:id="calls:invite"\n\t\t\t\t\t\t\t\t\tremit:click="calls:invite"\n\t\t\t\t\t\t\t\t\tevent:details="attrs.model"\n\t\t\t\t\t\t\t\t\tradar-id="footer-call"\n\t\t\t\t\t\t\t\t\ttext="{!attrs[\'sticky-reduce-all-texts\'] && i18n(\'Предложить звонок\')}"\n\t\t\t\t\t\t\t\t\ttitle="{i18n(\'Предложить звонок\')}"\n\t\t\t\t\t\t\t\t\tannotation="{!attrs[\'disable-calls-tip\'] && i18n(\'Участники встречи получат ссылку для видеозвонка и присоединятся, когда перейдут по ней\')}"\n\t\t\t\t\t\t\t\t\tico="categories:camera"\n\t\t\t\t\t\t\t\t\tbase\n\t\t\t\t\t\t\t\t\tclean\n\t\t\t\t\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\t\tdisabled="{!_this.isEnableCall()}"\n\t\t\t\t\t\t\t\t\tcentered="{attrs[\'sticky-reduce-one-text\']}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<fn:if test="enableFakeCreateTodo">\n\t\t\t\t\t\t\t<div class="letter__footer-button">\n\t\t\t\t\t\t\t\t<b:react-async\n\t\t\t\t\t\t\t\t\t\tcomponent="CreateTodo"\n\t\t\t\t\t\t\t\t\t\tcompact="{attrs[\'sticky-reduce-one-text\']}"\n\t\t\t\t\t\t\t\t\t\tletterId="{message.get(\'id\')}"\n\t\t\t\t\t\t\t\t\t\tponyMode="{ponyMode}"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\t\x3c!-- Кнопки Предложить звонок и Создать событие показываем только, если нет кнопки рассылки и метадаты для кнопки календаря --\x3e\n\t\t\t\t\t\t<div bem:elem="footer-button" fn:if="!attrs[\'disable-create-event\'] && !attrs[\'disable-footer-calendar\']">\n\t\t\t\t\t\t\t<b:calendar-button\n\t\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\t\tsticky-reduce-one-text="{attrs[\'sticky-reduce-one-text\']}"\n\t\t\t\t\t\t\t\t\tuse:mediator="calendar-manager"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\t\t\t\t\t<fn:if test="_this._showVkMessengerButton()">\n\t\t\t\t\t\t<div bem:elem="vk-chat-button" promo:id="toolbar-vk-chat">\n\t\t\t\t\t\t\t<fn:var name="vkMessengerParams" value="{_this._getVkMessengerParams()}" />\n\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\tqa:id="vk-messenger:open"\n\t\t\t\t\t\t\t\tremit:click="vk-messenger:open"\n\t\t\t\t\t\t\t\tevent:details="vkMessengerParams.href"\n\t\t\t\t\t\t\t\tradar-id="footer-vk"\n\t\t\t\t\t\t\t\ttext="{!attrs[\'sticky-reduce-one-text\'] && vkMessengerParams.text}"\n\t\t\t\t\t\t\t\ttitle="{vkMessengerParams.text}"\n\t\t\t\t\t\t\t\tico="social:vk"\n\t\t\t\t\t\t\t\tbase\n\t\t\t\t\t\t\t\tclean\n\t\t\t\t\t\t\t\ttouch="{attrs.touch && !attrs.mobile}"\n\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\tcentered="{attrs[\'sticky-reduce-one-text\']}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\x3c!-- Отписка из письма справа --\x3e\n\t\t\t\t\t<fn:if test="_this._showUnsubscribeButton() && !_this.isDatesMetadataEnabled()">\n\t\t\t\t\t\t<fn:apply-match name="unsubscribe"/>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t\x3c!-- Если есть дата для письма - приоритизируем кнопку создания события --\x3e\n\t\t\t\t\t<fn:if test="this.isDatesMetadataEnabled()">\n\t\t\t\t\t\t<div bem:elem="footer-button" fn:if="!attrs[\'disable-create-event\'] && !attrs[\'disable-footer-calendar\']">\n\t\t\t\t\t\t\t<b:calendar-button\n\t\t\t\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\t\t\t\tdates-metadata="{attrs[\'dates-metadata\']}"\n\t\t\t\t\t\t\t\t\tsticky-reduce-one-text="{attrs[\'sticky-reduce-one-text\']}"\n\t\t\t\t\t\t\t\t\tuse:mediator="calendar-manager"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<fn:var name="isMarusiaEnabled" value="{attrs[\'marusia-portal-enabled\'] && _this.isMarusiaReadLetterEnabled()}" />\n\t\t\t<fn:var name="isMarusiaAllEnabled" value="{attrs[\'marusia-portal-enabled\'] && attrs[\'marusia-read-all-letters\']}" />\n\t\t\t<fn:var name="marusiaRadarPrefix" value="{_this.getMarusiaReadLetterRadarPrefix()}" />\n\n\t\t\t<fn:var name="isSmartReplyEnabled" value="{attrs.smart_replies && _this.isEnableReply()}" />\n\n\t\t\t<div bem:elem="footer-controls" fn:if="(isMarusiaAllEnabled || isSmartReplyEnabled) && _this.isShowSmartReplyAndMarusia()">\n\t\t\t\t<span bem:elem="marusia-rl" fn:if="isMarusiaEnabled || isMarusiaAllEnabled">\n\t\t\t\t\t<fn:add-class name="ready" test="attrs.smart_replies_ready || isMarusiaAllEnabled"/>\n\t\t\t\t\t<b:marusia-rl-button\n\t\t\t\t\t\tmodel="{attrs.model}"\n\t\t\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\t\t\tuse:mediator="marusia-manager"\n\t\t\t\t\t\tradar-prefix="{marusiaRadarPrefix}"\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\n\t\t\t\t<fn:if test="isSmartReplyEnabled">\n\t\t\t\t\t<fn:for data="attrs.smart_replies" as="value" key="key">\n\t\t\t\t\t\t<span bem:elem="smart-reply" key="{key}" qa:id="smart-reply">\n\t\t\t\t\t\t\t<fn:add-class name="ready" test="attrs.smart_replies_ready"/>\n\t\t\t\t\t\t\t<bem:mod name="ponymode" test="attrs.ponymode"/>\n\t\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\t\tremit:click="compose:smartreply"\n\t\t\t\t\t\t\t\tevent:details="{model: attrs.model, key: key}"\n\t\t\t\t\t\t\t\ttext="{value}"\n\t\t\t\t\t\t\t\tcompact="{attrs.ponymode}"\n\t\t\t\t\t\t\t\tmedium="{!attrs.ponymode}"\n\t\t\t\t\t\t\t\tshadowless\n\t\t\t\t\t\t\t\tinvert\n\t\t\t\t\t\t\t\tradar-id="smart-reply{message.is(\'flags.smart_reply_stage\') ? \'_stage\' : \'\'}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</fn:for>\n\t\t\t\t</fn:if>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/letter/letter.html")});define("feast-tpl!ui-block/letter/letter.html",["feast-tpl!app/feast-tpl!ui-block/letter/letter.html"],function(a){return a});define("helpers/check-url-from-letter",["exports","default-values"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=b;function b(b){return a.SAFE_URL_LETTERS.test(b)}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/smime-attachments-metrics",["require","exports","@mail/xray"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.sendSMIMEAttachmentsMetrics=exports.SMIME_ALL_DEFAULT_FILENAMES=exports.SMIME_CERTIFICATE_DATA_DEFAULT_FILENAME=exports.SMIME_COMPRESSED_DATA_DEFAULT_FILENAME=exports.SMIME_SIGNATURE_DATA_DEFAULT_FILENAME=exports.SMIME_ENVELOPED_DATA_DEFAULT_FILENAME=exports.SMIME_DEFAULT_FILENAME=exports.SMIME_INVALID_EXTENSION=exports.SMIME_CERTIFICATE_DATA_FILE_EXTENSION=exports.SMIME_COMPRESSED_DATA_FILE_EXTENSION=exports.SMIME_SIGNED_DATA_FILE_EXTENSION=exports.SMIME_ENVELOPED_DATA_FILE_EXTENSION=exports.PKCS7_SIGNATURE_CONTENT_TYPE=exports.PKCS7_MIME_CONTENT_TYPE=void 0;a=__importDefault(a);exports.PKCS7_MIME_CONTENT_TYPE="application/pkcs7-mime";exports.PKCS7_SIGNATURE_CONTENT_TYPE="application/pkcs7-signature";exports.SMIME_ENVELOPED_DATA_FILE_EXTENSION="p7m";exports.SMIME_SIGNED_DATA_FILE_EXTENSION="p7s";exports.SMIME_COMPRESSED_DATA_FILE_EXTENSION="p7z";exports.SMIME_CERTIFICATE_DATA_FILE_EXTENSION="p7c";exports.SMIME_INVALID_EXTENSION="wrng";exports.SMIME_DEFAULT_FILENAME="smime";exports.SMIME_ENVELOPED_DATA_DEFAULT_FILENAME="".concat(exports.SMIME_DEFAULT_FILENAME,".").concat(exports.SMIME_ENVELOPED_DATA_FILE_EXTENSION);exports.SMIME_SIGNATURE_DATA_DEFAULT_FILENAME="".concat(exports.SMIME_DEFAULT_FILENAME,".").concat(exports.SMIME_SIGNED_DATA_FILE_EXTENSION);exports.SMIME_COMPRESSED_DATA_DEFAULT_FILENAME="".concat(exports.SMIME_DEFAULT_FILENAME,".").concat(exports.SMIME_COMPRESSED_DATA_FILE_EXTENSION);exports.SMIME_CERTIFICATE_DATA_DEFAULT_FILENAME="".concat(exports.SMIME_DEFAULT_FILENAME,".").concat(exports.SMIME_CERTIFICATE_DATA_FILE_EXTENSION);exports.SMIME_ALL_DEFAULT_FILENAMES=[exports.SMIME_ENVELOPED_DATA_DEFAULT_FILENAME,exports.SMIME_SIGNATURE_DATA_DEFAULT_FILENAME,exports.SMIME_COMPRESSED_DATA_DEFAULT_FILENAME,exports.SMIME_CERTIFICATE_DATA_DEFAULT_FILENAME];function b(b){var c=b.map(function(a){var b=a.get("name");var c=a.get("content_type");var d=c===exports.PKCS7_MIME_CONTENT_TYPE||c===exports.PKCS7_SIGNATURE_CONTENT_TYPE;var e=exports.SMIME_INVALID_EXTENSION;var f=false;switch(true){case b.endsWith("."+exports.SMIME_ENVELOPED_DATA_FILE_EXTENSION):{e=exports.SMIME_ENVELOPED_DATA_FILE_EXTENSION;f=b===exports.SMIME_ENVELOPED_DATA_DEFAULT_FILENAME&&c===exports.PKCS7_MIME_CONTENT_TYPE;break}case b.endsWith("."+exports.SMIME_SIGNED_DATA_FILE_EXTENSION):{e=exports.SMIME_SIGNED_DATA_FILE_EXTENSION;f=b===exports.SMIME_SIGNATURE_DATA_DEFAULT_FILENAME&&c===exports.PKCS7_SIGNATURE_CONTENT_TYPE;break}case b.endsWith("."+exports.SMIME_COMPRESSED_DATA_FILE_EXTENSION):{e=exports.SMIME_COMPRESSED_DATA_FILE_EXTENSION;f=b===exports.SMIME_COMPRESSED_DATA_DEFAULT_FILENAME&&c===exports.PKCS7_MIME_CONTENT_TYPE;break}case b.endsWith("."+exports.SMIME_CERTIFICATE_DATA_FILE_EXTENSION):{e=exports.SMIME_CERTIFICATE_DATA_FILE_EXTENSION;f=b===exports.SMIME_CERTIFICATE_DATA_DEFAULT_FILENAME&&c===exports.PKCS7_MIME_CONTENT_TYPE;break}}var g=e!==exports.SMIME_INVALID_EXTENSION;if(d||g){return{contentType:c,filename:b,extension:e,specCompliant:f}}return null}).filter(function(a){return!!a});if(c.length===0){return}if(c.length>1){a.default.send("smime",{i:["many"]});return}var d=c[0];var e=[];if(d.specCompliant){e.push("spec")}else{e.push("nospec")}e.push(d.extension);if(exports.SMIME_ALL_DEFAULT_FILENAMES.includes(d.filename)){e.push(d.filename.replace(".",""))}switch(d.contentType){case exports.PKCS7_MIME_CONTENT_TYPE:{e.push("pkcs7mime_".concat(d.extension));break}case exports.PKCS7_SIGNATURE_CONTENT_TYPE:{e.push("pkcs7sig_".concat(d.extension));break}}a.default.send("smime",{i:e})}exports.sendSMIMEAttachmentsMetrics=b});define("mediator/share-folders-manager/events",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ACTION_END_DATA_SOURCE_EVENT=exports.ShareEvents=void 0;exports.ShareEvents={letterActionClick:"sharefolders:accessletter:click",openShare:"sharefolders:opensharefolders",openShareOpportunities:"shareopportunities:openshareopportunities",denySharedFolder:"sharefolders:denysharedfolder"};exports.ACTION_END_DATA_SOURCE_EVENT="actionend"});define("feast-tpl!app/feast-tpl!ui-block/calendar-button/calendar-button.html",["feast"],function(a){return a.smartParse('<div qa:id="{attrs[\'dates-metadata\'] ? \'calendar:metadata:create\' : \'calendar:create\'}">\n    <b:button2\n        remit:click="calendar:create"\n        event:details="{model: attrs.model, createContent:\'web_email_letter_footer\'}"\n        radar-id="{_this._getRadarPrefix()}"\n        text="{!attrs[\'sticky-reduce-one-text\'] && _this._getCalendarButtonText()}"\n\t\tico="calendar-month"\n        base\n        pure\n        touch="{attrs.touch}"\n        model="{attrs.model}"\n        disabled="{attrs[\'disable-edit\']}"\n        centered="{attrs[\'sticky-reduce-one-text\']}"\n    />\n</div>\n',"app/feast-tpl!ui-block/calendar-button/calendar-button.html")});define("feast-tpl!ui-block/calendar-button/calendar-button.html",["feast-tpl!app/feast-tpl!ui-block/calendar-button/calendar-button.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/calendar-button/calendar-button",["require","exports","cfgUser","feast","feast-tpl!./calendar-button.html","helpers/date-alias","service/radars/index","ui-block/button2/button2"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);exports.default=b.default.Block.extend({name:"calendar-button",template:c.default,blocks:{button2:f.default},defaults:{model:null,"dates-metadata":null},attrChanged:{"dates-metadata":function(a){this.get("model").set("dates_metadata.priority_date",a)}},_getCalendarButtonText:function(){var b=this.get("dates-metadata");var c=a.default.get("LANG");var e={day:"numeric",month:"long",hour:"numeric",minute:"numeric"};if(b){var f=new Date(b.timestamp*1e3);var g=f.getTime()+(0,d.minute)(f.getTimezoneOffset());var h=c.split("_")[0]||"ru";var i=new Date(f.setTime(g)).toLocaleTimeString(h,e);if(h==="ru"){i=i.replace(","," в")}return i18n("Напомнить {dateWhen}",{dateWhen:i})}return i18n("Создать событие")},_getRadarPrefix:function(){return"footer-calendar"+(this.get("dates-metadata")?"_metadata":"")},didMount:function(){(0,e.default)("thread_letter_footer-calendar_"+(this.get("dates-metadata")?"metadata-render":"render"))}})});define("feast-tpl!app/feast-tpl!ui-block/letter-body-amp/letter-body-amp.html",["feast"],function(a){return a.smartParse("<div/>\n","app/feast-tpl!ui-block/letter-body-amp/letter-body-amp.html")});define("feast-tpl!ui-block/letter-body-amp/letter-body-amp.html",["feast-tpl!app/feast-tpl!ui-block/letter-body-amp/letter-body-amp.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/letter-body-amp/letter-body-amp",["require","exports","@mail/xray","default-values","feast","feast-tpl!./letter-body-amp.html","helpers/opener","service/auth","service/radars/decorator","service/radars/index","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);exports.default=c.default.Block.extend((0,g.default)({id:"amp",events:["mount","error"]})({name:"letter-body-amp",template:d.default,performanceTrace:"track",didUpdate:function(a){if(a["dark-mode"]!==this.attrs["dark-mode"]&&this.AMPViewer){this.AMPViewer.setTheme(this.is("dark-mode"))}},didMount:function(){var c=this;var d;var e=this.get("model");var f=e&&e.get("body.amp");if(!f){this.broadcast("error");return}this._fallbackPixel=b.AMP_SENDER_METRICS&&e&&((d=e.get("meta"))===null||d===void 0?void 0:d.find(function(a){return a&&typeof a==="object"&&a["@context"]==="http://schema.org"&&a["@type"]==="Action"&&a["agent"]==="AMP4Email"&&a["name"]==="ValidationError"&&typeof a["url"]==="string"}));(0,i.lazyIframeAmpViewer)().then((0,i.uniqCallback)(this,function(d){var e;var g=d.createAmpViewer;if(!c.isMounted()){return}c.AMPViewer=g({iframeSrc:b.AMP_IFRAME_PATH,cdnHost:"amp-lib/",proxyHost:b.AMP_PROXY_HOST,debug:b.IS_DEBUG,timeout:b.AMP_TIMEOUT,errorRadars:true,senderMetrics:{fallback:(e=c._fallbackPixel)===null||e===void 0?void 0:e.url}});c.AMPViewer.setup();c.AMPViewer.on("error",c.handleError.bind(c));c.AMPViewer.on("navigate",c.handleNavigate.bind(c));c.AMPViewer.on("radar",c.handleRadar.bind(c));c.el.appendChild(c.AMPViewer.iframe);c.AMPViewer.onChangeCssSelectorTheme(function(a){c.broadcast("change-css-selector-theme",a)});c.AMPViewer.setTheme(c.is("dark-mode"));c.AMPViewer.loadLetter({content:f,fromEmail:c.getFromEmail(),toEmail:c.getToEmail()});if(c._fallbackPixel){a.default.send("amp_fallback_pixel-exists")}c.broadcast("force-recalc")}))},getFromEmail:function(){var a=this.get("model");return a.get("correspondents.from.0.email")},getToEmail:function(){var a=f.default.user;return a&&a.getEmail()},didUnmount:function(){if(this.AMPViewer){this.AMPViewer.teardown()}},handleError:function(c){var d=this;b.IS_DEBUG&&console.error("Error from AMP Viewer",c);var e=this.getFromEmail();var f=this.getToEmail();window.require(["trackJS"],function(a){a.sendRadar("amp_log-error",{fromEmail:e,toEmail:f,error:c},"octavius_amp-error")});if(/^(js|timeout|validation|message_parse|lib_untrusted)$/.test(c.type)){window.setTimeout(function(){if(d._fallbackPixel){a.default.send("amp_fallback_tracked")}else{a.default.send("amp_fallback_untracked")}d.broadcast("error")},1)}},handleNavigate:function(a){var c=a.href;var d=document.createElement("a");d.href=c;if(!d.hostname){c=b.AMP_REDIRECT_URL}(0,e.default)(c)},handleRadar:function(a){(0,h.default)({type:"amp_".concat(a.t),intervals:a.i,value:a.v===undefined?1:a.v})}}))});define("feast-tpl!app/feast-tpl!ui-block/letter-calendar/letter-calendar.html",["feast"],function(a){return a.smartParse('<div qa:id="letter-calendar">\n\t<fn:var\n\t\tname="darkMode"\n\t\tvalue="{attrs[\'dark-mode\']}"\n\t/>\n\n\t<fn:value output="raw">attrs.html</fn:value>\n</div>\n',"app/feast-tpl!ui-block/letter-calendar/letter-calendar.html")});define("feast-tpl!ui-block/letter-calendar/letter-calendar.html",["feast-tpl!app/feast-tpl!ui-block/letter-calendar/letter-calendar.html"],function(a){return a});var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/letter-calendar/letter-calendar",["require","exports","feast","feast-tpl!./letter-calendar.html","lazy.modules"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);exports.default=a.default.Block.extend({name:"letter-calendar",template:b.default,defaults:{html:"","dark-mode":false},didUpdate:function(a){if(this.get("dark-mode")!=a["dark-mode"]){this.applyDarkosha()}},didUnmount:function(){if(this._darkosha){this._darkosha.destroy()}},didMount:function(){var a=this.get("calendars");if(!a.length){return}var b=a.map(function(a){return a.html});this.set("html",b.join("<br/>"));this.applyDarkosha()},getOrCreateDarkosha:function(){return __awaiter(this,void 0,Promise,function(){var a;return __generator(this,function(b){switch(b.label){case 0:if(!!this._darkosha)return[3,2];return[4,(0,c.lazyServiceDarkosha)()];case 1:a=b.sent().createConfiguredDarkosha;this._darkosha=a(this.el,this.is("dark-mode"));b.label=2;case 2:return[2,this._darkosha]}})})},applyDarkosha:function(a){var b=this;if(a===void 0){a=false}if(a&&this._darkosha){this._darkosha.destroy();this._darkosha=undefined}this.getOrCreateDarkosha().then(function(a){if(!a){return}if(b.is("dark-mode")){a.transform()}else{a.rollback()}})}})});define("feast-tpl!app/feast-tpl!ui-block/letter-confirm-receipt/letter-confirm-receipt.html",["feast"],function(a){return a.smartParse('<div qa:id="confirm-receipt">\n\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\n\t<div bem:elem="icon">\n\t\t<b:ico name="categories:mail" size="s" />\n\t</div>\n\n\t<div bem:elem="icon-touch">\n\t\t<div bem:elem="icon-touch-wrapper">\n\t\t\t<b:ico name="categories:mail" size="s" />\n\t\t</div>\n\t</div>\n\n\t<div bem:elem="wrapper">\n\t\t<div bem:elem="info">\n\t\t\t{i18n(\'Отправитель письма запросил подтверждение о прочтении.\')}\n\t\t\t<b:link\n\t\t\t\tfn:if="!attrs[\'hide-help-link\']"\n\t\t\t\thref="{attrs[\'help-link\']}"\n\t\t\t\ttext="{i18n(\'Что это?\')}"\n\t\t\t\ttarget="_blank"\n\t\t\t\tsecondary\n\t\t\t\tqa:id="help-link"\n\t\t\t/>\n\t\t</div>\n\n\t\t<div fn:if="!attrs.mobile" bem:elem="confirm">\n\t\t\t<b:button-link\n\t\t\t\tremit:click="confirm"\n\t\t\t\ttext="{i18n(\'Подтвердить, что прочитано\')}"\n\t\t\t\tqa:id="confirm-button"\n\t\t\t/>\n\t\t</div>\n\n\t\t<div fn:if="attrs.mobile" bem:elem="confirm-touch">\n\t\t\t<b:button2\n\t\t\t\t\tremit:click="confirm"\n\t\t\t\t\ttext="{i18n(\'Подтвердить прочтение\')}"\n\t\t\t\t\tprimary\n\t\t\t\t\tnowrap\n\t\t\t\t\ttext-overflow\n\t\t\t\t\tqa:id="confirm-button"\n\t\t\t/>\n\t\t</div>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/letter-confirm-receipt/letter-confirm-receipt.html")});define("feast-tpl!ui-block/letter-confirm-receipt/letter-confirm-receipt.html",["feast-tpl!app/feast-tpl!ui-block/letter-confirm-receipt/letter-confirm-receipt.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/button-link/button-link.html",["feast"],function(a){return a.smartParse('<div\n\tremit:click="click-radar"\n>\n\t\x3c!-- Аттрибуты --\x3e\n\t<fn:attr\n\t\t\tname="tabindex"\n\t\t\tvalue="{attrs[\'tab-index\']}"\n\t\t\ttest="attrs[\'tab-index\'] !== void 0"\n\t/>\n\n\t\x3c!-- Модификаторы --\x3e\n\t<bem:mod name="pressed" test="attrs.pressed"/>\n\t<bem:mod name="disabled" test="attrs.disabled"/>\n\t<bem:mod name="pony-mode" test="attrs.ponymode"/>\n\n\t<bem:mod name="type-{attrs.type}"/>\n\n\t\x3c!-- Текст контрола --\x3e\n\t<div bem:elem="text">{attrs.text}</div>\n\n\t\x3c!-- Иконка --\x3e\n\t<div bem:elem="icon" fn:if="attrs.icon">\n\t\t<b:ico name="{attrs.icon}" size="s"/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/button-link/button-link.html")});define("feast-tpl!ui-block/button-link/button-link.html",["feast-tpl!app/feast-tpl!ui-block/button-link/button-link.html"],function(a){return a});define("ui-block/button-link/button-link",["exports","feast","feast-tpl!./button-link.html","service/radars/decorator","ui-block/ico/ico"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend((0,g.default)({events:[{name:"click-radar",rename:"click"}]})({name:"button-link",template:f.default,blocks:{ico:h.default},defaults:{disabled:false,type:"default",icon:"",ponymode:false,pressed:false,text:""}}))});define("ui-block/letter-confirm-receipt/letter-confirm-receipt",["exports","default-values","feast","feast-tpl!./letter-confirm-receipt.html","helpers/radar-utils","service/radars/decorator","ui-block/button-link/button-link","ui-block/ico/ico","ui-block/link/link"],function(exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var i=o(b);var j=o(c);var k=o(e);var l=o(f);var m=o(g);var n=o(h);function o(a){return a&&a.__esModule?a:{default:a}}exports.default=i.default.Block.extend((0,k.default)({id:"confirm-receipt",events:[{name:"confirmreceipt",data:d.getModelId}]})({name:"letter-confirm-receipt",defaults:{"hide-help-link":a.CONFIRM_RECEIPT_HELP,"help-link":a.CONFIRM_RECEIPT_HELP_URL},template:j.default,blocks:{"button-link":l.default,ico:m.default,link:n.default}}))});define("feast-tpl!app/feast-tpl!ui-block/letter-contact/letter-contact.html",["feast"],function(a){return a.smartParse('<span\n\tqa:id="{attrs.dir}"\n\tqa:state="active:{attrs.active},dangerous:{!!attrs.dangerous}"\n\ttitle="{attrs.contact.email}"\n\tremit:contextmenu="rightclick"\n>\n\t<bem:mod name="active" test="attrs.active"/>\n\t<bem:mod name="dangerous" test="attrs.dangerous && attrs.dir === \'from\'"/>\n\t<bem:mod name="pony-mode" test="attrs[\'pony-mode\']"/>\n\n\t<fn:choose>\n\t\t<fn:when test="_this.isNameWithEmailMode()">\n\t\t\t{attrs.contact.name ? attrs.contact.name : attrs.contact.email}\n\t\t\t<span class="letter-contact__email">\n\t\t\t\t{attrs.contact.email}\n\t\t\t</span>\n\t\t</fn:when>\n\n\t\t<fn:otherwise>\n\t\t\t<fn:value>_this.getContact()</fn:value>\n\t\t</fn:otherwise>\n\t</fn:choose>\n\t<fn:value>attrs.isLast ? \'\' : \',\'</fn:value>\n</span>\n',"app/feast-tpl!ui-block/letter-contact/letter-contact.html")});define("feast-tpl!ui-block/letter-contact/letter-contact.html",["feast-tpl!app/feast-tpl!ui-block/letter-contact/letter-contact.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/letter-contact/letter-contact",["require","exports","@mail/features","default-values","feast","feast-mod/correspondents","feast-tpl!./letter-contact.html"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);e=__importDefault(e);exports.default=c.default.Block.extend({name:"letter-contact",template:e.default,blocks:{},mods:{correspondent:d.correspondent},defaults:{active:false,contact:{},dir:"to",isCurrent:false,dangerous:false,mode:undefined},isNameWithEmailMode:function(){var b=this.get("dangerous");return a.default.has("letter-show-email")&&this.get("mode")==="name-with-email"&&!b},getContact:function(){var a=this.get("isCurrent");var c=this.get("dir");var e=this.get("contact");var f=this.get("dangerous");var g=this.get("folder");var h=b.SHOW_SENDER_EMAIL_IN_SPAM_FOLDER&&g&&g.isSpam();if(a&&c!=="from"){return i18n("вам")}else if(f||h){return e.email}else{return(0,d.correspondent)(e)}}})});define("feast-tpl!app/feast-tpl!ui-block/letter-tooltip/letter-tooltip.html",["feast"],function(a){return a.smartParse('<div qa:id="letter-tooltip:{attrs.type}">\n\t\x3c!-- Переменные --\x3e\n\t<fn:var name="disabled" value="{attrs.loading}"/>\n\t<fn:var name="ponymode" value="{attrs.ponymode}"/>\n\n\t\x3c!-- Модификаторы --\x3e\n\t<bem:mod name="pony-mode" test="ponymode" />\n\t<bem:mod name="disabled" test="disabled" />\n\n\t<div bem:elem="wrapper">\n\t\t<div bem:elem="title">\n\t\t\t<fn:value>attrs[\'title-text\']</fn:value>\n\t\t</div>\n\n\t\t\x3c!-- Правый край --\x3e\n\t\t<div bem:elem="right">\n\t\t\t\x3c!-- Кнопка действия (ссылка) --\x3e\n\t\t\t<div bem:elem="action">\n\t\t\t\t<b:button-link\n\t\t\t\t\tqa:id="action"\n\t\t\t\t\tremit:click="action"\n\t\t\t\t\tdisabled="{disabled}"\n\t\t\t\t\tponymode="{ponymode}"\n\t\t\t\t\ttext="{attrs[\'action-text\']}"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t\x3c!-- Кнопка закрыть (крестик) --\x3e\n\t\t\t<div bem:elem="close">\n\t\t\t\t<b:button2\n\t\t\t\t\tqa:id="close"\n\t\t\t\t\tremit:click="close"\n\n\t\t\t\t\tcompact="{attrs.ponymode}"\n\t\t\t\t\tico="actions:close"\n\t\t\t\t\tsecondary\n\t\t\t\t\tshort\n\t\t\t\t\tsize="s"\n\t\t\t\t\tcentered\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/letter-tooltip/letter-tooltip.html")});define("feast-tpl!ui-block/letter-tooltip/letter-tooltip.html",["feast-tpl!app/feast-tpl!ui-block/letter-tooltip/letter-tooltip.html"],function(a){return a});define("ui-block/letter-tooltip/letter-tooltip",["exports","feast","feast-tpl!./letter-tooltip.html","service/radars/decorator","ui-block/button-link/button-link","ui-block/button2/button2"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=k(a);var g=k(b);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend((0,h.default)({events:["close","action"]})({name:"letter-tooltip",isolateEvents:true,template:g.default,blocks:{button:j.default,"button-link":i.default},defaults:{ponymode:false}}))});define("feast-tpl!app/feast-tpl!ui-block/marusia-read-letter-button/marusia-read-letter-button.html",["feast"],function(a){return a.smartParse('<div>\n\t<img\n\t\tbem:elem="img" src="{_this.getLogoSrc()}"\n\t\tremit:click="marusia:rl:button:click"\n\t\tevent:details="{model: attrs.model}"\n\t/>\n\t<div bem:elem="button">\n        <bem:mod name="ponymode" test="attrs.ponymode"/>\n\t\t<b:button2\n\t\t\ttext="{i18n(\'Прочитать письмо\')}"\n\t\t\tico="actions:play"\n\t\t\ticoSize="xs"\n\t\t\tshadowless\n\t\t\tinvert\n\t\t\tremit:click="marusia:rl:button:click"\n\t\t\tevent:details="{model: attrs.model}"\n\t\t\tcentered\n            compact="{attrs.ponymode}"\n            medium="{!attrs.ponymode}"\n\t\t/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/marusia-read-letter-button/marusia-read-letter-button.html")});define("feast-tpl!ui-block/marusia-read-letter-button/marusia-read-letter-button.html",["feast-tpl!app/feast-tpl!ui-block/marusia-read-letter-button/marusia-read-letter-button.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/marusia-read-letter-button/marusia-read-letter-button",["require","exports","default-values","feast","feast-tpl!./marusia-read-letter-button.html","mail/getters/MessageMeta","service/radars/index","ui-block/button2/button2"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockSpec=void 0;b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);exports.blockSpec={name:"marusia-read-letter-button",rootClassName:"marusia-rl-button",template:c.default,blocks:{button2:f.default},events:{"marusia:rl:button:click":"onClick"},didMount:function(){if(!this.isMounted()){return}this.radarSend("show")},onClick:function(a){var b=a.details.model,c=a.originalEvent;c.stopImmediatePropagation();this.broadcast("marusia:read:letter:click",{model:b});this.radarSend("click",b)},radarSend:function(a,b){if(b===void 0){b=this.get("model")}var c=(0,d.getCategoriesFromMeta)(b);(0,e.default)({type:"marusia-rl-".concat(a,"_").concat(this.get("radar-prefix")),dwh:{categories:c||[]}})},getLogoSrc:function(){return"".concat(a.PACKAGES_URL,"/static.promo/marusia/marusia-shadow.png")}};exports.default=b.default.Block.extend(exports.blockSpec)});define("feast-tpl!app/feast-tpl!ui-block/translator/translator.html",["feast"],function(a){return a.smartParse('<div qa:id="translator" xmlns:b="http://www.w3.org/1999/html" ref="translator">\n\t\x3c!-- Переменные --\x3e\n\t<fn:var name="disabled" value="{attrs.loading}" />\n\t<fn:var name="ponymode" value="{attrs.ponymode}" />\n\t<fn:var\n\t\tname="enableHideTranslator"\n\t\tvalue="{_this.getEnableHideTranslator()}"\n\t/>\n\n\t\x3c!-- Модификаторы --\x3e\n\t<bem:mod name="pony-mode" test="ponymode" />\n\t<bem:mod name="disabled" test="disabled" />\n\n\t<fn:if test="!attrs.promtLogoWithAdDropdown">\n\t\t<div bem:elem="icon">\n\t\t\t<bem:mod name="pony-mode" test="ponymode" />\n\t\t\t<b:react-async component="PromtTooltip" />\n\t\t</div>\n\t</fn:if>\n\n\t<div bem:elem="wrapper">\n\t\t\x3c!-- Ошибка --\x3e\n\t\t<fn:if test="attrs.error">\n\t\t\t<div bem:elem="error">{i18n(\'Не удалось перевести текст\')}</div>\n\t\t</fn:if>\n\n\t\t\x3c!-- Выбор языка перевода --\x3e\n\t\t<fn:if test="!attrs.error">\n\t\t\t<div bem:elem="title">{i18n(\'Перевод\')}:</div>\n\n\t\t\t<b:translator-select\n\t\t\t\tremit:language-change="from:change"\n\t\t\t\tselected="{attrs[\'from-selected\']}"\n\t\t\t\tdisabled="{disabled}"\n\t\t\t\tdisabled-item="{_this.getTo()}"\n\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\tcontainerRef="{_this.refs.translator}"\n\t\t\t\tid="from"\n\t\t\t\tqa:id="from"\n\t\t\t\tponymode="{ponymode}"\n\t\t\t/>\n\n\t\t\t<b:button2\n\t\t\t\tremit:click="reverse:click"\n\t\t\t\tqa:id="swap"\n\t\t\t\tico="navigation:arrow_swipe"\n\t\t\t\tponymode="{ponymode}"\n\t\t\t\tpure\n\t\t\t\tdisabled="{disabled}"\n\t\t\t\tcentered\n\t\t\t\tcompact\n\t\t\t/>\n\n\t\t\t<b:translator-select\n\t\t\t\tremit:language-change="to:change"\n\t\t\t\tselected="{attrs[\'to-selected\']}"\n\t\t\t\tdisabled="{disabled}"\n\t\t\t\tdisabled-item="{_this.getFrom()}"\n\t\t\t\tcompact="{attrs.compact}"\n\t\t\t\tcontainerRef="{_this.refs.translator}"\n\t\t\t\tid="to"\n\t\t\t\tqa:id="to"\n\t\t\t\tponymode="{ponymode}"\n\t\t\t/>\n\n\t\t\t<fn:if test="attrs.promtLogoWithAdDropdown">\n\t\t\t\t<div bem:elem="spinner">\n\t\t\t\t\t<bem:mod name="hidden" test="!disabled" />\n\t\t\t\t\t<b:spinner size="xxs" color="primary" />\n\t\t\t\t</div>\n\n\t\t\t\t<div bem:elem="translate">\n\t\t\t\t\t<b:button-link\n\t\t\t\t\t\tremit:click="translate:click"\n\t\t\t\t\t\tdisabled="{disabled}"\n\t\t\t\t\t\tponymode="{ponymode}"\n\t\t\t\t\t\tqa:id="translate"\n\t\t\t\t\t\ttext="{_this.getText()}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\t\t</fn:if>\n\n\t\t\x3c!-- Правый край --\x3e\n\t\t<div bem:elem="right">\n\t\t\t<fn:if test="!attrs.promtLogoWithAdDropdown">\n\t\t\t\t<div bem:elem="spinner" fn:if="disabled">\n\t\t\t\t\t<b:spinner size="xxs" color="primary" />\n\t\t\t\t</div>\n\n\t\t\t\t<div bem:elem="translate">\n\t\t\t\t\t<b:button-link\n\t\t\t\t\t\tremit:click="translate:click"\n\t\t\t\t\t\tdisabled="{disabled}"\n\t\t\t\t\t\tponymode="{ponymode}"\n\t\t\t\t\t\tqa:id="translate"\n\t\t\t\t\t\ttext="{_this.getText()}"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\t\t\t<fn:if test="attrs.promtLogoWithAdDropdown">\n\t\t\t\t<div bem:elem="icon">\n\t\t\t\t\t<bem:mod name="pony-mode" test="ponymode" />\n\t\t\t\t\t<bem:mod name="withAdDropdown" test="attrs.promtLogoWithAdDropdown" />\n\t\t\t\t\t<b:react-async component="PromtTooltip" />\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\n\t\t\t<div bem:elem="close">\n\t\t\t\t<bem:mod name="nearAdDropdown" test="attrs.promtLogoWithAdDropdown" />\n\t\t\t\t<b:button2\n\t\t\t\t\tfn:if="!enableHideTranslator"\n\t\t\t\t\tqa:id="close"\n\t\t\t\t\tremit:click="button-close:click"\n\t\t\t\t\tponymode="{ponymode}"\n\t\t\t\t\tico="actions:close"\n\t\t\t\t\tcentered\n\t\t\t\t\tcompact\n\t\t\t\t\tpure\n\t\t\t\t/>\n\t\t\t\t<b:dropdown\n\t\t\t\t\tfn:if="enableHideTranslator"\n\t\t\t\t\tqa:id="dropdown"\n\t\t\t\t\tico="actions:close"\n\t\t\t\t\tponymode\n\t\t\t\t\tpure\n\t\t\t\t\tremit:dropdown-change-state="dropdown-change"\n\t\t\t\t>\n\t\t\t\t\t<fn:match name="items">\n\t\t\t\t\t\t<b:list qa:id="translator-hide-list">\n\t\t\t\t\t\t\t<b:list-item qa:id="hide" remit:click="hide:click">\n\t\t\t\t\t\t\t\t{i18n(\'Не предлагать перевод\')}\n\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t\t<b:list-item qa:id="close" remit:click="dropdown-close:click">\n\t\t\t\t\t\t\t\t{i18n(\'Закрыть\')}\n\t\t\t\t\t\t\t</b:list-item>\n\t\t\t\t\t\t</b:list>\n\t\t\t\t\t</fn:match>\n\t\t\t\t</b:dropdown>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/translator/translator.html")});define("feast-tpl!ui-block/translator/translator.html",["feast-tpl!app/feast-tpl!ui-block/translator/translator.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/translator-select/translator-select.html",["feast"],function(a){return a.smartParse('<div>\n\t<b:select\n\t\tremit:item-click="language-change"\n\t\tselected-index="{_this.getSelectedIndex()}"\n\t\tdisabled-index="{_this.getDisabledIndex()}"\n\t\titems="{_this.getItems()}"\n\t>\n\t\t<fn:match\n\t\t\tname="control"\n\t\t\targs="selectedText, selectedItem, selectedIndex, expanded"\n\t\t>\n\t\t\t<div\n\t\t\t\tbem:elem="custom_control"\n\t\t\t\tremit:click="control-click"\n\t\t\t\tdisabled="{attrs.disabled}"\n\t\t\t>\n\t\t\t\t<bem:mod name="pressed" test="expanded" />\n\t\t\t\t<bem:mod name="pony-mode" test="attrs.ponymode" />\n\t\t\t\t<bem:mod name="compact" test="attrs.compact" />\n\n\t\t\t\t<span bem:elem="text" qa:id="folder-name-filter">\n\t\t\t\t\t<fn:value>_this.getText(selectedText)</fn:value>\n\t\t\t\t</span>\n\n\t\t\t\t\x3c!-- Стрелка --\x3e\n\t\t\t\t<div bem:elem="icon">\n\t\t\t\t\t<b:ico name="navigation:drop_down_small" size="s" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</fn:match>\n\t</b:select>\n</div>\n',"app/feast-tpl!ui-block/translator-select/translator-select.html")});define("feast-tpl!ui-block/translator-select/translator-select.html",["feast-tpl!app/feast-tpl!ui-block/translator-select/translator-select.html"],function(a){return a});define("ui-block/translator-select/translator-select",["exports","feast","feast-tpl!./translator-select.html","mail/actions/Translate","ui-block/button2/button2","ui-block/select/select"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=k(a);var g=k(b);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}var l=[{key:h.default.RUSSIAN,text:i18n("Русский")},{key:h.default.ENGLISH,text:i18n("Английский")},{key:h.default.GERMAN,text:i18n("Немецкий")},{key:h.default.FRENCH,text:i18n("Французский")},{key:h.default.SPANISH,text:i18n("Испанский")}];var m={};l.forEach(function(a,b){a.index=b;m[a.key]=a});exports.default=f.default.Block.extend({name:"translator-select",isolateEvents:true,template:g.default,blocks:{button2:i.default,select:j.default},defaults:{selected:null,disabled:false,"disabled-item":null,ponymode:false},getText:function a(b){var c=this.get("containerRef");var d=c.clientWidth>=660;return d?b:b.slice(0,3)+"."},getItems:function a(){return l},getSelectedIndex:function a(){return this.getIndexByValue(this.get("selected"))},getDisabledIndex:function a(){return this.getIndexByValue(this.get("disabled-item"))},getIndexByValue:function a(b){var c=m[b];return c&&c.index}})});define("ui-block/translator/translator",["exports","@mail/xray","default-values","feast","feast-tpl!./translator.html","service/radars/decorator","ui-block/button-link/button-link","ui-block/button2/button2","ui-block/dropdown/dropdown","ui-block/ico/ico","ui-block/list/list","ui-block/list-item/list-item","ui-block/spinner/spinner","ui-block/translator-select/translator-select"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var n=z(a);var o=z(c);var p=z(d);var q=z(e);var r=z(f);var s=z(g);var t=z(h);var u=z(i);var v=z(j);var w=z(k);var x=z(l);var y=z(m);function z(a){return a&&a.__esModule?a:{default:a}}exports.default=o.default.Block.extend((0,q.default)({events:["hide","close","original","retry","translate","reverse"]})({name:"translator",isolateEvents:true,template:p.default,blocks:{list:v.default,listItem:w.default,dropdown:t.default,button2:s.default,"button-link":r.default,ico:u.default,spinner:x.default,"translator-select":y.default},events:{"from:change":"onFromChange","to:change":"onToChange","translate:click":"onTranslateClick","reverse:click":"onReverse","dropdown-close:click":"onTranslatorDropdownClose","button-close:click":"onTranslatorButtonClose","hide:click":"onTranslatorHide","dropdown-change":"onTranslatorCloseDropdownClick"},defaults:{error:false,"from-selected":"ru","from-default-selected":"ru",loading:false,ponymode:false,"to-selected":"en",translated:false,"is-translator-visible":false,promtLogoWithAdDropdown:b.PROMT_LOGO_WITH_AD_DROPDOWN},getText:function a(){if(this.is("error")){return i18n("Попробовать ещё раз")}if(this.is("translated")){return i18n("Оригинал")}return i18n("Перевести")},onReverse:function a(){this.broadcast("reverse");var c=this.getTo();var d=this.getFrom();if(b.DISABLE_AUTOMATED_TRANSLATE){this.set({"from-selected":c,"to-selected":d,translated:false});return}this.set({"from-selected":c,"to-selected":d});this.translate()},onFromChange:function a(c){var d=c.details;if(b.DISABLE_AUTOMATED_TRANSLATE){this.set({"from-selected":d.key,translated:false});return}this.set("from-selected",d.key);this.translate()},onToChange:function a(c){var d=c.details;if(b.DISABLE_AUTOMATED_TRANSLATE){this.set({translated:false,"to-selected":d.key});return}this.set("to-selected",d.key);this.translate()},onTranslatorCloseDropdownClick:function a(b){if(b.details.state){n.default.send("translator_close-dropdown_click")}},onTranslatorButtonClose:function a(){n.default.send("translator_close-button_click");this.broadcast("close")},onTranslatorDropdownClose:function a(){n.default.send("translator_close-dropdown_close_click");this.broadcast("close")},onTranslatorHide:function a(){n.default.send("translator_close-dropdown_hide_click");this.broadcast("hide")},onTranslateClick:function a(){if(this.is("error")){this.retry();return}if(this.is("translated")){this.showOriginal()}else{n.default.send("letter_manual_translate",{dwh:{disableAutomatedTranslate:b.DISABLE_AUTOMATED_TRANSLATE,letterId:this.get("letterId")}});this.translate()}},getTo:function a(){return this.get("to-selected")},getEnableHideTranslator:function a(){return b.ENABLE_HIDE_TRANSLATOR&&!this.get("is-translator-visible")},getFrom:function a(){return this.get("from-selected")},retry:function a(){this.broadcast("retry",{tolang:this.getTo(),fromlang:this.getFrom()})},showOriginal:function a(){this.broadcast("original",{tolang:this.getTo(),fromlang:this.getFrom()})},translate:function a(){var b=this.getTo();var c=this.getFrom();if(!b||!c){return}this.broadcast("translate",{tolang:b,fromlang:c})},getPromtLogoHref:function a(){return b.PROMT_LOGO_HREF},didMount:function a(){this.set("from-selected",this.get("from-default-selected"));this.set("to-selected",this.get("to-default-selected"))}}))});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/letter/letter",["require","exports","@mail/flags","@mail/operands","@mail/xray","actions/checkContactsPossessing","cfgUser","default-values","feast","feast-mod/avatar","feast-mod/correspondents","feast-mod/letter-date","feast-tpl!./letter.html","helpers/add-merchant-param","helpers/browser","helpers/check-url-from-letter","helpers/data-source-dispatch","helpers/get-adaptive","helpers/getFeaturesStringByPrefix","helpers/letter","helpers/object-to-query","helpers/opener","helpers/querystring-add","helpers/radar-utils","helpers/resizer","helpers/smime-attachments-metrics","mail/Folder","mail/getters/MessageMeta","mail/Message","mediator/share-folders-manager/events","service/calls","service/contextmenu","service/layer","service/promo","service/radars/decorator","service/radars/index","service/smokescreen","service/storage","service/viewer","service/vkMessengerLoader","ui-block/attach-list/attach-list","ui-block/avatar/avatar","ui-block/badge/badge","ui-block/button2/button2","ui-block/calendar-button/calendar-button","ui-block/dropdown/dropdown","ui-block/dropdown-actions/dropdown-actions","ui-block/ico/ico","ui-block/letter-body/letter-body","ui-block/letter-body-amp/letter-body-amp","ui-block/letter-calendar/letter-calendar","ui-block/letter-category/letter-category","ui-block/letter-confirm-receipt/letter-confirm-receipt","ui-block/letter-contact/letter-contact","ui-block/letter-meta/letter-meta","ui-block/letter-status2/letter-status2","ui-block/letter-tooltip/letter-tooltip","ui-block/list/list","ui-block/list-item/list-item","ui-block/marusia-read-letter-button/marusia-read-letter-button","ui-block/translator/translator","../../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba,ca,da,ea,fa,ga){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.blockSpec=void 0;a=__importDefault(a);c=__importDefault(c);e=__importDefault(e);g=__importDefault(g);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);q=__importDefault(q);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);w=__importDefault(w);y=__importDefault(y);A=__importDefault(A);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);I=__importDefault(I);J=__importDefault(J);K=__importDefault(K);M=__importDefault(M);N=__importDefault(N);O=__importDefault(O);P=__importDefault(P);Q=__importDefault(Q);R=__importDefault(R);S=__importDefault(S);T=__importDefault(T);U=__importDefault(U);V=__importDefault(V);W=__importDefault(W);X=__importDefault(X);Y=__importDefault(Y);Z=__importDefault(Z);_=__importDefault(_);aa=__importDefault(aa);ba=__importDefault(ba);ca=__importDefault(ca);da=__importDefault(da);ea=__importDefault(ea);fa=__importDefault(fa);var ha=(0,w.default)();var ia=function(a){var b=a.lastIndexOf(".")+1||a.length;return a.slice(b).toLowerCase()};var ja={head:{offsetSide:"top",offsetPadding:"paddingTop",className:"letter__head"},footer:{offsetSide:"bottom",offsetPadding:"paddingBottom",className:"letter__footer"}};exports.blockSpec={name:"letter",template:k.default,performanceTrace:"track",isolateEvents:false,updateLastSeenUnsubscribe:null,mods:{correspondent:i.correspondent,correspondentsCount:i.correspondentsCount,getLocaleDateFull:j.getLocaleDateFull},isFooterHiddenRadarSended:false,isSmartReplyHiddenRadarSended:false,blocks:{avatar:N.default,"attach-list":M.default,badge:O.default,button2:P.default,"calendar-button":Q.default,dropdown:R.default,"dropdown-actions":S.default,"letter-calendar":W.default,"letter-body":U.default,"letter-confirm-receipt":Y.default,"letter-contact":Z.default,"letter-body-amp":V.default,"letter-category":X.default,"letter-status2":aa.default,"letter-tooltip":ba.default,translator:fa.default,ico:T.default,"letter-meta":_.default,list:ca.default,"list-item":da.default,"marusia-rl-button":ea.default},lazyBlocks:{unsubscribe:ga.lazyUIUnsubscribe},events:{"attaches:cloud:all":"onAttachmentsCloud","attaches:cloud:one":"onAttachmentCloud","attaches:open":"onAttachmentClick",clickavatar:"onContactShow","contact:click":"onContactShow","details:expand":"onToggleDetails","letter:body:allowedattrclick":"onAllowedAttrClick","letter:body:data-attr:click":"onLetterDataAttributeClick","letter:body:finepayment":"onFinePaymentClick","letter:body:finepaymentright":"onFinePaymentRightClick","letter:body:monetapayment":"onMonetaPaymentClick","letter:body:tomyself":"onToMyselfClick","letter:draft:forward":"onLetterComposeFromDraft","letter:draft:reply":"onLetterComposeFromDraft","letter:draft:replyall":"onLetterComposeFromDraft","translator:close:click":"onTranslatorClose","translator:hide:click":"onTranslatorHide","translator:original:click":"onTranslatorOriginal","translator:retry:click":"onTranslatorTranslate","translator:translate:click":"onTranslatorTranslate","letter-tooltip:show-images:click":"onTooltipShowImagesClick","letter-tooltip:close":"onTooltipClose","amp:error":"onAmpError","dark-mode:toggle":"onDarkModeToggle","calls:groupcall":"onCallTo","details:collapse":"onToggleDetails","vk-messenger:open":"onVkMessengerOpen","amp:change-css-selector-theme":"setCssSelectorThemeAMP"},defaults:{"disable-category":true,"hover-support":m.default.capabilities["hover-support"],"native-sticky":!f.IS_READLETTER_NATIVE_STICKY_DISABLED,"is-translator-error":false,"is-translator-visible":false,"is-translator-loading":false,"is-translator-forced-shown":false,"is-automated-show-translator-radar-send":false,"is-letter-in-english-radar-send":false,"is-letter-translated":false,model:null,"dates-metadata":null,ponymode:false,"quotes-collapsed-default":true,"smart-reply-on":true,sticky:null,"sticky-head":false,"sticky-footer":false,"enable-body-scale":false,"max-scale":.5,"enable-amp":f.ENABLE_AMP,"feature-unsubscribe":f.FEATURE_UNSUBSCRIBE,"disable-translate":f.DISABLE_TRANSLATE,"disable-create-event":f.DISABLE_CREATE_EVENT,"invite-call":f.CALLS,"disable-head-calendar":f.DISABLE_LETTER_HEAD_CALENDAR,"disable-head-call":f.CALLS_DISABLE_LETTER_HEAD_CALL,"disable-head-print":f.DISABLE_HEAD_PRINT,"disable-calendar-newsletters":f.DISABLE_LETTER_CALENDAR_NEWSLETTERS,"disable-call-newsletters":f.CALLS_DISABLE_LETTER_CALL_NEWSLETTERS,"disable-footer-calendar":f.DISABLE_LETTER_FOOTER_CALENDAR,"disable-footer-call":f.CALLS_DISABLE_LETTER_FOOTER_CALL,"disable-call":f.CALLS_DISABLE_LETTER_CALL,"disable-calls-tip":f.DISABLE_CALLS_TIP,"enable-tags":f.ENABLE_TAGS,"translator-default-from":"en","translator-default-to":"ru","amp-error":false,isThemedAMP:true,"address-header-calendar":f.ADDRESS_HEADER&&f.ADDRESS_HEADER_CALENDAR,"dark-mode-enabled":true,"category-feedback":f.CATEGORY_FEEDBACK_SUBMENU,"is-tooltip-visible":true,"marusia-read-all-letters":f.MARUSIA_READ_ALL_LETTERS,"smart-card-ics":f.SMART_CARD_ICS,"show-attach-safety-status":f.SHOW_ATTACH_SAFETY_STATUS,"has-attach-safety-status-background":f.HAS_ATTACH_SAFETY_STATUS_BACKGROUND,"attach-safety-status-position":f.ATTACH_SAFETY_STATUS_POSITION},attrChanged:{model:function(a){var b=this;window.setTimeout(function(){var b=a.get("attaches").list;(0,H.default)("letter_attaches",b.length);try{(0,x.sendSMIMEAttachmentsMetrics)(b)}catch(a){}},500);if(this.isSmartRepliesAvailable(a)){this.set("smart_replies_ready",!!a.getSmartReply());var c=a.is("flags.smart_reply_stage")?"_stage":"";(0,H.default)("smart_replies"+c+"_try-show");a.fetchSmartReply().then(function(a){b.set("smart_replies",a.get("replies"));(0,H.default)("smart_replies"+c+"_show");if(a.is("is_default")){(0,H.default)("smart_replies_default"+c+"_show")}F.default.update()},function(){(0,H.default)("smart_replies"+c+"_show-fail")})}},sticky:function(a,b){a=a||{};b=b||{};if(b.head!==a.head){this.updateSticky("head",a.top,a.headFade,!!a.maxWidth)}if(b.footer!==a.footer){this.updateSticky("footer",a.bottom,a.footerFade,!!a.maxWidth)}},"sticky-position":function(a){var b=this.get("sticky");if(b){this.updateSticky("head",b.top,false,!!a.maxWidth);this.updateSticky("footer",b.bottom,false,!!a.maxWidth)}},"dates-metadata":function(a){this.get("model").set("dates_metadata.priority_date",a)}},constructor:function(){g.default.Block.apply(this,arguments)},getOriginalEvent:function(a){return this.reactComponent?a.originalEvent:a.originalEvent.originalEvent},updateOnlineStatus:function(a){if(!a||!f.LETTER_LASTSEEN_REQUEST){return}var b=a.status_id===f.LASTSEEN_ONLINE_STATUS;c.default.send("lastseen-v2-letter-".concat(b?"online":"offline"),{skipdwh:true});this.set("isOnline",b)},updateSenderLastSeen:function(){var a=this;if(!f.LETTER_LASTSEEN_REQUEST){return}var b=this.get("model");var c=b.get("correspondents.from.0");var d=this.get("getLastSeen");d===null||d===void 0?void 0:d([c.email]).then(function(b){var d=b.payload;var e=d[c.email];a.updateOnlineStatus(e)})},_windowResizeListeners:{},didMount:function(){var a=this.get("model");this.updateSenderLastSeen();var b=this.getMessageCorrespondents().concat(a.get("correspondents").from||[]).map(function(a){return a.email});this.broadcast("addressbook:refetchcontacts",b);this._sendVkMessengerEvent("open_mail_with_vk_messenger");var c=this.updateOnlineStatus.bind(this);this.updateLastSeenUnsubscribe=d.checkContactsPossessing.fulfilled.subscribe(function(b){var d=b.payload;if(!(d===null||d===void 0?void 0:d.contacts)){return}var e=a.get("correspondents.from.0");var f=d.contacts[e.email];if(!f){return}c(f)});this.updateStickyStatus=this.updateStickyStatus.bind(this);this.stickyDisabled=false;if(!this.is("readonly")){this.adaptiveHandler=new p.GetAdaptive({pureBreakpoints:true,breakpoints:[{conditions:function(a){return a.height<f.MIN_LETTER_HEIGHT_STICKY},props:{element:"footer",disableSticky:true,position:0,fade:!this.get("sticky")}},{props:{element:"footer",disableSticky:false,position:0,fade:!this.get("sticky")}}],onResize:this.updateStickyStatus,element:this.el.closest(".".concat(I.default.lookup("scrollable_content")))||this.el.closest(".".concat(I.default.lookup("panel-with-selected")))})}},didUnmount:function(){var a=this;var b,c;Object.keys(this._windowResizeListeners).forEach(function(b){return a._stopStickyTracking(a._windowResizeListeners[b])});ha.unbind();(b=this.updateLastSeenUnsubscribe)===null||b===void 0?void 0:b.call(this);(c=this.adaptiveHandler)===null||c===void 0?void 0:c.destroy()},onAttachmentClick:function(a){var b=this.get("model");var c=this.get("router");var d=this.get("route");var e=a.details;if(e.get("flags.eml")){var f=b.get("folder");var g=d.params.part?d.params.letter:"0:".concat(b.id,":").concat(f);(0,t.default)(c.getUrl("#read-letter",{folder:f,letter:g,part:e.id}))}else{K.default.open({attachment:e,message:b,router:c,newWindow:true})}},onAttachmentCloud:function(a){this.onAttachmentsCloud(__assign(__assign({},a),{details:[a.details]}))},onAttachmentsCloud:function(a){var b=this.get("model");var c=a.details.filter(function(a){return!a.isLink()&&!a.isCloud()});this.broadcast("attachments:tocloud",{message:b,attachments:c})},onLetterDataAttributeClick:function(a){var b=a.details;var c=this.getOriginalEvent(a);switch(b.type){case"share-folder-access":this.broadcast(B.ShareEvents.letterActionClick,b,c);break;case"mentions":if(!f.ENABLE_MENTIONS){break}var d=a.target.dataset.mentionEmail;var e=a.target.dataset.mentionName;a.originalEvent=c;a.details.email=d;a.details.name=e;a.details.avatars={"50x50":(0,h.avatarUrl)(d,e,50),default:(0,h.avatarUrl)(d,e,90)};this.onContactShow(a);break}},onAllowedAttrClick:function(a){var b=a.details;var c=this.getOriginalEvent(a);var d=c.target.getAttribute("data-url");if((0,n.default)(d)){c.preventDefault();c.stopImmediatePropagation();var e=b.skin,f=b.uidl;if(f){var g=this.get("model").id;d=(0,u.default)(d,{uidl:g})}E.default.openIframeLayer({paramsKey:e,additionalParams:{url:d},factoryParams:{dimmer:true,"close-on-esc":true}})}},onToggleDetails:function(){this.set("details-expanded",!this.get("details-expanded"))},formFinePaymentUrl:function(a){var b=a.target.dataset,c=b.id,d=b.sig;var e=this.get("model").id;var f="web";var g="letter_gd-exp";var h=(0,q.default)("gibdd");var i={id:c,sig:d,uidl:e,from:g,mp:f,ftrs:h};return"/fines/pay?".concat((0,s.default)(i))},onFinePaymentRightClick:function(a){var b=this.getOriginalEvent(a);var c=b.target.dataset,d=c.id,e=c.sig;var f=this.formFinePaymentUrl(b);var g=(0,n.default)(f);if(d&&e&&g){b.target.setAttribute("href",f)}},onFinePaymentClick:function(a){var b=this.getOriginalEvent(a);var c=b.target.dataset,d=c.id,e=c.sig;var f=this.formFinePaymentUrl(b);var g=(0,n.default)(f);if(d&&e&&g){b.preventDefault();b.stopImmediatePropagation();E.default.openIframeLayer({paramsKey:"gibdd_group",additionalParams:{url:f},factoryParams:{dimmer:true,"close-on-esc":true}})}},onMonetaPaymentClick:function(a){var b=this.getOriginalEvent(a);var c=b.target.getAttribute("data-url");if((0,n.default)(c)){b.preventDefault();b.stopImmediatePropagation();var d=b.target.getAttribute("data-moneta");var e="unsubscribe";var g="subscribe";var h=680;var i=683;var j="payment";if(d===e){h=420;i=341;j="unsubscribe"}else if(d===g){j="subscribe"}c=c.replace(f.MONETA_PAYMENT_LETTER_URL_REGEXP,window.location.origin+"/");c=c.replace("__monetaUidl__",this.get("model").id);var k={dimmer:true,from:"letter",scenario:j};if(f.PAYMENT_CENTER_NOT_HIDDEN){k["close-on-dimmer"]=false}c=(0,l.default)(c,{from:"letter",mp:"web"});E.default.open("moneta",{url:c,width:h,height:i},k)}},onToMyselfClick:function(){E.default.open("confirm-tomyself-enable",{},{compact:true,dimmer:true,resolvable:true,"close-on-dimmer":false,"close-on-esc":false,"reject-on-close":true}).then(function(){var b=a.default.get("to-myself").isActive();if(!b){(0,o.default)({type:"TOGGLE_TO_MYSELF_METATHREAD",state:true,uid:undefined});(0,H.default)("letter_myself_on")}}).catch(function(a){if(a){(0,H.default)("ltr_mslf_open_err_".concat(a));throw a}})},onLetterComposeFromDraft:function(a){var b=a.type,c=a.details;var d=b.split(":").pop();var e=c.model,f=c.draftId;this.broadcast("compose:draft",{model:new A.default({id:f}),source:{id:e.get("id"),mode:d}})},onContactShow:function(a){a.details.type="correspondent";a.details.checkContactPossessing=this.get("checkContactPossessing");a.details.messageModel=this.get("model");D.default.show(a,{mobile:this.get("mobile")})},onTranslatorClose:function(){this.broadcast("translator:close",{model:this.get("model"),block:this})},onTranslatorHide:function(){this.broadcast("translator:hide",{model:this.get("model"),block:this})},onTranslatorOriginal:function(a){var b=a.details;this.broadcast("letter:original",{options:b,model:this.get("model"),block:this})},onTranslatorTranslate:function(a){var b=a.details;this.broadcast("letter:translate",{options:b,model:this.get("model"),block:this})},onTooltipShowImagesClick:function(){var a=this.get("model");A.default.fetchData({id:a.get("id"),folder_id:a.get("folder"),bulk_show_images:true},true,true).then(function(b){var c=a.getTranslationLast()||{},d=c.fromlang,e=c.tolang;if(d&&e){a.resetTranslation(d,e,"body.html")}var f=b.body;a.setCachedBody(f);a.set(b)})},onTooltipClose:function(){this.set("is-tooltip-visible",false)},onVkMessengerOpen:function(a){var b=this;var c=a.details;this._sendVkMessengerEvent("in_mail_toolbar_click_vk_messenger");if(f.VK_MESSENGER_EXTERNAL){(0,t.default)(c);return}L.vkMessengerLoader.open({chatId:c,onShow:function(){b._sendVkMessengerEvent("in_mail_open_vk_messenger")},darkMode:this.is("dark-mode")})},isLetterTranslated:function(){return this.is("is-letter-translated")},isTranslationLoading:function(){return this.is("is-translator-loading")},isTranslatorVisible:function(){var b=this.get("model");var d=b.is("flags.in_english");var g=a.default.get("translator-hide").isActive();var h=this.get("is-translator-forced-shown");var i=e.default.get("LANG");if(this.get("is-translator-visible")){return true}if(f.ENABLE_HIDE_TRANSLATOR&&g){return false}if(d&&!this.get("is-letter-in-english-radar-send")){c.default.send("letter_in_english",{dwh:{letterId:b.id,user_english:i==="en_US"}});this.set("is-letter-in-english-radar-send",true,true)}if(f.AUTOMATED_SHOW_TRANSLATOR&&!h&&!this.is("preview-mode")&&d&&i!=="en_US"){if(!this.get("is-automated-show-translator-radar-send")){c.default.send("letter_translator_show",{dwh:{letterId:b.id,automated_show:true,in_english:d}});this.set("is-automated-show-translator-radar-send",true,true)}return true}return false},isTooltipVisible:function(){return!this.is("preview-mode")&&this.is("is-tooltip-visible")},isImagesHiddenTooltipVisible:function(){var a=this.get("model");var b=a.get("images");var c=a.getFolder();var d=a.getCachedBody();return c.isSpam()&&b.exists&&b.hidden&&!d},getAttachmentsDowloadLink:function(){var a=this.get("model");var b=a.getAttachmentsDowloadLink();if(!b&&a.get("attaches.list.length")===1){var c=a.get("attaches.list.0");b=c.getDownloadUrl()}return b},getLetterBody:function(){var a=this.getLetterBodyTranslation();var b=this.get("model");var c=b.get("images");var d=b.getCachedBody();if(c.exists&&c.hidden&&d&&d.html){b.set("body.html",d.html)}return a||b.get("body.html")},getLetterBodyKey:function(){var a=this.getLetterBodyTranslation();var b=this.get("model");var c=b.getTranslationLast()||{},d=c.fromlang,e=c.tolang;var f=this.get("model").id;var g=a?"".concat(d,":").concat(e):"";var h=b.get("images.hidden")?1:0;var i=this.isDarkMode()?1:0;return"".concat(f,"_").concat(g,"_").concat(i,"_").concat(h)},getLetterBodyTranslation:function(){var a=this.get("model");var b=a.getTranslationLast()||{},c=b.fromlang,d=b.tolang;if(!this.isLetterTranslated()||!this.isTranslatorVisible()||!c||!d){return""}return a.getTranslation(c,d,"body.html")},getMessageCorrespondents:function(){var a=this.get("model");var b=a.get("correspondents"),c=b.to,d=c===void 0?[]:c,e=b.cc,f=e===void 0?[]:e,g=b.bcc,h=g===void 0?[]:g;return[].concat.call([],d,f,h)},isLetterIdEq:function(a){return a===this.get("model").id},canCallTo:function(a){var b=__spreadArray(__spreadArray(__spreadArray([],a.get("correspondents.from")||[],true),a.get("correspondents.to")||[],true),a.get("correspondents.cc")||[],true);return f.CALLS_P2P_OUTGOING&&C.default.getCallsAPIClient().canCallTo(b.map(function(a){return a.email})).some(function(a){return a.canCall})},onCallTo:function(a){var b=a.details;var c=__spreadArray(__spreadArray(__spreadArray([],b.get("correspondents.from")||[],true),b.get("correspondents.to")||[],true),b.get("correspondents.cc")||[],true);C.default.getCallsAPIClient().callTo(c.map(function(a){return a.email})).then(function(a){if(a.redirectUrl){(0,t.default)(a.redirectUrl)}})},updateStickyStatus:function(a){var b=a.element,c=a.disableSticky,d=a.position,e=a.fade;this.stickyDisabled=c;this.updateSticky(b,d,e)},updateSticky:function(a,b,c,d){var e,g;if(d===void 0){d=false}var h=this.get("sticky-position");if(h==null){return}var i=h.right,j=h.left,k=h.width;var l=ja[a],m=l.offsetSide,n=l.offsetPadding,o=l.className;var p=this.el.getElementsByClassName(o)[0];if(!p){return}var q=p.getBoundingClientRect().height;if(b!==void 0&&!this.stickyDisabled){if(k){p.style.width=k+"px";p.style.left="";p.style.right=""}else{p.style.width="";p.style.left=j+"px";p.style.right=i+"px"}if(!f.IS_READLETTER_NATIVE_STICKY_DISABLED){this.set("sticky-".concat(a),true);p.style[m]="0px"}else{p.style[m]=b+"px";this.el.style[n]=q+"px";this.set((e={},e["sticky-".concat(a)]=true,e["sticky-".concat(a,"-fade")]=c,e));d?this._startStickyTracking(p,o,h):this._stopStickyTracking(o)}}else{p.style[m]="";p.style.left="";p.style.right="";p.style.width="";this.el.style[n]="";this.set((g={},g["sticky-".concat(a)]=false,g["sticky-".concat(a,"-fade")]=false,g),false)}},_startStickyTracking:function(a,b,c){if(this._windowResizeListeners[b]){this._stopStickyTracking(b)}var d=function(){if(window.innerWidth>c.maxWidth+c.left+c.right){a.style.left="";a.style.right="";a.style.width="".concat(c.maxWidth,"px")}else{a.style.left="".concat(c.left,"px");a.style.right="".concat(c.right,"px");a.style.width=""}};window.addEventListener("resize",d);this._windowResizeListeners[b]=d;d()},_stopStickyTracking:function(a){var b=this._windowResizeListeners[a];if(b){delete this._windowResizeListeners[a];window.removeEventListener("resize",b)}},_showDropdownCallButton:function(){var a=this._showUnsubscribeButton()&&this.is("disable-call-newsletters");return this.is("invite-call")&&!this.is("disable-call")&&!a},_showHeadCallButton:function(){var a=this._showUnsubscribeButton()&&this.is("disable-call-newsletters");return this.is("invite-call")&&!this.is("disable-call")&&!this.is("disable-head-call")&&!a},_showDropdownCalendarButton:function(){var a=this._showUnsubscribeButton()&&this.is("disable-calendar-newsletters");return!this.is("disable-create-event")&&!a},_showHeadCalendarButton:function(){var a=this._showUnsubscribeButton()&&this.is("disable-calendar-newsletters");return!this.is("disable-create-event")&&!this.is("disable-head-calendar")&&!a},_showUnsubscribeButton:function(){if(this.get("mobile")){return false}var a=this.get("model");var b=a.getFolder();if(b.isSpam()){return false}return this.is("feature-unsubscribe")&&a.get("flags.newsletter")},_showVkMessengerButton:function(){var a=this.get("transaction-metadata");if(!a){return false}var b=a.get("vk_chat_href");if(!b){return false}return true},_getVkMessengerParams:function(){var a=this.get("transaction-metadata");var b=a===null||a===void 0?void 0:a.get("vk_chat_href");var c=a===null||a===void 0?void 0:a.get("vk_chat_id");var d=a===null||a===void 0?void 0:a.get("shop_name");return{href:f.VK_MESSENGER_EXTERNAL?b:c,text:d?i18n("Чат с {shopName}",{shopName:d}):i18n("Чат в VK")}},_sendVkMessengerEvent:function(a){if(!this._showVkMessengerButton()){return}var d=this.get("model");var e=this.get("transaction-metadata");var g={is_order:d.get("transaction_category")===b.CategoryTypes.ORDER,letter_id:d.get("id"),partner_email:d.get("correspondents.from.0.email"),partner_name:e.get("shop_name")};if(a!=="open_mail_with_vk_messenger"){g.destination=f.VK_MESSENGER_EXTERNAL?"outside":"inside"}if(a==="in_mail_open_vk_messenger"){g.from="toolbar"}c.default.send(a,{dwh:g})},_showFilterButton:function(){return!f.FORBID_FILTERS},_showSpam:function(){var a=this.get("model").getFolder();return!f.FORBID_SPAM&&!a.isSpam()},_showUnsubscribeInMoreMenu:function(){var a=this.get("model");var b=a.is("flags.newsletter")&&a.is("flags.show_definitely_spam")&&a.is("flags.have_unsubscribe_list");return f.UNSUBSCRIBE_IN_MORE_DROPDOWN&&b},hasReplyAll:function(a){return(0,r.hasLetterReplyAll)(a)},isAMPLetter:function(){var a=this.get("model");return f.ENABLE_AMP&&!this.is("amp-error")&&a.get("body.amp")},isAMPLetterWithoutTheme:function(){return this.isAMPLetter()&&!this.is("isThemedAMP")},isDarkMode:function(){return this.isDarkModePossible()&&this.is("dark-mode-enabled")},isDarkModePossible:function(){return!this.isAMPLetterWithoutTheme()&&this.is("dark-mode")},onAmpError:function(){this.set("amp-error",true)},setCssSelectorThemeAMP:function(a){var b=a.details;this.set("isThemedAMP",b)},onDarkModeToggle:function(){this.radar(["turn-on",this.is("dark-mode-enabled")?"light-mode":"dark-mode"]);this.invert("dark-mode-enabled")},isProbablyPhishing:function(){var a=this.get("model");return f.PHISHING_ALERT&&a.get("flags.maybe_phishing")},checkFolderGrant:function(a){var b=this.get("model");return b.checkGrant(a)},isEnableReply:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(y.default.SHARE_GRANTS.reply)},useNewToolbar:function(){return f.NEW_TOOLBAR},isShowSmartReplyAndMarusia:function(){var a,b;if(!f.HIDE_MESSAGE_SMART_REPLY&&!f.HIDE_MESSAGE_SMART_REPLY_BY_ONLY_WIDTH){return true}var d=this.reactComponent?(b=(a=this.letterBody)===null||a===void 0?void 0:a.current)===null||b===void 0?void 0:b.el:this.refs["letter-body"];var e=window.innerHeight;var g=d===null||d===void 0?void 0:d.clientWidth;var h=this.isSmartReplyHiddenRadarSended;var i=false;var j="";if(f.HIDE_MESSAGE_SMART_REPLY_BY_ONLY_WIDTH){i=g<650||!g;j="_width"}if(f.HIDE_MESSAGE_SMART_REPLY){i=e<800&&g<650||!g}if(i&&!h){c.default.send("letter_hide_smart-reply".concat(j));this.isSmartReplyHiddenRadarSended=true}return!i},isShowFooter:function(){var a,b;if(!f.HIDE_MESSAGE_FOOTER){return true}var d=this.reactComponent?(b=(a=this.letterBody)===null||a===void 0?void 0:a.current)===null||b===void 0?void 0:b.el:this.refs["letter-body"];var e=window.innerHeight;var g=d===null||d===void 0?void 0:d.clientWidth;var h=this.isFooterHiddenRadarSended;var i=e<800&&g<650||!g;if(i&&!h){c.default.send("letter_hide_footer");this.isFooterHiddenRadarSended=true}return!i},isEnableCall:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(y.default.SHARE_GRANTS.reply)},isEnableForward:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(y.default.SHARE_GRANTS.forward)},isEnableMark:function(){if(this.attrs["disable-edit"]){return false}return this.checkFolderGrant(y.default.SHARE_GRANTS.mark_as_important)},isEnableAttach:function(){return this.checkFolderGrant(y.default.SHARE_GRANTS.view_attachment)},isDatesMetadataEnabled:function(){var a=this.get("dates-metadata");return f.DATES_METADATA&&a},isEnableConfirmationReceipt:function(){var a=this.get("model");var b=a.is("flags.receipt");var c=this.is("preview-mode");var d=!a.getFolder().isShareTake();return Boolean(!c&&b&&d)},isSmartRepliesAvailable:function(a){return this.is("smart-reply-on")&&a.is("flags.smart_reply")&&!this.is("readonly")},isMarusiaReadLetterEnabled:function(){var a;var b=this.get("model");return f.MARUSIA_READ_LETTER&&!((a=b.getFolder())===null||a===void 0?void 0:a.isSecure())&&this.isSmartRepliesAvailable(b)},getMarusiaReadLetterRadarPrefix:function(){return f.MARUSIA_READ_ALL_LETTERS?"all":"smart"},hasCloudStockAttach:function(){var a;var b=this.get("model");var c=(a=b.getAttachmentsList())!==null&&a!==void 0?a:[];return!!c.find(function(a){return a.isCloudStock()})},getLetterMetaHeaderType:function(a){if(a.get("flags.maybe_phishing")){return"phishing"}if(f.EXPIRED_ATTACHES_DIE&&this.hasCloudStockAttach()){return"expired_attaches"}return null},isShowFakeCreateTodo:function(){if(!f.FAKE_CREATE_TODO){return false}return!J.default.get("create_todo_fake_button_shown")},isAllExtensionsInWhiteList:function(a){return a.every(function(a){var b=ia(a.attributes.name);return b&&f.EXTENSIONS_WHITE_LIST.includes(b)})},isEveryStrictlyUnsafe:function(a){var b=a.map(function(a){return a.attributes.flags.unsafe});return b.every(function(a){return a})},isAllScanResolutionsOf:function(a,b){var c=a.map(function(a){return a.attributes.scan});return c.every(function(a){return a===b})},isAllTypesOf:function(a,b){var c=a.map(function(a){return a.attributes.type});return c.every(function(a){return b.includes(a)})},getAttachSafetyStatus:function(){var a=this.get("model").attributes.attaches.list;if(!this.isEveryStrictlyUnsafe(a)&&this.isAllScanResolutionsOf(a,"healthy")&&this.isAllExtensionsInWhiteList(a)){if(this.isAllTypesOf(a,["cloud","cloud_stock"])){c.default.send("attaches-status_view",{dwh:{status:"healthy"}});return"healthy"}if(this.isAllTypesOf(a,["attach","cloud","cloud_stock"])){c.default.send("attaches-status_view",{dwh:{status:"probablyHealthy"}});return"probablyHealthy"}}return null},hasSmartCardIcsMeta:function(a){return!!(0,z.getCalendarIcsEvent)(a)}};exports.default=g.default.Block.extend((0,G.default)({explicit:"radar",events:[{name:"mount",data:v.getModelData},{name:"unmount",data:v.getModelData},{name:"compose:reply",data:v.getModelData},{name:"compose:replyall",data:v.getModelData},{name:"compose:forward",data:v.getModelData},{name:"compose:smartreply",data:v.getModelData},{name:"togglestatus:unread",rename:function(a){return(0,v.renameRadarOnStatusToggle)(a,"unread")}},{name:"togglestatus:flagged",rename:function(a){return(0,v.renameRadarOnStatusToggle)(a,"flagged")}}]})(exports.blockSpec))});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/compose-manager",["require","exports","@mail/contact-validation","@mail/flags","@mail/xray","cloud/Entry","data-source/actions","data-source/data-source","data-source/source/ui-layout","data-source/utils/paginator","default-values","feast","helpers/data-source-dispatch","helpers/encode","helpers/opener","mail/Attachment","mail/AttachSearch","mail/Message","mail/SmartReply","mail/Thread","pilotjs","service/auth","service/calls","service/compose","service/dimmer","service/notify","service/promo","ui-block/compose-dropdown/compose-dropdown","ui-block/dataset-letters/dataset-letters","ui-block/dropdown-actions/dropdown-actions","ui-block/letter/letter","ui-block/octopus/octopus","ui-block/paginator-container/paginator-container","ui-block/portal-menu/portal-menu","ui-block/sidebar/sidebar","ui-block/sidebar-folders/sidebar-folders","ui-block/thread/thread","ui-block/webview-mobile-header/webview-mobile-header","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FAKE_BUTTON_IN_COMPOSE_DROPDOWN_STORAGE_KEY=void 0;b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);I=__importDefault(I);J=__importDefault(J);var L=["compose:new","compose:reply","compose:replyall","compose:forward","compose:preload","compose:draft","compose:template","compose:schedule","compose:smartreply","compose:tomyself","compose:opennote"];var M=/,(?=(?:[^"]*"[^"]*")*[^"]*)/;exports.FAKE_BUTTON_IN_COMPOSE_DROPDOWN_STORAGE_KEY="fake-button-in-compose-dropdown";function N(a){var b={};Object.entries(a).forEach(function(a){var c=a[0],d=a[1];if(typeof d==="string"){b[c.toLowerCase()]=d}});return b}var O=function(b,c){if(c===void 0){c=M}if(!b){return[]}return b.split(c).map(function(a){return a.trim()}).filter(function(a){return a}).map(a.checkTextValidity).filter(function(a){return a.valid}).map(function(a){return{email:a.email,name:a.name}})};var P=/(?:mailto:)?(.*)/;var Q="%2C%20";function R(a){if(!a){return{}}c.default.send("mailto_link");var b=a.match(P)[1];var d=b.indexOf("?");var e=d!==-1;var f={};if(e){var g=b.slice(d+1);var h=b.slice(0,d);var i=h?O(h,Q):[];var j=g.split(/&amp;|&/g).filter(function(a){return a});var k={};j.forEach(function(a){var b=a.split("="),c=b[0],d=b[1];if(!c||!d){return}try{k[c]=decodeURIComponent(d)}catch(a){}});["to","cc","bcc"].forEach(function(a){f[a]=O(k[a])});f.to=f.to.concat(i);return __assign(__assign({},k),f)}return{to:O(b)}}var S=function(a){__extends(j,a);function j(){return a!==null&&a.apply(this,arguments)||this}j.prototype.getComponentsSpec=function(){return{router:{class:s.default,events:["beforeroute","route","reloadend"],handleEvent:"handlePilotEvent"},dataSource:{class:f.default,events:["actionend"],handleEvent:"handleDataSourceActionEnd"},"portal-menu":{class:F.default,events:L},"webview-mobile-header":{class:J.default,events:L},"webview-mobile-footer":{events:["compose:new"]},sidebar:{class:G.default,events:L},"sidebar-folders":{class:H.default,events:L},"compose-dropdown":{class:z.default,events:L},thread:{class:I.default,events:L},letter:{class:A.default,events:L},dropdownActions:{class:B.default,events:L},"compose-windows":{lazy:K.lazyUIComposeWindows,events:["window-show","window-hide","window-collapsed-hide","window-extend"],attrs:{"paginator-visible":function(a){return((0,h.isPaginatorGlobalEnabled)(a.get("router"))||i.ENABLE_NAV_UP)&&a._isPaginatorVisible},extended:function(a){return a.isExtended()}},handleEvent:"handleWindowState"},"dataset-letters":{class:C.default,events:L},octopus:{class:D.default,events:["compose:new"]},"paginator-container":{class:E.default,events:["show","hide"],handleEvent:"handlePaginatorVisibility"},"layer-sent-page":{lazy:K.lazyUILayerSentPage,events:["compose:draft"]}}};j.prototype.toggleExtendMode=function(){(0,k.default)({type:e.TOGGLE_COMPOSE_EXTEND_MODE,uid:undefined})};j.prototype.isExtended=function(){var a=this.get("router.model.uiLayout")||g.defaults;return a.composeExtended};j.prototype.handleWindowState=function(a){switch(a.type){case"windowextend":{this.toggleExtendMode();return false}default:{this.handleChangeVisibility(a);break}}};j.prototype.handleChangeVisibility=function(a){var b=a.type;if(b!=="windowcollapsedhide"){var c=this.get("thread");if(c){c.set("load-draft-disabled",b==="windowshow")}}y.default.update()};j.prototype.handlePaginatorVisibility=function(a){var b=a.type;switch(b){case"show":this._isPaginatorVisible=true;break;case"hide":this._isPaginatorVisible=false;break}};j.prototype.handleDataSourceActionEnd=function(a){var b=a.details;if(b.action.type===e.TOGGLE_COMPOSE_EXTEND_MODE){return true}return false};j.prototype.handleEvent=function(a){var b=a.type,d=a.details,e=a.originalEvent;var f=b.split(":").pop();var g=(d===null||d===void 0?void 0:d.model)||d;if(f==="new"&&e){if(e.metaKey||e.ctrlKey){return false}else{e.preventDefault()}}if(f==="preload"){v.default.preload()}else if(f==="smartreply"){var h=q.default.all.get(g.id);var j=h.get("replies")[d.key]+"\x3c!--focus--\x3e";v.default.open({mode:"smartreply",model:g,body:j})}else if(f==="tomyself"){var k=t.default.user;var l=k.get("name"),n=l.first,o=l.last;var p=k.getEmail();v.default.open({mode:"new",correspondents:{to:[{email:p,name:[n,o].filter(function(a){return!!a}).join(" ")||p}]}})}else if(f==="opennote"){c.default.send("p_sidebar-folders_cdd_note_click");(0,m.default)(i.URL_OPEN_PROJECTS_NOTES)}else{g=this._isMessage(g)?g:this.get("router.model.letter");v.default.open({mode:f,model:g,source:d===null||d===void 0?void 0:d.source})}};j.prototype._isMessage=function(a){return a&&(a instanceof r.default||a instanceof p.default)};j.prototype.getAttachesFromUrl=function(a,b){var e=b.composeaction,f=b.composeid;var g=a.cloud_files_ids,h=g===void 0?"":g;var i=[];if(e==="forward-file"&&f){try{var j=f.split(",");i=j.map(function(a){var b=a.split(";"),c=b[0],d=b.slice(1);var e=d.join(";");return{letterId:c,attachIdInLetter:e}})}catch(a){c.default.send("compose-fwdfile-parseerr",{rlog:"compose-route",rlog_message:{type:"compose-fwdfile-parseerr",error:a}})}}var k=i.map(function(a){var b=a.letterId,c=a.attachIdInLetter;return p.default.findOne({id:b}).then(function(a){var d=a.get("attaches.list").get(c);return n.default.from(new o.default({name:d.get("name"),size:d.get("size"),id:b,folder:a.get("folder"),n:d.get("id").split(";")}))})});var l=[];try{l=JSON.parse(h);if(!Array.isArray(l)){l=[]}else{l=l.map(function(a){return d.default.findOne(a).then(function(a){return n.default.fromAsync(a)})})}}catch(a){l=[]}return k.concat(l)};j.prototype.getReplyOptionsFromUrl=function(a){var b=a.composeaction;var c=a.composeid;var d="new";var e=Promise.resolve(null);if(b==="drafts"){b="draft"}if(b==="replyall"||b==="reply"||b==="forward"||b==="draft"){d=b;e=p.default.findOne({id:c})}return{mode:d,modelPromise:e}};j.prototype.getRouteParams=function(a){return __awaiter(this,void 0,void 0,function(){var d,e,f,g,h,i,j,k,m,n,o,p,q,r,s,t,v,w,y,z,A,B,C,D;return __generator(this,function(E){d=a.activeUrl.query;e=a.activeRequest.params;f=N(d);g=f.subject,h=g===void 0?"":g,i=f.body,j=i===void 0?"":i,k=f.mailto,m=f.calls,n=f["create-call"],o=f["template-name"],p=f["from-mailto-handler"];c.default.send("compose_get_params",{dwh:{subject:Boolean(h),body:Boolean(j),mailto:Boolean(k),calls:Boolean(m),"create-call":Boolean(n),"template-name":Boolean(o),"from-mailto-handler":Boolean(p)}});if(p){q=b.default.get("from-mailto-handler-count");q===null||q===void 0?void 0:q.save({hit:true})}r=this.getAttachesFromUrl(f,e);s=this.getReplyOptionsFromUrl(e),t=s.modelPromise,v=s.mode;w=R(k);y=w.subject?w.subject:h;z=w.body?w.body:j;A="";B=false;if(typeof z==="string"){A=(0,l.default)(z);B=!!A.length;if(m){A=u.default.getTemplate(A);if(!y){y=u.default.getSubject()}c.default.send("calls_insert_fromquery")}else{A="<div>".concat(A,"</div>")}}A=A.replace(/[\n]/g,"<br/>");C={};["to","cc","bcc"].forEach(function(a){C[a]=O(f[a]).concat(w[a]||[])});D={mode:v,body:A,correspondents:C,subject:y,createCall:n&&!z.length,additionalOptions:{prefilledBody:B,attachFiles:r,templateName:o}};return[2,t.then(function(a){return __assign(__assign({},D),{model:a})},function(){x.default.error({text:i18n("Не удалось найти исходное письмо")},"compose-notify");return __assign(__assign({},D),{model:null,mode:"new"})})]})})};j.prototype.handleRoute=function(a){var b=a.type,d=a.target;var e=d.activeRequest.alias==="compose";if(!e){return false}switch(b){case"beforeroute":v.default.preload();w.default.add();break;case"route":this.getRouteParams(d).then(function(a){var b=a.createCall,d=a.model,e=a.mode,f=a.correspondents,g=a.body,h=a.subject,i=a.additionalOptions;if(b&&!h){h=u.default.getSubject()}var j=v.default.open({mode:e,model:d,correspondents:f,body:g,subject:h,additionalOptions:i});if(b){u.default.createRoom().then(function(a){var b=u.default.getTemplate(a);j.then(function(){v.default.insertHtml(b)})}).catch(function(a){if(a==="ratelimit"){x.default.error({text:i18n("Достигнут лимит создания звонков. Попробуйте позже.")},"compose-notify")}else{x.default.error({text:i18n("Не удалось создать ссылку на звонок")},"compose-notify")}});c.default.send("calls_create_fromquery")}return j}).then(function(){w.default.remove()});break}return false};j.prototype.handlePilotEvent=function(a){var b=a.type==="reloadend";if(b){this.getList("compose-windows").forEach(function(a){return a.render()})}else{return this.handleRoute(a)}};return j}(j.default.Mediator);exports.default=j.default.Mediator.createFromClass("compose-manager",S)});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/contact-selection",["require","exports","default-values","feast","feast-mod/correspondents","lazy.modules","pilotjs","service/contextmenu","service/smokescreen","ui-block/letter-contact/letter-contact"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);e=__importDefault(e);f=__importDefault(f);h=__importDefault(h);exports.default=b.default.Mediator.create("contact-selection",{components:{router:{class:e.default,events:["routeend"]},"letter-contact":{class:h.default,events:["rightclick"]}},defaults:function(){if(a.TOUCH_MODE){return}this.onKeyboardCopy=this.onKeyboardCopy.bind(this);this.onSelectionChange=this.onSelectionChange.bind(this);this.onKeyUp=this.onKeyUp.bind(this);this.selectionRange=null;this.copyEl=document.createElement("input");this.copyEl.setAttribute("type","text");this.copyEl.setAttribute("tabindex","-1");this.copyEl.style.position="absolute";this.copyEl.style.overflow="hidden";this.copyEl.style.bottom="0";this.copyEl.style.marginLeft="-10000px";this.copyEl.style.width="auto";document.body.appendChild(this.copyEl)},toggleListeners:function(a){var b=this;var c="command+c,ctrl+c";(0,d.lazyMailKeymaster)().then((0,d.uniqCallback)(this,function(d){if(a){d(c,b.onKeyboardCopy);document.addEventListener("selectionchange",b.onSelectionChange)}else{d.unbind(c,b.onKeyboardCopy);document.removeEventListener("selectionchange",b.onSelectionChange)}}))},onKeyUp:function(){document.removeEventListener("keyup",this.onKeyUp);var a=document.getSelection();a.removeAllRanges();a.addRange(this.selectionRange);this.selectionRange=null},handleEvent:function(b){if(a.TOUCH_MODE){return}var c=b.type;var d=this.get("router");var e=d.request;if(!d.route){return}switch(c){case"routeend":{var f=e.route;if(f&&f.is&&f.is("#read-letter #search-letter")){this.toggleListeners(true)}else{this.toggleListeners(false)}break}case"rightclick":{this.onRightClick(b);break}}return false},onSelectionChange:function(){var a=this.getList("letter-contact");var b=a.length;if(b===0){return}if(this.selectionRange){return}var c=document.getSelection();for(var d=0;d<b;d++){var e=a[d].el;if(e&&e.firstChild){var f=!c.isCollapsed&&c.containsNode(e,true);var g=a[d].get("active");if(g!=f){a[d].set("active",f)}}}},onKeyboardCopy:function(){var a=document.getSelection();var b=this.getSelectedBlocks();if(b.length===0||!b[0]||!b[0].el){return}var c=b[0].el.closest((0,g.selector)(".letter__head"));var d=a.anchorNode;var e=a.focusNode;if(d.nodeType===Node.TEXT_NODE){d=d.parentNode}if(e.nodeType===Node.TEXT_NODE){e=e.parentNode}if(c.contains(d)&&c.contains(e)){var f=this.getText(b);this.selectionRange=a.getRangeAt(0);this.copyEl.value=f;this.copyEl.focus();this.copyEl.select();document.addEventListener("keyup",this.onKeyUp)}},onRightClick:function(a){var b=a.details;if(!b.is("active")){this.showContextMenu(a,[b]);return}var c=this.getSelectedBlocks();if(c.length===0||!c[0]||!c[0].el){return}this.showContextMenu(a,c)},showContextMenu:function(a,b){var c=this.getText(b);var d=this.getContacts(b);a.details={type:"correspondents",clipboardText:c,contacts:d};f.default.show(a)},getText:function(a){return(0,c.correspondentsFull)(a.map(function(a){return a.get("contact")})).join(", ")},getContacts:function(a){return a.map(function(a){return a.get("contact")})},getSelectedBlocks:function(){var a=this.getList("letter-contact");var b=a.length;if(b===0){return[]}return a.filter(function(a){return a.is("active")})}})});define("mediator/features",["exports","@mail/features","feast","ui-block/letter-body/letter-body"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Mediator.create("features",{defaults:function a(){},components:{"letter-body":{class:f.default,attrs:{"features-blockquote":function a(){return d.default.has("blockquote")},"features-blockquote-threads":function a(){return d.default.has("blockquote-threads")}}}}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/filter-manager",["require","exports","feast","mail/Thread","pilotjs","route/utils/filter-query","ui-block/filters/filters","ui-block/list-nested-sorting/list-nested-sorting","ui-block/octopus/octopus","ui-block/portal-menu/portal-menu"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FilterManager=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);var i=function(a){__extends(i,a);function i(){var b=a!==null&&a.apply(this,arguments)||this;b.filters={all:true,unread:false,flagged:false,with_attachments:false};b.sortingType="D";return b}i.prototype.getComponentsSpec=function(){return{router:{class:c.default,events:["beforeroute","route","routeend"]},filters:{class:e.default,events:["filterchange","filterclick","resetall"],attrs:{filter:function(a){return a.filters},sortingType:function(a){return a.sortingType}}},sortings:{class:f.default,events:["sortingclick"],attrs:{sortingType:function(a){return a.sortingType}}},"portal-menu":{class:h.default,attrs:{filter:function(a){return a.filters},sortingType:function(a){return a.sortingType}}},octopus:{class:g.default,attrs:{filter:function(a){return a.filters}},events:["filterclick"]}}};i.prototype.handleEvent=function(a){var c;var e=this.get("router");var f=e.activeRoute;var g=e.activeRequest;var h=g.params.folder;var i=e.route;var j=i?i.params.letter:void 0;var k=((c=e.route)!==null&&c!==void 0?c:{}).request,l=k===void 0?{}:k,m=l.query,n=m===void 0?{}:m,o=n["to-parent-button"],p=o===void 0?null:o;switch(a.type){case"filterclick":{if(a.details==="all"){d.default.resetFilters()}else{d.default.applyFilter(a.details)}e.go("#letters",{preserveFilters:"true",folder:h},p&&{"to-parent-button":p});break}case"sortingclick":{if(a.details!==this.sortingType){d.default.applySorting(a.details);e.go("#letters",{preserveFilters:"true",preserveSortings:"true",folder:h},p&&{"to-parent-button":p})}break}case"resetall":{d.default.resetFilters();d.default.resetSorting();e.go("#letters",{preserveFilters:"true",preserveSortings:"true",folder:h},p&&{"to-parent-button":p});break}case"beforeroute":{var q=f.is("#letters #read-letter")?e.activeUrl.query:{};var r=j&&b.default.get(j);d.default.set(q);if(r&&!d.default.isLetterInFilter(r)){window.history.replaceState(null,null,g.href);e.nav(g.href)}break}case"routeend":{this.filters=d.default.getFilterConfig();this.sortingType=d.default.getSortingType();this.updateAll();break}}};return i}(a.default.Mediator);exports.FilterManager=i;exports.default=a.default.Mediator.createFromClass("filter-manager",i)});define("mediator/flags",["exports","feast","pilotjs","ui-block/dataset-letters/dataset-letters","ui-block/letter-body/letter-body"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Mediator.create("flags",{defaults:function a(){},components:{router:{class:f.default},"letter-body":{class:h.default,attrs:{"flags-threads":function a(b){return b.get("router.model.uiThreadsSettings").threads}}},"dataset-letters":{class:g.default,attrs:{threadsEnabled:function a(b){return b.get("router.model.uiThreadsSettings").threads}}}}})});define("mail/actions/MarkAsAll",["logger","utils/util","RPC","Action","mail/Folder","mail/Message","mail/Thread"],function(a,b,c,d,e,f,g){"use strict";var h=d.extend({folderFrom:null,prepare:function(a){var c=a.flag,d="flags."+c,h=e.getSafe(a.folderFrom),i=!!a.state,j={},k={clean:true},l;l=[].concat(f.all.filter({folder:h.id}).toArray(),g.all.filter({folder:h.id}).toArray());this.folderFrom=h;var m=function(a,b){var e,f,g;if(c=="unread"){if(!b){j["folder.unread"]=h.get("messages_unread")}h.set("messages_unread",b?j["folder.unread"]:a?h.get("messages_total"):0,k)}e=l.length;while(e--){g=l[e];if(b){a=j[g.id]}else{j[g.id]=g.get(d)}if(c==="unread"&&g.is("flags.mention")){var i={};i[d]=a;i["flags.mention_unread"]=a;g.set(i,k)}else{g.set(d,a,k)}}};m(i);this.rollbackOperation=b.bindWithoutArgs(m,[!i,true]);return a},operation:function(a){return this._markAs(a.folderFrom,a.flag,a.state)},_markAs:function(a,b,d){b=[].concat(b);var e={folder:a,marks:JSON.stringify(b),action:d?"set":"unset"};return c.call(f.fn.markAsAllUrl,e)}});d.register("mail.MarkAsAll",h);h.version="0.1.0";return h});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/folders-actions",["require","exports","data-source/actions","data-source/data-source","data-source/index","default-values","feast","helpers/data-source-dispatch","mail/actions/MarkAsAll","mail/Folder","mail/Message","mail/Thread","mediator/layout-manager","pilotjs","service/layer","service/mailbox/loader","service/radars/index","service/secure-folder","ui-block/contextmenu-folder/contextmenu-folder","ui-block/list-letter-tip/list-letter-tip","ui-block/list-nested-moveto-folder/list-nested-moveto-folder","ui-block/metathread-head-common/metathread-head-common","ui-block/metathread-head-compact/metathread-head-compact","ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded","ui-block/nav-folders/nav-folders","ui-block/new-folder-btn/new-folder-btn","ui-block/portal-menu-element/portal-menu-element","ui-block/settings-dock/settings-dock","ui-block/thread/thread","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){"use strict";Object.defineProperty(exports,"__esModule",{value:true});c=__importDefault(c);e=__importDefault(e);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);var C=function(e){__extends(C,e);function C(){return e!==null&&e.apply(this,arguments)||this}C.prototype.getComponentsSpec=function(){return{router:{class:l.default},"context-menu":{class:q.default,events:["read","clear","remove","add","edit","lock","unlock","share","disable:tomyself"],attrs:{"to-myself-enabled":function(a){return a.get("router.model.uiThreadsSettings").toMyself}}},"metathread-head-common":{class:t.default,events:["clear","read"]},"metathread-head-compact":{class:u.default,events:["clear","read"]},"metathread-head-compact-expanded":{class:v.default,events:["clear","read"]},"nav-folders":{class:w.default,events:["clear"]},"portal-menu-element":{class:y.default,events:["clear"]},"new-folder-btn":{class:x.default,events:["add"]},"mobile-folders-settings-modal":{events:["add"]},"layer-metathreads-settings":{lazy:B.lazyUILayerMetathreadsSettings,attrs:{metathreadsSettings:function(a){return a.get("router.model.uiThreadsSettings").metathreadsSettings}}},"list-letter-tip":{class:r.default,events:["clear"]},"list-nested-moveto-folder":{class:s.default,events:["add"]},"settings-dock":{class:z.default,attrs:{metathreadsSettings:function(a){return a.get("router.model.uiThreadsSettings").metathreadsSettings}}},thread:{class:A.default},"confirm-delete-folder":{lazy:B.lazyUILayerConfirmDeleteFolder}}};C.prototype.handleEvent=function(a){if((0,b.isDataSourceEvent)(a)){var c=a.type;var d=a.details.model;if(c==="add"||d){var e={type:c};this.doAction(e,d)}}};C.prototype.clear=function(a){var b=this;m.default.open("confirm-clear-folder",{model:a,mobile:k.default.isLessThen("xs")},{dimmer:true,compact:true,resolvable:true,"reject-on-close":true,mobile:k.default.isLessThen("xs")}).then(function(){a.cleanup().then(function(){return c.default.updateAll()}).then(function(){if(b.get("router.model.folder.id")===a.id){var c=b.get("router");c.go("#letters",{folder:a.id})}if(b.get("router.route.id")==="#read-letter"){var d=b.get("thread");if(d){var e=d.get("model");i.default.fetchData({id:e.get("expand"),folder_id:a.id},true,true).then(function(a){d._loadDraft(new j.default({expand:e.get("expand"),messages:[a]}))})}}})}).catch(function(a){if(a){throw a}})};C.prototype.read=function(a){g.default.execute({flag:"unread",state:false,folderFrom:a.get("id")})};C.prototype.doAction=function(a,b){var c=this;if(a.type==="read"){this.read(b)}else if(a.type==="clear"){this.clear(b)}else if(a.type==="remove"){this.remove(b)}else if(a.type==="add"){this.add(b)}else if(a.type==="share"){this.share(b)}else if(a.type==="edit"){if(b.get("open")){this.edit(b)}else{(0,p.default)(b).then(function(a){if(a){c.edit(b)}})}}else if(a.type==="unlock"){(0,p.default)(b).then(this.invalidateCacheAndUpdateAll.bind(this))}else if(a.type==="lock"){b.secureClose().then(this.invalidateCacheAndUpdateAll.bind(this))}else if(a.type==="disable:tomyself"){this.disableToMyself(b)}};C.prototype.add=function(a){m.default.open("create-folder",{model:a,mode:"new"},{dimmer:true,"dimmer-color":"transparent",compact:true,resolvable:true,"reject-on-close":true,"close-on-esc":false,mobile:k.default.isLessThen("xs"),"hide-headline":k.default.isLessThen("xs")}).catch(function(a){if(a){throw a}})};C.prototype.share=function(a){m.default.open("share-folder",{model:a,handleFinal:null},{dimmer:true,"dimmer-color":"transparent",compact:true,resolvable:true,"reject-on-close":true}).catch(function(a){if(a){throw a}})};C.prototype.edit=function(a){m.default.open("create-folder",{model:a,mode:"edit"},{dimmer:true,"dimmer-color":"transparent",compact:true,resolvable:true,"reject-on-close":true,"close-on-esc":false,mobile:k.default.isLessThen("xs"),"hide-headline":k.default.isLessThen("xs")}).catch(function(a){if(a){throw a}})};C.prototype.remove=function(a){var b=this;m.default.open("confirm-delete-folder",{model:a,mobile:k.default.isLessThen("xs")},{dimmer:true,compact:true,resolvable:true,"reject-on-close":true,mobile:k.default.isLessThen("xs"),"hide-headline":k.default.isLessThen("xs")}).then(function(){var d=b.get("confirm-delete-folder");a.remove().then(function(){return c.default.updateAll()},function(a){var c=b.handleFolderRemoveErrors(a);d.set({error:c,processing:false});throw a}).then(function(){if(b.get("router.model.folder.id")===a.id){var c=b.get("router");c.go("#letters",{folder:h.default.TYPE_INBOX})}d.broadcast("layer:close")},function(){})}).catch(function(a){if(a){throw a}})};C.prototype.disableToMyself=function(b){var c=this;var e=function(){(0,f.dispatchAndWait)({type:a.TOGGLE_TO_MYSELF_METATHREAD,state:false}).then(function(){(0,o.default)({type:"tomyself-disable",intervals:[["fldr-ctx-menu",1]]});if(c.get("router.model.folder.id")===b.id){var a=c.get("router");a.go("#letters",{folder:h.default.TYPE_INBOX})}c.updateAll()})};if(d.LAYER_METATHREAD_DISABLE){m.default.open("disable-metathread",{model:b},{dimmer:true,resolvable:true,"close-on-dimmer":true,"reject-on-dimmer":true,"close-on-esc":false,"reject-on-close":true}).then(function(){e()}).catch(function(a){if(a){throw a}})}else{e()}};C.prototype.invalidateCacheAndUpdateAll=function(b){if(b){n.default.invalidateCache();c.default.dispatch({type:a.UPDATE_ALL,priority:l.default.Loader.PRIORITY_LOW})}};C.prototype.handleFolderRemoveErrors=function(a){var b="unknownError";var c={"ids[0]":{is_collector_root:"isCollectorRoot",invalid:"systemFolder",not_exists:"folderNotExists",unknown:"invalidFolder"}};var d=a.body;Object.keys(d).forEach(function(a){if(!(a in c)){b="unknownError";return}var e=d[a].error;if(e in c[a]){b=c[a][e]}else{b=c[a]["unknown"]}});return b};return C}(e.default.Mediator);exports.default=e.default.Mediator.createFromClass("folders-actions",C)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __rest=this&&this.__rest||function(a,b){var c={};for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0)c[d]=a[d];if(a!=null&&typeof Object.getOwnPropertySymbols==="function")for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++){if(b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e]))c[d[e]]=a[d[e]]}return c};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/folders-navigation",["require","exports","@mail/xray","data-source/actions","data-source/index","default-values","feast","mail/Folder","mediator/folders-navigation/utils","pilotjs","service/secure-folder","ui-block/application-mail/application-mail","ui-block/button2/button2","ui-block/dataset-letters/dataset-letters","ui-block/nav-folders/nav-folders","ui-block/octopus/octopus","ui-block/portal-menu/portal-menu"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FoldersNavigation=void 0;a=__importDefault(a);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);var p=function(e){__extends(p,e);function p(){return e!==null&&e.apply(this,arguments)||this}p.prototype.getComponentsSpec=function(){return{router:{class:h.default,events:["route"]},button:{class:k.default,events:["back:to:parent:folder"]},"application-mail":{class:j.default,attrs:{showBackToParentFolder:function(a){return a.isBackToParentEnabled()}}},"portal-menu":{class:o.default,attrs:{showBackToParentFolder:function(a){return a.isBackToParentEnabled()}}},"nav-folders":{class:m.default,attrs:{showBackToParentFolder:function(a){return a.isBackToParentEnabled()}}},octopus:{class:n.default,attrs:{transparent:function(a){return a.isDatasetTransparent}},events:["secure:opencurrent","secure:open"]},"dataset-letters":{class:l.default,events:["back:to:parent:folder"]}}};p.prototype.handleEvent=function(a){switch(a.type){case"secure:open":{this.secureOpen(a.details);break}case"secure:opencurrent":{this.secureOpenCurrent();break}case"route":{this.handleBackToParentFolder();break}case"back:to:parent:folder":{this.doBackToParentFolder(a);break}}};p.prototype.doBackToParentFolder=function(b){a.default.send("back-to-parent-nav",{dwh:{pos:b.details.pos}});var c=this.get("router");var d=c.model,e=d.folder,f=d.folders;var h=(0,g.getParentFolder)(e,f);if(!h){return}c.nav(c.getUrl("#letters",{folder:h.id}),{initiator:"popstate"})};p.prototype.secureOpenCurrent=function(){var a=this.get("router");this.secureOpen(a.model["folder"])};p.prototype.secureOpen=function(a){var d=this.get("router");var e=f.default.all.get(a);e&&(0,i.default)(e).then(function(){if(d.route.is("#search #search-letter")){return c.default.dispatch({type:b.UPDATE_SEARCH})}return c.default.updateAll()})};p.prototype.isBackToParentEnabled=function(){if(!d.METATHREAD_BACK_TO_INBOX){return false}var a=this.get("router").request.query["to-parent-button"];return!!a};p.prototype.handleBackToParentFolder=function(){if(!d.METATHREAD_BACK_TO_INBOX){return}var a=this.get("router");var b=a.activeRoute,c=a.previousRoute;if(!c){return}var e=b.params.folder;var f=c.params.folder;var g=a["model"].folders;if(!g){return}var h=g.find(function(a){return a.id==e});var i=g.find(function(a){return a.id==h.get("parent")});var j=(i===null||i===void 0?void 0:i.id)==f;var k=b.is("#letters #read-letter")&&c.is("#letters #read-letter")&&e===f;if(k||j){return}var l=a.route.id,m=a.request,n=m.params,o=m.query,p=o["to-parent-button"],q=__rest(o,["to-parent-button"]);var r=c.request.query["to-parent-button"];if(p&&r){a.nav(a.getUrl(l,n,q),{replaceState:true})}};return p}(e.default.Mediator);exports.FoldersNavigation=p;exports.default=e.default.Mediator.createFromClass("folders-navigation",p)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/letter-attaches-preview",["require","exports","feast","service/search-attaches/getAttaches","ui-block/list-letter-common/list-letter-common","ui-block/list-letter-compact/list-letter-compact"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LetterAttachesPreview=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);var e=function(a){__extends(e,a);function e(){return a!==null&&a.apply(this,arguments)||this}e.prototype.getComponentsSpec=function(){return{"list-letter-common":{class:c.default,events:["$mount"]},"list-letter-compact":{class:d.default,events:["$mount"]}}};e.prototype.handleEvent=function(a){var b=a.type,c=a.details;switch(b){case"$mount":this.fetchAttaches(c);break}};e.prototype.fetchAttaches=function(a){var c=a.get("show-attaches");var d=a.get("model").get("attachments_count");var e=a.get("fetchAttaches")&&!a.get("messagesAttaches");if(c&&d&&!e){(0,b.fetchMessagesAttaches)(a.get("model")).then(function(b){a.set({messagesAttaches:b,fetchAttaches:true})})}};return e}(a.default.Mediator);exports.LetterAttachesPreview=e;exports.default=a.default.Mediator.createFromClass("letter-attaches-preview",e)});define("mediator/letter-list-adv-optimizer",["exports","feast","ui-block/letter-list-item-adv/letter-list-item-adv","ui-block/scrollable/scrollable","ui-block/spec-project-letter/spec-project-letter"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Mediator.create("letter-list-adv-optimizer",{defaults:function a(){this._queue=[];this._isScrolling=false},components:{scrollable:{class:g.default,events:["scroll:change","scroll:end"]},"spec-project-letter":{class:h.default,events:["render:adv","render:remove"]},"letter-list-adv":{class:f.default,events:["render:adv","render:remove"]}},handleEvent:function a(b){var c=b.type,d=b.details;switch(c){case"scroll:change":{this._isScrolling=true;break}case"scroll:end":{this._isScrolling=false;this.progressQueue();break}case"render:adv":{var e=d.advRender;if(this._isScrolling){this._queue.push(d);return}e();break}case"render:remove":{var f=d;this._queue=this._queue.filter(function(a){return a.advName!==f});break}}return false},progressQueue:function a(){while(this._queue.length){this._queue.pop().advRender()}}})});define("mail/actions/MoveTo",["logger","utils/util","RPC","Action","mail/Folder","mail/Message","mail/Thread"],function(a,b,c,d,e,f,g){"use strict";var h=d.extend({models:[],folderTo:null,_findFolders:function(a){var b=Promise.resolve(),c=[];a.forEach(function(a,f){b=b.then(function(){return e.findOne(a).then(function(a){if(a.isSecureOpen()){c[f]=a}else{return d.waitFor("folderSecure",[a]).then(function(){c[f]=a})}})})});return b.then(function(){return c})},prepare:function(a){var b=a.folderTo,c=(a.models||[]).filter(function(a){return a.get("folder")!=b});if(c.length===0){return null}this._rollbackFolders={};this.models=c;if(this.folderTo){return Promise.resolve(c)}return this._findFolders([b]).then(function(a){this.folderTo=a[0];return c}.bind(this))},operation:function(a,b){var c=this._calculateMoveToParams(a,false);this._applyChanges(a,b.folderTo);return this._moveTo(a,b.folderTo,false,c)},undoOperation:function(a){var b={};this.rollbackOperation();a.forEach(function(a){var c=a.get("folder");if(b[c]===void 0){b[c]=[]}b[c].push(a)});return Promise.all(Object.keys(b).map(function(a){return this._moveTo(b[a],a,true)},this))},_applyChanges:function(a,c,d){var e={clean:true},f={},h={},i=this._rollbackFolders,j,k,l,m;var n=this;function o(a,b,c){if(f[a]===void 0){f[a]={total:0,unread:0}}f[a].total+=b;f[a].unread+=b*c}function p(a,b,c){var f=c.is("flags.unread");c.set("folder",b,e);!d&&(i[c.id]=a);o(b,+1,f);o(a,-1,f)}function q(a,b,c){var e=c.get("folder")==b;var f=c.get("folder")==a;var g;var i;var j;if(e||f){j=e?+1:-1;h[c.id]={total:0,unread:0,flagged:0};if(!d){h[c.id].unread=j*c.get("length_unread");h[c.id].flagged=j*c.get("length_flagged")}else if(n._undoData&&n._undoData[c.id]){g=n._undoData[c.id];h[c.id].unread=j*g.unread;h[c.id].flagged=j*g.flagged}}}for(m=0;m<a.length;m++){l=a[m];j=l.get("folder");if(l instanceof g){k=l.get("messages");if(d){c=l.get("folder");j=i[l.id]}!d&&(i[l.id]=c);q(j,c,l);if(k.length){k.forEach(function(a){if(!d&&a.get("folder")==j||i[a.id]!==void 0){p(j,c,a)}});g.getListByMessageId(k.eq(0).id).filter({folder:d?j:c}).forEach(function(a){q(j,c,a)})}}else{d&&(c=i[l.id]);p(j,c,l);g.getListByMessageId(l.id).forEach(function(a){q(j,c,a)})}}this._applyChangesFolder(f,d);this._applyChangesThread(h,d);this.rollbackOperation=b.bindWithoutArgs(this._applyChanges,[a,c,true])},_applyChangesFolder:function(a,b){Object.keys(a).forEach(function(b){var c=e.get(b),d=a[b];if(c){c.increment("messages_unread",d.unread,{clean:true});c.increment("messages_total",d.total,{clean:true})}})},_applyChangesThread:function(a,b){Object.keys(a).forEach(function(c){var d=g.get(c),e=a[c],f={clean:true},h,i;if(d){if(!b){this._undoData||(this._undoData={});this._undoData[c]={last:d.get("last"),unread:d.get("length_unread"),flagged:d.get("length_flagged")}}if(this.folderTo.isSpam()||this.folderTo.isTrash()){d.increment("length",e.total,f)}d.increment("length_unread",e.unread,f);d.increment("length_flagged",e.flagged,f);i=d.get("messages").filter({folder:d.get("folder")}).eq(0);h=i?i.id:null;if(!h&&b&&this._undoData&&this._undoData[c]&&this._undoData[c].last){h=this._undoData[c].last}d.set("last",h,f)}},this)},_undoData:null,_calculateMoveToParams:function(a,b){var c=a[0],d=c.constructor,e=d.List.pluck(a,"id");var f=d.List.fn.map.call(a,function(a){return{id:a.id,folder:String(a.get("folder"))}});if(b){e=e.map(function(a){return this[a]},this._undoParams.ids);f=f.map(function(a){a.id=this[a.id];return a},this._undoParams.ids)}return{ids:e,msg_ids:f}},_moveTo:function(a,d,e,f){var h=a[0],i=h.constructor,j,k;f=f||this._calculateMoveToParams(a,e);var l=f.msg_ids;var m=f.ids;k={ids:JSON.stringify(m),msg_ids:JSON.stringify(l),folder:d};if(h instanceof g){j=e?this._undoParams.last:m.reduce(function(a,b){a.push(this._undoData[b].last);return a}.bind(this),[]);k.message_id_last=JSON.stringify(b.object(m,j))}return c.call(this._getRequestUrl(i,this.params,e),this._getRequestData(k,this.params,e)).then(function(a){if(!e){this._undoParams={ids:a.get("body").reduce(function(a,b,c){a[m[c]]=b;return a},{}),last:j};if(i===g){Object.keys(this._undoParams.ids).forEach(function(a){var b=g.get(a);var c=this._undoParams.ids[a];g.map({id:c,folder:d,messages:b.get("messages").toArray()})},this)}}return a}.bind(this))},_getRequestUrl:function(a,b,c){return a.url("moveTo")},_getRequestData:function(a,b,c){return a}});d.register("mail.MoveTo",h);h.version="0.2.0";return h});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/actions/Archive",["require","exports","Action","mail/Folder","mail/actions/MoveTo","mail/actions/MarkAs"],function(require,exports,a,b,c,d){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);var e=c.default.extend({_markAs:null,prepare:function(a){var d=this;var e;if(!a.models){return Promise.reject({models:"required"})}var f=a.models[0];var g=(e=f===null||f===void 0?void 0:f.get)===null||e===void 0?void 0:e.call(f,"folder");if(!f||g===undefined){return Promise.reject({models:"invalid type, it should be array of Thread or Message models"})}return b.default.ensureArchive(g).then(function(b){d.folderTo=b;a.folderTo=b.id;return c.default.fn.prepare.call(d,a)})},operation:function(a,b){var e=this;return c.default.fn.operation.call(this,a,b).then(function(b){var c=a[0].constructor;var f=[].concat(b.body);var g=f.map(function(a){return c.getSafe(a)});e._markAs=d.default.execute({flag:"unread",state:false,models:g},{silent:true})})},undoOperation:function(a){this._markAs.then(function(a){return a.undo()});return c.default.fn.undoOperation.call(this,a)}});a.default.register("mail.Archive",e);e.version="1.0.0";exports.default=e;return e});define("mail/actions/MoveToAll",["mail/actions/MoveTo","RPC","Action","mail/Folder","mail/Message","mail/Thread"],function(a,b,c,d,e,f){"use strict";var g=a.extend({folderFrom:null,prepare:function(a){var b=a.folderTo,c=a.folderFrom;if(b==c){return null}this._rollbackCounters={};this._rollbackFolders={};return this._findFolders([b,c]).then(function(a){var b=f.all.filter({folder:c});if(b.length===0){b=e.all.filter({folder:c})}this.models=b;this.folderTo=a[0];this.folderFrom=a[1];return b}.bind(this))},operation:function(a,c){this._applyChanges(a,c.folderTo);return b.call(e.url("moveToAll"),{folder:c.folderTo,folder_from:c.folderFrom})},undoOperation:function(){throw"Undo is not possible"},_applyChangesFolder:function(b,c){var e=d.get(this.params.folderTo),f=d.get(this.params.folderFrom),g=this._rollbackCounters;b={};if(c){b[e.id]=g[e.id];b[f.id]=g[f.id]}else{g[f.id]={unread:f.get("messages_unread"),total:f.get("messages_total")};g[e.id]={unread:-f.get("messages_unread"),total:-f.get("messages_total")};b[e.id]=g[f.id];b[f.id]=g[e.id]}a.fn._applyChangesFolder.call(this,b)}});c.register("mail.MoveToAll",g);g.version="0.1.1";return g});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/actions/ArchiveAll",["require","exports","Action","mail/actions/MoveToAll","mail/actions/MarkAsAll","mail/Folder"],function(require,exports,a,b,c,d){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);var e=b.default.extend({_markAs:null,prepare:function(a){var c=this;var e=a.folderFrom;if(e===undefined){return Promise.reject({folderFrom:"required"})}return d.default.ensureArchive(e).then(function(d){c.folderTo=d;a.folderTo=d.id;return b.default.fn.prepare.call(c,a)})},operation:function(a,d){var e=this;return b.default.fn.operation.call(this,a,d).then(function(){return c.default.execute({flag:"unread",state:false,folderFrom:d.folderTo}).then(function(a){e._markAs=a})})}});a.default.register("mail.ArchiveAll",e);e.version="0.1.0";exports.default=e;return e});define("mail/actions/ConfirmReceipt",["RPC","request","Action"],function(a,b,c){"use strict";var d=c.extend({url:"/cgi-bin/sendrcpt/",operation:function(c,d,e){var f=c.model;if(!f.id){return Promise.reject({id:"required"})}var g=a.setup();var h=g.email;var i=""+g.token;var j=i.split(":");this._requestData={"x-email":h,form_sign:j[0],form_token:j[1],id:f.get("id"),folder:f.get("folder"),ajax_call:0,isUser:true,sendrcpt:1};return b(this.url,this._requestData,{type:"POST",dataType:"text"}).then(function(a){f.set("flags.receipt",false,{clean:true});return a})}});c.register("mail.ConfirmReceipt",d);d.version="0.1.0";return d});define("mail/actions/Delete",["RPC","Action","mail/Thread","utils/util"],function(a,b,c,d){"use strict";var e=b.extend({models:[],prepare:function(a){var b=a.models||[];this.models=b;return b.length?b:null},operation:function(b){var e=b[0].constructor,f;function g(a){return e.List.fn.pluck.call(b,a)}f={ids:JSON.stringify(g("id"))};if(b[0]instanceof c){f.message_id_last=JSON.stringify(d.object(g("id"),g("last")))}return a.call(e.url("delete"),f).then(function(){e.List.fn.destroy.call(b)})}});b.register("mail.Delete",e);e.version="0.1.1";return e});define("mail/actions/DeleteAll",["RPC","Action","mail/Folder","mail/Message","mail/Thread"],function(a,b,c,d,e){"use strict";var f=b.extend({folderFrom:null,prepare:function(a){return c.findOne(a.folderFrom).then(function(a){this.folderFrom=a;return a.isSecureOpen()?a:b.waitFor("folderSecure",[a]).then(function(){return a})}.bind(this))},operation:function(a){return a.cleanup().then(function(){var b={folder:a.id};e.all.filter(b).destroy();d.all.filter(b).destroy()})}});b.register("mail.DeleteAll",f);f.version="0.1.0";return f});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/Contact",["require","exports","RPCModel","Storage","utils/util"],function(require,exports,a,b,c){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=a.default.extend({className:"mail.Contact",storage:new b.default("mail.contacts"),findUrl:function(a){return a&&a.fast?"ab/fast?need_id=true":"ab"},defaults:{id:null,nick:"",name:{first:"",last:""},birthday:{day:0,month:0,year:0},avatars:{default:""},sex:"male",company:"",job_title:"",boss:"",flags:{star:false,import:false,auto:false,corp:false,non_manual:false},emails:[],phones:[],social:[],labels:[],comment:"",address:"",priority:0},getFullName:function(){return c.default.calculateFullName({first:this.get("name.first"),last:this.get("name.last")})},parse:function(a){if(Array.isArray(a)){return a.map(function(a){var b={name:{}};var c=typeof a[0]==="string"?a[0].split(" "):["",""];b[this.idAttr]=a[2];b.name.last=c.pop();b.name.first=c.join(" ");b.emails=a[1];return b},this)}else{return a.contacts}},isDataFully:function(){return this.is("birthday.day")}});d.version="0.2.0";exports.default=d;return d});define("mail/Spam/old-api-adapter",["RPC","request","mail/Folder","utils/util","mail/Message"],function(a,b,c,d,e){"use strict";b.on("start",function(b,c){var e=c.options;if(e.url.indexOf("/threads/services/unspam")!==-1){e.url=a.url("threads/move");d.extend(e.data,{nospam:1})}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mail/actions/Spam",["require","exports","Action","mail/Folder","mail/Message","mail/Thread","mail/actions/MoveTo","mail/Contact","mail/Spam/old-api-adapter"],function(require,exports,a,b,c,d,e,f){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);var g=e.default.extend({folderTo:null,prepare:function(d){var g=this,h=d.models.length?d.models[0].constructor:c.default,i=d.spam?b.default.SPAM:b.default.INBOX,j;d.folderTo=i;!(d.models instanceof h.List)&&(d.models=new h.List(d.models));g.folderFrom=d.models.length>0?d.models[0].getFolder():undefined;g.Model=h;if(d.spam){j=f.default.find().then(function(b){var e=d.models,f=e.length,g=new c.default.List,h,i,j,k;while(f--){j=e[f].get("correspondents.from");for(k=0;k<j.length;k++){i=j[k].email;h=b.length;while(i&&h--){if(-1!==b[h].get("emails").indexOf(i)){g.set([e[f]]);break}}}}if(g.length){return a.default.waitFor("spamAllowContacts",[g])["catch"](function(){return Promise.resolve(true)}).then(function(a){if(!a){g.forEach(function(a){e.remove(a)})}})}})}else{j=Promise.resolve()}return j.then(function(){return d.models.length?g._findFolders([i]):Promise.resolve([])}).then(function(a){g.folderTo=a[0];return e.default.fn.prepare.call(g,d)})},getActionType:function(a,b){return!b&&a.spam||b&&!a.spam?"spam":"unspam"},_getRequestUrl:function(a,b,c){return a.url(this.getActionType(b,c))},_getRequestData:function(a,b,c){a.unsubscribe=+!!b.unsubscribe;if(b.verified){a.verified=true}var e=this.getActionType(b,c);var f=e==="unspam";var g=this.Model===d.default&&f;if(this.folderFrom!==undefined&&!g){if(!c){a.folder=f?this.folderTo.id:this.folderFrom.id}if(c){a.folder=f?this.folderFrom.id:this.folderTo.id}}return a}});a.default.register("mail.Spam",g);g.version="1.0.0";exports.default=g;return g});define("feast-tpl!app/feast-tpl!ui-block/layer-move-to-folder/layer-move-to-folder.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:match name="content">\n\t\t<div bem:elem="content">\n\t\t\t<b:list-nested-moveto-folder\n\t\t\t\t\tmodel="{attrs.letter}"\n\t\t\t\t\tfolder="{attrs.folder || attrs.letter.get(\'folder\')}"\n\t\t\t\t\tfolders="{attrs.folders || app.model.folders}"\n\t\t\t\t\tlettersFoldersIds="{attrs.lettersFoldersIds}"\n\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t\tallow-new-folder\n\t\t\t\t\tallow-move="{false}"\n\t\t\t\t\tuse:mediator="pony-mode folders-actions letters-selections"\n\t\t\t\t\tqa:id="list-moveto-folder"\n\t\t\t\t\tremit:move="folders:click"\n\t\t\t/>\n\t\t</div>\n\t</fn:match>\n\n\t<b:layer\n\t\t\tname="move-to-folder"\n\t\t\tremit:close="layer:close"\n\t\t\tclose\n\t\t\theader\n\t\t\tcenter\n\t\t\thiddenfooter\n\t\t\tstandard\n\t\t\tresolvable\n\t>\n\t\t<fn:match name="header">\n\t\t\t<div bem:elem="title">{i18n(\'Переместить в папку\')}</div>\n\t\t</fn:match>\n\n\t\t<fn:match name="content">\n\t\t\t<div bem:elem="row">\n\t\t\t\t<fn:apply-match name="content"/>\n\t\t\t</div>\n\t\t</fn:match>\n\n\t</b:layer>\n</div>\n',"app/feast-tpl!ui-block/layer-move-to-folder/layer-move-to-folder.html")});define("feast-tpl!ui-block/layer-move-to-folder/layer-move-to-folder.html",["feast-tpl!app/feast-tpl!ui-block/layer-move-to-folder/layer-move-to-folder.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/layer-mobile/layer-mobile.html",["feast"],function(a){return a.smartParse('<div>\n\t<bem:mod name="standard" test="attrs.standard"/>\n\t<bem:mod name="center" test="attrs.center"/>\n\t<bem:mod name="media" test="attrs.media"/>\n\t<bem:mod name="{attrs.name}" test="attrs.name"/>\n\n\t<fn:match name="header">\n\t\t<span\n\t\t\tbem:elem="back"\n\t\t\tremit:click="layer:close">\n\t\t\t<b:button2 text="{i18n(\'Назад\')}"\n\t\t\t\tico="back"\n\t\t\t\tpure\n\t\t\t\ttouch\n\t\t\t\tshort\n\t\t\t\ttext-center\n\t\t\t/>\n\t\t</span>\n\t\t<span bem:elem="title">Title</span>\n\t</fn:match>\n\n\t<fn:match name="content">\n\t\t<b:nav-folders\n\t\t\t\tmodels="{app.model.folders}"\n\t\t\t\ttouch-nav\n\t\t\t\tcounters-off/>\n\t</fn:match>\n\n\t\x3c!-- Здесь нужно вставить кнопку Назад --\x3e\n\t<div bem:elem="header">\n\t\t<fn:apply-match name="header"/>\n\t</div>\n\n\t<div class="layer-mobile__content">\n\t\t<fn:apply-match name="content"/>\n\t</div>\n\n\t<div class="layer-mobile__footer">\n\t\t<fn:apply-match name="footer"/>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/layer-mobile/layer-mobile.html")});define("feast-tpl!ui-block/layer-mobile/layer-mobile.html",["feast-tpl!app/feast-tpl!ui-block/layer-mobile/layer-mobile.html"],function(a){return a});define("ui-block/layer-mobile/layer-mobile",["exports","feast","feast-tpl!./layer-mobile.html","ui-block/button2/button2","ui-block/nav-folders/nav-folders","ui-block/scrollable/scrollable"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=k(a);var g=k(b);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend({name:"layer-mobile",template:g.default,blocks:{button2:h.default,"nav-folders":i.default,scrollable:j.default}})});define("ui-block/layer-move-to-folder/layer-move-to-folder",["exports","feast","feast-tpl!./layer-move-to-folder.html","ui-block/button2/button2","ui-block/layer/layer","ui-block/layer-mobile/layer-mobile","ui-block/list-nested-moveto-folder/list-nested-moveto-folder"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=m(a);var h=m(b);var i=m(c);var j=m(d);var k=m(e);var l=m(f);function m(a){return a&&a.__esModule?a:{default:a}}var n=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};exports.default=g.default.Block.extend({name:"layer-move-to-folder",template:h.default,blocks:{"layer-mobile":k.default,layer:j.default,button2:i.default,"list-nested-moveto-folder":l.default},events:{"folders:click":"onFoldersClick"},onFoldersClick:function a(b){var c=this.get("letter");if(c){this.broadcast("move",n({},b.details,{model:c}))}else{this.broadcast("move",n({},b.details,{selection:true,model:undefined}))}this.broadcast("layer:close")}})});define("mediator/letters-selection",["exports","data-source/utils/paginator","default-values","feast","mail/Folder","mail/Thread","models/dataset-model/dataset-model","models/metathread/metathread","models/skeleton-letter/skeleton-letter","pilotjs","route/utils/filter-query","service/secure-folder","ui-block/contextmenu/contextmenu","ui-block/contextmenu-message/contextmenu-message","ui-block/contextmenu-selection/contextmenu-selection","ui-block/dataset-letters/dataset-letters","ui-block/dropdown-actions/dropdown-actions","ui-block/layer-move-to-folder/layer-move-to-folder","ui-block/layout/layout","ui-block/letter-meta/letter-meta","ui-block/list-nested-moveto-folder/list-nested-moveto-folder","ui-block/panel-with-selected/panel-with-selected","ui-block/portal-menu/portal-menu","ui-block/portal-menu-element/portal-menu-element","ui-block/search-panel/search-panel","ui-block/webview-mobile-header/webview-mobile-header","../lazy.modules"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var A=X(c);var B=X(d);var C=X(e);var D=X(f);var E=X(g);var F=X(h);var G=X(i);var H=X(j);var I=X(k);var J=X(l);var K=X(m);var L=X(n);var M=X(o);var N=X(p);var O=X(q);var P=X(r);var Q=X(s);var R=X(t);var S=X(u);var T=X(v);var U=X(w);var V=X(x);var W=X(y);function X(a){return a&&a.__esModule?a:{default:a}}function Y(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:true,configurable:true,writable:true})}else{a[b]=c}return a}var Z=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var _=function a(b){while(b.originalEvent){b=b.originalEvent}return b};exports.default=A.default.Mediator.create("letters-selection",{performanceTrace:"track",defaults:function a(){this.map={};this.scope={};this.folderSelected={};this.specialFolderSelected={}},components:{router:{class:G.default,events:["route"]},layout:{class:P.default,attrs:{selectMode:function a(b){return b.hasSelected()}}},"portal-menu":{class:T.default,events:["select:all","select:drop","select:toggle"],attrs:{selected:function a(b){return b.getModels()},selectMode:function a(b){return b.hasSelected()},selectFolder:function a(b){return b.isFolderSelected()},deselectAll:function a(b){return b.isFolderSelected()||b.isSpecialFolderSelected()}}},"search-panel":{class:V.default,events:["select:drop"],attrs:{hide:function a(b){return b.hasSelected()}}},listNestedMoveToFolder:{class:R.default,attrs:{lettersFoldersIds:function a(b){return b.getLettersFoldersIds()},selectedMetathreads:function a(b){return b.hasSelectedMetathread()}}},portalMenuElement:{class:U.default,attrs:{lettersFoldersIds:function a(b){return b.getLettersFoldersIds()}}},"layer-move-to-folder":{class:O.default,attrs:{lettersFoldersIds:function a(b){return b.getLettersFoldersIds()}}},dropdownActions:{class:N.default,attrs:{route:function a(b){return b.get("router.route")},lettersFoldersIds:function a(b){return b.getLettersFoldersIds()}}},"dataset-letters":{class:M.default,events:["selected:toggle"],attrs:{selected:function a(b){return b.getHashMap()},selectedLength:function a(b){return b.getModels().length},selectedModelsData:function a(b){return b.getModels()},"select-folder":function a(b){return b.isFolderSelected()},metathreadsWithSelected:function a(b){return b.getMetathreadsWithSelected()}}},panelWithSelected:{class:S.default,attrs:{selected:function a(b){return b.getModels()},selectFolder:function a(b){return b.isFolderSelected()}}},contextmenu:{class:J.default,events:["select:all","select:drop"],attrs:{"selected-map":function a(b){return b.getHashMap()},"selected-length":function a(b){return b.getModels().length}}},"contextmenu-message":{class:K.default,events:["select:all","select:drop"],attrs:{isSearchDisabled:function a(b){return b.getModels().length>1},deselectAll:function a(b){return b.isFolderSelected()||b.isSpecialFolderSelected()},"disable-create-event":function a(){return b.DISABLE_CREATE_EVENT}}},"contextmenu-selection":{class:L.default,events:["select:all","select:drop"],attrs:{"selected-folder":function a(b){return b.isFolderSelected()&&b.getCurrentFolder()},selected:function a(b){return b.getModels()},"if-folder-selected":function a(b){return b.isFolderSelected()||b.isSpecialFolderSelected()},"letters-folders-ids":function a(b){return b.getLettersFoldersIds()},"selected-metathreads":function a(b){return b.hasSelectedMetathread()}}},"layer-create-folder":{lazy:z.lazyUILayerCreateFolder,attrs:{selectMode:function a(b){return b.hasSelected()}}},"search-mobile-panel":{lazy:z.lazyUILayerCreateFolder,attrs:{selectMode:function a(b){return b.hasSelected()}}},"letter-meta":{class:Q.default},"webview-mobile-header":{class:W.default,events:["select:all","select:drop"],attrs:{selected:function a(b){return b.getModels()},selectMode:function a(b){return b.hasSelected()},selectFolder:function a(b){return b.isFolderSelected()},deselectAll:function a(b){return b.isFolderSelected()||b.isSpecialFolderSelected()}}}},reset:function a(){var c=this.hasSelected();this.switchScope(this.scopeId);if(c||b.NEW_LETTER_LIST){this.updateAll()}},resetLetterMeta:function a(){this.getList("letter-meta").forEach(function(a){a.destroy()})},cleanSelection:function a(b){var c=this.hasSelected();this.cleanScope(this.scopeId);this.switchScope(this.scopeId);(c||b)&&this.updateAll()},switchScope:function a(b){this.map=this.scope[b]||(this.scope[b]={});this.scopeId=b},updateScope:function a(){this.scope[this.scopeId]=this.map},cleanScope:function a(b){b=b==void 0?this.scopeId:b;this.scopeId==b&&(this.map={});this.scope[b]={};delete this.folderSelected[b];delete this.specialFolderSelected[b]},getAllModelsWithPaginator:function a(b){var c=[];var d=this.get("router.route");if(d.is("#search #search-letter")){return this.getAllUIModels()}if(b===undefined){c=C.default.all.slice()}else{c=C.default.all.filter(function(a){return a.get("folder")==b})}c.set(this.getAllUIModels().filter(function(a){if(b===undefined){return E.default.isMetathread(a)}return a.get("folder")==b&&E.default.isMetathread(a)}));c=c.sort("date",{reverse:true}).toArray();return c},getAllModels:function b(c){var d=this.get("router");if((0,a.isPaginatorGlobalEnabled)(d)){return this.getAllModelsWithPaginator(c)}var e=this.get("router.route.id");var f=[];var g="uiLetters";if(e=="#search"||e=="#search-letter"){g="search.letters"}if(typeof c!=="undefined"&&g!=="search"){f=C.default.all.filter(function(a){return String(a.get("folder"))===String(c)}).sort("date",{reverse:true}).toArray()}else{var h=this.get("router.model."+g)||[];var i=this.get("router.model.search.suggestLetters")||[];f=h.concat(i)}return f},getAllUIModels:function a(){var b=this.get("router.route.id");var c=b==="#search"||b==="#search-letter"?"search.letters":"uiLetters";var d=this.get("router.model."+c)||[];var e=this.get("router.model.search.suggestLetters")||[];return d.concat(e)},getHashMap:function a(){return this.map},getModels:function a(){var b=this.getAllModels();var c=[];function d(a){var b=true;if(a.get("advModel")||D.default.isDatasetModel(a)){return false}if(E.default.isMetathread(a)){b=this.map[a.id]}else if(this.isFolderSelected()){b=true}else{b=this.map[a.id]}return b}c=b.filter(d.bind(this));return c},getLettersFoldersIds:function a(){var b=this.getModels();var c=b.reduce(function(a,b){var c=void 0;if(E.default.isMetathread(b)){c=b.get("metathread_data.folder")}else{c=b.get("folder")}return Z({},a,Y({},c,true))},{});return Object.keys(c)},isFolderSelected:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.scopeId;return!!this.folderSelected[b]},getMetathreadsWithSelected:function a(){var b=this;var c={};var d=this.getAllModels();d.forEach(function(a){if(!a.get("flags.metathread")){return}if(b.map[a.id]){c[a.id]=true;return}var d=a.get("metathread_data.folder");var e=b.getAllModels(d);var f=e.filter(function(a){return b.map[a.id]});if(f.length>0){c[a.id]=true}});return c},hasSelectedMetathread:function a(){return Object.keys(this.map).some(function(a){return!!E.default.all.get(a)})},isSpecialFolderSelected:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.scopeId;return!!this.specialFolderSelected[b]},getCurrentFolder:function a(){return B.default.get(this.scopeId)},hasSelected:function a(){var b=this.get("router.route");var c=this.get("layout");if(c&&c.get("type")==="2pane"&&b.is("#read-letter #search-letter")){return false}return this.getModels().length>0},deselect:function a(b){var c=this;if(b){if(b.id!=null){b=[b]}var d=Object.keys(this.scope);b.forEach(function(a){d.forEach(function(b){delete c.scope[b][a.id]})});this.updateAll()}},emitChange:function a(){this.emit("change",this)},select:function a(b){this.map[b.id]=true;this.updateAll()},handleEvent:function a(b){var c=this;var d=b.type;var e=this.get("router");switch(d){case"route":var f=e.model.folder?e.model.folder.id:e.activeRoute.id;if(e.request.is("#search")||e.request.is("#search-letter")){f="search"}this.switchScope(f);if(e.request.is("#letters")){this.reset();this.resetLetterMeta()}return false;case"selected:toggle":var g=b.details;var h=g.get("folder");var i=this.getAllModels();var j=this.getAllUIModels();var k=!!this.map[g.id];var l=_(b);var m=j.indexOf(g);var n=g.get("flags.metathread");var o=!!this.map["multithreadFixId"+h];var p=j.indexOf(this.prevSelected);if(!l.shiftKey||p===-1){p=m}var q=[Math.min(p,m),Math.max(p,m)];var r=q[0]<q[1];var s=Z({},this.map);for(var t=q[0],u=q[1];t<=u;t++){var v=j[t];var w=v.get("flags.metathread");var x=F.default.isSkeleton(v);if(r&&w){continue}if(r&&x){s=Z({},this.map);k?delete s[g.id]:s[g.id]=true;break}k?delete s[v.id]:s[v.id]=true}this.map=s;this.updateScope();this.prevSelected=g;if(n){var y=g.get("metathread_data.folder");var z=this.getAllModels(y);z.forEach(function(a){return delete c.map[a.id]});var A=B.default.get(y);if(A&&!A.isSecureOpen()){this.map[g.id]=false;(0,I.default)(A).then(function(a){if(a){c.map[g.id]=true}})}}else if(!this.isFolderSelected()){if(o){delete this.map["multithreadFixId"+h];var C=this.getAllModels(h);C.forEach(function(a){var b=a.id===g.id;if(b){delete c.map[a.id]}else{c.map[a.id]=true}})}}else if(this.isFolderSelected()){delete this.folderSelected[this.scopeId];if(h===this.scopeId){delete this.map[g.id];i.forEach(function(a){if(a.id!==g.id&&!a.get("flags.metathread")&&a.get("folder")===c.scopeId){c.map[a.id]=true}})}else{i.forEach(function(a){if(!a.get("flags.metathread")&&a.get("folder")===c.scopeId){c.map[a.id]=true}});if(o){delete this.map["multithreadFixId"+h];var D=this.getAllModels(h);D.forEach(function(a){var b=a.id===g.id;if(b){delete c.map[a.id]}else{c.map[a.id]=true}})}}}if(this.isSpecialFolderSelected()){delete this.folderSelected[this.scopeId]}this.emitChange();break;case"select:toggle":b.type=this.isFolderSelected()?"select:drop":"select:all";this.handleEvent(b);break;case"select:all":if(H.default.has()||e.route.is("#search #search-letter")){this.getAllModels().forEach(function(a){c.map[a.id]=true});this.specialFolderSelected[this.scopeId]=true}else{this.folderSelected[this.scopeId]=true}this.emitChange();break;case"select:drop":this.cleanScope();this.emitChange();break}}})});define("mediator/settings-filters-manager",["exports","@mail/xray","feast","filters/Filter","mediator/letters-selection","pilotjs","service/layer","ui-block/contextmenu-message/contextmenu-message","ui-block/contextmenu-selection/contextmenu-selection","ui-block/dropdown-actions/dropdown-actions","ui-block/octopus/octopus","../lazy.modules"],function(exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var l=v(a);var m=v(b);var n=v(c);var o=v(d);var p=v(e);var q=v(f);var r=v(g);var s=v(h);var t=v(i);var u=v(j);function v(a){return a&&a.__esModule?a:{default:a}}exports.default=m.default.Mediator.create("settings-filters-manager",{defaults:function a(){},components:{router:{class:p.default},letter:{lazy:k.lazyUILetter,events:["settingsfilters:create"]},"dropdown-actions":{class:t.default,events:["settingsfilters:create"]},"contextmenu-message":{class:r.default,events:["settingsfilters:create"]},"contextmenu-selection":{class:s.default,events:["settingsfilters:create"]},octopus:{class:u.default,events:["settingsfilters:create"]}},handleEvent:function a(b){var c=b.type;var d=void 0;var e=void 0;var f=void 0;if(b.details){d=b.details.folder;e=b.details.model;f=b.details.models}if(!f){if(o.default.hasSelected()){f=o.default.getModels()}else{f=[e||this.get("router.model.letter")]}}switch(c){case"settingsfilters:create":this.openCreateFilter({models:f,move:d});break}},_getFilterTemplateValues:function a(b){var c={subject:[],from:[],to:[],size:[10],cc:[]};b.forEach(function(a){var b=a.get("subject");if(!c.subject.includes(b)){c.subject.push(b)}var d=a.get("correspondents.from.0.email");if(!c.from.includes(d)){c.from.push(d)}var e=a.get("correspondents.to")||[];e.forEach(function(a){if(!c.to.includes(a.email)){c.to.push(a.email)}});var f=a.get("correspondents.cc")||[];f.forEach(function(a){if(!c.cc.includes(a.email)){c.cc.push(a.email)}})});return c},openCreateFilter:function a(b){var c=b.models,d=b.move;var e=this._getFilterTemplateValues(c);var f=new n.default({applyFolders:[0],conditions:[{name:"from",not:false,value:e.from.join(", ")}]});l.default.send("settings-create-filter",{dwh:{folder_id:d}});e.from=[];if(d!==void 0){f.set("actions.move",d)}q.default.open("edit-settings-filter",{filterModel:f.toJSON(),templateValues:e},{dimmer:true,"close-on-dimmer":false,"close-on-esc":false}).then(function(){})}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/thread-scroller",["require","exports","@mail/xray","data-source/actions","data-source/data-source","default-values","feast","mail/Thread","pilotjs","service/radars/index","ui-block/layout/layout","ui-block/letter/letter","ui-block/scrollable/scrollable","ui-block/thread/thread"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ThreadScroller=void 0;a=__importDefault(a);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);var m=function(e){__extends(m,e);function m(){var a=e!==null&&e.apply(this,arguments)||this;a._letterPosition={};a._ignoreAutoRead={};a.currentReadingMessageId=null;a.currentReadingMessageIndex=null;return a}m.prototype.defaults=function(){var a=this;f.default.all.on("change",function(b){var c=a.get("thread");var d=a.get("scrollable");if(c&&d){a.checkHandleMessageRemoved(b)}})};m.prototype.getComponentsSpec=function(){return{router:{class:g.default,events:[]},dataSource:{class:c.default,events:["actionend"]},thread:{class:l.default,events:["letter:resize","letter:expand:attaches","letter:collapse","force:recalc"]},letter:{class:j.default,events:[]},scrollable:{class:k.default,events:["scroll:onbottom","scroll:change"]},layout:{class:i.default}}};m.prototype.handleEvent=function(a){var c=a.type;var d=a.details;var e=this.get("thread");var f=this.get("scrollable");if(e&&f){switch(c){case"scroll:change":case"force:recalc":this.onScroll();break;case"scroll:onbottom":this.emit("thread:nextpage");break;case"letter:resize":this.onLetterExpanded(d);break;case"letter:expand:attaches":this.onLetterExpanded(d);break;case"letter:collapse":this.handleMessageCollapsed(d);return false;case"actionend":if(d&&d.action.type===b.NAVIGATE){this.onNewThread(true)}break}}};m.prototype.getModel=function(){return this.get("thread").get("model")};m.prototype.onNewThread=function(a){if(a){this.get("scrollable").reset();this._ignoreAutoRead={};this._letterPosition={}}this.onScroll()};m.prototype.getEdges=function(){var a=this.get("scrollable");var b=a.el.getBoundingClientRect();var c=b.top;var d=b.bottom;var e=d-c;var f=d-e/3;var g=a.getScrollDir()||"down";return{top:c,bottom:d,height:e,readline:f,direction:g}};m.prototype.getLetterBlockInstances=function(a){if(a==null||this.getList("letter")==null){return[]}return this.getList("letter")};m.prototype.onScroll=function(){var a=this.get("thread");var b=a&&a.get("model");if(!a||!b){return}var c=this.getLetterBlockInstances(a);var d=this.getEdges();var e=this._letterPosition;var f=this.getIgnoredLetters();var g=null;var i=false;for(var j=0;j<c.length;j++){var k=c[j].get("model");var l=k.get("id");var m=a.get("model").get("messages").last().id===l;var n=a.get("model").get("messages").first().id===l;var o=this.getLetterPosition(c[j],d,m,n);if(o.sticky){g=l}if(o.topMost){i=true;this.currentReadingMessageId=l;this.currentReadingMessageIndex=a.get("model").get("messages").indexOf(k)}if(o.readline&&k.is("flags.unread")&&!f[l]){f[l]=true;(0,h.default)(["letter","open","unread"]);this.emit("mark:readed",k)}e[l]=o}if(!i){this.currentReadingMessageId=null}a.isStickyEnabled()&&this.setSticky(g)};m.prototype.setSticky=function(a){var b=this.get("thread");var c=b.get("sticky");var d=this._letterPosition[a];if(!a||!d.sticky){c&&b.set("sticky",null);return}var e={head:d.stickyHead,footer:d.stickyFooter,headFade:d.stickyHeadFade,footerFade:d.stickyFooterFade,bottom:d.bottom,top:d.top,id:a};var f=!c||c.id!==a||c.head!==e.head||c.footer!==e.footer;f&&b.set("sticky",e)};m.prototype.onLetterExpanded=function(a){var b=a.get("id");var c=this.getEdges();var d=this.getLetterView(b);if(d==null){return}c.direction="down";this._letterPosition[b]=this.getLetterPosition(d,c);this.setSticky(b)};m.prototype.getLetterPosition=function(a,b,c,e){if(c===void 0){c=false}if(e===void 0){e=false}c=!d.IS_READLETTER_NATIVE_STICKY_DISABLED&&c;e=!d.IS_READLETTER_NATIVE_STICKY_DISABLED&&e;var f={};if(!a.el){return{}}var g=a.el.getBoundingClientRect(),h=g.top,i=g.bottom,j=g.height;if(i<b.top||h>b.bottom){f.visible=false}else{f.visible=true;if(h<b.readline){f.readline=true}if(h<=b.top){f.topMost=true}if(b.direction=="down"){if(h<b.readline&&j>b.height){f.sticky=true;f.stickyFooter=true;f.stickyFooterFade=true;f.bottom=0}if((h<b.top||c)&&j>b.height){f.sticky=true;f.stickyHead=true;f.top=b.top}if(i<b.bottom&&!c){f.stickyHead=false;f.stickyFooter=false;f.sticky=false}}else{if((i>b.readline||c)&&j>b.height){f.sticky=true;f.stickyHead=true;f.stickyHeadFade=true;f.top=b.top}if(h<b.readline&&(i>b.bottom||c)&&j>b.height){f.sticky=true;f.stickyFooter=true;f.bottom=0}if(h>b.top&&!e&&f.stickyFooter){f.stickyHead=false;delete f.top}if(h>b.top&&!f.stickyFooter){f.stickyHead=false;f.stickyFooter=false;f.sticky=false}}}return f};m.prototype.getLetterView=function(a){var b=this.get("thread");var c=this.getLetterBlockInstances(b);return c.find(function(b){return b.get("model").get("id")==a})};m.prototype.resetScroll=function(){this.get("scrollable").reset()};m.prototype.getIgnoredLetters=function(){var a=this.get("thread");var b=a.get("model");var c=this._ignoreAutoRead[b.get("id")]||{};var d=b.get("messages");d.forEach(function(a){var d=a.get("folder")==b.get("folder");if(c[a.get("id")]||a.get("flags.unread")&&d){return}c[a.id]=true});return c};m.prototype.checkHandleMessageRemoved=function(b){var c,d;if(!((c=b===null||b===void 0?void 0:b.changes)===null||c===void 0?void 0:c.includes)){a.default.send("threads-no-evt-changes",{rlog:"octavius-threads-no-evt-changes",rlog_message:{type:b===null||b===void 0?void 0:b.type,changes:b===null||b===void 0?void 0:b.changes,changed:b===null||b===void 0?void 0:b.changed,allChanged:b===null||b===void 0?void 0:b.allChanged,target_id:(d=b===null||b===void 0?void 0:b.target)===null||d===void 0?void 0:d.id}});return}if(!this.currentReadingMessageId||this.currentReadingMessageIndex==null||!b.changes.includes("messages")){return}var e=this.get("thread");var f=e&&e.get("model");if(!e||!f){return}var g=f.get("messages");var i=g[this.currentReadingMessageIndex];if(this.currentReadingMessageId===i.get("id")){return}if(!(g===null||g===void 0?void 0:g.includes)){a.default.send("threads-no-includes",{rlog:"octavius-threads-no-includes",rlog_message:{varType:typeof g,includes:typeof(g===null||g===void 0?void 0:g.includes),length:g===null||g===void 0?void 0:g.length}})}if(g.indexOf(this.currentReadingMessageId)!==-1){return}(0,h.default)("thread_scroll-to-next");this.currentReadingMessageId=null;e.scheduleScrollLetterIntoView(i.get("id"))};m.prototype.handleMessageCollapsed=function(a){if(this.currentReadingMessageId===a.get("id")){var b=this.get("thread");b.scheduleScrollLetterIntoView(this.currentReadingMessageId);this.currentReadingMessageId=null}};return m}(e.default.Mediator);exports.ThreadScroller=m;exports.default=e.default.Mediator.createFromClass("thread-scroller",m)});define("mediator/thread-manager",["exports","data-source/actions","data-source/index","feast","mail/Folder","mediator/thread-scroller","pilotjs","service/radars/index","ui-block/button2/button2","ui-block/thread/thread"],function(exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var j=r(b);var k=r(c);var l=r(d);var m=r(e);var n=r(f);var o=r(g);var p=r(h);var q=r(i);function r(a){return a&&a.__esModule?a:{default:a}}var s={};exports.default=k.default.Mediator.create("thread-manager",{defaults:function a(){var b=this;this._loading={};m.default.on("thread:nextpage",function(){return b.handleEvent({type:"thread:nextpage"})})},components:{router:{class:n.default,events:["routeend"]},thread:{class:q.default},button:{class:p.default,events:["letter:prev","letter:next","letter:back"]}},handleEvent:function a(b){var c=b.type;if(this.get("thread")){switch(c){case"letter:prev":this.goToLetter("prev");break;case"letter:next":this.goToLetter("next");break;case"letter:back":this.onBackClick();break;case"thread:nextpage":this.nextPage();break}}},getModel:function a(){var b=this.get("router");return b.model.letter},nextPage:function b(){var c=this.getModel();var d=c.id;var e=function a(){delete s[d]};var f=c.get("messages.length");var g=c.get("length");if(f<g&&!s[d]){s[d]=true;(0,o.default)({type:"thread-load-more",intervals:[["idx",f+1]]});j.default.dispatch({type:a.THREAD_LOAD_MORE,priority:n.default.Loader.PRIORITY_LOW}).then(e,e)}},goToLetter:function a(b){var c=this.getModel();var d=this.get("router");var e=d.route.is("#search-letter");var f=d.model&&d.model.letterNeighbours;var g=f&&f[b];if(g){var h=c.get("folder");if(d&&d.model&&d.model.folder){h=d.model.folder.id}var i=g.threadId,j=g.id;return d.go(e?"#search-letter":"#read-letter",{folder:h,letter:i,id:j},"inherit")}return Promise.reject("noNeighbours")},onBackClick:function a(){var b=this.getModel();var c=this.get("router");var d=c.route.is("#search-letter");var e=b.get("folder");if(c&&c.model&&c.model.folder){e=c.model.folder.id}if(b.isInMetathread()){e=l.default.INBOX}var f=c[d?"#search":"#letters"].getUrl({folder:e,preserveFilters:!d},"inherit");c.nav(f,{initiator:"popstate"})}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/share-folders",["require","exports","data-source/index","service/layer","service/mailbox/loader"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d={onLayerClose:function(){c.default.invalidateCache();a.default.updateAll()},renderLayer:function(a){var c=a.layerName,d=a.params;d.onLayerClose=this.onLayerClose;b.default.open(c,d,{"close-on-esc":false})},renderAccess:function(a){this.renderLayer({layerName:"share-folder-action",params:a})},renderShare:function(a){this.renderLayer({layerName:"share-folder",params:a})},renderShareOpportunities:function(a){this.renderLayer({layerName:"share-opportunities",params:a})},renderDenySharedFolder:function(a){this.renderLayer({layerName:"deny-shared-folder",params:a})},MODS:{NOT_ENOUGH_RIGHTS:"not_enough_rights"}};exports.default=d});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/letters-actions",["require","exports","@mail/xray","cfgUser","data-source/actions","data-source/index","data-source/utils/actual-letters","default-values","feast","feast-mod/correspondents","feast-mod/folder-name","helpers/metathreads","helpers/opener","logger","mail/actions/Archive","mail/actions/ArchiveAll","mail/actions/ConfirmReceipt","mail/actions/Delete","mail/actions/DeleteAll","mail/actions/MarkAs","mail/actions/MarkAsAll","mail/actions/MoveTo","mail/actions/MoveToAll","mail/actions/Spam","mail/Folder","mail/Message","mail/Thread","mediator/layout-manager","mediator/letters-selection","mediator/settings-filters-manager","mediator/swipe-manager","mediator/thread-manager","mediator/thread-scroller","models/metathread/metathread","pilotjs","route/utils/filter-query","service/adv/index","service/compose","service/getModule","service/layer","service/notify","service/radars/index","service/secure-folder","service/share-folders","service/threadUpdater","ui-block/contextmenu-correspondent/contextmenu-correspondent","ui-block/contextmenu-message/contextmenu-message","ui-block/contextmenu-metathread/contextmenu-metathread","ui-block/contextmenu-selection/contextmenu-selection","ui-block/dataset-letters/dataset-letters","ui-block/discounts-item/discounts-item","ui-block/dropdown-actions/dropdown-actions","ui-block/letter-list-item/letter-list-item","ui-block/letter-meta/letter-meta","ui-block/list-letter-common/list-letter-common","ui-block/list-letter-common-touch/list-letter-common-touch","ui-block/list-letter-compact/list-letter-compact","ui-block/list-letter-compact-touch/list-letter-compact-touch","ui-block/list-nested-moveto-folder/list-nested-moveto-folder","ui-block/metathread-head-common/metathread-head-common","ui-block/metathread-head-compact/metathread-head-compact","ui-block/metathread-head-compact-expanded/metathread-head-compact-expanded","ui-block/nav-folders/nav-folders","ui-block/octopus/octopus","ui-block/portal-menu/portal-menu","ui-block/settings-dock/settings-dock","ui-block/thread/thread","ui-block/webview-mobile-header/webview-mobile-header","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);g=__importDefault(g);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);I=__importDefault(I);J=__importDefault(J);K=__importDefault(K);L=__importDefault(L);M=__importDefault(M);N=__importDefault(N);O=__importDefault(O);P=__importDefault(P);Q=__importDefault(Q);R=__importDefault(R);S=__importDefault(S);T=__importDefault(T);U=__importDefault(U);V=__importDefault(V);W=__importDefault(W);X=__importDefault(X);Y=__importDefault(Y);Z=__importDefault(Z);_=__importDefault(_);aa=__importDefault(aa);ba=__importDefault(ba);ca=__importDefault(ca);da=__importDefault(da);ea=__importDefault(ea);fa=__importDefault(fa);ga=__importDefault(ga);ha=__importDefault(ha);ia=__importDefault(ia);ja=__importDefault(ja);ka=__importDefault(ka);la=__importDefault(la);ma=__importDefault(ma);var oa=50;var pa=10;var qa="msglist";var ra=0;var sa=["move","drop","remove","archive","spam","unspam","superspam","mark:readed","mark:allreaded","mark:unreaded","mark:flagged","mark:unflagged","mark:unpinned","togglestatus:unread","togglestatus:flagged","metathreadtogglestatus:unread","search:from","print","download","headers","newtab","forward","redirect","correspondent:search","click:letter","letter:prev","letter:next","confirmreceipt"];var ta=["mark:readed","mark:unreaded","togglestatus:unread","mark:flagged","mark:unflagged","togglestatus:flagged","spam","unspam","move","remove","archive"];var ua={STAY:"stay",GO_TO_NEXT:"next",GO_TO_FOLDER:"folder",GO_TO_SEARCH:"search"};var va={archive:function(){return i18n("Перемещено в архив")},"markas.flagged.true":function(){return i18n("Помечено флажком")},"markas.flagged.false":function(){return i18n("Снят флажок")},"markas.unread.true":function(){return i18n("Помечено непрочитанным")},"markas.unread.false":function(){return i18n("Помечено прочитанным")},"spam.true":function(a){if(typeof a==="number"&&a>0){var b={count:a};return i18n.plural(a,[i18n("{count} писем перемещены в спам",b),i18n("{count} письмо перемещено в спам",b),i18n("{count} письма перемещены в спам",b)])}return i18n("Перемещено в спам")},"spam.false":function(){return i18n("Перемещено из папки «Спам»")},delete:function(){return i18n("Письмо удалено")},confirmreceipt:function(){return i18n("Прочтение подтверждено")},moveto:function(a){var b=a;var c=i18n("Перемещено в папку");var d=6;var e=z.default.isLessThen("xs")?M.default.MAX_LENGTH_SMALL:M.default.MAX_LENGTH;var f=e-c.length-d;if(b.length>f){b=b.slice(0,Math.max(0,f-1))+"…"}return"".concat(c," «").concat(b,"»")},"moveto.metathread.action":function(){return i18n("Невозможно переместить системную папку. Перенести остальные письма в спам?")},"moveto.metathread":function(){return i18n("Невозможно переместить системную папку")}};exports.default=g.default.Mediator.create("letters-actions",{_isNavigateProcessing:false,defaults:function(){var a=this;E.default.on("mark:readed",function(b){Q.default.subscribe(function(){a.doAction({type:"mark:readed",target:"thread-scroller"},[b])})})},actions:{spam:v.default,mark:r.default,move:t.default,remove:p.default,archive:m.default,markAll:s.default,moveAll:u.default,removeAll:q.default,archiveAll:n.default,confirmreceipt:o.default},components:{router:{class:G.default},"nav-folders":{class:ha.default,events:["move","drop"],handleEvent:"handleMoveTo"},"dataset-letters":{class:V.default,events:sa,attrs:{unsubscribeList:function(a){var b;return(b=a.get("router.model.unsubscribeList"))===null||b===void 0?void 0:b.actualSenders}}},octopus:{class:ia.default,events:["mark:allreaded"],attrs:{"read-all-in-progress":function(a){return a.readAllInProgress}}},"portal-menu":{class:ja.default,events:sa,attrs:{readAllInProgress:function(a){return a.readAllInProgress}}},"webview-mobile-header":{class:ma.default,events:sa},letter:{lazy:na.lazyUILetter,events:sa},dropdownActions:{class:X.default,events:sa},"letter-list-item":{class:Y.default,events:sa},"list-letter-common":{class:_.default,events:sa,attrs:{unsubscribeList:function(a){var b;return(b=a.get("router.model.unsubscribeList"))===null||b===void 0?void 0:b.actualSenders}}},"list-letter-common-touch":{class:aa.default,events:sa},"list-letter-compact":{class:ba.default,events:sa,attrs:{unsubscribeList:function(a){var b;return(b=a.get("router.model.unsubscribeList"))===null||b===void 0?void 0:b.actualSenders}}},"list-letter-compact-touch":{class:ca.default,events:sa},"layer-move-to-folder":{events:["move"]},"layer-confirm-move-to-spam":{events:["spam:force","remove"]},thread:{class:la.default,events:sa,attrs:{direction:function(a){return a.direction}}},"contextmenu-message":{class:S.default,events:sa},"contextmenu-selection":{class:U.default,events:sa},"contextmenu-metathread":{class:T.default,events:sa},"contextmenu-correspondent":{class:R.default,events:sa},"layer-create-folder":{lazy:na.lazyUILayerCreateFolder,events:sa},"list-nested-moveto-folder":{class:da.default,events:sa},"metathread-head-common":{class:ea.default,events:["metathreadtogglestatus:unread"]},"metathread-head-compact":{class:fa.default,events:["metathreadtogglestatus:unread"]},"metathread-head-compact-expanded":{class:ga.default,events:["metathreadtogglestatus:unread"]},"letter-meta":{class:Z.default,events:["spam","remove","move"]},"discounts-item":{class:W.default,events:sa},"settings-dock":{class:ka.default},"letter-swipe-actions":{events:sa}},handleMoveTo:function(a){var b=a.details;var c={type:"move",folderTo:b.id};var d=A.default.getModels();if(!d.length){return false}var e=d[0].getFolder();if(e.isShareTake()||b.isShareTake()){var f=e.isShareTake()!==b.isShareTake()||e.get("owner").email!==b.get("owner").email;var g=!b.checkGrant(w.default.SHARE_GRANTS.move)||!e.checkGrant(w.default.SHARE_GRANTS.move);var h=b.isSpam()&&!e.checkGrant(w.default.SHARE_GRANTS.move_to_spam);var i=b.isArchive()&&!e.checkGrant(w.default.SHARE_GRANTS.move_to_archive);var j=b.isTrashLike()&&!e.checkGrant(w.default.SHARE_GRANTS.remove);if(f||g||h||i||j){var k=f?"betweenUsers":undefined;P.default.renderAccess({mode:P.default.MODS.NOT_ENOUGH_RIGHTS,type:k,email:b.isShareTake()?b.get("owner").email:e.get("owner").email});return false}}var m=d.some(function(a){return a.getFolder().id!==c.folderTo||F.default.isMetathread(a)});if(m){l.default.wrap("moveTo",{folderTo:b},this.doAction(c,d))}else{(0,N.default)("illegal_move");l.default.add("illegal_move",{folderTo:b})}},setReadAllInProgress:function(a){this.readAllInProgress=a;this.updateAll()},handleFolderAllRead:function(a){var b=this;if(a===void 0){a=""}(0,N.default)(["letter-action","all-read",a]);this.setReadAllInProgress(true);s.default.execute({flag:"unread",state:false,folderFrom:this.get("router.model.folder.id")}).then(function(){(0,N.default)(["letter-action","all-read","success",a]);b.setReadAllInProgress(false);M.default.add({text:b.getNotifyText({name:"markas.unread.false",params:{}})})}).then(function(){var a=y.default.all.filter({folder:b.get("router.model.folder.id")}).toArray();b.hideUnsubscribeSender(a)}).catch(function(){(0,N.default)(["letter-action","all-read","error",a]);b.setReadAllInProgress(false)})},handleEvent:function(a){var b=this;var c,d,e;var f=a.type,g=a.details,i=g===void 0?{}:g;if(this._isNavigateProcessing){return false}var j=i.get&&i.attrs&&i.get("model")||i.model;var k=i.get&&i.attrs&&i.get("actionCallback")||i.actionCallback;switch(f){case"letter:next":{this.direction="next";break}case"letter:prev":{this.direction="prev";break}case"click:letter":{var l=A.default.getAllModels();var m=l.indexOf(i);this.direction=null;if(this.prevIdx>-1){this.direction=m>=this.prevIdx?"next":"prev"}this.prevIdx=m;break}case"correspondent:search":{this.doSearch("from",i.email,j);break}case"mark:allreaded":{var n=this.get("router.model.folder");var o="";if(n.isMetathread()){o="metathread"}if(n.isTrashLike()){o="trash"}if(n.isSpam()){o="spam"}if(o){this.handleFolderAllRead(o);return false}var p=[];p.push(n);L.default.open("confirm-folder-readed",{models:p},{dimmer:true,compact:true,resolvable:true}).then(function(a){var c=a===void 0?{resolveType:"error"}:a,d=c.resolveType;if(d==="ok"){b.handleFolderAllRead()}});return false}default:{var q=z.default.getType()==="2pane";var r=!!this.get("router.model.route.params.message");var s=this.get("router.model.route.params.message");var t=r?x.default.all.get(s):this.get("router.model.letter");var u=A.default.getModels();var v=i.selection&&(!t||!q&&u.length);var y=void 0;if(v){y=typeof u.toArray==="function"?u.toArray():u}else{y=j||t||[]}var B=[].concat(y);var C=void 0;if(B.length){var D={type:f,actionCallback:k,parentThread:i.parentThread};if(f==="move"){D.folderTo=i.id}if(f==="archive"){D.folderTo=(d=(c=w.default.all)===null||c===void 0?void 0:c.find(function(a){return a.isArchive()}))===null||d===void 0?void 0:d.get("id")}if(f.startsWith("search:")){C=(0,h.getCorrespondentsFromMessage)(j||t);this.doSearch(f,(e=C===null||C===void 0?void 0:C[0])===null||e===void 0?void 0:e.email,j)}else if(f==="forward"){this.doForward(B)}else if(f==="download"){this.doDownload(B[0])}else if(f==="redirect"){this.doRedirect(B[0])}else if(f==="newtab"){this.doNewTab(B[0])}else if(f==="print"||f==="headers"){this.doNewTab(B[0],f)}else{this.doAction(D,B,v)}}}}},sendActionRadar:function(a,b,c){var d=this.get("router");var f=d.model.folder;var g=c.replace(/:/g,"_");var h="on";var i="";var j;if(A.default.isFolderSelected()||a.models&&a.models.length>1){h="mass";j=true}if(A.default.isFolderSelected()){i="-all";if(f&&g==="remove"){if(f.isTrashLike()){g="trash_clear";i=""}else if(f.isSpam()){g="spam_clear";i=""}}}var k=[];if(a.folderTo!==void 0){k.push(["folder-to_".concat(a.folderTo),1])}if(a.folderFrom!==void 0){k.push(["folder-from_".concat(a.folderFrom),1])}if(a.flag!==void 0&&a.state!==void 0){k.push(["".concat(a.flag,"_").concat(a.state),1])}if(a.spam!==void 0){k.push(["spam_".concat(a.spam),1])}var l={};if(a.models.length&&ta.includes(c)){var m=a.models.length;var n=0;var o=0;var p=0;var q=0;var r=0;var s=0;var t=0;var u=false;a.models.forEach(function(a){if(!(a instanceof y.default||a instanceof x.default)){return}if(a.get("flags.is_relevant")){o++}if(a.get("flags.is_relevant")&&a.get("flags.unread")){p++}if(a.get("flags.newsletter")&&a.get("flags.show_definitely_spam")&&a.get("flags.have_unsubscribe_list")){t++}if(a.get("flags.unread")){n++}if(a.get("hide_emoji_in_subject")){q++}if(a.get("hide_emoji_in_snippet")){r++}if(a.get("hide_emoji_in_correspondent")){s++}if((0,e.isActualLettersEnabledInFolder)(d,f,a.get("flags.newsletter"))){u=true}});l.dwh={count:m,unread_priority_count:p,has_unread_priority_letters:p>0,has_letters_from_trusted_mailer:t>0,need_hide_emoji_in_subject:q>0,need_hide_emoji_in_snippet:r>0,need_hide_emoji_in_correspondent:s>0,letters_from_trusted_mailer_count:t,unread_count:n,priority_count:o,has_priority_letters:o>0,folder_id:f.get("id"),show_relevant:+u};var v=a.models[0];if(!j){l.dwh.message_id=a.models[0].get("id");var w=v.get("actual_probability");if(w){l.dwh.ml_model=w.split(":")[0]}var z=v.get("flags.bimi_important_msg")||v.get("flags.bimi_msg");var B=v.get("flags.official")||v.get("flags.official_newsletter");if(z){l.dwh.isReliable=z}if(B){l.dwh.isOfficial=B}var C=d.route.is("#read-letter");l.dwh.read_letter=+C}}(0,N.default)(__assign({chain:[h,"action",g+i],intervals:k.length&&k},l))},doAction:function(b,c,d){var e=this;var g=[];var h=[];var j=[];var k=false;var l=false;for(var m=0;m<c.length;m++){if(c[m].get("flags.metathread")){g.push(c[m])}else{h.push(c[m])}if(c[m].get("flags.show_definitely_spam")){k=true}if(c[m].get("flags.have_unsubscribe_list")){j.push(c[m])}}var n={models:h};var o=this.get("router");var p=b.type;if(b.type==="remove"&&!o.model.folder.isTrashLike()){n.folderTo=f.TRASH_FOLDER_ID}else if(b.type==="spam"){n.spam=true;n.spamConfirm=k;j=f.SHOW_UNSUBSCRIBE_AFTER_SPAM?j:[]}else if(b.type==="spam:force"){b.type="spam";n.spam=true}else if(b.type==="unspam"){b.type="spam";n.spam=false}else if(b.type==="superspam"){b.type="spam";n.spam=true;n.verified=true}else if(b.type.startsWith("mark:")){if(/readed/.test(b.type)){n.flag="unread"}else if(/pinned/.test(b.type)){n.flag="pinned"}else{n.flag="flagged"}n.state=/:(unreaded|flagged)/.test(b.type);n.target=b.target;b.type="mark"}else if(b.type.startsWith("togglestatus:")){n.flag=b.type.split(":").pop();n.state=!h[0].is("flags.".concat(n.flag));b.type="mark"}else if(b.type.startsWith("metathreadtogglestatus:")){n.flag=b.type.split(":").pop();n.state=!g[0].is("flags.".concat(n.flag));var q=g[0].get("metathread_data.folder");var r=w.default.get(q);var s=r&&!r.isSecureOpen();var t=n.flag==="unread"&&n.state===false&&r&&r.get("messages_unread")>pa;if(!s&&!t){g[0].set("flags.".concat(n.flag),n.state)}b.type="mark"}else if(b.type==="move"){n.folderTo=b.folderTo;if(n.folderTo===w.default.SPAM.toString()){n.spamConfirm=k;j=f.SHOW_UNSUBSCRIBE_AFTER_MOVE_TO_SPAM?j:[];l=!!g.length}}else if(b.type==="confirmreceipt"){n.model=c[0]}else if(b.type==="archive"){n.folderTo=b.folderTo}if(A.default.isFolderSelected()&&d){b.type+="All"}n.folderFrom=o.model.folder.id;n.parentThread=b.parentThread;this.sendActionRadar(n,b,p);C.default.reset();A.default.reset();var u=w.default.get(n.folderFrom);var v=w.default.get(String(n.folderTo));var x=[];var y=[];var B=b.type==="moveAll"||b.type==="removeAll";var D=b.type==="removeAll";var E=false;var F=false;if(!f.LAYER_CONFIRM_FOLDER_CLEAR.disable){E=B&&f.LAYER_CONFIRM_FOLDER_CLEAR[u.get("type")]&&(v===null||v===void 0?void 0:v.isTrashLike());F=D&&f.LAYER_CONFIRM_FOLDER_CLEAR[u.get("type")]&&u.isTrashLike()}else{E=B&&u.isInbox()&&v.isTrashLike()}if(h.length){if(E){b.type="moveAll";x.push(u)}if(F){b.type="removeAll";x.push(u)}var G=b.type;if(G==="remove"){var H=b.actionCallback?true:!!g.length;this.pushRemoveActions(y,h,n,{silent:H,actionCallback:b.actionCallback})}else{y.push(function(){e.executeAction(G,n,h,{silent:!l&&!!g.length})})}}if(l){var I=g.map(function(a){return(0,i.getMetathreadName)(a)});(0,N.default)({type:"notify-moveto-spam-metathread-show",dwh:{names:I,letters:h.length,with_action:f.METATHREAD_MOVE_TO_SPAN_NOTIFY===true}});return this._showDisableMoveToSpamNotify(__assign(__assign({},n),{actionType:b.type}),y,j)}if(!b.type.endsWith("All")&&g.length){b.type+="All"}var J=[];for(var K=0,M=g;K<M.length;K++){var O=M[K];var P={};Object.assign(P,n);delete P.models;P.folderFrom=O.get("metathread_data.folder");J.push(P)}if(J.length){if((b.type==="moveAll"||b.type==="removeAll")&&v.isTrashLike()){b.type="moveAll";J.forEach(function(a){x.push(w.default.get(a.folderFrom))})}y.push(function(){J.forEach(function(a,c){return e.executeAction(b.type,a,[],{silent:!!c})})})}if(x.length){L.default.open("confirm-folder-clear",{action:b,models:x},{dimmer:true,compact:true,mobile:z.default.isLessThen("xs")}).then(function(b){b.on("success",function(){y.forEach(function(a){return a()});g.forEach(function(a){a.set("_metathreadExpanded",false)});b.broadcast("layer:close");a.default.send("folder-clear-success")})});return}this._executeWithSpamCheck(__assign(__assign({},n),{actionType:b.type}),y,j)},_executeWithSpamCheck:function(a,b,c){if(a.spamConfirm&&f.SHOW_DEFINITELY_SPAM){this._manageSpamLayer(a,c);return}b.forEach(function(a){return a()})},_manageSpamLayer:function(a,b){if(b===void 0){b=[]}var c=b.length?"unsubscribe":"confirm";(0,N.default)({type:"layer-confirm-move-to-spam_open",dwh:{type:c,action_type:a.actionType}});L.default.open("confirm-move-to-spam",{models:a.models,actionType:a.actionType,unsubscribeModels:b,type:c},{dimmer:true,"dimmer-color":"transparent",compact:true,resolvable:true,mobile:z.default.isLessThen("xs"),"reject-on-close":true}).catch(function(a){if(a){(0,N.default)({type:"confirm-move-to-spam-error",i:{type:c},skipdwh:true})}})},_showDisableMoveToSpamNotify:function(a,b,c){var d=this;if(!f.METATHREAD_MOVE_TO_SPAN_NOTIFY||!b.length){M.default.add({text:this.getNotifyText({name:"moveto.metathread",params:{}}),qa:"notify-moveto-spam-metathread"});return}var e=false;var g=M.default.add({text:this.getNotifyText({name:"moveto.metathread.action",params:{}}),actions:[{text:i18n("Переместить")}],duration:f.METATHREAD_MOVE_TO_SPAN_NOTIFY_DURATION,inline:false,qa:"notify-moveto-spam-metathread-action"});g===null||g===void 0?void 0:g.on("action",function(){e=true;(0,N.default)({type:"notify-moveto-spam-metathread"});g.close()});g===null||g===void 0?void 0:g.on("closed",function(){if(!e){return}d._executeWithSpamCheck(a,b,c)})},pushRemoveActions:function(a,b,c,d){var e=this;var g=[];var h=[];b.forEach(function(a){if(a.getFolder().isTrashLike()){g.push(a)}else{h.push(a)}});if(h.length){a.push(function(){e.executeAction("move",__assign(__assign({},c),{folderTo:f.TRASH_FOLDER_ID,models:h}),h,d)})}if(g.length){a.push(function(){e.executeAction("remove",__assign(__assign({},c),{models:g}),g,d)})}},openSecureFolderIfNeeded:function(a){if(a.folderTo!==void 0){return w.default.findOne(a.folderTo).then(function(a){if(!a.isSecureOpen()){return(0,O.default)(a)}return true}).then(function(a){if(!a){return Promise.reject()}})}return Promise.resolve()},optimisticNavigate:function(a,b,c,d){var e=this;var f=this.get("router");var g=f.request;var h=["mark","markAll"].includes(a);var i=a==="confirmreceipt";var j=this.get("router.model.letter");var k=g.route.is("#search #search-letter");if(!c.length&&!k||!j){return false}var l;if(!c.length&&k){var m=d.some(function(a){return g.params.id===a.id});if(m){l=j}}else{l=c.find(function(a){return a.id===j.id})}if(!l){return false}if(!h&&d&&d.length===1&&!(d[0]instanceof y.default)){var n=l.get("messages").filter(function(a){return a.getFolder()===l.getFolder()});if(n.length>1){b.action=ua.STAY}else{l.destroy()}}if(!g.route.is("#read-letter #search-letter")||h||i){return false}this.doNavigateAction(b).catch(function(a){return e.onActionFail(a)});return true},executeAction:function(a,b,e,f){var g=this;if(f===void 0){f={silent:false}}if(this._isNavigateProcessing){return Promise.resolve()}var h=this.getThreads(e);var i=this.getNavigationPlan(e,h);var j=this.optimisticNavigate(a,i,h,e);return Promise.resolve().then(function(){return g.openSecureFolderIfNeeded(b)}).then(function(){return d.default.dispatch({type:c.EXECUTE_JSSDK_ACTION,action:g.actions[a],uid:ra++,params:b})}).then(function(a){if(a===null||a.jssdkAction.result===null){return}(f===null||f===void 0?void 0:f.actionCallback)&&(f===null||f===void 0?void 0:f.actionCallback(a.jssdkAction));return g.onActionDone(a.jssdkAction,h,f,j)},function(a){var b;(0,N.default)({type:"letter-action-failure",rlog:"letter-action-failure",rlog_message:{logScope:JSON.stringify((b=a===null||a===void 0?void 0:a.options)===null||b===void 0?void 0:b.logScope)}})}).then(function(){I.default.updateOnAction()}).catch(function(a){return g.onActionFail(a)})},onActionDone:function(a,b,e,f){var g=this;var h,i,j;var k=this.get("router");var l=k.request;var m=a.models;var n=a.name==="mail.MarkAs"||a.name==="mail.MarkAsAll"||a.name==="mail.ConfirmReceipt";var o=a.name.endsWith("All");var p=true;if(n&&a.models&&a.models.length<2){p=false}if(a.name==="mail.Delete"||o||a.name==="mail.ConfirmReceipt"){p=false}var q=(h=w.default.all.get(a.params.folderFrom))===null||h===void 0?void 0:h.isShareTake();if(q&&(a.name==="mail.MoveTo"&&(a===null||a===void 0?void 0:a.folderTo.isTrashLike())||a.name==="mail.Archive"||a.name==="mail.Spam")){p=false}var r=true;if(e.silent||m&&m.length<2&&a.name==="mail.MarkAs"){r=false}if(!n){A.default.cleanSelection(a.name==="mail.Delete")}else if(n&&!l.route.is("#search #search-letter")&&l.params.folder!=a.params.folderFrom&&o){A.default.reset()}if(a.name==="mail.Delete"||a.name==="mail.MoveTo"||a.name==="mail.Spam"||a.name==="mail.Archive"){var s=(m||[]).filter(function(a){return a instanceof y.default});var t=(m||[]).filter(function(a){return!(a instanceof y.default)});var u=(i=a.params)===null||i===void 0?void 0:i.parentThread;var v=t.length===1&&s.length===0;var x=u&&((j=u.get("messages"))===null||j===void 0?void 0:j.length)<=1;var z=a.name==="mail.Delete"||a.name==="mail.Spam"&&a.params.spam||a.name==="mail.MoveTo"&&(a.params.folderTo==w.default.TRASH||a.params.folderTo==w.default.CHILD_TRASH);var C=l.route.is("#search #search-letter");if((!v||x||z)&&!C||z&&C){d.default.dispatch({type:c.DESTROY_THREADS_AND_MESSAGES,models:{threads:s,messages:t}})}}if((a.name==="mail.Delete"||a.name==="mail.MoveTo"||a.name==="mail.Archive"||a.name==="mail.Spam")&&l.route.is("#search-letter")){d.default.dispatch({type:c.UPDATE_SEARCH})}var D=this._isAutoMoveVisible(a);if(!f){d.default.updateAll()}var E=Promise.resolve();E.then(function(){if(r){var b={text:g.getNotifyText(a),actions:p?[{text:i18n("Отменить")}]:[],shortcut:p?"ctrl+z|command+z: 'action'":null};if(D){b.actions.unshift({text:i18n("Перемещать автоматически"),event:"createfilter"});b.direction="bottom"}var c=M.default.add(b);if(p&&c){c.on("action",function(b){if(b.details==="createfilter"){B.default.openCreateFilter({models:a.models,move:+a.folderTo.id})}else{c.close();a.undo().then(function(){return g.onActionUndo(a)})}})}}}).then(function(){if(n){var b=a.params,c=b.models,d=b.flag,e=b.state;if(d==="unread"&&e===false){g.hideUnsubscribeSender(c)}}}).catch(function(){return g.onActionFail(a)})},doSearch:function(a,b,c){var d;var e=this.get("router");var f=a.split(":").pop();var g=(d={},d["q_"+f]=b,d);if(c&&c instanceof x.default){var h=c.getFolder();if(h.isShareTake()){var i=h.getServiceSharedParent();if(i===null||i===void 0?void 0:i.get("id")){g["q_folder"]=i.get("id")}}}e.go("#search",{},g)},getLetterUrl:function(a,b){return this.get("router").getUrl("#!septimaReadmsg",{letterId:a.get("expand")||a.get("id"),folderId:a.get("folder"),mod:b})},doNewTab:function(a,b){(0,k.default)(this.getLetterUrl(a,b))},doForward:function(a){var b=this.get("router.route.params.part");var c=a.reduce(function(a,b){return a+b.get("length")||1},0);if(c>oa){M.default.add({type:M.default.types.error,text:i18n("Можно переслать не более {count} писем. Возможно, вы выделили цепочки, поэтому писем слишком много.",{count:oa}),inline:false})}else{var d=a.map(function(a){if(a instanceof y.default){if(b){return a.get("messages")[0].fetch()}else{return a.fetch({offset:0,limit:oa})}}else{return a.fetch()}});Promise.all(d).then(function(a){var b=a.reduce(function(a,b){if(b instanceof y.default){b.get("messages").forEach(function(b){a.push(b)})}else{a.push(b)}return a},[]);var c=function(){var a=b.map(function(a){return{id:a.get("id"),folder:a.get("folder"),name:(a.get("subject")||"Untitled")+".eml",size:a.get("size"),n:[]}});J.default.open({mode:"new",forward:a})};var d=function(){var a=[];var e=!b.some(function(b){var c=b.getFolder();var e=c.isSecureOpen();if(e){if(b.is("flags.secure")){a.push(b)}}else{(0,O.default)(c).then(function(a){if(a){d()}})}return!e});if(e){Promise.all(a.map(function(a){return a.fetch()})).then(c)}};d()})}},doRedirect:function(a){L.default.open("letter-redirect",{model:a},{dimmer:true,compact:true}).then(function(a){a.on("success",function(){a.broadcast("layer:close")})})},doDownload:function(a){location.href=this.getLetterUrl(a,"download")},_isAutoMoveVisible:function(a){var b=a.folderTo;if(!b){return false}if(z.default.isLessThen("xs")){return false}return!f.FORBID_FILTERS&&a.name==="mail.MoveTo"&&(b.isMetathread()||!(b.isSystem()||b.isArchive()))&&!b.isShareTake()},onActionUndo:function(){d.default.updateAll()},onActionFail:function(a){var b=true;var c=false;if(a&&a.error&&a.error.by==="cancel"){b=false}if(a&&a.error&&!a.error.body){c=true}if(a&&b){(0,K.default)("trackJS").then(function(b){return b.addErrorFromApp(a.error,"octavius_lt-actions_err")});M.default.add({type:M.default.types.error,text:i18n("Что-то пошло не так!"),unique:c})}},getThreads:function(a){var b=this.get("router");var c=b.request.route;if(!a.length){return a}if(a[0]instanceof y.default){return a}if(c.is("#search #search-letter")){return[]}var d=this.getCurrentFolder();return a.map(function(a){return y.default.getListByMessageId(a.id).find(function(a){return(0,j.getModelCurrentFolder)(a).id==d})}).filter(function(a){return a})},getCurrentFolder:function(){return this.get("router").route.params.folder},getNavigationPlan:function(a,c){var d=this.getCurrentFolder();var e=this.get("router");var f=e.request.params.message;var g=e.request.route,h=e.model;var i=h.letter;var j=b.default.get("initialUser.messages.after_delete");if(j===qa&&g.is("#read-letter")){return{action:ua.GO_TO_FOLDER,folder:d}}if(j===qa&&g.is("#search-letter")){return{action:ua.GO_TO_SEARCH}}if(!a.length){return{action:ua.GO_TO_FOLDER,folder:d}}if(a.length===1&&!(a[0]instanceof y.default)&&!c[0]&&!g.is("#search #search-letter")){return{action:ua.GO_TO_FOLDER,folder:d}}if(c.length>1){return{action:ua.GO_TO_FOLDER,folder:d}}var k;if(i&&H.default.has()){var l=e.model.letters;var m=l.indexOf(i);while(l[m]&&m<l.length){m++;if(l[m]&&H.default.isLetterInFilter(l[m])){k=l[m].id;break}}}else if(i&&!f){var n=this.get("router.model.letterNeighbours");k=n&&n.next&&(n.next.id||n.next.threadId)}if(!k){if(g.is("#search-letter")){return{action:ua.GO_TO_SEARCH}}return{action:ua.GO_TO_FOLDER,folder:d}}return{action:ua.GO_TO_NEXT}},doNavigateAction:function(a){var b=this;this._isNavigateProcessing=true;var c=this.get("router");var d=Promise.resolve();switch(a.action){case ua.STAY:break;case ua.GO_TO_NEXT:d=D.default.goToLetter("next");break;case ua.GO_TO_SEARCH:d=c.go("#search",{},"inherit");break;case ua.GO_TO_FOLDER:{d=c.go("#letters",{folder:a.folder,preserveFilters:true});break}}return d.then(function(){b._isNavigateProcessing=false}).catch(function(a){b._isNavigateProcessing=false;return Promise.reject(a)})},getNotifyText:function(a){var b=a.name.replace("mail.","").toLowerCase();var c=a.params;var d=w.default.get(c.folderTo);var e=d&&d.get("name")||"";var f=b;if(b.endsWith("all")){f=f.replace("all","")}switch(f){case"markas":f+=".".concat(c.flag,".").concat(c.state);break;case"spam":f+=".".concat(c.spam);e=a.params.models.length;break}var g=va[f];return g&&g(e)},hideUnsubscribeSender:function(a){var b,e;if(!Array.isArray(a)){return}var f=this.get("router.model.unsubscribeList");var g=f===null||f===void 0?void 0:f.actualSenders;if(!g){return}var i=f.hidden;var j=[];var k=function(a){var c=(e=(b=(0,h.getCorrespondentsFromMessage)(a,"from"))===null||b===void 0?void 0:b[0])===null||e===void 0?void 0:e.email;var d=!!c&&!!g.find(function(a){return a.sender===c});if(d&&!(i===null||i===void 0?void 0:i.includes(c))){j.push(c)}};for(var l=0,m=a;l<m.length;l++){var n=m[l];k(n)}if(!j.length){return}d.default.dispatch({type:c.HIDE_UNSUBSCRIBE_SENDER,senders:j})}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/letters-loader",["require","exports","data-source/actions","data-source/index","data-source/utils/paginator","default-values","feast","mail/Folder","mediator/letters-loader/vars","pilotjs","router","service/getModule","service/mailbox/loader","service/notify","service/radars/index","ui-block/dataset-letters/dataset-letters","ui-block/letter-list/letter-list","ui-block/list-letter-spinner/list-letter-spinner","ui-block/nav-folders/nav-folders","ui-block/scrollable/scrollable"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);e=__importDefault(e);f=__importDefault(f);h=__importDefault(h);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);var s=1e3;var t=function(e){__extends(t,e);function t(){var a=e.call(this)||this;a._needUpdate={};a._lastThrottledKey=null;a._throttlingTimerId=null;a._isLoading=false;f.default.all.on("change",function(b,c){if(b.changes.includes("messages_total")&&c!==(0,i.getAppRouter)().model.folder){a._needUpdate[c.id]=true}});return a}t.prototype.getComponentsSpec=function(){return{router:{class:h.default},scrollable:{class:r.default,events:[g.LettersLoaderEvents.onBottom]},"letters-list":{class:o.default,events:[g.LettersLoaderEvents.onBottom,g.LettersLoaderEvents.loadMore]},"dataset-letters":{class:n.default},"nav-folders":{class:q.default,events:["folderclickstart","folderhover"]},"list-letter-spinner":{class:p.default,attrs:{hidden:function(a){return!a._isLoading}}}}};t.prototype.handleEvent=function(a){var b=a.type,c=a.details;var d;switch(b){case g.LettersLoaderEvents.onBottom:this.loadLetters();break;case g.LettersLoaderEvents.loadMore:this.loadLetters(c);break;case"folderhover":d=c;if(d&&this._needUpdate[d.id]){k.default.emit("any:reload");delete this._needUpdate[d.id]}break}};t.prototype.getThrottleKey=function(a){var b=this.get("router");if(!b||!b.url){return":"+a}return b.url.href+":"+a};t.prototype.setupThrottling=function(a){var b=this;this._lastThrottledKey=a;this._throttlingTimerId=window.setTimeout(function(){b._throttlingTimerId=null},s)};t.prototype.clearThrottling=function(){window.clearTimeout(this._throttlingTimerId);this._throttlingTimerId=null};t.prototype.loadLettersThrottled=function(c){var d=this;if(this._isLoading){return}var e=this.getThrottleKey(c);if(this._throttlingTimerId){if(this._lastThrottledKey!==e){this.clearThrottling()}else{return}}this.setupThrottling(e);this._isLoading=true;this.updateAll();return b.default.dispatch({type:a.LOAD_MORE,priority:h.default.Loader.PRIORITY_LOW}).then(function(a){if(a&&a.uiLetters.length!==c){(0,m.default)(["on_next_page_letters",c]);var b=d.get("router");var e=b.model["folder"].id;(0,m.default)({chain:["letters_next_load",e],dwh:{offset:c}})}d._isLoading=false}).catch(function(a){d._isLoading=false;if(a&&!a.body){(0,j.default)("trackJS").then(function(b){return b.addErrorFromApp(a,"octavius_smth_wrong")});l.default.error({unique:true})}}).then(function(){d.updateAll()})};t.prototype.loadLetters=function(a){var b=this.get("router");var e=b.route;var f=b&&b.model&&b.model.uiLetters;var g=f&&f.length;if(a&&a.startIndex<d.LIST_LIMIT){return}if(!(0,c.isPaginatorGlobalEnabled)(b)||e&&(e.is("#search")||e.is("#search-letter"))){this.loadLettersThrottled(g)}};return t}(e.default.Mediator);exports.default=e.default.Mediator.createFromClass("letters-loader",t)});define("mediator/letters-navigation",["exports","feast","pilotjs","ui-block/letter-list/letter-list","ui-block/portal-menu-element/portal-menu-element"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Mediator.create("letters-navigation",{components:{router:{class:f.default},"portal-menu-element":{class:h.default,events:["folders-toggle"]},"letter-list":{class:g.default,attrs:{transparent:function a(b){return b.isDatasetTransparent}}}},defaults:function a(){this.isDatasetTransparent=false},handleEvent:function a(b){var c=b.type,d=b.details;switch(c){case"folderstoggle":{this.isDatasetTransparent=d.state;this.updateAll();break}}}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/letters-shortcut",["require","exports","data-source/actions","data-source/data-source","feast","helpers/dom-utils","lazy.modules","mediator/layout-manager","pilotjs","service/smokescreen","ui-block/dataset-letters/dataset-letters"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);f=__importDefault(f);g=__importDefault(g);i=__importDefault(i);var j=function(c){__extends(j,c);function j(){var a=c.call(this)||this;a.onKeydown=a.onKeydown.bind(a);return a}j.prototype.getComponentsSpec=function(){return{router:{class:g.default,events:["routeend"],handleEvent:"onRouteEnd"},"dataset-letters":{class:i.default,events:["$mount"],handleEvent:"onLettersMount"},dataSource:{class:b.default,events:["actionend"],handleEvent:"onDataSourceActionEnd"}}};j.prototype.onRouteEnd=function(){this.toggleKeydownHandler(false)};j.prototype.onDataSourceActionEnd=function(b){var c=b.details;var d=this.get("router.route");if(c.action.type!==a.NAVIGATE){return false}var e=d.is("#letters #search");var f=d.is("#read-letter #search-letter");if(e||f){this.dataset=this.get("dataset-letters");if(f){this.letterId=d.params.letter}if(this.getDatasetParentElement()){this.onLettersMount()}}};j.prototype.onLettersMount=function(){var a=this;this.dataset=this.get("dataset-letters");this.toggleKeydownHandler(true);setTimeout(function(){a.focusPrevActiveDatasetElement();delete a.letterId},200)};j.prototype.onKeydown=function(a,b){var c=b.shortcut;if(this.validateActiveElement()){if(c==="up"||c==="down"){a.preventDefault();if(c==="up"){this.focusPrevDatasetElement()}else{this.focusNextDatasetElement()}}if(c==="enter"||this.is3Pane()){this.clickActiveDatasetElement()}}};j.prototype.is3Pane=function(){return f.default.getType()==="3pane"};j.prototype.getActiveElement=function(){return document.activeElement};j.prototype.getDatasetElement=function(){var a,b,c,d;return(b=(a=this.dataset)===null||a===void 0?void 0:a.el)!==null&&b!==void 0?b:(d=(c=this.dataset)===null||c===void 0?void 0:c.getEl)===null||d===void 0?void 0:d.call(c)};j.prototype.getDatasetParentElement=function(){var a=this.getDatasetElement();if(a){return a.parentElement}};j.prototype.getFirstDatasetElement=function(){var a=this.getDatasetElement();if(a){return a.querySelector((0,h.selector)(".js-letter-list-item"))}};j.prototype.getDatasetElementById=function(a){var b=this.getDatasetElement();if(b){return b.querySelector((0,h.selector)('.js-letter-list-item[data-id="'.concat(a,'"]')))}};j.prototype.getSelectedDatasetElement=function(){var a=this.getDatasetElement();if(a){return a.querySelector((0,h.selector)(".js-letter-list-item[active]"))}};j.prototype.getActiveDatasetElement=function(){var a=this.getActiveElement();if(a){return a.closest((0,h.selector)(".js-letter-list-item"))}};j.prototype.getSelectedOrActiveDatasetElement=function(){var a=this.getSelectedDatasetElement();return a||this.getActiveDatasetElement()};j.prototype.getActualDatasetElement=function(a){var b=this.getSelectedOrActiveDatasetElement();return b||this.getDatasetElementById(a)};j.prototype.getPrevDatasetElement=function(){var a=this.getSelectedOrActiveDatasetElement();if(a){var b=(0,d.parentsUntil)(a,(0,h.selector)(".dataset__items"));if(b[0]){var c=b[0].previousElementSibling;while(c){var e=c.querySelector((0,h.selector)(".js-letter-list-item"));if(e){return e}c=c.previousElementSibling}}return(0,d.getPreviousSibling)(a,(0,h.selector)(".js-letter-list-item"))}return this.getFirstDatasetElement()};j.prototype.getNextDatasetElement=function(){var a=this.getSelectedOrActiveDatasetElement();if(a){var b=(0,d.parentsUntil)(a,(0,h.selector)(".dataset__items"));if(b[0]){var c=b[0].nextElementSibling;while(c){var e=c.querySelector((0,h.selector)(".js-letter-list-item"));if(e){return e}c=c.nextElementSibling}}return(0,d.getNextSibling)(a,(0,h.selector)(".js-letter-list-item"))}return this.getFirstDatasetElement()};j.prototype.validateActiveElement=function(){var a=this.getActiveElement();var b=this.getActiveDatasetElement();var c=a.closest((0,h.selector)(".nav-folders"));return a===document.body||b||c};j.prototype.focusPrevActiveDatasetElement=function(){var a=this.getActualDatasetElement(this.letterId);if(a){a.focus()}};j.prototype.focusPrevDatasetElement=function(){if(this.blurActiveElementTimer){return}this._activeElement=this.getPrevDatasetElement();this.fixActiveDatasetElement()};j.prototype.focusNextDatasetElement=function(){if(this.blurActiveElementTimer){return}this._activeElement=this.getNextDatasetElement();this.fixActiveDatasetElement()};j.prototype.fixActiveDatasetElement=function(){var a=this;if(this._activeElement){this._activeElement.focus();this.blurActiveElementTimer=window.setTimeout(function(){a.blurActiveElementTimer=undefined;if(a._activeElement){a._activeElement.focus()}},40)}};j.prototype.clickActiveDatasetElement=function(){var a;(a=this.getActiveDatasetElement())===null||a===void 0?void 0:a.click()};j.prototype.toggleKeydownHandler=function(a){var b=this;var c="left,up,right,down,enter";(0,e.lazyMailKeymaster)().then((0,e.uniqCallback)(this,function(d){if(a){d(c,b.onKeydown)}else{d.unbind(c,b.onKeydown)}}))};return j}(c.Mediator);exports.default=c.Mediator.createFromClass("letters-shortcut",j)});define("mediator/metathreads-manager",["exports","@mail/flags","@mail/xray","data-source/actions","data-source/index","data-source/source/ui-threads-settings","default-values","feast","helpers/data-source-dispatch","helpers/opener","mail/User","pilotjs","service/layer","service/promo","service/radars/index","ui-block/metathread/metathread"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var p=B(a);var q=B(b);var r=B(d);var s=B(g);var t=B(h);var u=B(i);var v=B(j);var w=B(k);var x=B(l);var y=B(m);var z=B(n);var A=B(o);function B(a){return a&&a.__esModule?a:{default:a}}exports.default=s.default.Mediator.create("metathreads-manager",{defaults:function a(){var b=this;r.default.one("actionend",function(){if(!f.FORCE_METATHREADS_LETTER&&!f.FORCE_METATHREADS&&!f.FORCE_METATHREADS_EXP){return}var a=p.default.get("ignore-metathreads-experiment");if(a&&a.state){return}var d=b.get("router.model.uiThreadsSettings")||e.defaults;var g=d.metathreads;if(g){a.save({state:true});return}if(f.FORCE_METATHREADS_EXP){a.save({state:true});return}if(f.FORCE_METATHREADS_LETTER){var h=p.default.get("pre-metathread-letter");h.save({state:true});a.save({state:true});(0,z.default)("force_metathreads_letter");return}(0,t.default)({type:c.TOGGLE_METATHREADS_SETTING});a.save({state:true});(0,z.default)("force_metathreads")});r.default.one("actionend",function(){if(!f.METATHREADS_FORCED_EXP){return}var a=p.default.get("metathreads-forced-exp");if(a&&a.state){return}var d=b.get("router.model.uiThreadsSettings")||e.defaults;var g=d.metathreads;if(g){return}var h=false;var i=d.metathreadsSettings;Object.keys(i).forEach(function(a){if(i[a]!==v.default.METATHREADS_STATES.OFF){h=true}});if(h){return}var j=f.METATHREADS_FORCED_EXP.split("|")[0];(0,t.default)({type:c.TOGGLE_METATHREADS_SETTINGS,state:true}).then(function(){a.save({state:true,time:true});y.default.update()}).catch(function(){return(0,z.default)("metathreads-exp-error")});(0,z.default)({type:"metathreads-forced-exp",dwh:{group:j}})})},components:{router:{class:w.default},metathread:{class:A.default,events:["click:cleanmaster","click:metathread-link","click:disable"]}},handleEvent:function a(b){switch(b.type){case"click:cleanmaster":this.onCleanmasterClick(b);break;case"click:metathreadlink":this.onMetathreadLinkClick(b);break;case"click:disable":var c=b.details;this.onMetathreadDisable(c);break;default:break}},onMetathreadLinkClick:function a(b){var c=b.details;var d=this.get("router");var e=c.getMetathreadFolder();d.go("#letters",{folder:e});q.default.send("go_to_folder",{i:{id:e},dwh:{id:e,name:c.getMetathreadFolderName()}})},onCleanmasterClick:function a(){(0,u.default)(f.CLEANMASTER_URL)},onMetathreadDisable:function a(b){var d=function a(){if(b.isToMyself()){r.default.dispatch({type:c.TOGGLE_TO_MYSELF_METATHREAD,state:false});(0,z.default)({type:"tomyself-disable",intervals:[["mt-ctx-menu",1]]})}};if(f.LAYER_METATHREAD_DISABLE){x.default.open("disable-metathread",{model:b},{dimmer:true,resolvable:true,"close-on-dimmer":true,"reject-on-dimmer":true,"close-on-esc":false,"reject-on-close":true}).then(function(){d()}).catch(function(a){if(a){throw a}})}else{d()}}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/mobile-sidebar-manager",["require","exports","feast","ui-block/mobile-sidebar/mobile-sidebar","ui-block/webview-mobile-header/webview-mobile-header"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MobileSidebarManager=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=function(a){__extends(d,a);function d(){return a!==null&&a.apply(this,arguments)||this}d.prototype.getComponentsSpec=function(){return{"mobile-sidebar":{class:b.default,events:["mobilesidebar:close"],attrs:{open:function(a){return a._isSidebarOpen}}},"webview-mobile-header":{class:c.default,events:["mobilesidebar:open"]},"webview-mobile-footer":{events:["mobilesidebar:open"]},"sidebar-unsubscribe-button":{events:["mobilesidebar:close"]}}};d.prototype.handleEvent=function(a){switch(a.type){case"mobilesidebar:open":{this._isSidebarOpen=true;break}case"mobilesidebar:close":{this._isSidebarOpen=false;break}}};return d}(a.default.Mediator);exports.MobileSidebarManager=d;exports.default=a.default.Mediator.createFromClass("mobile-sidebar-manager",d)});define("mediator/orders-manager",["exports","feast","helpers/opener","service/radars/index","ui-block/list-letter-order/list-letter-order"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}var j={clickLink:"clicklink"};exports.default=e.default.Mediator.create("orders-manager",{components:{"list-letter-order":{class:h.default,events:["clicklink"]}},handleEvent:function a(b){var c=b.type,d=b.details,e=d===undefined?{}:d;if(c===j.clickLink&&e.url){var h=e.url;(0,f.default)(h);(0,g.default)("list_letter_order_click")}}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/paginator-manager/paginator-manager",["require","exports","feast","../../data-source/actions","../../data-source/data-source","../../data-source/utils/letter-list-virtualization","../../data-source/utils/paginator","../../default-values","../../helpers/data-source-dispatch","../../ui-block/dataset-letters/dataset-letters"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PaginatorManager=void 0;a=__importDefault(a);c=__importDefault(c);h=__importDefault(h);var i=function(a){__extends(i,a);function i(){var b=a.call(this)||this;b._isLoading=false;b.getPaginatorPage=b.getPaginatorPage.bind(b);return b}i.prototype.getComponentsSpec=function(){return{"data-source":{class:c.default},"dataset-letters":{class:h.default,attrs:{"paginator-page-getter":function(a){return a.getPaginatorPage}},events:["save-current-page-height","update-on-scroll"]}}};i.prototype.handleEvent=function(a){switch(a.type){case"savecurrentpageheight":this.saveCurrentPageHeight(a.details&&a.details["saveOnlyIfExact"]);return false;case"updateonscroll":this.updatePaginatorPage(a.details&&a.details["scrollTop"]);return false}};i.prototype.getPaginatorPage=function(a,b){if(a===void 0){a=undefined}if(b===void 0){b=false}var c=this.getDatasetLetters();var d=!!a;var e=d?a.models:this.getDatasetLetters().getModels();var g=c.getCurrentPageOverride();if(g!==undefined){return g}if(b&&c.isScrolledToBottom()){return Math.max(Math.ceil(c.getStatus().lettersTotal/f.LIST_LIMIT),1)}var h=c.getScrollTop();var i;var j;var k;for(var l=0;l<e.length;l++){j=d?e[l].model:e[l];k=j.meta("_ui-index");i=c.getBlockMeasuresByModelId(j.id);if(k!==undefined&&i.offset>h){return Math.floor(k/f.LIST_LIMIT)+1}}return 1};i.prototype.saveCurrentPageHeight=function(a){var b,c;if(a===void 0){a=false}var g=this.getDatasetLetters().getStatus();var h=g&&g.page;var i=this.getDatasetLetters().getModels();var j=(0,d.getGenericItemHeight)(this.getDatasetLetters().is3Pane(),this.getDatasetLetters().isPonyMode());var k=h*f.LIST_LIMIT-1;var l;var m;var n;var o;for(var p=i.length-1;p>=0;p--){l=i[p];m=l.meta("_ui-index");n=this.getDatasetLetters().getBlockMeasuresByModelId(l.id);if(n&&m===k){o=n.offset-n.height;(0,e.memoizePageHeight)(h,o,true);this.getDatasetLetters().setPaginatorDebugState((b={},b["page-height_".concat(h)]="=".concat(o),b));return}}if(a){return}for(var p=i.length-1;p>=0;p--){l=i[p];m=l.meta("_ui-index");n=this.getDatasetLetters().getBlockMeasuresByModelId(l.id);if(n&&m!==undefined&&m!==null){o=n.offset+(k-m)*j-j;(0,e.memoizePageHeight)(h,o);this.getDatasetLetters().setPaginatorDebugState((c={},c["page-height_".concat(h)]="~".concat(o),c));return}}};i.prototype.updatePaginatorPage=function(a){var c=this.getDatasetLetters().getRouter();var d=this.getDatasetLetters().getStatus();var e=c.request!==c.activeRequest;this.getDatasetLetters().setPaginatorDebugState({"scrollTop > lastPageOffset":false,"targetPage < currentPage":false,"status.isLastPage":d.isLastPage,isNavigating:e});if(this.getDatasetLetters().getCurrentPageOverride()!==undefined||e){return}var h=this.findFirstVisibleModelUIIndex(a),i=h.model,j=h.index;if(i===undefined){return}var k=d.page;var l=Math.floor(j/f.LIST_LIMIT)+1;this.getDatasetLetters().highlightElementForDebug(i);this.getDatasetLetters().setPaginatorDebugState({firstModelUIIndex:j});if(l!==k){this.saveCurrentPageHeight(true);this.runThrottled(function(){return(0,g.dispatchAndWait)({type:b.LOAD_PAGE,page:l})})}};i.prototype.findFirstVisibleModelUIIndex=function(a){var b=this.getDatasetLetters().getLastCalculatedRange();var c;var d;var e;var f;var g;for(var h=0;h<b.models.length;h++){c=b.models[h].model;d=this.getDatasetLetters().getBlockMeasuresByModelId(c.id);if(d&&d.offset>=a){f=c.meta("_ui-index");e=c.isInMetathread&&c.isInMetathread()&&c.getContainingMetathread();g=e?e.meta("_ui-index"):undefined;if(g!==undefined){return{model:c,index:g}}else if(f!==undefined&&f!==null){return{model:c,index:f}}}}return{}};i.prototype.getDatasetLetters=function(){return this.get("dataset-letters")};i.prototype.runThrottled=function(a){var b=this;if(this._isLoading){this._updateAfterLoaded=a;return}this._isLoading=true;return a().then(function(){b._isLoading=false;if(b._updateAfterLoaded){b.updatePaginatorPage(b.getDatasetLetters().getScrollTop())}}).catch(function(a){b._isLoading=false;if(b._updateAfterLoaded){b.updatePaginatorPage(b.getDatasetLetters().getScrollTop())}throw a})};return i}(a.default.Mediator);exports.PaginatorManager=i;exports.default=a.default.Mediator.createFromClass("paginator-manager",i)});define("mediator/pony-mode",["exports","data-source/actions","data-source/data-source","data-source/source/ui-layout","default-values","feast","helpers/data-source-dispatch","mediator/layout-manager","pilotjs","service/promo","service/radars/index","ui-block/application-mail/application-mail","ui-block/filters/filters","ui-block/letter-list/letter-list","ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview","ui-block/list-nested-moveto-folder/list-nested-moveto-folder","ui-block/nav-folders/nav-folders","ui-block/octopus/octopus","ui-block/portal-menu/portal-menu","ui-block/settings/settings","ui-block/settings-dock/settings-dock","ui-block/settings-help-link/settings-help-link","ui-block/sidebar-folders/sidebar-folders","ui-block/sidebar-search/sidebar-search","ui-block/thread/thread","../lazy.modules"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var z=U(b);var A=U(e);var B=U(f);var C=U(g);var D=U(h);var E=U(i);var F=U(j);var G=U(k);var H=U(l);var I=U(m);var J=U(n);var K=U(o);var L=U(p);var M=U(q);var N=U(r);var O=U(s);var P=U(t);var Q=U(u);var R=U(v);var S=U(w);var T=U(x);function U(a){return a&&a.__esModule?a:{default:a}}exports.default=A.default.Mediator.create("pony-mode",{defaults:function a(){this.toggleRootClass()},components:{router:{class:D.default},"application-mail":{class:G.default,attrs:{ponymode:function a(b){return b.isActive()}}},"letter-list":{class:I.default,attrs:{ponymode:function a(b){return b.isActive()}}},"settings-dock":{class:P.default,attrs:{"can-toggle-ponymode":function a(){return!d.TOUCH_MODE},ponymode:function a(b){return b.isActive()}},events:["ponymode:toggle"]},settings:{class:O.default,attrs:{"can-toggle-ponymode":function a(){return!d.TOUCH_MODE},ponymode:function a(b){return b.isActive()}},events:["ponymode:toggle"]},"settings-help-link":{class:Q.default,attrs:{"can-toggle-ponymode":function a(){return!d.TOUCH_MODE},ponymode:function a(b){return b.isActive()}},events:["ponymode:toggle"]},"sidebar-search":{class:S.default,attrs:{ponymode:function a(b){return b.isActive()}}},"sidebar-folders":{class:R.default,attrs:{ponymode:function a(b){return b.isActive()}}},thread:{class:T.default,attrs:{ponymode:function a(b){return b.isActive()}}},"nav-folders":{class:L.default,attrs:{ponymode:function a(b){return b.isActive()}}},"list-nested-moveto-folder":{class:K.default,attrs:{ponymode:function a(b){return b.isActive()}}},"portal-menu":{class:N.default,attrs:{ponyMode:function a(b){return b.isActive()}}},"search-panel":{class:N.default,attrs:{ponyMode:function a(b){return b.isActive()}}},filters:{class:H.default,attrs:{"can-toggle-ponymode":function a(){return!d.TOUCH_MODE},ponymode:function a(b){return b.isActive()}},events:["ponymode:toggle"]},"compose-windows":{lazy:y.lazyUIComposeWindows,attrs:{ponymode:function a(b){return b.isActive()}}},"list-letter-attach-status-active":{class:J.default,attrs:{ponymode:function a(b){return b.isActive()}}},dataSource:{class:z.default,events:["actionend"],handleEvent:"onDataSourceActionEnd"},"layer-cleanmaster-modal":{lazy:y.lazyUILayerCleanmasterModal,attrs:{ponymode:function a(b){return b.isActive()}}},octopus:{class:M.default,attrs:{ponymode:function a(b){return b.isActive()}}},usePonyMode:{attrs:{ponyMode:function a(b){return b.isActive()}}}},handleEvent:function a(b){switch(b.type){case"ponymode:toggle":this.togglePonyMode(b.details);return false}},togglePonyMode:function b(c){var d=c&&c.from;var e=!this.get("router.model.uiLayout").ponyMode;(0,F.default)({type:"toggle-ponymode-"+(e?"on":"off"),intervals:[[""+d,1]]});(0,B.default)({type:a.TOGGLE_PONY_MODE})},onDataSourceActionEnd:function b(c){var d=c.details;if(d.action.type===a.TOGGLE_PONY_MODE){this.toggleRootClass();C.default.handleMedia();E.default.update();return true}return false},toggleRootClass:function a(){if(this.isActive()){document.body.classList.add("g-pony-mode")}else{document.body.classList.remove("g-pony-mode")}},isActive:function a(){var b=this.get("router.model.uiLayout")||c.defaults;return b.ponyMode}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/progress-bar-manager",["require","exports","data-source/actions","data-source/data-source","default-values","Emitter","feast","pilotjs","request","ui-block/paginator/paginator","ui-block/progress/progress"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);var j=c.APPROX_REQUEST_UPLOAD;var k=c.APPROX_REQUEST_DOWNLOAD;var l=c.PROGRESS_FAKE_LOAD_FACTOR;var m={LOAD_START:c.PROGRESS_FACTOR_LOAD_START,UPLOAD:c.PROGRESS_FACTOR_UPLOAD,DOWNLOAD:c.PROGRESS_FACTOR_DOWNLOAD};var n=function(a){__extends(b,a);function b(){var b=a.call(this)||this;b.progress_=0;return b}Object.defineProperty(b.prototype,"progress",{get:function(){return this.progress_},set:function(a){a=Math.round(a);if(a>100){a=100}if(a>=this.progress_){this.progress_=a;this.emit("progress")}},enumerable:false,configurable:true});b.prototype.dispose=function(){var a=this;var b=d.default.getListeners(this,"progress");b.forEach(function(b){return a.off("progress",b)})};return b}(d.default);var o=function(a){__extends(b,a);function b(b,c,d){var e=b.options;var f=a.call(this)||this;f.loadedBytes_=0;f.approxRequestSize_=d;f.fakeUpdateProgress_=f.fakeUpdateProgress_.bind(f);e[c]=function(a){var b=a.lengthComputable&&a.total?a.total:d;f.updateProgress_(b,a.loaded);if(f.progress>=100*l){f.stopFaking()}};return f}b.prototype.updateProgress_=function(a,b){var c=(b-this.loadedBytes_)/a*100;this.loadedBytes_=b;this.progress+=c};b.prototype.fakeUpdateProgress_=function(){if(this.progress<100*l){this.updateProgress_(this.approxRequestSize_,this.progress+.05*this.approxRequestSize_)}else{this.stopFaking()}};b.prototype.startFaking=function(){var a=this;this.fakeProgressPid_=window.setTimeout(function(){if(a.isFaking()){a.fakeProgressPid_=window.setInterval(a.fakeUpdateProgress_,200)}},600)};b.prototype.stopFaking=function(){window.clearInterval(this.fakeProgressPid_);window.clearTimeout(this.fakeProgressPid_);delete this.fakeProgressPid_};b.prototype.isFaking=function(){return!!this.fakeProgressPid_};return b}(n);var p=function(a){__extends(b,a);function b(b){var c=a.call(this)||this;var d=new o(b,"onUploadProgress",j);var e=new o(b,"onDownloadProgress",k);var f=100*m.LOAD_START;var g=f+100*m.UPLOAD;c.progress=f;d.startFaking();d.on("progress",function(){if(d.progress===100&&!e.isFaking()){e.startFaking()}c.progress=f+d.progress});e.on("progress",function(){c.progress=g+e.progress});b.on("end",function(){c.progress=100});return c}return b}(n);var q=function(a){__extends(b,a);function b(){var b=a.call(this)||this;b.activeCount_=0;return b}b.prototype.addXHR=function(a){var b=this;this.activeCount_++;var c=new p(a);var d=0;c.on("progress",function(){var a=c.progress-d;d=c.progress;b.progress+=a*(1/b.activeCount_)})};return b}(n);var r;g.default.on("start",function(a,b){if(r){r.addXHR(b)}});exports.default=e.default.Mediator.create("progress-bar-manager",{components:{dataSource:{class:b.default,events:["beforeaction","actionend"]},router:{class:f.default,events:["beforeroute"]},progress:{class:i.default,attrs:{value:function(a){return a.progress_},visible:function(a){return a.visible_},inanimate:function(a){return a.inanimate_}}},paginator:{class:h.default,attrs:{disabled:function(a){return a.visible_}}}},defaults:function(){this.progress_=0;this.progressMemoized_=0;this.visible_=false;this.inanimate_=false},clearProgressAndShowDebounced_:function(){var a=this;this.progress_=0;this.progressMemoized_=0;this.visible_=false;this.inanimate_=true;this.updateAll();if(this.progressDebouncePid_){window.clearTimeout(this.progressDebouncePid_)}this.progressDebouncePid_=window.setTimeout(function(){a.inanimate_=false;a.visible_=true;a.progress_=a.progressMemoized_;a.updateAll();delete a.progressDebouncePid_},200)},setProgress_:function(a){if(this.progressDebouncePid_){this.progressMemoized_=a;return}this.progress_=a;this.inanimate_=false;this.updateAll()},completeProgressAndHide_:function(){var a=this;this.progress_=100;if(this.progressDebouncePid_){window.clearTimeout(this.progressDebouncePid_)}this.progressDebouncePid_=window.setTimeout(function(){a.visible_=false;a.updateAll();delete a.progressDebouncePid_},100);this.updateAll()},handleEvent:function(b){var c=this;switch(b.type){case"beforeroute":case"beforeaction":{if(b.details.action&&b.details.action.type!==a.NAVIGATE&&b.details.action.type!==a.LOAD_PAGE){return false}if(b.details.initiator==="initial"){return false}this.clearProgressAndShowDebounced_();if(r){r.dispose()}r=new q;r.on("progress",function(){c.setProgress_(r.progress)});break}case"actionend":{if(b.details.action.type!==a.NAVIGATE&&b.details.action.type!==a.LOAD_PAGE&&b.details.action.type!==a.LOAD_MORE){return false}this.completeProgressAndHide_();if(r){r.dispose();r=undefined}break}}return false}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/routes-manager",["require","exports","feast","pilotjs","ui-block/renovator/renovator","../lazy.modules"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.RoutesManager=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var e=function(a){__extends(e,a);function e(){return a!==null&&a.apply(this,arguments)||this}e.prototype.getComponentsSpec=function(){return{router:{class:b.default,events:["route"],handleEvent:"handleRoute"},renovator:{class:c.default,attrs:{isLettersRoute:function(a){return a.is("#letters #search")}}},"themes-widget-ok":{lazy:d.lazyUIThemesWidgetOK},"themes-widget-vk":{lazy:d.lazyUIThemesWidgetVK}}};e.prototype.is=function(a){var b=this.get("router");return b.route.is(a)};e.prototype.handleRoute=function(){var a=this.get("themes-widget-ok");var b=this.get("themes-widget-vk");if(b){b.updateData()}if(a){a.updateData()}};return e}(a.default.Mediator);exports.RoutesManager=e;exports.default=a.default.Mediator.createFromClass("routes-manager",e)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/scrollable-manager",["require","exports","data-source/actions","data-source/data-source","data-source/utils","data-source/utils/paginator","default-values","feast","helpers/data-source-dispatch","helpers/fast-deep-equal","logger","pilotjs","route/utils/filter-query","service/adv/index","ui-block/list-letter-attach-status-preview/list-letter-attach-status-preview","ui-block/list-letter-preview-attaches-more/list-letter-preview-attaches-more","ui-block/scrollable/scrollable"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ScrollableManager=void 0;b=__importDefault(b);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);function p(a){return a}var q=i.default.getScope("scrollable-manager");var r=function(f){__extends(i,f);function i(){var a=f!==null&&f.apply(this,arguments)||this;a._lastFilterQuery=k.default.get();return a}i.prototype.defaults=function(){this._store={}};i.prototype.getComponentsSpec=function(){return{router:{class:j.default,events:["routeend","beforeroute"]},dataSource:{class:b.default,events:["actionend"]},scrollable:{class:o.default,events:["scroll:change"]}}};i.prototype.getKeyForRequest=function(a){var b=a.route,d=a.router;if(b&&b.is&&b.is("#search #search-letter")){var f=(0,c.getStore)();var g=f&&f.search;if(g){var h=JSON.stringify(g.query);return{main:"".concat(b.id,":").concat(h),fallback:"#search:".concat(h)}}}var i=a.path;if(e.ENABLE_BACK_TO_LETTERS_SHORTCUT_3PANE&&b&&b.is&&b.is("#read-letter")){var j=a.params.folder;i=d.getUrl("#letters",{folder:j})}var k="".concat(a.host,":").concat(i);if(!k.endsWith("/")){k+="/"}return{main:k,fallback:k}};i.prototype.handleEvent=function(b){var c=this;var f=b.type,i=b.details;var j=this.get("router");this._lastAdvUpdatePos=this._lastAdvUpdatePos||0;if(f==="scroll:change"){m.default.resetAttachmentDropdown();n.default.resetAttachmentDropdown();if(Math.abs(this._lastAdvUpdatePos-i)>screen.height*2){this._lastAdvUpdatePos=i;l.default.updateOnAction()}return false}if(!j.route){return}switch(f){case"beforeroute":{var o=this.getKeyForRequest(j.request).main;this._lastRouteFolder=j.request.params.folder;this._lastRouteQuery=JSON.stringify(j.request.query);this._lastRouteId=j.request.route.id;var r=this.getList("scrollable");if(e.ENABLE_BACK_TO_LETTERS_SHORTCUT_3PANE&&r.length<=0){return false}this._store[o]=r.reduce(function(a,b){var c=p(b);var d=c.getScrollPos(),e=d.x,f=d.y;a[c.get("name")]={left:e,top:f};return a},{});return false}case"routeend":{this._lastRouteInitiator=i&&i.initiator;return false}case"actionend":{if(!(i.action.type===a.NAVIGATE||i.action.type===a.TOGGLE_PAGINATOR||i.action.type===a.UPDATE_LAYOUT_TYPE||i.action.type===a.UPDATE_LAYOUT_SUPPORT_3_PANE)){return false}var s=this.getKeyForRequest(i.request),t=s.main,u=s.fallback;var v=this._store[t]||this._store[u];var r=this.getList("scrollable");r.forEach(function(b){var f=p(b);var l=f.get("name");var m=j.route.is("#read-letter")&&l==="dataset-letters"||j.route.is("#search-letter")&&l==="dataset-letters";var n=c._lastRouteFolder;var o=c._lastRouteQuery;var r=i.request.params.folder;var s=JSON.stringify(i.request.query);var u=!m||!j.route.is("#search #search-letter")&&n!=r;if(j.route.is("#letters")&&(l==="dataset-letters"||k.default.has())&&n==r){u=false}if(j.route.is("#search #search-letter")&&o===s){u=false}var w=(0,d.isPaginatorGlobalEnabled)(j);if(c._lastPaginator===undefined){c._lastPaginator=w}var x=c._lastPaginator;var y=c._lastFilterQuery;c._lastPaginator=w;c._lastFilterQuery=k.default.get();if(x!==w||!(0,h.default)(y,k.default.get())){q.add("filters changed, reset");delete c._store[t];v=void 0;u=true}else if(i.action.type!==a.NAVIGATE){q.add("not navigate");return}if(!e.ENABLE_BACK_TO_LETTERS_SHORTCUT_3PANE&&j.route.is("#read-letter")&&c._lastRouteId==="#read-letter"){delete c._store[t];v=void 0}if(!v){if((0,d.isPaginatorGlobalEnabled)(j)){(0,g.default)({type:a.LOAD_PAGE,page:1,uid:undefined})}q.add("on new route",{shouldReset:u});u&&f.reset();return}var z=v[l];if(z&&c._lastRouteInitiator==="popstate"){f.scrollTo(z.left,z.top);f.wasPopstate=true}else{if((0,d.isPaginatorGlobalEnabled)(j)){(0,g.default)({type:a.LOAD_PAGE,page:1,uid:undefined})}q.add("on old route",{shouldReset:u});u&&f.reset()}})}}};return i}(f.default.Mediator);exports.ScrollableManager=r;exports.default=f.default.Mediator.createFromClass("scrollable-manager",r)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/share-folders-manager/share-folders-manager",["require","exports","data-source/actions","data-source/data-source","data-source/index","default-values","feast","pilotjs","service/auth","service/share-folders","ui-block/contextmenu-folder/contextmenu-folder","../../lazy.modules","./events"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ShareFoldersManager=void 0;b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);var l=false;var m=Object.values(k.ShareEvents);var n=function(e){__extends(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}n.prototype.getComponentsSpec=function(){return{router:{class:f.default},dataSource:{class:b.default,events:[k.ACTION_END_DATA_SOURCE_EVENT]},letter:{lazy:j.lazyUILetter,events:m},"context-menu":{class:i.default,events:m}}};n.prototype.handleEvent=function(b){var e=b.type,g=b.details;if(!d.FOLDERS_SHARE_ENABLED){return}switch(e){case k.ACTION_END_DATA_SOURCE_EVENT:{if(g.action.type!==a.NAVIGATE||l){return false}var i=this.getShareActionParamsFromUrl(g.request);if(i){h.default.renderAccess(i);l=true}break}case k.ShareEvents.letterActionClick:{var j=b.originalEvent,m=b.details;j.preventDefault();j.stopImmediatePropagation();var n=j.currentTarget.getAttribute(m.attrName);var o=new f.default.URL(n);var p=this.getShareActionParamsFromUrl(o);if(p){h.default.renderAccess(p)}break}case k.ShareEvents.openShare:{var q=b.details.model;h.default.renderShare({model:q,allFolders:c.default.getData().folders});break}case k.ShareEvents.openShareOpportunities:{h.default.renderShareOpportunities({});break}case k.ShareEvents.denySharedFolder:{var q=b.details.model;h.default.renderDenySharedFolder({model:q});break}}};n.prototype.getShareActionParamsFromUrl=function(a){var b=a===null||a===void 0?void 0:a.query["share-folders"];if(!b){return null}if(b==="confirm"||b==="reject"){var c=a.query,d=c.grant,e=c.salt,f=c.sign,h=c.csrf,i=c.folders,j=c.timestamp,k=c.owner;var l=i.split(",").map(Number);var m=Number(j);return{mode:b,grant:d,salt:e,sign:f,csrf:h,folderIds:l,timestamp:m,ownerEmail:k}}if(b==="resend"){var n=a.query,o=n.glasha,i=n.folders,d=n.grant;var l=i.split(",").map(Number);var p=g.default.user;return{mode:b,grant:d,folderIds:l,email:o,user:p}}return null};return n}(e.default.Mediator);exports.ShareFoldersManager=n;exports.default=e.default.Mediator.createFromClass("share-folders-manager",n)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/sidebar-menu",["require","exports","@mail/flags","data-source/actions","default-values","feast","helpers/data-source-dispatch","pilotjs","ui-block/sidebar-widgets/sidebar-widgets","ui-block/sidebar-widgets/sidebar-widgets.constants"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SidebarMenu=void 0;a=__importDefault(a);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);var i=function(d){__extends(i,d);function i(){return d!==null&&d.apply(this,arguments)||this}i.prototype.getComponentsSpec=function(){return{"sidebar-widgets":{class:g.default,events:[h.SideBarMenuEvents.deactivateNotifyBadge],attrs:{"is-pay-widget-helper-active":function(a){return a.getIsPayWidgetHelperActive()||a.getIsPayWidgetSmartHelperActive()}}},router:{class:f.default}}};i.prototype.getBillsCount=function(){return this.get("router.model.billsCount")};i.prototype.handleEvent=function(d){var f=d.type;switch(f){case h.SideBarMenuEvents.deactivateNotifyBadge:if(c.SIDEBAR_PAY_NOTIFICATION_BADGE){a.default.get("octavius-sidebar-pay-notification-badge").save({state:true})}if(!c.SIDEBAR_PAY_NOTIFICATION_BADGE_SMART){break}var g=this.get("sidebar-widgets");var i=this.getBillsCount();if(!i){break}a.default.get("octavius-sidebar-pay-notification-badge-smart").save({state:true});i.hasNewPayments=false;g.set("billsCount",i);(0,e.default)({type:b.HIDE_SIDEBAR_FOOTER_PAY_NOTIFY_BADGE,state:i,uid:undefined});break}};i.prototype.getIsPayWidgetHelperActive=function(){var b=a.default.get("octavius-sidebar-pay-notification-badge");return b&&!b.isActive()&&c.SIDEBAR_PAY_NOTIFICATION_BADGE};i.prototype.getIsPayWidgetSmartHelperActive=function(){var b=a.default.get("octavius-sidebar-pay-notification-badge-smart");var d=this.getBillsCount();if(!d||!c.SIDEBAR_PAY_NOTIFICATION_BADGE_SMART){return false}var e=d.hasNewPayments;var f=d.hasPaidPaymentsWithNoNew;var g=d.total;var h=!b.isActive()&&g&&!f;return h||e};return i}(d.default.Mediator);exports.SidebarMenu=i;exports.default=d.default.Mediator.createFromClass("sidebar-menu",i)});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/themes-manager",["require","exports","@mail/flags","default-values","feast","service/themes","service/themes.setup","ui-block/category-feedback/category-feedback","ui-block/dataset-letters/dataset-letters","ui-block/discounts-item/discounts-item","ui-block/letter-meta/letter-meta","ui-block/noads-button/noads-button","ui-block/octopus/octopus","ui-block/panel-with-selected/panel-with-selected","ui-block/portal-menu-logo/portal-menu-logo","ui-block/react-2kit-async/react-2kit-async","ui-block/react-async/react-async","ui-block/search-panel/search-panel","ui-block/settings/settings","ui-block/settings-dock/settings-dock","ui-block/sidebar/sidebar","ui-block/sidebar-folders/sidebar-folders","ui-block/thread/thread","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);var w=function(){return e.default.getSelectedModel().isDarkMode()};var x={darkMode:w};var y={"dark-mode":w};exports.default=c.default.Mediator.create("themes-manager",{components:{"themes-manager":{class:d.default,events:["themes:apply","themes:reload"],handleEvent:"onLoadTheme"},"layer-create-folder":{lazy:v.lazyUILayerCreateFolder,attrs:y},"layer-edit-settings-filter":{lazy:v.lazyUILayerEditSettingsFilter,attrs:y},octopus:{class:k.default,attrs:{isDarkDefaultMode:function(){return e.default.getSelectedModel().isDarkDefaultMode()},isLightDefaultMode:function(){return e.default.getSelectedModel().isLightDefaultMode()},isLoadedTheme:function(){return e.default.getSelectedModel().id!==undefined},isLightColorTheme:function(){return b.LIGHT_COLOR_THEMES.includes(e.default.getSelectedModel().id)}}},"react-async":{class:o.default,attrs:x},"vk-messenger-provider":{attrs:x},"react-2kit-async":{class:n.default,attrs:x},"compose-app":{lazy:v.lazyUIComposeApp,attrs:x},ToDoIframe:{attrs:x},CalendarIframe:{attrs:x},MarusiaIframe:{attrs:x},"new-features-dropdown":{attrs:x},"settings-dock":{class:r.default,attrs:Object.assign({theme:function(){return e.default.getSelectedModel()}},x),events:["theme:select"],handleEvent:"onThemeSelect"},"dataset-letters":{class:g.default,attrs:x},settings:{class:q.default,events:["themes:panel"],handleEvent:"onPanelOpen"},sidebar:{class:s.default,attrs:{"widget-enabled":function(a){return a.isThemeSupportWidget()}}},"sidebar-folders":{class:t.default,attrs:{"widget-enabled":function(a){return a.isThemeSupportWidget()}}},"noads-button":{class:j.default,attrs:{isDefaultTheme:function(a){return a.getThemeId()===b.DEFAULT_THEME_ID}}},"themes-widget":{lazy:v.lazyUIThemesWidget,attrs:{id:function(a){return a.getThemeId()},data:function(a){return a.getThemeData()},widgetData:function(a){return a.getThemeWidgetData()}}},thread:{class:u.default,attrs:__assign(__assign({},y),{isDarkDefaultMode:function(){return e.default.getSelectedModel().isDarkDefaultMode()},isLightDefaultMode:function(){return e.default.getSelectedModel().isLightDefaultMode()}})},"panel-with-selected":{class:l.default,attrs:y},"letter-meta":{class:i.default,attrs:y},"search-panel":{class:p.default,attrs:x},"category-feedback":{class:f.default,attrs:y},"drag-and-drop":{attrs:y},"layer-metathreads-settings":{lazy:v.lazyUILayerMetathreadsSettings,attrs:y},"portal-menu-logo":{class:m.default,attrs:{theme:function(){return e.default.getSelectedModel().id}}},discounts:{class:h.default,attrs:y}},getThemeId:function(){return e.default.getSelectedModel().id},getThemeData:function(){return e.default.getSelectedModel().widget.data},getThemeWidgetData:function(){return e.default.getSelectedModel().widgetData},isThemeSupportWidget:function(){return e.default.getSelectedModel().isSupportWidget()&&!this.hideWidget()},hideWidget:function(){var c=this.getThemeId();if(c==="t2052"&&!b.THEMES_WIDGET_CLOUDY_ENABLED){return true}if(!b.WIDGETS_WITH_SHOW_LIMIT_THEME_IDS.includes(c)){return false}if(c==="t5002"&&Math.floor((new Date("2020-01-06").getTime()-Date.now()).valueOf()/1e3)<0){return true}if(c==="t5003"||c==="t1169"||c==="t5004"){var d=a.default.get("t5003-widget");return b.WIDGETS_SHOW_LIMIT_MAP.t5003<(d&&d.getCount("show"))||d&&d.state}var e=a.default.get("".concat(c,"-widget"));return b.WIDGETS_SHOW_LIMIT_MAP[c]<(e&&e.getCount("show"))||e&&e.state},markWidgetAsShowed:function(){if(!e.default.getSelectedModel().isSupportWidget()){return}var c=this.getThemeId();if(c==="t5003"||c==="t1169"||c==="t5004"){var d=a.default.get("t5003-widget");return d&&d.save({hit:true})}if(b.WIDGETS_WITH_SHOW_LIMIT_THEME_IDS.includes(c)){var d=a.default.get("".concat(c,"-widget"));return d&&d.save({hit:true})}},onLoadTheme:function(a){var b,c;var d=Array.from(document.body.classList).filter(function(a){return a.startsWith("theme-")});var e=["theme-".concat(a.id)];var f="g-dark-mode";if(a.isDarkMode()){e.push(f)}else{d.push(f)}(b=document.body.classList).remove.apply(b,d);(c=document.body.classList).add.apply(c,e);this.markWidgetAsShowed()},onThemeSelect:function(a){var b;var c=(b=a===null||a===void 0?void 0:a.details)===null||b===void 0?void 0:b.model;if(c){e.default.setTheme(c,true)}}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/translator-manager",["require","exports","@mail/flags","@mail/xray","cfgUser","default-values","feast","mail/Message","mail/Thread","pilotjs","service/notify","service/radars/index","ui-block/dropdown-actions/dropdown-actions","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TranslatorManager=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);var m=function(e){__extends(m,e);function m(){return e!==null&&e.apply(this,arguments)||this}m.prototype.defaults=function(){};m.prototype.getComponentsSpec=function(){return{router:{class:h.default},letter:{lazy:l.lazyUILetter,events:["translator:show","translator:close","translator:hide","letter:translate","letter:original"]},"dropdown-actions":{class:k.default,events:["translator:show"]}}};m.prototype.handleEvent=function(a){var b=false;var c=this.getModel(a);if(!c){return b}var d=a.details.block||this.findLetterById(c.id);if(!d){return b}var e={model:c,block:d,options:a.details.options};switch(a.type){case"letter:translate":this.onLetterTranslate(e);break;case"letter:original":this.onLetterOriginal(e);break;case"translator:show":this.onTranslatorShow(e);break;case"translator:close":this.onTranslatorClose(e);break;case"translator:hide":this.onTranslatorHide(e);break}return b};m.prototype.onTranslatorShow=function(e){var f;var g=e.block,h=e.model;var i=h.get("flags.in_english");var j=c.default.get("LANG");var k="";var l="";if(j!=="en_US"&&i){k="ru";l="en"}else{k="en";l="ru"}var m=!g.is("is-translator-visible");g.set({"is-translator-visible":true,"translator-default-from":l,"translator-default-to":k});(f=a.default.get("translator-hide"))===null||f===void 0?void 0:f.save({state:false,time:true});var n=h.get("id");g.broadcast("translator:scrollto");b.default.send("letter_translator_show",{dwh:{letterId:n,automated_show:false,in_english:!!i}});if(m&&!d.DISABLE_AUTOMATED_TRANSLATE){b.default.send("letter_automated_translate",{dwh:{letterId:n}});this.onLetterTranslate({block:g,model:h,options:{fromlang:l,tolang:k}})}};m.prototype.onTranslatorClose=function(a){var b=a.block;b.set({"is-translator-visible":false,"is-translator-forced-shown":true})};m.prototype.onTranslatorHide=function(b){var c;this.onTranslatorClose(b);(c=a.default.get("translator-hide"))===null||c===void 0?void 0:c.save({state:true,time:true})};m.prototype.onLetterTranslate=function(a){var b=a.block,c=a.model,d=a.options;var e=d.tolang,f=d.fromlang;if(b.is("is-translator-loading")){return}b.set("is-translator-loading",true);return c.translate({tolang:e,fromlang:f}).then(function(){b.set({"is-translator-error":false,"is-translator-loading":false,"is-letter-translated":true});(0,j.default)({chain:["trans","ok","from",f,"to",e]})}).catch(function(a){b.set({"is-translator-loading":false,"is-translator-error":true});i.default.error({text:i18n("Не удалось перевести текст")});(0,j.default)({chain:["trans","err","from",f,"to",e]});console.error(a)})};m.prototype.onLetterOriginal=function(a){var b=a.block;b.set({"is-letter-translated":false})};m.prototype.getModel=function(a){var b=a.details.model;var c=this.get("router.model.letter");var d=b||c;if(d&&d instanceof g.default&&d.get("messages.length")){if(this.get("router.route").is("#search-letter")){d=f.default.get(this.get("router.model.route.params.id"))}else{d=d.getExpandMessage()}}return d};m.prototype.findLetterById=function(a){return this.components.letter.find(function(b){return b.isLetterIdEq(a)})};return m}(e.default.Mediator);exports.TranslatorManager=m;exports.default=e.default.Mediator.createFromClass("translator-manager",m)});define("helpers/subscribe-notify",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getUnsubscribesText=void 0;function a(a){if(typeof a==="number"&&a>0){var b={count:a};return i18n.plural(a,[i18n("Вы успешно отписались от {count} рассыльщиков",b),i18n("Вы успешно отписались от {count} рассыльщика",b),i18n("Вы успешно отписались от {count} рассыльщиков",b)])}return i18n("Вы успешно отписались")}exports.getUnsubscribesText=a});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/unsubscribe-actions",["require","exports","data-source/actions","data-source/data-source","data-source/index","default-values","feast","feast-mod/correspondents","helpers/data-source-dispatch","helpers/subscribe-notify","logger","mail/actions/CleanmasterUnreadManage","mail/Folder","pilotjs","RPC","service/notify","service/radars/index","ui-block/dataset-letters/dataset-letters","ui-block/dropdown-actions/dropdown-actions","ui-block/list-letter-common/list-letter-common","ui-block/list-letter-compact/list-letter-compact","ui-block/list-letter-unsubscribe/list-letter-unsubscribe","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.UnsubscribeActions=void 0;b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);g=__importDefault(g);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);var v=["unsubscribe","moveallfrom","markallfrom"];var w={markallfrom:function(){return i18n("Помечено прочитанным")},unsubscribe:function(a){return(0,h.getUnsubscribesText)(a)},moveallfrom:function(){return i18n("Перемещено в папку «Корзина»")},fail:function(){return i18n("Что-то пошло не так")},"unsubscribe:from:ll":function(a){var b={sender:a.name||a.email};return i18n("Вы отписались от писем «{sender}»",b)}};var x=function(e){__extends(h,e);function h(){var a=e!==null&&e.apply(this,arguments)||this;a.actionsFinished=false;a.shouldAbort={};return a}h.prototype.getComponentsSpec=function(){return{router:{class:l.default},unsubscribe:{lazy:u.lazyUIUnsubscribe,events:v,attrs:{"actions-finished":function(a){return a.hasActionsFinished()}}},"dropdown-actions":{class:q.default,events:v},"list-letter-unsubscribe":{class:t.default,events:["unsubscribe:from:ll","unsubscribe:update"],attrs:{unsubscribeList:function(a){var b;return(b=a.get("router.model.unsubscribeList"))===null||b===void 0?void 0:b.actualSenders}}},"list-letter-common":{class:r.default,events:["unsubscribe:from:ll","unsubscribe:update","letter:intersect:viewport","letter:hide:unsubscribe:sender"],attrs:{unsubscribeList:function(a){var b;return(b=a.get("router.model.unsubscribeList"))===null||b===void 0?void 0:b.actualSenders}}},"list-letter-compact":{class:s.default,events:["unsubscribe:from:ll","unsubscribe:update","letter:intersect:viewport","letter:hide:unsubscribe:sender"],attrs:{unsubscribeList:function(a){var b;return(b=a.get("router.model.unsubscribeList"))===null||b===void 0?void 0:b.actualSenders}}},"dataset-letters":{class:p.default,events:["unsubscribe:from:ll","unsubscribe:update","letter:hide:unsubscribe:sender"],attrs:{unsubscribeList:function(a){var b;return(b=a.get("router.model.unsubscribeList"))===null||b===void 0?void 0:b.actualSenders}}},"data-source":{class:b.default,events:["actionend"]},"layer-confirm-move-to-spam":{events:["unsubscribe"]}}};h.prototype.handleEvent=function(a){var b=a.type,c=a.details,d=c===void 0?{}:c;this.actionsFinished=false;switch(b){case"unsubscribe":{this.doUnsubscribe({type:b,params:d},{silent:d.silent});break}case"markallfrom":{var e=Array.isArray(d.from)?d.from:[d.from];var f={from:e,action:"unset",marks:["unread"],only_newsletters:true};this.doMarkAllFrom({type:b,params:f});break}case"moveallfrom":{var e=Array.isArray(d.from)?d.from:[d.from];var f={folder:k.default.TRASH,from:e,only_newsletters:true};this.doMoveAllFrom({type:b,params:f});break}case"unsubscribe:from:ll":{this.doUnsubscribeFromLL({type:b,sender:d.sender});break}case"actionend":{this.handleActionEnd(d.action);break}case"letter:intersect:viewport":{var g=d.uid,h=d.sender;this.handleIntersectViewport({uid:g,sender:h});break}}};h.prototype.doUnsubscribe=function(a,b){var c=this;var d=a.type,e=a.params;var f=e.ids,g=e.position;if(!f){return false}return m.default.get("messages/services/unsubscribe",{ids:f}).then(function(){return c.onActionDone(d,__assign(__assign({},b),{position:g}))}).catch(function(){return c.onActionFail(d)})};h.prototype.doMoveAllFrom=function(a){var b=this;var c=a.type,d=a.params;var e=d.folder,f=d.from;if(!d||!e||!f){return false}if(!this.isSenderFromValid(f)){return false}return m.default.get("messages/move/all",d).then(function(){return b.onActionDone(c)}).catch(function(){return b.onActionFail(c)})};h.prototype.doMarkAllFrom=function(a){var b=this;var c=a.type,d=a.params;var e=d.action,f=d.marks,g=d.from;if(!d||!e||!f||!g){return false}if(!this.isSenderFromValid(g)){return false}if(e!=="set"&&e!=="unset"){return false}return m.default.get("messages/marks/all",d).then(function(){return b.onActionDone(c)}).catch(function(){return b.onActionFail(c)})};h.prototype.onActionDone=function(a,b){var d=this;if(b===void 0){b={silent:true}}var e=a==="moveallfrom"?this.backToFolder():c.default.updateAll();var f=b.position;e.then(function(){var c={text:d.getNotifyText(a)};if(!(b===null||b===void 0?void 0:b.silent)){n.default.add(c)}d.actionsFinished=true;d.updateAll();i.default.add("unsubscribe action ok",a);(0,o.default)({type:"".concat(a,"_action-success"),dwh:{position:f}})}).catch(function(){return d.onActionFail(a)})};h.prototype.onActionFail=function(a){this.actionsFinished=true;this.updateAll();i.default.add("unsubscribe action failed",a);(0,o.default)("".concat(a,"_action-error"));n.default.add({type:n.default.types.error,text:this.getNotifyText("fail")})};h.prototype.isSenderFromValid=function(a){return a.every(function(a){return/@/.test(a)})};h.prototype.getNotifyText=function(a,b){return w[a](b)};h.prototype.hasActionsFinished=function(){return this.actionsFinished};h.prototype.backToFolder=function(){var a,b;var c=this.get("router");var d=(b=(a=c.route)===null||a===void 0?void 0:a.params)===null||b===void 0?void 0:b.folder;return c.go("#letters",{folder:d,preserveFilters:true})};h.prototype.doUnsubscribeCleanMaster=function(a){return j.default.execute({method:j.default.Methods.Unsubscribe,emails:[a]}).then(function(){return(0,o.default)({type:"unsub_clnmstr",dwh:{sender:a}})})};h.prototype.findLetterBySender=function(a,b){return a.filter(function(a){var c,d;var e=a.get("model");var g=(d=(c=(0,f.getCorrespondentsFromMessage)(e,"from"))===null||c===void 0?void 0:c[0])===null||d===void 0?void 0:d.email;if(!b){return false}return b.includes(g)})};h.prototype.updateUnsubscribeList=function(a){var b=this.components["list-letter-common"];var c=this.components["list-letter-compact"];var d=this.findLetterBySender(__spreadArray(__spreadArray([],b,true),c,true),a);d.forEach(function(a){return a.broadcast("unsubscribe:update")})};h.prototype.handleActionEnd=function(b){var c=b.type,d=b.sender;if(c===a.DELETE_SENDER_FROM_UNSUBSCRIBE_LIST||c===a.HIDE_UNSUBSCRIBE_SENDER){this.updateUnsubscribeList([d])}};h.prototype.deleteSenderFromUnsubscribeList=function(b){var c=this;(0,g.default)({type:a.DELETE_SENDER_FROM_UNSUBSCRIBE_LIST,senders:b,uid:undefined}).then(function(){c.updateUnsubscribeList(b)})};h.prototype.doUnsubscribeFromLL=function(a){var b=this;var c=a.type,e=a.sender;var f=e.email;var g=n.default.add({text:this.getNotifyText(c,e),actions:[{text:i18n("Отменить")}],duration:d.LL_UNSUBSCRIBE_NEWSLETTERS_TIMEOUT,qa:"notify-ll-unsubscribe"});if(!g){return}g.on("action",function(){b.shouldAbort[f]=true;(0,o.default)({type:"unsub_clnmstr_cancel_clk",dwh:{sender:f}});g.close()});g.on("closed",function(){if(!b.shouldAbort[f]){b.doUnsubscribeCleanMaster(f).then(function(){b.deleteSenderFromUnsubscribeList([f])}).catch(function(a){var b=a.error;n.default.error({unique:true});(0,o.default)({chain:["unsub_clnmstr_err",b.status,b.message],dwh:{sender:f}})})}else{b.shouldAbort[f]=false}})};h.prototype.handleIntersectViewport=function(b){var c=b.uid,d=b.sender;(0,g.default)({type:a.COUNT_UNSUBSCRIBE_VIEW,uid:c,sender:d.email,priority:l.default.Loader.PRIORITY_LOW})};return h}(e.default.Mediator);exports.UnsubscribeActions=x;exports.default=e.default.Mediator.createFromClass("unsubscribe-actions",x)});define("mediator/user-info",["exports","../lazy.modules","feast","service/auth","ui-block/list-letter-welcome/list-letter-welcome","ui-block/portal-menu/portal-menu","ui-block/sidebar-folders/sidebar-folders"],function(exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var g=l(b);var h=l(c);var i=l(d);var j=l(e);var k=l(f);function l(a){return a&&a.__esModule?a:{default:a}}exports.default=g.default.Mediator.create("user-info",{defaults:function a(){},components:{letter:{lazy:a.lazyUILetter,attrs:{"current-user":function a(b){return b.getUser()}}},"sidebar-folders":{class:k.default,attrs:{"is-pdd-user":function a(b){return b.getUser().isPDD()}}},"portal-menu":{class:j.default,attrs:{"current-user":function a(b){return b.getUser()}}},"list-letter-welcome":{class:i.default,attrs:{"current-user":function a(b){return b.getUser()}}}},getUser:function a(){return h.default.user}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("boot/mediators",["require","exports","feast","mediator/addressbook-manager","mediator/advert-manager","mediator/attachments-manager","mediator/compose-manager","mediator/contact-selection","mediator/features","mediator/filter-manager","mediator/flags","mediator/folders-actions","mediator/folders-navigation","mediator/layout-manager","mediator/letter-attaches-preview","mediator/letter-list-adv-optimizer","mediator/letters-actions","mediator/letters-loader","mediator/letters-navigation","mediator/letters-selection","mediator/letters-shortcut","mediator/metathreads-manager","mediator/mobile-sidebar-manager","mediator/orders-manager","mediator/paginator-manager/paginator-manager","mediator/pony-mode","mediator/progress-bar-manager","mediator/routes-manager","mediator/scrollable-manager","mediator/search-manager","mediator/settings-filters-manager","mediator/settings-manager","mediator/share-folders-manager/share-folders-manager","mediator/sidebar-menu","mediator/swipe-manager","mediator/themes-manager","mediator/thread-manager","mediator/thread-scroller","mediator/translator-manager","mediator/unsubscribe-actions","mediator/user-info","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.initAllMedaitors=exports.eachMediators=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);I=__importDefault(I);J=__importDefault(J);K=__importDefault(K);L=__importDefault(L);M=__importDefault(M);var O=function(){};var P=[e.default,D.default,d.default,f.default,b.default,E.default,j.default,k.default,h.default,g.default,i.default,l.default,o.default,q.default,p.default,r.default,s.default,t.default,v.default,x.default,z.default,A.default,n.default,B.default,C.default,G.default,H.default,I.default,J.default,K.default,L.default,M.default,y.default,F.default,w.default,c.default,m.default,u.default,N.lazyMediatorCalendarManager,N.lazyMediatorCallsManager,N.lazyMediatorPageTitle,N.lazyMediatorTodoManager,N.lazyMediatorWelcomeBlockManager,N.lazyMediatorMarusiaManager];var Q=function(a){if(a===void 0){a=O}return P.map(function(b,c){if(typeof b==="function"){return b().then(function(b){if(b.default&&b.default.register){b=b.default}P[c]=b;a(b);return b})}a(b);return b})};exports.eachMediators=Q;var R=false;var S=null;var T=[];var U={};var V=function(a){if(a===void 0){a=O}if(R){a(U,P);return}T.push(a);if(S===null){S=Promise.all((0,exports.eachMediators)()).then(function(){R=false;P.forEach(function(a){U[a.name]=a});T.forEach(exports.initAllMedaitors);T.length=0})}};exports.initAllMedaitors=V;a.default.Mediator.lazyRegister=function(a,b){(0,exports.eachMediators)(function(c){if(c.name===a&&b.isMounted()){c.register(b)}})}});define("helpers/viewport",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.toggleViewport=a;function a(a){var b=document.querySelector("meta[name=viewport]");if(!b){b=document.createElement("meta");b.name="viewport";document.head.appendChild(b)}b.setAttribute("content",a)}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("boot/pre-init",["require","exports","@mail/features","css-supports","helpers/browser","helpers/viewport","mail/Message","../default-values","../helpers/lazy","../mediator/layout-manager","../service/adv/mimic","../service/radars/index","./mediators"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.preInit=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);h=__importDefault(h);i=__importDefault(i);exports.preInit=(0,g.lazyInit)(function(){if(f.PREINIT_ALL_MEDIATORS){(0,k.initAllMedaitors)()}b.default.shim();if(f.IS_TABLET&&!(f.WEBVIEW&&f.WEBVIEW_MOBILE_MODE_ENABLED)&&!f.OCTAVIUS_MOBILE){(0,d.toggleViewport)("")}j.radarService.init(h.default);i.default.setLayoutManager(h.default);if(a.default.has("blockquote")||a.default.has("blockquote-threads")){e.default.QUOTES_VERSION=f.QUOTES_VERSION}document.body.classList.add("default-font");if(c.default.mac){document.body.classList.add("macintosh-font")}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("boot/promo",["require","exports","data-source/actions","../service/promo","../service/themes.setup"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.initPromo=void 0;b=__importDefault(b);c=__importDefault(c);var d=function(d){c.default.themes.on("themes:apply",function(a){b.default.applyTheme(a)});d.on("actionend",function(c){var d=c.details;var e=d.action;if([a.NAVIGATE,a.TOGGLE_METATHREAD,a.TOGGLE_DISCOUNTS,a.UPDATE_ALL].includes(e.type)){b.default.update()}})};exports.initPromo=d});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("boot/release-detect",["require","exports","default-values","../helpers/lazy","../helpers/object-to-query","../lazy.modules"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.initReleaseDetect=void 0;c=__importDefault(c);var e=function(e){var f=e.cfg,g=e.RPC,h=e.app,i=e.xray;(0,d.lazyMailReleaseDetect)().then(function(d){var e=d.appendQuery,j=d.buildComparator,k=d.createReleaseDetectClient,l=d.hashComparator;k({xraySend:function(){var a=[];for(var b=0;b<arguments.length;b++){a[b]=arguments[b]}return i.send.apply(i,a)},router:h,location:e("x-email",g.setup("email")),sources:[{name:"build",endpoint:function(){return"/srv-st.json?_=".concat(Math.random())},comparator:j,reloadTimeRange:a.RELOAD_TIMEOUT,initialData:{build:f.get("build")},ondata:(0,b.createAppBundlePreloader)({filter:a.PRELOAD_RELEASE_BUNDLES_FILTER,staticHost:f.get("staticHost"),jsMap:{paths:f.get("bundles-paths")}})},a.OK_RELOAD&&{name:"hashes",endpoint:function(){return"/api/v1/utils/sota/hash?"+(0,c.default)({token:g.setup("token"),email:g.setup("email"),_:String(Math.random())},true)},comparator:l,reloadTimeRange:a.OK_RELOAD_TIMEOUT,shadow:a.OK_RELOAD_SHADOW,initialData:{ff_hash:f.get("hashes.ff"),ok_hash:f.get("hashes.ok")}}].filter(Boolean)})})};exports.initReleaseDetect=e});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("boot/router/listener",["require","exports","@mail/features","@mail/xray"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.initRouterDocumentListener=void 0;a=__importDefault(a);b=__importDefault(b);function c(c,d){var e=d.smokeScreenService,f=d.logger;var g=a.default.getAsArray("octavius-filter-url-regexp",["addressbook\\/.*"],":").map(function(a){try{return new RegExp(a)}catch(a){b.default.send("p_jserror&i=JS_regexp")}return undefined}).filter(function(a){return a!==undefined});c.listenFrom(document,{autoStart:true,logger:f,filter:function(a){if(c.isDead){return false}if(c.route.is("#attachment #attachment-editor")){return false}for(var b=0;b<g.length;b++){if(g[b].test(a)){return false}}if(/#mailruanchor/.test(a)){return false}return e.isValidURL(a)}})}exports.initRouterDocumentListener=c});define("boot/router/user-timings",["require","exports","@mail-core/dashboard"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.initUserTimingsRouter=void 0;var b=function(b){var c=b.app;var d={"#letters":"list","#read-letter":"thread"};c.on("beforeroute",function(b,c){var e=d[b.target.activeRoute.id];var f=d[c.route.id];if(!!f&&e===d["#read-letter"]){if(f===d["#letters"]){a.userKeeper.time("letter-open")}else if(f===d["#read-letter"]){a.userKeeper.time("letter-update")}}})};exports.initUserTimingsRouter=b});!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define("@vkontakte/vk-bridge",["exports"],b):b((a=a||self).vkBridge={})}(this,function(a){"use strict";var b=function(){return(b=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function c(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;var d=Array(a),e=0;for(b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}function d(a,c){var d,e,f=(d={current:0,next:function(){return++this.current}},e={},{add:function(a,b){var c=null!=b?b:d.next();return e[c]=a,c},resolve:function(a,b,c){var d=e[a];d&&(c(b)?d.resolve(b):d.reject(b),e[a]=null)}});return c(function(a){if(a.detail&&a.detail.data&&"object"==typeof a.detail.data&&"request_id"in a.detail.data){var b=a.detail.data,c=b.request_id,d=function(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.indexOf(d)<0&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(d=Object.getOwnPropertySymbols(a);e<d.length;e++)b.indexOf(d[e])<0&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]])}return c}(b,["request_id"]);c&&f.resolve(c,d,function(a){return!("error_type"in a)})}}),function(c,d){return void 0===d&&(d={}),new Promise(function(e,g){var h=f.add({resolve:e,reject:g},d.request_id);a(c,b(b({},d),{request_id:h}))})}}var e="undefined"!=typeof window,f=Boolean(e&&window.AndroidBridge),g=Boolean(e&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.VKWebAppClose),h=Boolean(e&&window.ReactNativeWebView&&"function"==typeof window.ReactNativeWebView.postMessage),i=e&&!f&&!g,j=i&&/(^\?|&)vk_platform=mobile_web(&|$)/.test(location.search),k=i?"message":"VKWebAppEvent",l=c(["VKWebAppInit","VKWebAppGetCommunityAuthToken","VKWebAppAddToCommunity","VKWebAppAddToHomeScreenInfo","VKWebAppClose","VKWebAppCopyText","VKWebAppCreateHash","VKWebAppGetUserInfo","VKWebAppSetLocation","VKWebAppSendToClient","VKWebAppGetClientVersion","VKWebAppGetPhoneNumber","VKWebAppGetEmail","VKWebAppGetGroupInfo","VKWebAppGetGeodata","VKWebAppGetCommunityToken","VKWebAppGetConfig","VKWebAppGetLaunchParams","VKWebAppSetTitle","VKWebAppGetAuthToken","VKWebAppCallAPIMethod","VKWebAppJoinGroup","VKWebAppLeaveGroup","VKWebAppAllowMessagesFromGroup","VKWebAppDenyNotifications","VKWebAppAllowNotifications","VKWebAppOpenPayForm","VKWebAppOpenApp","VKWebAppShare","VKWebAppShowWallPostBox","VKWebAppScroll","VKWebAppShowOrderBox","VKWebAppShowLeaderBoardBox","VKWebAppShowInviteBox","VKWebAppShowRequestBox","VKWebAppAddToFavorites","VKWebAppShowCommunityWidgetPreviewBox","VKWebAppShowStoryBox","VKWebAppStorageGet","VKWebAppStorageGetKeys","VKWebAppStorageSet","VKWebAppFlashGetInfo","VKWebAppSubscribeStoryApp","VKWebAppOpenWallPost","VKWebAppCheckAllowedScopes","VKWebAppCheckNativeAds","VKWebAppShowNativeAds","VKWebAppRetargetingPixel","VKWebAppConversionHit","VKWebAppShowSubscriptionBox","VKWebAppCheckSurvey","VKWebAppShowSurvey","VKWebAppScrollTop","VKWebAppScrollTopStart","VKWebAppScrollTopStop"],i&&!j?["VKWebAppResizeWindow","VKWebAppAddToMenu","VKWebAppShowInstallPushBox","VKWebAppGetFriends"]:["VKWebAppShowImages"]),m=e?window.AndroidBridge:void 0,n=g?window.webkit.messageHandlers:void 0,o=i?parent:void 0;var p,q,r,s,t;function u(a,b){var c=b||{bubbles:!1,cancelable:!1,detail:void 0},d=document.createEvent("CustomEvent");return d.initCustomEvent(a,!!c.bubbles,!!c.cancelable,c.detail),d}(p=a.EAdsFormats||(a.EAdsFormats={})).REWARD="reward",p.INTERSTITIAL="interstitial",(q=a.EGrantedPermission||(a.EGrantedPermission={})).CAMERA="camera",q.LOCATION="location",q.PHOTO="photo",(r=a.EGetLaunchParamsResponseLanguages||(a.EGetLaunchParamsResponseLanguages={})).RU="ru",r.UK="uk",r.UA="ua",r.EN="en",r.BE="be",r.KZ="kz",r.PT="pt",r.ES="es",(s=a.EGetLaunchParamsResponseGroupRole||(a.EGetLaunchParamsResponseGroupRole={})).ADMIN="admin",s.EDITOR="editor",s.MEMBER="member",s.MODER="moder",s.NONE="none",(t=a.EGetLaunchParamsResponsePlatforms||(a.EGetLaunchParamsResponsePlatforms={})).DESKTOP_WEB="desktop_web",t.MOBILE_WEB="mobile_web",t.MOBILE_ANDROID="mobile_android",t.MOBILE_ANDROID_MESSENGER="mobile_android_messenger",t.MOBILE_IPHONE="mobile_iphone",t.MOBILE_IPHONE_MESSENGER="mobile_iphone_messenger",t.MOBILE_IPAD="mobile_ipad","undefined"==typeof window||window.CustomEvent||(window.CustomEvent=(u.prototype=Event.prototype,u));var v=function(a){var b=void 0,e=[];function j(a){e.push(a)}function p(){return g||f}function q(){return i&&window.parent!==window}function r(){return p()||q()}function s(a){if(g||f)return c(e).map(function(b){return b.call(null,a)});var d=null==a?void 0:a.data;if(i&&d){if(h&&"string"==typeof d)try{d=JSON.parse(d)}catch(d){}var j=d.type,k=d.data,l=d.frameId;j&&("SetSupportedHandlers"!==j?"VKWebAppSettings"!==j?c(e).map(function(a){return a({detail:{type:j,data:k}})}):b=l:k.supportedHandlers)}}h&&/(android)/i.test(navigator.userAgent)?document.addEventListener(k,s):"undefined"!=typeof window&&"addEventListener"in window&&window.addEventListener(k,s);var t=d(function(c,d){m&&m[c]?m[c](JSON.stringify(d)):n&&n[c]&&"function"==typeof n[c].postMessage?n[c].postMessage(d):h?window.ReactNativeWebView.postMessage(JSON.stringify({handler:c,params:d})):o&&"function"==typeof o.postMessage&&o.postMessage({handler:c,params:d,type:"vk-connect",webFrameId:b,connectVersion:a},"*")},j);return{send:t,sendPromise:t,subscribe:j,unsubscribe:function(a){var b=e.indexOf(a);-1<b&&e.splice(b,1)},supports:function(a){return f?!(!m||"function"!=typeof m[a]):g?!(!n||!n[a]||"function"!=typeof n[a].postMessage):i&&-1<l.indexOf(a)},isWebView:p,isIframe:q,isEmbedded:r,isStandalone:function(){return!r()}}}("2.7.0");a.applyMiddleware=function a(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];return c.includes(void 0)||c.includes(null)?a.apply(void 0,c.filter(function(a){return"function"==typeof a})):function(a){if(0===c.length)return a;var d,e={subscribe:a.subscribe,send:function(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];return a.send.apply(a,b)}};return d=c.filter(function(a){return"function"==typeof a}).map(function(a){return a(e)}).reduce(function(a,b){return function(c){return a(b(c))}})(a.send),b(b({},a),{send:d})}},a.default=v,Object.defineProperty(a,"__esModule",{value:!0})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("@mail/jssdk/next/rpc/backend",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createBackend=void 0;var a=/^(https?:)?\/\//i;var b=/\/$/;var c=/\/{2,}/g;function d(a,b){return a.replace(/:([^/]+)|\{([^}]+)\}/g,function(a,c,d){return b?b[d||c]:""})}function e(e,f){var g=function(e){if(e===void 0){e={}}var g=e.baseUrl,h=g===void 0?"/":g;function i(d){var e=d||h;if(!a.test(e)&&!e.startsWith(h)){e="".concat(h.replace(b,"")).concat("/".concat(e).replace(c,"/"))}return e}function j(a,b){return d(i(a),b)}return __assign({url:j,normalizeUrl:i},f)};g.type=e;g.toString=function(){return e};return g}exports.createBackend=e});var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};define("@mail/jssdk/next/logger/logger",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.octoLogger=exports.createLogger=void 0;var a=1;var b=2;var c=0;var d=[];function e(f){if(f===void 0){f={}}var g=f.cid,h=g===void 0?function(){return++c}:g,i=f.isolate,j=f.parent,k=f.silent,l=f.entries,m=l===void 0?[]:l;function n(){return!i&&d[0]||j}function o(a,b){var c=n();var d={id:h(),type:a,args:b,parent:c};m.push(d);if(k===false){if(c){var e=[];var f=c;do{e.unshift("[36m[".concat(f.args[0],"][0m"))}while(f=f.parent);console.log.apply(console,__spreadArray([e.join(" → "),"→"],b,false))}else{console.log.apply(console,b)}}return d}var p={get silent(){return!!k},set silent(a){k=a},add:function(){var b=[];for(var c=0;c<arguments.length;c++){b[c]=arguments[c]}return o(a,b)},scope:function(a,c,d){return e(Object.assign({},f,{isolate:true,entries:m,parent:o(b,[a,c])},d))},open:function(){if(j){d.unshift(j)}return p},close:function(){var a=d.indexOf(j);if(a>-1){d.splice(a,1)}return p},getEntries:function(){return m}};return p}exports.createLogger=e;exports.octoLogger=e({isolate:false})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("@mail/jssdk/next/rpc/hook",["require","exports","@mail/jssdk/next/logger/logger"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createRpcHook=exports.replaceRequestData=void 0;function b(a,b,c,d){var e=a[c];if(e){if(b[c]&&b[c]!==e){d.add("⚠️  req.data.".concat(c," replaced"))}b[c]=e}}exports.replaceRequestData=b;function c(b,c,d){var e=function(e){var f=Object.assign({},c,e);var g=a.octoLogger.scope(b,{id:b,options:f});return __assign({id:b,options:f},d(f,g))};return Object.assign(e,{id:b,toString:function(){return b}})}exports.createRpcHook=c});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("@mail/jssdk/next/rpc/http",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.HTTP_STATUS_MAP=exports.HTTP_CODE_MAP=void 0;exports.HTTP_CODE_MAP={102:"processing",200:"ok",201:"created",202:"accepted",203:"non_authoritative",204:"no_content",205:"reset_content",206:"partial",207:"multi-status",208:"already_reported",226:"im_used",301:"move",304:"notmodified",400:"invalid",401:"unauthorized",402:"payment_required",403:"denied",404:"notfound",406:"unacceptable",407:"proxy_authentication_required",408:"timeout",409:"conflict",412:"precondition_failed",416:"range_not_satisfiable",417:"expectation_failed",422:"unprocessable",423:"locked",424:"failed_dependency",426:"upgrade_required",429:"many_requests",449:"retry_with",451:"unavailable_for_legal_reasons",500:"fail",501:"not_implemented",503:"unavaliable",507:"insufficient"};exports.HTTP_STATUS_MAP=Object.entries(exports.HTTP_CODE_MAP).reduce(function(a,b){var c;var d=b[0],e=b[1];return __assign(__assign({},a),(c={},c[e]=+d,c))},{})});var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(h){if(d)throw new TypeError("Generator is already executing.");while(g&&(g=0,h[0]&&(c=0)),c)try{if(d=1,e&&(f=h[0]&2?e["return"]:h[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,h[1])).done)return f;if(e=0,f)h=[h[0]&2,f.value];switch(h[0]){case 0:case 1:f=h;break;case 4:c.label++;return{value:h[1],done:false};case 5:c.label++;e=h[1];h=[0];continue;case 7:h=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(h[0]===6||h[0]===2)){c=0;continue}if(h[0]===3&&(!f||h[1]>f[0]&&h[1]<f[3])){c.label=h[1];break}if(h[0]===6&&c.label<f[1]){c.label=f[1];f=h;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(h);break}if(f[2])c.ops.pop();c.trys.pop();continue}h=b.call(a,c)}catch(a){h=[6,a];e=0}finally{d=f=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:true}}};define("@mail/jssdk/next/rpc/hooks/mailapi-token",["require","exports","@mail/jssdk/next/rpc/hook","@mail/jssdk/next/rpc/http"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mailapiTokenHook=void 0;exports.mailapiTokenHook=(0,a.createRpcHook)("mailapi/token",{token:undefined,email:undefined,method:"tokens",data:{},retries:3},function(c,d){var e;var f=0;return{pre:function(b){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(f){e=b.data;(0,a.replaceRequestData)(c,e,"token",d);(0,a.replaceRequestData)(c,e,"email",d);return[2,b]})})},post:function(a,g,h){var i;return __awaiter(this,void 0,void 0,function(){var j,k;return __generator(this,function(l){switch(l.label){case 0:if(a.status!==b.HTTP_STATUS_MAP.denied||a.body!=="token"){return[2,a]}j=c.email||((i=c.data)===null||i===void 0?void 0:i.email)||g.data.email;if(!j){d.add("❌ MailAPI Token request failed: email not defined");return[2,a]}if(!e){f++;if(f>c.retries){d.add("❌ MailAPI Token Reached maximum of attempts",{attempt:f,retries:c.retries});return[2,a]}d.add("ℹ️  MailAPI Token request",{currentAttempt:f});e=h.call(c.method,{email:j},{force:true}).then(function(a){d.add("✅ MailAPI Token received successfully",{attempt:f,status:a.status});if(a.isOK()){c.email=a.email||c.email;c.token=a.body.token}f=0;e=null}).catch(function(a){d.add("🆘 MailAPI Token received failed",{attempt:f,reason:a});e=null;throw a})}l.label=1;case 1:l.trys.push([1,3,,4]);return[4,e];case 2:l.sent();return[3,4];case 3:k=l.sent();if(f>=c.retries){d.add("⚠️  MailAPI Token Last attempt (no retry)",{attempt:f,retries:c.retries});f=0;return[2,a]}return[3,4];case 4:return[2,h.retry(g)]}})})}}})});define("@mail/jssdk/next/util/url",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.urlToAbsolute=void 0;var a=function(a){if(typeof document!=="undefined"){var b=document.createElement("a");b.href=a;return b.href}return a};exports.urlToAbsolute=a});var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(h){if(d)throw new TypeError("Generator is already executing.");while(g&&(g=0,h[0]&&(c=0)),c)try{if(d=1,e&&(f=h[0]&2?e["return"]:h[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,h[1])).done)return f;if(e=0,f)h=[h[0]&2,f.value];switch(h[0]){case 0:case 1:f=h;break;case 4:c.label++;return{value:h[1],done:false};case 5:c.label++;e=h[1];h=[0];continue;case 7:h=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(h[0]===6||h[0]===2)){c=0;continue}if(h[0]===3&&(!f||h[1]>f[0]&&h[1]<f[3])){c.label=h[1];break}if(h[0]===6&&c.label<f[1]){c.label=f[1];f=h;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(h);break}if(f[2])c.ops.pop();c.trys.pop();continue}h=b.call(a,c)}catch(a){h=[6,a];e=0}finally{d=f=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("@mail/jssdk/next/rpc/hooks/no-sdc",["require","exports","request","@mail/jssdk/next/util/url","@mail/jssdk/next/rpc/hook","@mail/jssdk/next/rpc/http"],function(require,exports,a,b,c,d){"use strict";var e;Object.defineProperty(exports,"__esModule",{value:true});exports.noSDCHook=void 0;a=__importDefault(a);function f(a){return typeof a==="object"&&!!a&&"fields"in a}var g=(e={},e[d.HTTP_STATUS_MAP.unauthorized]={calls:function(a){var b;var c=a.body;return f(c)&&((b=c.fields)===null||b===void 0?void 0:b.reason)==="no_sdc"}},e[d.HTTP_STATUS_MAP.denied]={base:function(a){var b=a.body;return b==="nosdc"}},e);exports.noSDCHook=(0,c.createRpcHook)("universal/nosdc",{url:"//auth.mail.ru/sdc",retries:3},function(c,d){var e=null;var f=0;return{post:function(h,i,j){return __awaiter(this,void 0,void 0,function(){var k,l,m,n,o,p;return __generator(this,function(q){switch(q.label){case 0:k=g[h.status];if(!k){return[2,h]}l=Object.entries(k).find(function(a){var b=a[0],c=a[1];return c(h)});if(!l){d.add("⚠️  Maybe is not NoSDC response",h);return[2,h]}m=d.scope(l[0],{project:l[0],request:i,response:h});if(!e){f++;if(f>c.retries){m.add("❌ SDC Reached maximum of attempts",{attempt:f,max:c.retries});return[2,h]}n=j.url(c.url);o=(0,b.urlToAbsolute)(i.url);m.add("ℹ️  SDC request",{attempt:f,from:o,sdcUrl:n});e=a.default.get(n,{from:o},typeof IS_TESTS!=="undefined"&&!!IS_TESTS?{}:{jsonp:"JSONP_call",dataType:"jsonp",force:true}).then(function(a){m.add("✅ SDC request successfully",{attempt:f,status:a.status,body:a.body});f=0;e=null;return a.body?true:Promise.reject(a.body)}).catch(function(a){m.add("🆘 SDC request failed",{attempt:f,reason:a});e=null;throw a})}q.label=1;case 1:q.trys.push([1,3,,4]);return[4,e];case 2:q.sent();return[3,4];case 3:p=q.sent();if(f===c.retries){m.add("⚠️  SDC Last attempt (no retry)",{attempt:f,retries:c.retries});return[2,h]}return[3,4];case 4:return[2,j.retry(i)]}})})}}})});var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(h){if(d)throw new TypeError("Generator is already executing.");while(g&&(g=0,h[0]&&(c=0)),c)try{if(d=1,e&&(f=h[0]&2?e["return"]:h[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,h[1])).done)return f;if(e=0,f)h=[h[0]&2,f.value];switch(h[0]){case 0:case 1:f=h;break;case 4:c.label++;return{value:h[1],done:false};case 5:c.label++;e=h[1];h=[0];continue;case 7:h=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(h[0]===6||h[0]===2)){c=0;continue}if(h[0]===3&&(!f||h[1]>f[0]&&h[1]<f[3])){c.label=h[1];break}if(h[0]===6&&c.label<f[1]){c.label=f[1];f=h;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(h);break}if(f[2])c.ops.pop();c.trys.pop();continue}h=b.call(a,c)}catch(a){h=[6,a];e=0}finally{d=f=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:true}}};define("@mail/jssdk/next/rpc/hooks/processing",["require","exports","@mail/jssdk/next/rpc/hook","@mail/jssdk/next/rpc/http"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.processingHook=void 0;function c(a){if(typeof a==="object"&&a){return a["retry_after"]}}exports.processingHook=(0,a.createRpcHook)("universal/processing",{retryAfter:5e3},function(a,d){return{post:function(e,f,g){return __awaiter(this,void 0,void 0,function(){var h;return __generator(this,function(i){switch(i.label){case 0:if(e.status!==b.HTTP_STATUS_MAP.processing){return[2,e]}h=c(e.body)||a.retryAfter;d.add("⏳ Retry After",{value:h});return[4,new Promise(function(a){setTimeout(a,h)})];case 1:i.sent();return[2,g.retry(f)]}})})}}})});define("@mail/jssdk/next/rpc/hooks/default",["require","exports","@mail/jssdk/next/rpc/hooks/mailapi-token","@mail/jssdk/next/rpc/hooks/no-sdc","@mail/jssdk/next/rpc/hooks/processing"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.initDefaultRpcHooks=void 0;var d=[c.processingHook,b.noSDCHook,a.mailapiTokenHook];function e(a){return d.map(function(b){return b(a[b.id]||{})})}exports.initDefaultRpcHooks=e});define("@mail/jssdk/next/rpc/qs",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.stringify=exports.parseQueryString=void 0;function a(b,c,d){if(c==null||c===""||typeof c!=="object"){return encodeURIComponent(b)+(d?"[".concat(d.join("]["),"]"):"")+(c==null||c===""?"":"=".concat(encodeURIComponent(c)))}var e=[];for(var f in c){if(c.hasOwnProperty(f)){e.push(a(b,c[f],(d||[]).concat(+f>=0?"":encodeURIComponent(f))))}}return e.join("&")}function b(a){if(a==null){return{}}if(typeof a!=="string"){return a}var b={};var c=a.replace(/^[?#&]+/,"").trim().split("&");for(var d=0,e=c.length;d<e;d++){var f=c[d].split("=");var g=f.shift();var h=f.join("=");if(h==null){h=""}else{try{h=decodeURIComponent(h)}catch(a){h=unescape(h)}}if(g){g=g.replace(/\[\]/g,"");if(b[g]===void 0){b[g]=h}else if(Array.isArray(b[g])){b[g].push(h)}else{b[g]=[b[g],h]}}}return b}exports.parseQueryString=b;function c(b){if(typeof b==="string"||b==null){return b||""}var c=[];if(b&&typeof b==="object"){for(var d in b){if(b.hasOwnProperty(d)){c.push(a(d,b[d]))}}}return c.join("&")}exports.stringify=c});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("@mail/jssdk/next/rpc/request",["require","exports","uuid","@mail/jssdk/next/rpc/qs"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mergeRequestData=exports.mergeRequestHeaders=exports.createRequest=void 0;a=__importDefault(a);function c(c){if(c===void 0){c={}}return __assign(__assign({id:c.id||(0,a.default)(),url:"/",method:"POST",headers:{},withCredentials:false,responseType:"json"},c),{data:(0,b.parseQueryString)(c.data),startTime:Date.now(),duration:0})}exports.createRequest=c;function d(){var a=[];for(var b=0;b<arguments.length;b++){a[b]=arguments[b]}return a.reduce(function(a,b){return Object.assign(a,b)},{})}exports.mergeRequestHeaders=d;function e(){var a=[];for(var c=0;c<arguments.length;c++){a[c]=arguments[c]}return a.reduce(function(a,c){return Object.assign(a,(0,b.parseQueryString)(c))},{})}exports.mergeRequestData=e});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(h){if(d)throw new TypeError("Generator is already executing.");while(g&&(g=0,h[0]&&(c=0)),c)try{if(d=1,e&&(f=h[0]&2?e["return"]:h[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,h[1])).done)return f;if(e=0,f)h=[h[0]&2,f.value];switch(h[0]){case 0:case 1:f=h;break;case 4:c.label++;return{value:h[1],done:false};case 5:c.label++;e=h[1];h=[0];continue;case 7:h=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(h[0]===6||h[0]===2)){c=0;continue}if(h[0]===3&&(!f||h[1]>f[0]&&h[1]<f[3])){c.label=h[1];break}if(h[0]===6&&c.label<f[1]){c.label=f[1];f=h;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(h);break}if(f[2])c.ops.pop();c.trys.pop();continue}h=b.call(a,c)}catch(a){h=[6,a];e=0}finally{d=f=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:true}}};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};define("@mail/jssdk/next/rpc/rpc",["require","exports","@mail/jssdk/next/logger/logger","@mail/jssdk/next/rpc/hooks/default","@mail/jssdk/next/rpc/http","@mail/jssdk/next/rpc/request"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createRpc=void 0;function e(a,b){var c=b.find(function(b){return b.from===a||a.match(b.from)});return c===null||c===void 0?void 0:c.to}function f(f,g){if(g===void 0){g={}}var h={};var i=g.logger,j=i===void 0?a.octoLogger:i,k=g.proxy,l=k===void 0?[]:k,m=g.extraData,n=g.extraHeaders,o=g.hooks,p=o===void 0?(0,b.initDefaultRpcHooks)(g):o;var q=j.scope("RPC",{proxy:l,extraData:m,extraHeaders:n,hooks:p.map(function(a){return[a.id,a.options]})});if(!p.length){console.warn("RPC Hooks not configured, use initDefaultRpcHooks")}function r(a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,h.call(a.url,a.data,a)];case 1:b=c.sent();return[2,b.raw]}})})}function s(a,b){var c=[];for(var d=2;d<arguments.length;d++){c[d-2]=arguments[d]}return p.reduce(function(b,d){var e=d[a];return e?b.then(function(a){return e.apply(void 0,__spreadArray([a],c,false))}):b},Promise.resolve(b))}function t(a,b){if(!a){return f.url()}var c=e(a,l);return f.url(c||a,b)}function u(a){var b=this;return function(e,g,i){return __awaiter(b,void 0,void 0,function(){var b,j,k,l,o,p;return __generator(this,function(r){switch(r.label){case 0:b=q.scope("call",{path:e,data:g,extra:i}).open();return[4,s("pre",(0,d.createRequest)(__assign(__assign({},i),{url:t(e,g),method:(i===null||i===void 0?void 0:i.method)||a,data:(0,d.mergeRequestData)(m,i===null||i===void 0?void 0:i.data,g),headers:(0,d.mergeRequestHeaders)(n,i===null||i===void 0?void 0:i.headers)})),h)];case 1:j=r.sent();k=f.prepareRequest(j);b.add("send",k);return[4,f.request(k)];case 2:l=r.sent();k.duration=Date.now()-k.startTime;j.duration=k.duration;return[4,s("post",f.parseResponse(l,k),k,h)];case 3:o=r.sent();p=__assign(__assign({},o),{raw:o,isOK:function(){return o.status>=200&&o.status<300},is:function(a){return c.HTTP_CODE_MAP[o.status]===a}});b.add("response:",o);if(p.isOK()){return[2,p]}throw p}})})}}function v(a,b){if(!f.addMock){throw new Error("[rpc] Backend 'addMock' not implemented")}f.addMock(a,b)}function w(){if(!f.clearMocks){throw new Error("[rpc] Backend 'clearMocks' not implemented")}f.clearMocks()}function x(a){p.push(a)}h.url=t;h.get=u("GET");h.post=u("POST");h.call=u("POST");h.put=u("PUT");h.delete=u("DELETE");h.retry=r;h.addMock=v;h.clearMocks=w;h.addHook=x;return h}exports.createRpc=f});define("@mail/jssdk/next/rpc/typing",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createOpenapiTyping=exports.addOpenapiTyping=exports.isRpcResponse=exports.createTyping=exports.addTyping=void 0;function a(a,b){return a}exports.addTyping=a;function b(a){return a}exports.createTyping=b;function c(a,b){if(a&&typeof a.status==="number"&&"raw"in a){return b==null||a.status===b}return false}exports.isRpcResponse=c;function d(a,b){return a}exports.addOpenapiTyping=d;function e(a){return a}exports.createOpenapiTyping=e});define("@mail/jssdk/next/rpc",["require","exports","@mail/jssdk/next/rpc/backend","@mail/jssdk/next/rpc/rpc","@mail/jssdk/next/rpc/typing"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isRpcResponse=exports.createTyping=exports.addTyping=exports.createRpc=exports.createBackend=void 0;Object.defineProperty(exports,"createBackend",{enumerable:true,get:function(){return a.createBackend}});Object.defineProperty(exports,"createRpc",{enumerable:true,get:function(){return b.createRpc}});Object.defineProperty(exports,"addTyping",{enumerable:true,get:function(){return c.addTyping}});Object.defineProperty(exports,"createTyping",{enumerable:true,get:function(){return c.createTyping}});Object.defineProperty(exports,"isRpcResponse",{enumerable:true,get:function(){return c.isRpcResponse}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("@mail/jssdk/next/rpc/swa",["require","exports","@mail/jssdk/next/rpc/backend","@mail/jssdk/next/rpc/http","request","@mail/jssdk/next/rpc/http"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.swaBackend=void 0;c=__importDefault(c);function e(a){var c=a&&a.body;var d=c&&typeof c==="object"&&c["status"];return b.HTTP_STATUS_MAP[d]>0}function f(a){if(a.code==="badparam"){return{status:b.HTTP_STATUS_MAP.invalid,body:{code:a.code}}}else if(a.code==="sdc"){return{status:b.HTTP_STATUS_MAP.denied,body:"nosdc"}}else if(b.HTTP_STATUS_MAP[a.status]===b.HTTP_STATUS_MAP.ok||a.code_number&&a.code_number===b.HTTP_STATUS_MAP.ok){return{status:b.HTTP_STATUS_MAP.ok,body:a.body}}else if(a.code_number&&d.HTTP_CODE_MAP[a.code_number]){return{status:a.code_number,body:{code:a.code,body:a.body}}}else if(b.HTTP_STATUS_MAP[a.status]){return{status:b.HTTP_STATUS_MAP[a.status],body:{code:a.code,body:a.body}}}return{status:b.HTTP_STATUS_MAP.fail,body:a}}exports.swaBackend=(0,a.createBackend)("swa",{axiosInstance:c.default.axiosInstance,addMock:function(a,b){var d={url:this.url(a),status:b.status,type:b.type||"POST",headers:Object.assign({"Content-Type":"application/json"},b.headers),responseTime:b.responseTime,responseText:JSON.stringify(b.body),once:b.once};c.default.mock(d)},clearMocks:function(){c.default.mock.clear()},request:function(a){return c.default.call(a.url,a.data,{headers:a.headers,type:a.method,withCredentials:a.withCredentials,skipErrorHandlers:true}).catch(function(a){return a})},prepareRequest:function(a){return a},parseResponse:function(a){if(e(a)){return f(a.body)}return{status:b.HTTP_STATUS_MAP.fail,body:a.body}}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/rpc/base-options",["require","exports","@mail/features","cfg","cfgUser"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.baseRpcOptions=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=function(d){var e=d.sdcUrl,f=d.featureProxyKey;var g=(c.default===null||c.default===void 0?void 0:c.default.initialUser)||{},h=g.email,i=g.token;var j=f?a.default.getAsTypedArray(f,a.default.String,[],",").map(function(a){var b=a.split(":"),c=b[0],d=b[1];return{from:c,to:d}}):[];return{proxy:j,"mailapi/token":{email:h,token:i},"universal/nosdc":{url:e||"".concat(b.default.get("urls.authUrl"),"/sdc")}}};exports.baseRpcOptions=d});define("service/rpc/swa",["require","exports","@mail/jssdk/next/rpc","@mail/jssdk/next/rpc/swa","default-values","./base-options"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.swaRpc=void 0;exports.swaRpc=(0,a.createRpc)((0,b.swaBackend)({baseUrl:c.JSAPI_BASE_URL}),(0,d.baseRpcOptions)({featureProxyKey:"swa-rpc-url"}))});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("vk-miniapp/utils",["require","exports","cfg","default-values","helpers/browser"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.openDownloadLink=exports.isIOS=exports.getVKPlatform=void 0;a=__importDefault(a);c=__importDefault(c);var d;(function(a){a["ANDROID"]="android";a["IOS"]="ios";a["WEB"]="web"})(d||(d={}));var e=function(){var a=new URLSearchParams(location.search);var b=a.get("vk_platform")||"";switch(true){case b.includes("ipad")||b.includes("iphone"):return d.IOS;case b.includes("android"):return d.ANDROID;default:return d.WEB}};exports.getVKPlatform=e;var f=function(){var a=(0,exports.getVKPlatform)();return a===d.IOS||a===d.WEB&&(b.IS_IOS||c.default.mac)};exports.isIOS=f;var g=function(){var b=a.default.urls.iosAppDeeplink||a.default.urls.iosAppDownload;var c=a.default.urls.androidAppDeeplink||a.default.urls.androidAppDownload;var d=(0,exports.isIOS)()?b:c;window.open(d,"_blank")};exports.openDownloadLink=g});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("vk-miniapp/init",["require","exports","@mail/flags","@vkontakte/vk-bridge","cfg","cfgUser","default-values","RPC","service/auth","service/rpc/swa","vk-miniapp/utils"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.authorizeWithVKBridge=exports.performLoading=exports.bridgeEventListeners=exports.VKMiniAppError=exports.VKMiniAppErrorType=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);var j;(function(a){a["VKComAccountNotFound"]="vkcom_account_not_found"})(j=exports.VKMiniAppErrorType||(exports.VKMiniAppErrorType={}));var k=function(a){__extends(b,a);function b(b){var c=a.call(this,b)||this;c.customType=b;return c}return b}(Error);exports.VKMiniAppError=k;exports.bridgeEventListeners={VKWebAppUpdateConfig:function(a){c.default.themeId=a.appearance;var b=a.appearance==="dark";if(b){}}};function l(a,c,d){if(d===void 0){d=1e3}return __awaiter(this,void 0,Promise,function(){return __generator(this,function(e){return[2,new Promise(function(e,f){var g=setTimeout(function(){return f(new Error("unable_to_send_vk_bridge_message"))},d);b.default.send(a,c).finally(function(){clearTimeout(g)}).then(e).catch(f)})]})})}function m(){return __awaiter(this,void 0,Promise,function(){var a,b,c,d;return __generator(this,function(f){switch(f.label){case 0:return[4,l("VKWebAppGetSilentToken",{app_id:e.MINI_APP_ID})];case 1:a=f.sent().tokens;b=a[0],c=b.uuid,d=b.token;return[2,{uuid:c,silentToken:d}]}})})}function n(a,b){return __awaiter(this,void 0,Promise,function(){var c,d;return __generator(this,function(f){switch(f.label){case 0:return[4,h.swaRpc.post("oauth2/vk",{client_id:e.MINI_APP_ID,uuid:a,silent_token:b,scope:"email,phone,offline"})];case 1:c=f.sent();d=c.body.accounts.find(function(a){return a.login.endsWith("@".concat(e.VK_DOMAIN))});if(!d){throw new k(j.VKComAccountNotFound)}return[2,d]}})})}function o(a){return __awaiter(this,void 0,Promise,function(){var b,c,d;return __generator(this,function(f){switch(f.label){case 0:b=new URL(a);b.hostname=e.SWA_HOST;b.searchParams.set("simple","1");b.searchParams.set("mob_json","1");b.searchParams.set("oauth2","1");b.searchParams.set("client_id",e.MINI_APP_ID);b.searchParams.set("mp",(0,i.isIOS)()?"iOS":"android");return[4,fetch(b.toString(),{headers:{"X-Mobile-App":e.MINI_APP_X_MOBILE}})];case 1:c=f.sent();return[4,c.json()];case 2:d=f.sent().oauth;return[2,d]}})})}function p(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,f.default.post("helpers")];case 1:b=c.sent();a.default.add(b.body);return[2]}})})}function q(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(b){switch(b.label){case 0:return[4,g.default.login()];case 1:a=b.sent();c.default.set("themeId",a.get("theme"));d.default.set("initialUser",a);d.default.set("initialUser.email",f.default.setup("email"));return[2]}})})}function r(a,b){return __awaiter(this,void 0,Promise,function(){var c,d;return __generator(this,function(e){switch(e.label){case 0:c=null;e.label=1;case 1:e.trys.push([1,3,,4]);return[4,a()];case 2:e.sent();return[3,4];case 3:d=e.sent();c=d;return[3,4];case 4:return[4,b()];case 5:e.sent();if(c){throw c}return[2]}})})}function s(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,l("VKWebAppInit",{})];case 1:a.sent();return[2]}})})}function t(){return __awaiter(this,void 0,void 0,function(){var a,b,c,d,e,g,h;return __generator(this,function(i){switch(i.label){case 0:return[4,m()];case 1:a=i.sent(),b=a.uuid,c=a.silentToken;return[4,n(b,c)];case 2:d=i.sent(),e=d.auth_url,g=d.login;return[4,o(e)];case 3:h=i.sent().access_token;f.default.setup({access_token:h,email:g});return[4,Promise.all([q(),p()])];case 4:i.sent();return[2]}})})}exports.performLoading=t;function u(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:b.default.subscribe(function(a){var b=exports.bridgeEventListeners[a.detail.type];if(b){return b(a.detail.data)}});return[4,r(t,s)];case 1:a.sent();return[2]}})})}exports.authorizeWithVKBridge=u});define("boot/vk-miniapp",["require","exports","default-values","vk-miniapp/init","vk-miniapp/utils"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getVkMiniAppErrorProps=void 0;var d=function(d){var e,f,g;var h=i18n("Что-то пошло не так");if(((e=d===null||d===void 0?void 0:d.details)===null||e===void 0?void 0:e.message)===b.VKMiniAppErrorType.VKComAccountNotFound){h=i18n("У вас ещё нет почтового ящика")}var i=c.openDownloadLink;if(((f=d===null||d===void 0?void 0:d.detail)===null||f===void 0?void 0:f.message)===b.VKMiniAppErrorType.VKComAccountNotFound){i=function(){window.open(a.VK_MAIL_OLD_MINI_APP_URL,"_blank")}}var j=i18n("Скачать приложение");if(((g=d===null||d===void 0?void 0:d.details)===null||g===void 0?void 0:g.message)===b.VKMiniAppErrorType.VKComAccountNotFound){j=i18n("Создать почту")}return{errorText:h,actionText:j,onActionClick:i}};exports.getVkMiniAppErrorProps=d});define("helpers/deferred",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=function(){function a(){var a=this;this.promise=new Promise(function(b,c){a.resolve=b;a.reject=c})}return a}();exports.default=a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("boot/feedback",["require","exports","helpers/deferred","service/auth","service/notify","service/themes.setup"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.initFeedback=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);function e(e){var f=this;e.one("actionend",function(){return __awaiter(f,void 0,void 0,function(){var e,f;return __generator(this,function(g){e=new a.default;f=new Promise(function(a,b){require(["service/feedback"],a,b)}).then(__importStar).then(function(a){return a.default});if(d.default.getSelectedModel().isDarkTheme!==undefined){e.resolve(d.default.getSelectedModel().isDarkMode())}else{d.default.themes.one("themes:apply",function(a){e.resolve(a.isDarkMode())})}Promise.all([f,e.promise]).then(function(a){var e=a[0],f=a[1];var g=new e(b.default.user.getEmail(),f,c.default.getContainer());g.init();d.default.themes.on("themes:apply",function(a){g.setDarkTheme(a.isDarkMode())})});return[2]})})})}exports.initFeedback=e});define("helpers/metrics/log-some-api-duration",["require","exports","default-values"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.logSomeAPIDuration=void 0;function b(a){var b="fail";if(a<100){b="instantly1"}else if(a<300){b="instantly2"}else if(a<500){b="instantly3"}else if(a<1e3){b="very-fast"}else if(a<2e3){b="fast"}else if(a<4e3){b="moderate"}else if(a<8e3){b="slightly-slow"}else if(a<15e3){b="slow"}else if(a<3e4){b="very-slow"}return b}function c(c){var d=c.request,e=c.xray;d.on("end",function(c,d){var f;var g=d.url,h=d.duration;var i=null;if(g==="/api/v1/threads/status/smart"){i="status"}else if(g==="/api/v1/aliases"){i="aliases"}if(i&&d.isOK()){var j=b(h);e.send("adman-c-api",{i:(f={},f["".concat(i,"_hit")]=h,f["".concat(i,"_sc-").concat(j,"_hit")]=h,f),dwh:{country_id:a.RB_COUNTRY_ID,province_id:a.RB_PROVINCE_ID,region_id:a.RB_REGION_ID,duration_type:j}})}})}exports.logSomeAPIDuration=c});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/jssdk-config/setupConstants",["require","exports","default-values","mail/Attachment"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);function c(){b.default.DANGEROUS_CLOUD_URL=a.CLOUD_HOST}exports.default=c});define("helpers/octavius",["exports","@mail/flags"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.octaviusToggle=d;var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}function d(a){try{window.__PH.cookie.s.setGlobal("m_oct",a?1:0);if(window.location.host==="e.mail.ru"){window.__PH.cookie.s.setGlobal("octavius",a?1:0)}}catch(a){}var c=b.default.get("octavius");var d=Promise.resolve();if(!c.state){var e=b.default.get("octavius-on-register-enabled");d=e.save({state:false,time:true})}var f=c.state==a?Promise.resolve():c.save({state:a,time:true,hit:true});return Promise.all([f,d])}});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};define("service/compose-template",["require","exports","default-values","router"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=i18n("Поздравляю!");var d={open:function(b){return __awaiter(void 0,void 0,void 0,function(){var e,f,g,h;var i;return __generator(this,function(j){switch(j.label){case 0:j.trys.push([0,3,,4]);return[4,d.fetchTemplate(b)];case 1:e=j.sent();f=(i=a.COMPOSE_TEMPLATES_SUBJECTS[b])!==null&&i!==void 0?i:c;return[4,d.saveDraft({subject:f,body:{html:e,text:undefined}})];case 2:g=j.sent();d.compose(g,b);return[3,4];case 3:h=j.sent();return[3,4];case 4:return[2]}})})},openFromGetParameter:function(b){var c=a.COMPOSE_ALLOWED_TEMPLATES.includes(b);if(!c){return}return d.open(b)},fetchTemplate:function(b){return fetch("".concat(a.COMPOSE_TEMPLATES_URL,"/").concat(b,".html"),{mode:"cors"}).then(function(a){return a.text()})},saveDraft:function(a){return __awaiter(this,void 0,Promise,function(){var b,c,d;return __generator(this,function(e){switch(e.label){case 0:b=new Promise(function(a,b){require(["mail/MessageFormData"],a,b)}).then(__importStar);return[4,b];case 1:c=e.sent().default;d=new c(a);return[2,d.save().then(function(a){var b;return(b=a===null||a===void 0?void 0:a.body)===null||b===void 0?void 0:b.id})]}})})},getRouter:b.getAppRouter,compose:function(a,b){var c=d.getRouter();c.nav("/compose/".concat(a,"/drafts?template-name=").concat(b))}};exports.default=d});var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/query-checker",["require","exports","@mail/contact-validation","@mail/flags","@mail/xray","cfg","data-source/actions","default-values","helpers/data-source-dispatch","helpers/octavius","mediator/layout-manager","pilotjs","service/compose-template","service/layer","service/radars/index","service/themes.setup","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);g=__importDefault(g);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);var p=function(){function p(a){this.target=a;this.request=a.activeRequest;this.route=a.activeRoute}p.prototype.handleToggleMetathreads=function(){var a=this.request.query.metathreads;var b={on:true,off:false};if(b.hasOwnProperty(a)){var c=b[a];(0,g.default)({type:e.CHANGE_METATHREADS_SETTING,state:c,uid:undefined});this._eliminateQueryParam("metathreads")}};p.prototype.handleToggleToMyselfMetathread=function(){var a=this;var c="tomyself";var d=this.request.query[c];if(d!=="on"){return}l.default.open("confirm-tomyself-enable",{},{compact:true,dimmer:true,resolvable:true,"close-on-dimmer":false,"close-on-esc":false,"reject-on-close":true}).then(function(){var a=b.default.get("to-myself").isActive();if(!a){(0,g.default)({type:e.TOGGLE_TO_MYSELF_METATHREAD,state:true,uid:undefined});(0,m.default)("query_myself_on")}}).catch(function(a){if(a){(0,m.default)("quer_mslf_open_err_".concat(a));throw a}}).finally(function(){a._eliminateQueryParam(c)})};p.prototype.handleToggleLayout=function(){var a=this.request.query.layout;if(a==="2pane"||a==="3pane"){i.default.setLayout(a);this._eliminateQueryParam("layout")}};p.prototype.handleEnableOctavius=function(){var a=this;if(this.request.query.octavius==="on"){(0,h.octaviusToggle)(true).then(function(){window.sendLoadlogRadar("loadflow_step-21a","octavius_force_enabled_success");window.appStarted("redirect");var b=Object.assign({},a.request.query);delete b.octavius;var c=j.default.queryString.stringify(b);var e=d.default.get("urls.rootUrl");window.location.replace("".concat(e,"?").concat(c))}).catch(function(){window.sendLoadlogRadar("loadflow_step-21b","octavius_force_enabled_fail")})}};p.prototype.handleSetTheme=function(){return __awaiter(this,void 0,void 0,function(){var a,b,d;return __generator(this,function(e){switch(e.label){case 0:a=this.request.query.theme;if(!a){return[2]}this._eliminateQueryParam("theme");(0,m.default)({type:"direct-link-theme",intervals:[[a,1]]});return[4,n.default.load()];case 1:e.sent();b=n.default.getSelectedModel();d=n.default.getModel(a);if(!d){c.default.send("direct-link-unknown-theme",{intervals:[[a,1]]})}if(b.id===d.id){return[2]}return[4,l.default.open("confirm-set-theme",{model:d},{dimmer:true,compact:true,resolvable:true,"reject-on-close":true,"close-on-dimmer":false})];case 2:e.sent();return[4,n.default.setTheme(d,true)];case 3:e.sent();return[2]}})})};p.prototype._lazyCallSettingsManagerMethod=function(a){(0,o.lazyMediatorSettingsManager)().then(function(b){b[a]()})};p.prototype.handleOpenThemesPanel=function(){var a=this.request.query.themes;if(a===undefined){return}this._eliminateQueryParam("themes");this._lazyCallSettingsManagerMethod("onSettingsDockAppearanceOpen")};p.prototype.handleOpenCleanMaster=function(){var b,c,d,e,g,h;var i=this.request.query.cleanmaster;if(i===undefined){return}this._eliminateQueryParam("cleanmaster");if(i.length>0){var j=decodeURIComponent(i);var k=j.split(":"),n=k[0],o=k[1];(0,m.default)({type:"cleanmaster-query-action",i:(b={},b[n]=1,b)});if(f.CLEANMASTER_MODAL_ACTIONS_DISABLED){(0,m.default)({type:"cleanmaster-query-action-fail",i:(c={},c[n]=1,c["feature-disabled"]=1,c)});return false}if(!["remove","unsubscribe"].includes(n)){(0,m.default)({type:"cleanmaster-query-action-fail",i:(d={},d[n]=1,d["unknown-action"]=1,d)});return false}if(o===""){(0,m.default)({type:"cleanmaster-query-action-fail",i:(e={},e[n]=1,e["emails-empty"]=1,e)});return false}var p=o.split(",");var q=p.length;p=p.filter(function(b){return(0,a.checkTextValidity)(b).valid});if(p.length===0){(0,m.default)({type:"cleanmaster-query-action-fail",i:(g={},g[n]=1,g["filtered-emails-empty"]=1,g)});return false}l.default.open("cleanmaster-modal",{action:n,from:p},{});(0,m.default)({type:"cleanmaster-query-action-success",i:(h={},h[n]=1,h.validEmailsCount=p.length,h.initialEmailsCount=q,h)})}else{if(!f.SETTINGS_DOCK_CLEANMASTER_INLINE_DISABLED){this._lazyCallSettingsManagerMethod("onSettingsDockCleanmasterOpen")}else{this._lazyCallSettingsManagerMethod("onCleanmasterClick")}(0,m.default)({type:"cleanmaster-page_open",dwh:{from:"get_cleanmaster"}})}return true};p.prototype.handleQueryAction=function(){var a=this;var b={"open-metathreads-settings":function(){var b=!f.HIDE_METATHREADS;if(b){a._lazyCallSettingsManagerMethod("onSettingsMetathreadsOpen")}return b},"open-cleanmailbox":function(){var b=!f.SETTINGS_DOCK_HIDE_CLEANMAILBOX;if(b){a._lazyCallSettingsManagerMethod("onSettingsDockCleanmailboxOpen")}return b},"open-browser-notifications":function(){if(f.SETTINGS_DOCK_BROWSERSETTINGS_ENABLED){a._lazyCallSettingsManagerMethod("onSettingsDockBrowserSettingsOpen")}return f.SETTINGS_DOCK_BROWSERSETTINGS_ENABLED}};var c=this.request.query.action;if(b.hasOwnProperty(c)&&b[c]()){this._eliminateQueryParam("action")}};p.prototype.handleOpenComposeTemplate=function(){var a=this.request.query.compose_template;if(a===undefined){return}this._eliminateQueryParam("compose_template");k.default.openFromGetParameter(a)};p.prototype.handleOpenFromExtension=function(){var a=this.request.query.opening_from_extension;if(a===undefined){return}(0,m.default)({type:"opening-from-extension"});this._eliminateQueryParam("opening_from_extension")};p.prototype._eliminateQueryParam=function(a){var b=this.request.query[a];var c=Object.assign({},this.request.query);delete c[a];this.target.go(this.route.id,this.route.params,c);(0,m.default)({type:"query-check_".concat(a),intervals:[[b,1]]})};return p}();exports.default=p});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("helpers/error-to-json",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.errorToJSON=void 0;var a=["code","errno","syscall"];function b(b){if(!b||typeof b!=="object"){return b}if(typeof b.toJSON==="function"){return b.toJSON()}var c=__assign(__assign({},b),{name:b.name,message:b.message,stack:b.stack});for(var d=0,e=a;d<e.length;d++){var f=e[d];c[f]=b[f]}return c}exports.errorToJSON=b});define("service/white-portal/inline",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getWhitePortalConfig=void 0;function a(a){return a["default-themeId"]||"default"}function b(a){return a["white_portal_theme"]||"t6000"}function c(b,c){return b.hasOwnProperty("themeId")||c.themeId||a(b)}function d(b,d){return c(b,d)===a(b)}function e(){return/[?&]newreg/.test(window.location.search)}function f(a,f){var g=a.hasOwnProperty("white_portal_forced");var h=a.hasOwnProperty("white_portal_newreg");var i=a.hasOwnProperty("white_portal_available");var j=a.hasOwnProperty("white_portal_has_flag");var k=g||h||i;var l=false;var m;if(k&&!j&&d(a,f)){if(g){l=true;m="forced"}else if(h&&e()){l=true;m="newreg"}}var n=l||c(a,f)===b(a);return{insert:k,apply:l,load:n,applyReason:m}}exports.getWhitePortalConfig=f});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/white-portal/index",["require","exports","@mail/features","@mail/flags","@mail/xray","cfg","default-values","helpers/error-to-json","service/auth","service/themes","service/white-portal/inline"],function(require,exports,a,b,c,d,e,f,g,h,i){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.tryApplyWhitePortalTheme=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);g=__importDefault(g);function j(a){var b=function(){g.default.off("login",b);a()};g.default.on("login",b)}function k(){var g;var k=(0,i.getWhitePortalConfig)(a.default.list,d.default);if(k.apply){c.default.send(["wpt_apply"],{i:(g={},g["reason_".concat(k.applyReason)]=1,g)});d.default.set("themeId",e.WHITE_PORTAL_THEME);j(function(){var a=new h.ThemeModel(e.WHITE_PORTAL_THEME,e.THEMES_PROJECT_NAME,{},"");a.store().catch(function(a){c.default.send(["wpt_apply-error"],{i:{store:1},rlog:"octavius_wpt_experiment",rlog_message:(0,f.errorToJSON)(a)})});var d=b.default.get("white-portal");if(d){d.save({state:true}).catch(function(a){c.default.send(["wpt_apply-error"],{i:{flag:1},rlog:"octavius_wpt_experiment",rlog_message:(0,f.errorToJSON)(a)})})}})}}exports.tryApplyWhitePortalTheme=k});define("feast-tpl!app/feast-tpl!ui-block/application/application.html",["feast"],function(a){return a.smartParse('<div qa:id="application" style="{_this.getStyle()}">\n\t<bem:mod name="new-toolbar" test="_this.useNewToolbar()"/>\n\n\t<fn:choose>\n\t\t<fn:when test="attrs.route.is(\'#attachment\')">\n\t\t\t<b:application-viewer/>\n\t\t</fn:when>\n\n\t\t<fn:when test="attrs.route.is(\'#attachment-temporary\')">\n\t\t\t<b:application-viewer\n\t\t\t\tattachment-temporary\n\t\t\t/>\n\t\t</fn:when>\n\n\t\t<fn:when test="attrs.route.is(\'#attachment-editor\')">\n\t\t\t<b:application-attachment-editor/>\n\t\t</fn:when>\n\n\t\t<fn:otherwise>\n\t\t\t<b:application-mail\n\t\t\t\tuse:mediator="layout-manager folders-navigation pony-mode"\n\t\t\t/>\n\t\t</fn:otherwise>\n\t</fn:choose>\n\n\t<b:settings-dock\n\t\tuse:mediator="settings-manager layout-manager pony-mode themes-manager folders-actions todo-manager letters-actions"\n\t\tqa:id="settings-dock"\n\t/>\n\n\t<b:notify-stack\n\t\tref="notify-stack"\n\t\tid="notify-stack"\n\t\tfixed\n\t/>\n</div>\n',"app/feast-tpl!ui-block/application/application.html")});define("feast-tpl!ui-block/application/application.html",["feast-tpl!app/feast-tpl!ui-block/application/application.html"],function(a){return a});define("helpers/set-cookie",["require","exports","./date-alias"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.setCookie=void 0;function b(b,c,d){if(d===void 0){d={}}var e=new Date;typeof d.expires=="number"&&e.setTime(e.getTime()+(0,a.day)(d.expires));c=c+"";document.cookie=b+"="+c+(typeof d.expires=="number"?"; expires="+e.toUTCString():"")+(d.path?"; path="+d.path:"")+(d.domain?"; domain="+d.domain:"")+(d.secure?"; secure":"")}exports.setCookie=b});define("feast-tpl!app/feast-tpl!ui-block/application-attachment-editor/application-attachment-editor.html",["feast"],function(a){return a.smartParse("<div>\n</div>\n","app/feast-tpl!ui-block/application-attachment-editor/application-attachment-editor.html")});define("feast-tpl!ui-block/application-attachment-editor/application-attachment-editor.html",["feast-tpl!app/feast-tpl!ui-block/application-attachment-editor/application-attachment-editor.html"],function(a){return a});define("mail/actions/AddAttachToCloud",function(require){"use strict";var a=require("Action");var b=require("RPC");var c=a.extend({prepare:function(a){var b={folder:a.folder,ids:a.ids,need_real_filename:a.need_real_filename||false};if(a.bossFolder){b.boss_folder=a.bossFolder}return b},operation:function(a){return b.post("attaches/add/to-cloud",a)}});a.register("mail.AddAttachToCloud",c);c.version="0.1.0";return c});define("mail/actions/AddCloudStockToCloud",["RPC","Action"],function(a,b){"use strict";var c=b.extend({prepare:function(a){return{folder:a.folder,files:a.files}},operation:function(b){return a.post("cloud/attachment/save/to-cloud",b)}});b.register("mail.AddCloudStockToCloud",c);c.version="0.1.0";return c});define("mail/actions/CloudFolderAdd",function(require){"use strict";var a=require("Action");var b=require("RPC");var c=a.extend({prepare:function(a){return{add:a.add,storage:a.storage||"home"}},operation:function(a){return b.post("cloud/folder/add",a)}});a.register("mail.CloudFolderAdd",c);c.version="0.1.0";return c});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/editors",["require","exports","default-values","helpers/encode","mail/actions/AddAttachToCloud","mail/actions/AddCloudStockToCloud","mail/actions/CloudFolderAdd","pilotjs","RPC","service/layer"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DEFAULT_FOLDER_CLOUD_NAME=void 0;c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);var i="/";exports.DEFAULT_FOLDER_CLOUD_NAME="Почтовые вложения";var j=Object.entries(a.VIEWER_EDITORS).reduce(function(a,b){var c=b[0],d=b[1];a[c]=__assign(__assign({},d),{supportedTypes:d.supportedTypes&&d.supportedTypes.split(","),id:c,priority:parseInt(d.priority,10)});return a},{});var k={all:j,createCloudFolder:function(){return e.default.execute({add:[{folder:i,name:exports.DEFAULT_FOLDER_CLOUD_NAME}]}).catch(function(a){var b=a.error;if(b.get("body.home.error")==="exists"){return Promise.resolve(b)}else if(b.get("status")==g.default.statuses.payment_required&&b.get("body.error")==="cloud_not_exists"){h.default.open("cloud-unavailable",{},{dimmer:true,compact:true,"close-on-dimmer":true,"close-on-esc":true,resolvable:true}).then(function(){window.close()},function(){window.close()})}else{return Promise.reject(null)}})},downloadToCloud:function(a,b,e){var f;if(b==="cloud_stock"){var g=e.split(":");f=d.default.execute({folder:"/Почтовые вложения",files:[{bundle_id:g[0],file_id:g[1]}]}).then(function(a){return Promise.resolve(a.result.get("body[0][0]"))},function(){return Promise.reject(null)})}else{f=c.default.execute({folder:"/Почтовые вложения",need_real_filename:false,ids:["".concat(a,";").concat(e)]}).then(function(a){return Promise.resolve(a.result.get("body[0]"))},function(){return Promise.reject(null)})}return f},open:function(a,c){var d=this;var e=c.messageId,h=c.attachType,i=c.attachId;return this.createCloudFolder().then(function(){return d.downloadToCloud(e,h,i).catch(function(){return Promise.reject(null)})}).then(function(a){return g.default.token().then(function(b){return Promise.resolve({token:b,fileName:a})})}).then(function(c){var d=c.fileName,e=c.token;var h=f.default.queryString.stringify({"x-email":g.default.setup().email,token:e,from:"mail"});var i="https://cloud.mail.ru/"+a+"/edit/home"+(0,b.safeEncodeURI)(d)+"?"+h;location.assign(i)}).catch(function(){return Promise.reject("Не получилось открыть файл в редакторе")})}};exports.default=k});define("ui-block/application-attachment-editor/application-attachment-editor",["exports","feast","feast-tpl!./application-attachment-editor.html","service/editors","ui-block/headline/headline"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}exports.default=e.default.Block.extend({name:"application-attachment-editor",template:f.default,isolate:false,isolateEvents:false,viewer:null,blocks:{},didMount:function a(){h.default.hide();var b=this.get("route").params;var c=this.get("route").request.query;var d=b.message,e=b.id;var f=c.type,i=c.editor;if(!d||!e||!f||!i){console.error("Необходимы все параметры");return}g.default.open(i,{messageId:d,attachType:f,attachId:e})}})});define("feast-tpl!app/feast-tpl!ui-block/application-viewer/application-viewer.html",["feast"],function(a){return a.smartParse('<div>\n\t<div ref="attachment-viewer" qa:id="viewer">\n\t\t\x3c!-- renderTo placeholder --\x3e\n\t</div>\n\t<div bem:elem="notify-wrapper">\n\t\t<b:notify-stack ref="notify-stack" id="notify-stack" fixed/>\n\t</div>\n\t<b:counters/>\n</div>\n',"app/feast-tpl!ui-block/application-viewer/application-viewer.html")});define("feast-tpl!ui-block/application-viewer/application-viewer.html",["feast-tpl!app/feast-tpl!ui-block/application-viewer/application-viewer.html"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/application-viewer/application-viewer",["require","exports","feast","feast-tpl!./application-viewer.html","helpers/encode-uri-component","helpers/viewport","mediator/attachments-manager","service/auth","service/layer","service/notify","service/radars/index","ui-block/counters/counters","ui-block/headline/headline","ui-block/layer-window/layer-window","ui-block/notify-stack/notify-stack"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);var n=function(a){(0,i.default)(["viewer-app"].concat(a))};exports.default=a.default.Block.extend({name:"application-viewer",template:b.default,isolate:false,isolateEvents:false,viewer:null,blocks:{"notify-stack":m.default,counters:j.default},constructor:function b(){a.default.Block.prototype.constructor.apply(this,arguments);(0,d.toggleViewport)("")},didMount:function(){var a=this;require(["ajs","feast-mailru-toolkit"],function(b,d){var g=d.loadToolkit;g(function(){new Promise(function(a,b){require(["ui-block/viewer/viewer"],a,b)}).then(__importStar).then(function(b){var d;var g=b.default;if(a.destroyed||a.zombie){return}k.default.hide();var h;var i;var j;var l;var m=a.is("attachment-temporary");if(m){d=a.get("attachmentTemporary"),h=d.list,l=d.attachment;i=a.get("route").params.message}else{j=a.get("message");l=a.get("attachment");h=j.get("attaches.list");i=j.id}if(!l){n(["error","no-attachment"]);if(m&&h&&h.length){var o=a.get("router");var p={"x-email":f.default.user.getEmail()};n(["error","no-attachment","find-first"]);window.location.href=o.getUrl("#attachment-temporary",{message:i,id:(0,c.default)(h[0].id),path:""},p)}n(["show","empty-viewer"]);l=null}var q=new g({message:j,messageId:i,attachment:l,models:h,modal:true,router:a.get("router"),temporary:a.is("attachment-temporary")}).renderTo(a.refs["attachment-viewer"]);e.default.registerComponent("viewer",g);e.default.register(q)})})});g.default.setup(l.default);h.default.setup(this.ids["notify-stack"])}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/application/application",["require","exports","default-values","feast","feast-tpl!./application.html","helpers/set-cookie","service/notify","ui-block/application-attachment-editor/application-attachment-editor","ui-block/application-mail/application-mail","ui-block/application-viewer/application-viewer","ui-block/notify-stack/notify-stack","utils/util"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);exports.default=b.default.Block.extend({name:"application",template:c.default,performanceTrace:"track",blocks:{"application-mail":g.default,"application-viewer":h.default,"application-attachment-editor":f.default,"notify-stack":i.default},constructor:function(){b.default.Block.prototype.constructor.apply(this,arguments);this.debouncedUpdateStyle=j.default.debounce(this.updateStyle,a.RESIZE_UPDATE_DEBOUNCE_TIME,this);if(a.TOUCH_MODE){window.addEventListener("resize",this.debouncedUpdateStyle)}(0,d.setCookie)("gmt",-(new Date).getTimezoneOffset()/60,{path:"/"})},didMount:function(){e.default.setup(this.ids["notify-stack"])},didUnmount:function(){window.removeEventListener("resize",this.debouncedUpdateStyle)},updateStyle:function(){this.el.style=this.getStyle()},useNewToolbar:function(){return a.NEW_TOOLBAR},getStyle:function(){if(a.TOUCH_MODE){return"height: calc(".concat(window.innerHeight,"px - ").concat(a.HEADLINE_HEIGHT,");")}return"height: calc(100vh - ".concat(a.HEADLINE_HEIGHT,");")}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("flags.setup",["require","exports","@mail/flags","default-values","RPC"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.setupFlagsAutosync=void 0;a=__importDefault(a);c=__importDefault(c);function d(d){if(b.FLAGS_AUTOSYNC){a.default.setAutoSync(true,c.default.setup("email"),b.FLAGS_AUTOSYNC_DEBOUNCE);d.on("route-end",function(){a.default.sync()});document.addEventListener("visibilitychange",function(){a.default.sync()})}}exports.setupFlagsAutosync=d});define("init/post-load",["require","exports","router"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.afterLoad=void 0;function b(){userKeeper.timeEnd("app-require",{score:"app:init"});window.sendLoadlogRadar("loadflow_step-25","app required");_timers.init_app+=_now();(0,a.getAppRouter)().ready(function(){userKeeper.timeEnd("app-ready",{score:"app:init"});userKeeper.timeEnd("page-app-ready",{score:[5e3,1e4,15e3]});userKeeper.timeEnd("biz-app-ready",{score:"app:ready"})});app.ready(function(){var a,b;return(b=(a=window).__hideBootscreen__)===null||b===void 0?void 0:b.call(a)});app.on("login-page",function(){var a,b;return(b=(a=window).__hideBootscreen__)===null||b===void 0?void 0:b.call(a)});_timers.data=-_now()}exports.afterLoad=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("access",["require","exports","default-values","service/auth","vk-miniapp/init"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.authorized=void 0;b=__importDefault(b);var d=false;function e(){if(a.IS_VK_MINI_APP&&!d){d=true;return(0,c.authorizeWithVKBridge)()}return b.default.login()}exports.authorized=e});define("route/attachment",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={url:"/attach/:message?/:id?/:path?"}});define("route/attachment-editor",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={url:"/attachment/editor/:message?/:id?"}});define("route/attachment-temporary",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={url:"/attachment/temporary/:message?/:id?/:path?"}});define("route/base-route",["exports","mail/Folder","mail/Message","mail/Thread","utils/util","../default-values"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=n;var f=j(a);var g=j(b);var h=j(c);var i=j(d);function j(a){return a&&a.__esModule?a:{default:a}}var k=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var l={};var m={};Object.keys(f.default).forEach(function(a){var b=a.slice(5).toLowerCase();var c=f.default[b.toUpperCase()];if(a.startsWith("TYPE_")&&c>=0){l[b]=c;m[c]=b;if(c===f.default.SCHOOL){l["study"]=c;m[c]="study"}}});function n(a,b){return i.default.extend({url:{pattern:a,params:{folder:{default:f.default.INBOX,decode:function a(b){return l[b]||parseInt(b,10)||f.default.INBOX}}},toUrl:function a(b,c,d){c=k({},c,e.URL_EXTRA_PARAMS);b=b||{};var i=b.folder;var j=b.letter;if(i===void 0){if(b instanceof f.default){i=b.is("system")?b.get("type"):b.id}else if(b instanceof g.default){i=b.get("folder");if(b instanceof h.default){j=b.id}else if(b.meta("thread_id")){j=b.meta("thread_id")}else if(b.id){j="0:"+b.id+":0"}var l=f.default.all.get(i);if(l){i=l.is("system")?l.get("type"):l.id}}}return d({folder:m[i||f.default.INBOX]||i,letter:j||"letter-not-found",part:b.part||"",id:b.id||""},c)}}},b)}});define("route/letters",["exports","route/base-route","route/utils/filter-query"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var g=(0,c.default)("/:folder?");var h=g.url.toUrl;g.url.toUrl=function(a,b,c){if(a&&a.preserveFilters){return h(a,f({},b,d.default.getQuery(a.preserveSortings)),c)}return h(a,b,c)};g.filterQuery=d.default;g.aliases={compose:{pattern:"/compose/:composeid?/:composeaction?"},contacts:{pattern:"/contacts"}};exports.default=g});define("route/read-letter",["exports","route/base-route","route/utils/filter-query"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}var f=(0,c.default)("/:folder/:letter/:part?");f.filterQuery=d.default;exports.default=f});define("route/search",["exports","route/base-route"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}var d=(0,b.default)("/search");exports.default=d});define("route/search-letter",["exports","route/base-route"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}var d=(0,b.default)("/search/:folder/:letter/:id");exports.default=d});define("route/utils/letter-id-to-url",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=b;var a=function(){function a(a,b){var c=[];var d=true;var e=false;var f=undefined;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=true){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=true;f=a}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b)){return b}else if(Symbol.iterator in Object(b)){return a(b,c)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function b(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var d=b.match(/(\d+);(.*)/);if(d){var e=a(d,3),f=e[1],g=e[2];return"/"+c+"/0:"+f+":"+c+"/"+g+"/"}else{return"/"+c+"/0:"+b+":"+c+"/"}}});define("route/septima/cgibin",["exports","pilotjs","../utils/letter-id-to-url"],function(exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var c=e(a);var d=e(b);function e(a){return a&&a.__esModule?a:{default:a}}exports.default={url:{pattern:"/cgi-bin/:method"},redirectUrl:function a(b,e){var f=b.method;var g=e.id;var a="/";if(f==="readmsg"&&g){delete e.id;var h=(0,d.default)(g);var i=c.default.queryString.stringify(e);a=h+"?"+i}return a}}});define("route/septima/msglist",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={url:{pattern:"/messages/:folderAlias?/:folderId?"},redirectUrl:function a(b){var c=b.folderAlias,d=b.folderId;var a="/";if(c&&c==="folder"&&d){a="/"+d+"/"}else if(c&&c!=="folder"){a="/"+c+"/"}return a}}});define("route/septima/readmsg",["exports","../utils/letter-id-to-url"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}exports.default={url:{pattern:"/message/:letterId",toUrl:function a(b){var c=b.letterId,d=b.mod,e=b.folderId,f=e===undefined?0:e;return"/message/"+c+"/"+(d?d+"/":"")+("?folder_id="+encodeURIComponent(String(f)))}},redirectUrl:function a(c,d){var e=c.letterId;var f=d.folder_id,g=f===undefined?0:f;var a="/";if(e){a=(0,b.default)(e,g)}return a}}});define("route/septima/thread",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={url:{pattern:"/thread/:threadId"},redirectUrl:function a(b){var c=b.threadId;var a="/";if(c){a="/inbox/"+c+"/"}return a}}});define("sitemap",["exports","./access","route/attachment","route/attachment-editor","route/attachment-temporary","route/letters","route/read-letter","route/search","route/search-letter","route/septima/cgibin","route/septima/msglist","route/septima/readmsg","route/septima/thread","data-source/index"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var n=z(b);var o=z(c);var p=z(d);var q=z(e);var r=z(f);var s=z(g);var t=z(h);var u=z(i);var v=z(j);var w=z(k);var x=z(l);var y=z(m);function z(a){return a&&a.__esModule?a:{default:a}}exports.default={access:a.authorized,model:y.default.getLoader(),"#!septimaCgiBin":u.default,"#!septimaMsglist":v.default,"#!septimaReadmsg":w.default,"#!septimaThread":x.default,"#search":s.default,"#search-letter":t.default,"#attachment":n.default,"#attachment-temporary":p.default,"#attachment-editor":o.default,"#letters":q.default,"#read-letter":r.default}});define("core-js",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=null});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("init/flags",["require","exports","@mail/flags"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);a.default.import(window.sotaConfig.flags)});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("init/initial-api",["require","exports","@mail/flags","cfg","cfgUser","RPC"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);c.default.get("api").forEach(function(c){d.default.mock.once(c.method,c.data);if(c.method==="/api/v1/helpers"){a.default.add(c.data&&c.data.body)}if(c.method==="/api/v1/user/short"){b.default.themeId=c.data.body.theme}})});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("init/feast",["require","exports","feast","feast-extension/qa"],function(require,exports,a,b){"use strict";var c,d;Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);a.default.set({renderRefAttributes:false,useTryCatch:!((c=window.features)===null||c===void 0?void 0:c.has("disable-feast-try-catch"))});if((d=window.__cfgOptions)===null||d===void 0?void 0:d.qa){(0,b.default)(a.default)}else{a.default.vdom.tags["@qa:id"]=function(){return false};a.default.vdom.tags["@qa:state"]=function(){return false}}});!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define("features/dist/features",["exports"],b):b((a="undefined"!=typeof globalThis?globalThis:a||self)["@mail/features"]={})}(this,function(a){"use strict";var b,c=function(){return(c=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)},d=/([\w.-]+)(?::([^\s]+))?/i,e=/^-/,f=/^([\d.]+)([smdwh]$)/,g=/\${[\w_]+}/g,h=/\s+/;a.Source=void 0,(b=a.Source||(a.Source={})).GetParam="getParam",b.Omicron="omicron",b.Onlineconf="onlineconf",b.Slot="slot",b.Manual="manual";var i=function(){return"-"+Math.random().toString(36).substr(2,5)};function j(a){return a&&"object"==typeof a}var k={s:function(a){return a},m:function(a){return this.s(60*a)},h:function(a){return this.m(60*a)},d:function(a){return this.h(24*a)},w:function(a){return this.d(7*a)}},l=function(a){return String(null!=a?a:"")},m=function(a){return null==a?"":encodeURIComponent(String(a))},n=function(a){return"Infinity"===a?1/0:"-Infinity"===a?-1/0:parseInt(a,10)},o=function(a){return null==a?NaN:(a=String(a).replace(",","."),parseFloat(a))},p=function(a){return/^(true|T|1)$/i.test(String(a))},q=function(a){var b,c=f.exec(a);if(null!==c){var d=c[2],e=c[1];return(null===(b=k[d])||void 0===b?void 0:b.call(k,parseFloat(e)))||0}return parseFloat(a)||0},r=function(a,b,c){if(null==a)return b;if("object"==typeof a)return a;if("string"==typeof a)try{return a.startsWith('"')&&(a=a.substring(1,a.length-1)),JSON.parse(a)}catch(a){null==c||c(a)}return b},s=function(a){return function(b,c){return a.indexOf(b)>-1?b:c}},t=function(a,b,c){try{return new RegExp(a||"")}catch(a){return null==c||c(a),null}};function u(a){return a.replace(/\\\$/g,"$$").replace(/\\{/g,"{")}function v(a,b,c){return function(d){var e=d[a];return b!==l&&b!==m?c:null==e?"":b(e)}}function w(a,b,c){if("string"!=typeof a)return function(){return c};var d,e,f,h=[],i=0;do{if((d=g.exec(a))&&"string"==typeof d[0]){if("\\"===a.slice(d.index-1,d.index))e=a.slice(i,d.index-1),h.push(u(e)),h.push(a.slice(d.index,d.index+d[0].length));else{e=a.slice(i,d.index),h.push(u(e));var k=d[0].slice(2,d[0].length-1);f=v(k,b[k],d[0]),h.push(f)}i=d.index+d[0].length}}while(null!==d);return e=a.slice(i),h.push(u(e)),function(a){return function(b){b=j(b)?b:{};for(var c=[],d=0,e=a;d<e.length;d++){var f=e[d];if("function"==typeof f)try{c.push(f(b))}catch(a){}else c.push(f)}return c.join("")}}(h)}var x=function(){function b(){var b=this;this.featuresToSalt=[],this.list={},this.filters={},this.updateId=0,this.urlConfig={},this.urlConfigDescriptors={},this.updateCallbacks=[],this.rearrangeGroups=function(a,b,c,d){var e=a[b].hasOwnProperty("children"),f=a[b].hasOwnProperty("depends");function g(){return a.splice.apply(a,[0,0].concat(a.splice(c,d)))}return e&&g||f&&a.splice.apply(a,[c+1,0].concat(a.splice(b,1)))&&g()||a.splice.apply(a,[0,0].concat(a.splice(b,1))),a},this.extend=function(a,c){for(var d in a){var e=a[d];1!=e&&0!=c||(e={state:!!e}),e.name=e.name||d,e=Object.assign(b.list[d]||{},a[d]),null==c||c(e,d,e.source),b.list[d]=Object.assign(b.list[d]||{},a[d])}},this.import=function(c,d){var e,f,g;if(Object.values(a.Source).includes(d)){if("string"==typeof c)return b.importFromString(c,d),void b.afterImport();for(var h in c){var i={state:!0,name:h};i.data=c[h];var j=null===(g=b.get(h))||void 0===g?void 0:g.source;j?j.unshift(d):j=[d],i.source=j;var k={};k[h]=i,b.extend(k)}b.afterImport()}else null===(f=null===(e=null===window||void 0===window?void 0:window.console)||void 0===e?void 0:e.error)||void 0===f||f.call(e,"Source "+d+" not supported")},this.configData={onParseFail:function(a){setTimeout(function(){throw a},1)}},this.importFromString=function(a,c){a.trim().split(h).forEach(function(a){var f=a.match(d);if(f){var g=f[1],h=b.featuresToSalt.includes(g)?""+g+i():g,j=f[2],k=!0;e.test(h)&&(k=!1,h=h.replace(e,""));var l=b.get(h);if(l)return l.data=j||null,l.dataArray=[].concat(l.dataArray,j),l.state=k,void l.source.unshift(c);var m={};m[h]={state:k,data:j||null,name:g,dataArray:[j||null],source:[c]},b.extend(m)}})},this.setURLConfig=function(a){var c;b.urlConfig=a,(null===(c=b.urlConfig)||void 0===c?void 0:c.vars)&&(b.urlConfigDescriptors=Object.keys(b.urlConfig.vars).reduce(function(a,b){return a[b]=l,a},{}))},this.isAvailable=function(c,d){var e,f=b.get(c);if((null===(e=null==f?void 0:f.source)||void 0===e?void 0:e.includes(a.Source.Omicron))&&!1===(null==f?void 0:f.data))return!1;if(null==f?void 0:f.depends)for(var g=f.depends.length;g--;)if(!b.isAvailable(f.depends[g],!0))return!1;return!!f&&(!d||f.state||f.menu)},this.has=function(a){return b.isAvailable(a,!0)},this.get=function(a){return b.featuresToSalt.includes(a)&&(a+=i()),b.list[a]},this.getSource=function(a){var c;return null===(c=b.get(a))||void 0===c?void 0:c.source},this.getDataOrDefault=function(a,c){var d;if(!b.has(a))return c;var e=null===(d=b.get(a))||void 0===d?void 0:d.data;return null!==e?e:c},this.getAs=function(a,c,d){var e;if(!b.has(c))return a(d,null);var f=function(a){var d;null===(d=b.configData)||void 0===d||d.onParseFail(a,c)},g=a(null===(e=b.get(c))||void 0===e?void 0:e.data,null,f);return null!==g?g:a(d,null,f)},this.getAsString=function(a,c){return b.getAs(l,a,c)},this.getAsBoolean=function(a,c){return b.getAs(p,a,c)},this.getAsArray=function(a,c,d){if(void 0===c&&(c=[]),"string"!=typeof d&&(d=","),!b.has(a))return c;var e=(b.get(a)||{}).data;if(null==e)return[];if("object"==typeof e){var f=Object.keys(e).map(function(a){return parseInt(a,10)});return f.some(isNaN)||f.some(function(a,b){return a!==b})?c:Object.values(e)}return String(e).split(d)},this.getAsTypedArray=function(a,c,d,e){if(void 0===d&&(d=[]),!b.has(a))return d;var f=b.getAsArray(a,d,e);if("function"==typeof c)return f.map(function(a){return c(a)});for(var g=[],h=0;h<c.length;h++)g.push(c[h](f[h]));return g},this.getAsInt=function(a,c){return b.getAs(n,a,c)},this.getAsFloat=function(a,c){return b.getAs(o,a,c)},this.getAsJSON=function(a,c){return b.getAs(r,a,c)},this.getAsEnum=function(a,c,d){var e,f;switch(!0){case"function"==typeof c:e=c;break;case j(f=c)&&"number"==typeof f.length:e=s(c);break;default:e=s([])}return b.getAs(e,a,d)},this.getAsTemplate=function(a,c,d){var e,f;try{return w(b.getAsString(a,d),c,d)}catch(c){return null===(f=(e=b.configData).onParseFail)||void 0===f||f.call(e,c,a),function(){return d}}},this.getAsURLTemplate=function(a,d,e,f){var g,h,i,j=c(c({},b.urlConfigDescriptors),d);try{var k=b.getAsString(a,e);i=w(k===e?null!=e?e:"":k,j,f)}catch(c){return null===(h=(g=b.configData).onParseFail)||void 0===h||h.call(g,c,a),function(){return f}}return function(a){var d=c(c({},b.urlConfig.vars),a);return i(d)}},this.getDuration=function(a,c){return b.getAsDuration(a,c)},this.getAsDuration=function(a,c){return b.getAs(q,a,c||0)},this.getAsURL=function(a,c){return b.getAsURLTemplate(a,b.urlConfigDescriptors,c)()},this.getAsRegExp=function(a,c){return b.getAs(t,a,c)},this.setFeaturesToSalt=function(a){b.featuresToSalt=a},this.filter=function(a,c){var d,e=[],f=b.list;for(var g in"string"==typeof a&&(a=b.filters[a]||function(){return!1}),f)d=f[g],a&&!a.call(c,d,g)||e.push(d);return e},this.sortGroups=function(a,c){for(var d,e=0,f=0,g=0,h=a.length;e<h;){if(a[e].hasOwnProperty("children")&&(g=e,d=a[e].children.length+1),a[e][c]){if(!(f=e)){e++;continue}b.rearrangeGroups(a,f,g,d)}e++}return a},this.use=function(a){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];var e=b.get(a);return!(!b.has(a)||!(null==e?void 0:e.use))&&(e.use.apply(e,[e].concat([].slice.call(c,1))),!0)},this.config=function(a){b.configData=a},this.String=l,this.URLString=m,this.Int=n,this.Float=o,this.Boolean=p,this.Duration=q,this.JSON=r,this.Enum=s}return b.prototype.afterImport=function(){this.updateId++,this.updateCallbacks.forEach(function(a){return a()})},b.prototype.onUpdate=function(a){var b=this;return this.updateCallbacks.push(a),function(){b.updateCallbacks=b.updateCallbacks.filter(function(b){return b!==a})}},b}(),y=new x;a.Features=x,a.default=y,Object.defineProperty(a,"__esModule",{value:!0})});define("features",["features/dist/features"],function(a){return a});define("service/captcha",["exports","Emitter","RPC","service/layer","service/radars/index"],function(exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=i(a);var f=i(b);var g=i(c);var h=i(d);function i(a){return a&&a.__esModule?a:{default:a}}var j=void 0;var k=function a(b){j=null;return b};var l={_openPopup:function a(b){if(j){return j}j=g.default.open("captcha",{"captcha-error":b},{dimmer:true,compact:true,resolvable:true}).then(k,k);this.emit("open-captcha-popup");return j},retryUntilCaptchaSuccess:function a(b){var c=this;return new Promise(function(a,d){c.tryRequestWithCaptcha(b,a,d)}).then(function(a){(0,h.default)("captcha_enter_success");return a},function(a){(0,h.default)("captcha_enter_error");return Promise.reject(a)})},tryRequestWithCaptcha:function a(b,c,d){var e=this;var f=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{error:false,showCaptcha:false,retries:0},g=f.error,i=f.showCaptcha,j=f.retries;var k=i?this._openPopup(g):Promise.resolve({});k.then(function(a){if(!a){d({body:"captcha-closed"});return}var f=b(a);f.then(c,function(a){var f=e._isCaptchaError(a);var g=e._isCaptcha(a)||f;if(g){e.tryRequestWithCaptcha(b,c,d,{error:f,showCaptcha:true,retries:j+1});(0,h.default)({type:"try_enter_captcha",intervals:[["retries",j]]})}else{d(a)}})},function(a){d(a)})},_isCaptcha:function a(b){var c=b.status,d=b.body;return c===+f.default.statuses.many_requests&&d==="possible_bad_guy"},_isCaptchaError:function a(b){var c=b.status,d=b.body;return c===+f.default.statuses.invalid&&!!d.capcha}};e.default.apply(l);exports.default=l});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/todo",["require","exports","default-values","helpers/get-oauth","helpers/querystring-add","helpers/request-api-oauth"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});c=__importDefault(c);d=__importDefault(d);var e=function(){function e(){this.createRequestApiOAuthOptions=function(a,c){if(a===void 0){a="GET"}if(c===void 0){c={}}return __assign(__assign({},c),{type:a,oauthFeature:b.OAuthFeature.Todo,isAuthError:e.isAuthError})}}e.prototype.getStatus=function(a){if(a===void 0){a={last_updated:0,show_inbox:true}}return __awaiter(this,void 0,Promise,function(){return __generator(this,function(b){return[2,(0,d.default)((0,c.default)(e.getApiUrl("status"),a),null,this.createRequestApiOAuthOptions("GET")).then(function(a){return a===null||a===void 0?void 0:a.body})]})})};e.UNAUTHORIZED_CODE=401;e.getApiUrl=function(){var b=[];for(var c=0;c<arguments.length;c++){b[c]=arguments[c]}return __spreadArray([a.TODO_API_URL,"api/v1"],b,true).join("/")};e.isAuthError=function(a){return a.status===e.UNAUTHORIZED_CODE};return e}();exports.default=new e});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/marusia-manager",["require","exports","default-values","feast","ui-block/marusia-read-letter-button/marusia-read-letter-button","../lazy.modules"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MARUSIA_IN_WIDGET=exports.MarusiaManager=void 0;b=__importDefault(b);c=__importDefault(c);var e=function(b){__extends(e,b);function e(){var a=b!==null&&b.apply(this,arguments)||this;a.marusiaGetParams=false;return a}e.prototype.getComponentsSpec=function(){return{"marusia-read-letter-button":{class:c.default,events:["marusia:read:letter:click"]},letter:{lazy:d.lazyUILetter,attrs:{"marusia-portal-enabled":function(a){return a.isMarusiaInPortalEnabled()}}},"themes-widget-souzmultfilm":{lazy:d.lazyUIThemesWidgetSouzmultfilm,events:["marusia:start:command","marusia:open"],attrs:{"marusia-portal-enabled":function(a){return a.isMarusiaInPortalEnabled()}}},WidgetHeader:{attrs:{marusiaGetParams:function(a){return a.marusiaGetParams}}},MarusiaIframe:{attrs:{marusiaGetParams:function(a){return a.marusiaGetParams}}}}};e.prototype.handleEvent=function(a){var b=a.type,c=a.details,d=c===void 0?{}:c;if(b==="marusia:read:letter:click"){return this.readLetter(d.model)}if(b==="marusia:start:command"){return this.startWithCommand(d.command)}if(b==="marusia:open"){return this.openMarusia(d.getParams)}};e.prototype.isMarusiaInPortalEnabled=function(){var b,c;return!a.DISABLE_MARUSIA_IN_PORTAL&&!!((c=(b=window.__PH)===null||b===void 0?void 0:b.isMarusiaMenuEnabled)===null||c===void 0?void 0:c.call(b))};e.prototype.openMarusia=function(a){var b,c;if(a===void 0){a={}}if(exports.MARUSIA_IN_WIDGET){this.marusiaGetParams=a;return}(c=(b=window.__PH)===null||b===void 0?void 0:b.marusiaMenu)===null||c===void 0?void 0:c.show(a)};e.prototype.subGetParams=function(b){return __assign(__assign({},a.MARUSIA_SKILLSERVER_TEST&&{skillserver_type:"mailskill"}),b&&{timestamp:Date.now()})};e.prototype.readLetter=function(a){var b=a.get("id");var c=__assign({start_with_event:"read_single_message_event",intent_data:JSON.stringify({uidl:b})},this.subGetParams(true));this.openMarusia(c)};e.prototype.mailCheckStatus=function(){var a=__assign({start_with_event:"mail_check_status_event"},this.subGetParams(true));this.openMarusia(a)};e.prototype.startWithCommand=function(a){var b=__assign({start_with_command:a},this.subGetParams(true));this.openMarusia(b)};return e}(b.default.Mediator);exports.MarusiaManager=e;var f=b.default.Mediator.createFromClass("marusia-manager",e);exports.MARUSIA_IN_WIDGET=f.isMarusiaInPortalEnabled()&&a.HAS_WIDGET_HEADER_TYPE;exports.default=f});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/rb",["require","exports","request"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);exports.default={getSlot:function(b,c,d){if(c===void 0){c="themes"}if(d===void 0){d=0}var e=b?"/widgets/".concat(c,"/").concat(b,"/"):"/widgets/".concat(c,"/");if(!(!d||isNaN(Number(d)))){e+="?preview="+Number(d)}return(0,a.default)(e,null,{force:true}).then(function(a){return a.body})}}});define("octavius-public/sw-box/get",["require","exports","router"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function b(){return(0,a.getAppRouter)().model.swBox}exports.default=b});define("octavius-public/push-manager/get",["require","exports","router"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function b(){return(0,a.getAppRouter)().model.pushManager}exports.default=b});define("octavius-public/metathreads/open-metathreads",["require","exports","../../lazy.modules"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function b(){(0,a.lazyMediatorSettingsManager)().then(function(a){a.onSettingsMetathreadsOpen()})}exports.default=b});define("helpers/date-helper",["require","exports","feast-mod/letter-date"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DateHelper=exports.DateFormat=void 0;var b;(function(a){a[a["DayMonthYear"]=0]="DayMonthYear";a[a["DayMonthYearFull"]=1]="DayMonthYearFull"})(b=exports.DateFormat||(exports.DateFormat={}));function c(a,b){var c=String(a);if(typeof b==="number"){if(c.length>b){return c.slice(Math.max(0,c.length-b))}return"0".repeat(b-c.length)+c}return c}var d=function(){function d(a){if(a&&typeof a==="object"){this._date=a}else{this._date=new Date(a)}}d.fromServerDate=function(b){var c;switch(typeof b){case"number":c=new Date(b*1e3);break;case"string":c=new Date(b);break;case"object":c=b;break}var e=new Date((0,a.getCorrectedTimestampMS)(c.getTime()));return new d(e)};d.fromClientDate=function(a){return new d(a)};d.getDaysFromMSeconds=function(a){return Math.ceil(a/1e3/60/60/24)};d.prototype.getClientDate=function(){return this._date};d.prototype.getFormattedDate=function(a){var d=this._date;switch(a){case b.DayMonthYear:return c(d.getDate(),2)+"."+c(d.getMonth()+1,2)+"."+c(d.getFullYear(),2);case b.DayMonthYearFull:return c(d.getDate(),2)+"."+c(d.getMonth()+1,2)+"."+c(d.getFullYear())}};return d}();exports.DateHelper=d});define("octavius-public/helpers/date-helper",["require","exports","helpers/date-helper"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DateFormat=exports.DateHelper=void 0;Object.defineProperty(exports,"DateFormat",{enumerable:true,get:function(){return a.DateFormat}});Object.defineProperty(exports,"DateHelper",{enumerable:true,get:function(){return a.DateHelper}})});define("octavius-public/service/vkMessengerLoader",["require","exports","service/vkMessengerLoader"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.vkMessengerLoader=void 0;exports.vkMessengerLoader=a.vkMessengerLoader});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("octavius-public/cleanmailbox/open-cleanmailbox",["require","exports","mediator/settings-manager"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);function b(){return a.default.onSettingsDockCleanmailboxOpen()}exports.default=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("octavius-public/browsersettings/open-browsersettings",["require","exports","mediator/settings-manager"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);exports.default=function(){return a.default.onSettingsDockBrowserSettingsOpen()}});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};define("octavius-public/service/storage",["require","exports","service/storage"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createSessionStorage=exports.createScopeStorage=void 0;a=__importStar(a);Object.defineProperty(exports,"createScopeStorage",{enumerable:true,get:function(){return a.createScopeStorage}});Object.defineProperty(exports,"createSessionStorage",{enumerable:true,get:function(){return a.createSessionStorage}});exports.default=a.default});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("octavius-public/service/compose-template",["require","exports","service/compose-template"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);exports.default=a.default});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("octavius-public/unsubscribe/unsubscribe-helper",["require","exports","mediator/thread-manager","mediator/unsubscribe-actions"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);var c=function(){function c(){}c.prototype.getCurrentLetterId=function(){return a.default.getModel().id};c.prototype.getCurrentLetterSenderEmail=function(){try{var b=a.default.getModel();var c=b.get("correspondents.from.0");return(c===null||c===void 0?void 0:c.email)||""}catch(a){return""}};c.prototype.isCurrentSenderUnread=function(){try{var a=b.default.get("router.model.unsubscribeList").list;return a.includes(this.getCurrentLetterSenderEmail())}catch(a){return false}};return c}();var d=new c;exports.default=d});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("octavius-public/themes/getCurrentThemeId",["require","exports","service/themes.setup"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);function b(){return a.default.getSelectedModel().id}exports.default=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("octavius-public/service/query-checker",["require","exports","service/query-checker"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);exports.default=a.default});define("octavius-public/sw-box/hasSWBoxTag",["require","exports","@mail/sw-box"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function b(b){return(0,a.hasServiceWorkerTag)(b)}exports.default=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("octavius-public/helpers/opener",["require","exports","helpers/opener"],function(require,exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);exports.default=a.default});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("defines-externals",["require","exports","helpers/define-utils","@mail/flags","@mail/radars-decorator/dist/index-react","cfg","cfgUser","config","features","mail/actions/ContactSuggests","mail/Attachment","mail/Folder","mail/SharedMailbox","mail/UserSecurity","request","RPC","service/auth","mail/User","ui-block/noads-button/noads-button","default-values","service/compose","service/notify","service/promo","service/mailbox/loader","service/captcha","service/layer","service/cloud","service/todo","mediator/folders-actions","mediator/letters-selection","mediator/layout-manager","mediator/settings-manager","mediator/addressbook-manager","mediator/marusia-manager","data-source/index","helpers/rb","helpers/data-source-dispatch","Transaction","mail/actions/MoveTo","mail/actions/MoveToAll","RPCModel","Model","mail/getters/MessageMeta","utils/util","Emitter","Action","mail/Message","octavius-public/sw-box/get","octavius-public/push-manager/get","octavius-public/metathreads/open-metathreads","octavius-public/helpers/date-helper","octavius-public/service/vkMessengerLoader","octavius-public/cleanmailbox/open-cleanmailbox","octavius-public/browsersettings/open-browsersettings","octavius-public/service/storage","octavius-public/service/compose-template","octavius-public/unsubscribe/unsubscribe-helper","octavius-public/themes/getCurrentThemeId","octavius-public/service/query-checker","octavius-public/sw-box/hasSWBoxTag","service/dimmer","octavius-public/helpers/opener","helpers/opener","filters/Filter","data-source/actions","utils/extension","classnames","RPC/statuses/sdc","logger","@instant-messengers/vk-teams-bridge"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importStar(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importStar(q);r=__importStar(r);s=__importStar(s);t=__importStar(t);u=__importStar(u);v=__importStar(v);w=__importStar(w);x=__importStar(x);y=__importStar(y);z=__importStar(z);A=__importStar(A);B=__importStar(B);C=__importStar(C);D=__importStar(D);E=__importStar(E);F=__importStar(F);G=__importDefault(G);H=__importDefault(H);I=__importStar(I);J=__importDefault(J);K=__importDefault(K);L=__importDefault(L);M=__importDefault(M);N=__importDefault(N);O=__importDefault(O);P=__importStar(P);Q=__importDefault(Q);R=__importDefault(R);S=__importDefault(S);T=__importStar(T);U=__importStar(U);V=__importStar(V);W=__importStar(W);X=__importStar(X);Y=__importStar(Y);Z=__importStar(Z);_=__importStar(_);aa=__importStar(aa);ba=__importStar(ba);ca=__importStar(ca);da=__importStar(da);ea=__importStar(ea);fa=__importStar(fa);ga=__importStar(ga);ha=__importStar(ha);ia=__importStar(ia);ja=__importStar(ja);ka=__importStar(ka);la=__importStar(la);ma=__importStar(ma);na=__importStar(na);oa=__importStar(oa);var pa={request:m.default,RPC:n.default,config:f.default,cfg:d.default,features:g.default,"@mail/features":g.default,flags:b.default,"@mail/flags":b.default,cfgUser:e.default,"service/auth":o.default,"mail/Attachment":i.default,"mail/Folder":j.default,"mail/SharedMailbox":k.default,"mail/UserSecurity":l.default,"mail/actions/ContactSuggests":h.default,"@mail/radars-decorator/dist/index-react":c,"mail/User":p.default,"ui-block/noads-button/noads-button":q,"default-values":r,"service/compose":s,"service/notify":t,"service/promo":u,"service/mailbox/loader":v,"service/captcha":w,"service/layer":x,"service/cloud":y,"service/todo":z,"mediator/folders-actions":A,"mediator/letters-selection":B,"mediator/layout-manager":C,"mediator/settings-manager":D,"mediator/addressbook-manager":E,"mediator/marusia-manager":F,"data-source/index":G.default,"helpers/rb":H.default,"helpers/data-source-dispatch":I,Transaction:J.default,"mail/actions/MoveTo":K.default,"mail/actions/MoveToAll":L.default,Model:N.default,RPCModel:M.default,"mail/getters/MessageMeta":O.default,classnames:la,"utils/util":P,Emitter:Q.default,Action:R.default,"mail/Message":S.default,"service/dimmer":fa,"helpers/opener":ha,"filters/Filter":ia,"data-source/actions":ja,"utils/extension":ka,"RPC/statuses/sdc":ma,logger:na,"octavius-public/sw-box/get":T,"octavius-public/push-manager/get":U,"octavius-public/metathreads/open-metathreads":V,"octavius-public/helpers/date-helper":W,"octavius-public/service/vkMessengerLoader":X,"octavius-public/cleanmailbox/open-cleanmailbox":Y,"octavius-public/browsersettings/open-browsersettings":Z,"octavius-public/service/storage":_,"octavius-public/service/compose-template":aa,"octavius-public/unsubscribe/unsubscribe-helper":ba,"octavius-public/themes/getCurrentThemeId":ca,"octavius-public/service/query-checker":da,"octavius-public/sw-box/hasSWBoxTag":ea,"octavius-public/helpers/opener":ga,"@instant-messengers/vk-teams-bridge":oa};window.__definesExternals=pa;Object.entries(pa).forEach(function(b){var c=b[0],d=b[1];(0,a.defineExternalForSyncUse)(c,d)})});define("app-init",["./init/i18n","./init/flags","./init/initial-api","./init/feast","./defines-externals"],function(a){"use strict";var b=c(a);function c(a){return a&&a.__esModule?a:{default:a}}});define("octavius-public/index",["require","exports","octavius-public/helpers/opener","octavius-public/sw-box/get","octavius-public/sw-box/hasSWBoxTag","octavius-public/push-manager/get","octavius-public/metathreads/open-metathreads","octavius-public/helpers/date-helper","octavius-public/service/vkMessengerLoader","octavius-public/cleanmailbox/open-cleanmailbox","octavius-public/browsersettings/open-browsersettings","octavius-public/service/storage","octavius-public/service/compose-template","octavius-public/unsubscribe/unsubscribe-helper","octavius-public/themes/getCurrentThemeId","octavius-public/service/query-checker"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})});define("app",["exports","./init/i18n","@mail/features","@mail/flags","@mail/xray","@mail-core/dashboard","boot/after-ready","boot/headline","boot/mediators","boot/pre-init","boot/promo","boot/release-detect","boot/router/listener","boot/router/user-timings","boot/vk-miniapp","./boot/feedback","helpers/perf","cfg","data-source/index","service/promo","default-values","helpers/headless-counter","helpers/metrics/log-some-api-duration","logger","mediator/layout-manager","mediator/themes-manager","pilotjs","request","RPC","service/adv/index","service/jssdk-config/setupMailboxLimits","service/jssdk-config/setupConstants","service/layer","service/page-lifecycle","service/query-checker","service/radars/index","service/smokescreen","service/themes.setup","service/white-portal/index","ui-block/application/application","ui-block/layer-window/layer-window","./data-source/actions","./flags.setup","./helpers/define-utils","./helpers/lazy","./init/post-load","./setup","./sitemap","./default-values","./router","core-js","./app-init","mrg-i18n-utils","octavius-public/index"],function(exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var X=wa(a);var Y=wa(b);var Z=wa(c);var _=wa(d);var aa=wa(q);var ba=wa(r);var ca=wa(s);var da=wa(w);var ea=wa(x);var fa=wa(y);var ga=wa(z);var ha=wa(A);var ia=wa(B);var ja=wa(C);var ka=wa(D);var la=wa(E);var ma=wa(F);var na=wa(G);var oa=wa(H);var pa=wa(I);var qa=wa(J);var ra=wa(K);var sa=wa(M);var ta=wa(N);var ua=wa(T);var va=wa(U);function wa(a){return a&&a.__esModule?a:{default:a}}e.userKeeper.timeEnd("biz-app-load",{score:"app:load"});e.userKeeper.time("biz-app-init");(0,u.sendHeadCheckRadar)("onload");(0,i.preInit)();window.define("flags",function(){return Z.default});var xa=function a(){return window["app-canvas"][0]||window["app-canvas"]};var ya=ga.default.create(va.default);var za=["#attachment","#attachment-temporary","#attachment-editor"];e.userKeeper.group("app-setup-env",function(){ea.default.register((0,g.getHeadline)());ma.default.setup(ta.default);(0,o.initFeedback)(ba.default);(0,j.initPromo)(ba.default);fa.default.register(ra.default.themes);(0,L.tryApplyWhitePortalTheme)();(0,ka.default)();(0,la.default)()});e.userKeeper.time("app-setup-router");qa.default.init(ya,t.LAZY_SMOKE_SCREEN_INIT);na.default.init(ya);ya.appSetup=ua.default;var Aa=function a(b){b.register(ya,{skipLazy:true});b.register(ba.default,{skipLazy:true})};(0,h.eachMediators)(Aa);ra.default.applyUserTheme(ya.activeUrl.query);(0,m.initUserTimingsRouter)({request:ha.default,app:ya});(0,v.logSomeAPIDuration)({request:ha.default,xray:_.default});ya.on("beforeroute",function(a){var b=a.target;var c=b.activeRoute;var d=b.activeRequest;var e=["on_route",c.id.slice(1)];window.sendLoadlogRadar("loadflow_step-20","beforeroute"+e.join(" "));if(c.id.match("#!septima")){var f=void 0;try{f=c.redirectUrl(d.params,d.query);if(!f.match("\\?")&&d.search){f+=d.search}}catch(a){f="/"}window.sendLoadlogRadar("loadflow_step-20","Septima redirect "+f);d.redirectTo(f)}var g=null;if(c.is("#read-letter")){var h=ya.activeRequest||{};var i=h.params||{};var j=i.folder,k=i.letter;var l=ya.model||{};var m=l.letters;if(m){var n="";var o=false;var p=false;var q=m.find(function(a){return a.id===k});if(q){var r=q.attributes||{};var s=r.correspondents||{};n=(s.from||[]).map(function(a){return a.email}).filter(Boolean).join(",");var t=r.flags;o=!!t.newsletter;p=t.attach}g={folder_id:j,letter_id:k,send_email:n,newsletter:o,attach_state:p}}}(0,pa.default)({chain:e,data:d.params,dwh:g})});ya.on("routeend",function(a){var b=a.target;var c=b.activeRoute;var d=b.activeRequest;var e=["on_routeend",c.id.slice(1)];window.sendLoadlogRadar("loadflow_step-20","routeend"+e.join(" "));(0,pa.default)({chain:e,data:d.params});if(d.query){var f=new oa.default(b);f.handleEnableOctavius();f.handleToggleLayout();f.handleToggleMetathreads();f.handleSetTheme();f.handleToggleToMyselfMetathread();f.handleOpenThemesPanel();f.handleOpenCleanMaster();f.handleQueryAction();f.handleOpenComposeTemplate();f.handleOpenFromExtension()}});ya.on("beforereload",function(){if(ya.isDead){return false}window.sendLoadlogRadar("loadflow_step-20","beforereload");e.userKeeper.group("app-render-reload",function(){var a=xa();if(ya.view){ya.view.destroy()}ya.view=new sa.default(ba.default.getData(),{router:ya,dataSource:ba.default});ya.view.renderTo(a)},{score:"app:render"});return false});if(t.IS_VK_MINI_APP){ya.one("route-fail",function(a,b,c,d){if(ya.isReady){return}ya.failed=true;require(["react","react-dom","ui-react"],function(a,b,c){var e=xa();var f=c.default.MiniAppUnknownError;var g=(0,n.getVkMiniAppErrorProps)(d);var h=a.createElement(f,g);b.render(h,e)})})}e.userKeeper.time("app-first-fetch");ya.one("routeend",function a(){e.userKeeper.timeEnd("biz-app-init",{score:"app:init"});e.userKeeper.time("biz-app-render");e.userKeeper.timeEnd("app-first-fetch",{score:"fetch"});e.userKeeper.group("app-first-render",function(){window.sendLoadlogRadar("loadflow_step-20","one routeend top");if(!za.some(function(a){return ya.route.is(a)})){(0,g.getHeadline)().set("visible",true)}if(!t.IS_VK_MINI_APP||!ya.failed){var a=xa();_timers.data+=_now();_timers.render=-_now();ya.view=new sa.default(ba.default.getData(),{router:ya,dataSource:ba.default});ba.default.on("change",function(a){var b=a.details;var c=b.changes;if(c.some(function(a){var b=a.action;return b.type!==O.EXECUTE_JSSDK_ACTION})){ya.view.set(c[c.length-1].data)}});a.removeChild(a.firstElementChild);ya.view.renderTo(a)}e.userKeeper.timeEnd("biz-app-render",{score:"app:render"})},{score:"app:render"});window.appStarted("routeend");_timers.render+=_now();_timers.all+=_now();da.default.add("timings",_timers);var b=Date.now()-window._timers.start_ts;var c=Object.keys(_timers).filter(function(a){return _timers[a]>=0}).map(function(a){return{name:a,value:_timers[a]}});I.radarService.sendLoadInfo(b,c);I.radarService.sendArchiveFoldersInfo();I.radarService.send({type:"config_performance_log",data:{sessionStorage:Y.default.has("perflog_session_storage"),chunkLength:parseInt((Y.default.get("perflog_chunk_length")||{}).data,10),chunks:parseInt((Y.default.get("perflog_chunks")||{}).data,10)}});(0,k.initReleaseDetect)({cfg:aa.default,RPC:ia.default,app:ya,xray:_.default});(0,P.setupFlagsAutosync)(ya);if(t.HIDE_TOYS){ja.default.updateOnAction()}console.warn("[timing]",c.map(function(a){var b=a.name,c=a.value;return b+": "+c.toFixed(3)+"ms"}).join(", "))});ya.on("route",function(a){var b=a.details.initiator;var c=b==="initial";if(c){return}ja.default.updateOnAction()});var Ba=new Promise(function(a){ya.one("routeend",function b(){window.sendLoadlogRadar("loadflow_step-20","appRouteEndReady");ya.isReady=true;a(ya);if(!t.IS_VK_MINI_APP||!ya.failed){(0,R.executeAllLazyAfterReadyTask)(ya);setTimeout(function(){return(0,R.executeAllLazyAfterReadyTask)((0,W.getAppRouter)(),R.lazyNoncriticalAfterReady)},V.LAZY_NONCRIT_TASKS_TIMEOUT)}})});ya.ready=function a(b){Ba.then(function(){typeof window.__hideProgress__==="function"&&window.__hideProgress__();b()})};e.userKeeper.timeEnd("app-setup-router");(0,p.initPerfMonitoring)(ya);(0,l.initRouterDocumentListener)(ya,{logger:da.default,smokeScreenService:qa.default});if(V.WEBVIEW){(0,R.addLazyAfterReadyTask)(f.vkTeamSendSuccessEvent)}(0,R.addLazyAfterReadyTask)(f.initDND);(0,R.addLazyAfterReadyTask)(f.initAfterReady);if(V.PROMO_MANUAL_LOAD){(0,R.addLazyNoncriticalTask)(function(){return ca.default.update(true)})}(0,R.addLazyNoncriticalTask)(f.setupClientLogSend);window.app=ya;(0,S.afterLoad)();(0,Q.defineExternalForSyncUse)("app",ya);exports.default=ya});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/auth/account",["require","exports","@mail/features","cfg","cfgUser","default-values","router","service/portal","vk-miniapp/init"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);f=__importDefault(f);function h(a){window.location.href=a+"?page=".concat(encodeURIComponent(window.location.href))+"&allow_external=1"}function i(c){var d=a.default.has("disable-choice");var g=b.default.get("urls.loginUrl")||"https://account.mail.ru/login";if(d){h(g);return}f.default.load().then(function(){var a=Object.assign({page:location.protocol+"//"+location.host,allow_external:true,modal:false,opener:"octavius",mode:"simple",lang:"ru_RU"},c);var b=__PH.authForm;if(!b.isVisible()){var d=(0,e.getAppRouter)();if(d&&d.isReady){if(c.modal){document.body.style.overflow="hidden"}b.show(a)}else{h(g)}}})}function j(){return(0,g.performLoading)().catch(function(){location.href="/vk-mini-app#error"})}function k(){if(d.IS_VK_MINI_APP){return j()}return i({modal:true,formType:"relogin",email:__PH.activeUser(),email_vkc_auth:c.default.get("initialUser.vkc_user_id")?"1":""})}exports.default={login:function(){return new Promise(function(){return i()})},relogin:function(){return new Promise(function(){return k()})},keepalive:function(){f.default.load().then(function(){__PH.on("authLost",function(){return k()});__PH.on("loginRequest",function(){return i()});__PH.on("authChange",function(a){var c=a.data.email;if(d.IS_VK_MINI_APP){j()}if(d.DISABLE_DOMAIN_AUTHCHECK){location.replace("/inbox");return}if(!c.endsWith("@".concat(d.VK_DOMAIN))&&d.IS_VK_HOST){location.replace(b.default.get("urls.baseMailUrl"));return}if(c.endsWith("@".concat(d.VK_DOMAIN))&&!d.IS_VK_HOST){location.replace(b.default.get("urls.vkMailUrl"));return}location.replace("/inbox")})})}}});